(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

// Utility function that allows modes to be combined. The mode given
// as the base argument takes care of most of the normal mode
// functionality, but a second (typically simple) mode is used, which
// can override the style of text. Both modes get to parse all of the
// text, but when both assign a non-null style to a piece of code, the
// overlay wins, unless the combine argument was true and not overridden,
// or state.overlay.combineTokens was true, in which case the styles are
// combined.

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
"use strict";

CodeMirror.overlayMode = function(base, overlay, combine) {
  return {
    startState: function() {
      return {
        base: CodeMirror.startState(base),
        overlay: CodeMirror.startState(overlay),
        basePos: 0, baseCur: null,
        overlayPos: 0, overlayCur: null,
        streamSeen: null
      };
    },
    copyState: function(state) {
      return {
        base: CodeMirror.copyState(base, state.base),
        overlay: CodeMirror.copyState(overlay, state.overlay),
        basePos: state.basePos, baseCur: null,
        overlayPos: state.overlayPos, overlayCur: null
      };
    },

    token: function(stream, state) {
      if (stream != state.streamSeen ||
          Math.min(state.basePos, state.overlayPos) < stream.start) {
        state.streamSeen = stream;
        state.basePos = state.overlayPos = stream.start;
      }

      if (stream.start == state.basePos) {
        state.baseCur = base.token(stream, state.base);
        state.basePos = stream.pos;
      }
      if (stream.start == state.overlayPos) {
        stream.pos = stream.start;
        state.overlayCur = overlay.token(stream, state.overlay);
        state.overlayPos = stream.pos;
      }
      stream.pos = Math.min(state.basePos, state.overlayPos);

      // state.overlay.combineTokens always takes precedence over combine,
      // unless set to null
      if (state.overlayCur == null) return state.baseCur;
      else if (state.baseCur != null &&
               state.overlay.combineTokens ||
               combine && state.overlay.combineTokens == null)
        return state.baseCur + " " + state.overlayCur;
      else return state.overlayCur;
    },

    indent: base.indent && function(state, textAfter) {
      return base.indent(state.base, textAfter);
    },
    electricChars: base.electricChars,

    innerMode: function(state) { return {state: state.base, mode: base}; },

    blankLine: function(state) {
      if (base.blankLine) base.blankLine(state.base);
      if (overlay.blankLine) overlay.blankLine(state.overlay);
    }
  };
};

});

},{"../../lib/codemirror":2}],2:[function(require,module,exports){
// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

// This is CodeMirror (http://codemirror.net), a code editor
// implemented in JavaScript on top of the browser's DOM.
//
// You can find some technical background for some of the code below
// at http://marijnhaverbeke.nl/blog/#cm-internals .

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    module.exports = mod();
  else if (typeof define == "function" && define.amd) // AMD
    return define([], mod);
  else // Plain browser env
    this.CodeMirror = mod();
})(function() {
  "use strict";

  // BROWSER SNIFFING

  // Kludges for bugs and behavior differences that can't be feature
  // detected are enabled based on userAgent etc sniffing.
  var userAgent = navigator.userAgent;
  var platform = navigator.platform;

  var gecko = /gecko\/\d/i.test(userAgent);
  var ie_upto10 = /MSIE \d/.test(userAgent);
  var ie_11up = /Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(userAgent);
  var ie = ie_upto10 || ie_11up;
  var ie_version = ie && (ie_upto10 ? document.documentMode || 6 : ie_11up[1]);
  var webkit = /WebKit\//.test(userAgent);
  var qtwebkit = webkit && /Qt\/\d+\.\d+/.test(userAgent);
  var chrome = /Chrome\//.test(userAgent);
  var presto = /Opera\//.test(userAgent);
  var safari = /Apple Computer/.test(navigator.vendor);
  var mac_geMountainLion = /Mac OS X 1\d\D([8-9]|\d\d)\D/.test(userAgent);
  var phantom = /PhantomJS/.test(userAgent);

  var ios = /AppleWebKit/.test(userAgent) && /Mobile\/\w+/.test(userAgent);
  // This is woefully incomplete. Suggestions for alternative methods welcome.
  var mobile = ios || /Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(userAgent);
  var mac = ios || /Mac/.test(platform);
  var windows = /win/i.test(platform);

  var presto_version = presto && userAgent.match(/Version\/(\d*\.\d*)/);
  if (presto_version) presto_version = Number(presto_version[1]);
  if (presto_version && presto_version >= 15) { presto = false; webkit = true; }
  // Some browsers use the wrong event properties to signal cmd/ctrl on OS X
  var flipCtrlCmd = mac && (qtwebkit || presto && (presto_version == null || presto_version < 12.11));
  var captureRightClick = gecko || (ie && ie_version >= 9);

  // Optimize some code when these features are not used.
  var sawReadOnlySpans = false, sawCollapsedSpans = false;

  // EDITOR CONSTRUCTOR

  // A CodeMirror instance represents an editor. This is the object
  // that user code is usually dealing with.

  function CodeMirror(place, options) {
    if (!(this instanceof CodeMirror)) return new CodeMirror(place, options);

    this.options = options = options ? copyObj(options) : {};
    // Determine effective options based on given values and defaults.
    copyObj(defaults, options, false);
    setGuttersForLineNumbers(options);

    var doc = options.value;
    if (typeof doc == "string") doc = new Doc(doc, options.mode, null, options.lineSeparator);
    this.doc = doc;

    var input = new CodeMirror.inputStyles[options.inputStyle](this);
    var display = this.display = new Display(place, doc, input);
    display.wrapper.CodeMirror = this;
    updateGutters(this);
    themeChanged(this);
    if (options.lineWrapping)
      this.display.wrapper.className += " CodeMirror-wrap";
    if (options.autofocus && !mobile) display.input.focus();
    initScrollbars(this);

    this.state = {
      keyMaps: [],  // stores maps added by addKeyMap
      overlays: [], // highlighting overlays, as added by addOverlay
      modeGen: 0,   // bumped when mode/overlay changes, used to invalidate highlighting info
      overwrite: false,
      delayingBlurEvent: false,
      focused: false,
      suppressEdits: false, // used to disable editing during key handlers when in readOnly mode
      pasteIncoming: false, cutIncoming: false, // help recognize paste/cut edits in input.poll
      selectingText: false,
      draggingText: false,
      highlight: new Delayed(), // stores highlight worker timeout
      keySeq: null,  // Unfinished key sequence
      specialChars: null
    };

    var cm = this;

    // Override magic textarea content restore that IE sometimes does
    // on our hidden textarea on reload
    if (ie && ie_version < 11) setTimeout(function() { cm.display.input.reset(true); }, 20);

    registerEventHandlers(this);
    ensureGlobalHandlers();

    startOperation(this);
    this.curOp.forceUpdate = true;
    attachDoc(this, doc);

    if ((options.autofocus && !mobile) || cm.hasFocus())
      setTimeout(bind(onFocus, this), 20);
    else
      onBlur(this);

    for (var opt in optionHandlers) if (optionHandlers.hasOwnProperty(opt))
      optionHandlers[opt](this, options[opt], Init);
    maybeUpdateLineNumberWidth(this);
    if (options.finishInit) options.finishInit(this);
    for (var i = 0; i < initHooks.length; ++i) initHooks[i](this);
    endOperation(this);
    // Suppress optimizelegibility in Webkit, since it breaks text
    // measuring on line wrapping boundaries.
    if (webkit && options.lineWrapping &&
        getComputedStyle(display.lineDiv).textRendering == "optimizelegibility")
      display.lineDiv.style.textRendering = "auto";
  }

  // DISPLAY CONSTRUCTOR

  // The display handles the DOM integration, both for input reading
  // and content drawing. It holds references to DOM nodes and
  // display-related state.

  function Display(place, doc, input) {
    var d = this;
    this.input = input;

    // Covers bottom-right square when both scrollbars are present.
    d.scrollbarFiller = elt("div", null, "CodeMirror-scrollbar-filler");
    d.scrollbarFiller.setAttribute("cm-not-content", "true");
    // Covers bottom of gutter when coverGutterNextToScrollbar is on
    // and h scrollbar is present.
    d.gutterFiller = elt("div", null, "CodeMirror-gutter-filler");
    d.gutterFiller.setAttribute("cm-not-content", "true");
    // Will contain the actual code, positioned to cover the viewport.
    d.lineDiv = elt("div", null, "CodeMirror-code");
    // Elements are added to these to represent selection and cursors.
    d.selectionDiv = elt("div", null, null, "position: relative; z-index: 1");
    d.cursorDiv = elt("div", null, "CodeMirror-cursors");
    // A visibility: hidden element used to find the size of things.
    d.measure = elt("div", null, "CodeMirror-measure");
    // When lines outside of the viewport are measured, they are drawn in this.
    d.lineMeasure = elt("div", null, "CodeMirror-measure");
    // Wraps everything that needs to exist inside the vertically-padded coordinate system
    d.lineSpace = elt("div", [d.measure, d.lineMeasure, d.selectionDiv, d.cursorDiv, d.lineDiv],
                      null, "position: relative; outline: none");
    // Moved around its parent to cover visible view.
    d.mover = elt("div", [elt("div", [d.lineSpace], "CodeMirror-lines")], null, "position: relative");
    // Set to the height of the document, allowing scrolling.
    d.sizer = elt("div", [d.mover], "CodeMirror-sizer");
    d.sizerWidth = null;
    // Behavior of elts with overflow: auto and padding is
    // inconsistent across browsers. This is used to ensure the
    // scrollable area is big enough.
    d.heightForcer = elt("div", null, null, "position: absolute; height: " + scrollerGap + "px; width: 1px;");
    // Will contain the gutters, if any.
    d.gutters = elt("div", null, "CodeMirror-gutters");
    d.lineGutter = null;
    // Actual scrollable element.
    d.scroller = elt("div", [d.sizer, d.heightForcer, d.gutters], "CodeMirror-scroll");
    d.scroller.setAttribute("tabIndex", "-1");
    // The element in which the editor lives.
    d.wrapper = elt("div", [d.scrollbarFiller, d.gutterFiller, d.scroller], "CodeMirror");

    // Work around IE7 z-index bug (not perfect, hence IE7 not really being supported)
    if (ie && ie_version < 8) { d.gutters.style.zIndex = -1; d.scroller.style.paddingRight = 0; }
    if (!webkit && !(gecko && mobile)) d.scroller.draggable = true;

    if (place) {
      if (place.appendChild) place.appendChild(d.wrapper);
      else place(d.wrapper);
    }

    // Current rendered range (may be bigger than the view window).
    d.viewFrom = d.viewTo = doc.first;
    d.reportedViewFrom = d.reportedViewTo = doc.first;
    // Information about the rendered lines.
    d.view = [];
    d.renderedView = null;
    // Holds info about a single rendered line when it was rendered
    // for measurement, while not in view.
    d.externalMeasured = null;
    // Empty space (in pixels) above the view
    d.viewOffset = 0;
    d.lastWrapHeight = d.lastWrapWidth = 0;
    d.updateLineNumbers = null;

    d.nativeBarWidth = d.barHeight = d.barWidth = 0;
    d.scrollbarsClipped = false;

    // Used to only resize the line number gutter when necessary (when
    // the amount of lines crosses a boundary that makes its width change)
    d.lineNumWidth = d.lineNumInnerWidth = d.lineNumChars = null;
    // Set to true when a non-horizontal-scrolling line widget is
    // added. As an optimization, line widget aligning is skipped when
    // this is false.
    d.alignWidgets = false;

    d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;

    // Tracks the maximum line length so that the horizontal scrollbar
    // can be kept static when scrolling.
    d.maxLine = null;
    d.maxLineLength = 0;
    d.maxLineChanged = false;

    // Used for measuring wheel scrolling granularity
    d.wheelDX = d.wheelDY = d.wheelStartX = d.wheelStartY = null;

    // True when shift is held down.
    d.shift = false;

    // Used to track whether anything happened since the context menu
    // was opened.
    d.selForContextMenu = null;

    d.activeTouch = null;

    input.init(d);
  }

  // STATE UPDATES

  // Used to get the editor into a consistent state again when options change.

  function loadMode(cm) {
    cm.doc.mode = CodeMirror.getMode(cm.options, cm.doc.modeOption);
    resetModeState(cm);
  }

  function resetModeState(cm) {
    cm.doc.iter(function(line) {
      if (line.stateAfter) line.stateAfter = null;
      if (line.styles) line.styles = null;
    });
    cm.doc.frontier = cm.doc.first;
    startWorker(cm, 100);
    cm.state.modeGen++;
    if (cm.curOp) regChange(cm);
  }

  function wrappingChanged(cm) {
    if (cm.options.lineWrapping) {
      addClass(cm.display.wrapper, "CodeMirror-wrap");
      cm.display.sizer.style.minWidth = "";
      cm.display.sizerWidth = null;
    } else {
      rmClass(cm.display.wrapper, "CodeMirror-wrap");
      findMaxLine(cm);
    }
    estimateLineHeights(cm);
    regChange(cm);
    clearCaches(cm);
    setTimeout(function(){updateScrollbars(cm);}, 100);
  }

  // Returns a function that estimates the height of a line, to use as
  // first approximation until the line becomes visible (and is thus
  // properly measurable).
  function estimateHeight(cm) {
    var th = textHeight(cm.display), wrapping = cm.options.lineWrapping;
    var perLine = wrapping && Math.max(5, cm.display.scroller.clientWidth / charWidth(cm.display) - 3);
    return function(line) {
      if (lineIsHidden(cm.doc, line)) return 0;

      var widgetsHeight = 0;
      if (line.widgets) for (var i = 0; i < line.widgets.length; i++) {
        if (line.widgets[i].height) widgetsHeight += line.widgets[i].height;
      }

      if (wrapping)
        return widgetsHeight + (Math.ceil(line.text.length / perLine) || 1) * th;
      else
        return widgetsHeight + th;
    };
  }

  function estimateLineHeights(cm) {
    var doc = cm.doc, est = estimateHeight(cm);
    doc.iter(function(line) {
      var estHeight = est(line);
      if (estHeight != line.height) updateLineHeight(line, estHeight);
    });
  }

  function themeChanged(cm) {
    cm.display.wrapper.className = cm.display.wrapper.className.replace(/\s*cm-s-\S+/g, "") +
      cm.options.theme.replace(/(^|\s)\s*/g, " cm-s-");
    clearCaches(cm);
  }

  function guttersChanged(cm) {
    updateGutters(cm);
    regChange(cm);
    setTimeout(function(){alignHorizontally(cm);}, 20);
  }

  // Rebuild the gutter elements, ensure the margin to the left of the
  // code matches their width.
  function updateGutters(cm) {
    var gutters = cm.display.gutters, specs = cm.options.gutters;
    removeChildren(gutters);
    for (var i = 0; i < specs.length; ++i) {
      var gutterClass = specs[i];
      var gElt = gutters.appendChild(elt("div", null, "CodeMirror-gutter " + gutterClass));
      if (gutterClass == "CodeMirror-linenumbers") {
        cm.display.lineGutter = gElt;
        gElt.style.width = (cm.display.lineNumWidth || 1) + "px";
      }
    }
    gutters.style.display = i ? "" : "none";
    updateGutterSpace(cm);
  }

  function updateGutterSpace(cm) {
    var width = cm.display.gutters.offsetWidth;
    cm.display.sizer.style.marginLeft = width + "px";
  }

  // Compute the character length of a line, taking into account
  // collapsed ranges (see markText) that might hide parts, and join
  // other lines onto it.
  function lineLength(line) {
    if (line.height == 0) return 0;
    var len = line.text.length, merged, cur = line;
    while (merged = collapsedSpanAtStart(cur)) {
      var found = merged.find(0, true);
      cur = found.from.line;
      len += found.from.ch - found.to.ch;
    }
    cur = line;
    while (merged = collapsedSpanAtEnd(cur)) {
      var found = merged.find(0, true);
      len -= cur.text.length - found.from.ch;
      cur = found.to.line;
      len += cur.text.length - found.to.ch;
    }
    return len;
  }

  // Find the longest line in the document.
  function findMaxLine(cm) {
    var d = cm.display, doc = cm.doc;
    d.maxLine = getLine(doc, doc.first);
    d.maxLineLength = lineLength(d.maxLine);
    d.maxLineChanged = true;
    doc.iter(function(line) {
      var len = lineLength(line);
      if (len > d.maxLineLength) {
        d.maxLineLength = len;
        d.maxLine = line;
      }
    });
  }

  // Make sure the gutters options contains the element
  // "CodeMirror-linenumbers" when the lineNumbers option is true.
  function setGuttersForLineNumbers(options) {
    var found = indexOf(options.gutters, "CodeMirror-linenumbers");
    if (found == -1 && options.lineNumbers) {
      options.gutters = options.gutters.concat(["CodeMirror-linenumbers"]);
    } else if (found > -1 && !options.lineNumbers) {
      options.gutters = options.gutters.slice(0);
      options.gutters.splice(found, 1);
    }
  }

  // SCROLLBARS

  // Prepare DOM reads needed to update the scrollbars. Done in one
  // shot to minimize update/measure roundtrips.
  function measureForScrollbars(cm) {
    var d = cm.display, gutterW = d.gutters.offsetWidth;
    var docH = Math.round(cm.doc.height + paddingVert(cm.display));
    return {
      clientHeight: d.scroller.clientHeight,
      viewHeight: d.wrapper.clientHeight,
      scrollWidth: d.scroller.scrollWidth, clientWidth: d.scroller.clientWidth,
      viewWidth: d.wrapper.clientWidth,
      barLeft: cm.options.fixedGutter ? gutterW : 0,
      docHeight: docH,
      scrollHeight: docH + scrollGap(cm) + d.barHeight,
      nativeBarWidth: d.nativeBarWidth,
      gutterWidth: gutterW
    };
  }

  function NativeScrollbars(place, scroll, cm) {
    this.cm = cm;
    var vert = this.vert = elt("div", [elt("div", null, null, "min-width: 1px")], "CodeMirror-vscrollbar");
    var horiz = this.horiz = elt("div", [elt("div", null, null, "height: 100%; min-height: 1px")], "CodeMirror-hscrollbar");
    place(vert); place(horiz);

    on(vert, "scroll", function() {
      if (vert.clientHeight) scroll(vert.scrollTop, "vertical");
    });
    on(horiz, "scroll", function() {
      if (horiz.clientWidth) scroll(horiz.scrollLeft, "horizontal");
    });

    this.checkedOverlay = false;
    // Need to set a minimum width to see the scrollbar on IE7 (but must not set it on IE8).
    if (ie && ie_version < 8) this.horiz.style.minHeight = this.vert.style.minWidth = "18px";
  }

  NativeScrollbars.prototype = copyObj({
    update: function(measure) {
      var needsH = measure.scrollWidth > measure.clientWidth + 1;
      var needsV = measure.scrollHeight > measure.clientHeight + 1;
      var sWidth = measure.nativeBarWidth;

      if (needsV) {
        this.vert.style.display = "block";
        this.vert.style.bottom = needsH ? sWidth + "px" : "0";
        var totalHeight = measure.viewHeight - (needsH ? sWidth : 0);
        // A bug in IE8 can cause this value to be negative, so guard it.
        this.vert.firstChild.style.height =
          Math.max(0, measure.scrollHeight - measure.clientHeight + totalHeight) + "px";
      } else {
        this.vert.style.display = "";
        this.vert.firstChild.style.height = "0";
      }

      if (needsH) {
        this.horiz.style.display = "block";
        this.horiz.style.right = needsV ? sWidth + "px" : "0";
        this.horiz.style.left = measure.barLeft + "px";
        var totalWidth = measure.viewWidth - measure.barLeft - (needsV ? sWidth : 0);
        this.horiz.firstChild.style.width =
          (measure.scrollWidth - measure.clientWidth + totalWidth) + "px";
      } else {
        this.horiz.style.display = "";
        this.horiz.firstChild.style.width = "0";
      }

      if (!this.checkedOverlay && measure.clientHeight > 0) {
        if (sWidth == 0) this.overlayHack();
        this.checkedOverlay = true;
      }

      return {right: needsV ? sWidth : 0, bottom: needsH ? sWidth : 0};
    },
    setScrollLeft: function(pos) {
      if (this.horiz.scrollLeft != pos) this.horiz.scrollLeft = pos;
    },
    setScrollTop: function(pos) {
      if (this.vert.scrollTop != pos) this.vert.scrollTop = pos;
    },
    overlayHack: function() {
      var w = mac && !mac_geMountainLion ? "12px" : "18px";
      this.horiz.style.minHeight = this.vert.style.minWidth = w;
      var self = this;
      var barMouseDown = function(e) {
        if (e_target(e) != self.vert && e_target(e) != self.horiz)
          operation(self.cm, onMouseDown)(e);
      };
      on(this.vert, "mousedown", barMouseDown);
      on(this.horiz, "mousedown", barMouseDown);
    },
    clear: function() {
      var parent = this.horiz.parentNode;
      parent.removeChild(this.horiz);
      parent.removeChild(this.vert);
    }
  }, NativeScrollbars.prototype);

  function NullScrollbars() {}

  NullScrollbars.prototype = copyObj({
    update: function() { return {bottom: 0, right: 0}; },
    setScrollLeft: function() {},
    setScrollTop: function() {},
    clear: function() {}
  }, NullScrollbars.prototype);

  CodeMirror.scrollbarModel = {"native": NativeScrollbars, "null": NullScrollbars};

  function initScrollbars(cm) {
    if (cm.display.scrollbars) {
      cm.display.scrollbars.clear();
      if (cm.display.scrollbars.addClass)
        rmClass(cm.display.wrapper, cm.display.scrollbars.addClass);
    }

    cm.display.scrollbars = new CodeMirror.scrollbarModel[cm.options.scrollbarStyle](function(node) {
      cm.display.wrapper.insertBefore(node, cm.display.scrollbarFiller);
      // Prevent clicks in the scrollbars from killing focus
      on(node, "mousedown", function() {
        if (cm.state.focused) setTimeout(function() { cm.display.input.focus(); }, 0);
      });
      node.setAttribute("cm-not-content", "true");
    }, function(pos, axis) {
      if (axis == "horizontal") setScrollLeft(cm, pos);
      else setScrollTop(cm, pos);
    }, cm);
    if (cm.display.scrollbars.addClass)
      addClass(cm.display.wrapper, cm.display.scrollbars.addClass);
  }

  function updateScrollbars(cm, measure) {
    if (!measure) measure = measureForScrollbars(cm);
    var startWidth = cm.display.barWidth, startHeight = cm.display.barHeight;
    updateScrollbarsInner(cm, measure);
    for (var i = 0; i < 4 && startWidth != cm.display.barWidth || startHeight != cm.display.barHeight; i++) {
      if (startWidth != cm.display.barWidth && cm.options.lineWrapping)
        updateHeightsInViewport(cm);
      updateScrollbarsInner(cm, measureForScrollbars(cm));
      startWidth = cm.display.barWidth; startHeight = cm.display.barHeight;
    }
  }

  // Re-synchronize the fake scrollbars with the actual size of the
  // content.
  function updateScrollbarsInner(cm, measure) {
    var d = cm.display;
    var sizes = d.scrollbars.update(measure);

    d.sizer.style.paddingRight = (d.barWidth = sizes.right) + "px";
    d.sizer.style.paddingBottom = (d.barHeight = sizes.bottom) + "px";

    if (sizes.right && sizes.bottom) {
      d.scrollbarFiller.style.display = "block";
      d.scrollbarFiller.style.height = sizes.bottom + "px";
      d.scrollbarFiller.style.width = sizes.right + "px";
    } else d.scrollbarFiller.style.display = "";
    if (sizes.bottom && cm.options.coverGutterNextToScrollbar && cm.options.fixedGutter) {
      d.gutterFiller.style.display = "block";
      d.gutterFiller.style.height = sizes.bottom + "px";
      d.gutterFiller.style.width = measure.gutterWidth + "px";
    } else d.gutterFiller.style.display = "";
  }

  // Compute the lines that are visible in a given viewport (defaults
  // the the current scroll position). viewport may contain top,
  // height, and ensure (see op.scrollToPos) properties.
  function visibleLines(display, doc, viewport) {
    var top = viewport && viewport.top != null ? Math.max(0, viewport.top) : display.scroller.scrollTop;
    top = Math.floor(top - paddingTop(display));
    var bottom = viewport && viewport.bottom != null ? viewport.bottom : top + display.wrapper.clientHeight;

    var from = lineAtHeight(doc, top), to = lineAtHeight(doc, bottom);
    // Ensure is a {from: {line, ch}, to: {line, ch}} object, and
    // forces those lines into the viewport (if possible).
    if (viewport && viewport.ensure) {
      var ensureFrom = viewport.ensure.from.line, ensureTo = viewport.ensure.to.line;
      if (ensureFrom < from) {
        from = ensureFrom;
        to = lineAtHeight(doc, heightAtLine(getLine(doc, ensureFrom)) + display.wrapper.clientHeight);
      } else if (Math.min(ensureTo, doc.lastLine()) >= to) {
        from = lineAtHeight(doc, heightAtLine(getLine(doc, ensureTo)) - display.wrapper.clientHeight);
        to = ensureTo;
      }
    }
    return {from: from, to: Math.max(to, from + 1)};
  }

  // LINE NUMBERS

  // Re-align line numbers and gutter marks to compensate for
  // horizontal scrolling.
  function alignHorizontally(cm) {
    var display = cm.display, view = display.view;
    if (!display.alignWidgets && (!display.gutters.firstChild || !cm.options.fixedGutter)) return;
    var comp = compensateForHScroll(display) - display.scroller.scrollLeft + cm.doc.scrollLeft;
    var gutterW = display.gutters.offsetWidth, left = comp + "px";
    for (var i = 0; i < view.length; i++) if (!view[i].hidden) {
      if (cm.options.fixedGutter && view[i].gutter)
        view[i].gutter.style.left = left;
      var align = view[i].alignable;
      if (align) for (var j = 0; j < align.length; j++)
        align[j].style.left = left;
    }
    if (cm.options.fixedGutter)
      display.gutters.style.left = (comp + gutterW) + "px";
  }

  // Used to ensure that the line number gutter is still the right
  // size for the current document size. Returns true when an update
  // is needed.
  function maybeUpdateLineNumberWidth(cm) {
    if (!cm.options.lineNumbers) return false;
    var doc = cm.doc, last = lineNumberFor(cm.options, doc.first + doc.size - 1), display = cm.display;
    if (last.length != display.lineNumChars) {
      var test = display.measure.appendChild(elt("div", [elt("div", last)],
                                                 "CodeMirror-linenumber CodeMirror-gutter-elt"));
      var innerW = test.firstChild.offsetWidth, padding = test.offsetWidth - innerW;
      display.lineGutter.style.width = "";
      display.lineNumInnerWidth = Math.max(innerW, display.lineGutter.offsetWidth - padding) + 1;
      display.lineNumWidth = display.lineNumInnerWidth + padding;
      display.lineNumChars = display.lineNumInnerWidth ? last.length : -1;
      display.lineGutter.style.width = display.lineNumWidth + "px";
      updateGutterSpace(cm);
      return true;
    }
    return false;
  }

  function lineNumberFor(options, i) {
    return String(options.lineNumberFormatter(i + options.firstLineNumber));
  }

  // Computes display.scroller.scrollLeft + display.gutters.offsetWidth,
  // but using getBoundingClientRect to get a sub-pixel-accurate
  // result.
  function compensateForHScroll(display) {
    return display.scroller.getBoundingClientRect().left - display.sizer.getBoundingClientRect().left;
  }

  // DISPLAY DRAWING

  function DisplayUpdate(cm, viewport, force) {
    var display = cm.display;

    this.viewport = viewport;
    // Store some values that we'll need later (but don't want to force a relayout for)
    this.visible = visibleLines(display, cm.doc, viewport);
    this.editorIsHidden = !display.wrapper.offsetWidth;
    this.wrapperHeight = display.wrapper.clientHeight;
    this.wrapperWidth = display.wrapper.clientWidth;
    this.oldDisplayWidth = displayWidth(cm);
    this.force = force;
    this.dims = getDimensions(cm);
    this.events = [];
  }

  DisplayUpdate.prototype.signal = function(emitter, type) {
    if (hasHandler(emitter, type))
      this.events.push(arguments);
  };
  DisplayUpdate.prototype.finish = function() {
    for (var i = 0; i < this.events.length; i++)
      signal.apply(null, this.events[i]);
  };

  function maybeClipScrollbars(cm) {
    var display = cm.display;
    if (!display.scrollbarsClipped && display.scroller.offsetWidth) {
      display.nativeBarWidth = display.scroller.offsetWidth - display.scroller.clientWidth;
      display.heightForcer.style.height = scrollGap(cm) + "px";
      display.sizer.style.marginBottom = -display.nativeBarWidth + "px";
      display.sizer.style.borderRightWidth = scrollGap(cm) + "px";
      display.scrollbarsClipped = true;
    }
  }

  // Does the actual updating of the line display. Bails out
  // (returning false) when there is nothing to be done and forced is
  // false.
  function updateDisplayIfNeeded(cm, update) {
    var display = cm.display, doc = cm.doc;

    if (update.editorIsHidden) {
      resetView(cm);
      return false;
    }

    // Bail out if the visible area is already rendered and nothing changed.
    if (!update.force &&
        update.visible.from >= display.viewFrom && update.visible.to <= display.viewTo &&
        (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo) &&
        display.renderedView == display.view && countDirtyView(cm) == 0)
      return false;

    if (maybeUpdateLineNumberWidth(cm)) {
      resetView(cm);
      update.dims = getDimensions(cm);
    }

    // Compute a suitable new viewport (from & to)
    var end = doc.first + doc.size;
    var from = Math.max(update.visible.from - cm.options.viewportMargin, doc.first);
    var to = Math.min(end, update.visible.to + cm.options.viewportMargin);
    if (display.viewFrom < from && from - display.viewFrom < 20) from = Math.max(doc.first, display.viewFrom);
    if (display.viewTo > to && display.viewTo - to < 20) to = Math.min(end, display.viewTo);
    if (sawCollapsedSpans) {
      from = visualLineNo(cm.doc, from);
      to = visualLineEndNo(cm.doc, to);
    }

    var different = from != display.viewFrom || to != display.viewTo ||
      display.lastWrapHeight != update.wrapperHeight || display.lastWrapWidth != update.wrapperWidth;
    adjustView(cm, from, to);

    display.viewOffset = heightAtLine(getLine(cm.doc, display.viewFrom));
    // Position the mover div to align with the current scroll position
    cm.display.mover.style.top = display.viewOffset + "px";

    var toUpdate = countDirtyView(cm);
    if (!different && toUpdate == 0 && !update.force && display.renderedView == display.view &&
        (display.updateLineNumbers == null || display.updateLineNumbers >= display.viewTo))
      return false;

    // For big changes, we hide the enclosing element during the
    // update, since that speeds up the operations on most browsers.
    var focused = activeElt();
    if (toUpdate > 4) display.lineDiv.style.display = "none";
    patchDisplay(cm, display.updateLineNumbers, update.dims);
    if (toUpdate > 4) display.lineDiv.style.display = "";
    display.renderedView = display.view;
    // There might have been a widget with a focused element that got
    // hidden or updated, if so re-focus it.
    if (focused && activeElt() != focused && focused.offsetHeight) focused.focus();

    // Prevent selection and cursors from interfering with the scroll
    // width and height.
    removeChildren(display.cursorDiv);
    removeChildren(display.selectionDiv);
    display.gutters.style.height = display.sizer.style.minHeight = 0;

    if (different) {
      display.lastWrapHeight = update.wrapperHeight;
      display.lastWrapWidth = update.wrapperWidth;
      startWorker(cm, 400);
    }

    display.updateLineNumbers = null;

    return true;
  }

  function postUpdateDisplay(cm, update) {
    var viewport = update.viewport;
    for (var first = true;; first = false) {
      if (!first || !cm.options.lineWrapping || update.oldDisplayWidth == displayWidth(cm)) {
        // Clip forced viewport to actual scrollable area.
        if (viewport && viewport.top != null)
          viewport = {top: Math.min(cm.doc.height + paddingVert(cm.display) - displayHeight(cm), viewport.top)};
        // Updated line heights might result in the drawn area not
        // actually covering the viewport. Keep looping until it does.
        update.visible = visibleLines(cm.display, cm.doc, viewport);
        if (update.visible.from >= cm.display.viewFrom && update.visible.to <= cm.display.viewTo)
          break;
      }
      if (!updateDisplayIfNeeded(cm, update)) break;
      updateHeightsInViewport(cm);
      var barMeasure = measureForScrollbars(cm);
      updateSelection(cm);
      setDocumentHeight(cm, barMeasure);
      updateScrollbars(cm, barMeasure);
    }

    update.signal(cm, "update", cm);
    if (cm.display.viewFrom != cm.display.reportedViewFrom || cm.display.viewTo != cm.display.reportedViewTo) {
      update.signal(cm, "viewportChange", cm, cm.display.viewFrom, cm.display.viewTo);
      cm.display.reportedViewFrom = cm.display.viewFrom; cm.display.reportedViewTo = cm.display.viewTo;
    }
  }

  function updateDisplaySimple(cm, viewport) {
    var update = new DisplayUpdate(cm, viewport);
    if (updateDisplayIfNeeded(cm, update)) {
      updateHeightsInViewport(cm);
      postUpdateDisplay(cm, update);
      var barMeasure = measureForScrollbars(cm);
      updateSelection(cm);
      setDocumentHeight(cm, barMeasure);
      updateScrollbars(cm, barMeasure);
      update.finish();
    }
  }

  function setDocumentHeight(cm, measure) {
    cm.display.sizer.style.minHeight = measure.docHeight + "px";
    var total = measure.docHeight + cm.display.barHeight;
    cm.display.heightForcer.style.top = total + "px";
    cm.display.gutters.style.height = Math.max(total + scrollGap(cm), measure.clientHeight) + "px";
  }

  // Read the actual heights of the rendered lines, and update their
  // stored heights to match.
  function updateHeightsInViewport(cm) {
    var display = cm.display;
    var prevBottom = display.lineDiv.offsetTop;
    for (var i = 0; i < display.view.length; i++) {
      var cur = display.view[i], height;
      if (cur.hidden) continue;
      if (ie && ie_version < 8) {
        var bot = cur.node.offsetTop + cur.node.offsetHeight;
        height = bot - prevBottom;
        prevBottom = bot;
      } else {
        var box = cur.node.getBoundingClientRect();
        height = box.bottom - box.top;
      }
      var diff = cur.line.height - height;
      if (height < 2) height = textHeight(display);
      if (diff > .001 || diff < -.001) {
        updateLineHeight(cur.line, height);
        updateWidgetHeight(cur.line);
        if (cur.rest) for (var j = 0; j < cur.rest.length; j++)
          updateWidgetHeight(cur.rest[j]);
      }
    }
  }

  // Read and store the height of line widgets associated with the
  // given line.
  function updateWidgetHeight(line) {
    if (line.widgets) for (var i = 0; i < line.widgets.length; ++i)
      line.widgets[i].height = line.widgets[i].node.offsetHeight;
  }

  // Do a bulk-read of the DOM positions and sizes needed to draw the
  // view, so that we don't interleave reading and writing to the DOM.
  function getDimensions(cm) {
    var d = cm.display, left = {}, width = {};
    var gutterLeft = d.gutters.clientLeft;
    for (var n = d.gutters.firstChild, i = 0; n; n = n.nextSibling, ++i) {
      left[cm.options.gutters[i]] = n.offsetLeft + n.clientLeft + gutterLeft;
      width[cm.options.gutters[i]] = n.clientWidth;
    }
    return {fixedPos: compensateForHScroll(d),
            gutterTotalWidth: d.gutters.offsetWidth,
            gutterLeft: left,
            gutterWidth: width,
            wrapperWidth: d.wrapper.clientWidth};
  }

  // Sync the actual display DOM structure with display.view, removing
  // nodes for lines that are no longer in view, and creating the ones
  // that are not there yet, and updating the ones that are out of
  // date.
  function patchDisplay(cm, updateNumbersFrom, dims) {
    var display = cm.display, lineNumbers = cm.options.lineNumbers;
    var container = display.lineDiv, cur = container.firstChild;

    function rm(node) {
      var next = node.nextSibling;
      // Works around a throw-scroll bug in OS X Webkit
      if (webkit && mac && cm.display.currentWheelTarget == node)
        node.style.display = "none";
      else
        node.parentNode.removeChild(node);
      return next;
    }

    var view = display.view, lineN = display.viewFrom;
    // Loop over the elements in the view, syncing cur (the DOM nodes
    // in display.lineDiv) with the view as we go.
    for (var i = 0; i < view.length; i++) {
      var lineView = view[i];
      if (lineView.hidden) {
      } else if (!lineView.node || lineView.node.parentNode != container) { // Not drawn yet
        var node = buildLineElement(cm, lineView, lineN, dims);
        container.insertBefore(node, cur);
      } else { // Already drawn
        while (cur != lineView.node) cur = rm(cur);
        var updateNumber = lineNumbers && updateNumbersFrom != null &&
          updateNumbersFrom <= lineN && lineView.lineNumber;
        if (lineView.changes) {
          if (indexOf(lineView.changes, "gutter") > -1) updateNumber = false;
          updateLineForChanges(cm, lineView, lineN, dims);
        }
        if (updateNumber) {
          removeChildren(lineView.lineNumber);
          lineView.lineNumber.appendChild(document.createTextNode(lineNumberFor(cm.options, lineN)));
        }
        cur = lineView.node.nextSibling;
      }
      lineN += lineView.size;
    }
    while (cur) cur = rm(cur);
  }

  // When an aspect of a line changes, a string is added to
  // lineView.changes. This updates the relevant part of the line's
  // DOM structure.
  function updateLineForChanges(cm, lineView, lineN, dims) {
    for (var j = 0; j < lineView.changes.length; j++) {
      var type = lineView.changes[j];
      if (type == "text") updateLineText(cm, lineView);
      else if (type == "gutter") updateLineGutter(cm, lineView, lineN, dims);
      else if (type == "class") updateLineClasses(lineView);
      else if (type == "widget") updateLineWidgets(cm, lineView, dims);
    }
    lineView.changes = null;
  }

  // Lines with gutter elements, widgets or a background class need to
  // be wrapped, and have the extra elements added to the wrapper div
  function ensureLineWrapped(lineView) {
    if (lineView.node == lineView.text) {
      lineView.node = elt("div", null, null, "position: relative");
      if (lineView.text.parentNode)
        lineView.text.parentNode.replaceChild(lineView.node, lineView.text);
      lineView.node.appendChild(lineView.text);
      if (ie && ie_version < 8) lineView.node.style.zIndex = 2;
    }
    return lineView.node;
  }

  function updateLineBackground(lineView) {
    var cls = lineView.bgClass ? lineView.bgClass + " " + (lineView.line.bgClass || "") : lineView.line.bgClass;
    if (cls) cls += " CodeMirror-linebackground";
    if (lineView.background) {
      if (cls) lineView.background.className = cls;
      else { lineView.background.parentNode.removeChild(lineView.background); lineView.background = null; }
    } else if (cls) {
      var wrap = ensureLineWrapped(lineView);
      lineView.background = wrap.insertBefore(elt("div", null, cls), wrap.firstChild);
    }
  }

  // Wrapper around buildLineContent which will reuse the structure
  // in display.externalMeasured when possible.
  function getLineContent(cm, lineView) {
    var ext = cm.display.externalMeasured;
    if (ext && ext.line == lineView.line) {
      cm.display.externalMeasured = null;
      lineView.measure = ext.measure;
      return ext.built;
    }
    return buildLineContent(cm, lineView);
  }

  // Redraw the line's text. Interacts with the background and text
  // classes because the mode may output tokens that influence these
  // classes.
  function updateLineText(cm, lineView) {
    var cls = lineView.text.className;
    var built = getLineContent(cm, lineView);
    if (lineView.text == lineView.node) lineView.node = built.pre;
    lineView.text.parentNode.replaceChild(built.pre, lineView.text);
    lineView.text = built.pre;
    if (built.bgClass != lineView.bgClass || built.textClass != lineView.textClass) {
      lineView.bgClass = built.bgClass;
      lineView.textClass = built.textClass;
      updateLineClasses(lineView);
    } else if (cls) {
      lineView.text.className = cls;
    }
  }

  function updateLineClasses(lineView) {
    updateLineBackground(lineView);
    if (lineView.line.wrapClass)
      ensureLineWrapped(lineView).className = lineView.line.wrapClass;
    else if (lineView.node != lineView.text)
      lineView.node.className = "";
    var textClass = lineView.textClass ? lineView.textClass + " " + (lineView.line.textClass || "") : lineView.line.textClass;
    lineView.text.className = textClass || "";
  }

  function updateLineGutter(cm, lineView, lineN, dims) {
    if (lineView.gutter) {
      lineView.node.removeChild(lineView.gutter);
      lineView.gutter = null;
    }
    if (lineView.gutterBackground) {
      lineView.node.removeChild(lineView.gutterBackground);
      lineView.gutterBackground = null;
    }
    if (lineView.line.gutterClass) {
      var wrap = ensureLineWrapped(lineView);
      lineView.gutterBackground = elt("div", null, "CodeMirror-gutter-background " + lineView.line.gutterClass,
                                      "left: " + (cm.options.fixedGutter ? dims.fixedPos : -dims.gutterTotalWidth) +
                                      "px; width: " + dims.gutterTotalWidth + "px");
      wrap.insertBefore(lineView.gutterBackground, lineView.text);
    }
    var markers = lineView.line.gutterMarkers;
    if (cm.options.lineNumbers || markers) {
      var wrap = ensureLineWrapped(lineView);
      var gutterWrap = lineView.gutter = elt("div", null, "CodeMirror-gutter-wrapper", "left: " +
                                             (cm.options.fixedGutter ? dims.fixedPos : -dims.gutterTotalWidth) + "px");
      cm.display.input.setUneditable(gutterWrap);
      wrap.insertBefore(gutterWrap, lineView.text);
      if (lineView.line.gutterClass)
        gutterWrap.className += " " + lineView.line.gutterClass;
      if (cm.options.lineNumbers && (!markers || !markers["CodeMirror-linenumbers"]))
        lineView.lineNumber = gutterWrap.appendChild(
          elt("div", lineNumberFor(cm.options, lineN),
              "CodeMirror-linenumber CodeMirror-gutter-elt",
              "left: " + dims.gutterLeft["CodeMirror-linenumbers"] + "px; width: "
              + cm.display.lineNumInnerWidth + "px"));
      if (markers) for (var k = 0; k < cm.options.gutters.length; ++k) {
        var id = cm.options.gutters[k], found = markers.hasOwnProperty(id) && markers[id];
        if (found)
          gutterWrap.appendChild(elt("div", [found], "CodeMirror-gutter-elt", "left: " +
                                     dims.gutterLeft[id] + "px; width: " + dims.gutterWidth[id] + "px"));
      }
    }
  }

  function updateLineWidgets(cm, lineView, dims) {
    if (lineView.alignable) lineView.alignable = null;
    for (var node = lineView.node.firstChild, next; node; node = next) {
      var next = node.nextSibling;
      if (node.className == "CodeMirror-linewidget")
        lineView.node.removeChild(node);
    }
    insertLineWidgets(cm, lineView, dims);
  }

  // Build a line's DOM representation from scratch
  function buildLineElement(cm, lineView, lineN, dims) {
    var built = getLineContent(cm, lineView);
    lineView.text = lineView.node = built.pre;
    if (built.bgClass) lineView.bgClass = built.bgClass;
    if (built.textClass) lineView.textClass = built.textClass;

    updateLineClasses(lineView);
    updateLineGutter(cm, lineView, lineN, dims);
    insertLineWidgets(cm, lineView, dims);
    return lineView.node;
  }

  // A lineView may contain multiple logical lines (when merged by
  // collapsed spans). The widgets for all of them need to be drawn.
  function insertLineWidgets(cm, lineView, dims) {
    insertLineWidgetsFor(cm, lineView.line, lineView, dims, true);
    if (lineView.rest) for (var i = 0; i < lineView.rest.length; i++)
      insertLineWidgetsFor(cm, lineView.rest[i], lineView, dims, false);
  }

  function insertLineWidgetsFor(cm, line, lineView, dims, allowAbove) {
    if (!line.widgets) return;
    var wrap = ensureLineWrapped(lineView);
    for (var i = 0, ws = line.widgets; i < ws.length; ++i) {
      var widget = ws[i], node = elt("div", [widget.node], "CodeMirror-linewidget");
      if (!widget.handleMouseEvents) node.setAttribute("cm-ignore-events", "true");
      positionLineWidget(widget, node, lineView, dims);
      cm.display.input.setUneditable(node);
      if (allowAbove && widget.above)
        wrap.insertBefore(node, lineView.gutter || lineView.text);
      else
        wrap.appendChild(node);
      signalLater(widget, "redraw");
    }
  }

  function positionLineWidget(widget, node, lineView, dims) {
    if (widget.noHScroll) {
      (lineView.alignable || (lineView.alignable = [])).push(node);
      var width = dims.wrapperWidth;
      node.style.left = dims.fixedPos + "px";
      if (!widget.coverGutter) {
        width -= dims.gutterTotalWidth;
        node.style.paddingLeft = dims.gutterTotalWidth + "px";
      }
      node.style.width = width + "px";
    }
    if (widget.coverGutter) {
      node.style.zIndex = 5;
      node.style.position = "relative";
      if (!widget.noHScroll) node.style.marginLeft = -dims.gutterTotalWidth + "px";
    }
  }

  // POSITION OBJECT

  // A Pos instance represents a position within the text.
  var Pos = CodeMirror.Pos = function(line, ch) {
    if (!(this instanceof Pos)) return new Pos(line, ch);
    this.line = line; this.ch = ch;
  };

  // Compare two positions, return 0 if they are the same, a negative
  // number when a is less, and a positive number otherwise.
  var cmp = CodeMirror.cmpPos = function(a, b) { return a.line - b.line || a.ch - b.ch; };

  function copyPos(x) {return Pos(x.line, x.ch);}
  function maxPos(a, b) { return cmp(a, b) < 0 ? b : a; }
  function minPos(a, b) { return cmp(a, b) < 0 ? a : b; }

  // INPUT HANDLING

  function ensureFocus(cm) {
    if (!cm.state.focused) { cm.display.input.focus(); onFocus(cm); }
  }

  function isReadOnly(cm) {
    return cm.options.readOnly || cm.doc.cantEdit;
  }

  // This will be set to an array of strings when copying, so that,
  // when pasting, we know what kind of selections the copied text
  // was made out of.
  var lastCopied = null;

  function applyTextInput(cm, inserted, deleted, sel, origin) {
    var doc = cm.doc;
    cm.display.shift = false;
    if (!sel) sel = doc.sel;

    var paste = cm.state.pasteIncoming || origin == "paste";
    var textLines = doc.splitLines(inserted), multiPaste = null;
    // When pasing N lines into N selections, insert one line per selection
    if (paste && sel.ranges.length > 1) {
      if (lastCopied && lastCopied.join("\n") == inserted) {
        if (sel.ranges.length % lastCopied.length == 0) {
          multiPaste = [];
          for (var i = 0; i < lastCopied.length; i++)
            multiPaste.push(doc.splitLines(lastCopied[i]));
        }
      } else if (textLines.length == sel.ranges.length) {
        multiPaste = map(textLines, function(l) { return [l]; });
      }
    }

    // Normal behavior is to insert the new text into every selection
    for (var i = sel.ranges.length - 1; i >= 0; i--) {
      var range = sel.ranges[i];
      var from = range.from(), to = range.to();
      if (range.empty()) {
        if (deleted && deleted > 0) // Handle deletion
          from = Pos(from.line, from.ch - deleted);
        else if (cm.state.overwrite && !paste) // Handle overwrite
          to = Pos(to.line, Math.min(getLine(doc, to.line).text.length, to.ch + lst(textLines).length));
      }
      var updateInput = cm.curOp.updateInput;
      var changeEvent = {from: from, to: to, text: multiPaste ? multiPaste[i % multiPaste.length] : textLines,
                         origin: origin || (paste ? "paste" : cm.state.cutIncoming ? "cut" : "+input")};
      makeChange(cm.doc, changeEvent);
      signalLater(cm, "inputRead", cm, changeEvent);
    }
    if (inserted && !paste)
      triggerElectric(cm, inserted);

    ensureCursorVisible(cm);
    cm.curOp.updateInput = updateInput;
    cm.curOp.typing = true;
    cm.state.pasteIncoming = cm.state.cutIncoming = false;
  }

  function handlePaste(e, cm) {
    var pasted = e.clipboardData && e.clipboardData.getData("text/plain");
    if (pasted) {
      e.preventDefault();
      if (!isReadOnly(cm) && !cm.options.disableInput)
        runInOp(cm, function() { applyTextInput(cm, pasted, 0, null, "paste"); });
      return true;
    }
  }

  function triggerElectric(cm, inserted) {
    // When an 'electric' character is inserted, immediately trigger a reindent
    if (!cm.options.electricChars || !cm.options.smartIndent) return;
    var sel = cm.doc.sel;

    for (var i = sel.ranges.length - 1; i >= 0; i--) {
      var range = sel.ranges[i];
      if (range.head.ch > 100 || (i && sel.ranges[i - 1].head.line == range.head.line)) continue;
      var mode = cm.getModeAt(range.head);
      var indented = false;
      if (mode.electricChars) {
        for (var j = 0; j < mode.electricChars.length; j++)
          if (inserted.indexOf(mode.electricChars.charAt(j)) > -1) {
            indented = indentLine(cm, range.head.line, "smart");
            break;
          }
      } else if (mode.electricInput) {
        if (mode.electricInput.test(getLine(cm.doc, range.head.line).text.slice(0, range.head.ch)))
          indented = indentLine(cm, range.head.line, "smart");
      }
      if (indented) signalLater(cm, "electricInput", cm, range.head.line);
    }
  }

  function copyableRanges(cm) {
    var text = [], ranges = [];
    for (var i = 0; i < cm.doc.sel.ranges.length; i++) {
      var line = cm.doc.sel.ranges[i].head.line;
      var lineRange = {anchor: Pos(line, 0), head: Pos(line + 1, 0)};
      ranges.push(lineRange);
      text.push(cm.getRange(lineRange.anchor, lineRange.head));
    }
    return {text: text, ranges: ranges};
  }

  function disableBrowserMagic(field) {
    field.setAttribute("autocorrect", "off");
    field.setAttribute("autocapitalize", "off");
    field.setAttribute("spellcheck", "false");
  }

  // TEXTAREA INPUT STYLE

  function TextareaInput(cm) {
    this.cm = cm;
    // See input.poll and input.reset
    this.prevInput = "";

    // Flag that indicates whether we expect input to appear real soon
    // now (after some event like 'keypress' or 'input') and are
    // polling intensively.
    this.pollingFast = false;
    // Self-resetting timeout for the poller
    this.polling = new Delayed();
    // Tracks when input.reset has punted to just putting a short
    // string into the textarea instead of the full selection.
    this.inaccurateSelection = false;
    // Used to work around IE issue with selection being forgotten when focus moves away from textarea
    this.hasSelection = false;
    this.composing = null;
  };

  function hiddenTextarea() {
    var te = elt("textarea", null, null, "position: absolute; padding: 0; width: 1px; height: 1em; outline: none");
    var div = elt("div", [te], null, "overflow: hidden; position: relative; width: 3px; height: 0px;");
    // The textarea is kept positioned near the cursor to prevent the
    // fact that it'll be scrolled into view on input from scrolling
    // our fake cursor out of view. On webkit, when wrap=off, paste is
    // very slow. So make the area wide instead.
    if (webkit) te.style.width = "1000px";
    else te.setAttribute("wrap", "off");
    // If border: 0; -- iOS fails to open keyboard (issue #1287)
    if (ios) te.style.border = "1px solid black";
    disableBrowserMagic(te);
    return div;
  }

  TextareaInput.prototype = copyObj({
    init: function(display) {
      var input = this, cm = this.cm;

      // Wraps and hides input textarea
      var div = this.wrapper = hiddenTextarea();
      // The semihidden textarea that is focused when the editor is
      // focused, and receives input.
      var te = this.textarea = div.firstChild;
      display.wrapper.insertBefore(div, display.wrapper.firstChild);

      // Needed to hide big blue blinking cursor on Mobile Safari (doesn't seem to work in iOS 8 anymore)
      if (ios) te.style.width = "0px";

      on(te, "input", function() {
        if (ie && ie_version >= 9 && input.hasSelection) input.hasSelection = null;
        input.poll();
      });

      on(te, "paste", function(e) {
        if (handlePaste(e, cm)) return true;

        cm.state.pasteIncoming = true;
        input.fastPoll();
      });

      function prepareCopyCut(e) {
        if (cm.somethingSelected()) {
          lastCopied = cm.getSelections();
          if (input.inaccurateSelection) {
            input.prevInput = "";
            input.inaccurateSelection = false;
            te.value = lastCopied.join("\n");
            selectInput(te);
          }
        } else if (!cm.options.lineWiseCopyCut) {
          return;
        } else {
          var ranges = copyableRanges(cm);
          lastCopied = ranges.text;
          if (e.type == "cut") {
            cm.setSelections(ranges.ranges, null, sel_dontScroll);
          } else {
            input.prevInput = "";
            te.value = ranges.text.join("\n");
            selectInput(te);
          }
        }
        if (e.type == "cut") cm.state.cutIncoming = true;
      }
      on(te, "cut", prepareCopyCut);
      on(te, "copy", prepareCopyCut);

      on(display.scroller, "paste", function(e) {
        if (eventInWidget(display, e)) return;
        cm.state.pasteIncoming = true;
        input.focus();
      });

      // Prevent normal selection in the editor (we handle our own)
      on(display.lineSpace, "selectstart", function(e) {
        if (!eventInWidget(display, e)) e_preventDefault(e);
      });

      on(te, "compositionstart", function() {
        var start = cm.getCursor("from");
        if (input.composing) input.composing.range.clear()
        input.composing = {
          start: start,
          range: cm.markText(start, cm.getCursor("to"), {className: "CodeMirror-composing"})
        };
      });
      on(te, "compositionend", function() {
        if (input.composing) {
          input.poll();
          input.composing.range.clear();
          input.composing = null;
        }
      });
    },

    prepareSelection: function() {
      // Redraw the selection and/or cursor
      var cm = this.cm, display = cm.display, doc = cm.doc;
      var result = prepareSelection(cm);

      // Move the hidden textarea near the cursor to prevent scrolling artifacts
      if (cm.options.moveInputWithCursor) {
        var headPos = cursorCoords(cm, doc.sel.primary().head, "div");
        var wrapOff = display.wrapper.getBoundingClientRect(), lineOff = display.lineDiv.getBoundingClientRect();
        result.teTop = Math.max(0, Math.min(display.wrapper.clientHeight - 10,
                                            headPos.top + lineOff.top - wrapOff.top));
        result.teLeft = Math.max(0, Math.min(display.wrapper.clientWidth - 10,
                                             headPos.left + lineOff.left - wrapOff.left));
      }

      return result;
    },

    showSelection: function(drawn) {
      var cm = this.cm, display = cm.display;
      removeChildrenAndAdd(display.cursorDiv, drawn.cursors);
      removeChildrenAndAdd(display.selectionDiv, drawn.selection);
      if (drawn.teTop != null) {
        this.wrapper.style.top = drawn.teTop + "px";
        this.wrapper.style.left = drawn.teLeft + "px";
      }
    },

    // Reset the input to correspond to the selection (or to be empty,
    // when not typing and nothing is selected)
    reset: function(typing) {
      if (this.contextMenuPending) return;
      var minimal, selected, cm = this.cm, doc = cm.doc;
      if (cm.somethingSelected()) {
        this.prevInput = "";
        var range = doc.sel.primary();
        minimal = hasCopyEvent &&
          (range.to().line - range.from().line > 100 || (selected = cm.getSelection()).length > 1000);
        var content = minimal ? "-" : selected || cm.getSelection();
        this.textarea.value = content;
        if (cm.state.focused) selectInput(this.textarea);
        if (ie && ie_version >= 9) this.hasSelection = content;
      } else if (!typing) {
        this.prevInput = this.textarea.value = "";
        if (ie && ie_version >= 9) this.hasSelection = null;
      }
      this.inaccurateSelection = minimal;
    },

    getField: function() { return this.textarea; },

    supportsTouch: function() { return false; },

    focus: function() {
      if (this.cm.options.readOnly != "nocursor" && (!mobile || activeElt() != this.textarea)) {
        try { this.textarea.focus(); }
        catch (e) {} // IE8 will throw if the textarea is display: none or not in DOM
      }
    },

    blur: function() { this.textarea.blur(); },

    resetPosition: function() {
      this.wrapper.style.top = this.wrapper.style.left = 0;
    },

    receivedFocus: function() { this.slowPoll(); },

    // Poll for input changes, using the normal rate of polling. This
    // runs as long as the editor is focused.
    slowPoll: function() {
      var input = this;
      if (input.pollingFast) return;
      input.polling.set(this.cm.options.pollInterval, function() {
        input.poll();
        if (input.cm.state.focused) input.slowPoll();
      });
    },

    // When an event has just come in that is likely to add or change
    // something in the input textarea, we poll faster, to ensure that
    // the change appears on the screen quickly.
    fastPoll: function() {
      var missed = false, input = this;
      input.pollingFast = true;
      function p() {
        var changed = input.poll();
        if (!changed && !missed) {missed = true; input.polling.set(60, p);}
        else {input.pollingFast = false; input.slowPoll();}
      }
      input.polling.set(20, p);
    },

    // Read input from the textarea, and update the document to match.
    // When something is selected, it is present in the textarea, and
    // selected (unless it is huge, in which case a placeholder is
    // used). When nothing is selected, the cursor sits after previously
    // seen text (can be empty), which is stored in prevInput (we must
    // not reset the textarea when typing, because that breaks IME).
    poll: function() {
      var cm = this.cm, input = this.textarea, prevInput = this.prevInput;
      // Since this is called a *lot*, try to bail out as cheaply as
      // possible when it is clear that nothing happened. hasSelection
      // will be the case when there is a lot of text in the textarea,
      // in which case reading its value would be expensive.
      if (this.contextMenuPending || !cm.state.focused ||
          (hasSelection(input) && !prevInput && !this.composing) ||
          isReadOnly(cm) || cm.options.disableInput || cm.state.keySeq)
        return false;

      var text = input.value;
      // If nothing changed, bail.
      if (text == prevInput && !cm.somethingSelected()) return false;
      // Work around nonsensical selection resetting in IE9/10, and
      // inexplicable appearance of private area unicode characters on
      // some key combos in Mac (#2689).
      if (ie && ie_version >= 9 && this.hasSelection === text ||
          mac && /[\uf700-\uf7ff]/.test(text)) {
        cm.display.input.reset();
        return false;
      }

      if (cm.doc.sel == cm.display.selForContextMenu) {
        var first = text.charCodeAt(0);
        if (first == 0x200b && !prevInput) prevInput = "\u200b";
        if (first == 0x21da) { this.reset(); return this.cm.execCommand("undo"); }
      }
      // Find the part of the input that is actually new
      var same = 0, l = Math.min(prevInput.length, text.length);
      while (same < l && prevInput.charCodeAt(same) == text.charCodeAt(same)) ++same;

      var self = this;
      runInOp(cm, function() {
        applyTextInput(cm, text.slice(same), prevInput.length - same,
                       null, self.composing ? "*compose" : null);

        // Don't leave long text in the textarea, since it makes further polling slow
        if (text.length > 1000 || text.indexOf("\n") > -1) input.value = self.prevInput = "";
        else self.prevInput = text;

        if (self.composing) {
          self.composing.range.clear();
          self.composing.range = cm.markText(self.composing.start, cm.getCursor("to"),
                                             {className: "CodeMirror-composing"});
        }
      });
      return true;
    },

    ensurePolled: function() {
      if (this.pollingFast && this.poll()) this.pollingFast = false;
    },

    onKeyPress: function() {
      if (ie && ie_version >= 9) this.hasSelection = null;
      this.fastPoll();
    },

    onContextMenu: function(e) {
      var input = this, cm = input.cm, display = cm.display, te = input.textarea;
      var pos = posFromMouse(cm, e), scrollPos = display.scroller.scrollTop;
      if (!pos || presto) return; // Opera is difficult.

      // Reset the current text selection only if the click is done outside of the selection
      // and 'resetSelectionOnContextMenu' option is true.
      var reset = cm.options.resetSelectionOnContextMenu;
      if (reset && cm.doc.sel.contains(pos) == -1)
        operation(cm, setSelection)(cm.doc, simpleSelection(pos), sel_dontScroll);

      var oldCSS = te.style.cssText;
      input.wrapper.style.position = "absolute";
      te.style.cssText = "position: fixed; width: 30px; height: 30px; top: " + (e.clientY - 5) +
        "px; left: " + (e.clientX - 5) + "px; z-index: 1000; background: " +
        (ie ? "rgba(255, 255, 255, .05)" : "transparent") +
        "; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";
      if (webkit) var oldScrollY = window.scrollY; // Work around Chrome issue (#2712)
      display.input.focus();
      if (webkit) window.scrollTo(null, oldScrollY);
      display.input.reset();
      // Adds "Select all" to context menu in FF
      if (!cm.somethingSelected()) te.value = input.prevInput = " ";
      input.contextMenuPending = true;
      display.selForContextMenu = cm.doc.sel;
      clearTimeout(display.detectingSelectAll);

      // Select-all will be greyed out if there's nothing to select, so
      // this adds a zero-width space so that we can later check whether
      // it got selected.
      function prepareSelectAllHack() {
        if (te.selectionStart != null) {
          var selected = cm.somethingSelected();
          var extval = "\u200b" + (selected ? te.value : "");
          te.value = "\u21da"; // Used to catch context-menu undo
          te.value = extval;
          input.prevInput = selected ? "" : "\u200b";
          te.selectionStart = 1; te.selectionEnd = extval.length;
          // Re-set this, in case some other handler touched the
          // selection in the meantime.
          display.selForContextMenu = cm.doc.sel;
        }
      }
      function rehide() {
        input.contextMenuPending = false;
        input.wrapper.style.position = "relative";
        te.style.cssText = oldCSS;
        if (ie && ie_version < 9) display.scrollbars.setScrollTop(display.scroller.scrollTop = scrollPos);

        // Try to detect the user choosing select-all
        if (te.selectionStart != null) {
          if (!ie || (ie && ie_version < 9)) prepareSelectAllHack();
          var i = 0, poll = function() {
            if (display.selForContextMenu == cm.doc.sel && te.selectionStart == 0 &&
                te.selectionEnd > 0 && input.prevInput == "\u200b")
              operation(cm, commands.selectAll)(cm);
            else if (i++ < 10) display.detectingSelectAll = setTimeout(poll, 500);
            else display.input.reset();
          };
          display.detectingSelectAll = setTimeout(poll, 200);
        }
      }

      if (ie && ie_version >= 9) prepareSelectAllHack();
      if (captureRightClick) {
        e_stop(e);
        var mouseup = function() {
          off(window, "mouseup", mouseup);
          setTimeout(rehide, 20);
        };
        on(window, "mouseup", mouseup);
      } else {
        setTimeout(rehide, 50);
      }
    },

    readOnlyChanged: function(val) {
      if (!val) this.reset();
    },

    setUneditable: nothing,

    needsContentAttribute: false
  }, TextareaInput.prototype);

  // CONTENTEDITABLE INPUT STYLE

  function ContentEditableInput(cm) {
    this.cm = cm;
    this.lastAnchorNode = this.lastAnchorOffset = this.lastFocusNode = this.lastFocusOffset = null;
    this.polling = new Delayed();
    this.gracePeriod = false;
  }

  ContentEditableInput.prototype = copyObj({
    init: function(display) {
      var input = this, cm = input.cm;
      var div = input.div = display.lineDiv;
      disableBrowserMagic(div);

      on(div, "paste", function(e) { handlePaste(e, cm); })

      on(div, "compositionstart", function(e) {
        var data = e.data;
        input.composing = {sel: cm.doc.sel, data: data, startData: data};
        if (!data) return;
        var prim = cm.doc.sel.primary();
        var line = cm.getLine(prim.head.line);
        var found = line.indexOf(data, Math.max(0, prim.head.ch - data.length));
        if (found > -1 && found <= prim.head.ch)
          input.composing.sel = simpleSelection(Pos(prim.head.line, found),
                                                Pos(prim.head.line, found + data.length));
      });
      on(div, "compositionupdate", function(e) {
        input.composing.data = e.data;
      });
      on(div, "compositionend", function(e) {
        var ours = input.composing;
        if (!ours) return;
        if (e.data != ours.startData && !/\u200b/.test(e.data))
          ours.data = e.data;
        // Need a small delay to prevent other code (input event,
        // selection polling) from doing damage when fired right after
        // compositionend.
        setTimeout(function() {
          if (!ours.handled)
            input.applyComposition(ours);
          if (input.composing == ours)
            input.composing = null;
        }, 50);
      });

      on(div, "touchstart", function() {
        input.forceCompositionEnd();
      });

      on(div, "input", function() {
        if (input.composing) return;
        if (isReadOnly(cm) || !input.pollContent())
          runInOp(input.cm, function() {regChange(cm);});
      });

      function onCopyCut(e) {
        if (cm.somethingSelected()) {
          lastCopied = cm.getSelections();
          if (e.type == "cut") cm.replaceSelection("", null, "cut");
        } else if (!cm.options.lineWiseCopyCut) {
          return;
        } else {
          var ranges = copyableRanges(cm);
          lastCopied = ranges.text;
          if (e.type == "cut") {
            cm.operation(function() {
              cm.setSelections(ranges.ranges, 0, sel_dontScroll);
              cm.replaceSelection("", null, "cut");
            });
          }
        }
        // iOS exposes the clipboard API, but seems to discard content inserted into it
        if (e.clipboardData && !ios) {
          e.preventDefault();
          e.clipboardData.clearData();
          e.clipboardData.setData("text/plain", lastCopied.join("\n"));
        } else {
          // Old-fashioned briefly-focus-a-textarea hack
          var kludge = hiddenTextarea(), te = kludge.firstChild;
          cm.display.lineSpace.insertBefore(kludge, cm.display.lineSpace.firstChild);
          te.value = lastCopied.join("\n");
          var hadFocus = document.activeElement;
          selectInput(te);
          setTimeout(function() {
            cm.display.lineSpace.removeChild(kludge);
            hadFocus.focus();
          }, 50);
        }
      }
      on(div, "copy", onCopyCut);
      on(div, "cut", onCopyCut);
    },

    prepareSelection: function() {
      var result = prepareSelection(this.cm, false);
      result.focus = this.cm.state.focused;
      return result;
    },

    showSelection: function(info) {
      if (!info || !this.cm.display.view.length) return;
      if (info.focus) this.showPrimarySelection();
      this.showMultipleSelections(info);
    },

    showPrimarySelection: function() {
      var sel = window.getSelection(), prim = this.cm.doc.sel.primary();
      var curAnchor = domToPos(this.cm, sel.anchorNode, sel.anchorOffset);
      var curFocus = domToPos(this.cm, sel.focusNode, sel.focusOffset);
      if (curAnchor && !curAnchor.bad && curFocus && !curFocus.bad &&
          cmp(minPos(curAnchor, curFocus), prim.from()) == 0 &&
          cmp(maxPos(curAnchor, curFocus), prim.to()) == 0)
        return;

      var start = posToDOM(this.cm, prim.from());
      var end = posToDOM(this.cm, prim.to());
      if (!start && !end) return;

      var view = this.cm.display.view;
      var old = sel.rangeCount && sel.getRangeAt(0);
      if (!start) {
        start = {node: view[0].measure.map[2], offset: 0};
      } else if (!end) { // FIXME dangerously hacky
        var measure = view[view.length - 1].measure;
        var map = measure.maps ? measure.maps[measure.maps.length - 1] : measure.map;
        end = {node: map[map.length - 1], offset: map[map.length - 2] - map[map.length - 3]};
      }

      try { var rng = range(start.node, start.offset, end.offset, end.node); }
      catch(e) {} // Our model of the DOM might be outdated, in which case the range we try to set can be impossible
      if (rng) {
        sel.removeAllRanges();
        sel.addRange(rng);
        if (old && sel.anchorNode == null) sel.addRange(old);
        else if (gecko) this.startGracePeriod();
      }
      this.rememberSelection();
    },

    startGracePeriod: function() {
      var input = this;
      clearTimeout(this.gracePeriod);
      this.gracePeriod = setTimeout(function() {
        input.gracePeriod = false;
        if (input.selectionChanged())
          input.cm.operation(function() { input.cm.curOp.selectionChanged = true; });
      }, 20);
    },

    showMultipleSelections: function(info) {
      removeChildrenAndAdd(this.cm.display.cursorDiv, info.cursors);
      removeChildrenAndAdd(this.cm.display.selectionDiv, info.selection);
    },

    rememberSelection: function() {
      var sel = window.getSelection();
      this.lastAnchorNode = sel.anchorNode; this.lastAnchorOffset = sel.anchorOffset;
      this.lastFocusNode = sel.focusNode; this.lastFocusOffset = sel.focusOffset;
    },

    selectionInEditor: function() {
      var sel = window.getSelection();
      if (!sel.rangeCount) return false;
      var node = sel.getRangeAt(0).commonAncestorContainer;
      return contains(this.div, node);
    },

    focus: function() {
      if (this.cm.options.readOnly != "nocursor") this.div.focus();
    },
    blur: function() { this.div.blur(); },
    getField: function() { return this.div; },

    supportsTouch: function() { return true; },

    receivedFocus: function() {
      var input = this;
      if (this.selectionInEditor())
        this.pollSelection();
      else
        runInOp(this.cm, function() { input.cm.curOp.selectionChanged = true; });

      function poll() {
        if (input.cm.state.focused) {
          input.pollSelection();
          input.polling.set(input.cm.options.pollInterval, poll);
        }
      }
      this.polling.set(this.cm.options.pollInterval, poll);
    },

    selectionChanged: function() {
      var sel = window.getSelection();
      return sel.anchorNode != this.lastAnchorNode || sel.anchorOffset != this.lastAnchorOffset ||
        sel.focusNode != this.lastFocusNode || sel.focusOffset != this.lastFocusOffset;
    },

    pollSelection: function() {
      if (!this.composing && !this.gracePeriod && this.selectionChanged()) {
        var sel = window.getSelection(), cm = this.cm;
        this.rememberSelection();
        var anchor = domToPos(cm, sel.anchorNode, sel.anchorOffset);
        var head = domToPos(cm, sel.focusNode, sel.focusOffset);
        if (anchor && head) runInOp(cm, function() {
          setSelection(cm.doc, simpleSelection(anchor, head), sel_dontScroll);
          if (anchor.bad || head.bad) cm.curOp.selectionChanged = true;
        });
      }
    },

    pollContent: function() {
      var cm = this.cm, display = cm.display, sel = cm.doc.sel.primary();
      var from = sel.from(), to = sel.to();
      if (from.line < display.viewFrom || to.line > display.viewTo - 1) return false;

      var fromIndex;
      if (from.line == display.viewFrom || (fromIndex = findViewIndex(cm, from.line)) == 0) {
        var fromLine = lineNo(display.view[0].line);
        var fromNode = display.view[0].node;
      } else {
        var fromLine = lineNo(display.view[fromIndex].line);
        var fromNode = display.view[fromIndex - 1].node.nextSibling;
      }
      var toIndex = findViewIndex(cm, to.line);
      if (toIndex == display.view.length - 1) {
        var toLine = display.viewTo - 1;
        var toNode = display.lineDiv.lastChild;
      } else {
        var toLine = lineNo(display.view[toIndex + 1].line) - 1;
        var toNode = display.view[toIndex + 1].node.previousSibling;
      }

      var newText = cm.doc.splitLines(domTextBetween(cm, fromNode, toNode, fromLine, toLine));
      var oldText = getBetween(cm.doc, Pos(fromLine, 0), Pos(toLine, getLine(cm.doc, toLine).text.length));
      while (newText.length > 1 && oldText.length > 1) {
        if (lst(newText) == lst(oldText)) { newText.pop(); oldText.pop(); toLine--; }
        else if (newText[0] == oldText[0]) { newText.shift(); oldText.shift(); fromLine++; }
        else break;
      }

      var cutFront = 0, cutEnd = 0;
      var newTop = newText[0], oldTop = oldText[0], maxCutFront = Math.min(newTop.length, oldTop.length);
      while (cutFront < maxCutFront && newTop.charCodeAt(cutFront) == oldTop.charCodeAt(cutFront))
        ++cutFront;
      var newBot = lst(newText), oldBot = lst(oldText);
      var maxCutEnd = Math.min(newBot.length - (newText.length == 1 ? cutFront : 0),
                               oldBot.length - (oldText.length == 1 ? cutFront : 0));
      while (cutEnd < maxCutEnd &&
             newBot.charCodeAt(newBot.length - cutEnd - 1) == oldBot.charCodeAt(oldBot.length - cutEnd - 1))
        ++cutEnd;

      newText[newText.length - 1] = newBot.slice(0, newBot.length - cutEnd);
      newText[0] = newText[0].slice(cutFront);

      var chFrom = Pos(fromLine, cutFront);
      var chTo = Pos(toLine, oldText.length ? lst(oldText).length - cutEnd : 0);
      if (newText.length > 1 || newText[0] || cmp(chFrom, chTo)) {
        replaceRange(cm.doc, newText, chFrom, chTo, "+input");
        return true;
      }
    },

    ensurePolled: function() {
      this.forceCompositionEnd();
    },
    reset: function() {
      this.forceCompositionEnd();
    },
    forceCompositionEnd: function() {
      if (!this.composing || this.composing.handled) return;
      this.applyComposition(this.composing);
      this.composing.handled = true;
      this.div.blur();
      this.div.focus();
    },
    applyComposition: function(composing) {
      if (isReadOnly(this.cm))
        operation(this.cm, regChange)(this.cm)
      else if (composing.data && composing.data != composing.startData)
        operation(this.cm, applyTextInput)(this.cm, composing.data, 0, composing.sel);
    },

    setUneditable: function(node) {
      node.contentEditable = "false"
    },

    onKeyPress: function(e) {
      e.preventDefault();
      if (!isReadOnly(this.cm))
        operation(this.cm, applyTextInput)(this.cm, String.fromCharCode(e.charCode == null ? e.keyCode : e.charCode), 0);
    },

    readOnlyChanged: function(val) {
      this.div.contentEditable = String(val != "nocursor")
    },

    onContextMenu: nothing,
    resetPosition: nothing,

    needsContentAttribute: true
  }, ContentEditableInput.prototype);

  function posToDOM(cm, pos) {
    var view = findViewForLine(cm, pos.line);
    if (!view || view.hidden) return null;
    var line = getLine(cm.doc, pos.line);
    var info = mapFromLineView(view, line, pos.line);

    var order = getOrder(line), side = "left";
    if (order) {
      var partPos = getBidiPartAt(order, pos.ch);
      side = partPos % 2 ? "right" : "left";
    }
    var result = nodeAndOffsetInLineMap(info.map, pos.ch, side);
    result.offset = result.collapse == "right" ? result.end : result.start;
    return result;
  }

  function badPos(pos, bad) { if (bad) pos.bad = true; return pos; }

  function domToPos(cm, node, offset) {
    var lineNode;
    if (node == cm.display.lineDiv) {
      lineNode = cm.display.lineDiv.childNodes[offset];
      if (!lineNode) return badPos(cm.clipPos(Pos(cm.display.viewTo - 1)), true);
      node = null; offset = 0;
    } else {
      for (lineNode = node;; lineNode = lineNode.parentNode) {
        if (!lineNode || lineNode == cm.display.lineDiv) return null;
        if (lineNode.parentNode && lineNode.parentNode == cm.display.lineDiv) break;
      }
    }
    for (var i = 0; i < cm.display.view.length; i++) {
      var lineView = cm.display.view[i];
      if (lineView.node == lineNode)
        return locateNodeInLineView(lineView, node, offset);
    }
  }

  function locateNodeInLineView(lineView, node, offset) {
    var wrapper = lineView.text.firstChild, bad = false;
    if (!node || !contains(wrapper, node)) return badPos(Pos(lineNo(lineView.line), 0), true);
    if (node == wrapper) {
      bad = true;
      node = wrapper.childNodes[offset];
      offset = 0;
      if (!node) {
        var line = lineView.rest ? lst(lineView.rest) : lineView.line;
        return badPos(Pos(lineNo(line), line.text.length), bad);
      }
    }

    var textNode = node.nodeType == 3 ? node : null, topNode = node;
    if (!textNode && node.childNodes.length == 1 && node.firstChild.nodeType == 3) {
      textNode = node.firstChild;
      if (offset) offset = textNode.nodeValue.length;
    }
    while (topNode.parentNode != wrapper) topNode = topNode.parentNode;
    var measure = lineView.measure, maps = measure.maps;

    function find(textNode, topNode, offset) {
      for (var i = -1; i < (maps ? maps.length : 0); i++) {
        var map = i < 0 ? measure.map : maps[i];
        for (var j = 0; j < map.length; j += 3) {
          var curNode = map[j + 2];
          if (curNode == textNode || curNode == topNode) {
            var line = lineNo(i < 0 ? lineView.line : lineView.rest[i]);
            var ch = map[j] + offset;
            if (offset < 0 || curNode != textNode) ch = map[j + (offset ? 1 : 0)];
            return Pos(line, ch);
          }
        }
      }
    }
    var found = find(textNode, topNode, offset);
    if (found) return badPos(found, bad);

    // FIXME this is all really shaky. might handle the few cases it needs to handle, but likely to cause problems
    for (var after = topNode.nextSibling, dist = textNode ? textNode.nodeValue.length - offset : 0; after; after = after.nextSibling) {
      found = find(after, after.firstChild, 0);
      if (found)
        return badPos(Pos(found.line, found.ch - dist), bad);
      else
        dist += after.textContent.length;
    }
    for (var before = topNode.previousSibling, dist = offset; before; before = before.previousSibling) {
      found = find(before, before.firstChild, -1);
      if (found)
        return badPos(Pos(found.line, found.ch + dist), bad);
      else
        dist += after.textContent.length;
    }
  }

  function domTextBetween(cm, from, to, fromLine, toLine) {
    var text = "", closing = false, lineSep = cm.doc.lineSeparator();
    function recognizeMarker(id) { return function(marker) { return marker.id == id; }; }
    function walk(node) {
      if (node.nodeType == 1) {
        var cmText = node.getAttribute("cm-text");
        if (cmText != null) {
          if (cmText == "") cmText = node.textContent.replace(/\u200b/g, "");
          text += cmText;
          return;
        }
        var markerID = node.getAttribute("cm-marker"), range;
        if (markerID) {
          var found = cm.findMarks(Pos(fromLine, 0), Pos(toLine + 1, 0), recognizeMarker(+markerID));
          if (found.length && (range = found[0].find()))
            text += getBetween(cm.doc, range.from, range.to).join(lineSep);
          return;
        }
        if (node.getAttribute("contenteditable") == "false") return;
        for (var i = 0; i < node.childNodes.length; i++)
          walk(node.childNodes[i]);
        if (/^(pre|div|p)$/i.test(node.nodeName))
          closing = true;
      } else if (node.nodeType == 3) {
        var val = node.nodeValue;
        if (!val) return;
        if (closing) {
          text += lineSep;
          closing = false;
        }
        text += val;
      }
    }
    for (;;) {
      walk(from);
      if (from == to) break;
      from = from.nextSibling;
    }
    return text;
  }

  CodeMirror.inputStyles = {"textarea": TextareaInput, "contenteditable": ContentEditableInput};

  // SELECTION / CURSOR

  // Selection objects are immutable. A new one is created every time
  // the selection changes. A selection is one or more non-overlapping
  // (and non-touching) ranges, sorted, and an integer that indicates
  // which one is the primary selection (the one that's scrolled into
  // view, that getCursor returns, etc).
  function Selection(ranges, primIndex) {
    this.ranges = ranges;
    this.primIndex = primIndex;
  }

  Selection.prototype = {
    primary: function() { return this.ranges[this.primIndex]; },
    equals: function(other) {
      if (other == this) return true;
      if (other.primIndex != this.primIndex || other.ranges.length != this.ranges.length) return false;
      for (var i = 0; i < this.ranges.length; i++) {
        var here = this.ranges[i], there = other.ranges[i];
        if (cmp(here.anchor, there.anchor) != 0 || cmp(here.head, there.head) != 0) return false;
      }
      return true;
    },
    deepCopy: function() {
      for (var out = [], i = 0; i < this.ranges.length; i++)
        out[i] = new Range(copyPos(this.ranges[i].anchor), copyPos(this.ranges[i].head));
      return new Selection(out, this.primIndex);
    },
    somethingSelected: function() {
      for (var i = 0; i < this.ranges.length; i++)
        if (!this.ranges[i].empty()) return true;
      return false;
    },
    contains: function(pos, end) {
      if (!end) end = pos;
      for (var i = 0; i < this.ranges.length; i++) {
        var range = this.ranges[i];
        if (cmp(end, range.from()) >= 0 && cmp(pos, range.to()) <= 0)
          return i;
      }
      return -1;
    }
  };

  function Range(anchor, head) {
    this.anchor = anchor; this.head = head;
  }

  Range.prototype = {
    from: function() { return minPos(this.anchor, this.head); },
    to: function() { return maxPos(this.anchor, this.head); },
    empty: function() {
      return this.head.line == this.anchor.line && this.head.ch == this.anchor.ch;
    }
  };

  // Take an unsorted, potentially overlapping set of ranges, and
  // build a selection out of it. 'Consumes' ranges array (modifying
  // it).
  function normalizeSelection(ranges, primIndex) {
    var prim = ranges[primIndex];
    ranges.sort(function(a, b) { return cmp(a.from(), b.from()); });
    primIndex = indexOf(ranges, prim);
    for (var i = 1; i < ranges.length; i++) {
      var cur = ranges[i], prev = ranges[i - 1];
      if (cmp(prev.to(), cur.from()) >= 0) {
        var from = minPos(prev.from(), cur.from()), to = maxPos(prev.to(), cur.to());
        var inv = prev.empty() ? cur.from() == cur.head : prev.from() == prev.head;
        if (i <= primIndex) --primIndex;
        ranges.splice(--i, 2, new Range(inv ? to : from, inv ? from : to));
      }
    }
    return new Selection(ranges, primIndex);
  }

  function simpleSelection(anchor, head) {
    return new Selection([new Range(anchor, head || anchor)], 0);
  }

  // Most of the external API clips given positions to make sure they
  // actually exist within the document.
  function clipLine(doc, n) {return Math.max(doc.first, Math.min(n, doc.first + doc.size - 1));}
  function clipPos(doc, pos) {
    if (pos.line < doc.first) return Pos(doc.first, 0);
    var last = doc.first + doc.size - 1;
    if (pos.line > last) return Pos(last, getLine(doc, last).text.length);
    return clipToLen(pos, getLine(doc, pos.line).text.length);
  }
  function clipToLen(pos, linelen) {
    var ch = pos.ch;
    if (ch == null || ch > linelen) return Pos(pos.line, linelen);
    else if (ch < 0) return Pos(pos.line, 0);
    else return pos;
  }
  function isLine(doc, l) {return l >= doc.first && l < doc.first + doc.size;}
  function clipPosArray(doc, array) {
    for (var out = [], i = 0; i < array.length; i++) out[i] = clipPos(doc, array[i]);
    return out;
  }

  // SELECTION UPDATES

  // The 'scroll' parameter given to many of these indicated whether
  // the new cursor position should be scrolled into view after
  // modifying the selection.

  // If shift is held or the extend flag is set, extends a range to
  // include a given position (and optionally a second position).
  // Otherwise, simply returns the range between the given positions.
  // Used for cursor motion and such.
  function extendRange(doc, range, head, other) {
    if (doc.cm && doc.cm.display.shift || doc.extend) {
      var anchor = range.anchor;
      if (other) {
        var posBefore = cmp(head, anchor) < 0;
        if (posBefore != (cmp(other, anchor) < 0)) {
          anchor = head;
          head = other;
        } else if (posBefore != (cmp(head, other) < 0)) {
          head = other;
        }
      }
      return new Range(anchor, head);
    } else {
      return new Range(other || head, head);
    }
  }

  // Extend the primary selection range, discard the rest.
  function extendSelection(doc, head, other, options) {
    setSelection(doc, new Selection([extendRange(doc, doc.sel.primary(), head, other)], 0), options);
  }

  // Extend all selections (pos is an array of selections with length
  // equal the number of selections)
  function extendSelections(doc, heads, options) {
    for (var out = [], i = 0; i < doc.sel.ranges.length; i++)
      out[i] = extendRange(doc, doc.sel.ranges[i], heads[i], null);
    var newSel = normalizeSelection(out, doc.sel.primIndex);
    setSelection(doc, newSel, options);
  }

  // Updates a single range in the selection.
  function replaceOneSelection(doc, i, range, options) {
    var ranges = doc.sel.ranges.slice(0);
    ranges[i] = range;
    setSelection(doc, normalizeSelection(ranges, doc.sel.primIndex), options);
  }

  // Reset the selection to a single range.
  function setSimpleSelection(doc, anchor, head, options) {
    setSelection(doc, simpleSelection(anchor, head), options);
  }

  // Give beforeSelectionChange handlers a change to influence a
  // selection update.
  function filterSelectionChange(doc, sel) {
    var obj = {
      ranges: sel.ranges,
      update: function(ranges) {
        this.ranges = [];
        for (var i = 0; i < ranges.length; i++)
          this.ranges[i] = new Range(clipPos(doc, ranges[i].anchor),
                                     clipPos(doc, ranges[i].head));
      }
    };
    signal(doc, "beforeSelectionChange", doc, obj);
    if (doc.cm) signal(doc.cm, "beforeSelectionChange", doc.cm, obj);
    if (obj.ranges != sel.ranges) return normalizeSelection(obj.ranges, obj.ranges.length - 1);
    else return sel;
  }

  function setSelectionReplaceHistory(doc, sel, options) {
    var done = doc.history.done, last = lst(done);
    if (last && last.ranges) {
      done[done.length - 1] = sel;
      setSelectionNoUndo(doc, sel, options);
    } else {
      setSelection(doc, sel, options);
    }
  }

  // Set a new selection.
  function setSelection(doc, sel, options) {
    setSelectionNoUndo(doc, sel, options);
    addSelectionToHistory(doc, doc.sel, doc.cm ? doc.cm.curOp.id : NaN, options);
  }

  function setSelectionNoUndo(doc, sel, options) {
    if (hasHandler(doc, "beforeSelectionChange") || doc.cm && hasHandler(doc.cm, "beforeSelectionChange"))
      sel = filterSelectionChange(doc, sel);

    var bias = options && options.bias ||
      (cmp(sel.primary().head, doc.sel.primary().head) < 0 ? -1 : 1);
    setSelectionInner(doc, skipAtomicInSelection(doc, sel, bias, true));

    if (!(options && options.scroll === false) && doc.cm)
      ensureCursorVisible(doc.cm);
  }

  function setSelectionInner(doc, sel) {
    if (sel.equals(doc.sel)) return;

    doc.sel = sel;

    if (doc.cm) {
      doc.cm.curOp.updateInput = doc.cm.curOp.selectionChanged = true;
      signalCursorActivity(doc.cm);
    }
    signalLater(doc, "cursorActivity", doc);
  }

  // Verify that the selection does not partially select any atomic
  // marked ranges.
  function reCheckSelection(doc) {
    setSelectionInner(doc, skipAtomicInSelection(doc, doc.sel, null, false), sel_dontScroll);
  }

  // Return a selection that does not partially select any atomic
  // ranges.
  function skipAtomicInSelection(doc, sel, bias, mayClear) {
    var out;
    for (var i = 0; i < sel.ranges.length; i++) {
      var range = sel.ranges[i];
      var newAnchor = skipAtomic(doc, range.anchor, bias, mayClear);
      var newHead = skipAtomic(doc, range.head, bias, mayClear);
      if (out || newAnchor != range.anchor || newHead != range.head) {
        if (!out) out = sel.ranges.slice(0, i);
        out[i] = new Range(newAnchor, newHead);
      }
    }
    return out ? normalizeSelection(out, sel.primIndex) : sel;
  }

  // Ensure a given position is not inside an atomic range.
  function skipAtomic(doc, pos, bias, mayClear) {
    var flipped = false, curPos = pos;
    var dir = bias || 1;
    doc.cantEdit = false;
    search: for (;;) {
      var line = getLine(doc, curPos.line);
      if (line.markedSpans) {
        for (var i = 0; i < line.markedSpans.length; ++i) {
          var sp = line.markedSpans[i], m = sp.marker;
          if ((sp.from == null || (m.inclusiveLeft ? sp.from <= curPos.ch : sp.from < curPos.ch)) &&
              (sp.to == null || (m.inclusiveRight ? sp.to >= curPos.ch : sp.to > curPos.ch))) {
            if (mayClear) {
              signal(m, "beforeCursorEnter");
              if (m.explicitlyCleared) {
                if (!line.markedSpans) break;
                else {--i; continue;}
              }
            }
            if (!m.atomic) continue;
            var newPos = m.find(dir < 0 ? -1 : 1);
            if (cmp(newPos, curPos) == 0) {
              newPos.ch += dir;
              if (newPos.ch < 0) {
                if (newPos.line > doc.first) newPos = clipPos(doc, Pos(newPos.line - 1));
                else newPos = null;
              } else if (newPos.ch > line.text.length) {
                if (newPos.line < doc.first + doc.size - 1) newPos = Pos(newPos.line + 1, 0);
                else newPos = null;
              }
              if (!newPos) {
                if (flipped) {
                  // Driven in a corner -- no valid cursor position found at all
                  // -- try again *with* clearing, if we didn't already
                  if (!mayClear) return skipAtomic(doc, pos, bias, true);
                  // Otherwise, turn off editing until further notice, and return the start of the doc
                  doc.cantEdit = true;
                  return Pos(doc.first, 0);
                }
                flipped = true; newPos = pos; dir = -dir;
              }
            }
            curPos = newPos;
            continue search;
          }
        }
      }
      return curPos;
    }
  }

  // SELECTION DRAWING

  function updateSelection(cm) {
    cm.display.input.showSelection(cm.display.input.prepareSelection());
  }

  function prepareSelection(cm, primary) {
    var doc = cm.doc, result = {};
    var curFragment = result.cursors = document.createDocumentFragment();
    var selFragment = result.selection = document.createDocumentFragment();

    for (var i = 0; i < doc.sel.ranges.length; i++) {
      if (primary === false && i == doc.sel.primIndex) continue;
      var range = doc.sel.ranges[i];
      var collapsed = range.empty();
      if (collapsed || cm.options.showCursorWhenSelecting)
        drawSelectionCursor(cm, range.head, curFragment);
      if (!collapsed)
        drawSelectionRange(cm, range, selFragment);
    }
    return result;
  }

  // Draws a cursor for the given range
  function drawSelectionCursor(cm, head, output) {
    var pos = cursorCoords(cm, head, "div", null, null, !cm.options.singleCursorHeightPerLine);

    var cursor = output.appendChild(elt("div", "\u00a0", "CodeMirror-cursor"));
    cursor.style.left = pos.left + "px";
    cursor.style.top = pos.top + "px";
    cursor.style.height = Math.max(0, pos.bottom - pos.top) * cm.options.cursorHeight + "px";

    if (pos.other) {
      // Secondary cursor, shown when on a 'jump' in bi-directional text
      var otherCursor = output.appendChild(elt("div", "\u00a0", "CodeMirror-cursor CodeMirror-secondarycursor"));
      otherCursor.style.display = "";
      otherCursor.style.left = pos.other.left + "px";
      otherCursor.style.top = pos.other.top + "px";
      otherCursor.style.height = (pos.other.bottom - pos.other.top) * .85 + "px";
    }
  }

  // Draws the given range as a highlighted selection
  function drawSelectionRange(cm, range, output) {
    var display = cm.display, doc = cm.doc;
    var fragment = document.createDocumentFragment();
    var padding = paddingH(cm.display), leftSide = padding.left;
    var rightSide = Math.max(display.sizerWidth, displayWidth(cm) - display.sizer.offsetLeft) - padding.right;

    function add(left, top, width, bottom) {
      if (top < 0) top = 0;
      top = Math.round(top);
      bottom = Math.round(bottom);
      fragment.appendChild(elt("div", null, "CodeMirror-selected", "position: absolute; left: " + left +
                               "px; top: " + top + "px; width: " + (width == null ? rightSide - left : width) +
                               "px; height: " + (bottom - top) + "px"));
    }

    function drawForLine(line, fromArg, toArg) {
      var lineObj = getLine(doc, line);
      var lineLen = lineObj.text.length;
      var start, end;
      function coords(ch, bias) {
        return charCoords(cm, Pos(line, ch), "div", lineObj, bias);
      }

      iterateBidiSections(getOrder(lineObj), fromArg || 0, toArg == null ? lineLen : toArg, function(from, to, dir) {
        var leftPos = coords(from, "left"), rightPos, left, right;
        if (from == to) {
          rightPos = leftPos;
          left = right = leftPos.left;
        } else {
          rightPos = coords(to - 1, "right");
          if (dir == "rtl") { var tmp = leftPos; leftPos = rightPos; rightPos = tmp; }
          left = leftPos.left;
          right = rightPos.right;
        }
        if (fromArg == null && from == 0) left = leftSide;
        if (rightPos.top - leftPos.top > 3) { // Different lines, draw top part
          add(left, leftPos.top, null, leftPos.bottom);
          left = leftSide;
          if (leftPos.bottom < rightPos.top) add(left, leftPos.bottom, null, rightPos.top);
        }
        if (toArg == null && to == lineLen) right = rightSide;
        if (!start || leftPos.top < start.top || leftPos.top == start.top && leftPos.left < start.left)
          start = leftPos;
        if (!end || rightPos.bottom > end.bottom || rightPos.bottom == end.bottom && rightPos.right > end.right)
          end = rightPos;
        if (left < leftSide + 1) left = leftSide;
        add(left, rightPos.top, right - left, rightPos.bottom);
      });
      return {start: start, end: end};
    }

    var sFrom = range.from(), sTo = range.to();
    if (sFrom.line == sTo.line) {
      drawForLine(sFrom.line, sFrom.ch, sTo.ch);
    } else {
      var fromLine = getLine(doc, sFrom.line), toLine = getLine(doc, sTo.line);
      var singleVLine = visualLine(fromLine) == visualLine(toLine);
      var leftEnd = drawForLine(sFrom.line, sFrom.ch, singleVLine ? fromLine.text.length + 1 : null).end;
      var rightStart = drawForLine(sTo.line, singleVLine ? 0 : null, sTo.ch).start;
      if (singleVLine) {
        if (leftEnd.top < rightStart.top - 2) {
          add(leftEnd.right, leftEnd.top, null, leftEnd.bottom);
          add(leftSide, rightStart.top, rightStart.left, rightStart.bottom);
        } else {
          add(leftEnd.right, leftEnd.top, rightStart.left - leftEnd.right, leftEnd.bottom);
        }
      }
      if (leftEnd.bottom < rightStart.top)
        add(leftSide, leftEnd.bottom, null, rightStart.top);
    }

    output.appendChild(fragment);
  }

  // Cursor-blinking
  function restartBlink(cm) {
    if (!cm.state.focused) return;
    var display = cm.display;
    clearInterval(display.blinker);
    var on = true;
    display.cursorDiv.style.visibility = "";
    if (cm.options.cursorBlinkRate > 0)
      display.blinker = setInterval(function() {
        display.cursorDiv.style.visibility = (on = !on) ? "" : "hidden";
      }, cm.options.cursorBlinkRate);
    else if (cm.options.cursorBlinkRate < 0)
      display.cursorDiv.style.visibility = "hidden";
  }

  // HIGHLIGHT WORKER

  function startWorker(cm, time) {
    if (cm.doc.mode.startState && cm.doc.frontier < cm.display.viewTo)
      cm.state.highlight.set(time, bind(highlightWorker, cm));
  }

  function highlightWorker(cm) {
    var doc = cm.doc;
    if (doc.frontier < doc.first) doc.frontier = doc.first;
    if (doc.frontier >= cm.display.viewTo) return;
    var end = +new Date + cm.options.workTime;
    var state = copyState(doc.mode, getStateBefore(cm, doc.frontier));
    var changedLines = [];

    doc.iter(doc.frontier, Math.min(doc.first + doc.size, cm.display.viewTo + 500), function(line) {
      if (doc.frontier >= cm.display.viewFrom) { // Visible
        var oldStyles = line.styles, tooLong = line.text.length > cm.options.maxHighlightLength;
        var highlighted = highlightLine(cm, line, tooLong ? copyState(doc.mode, state) : state, true);
        line.styles = highlighted.styles;
        var oldCls = line.styleClasses, newCls = highlighted.classes;
        if (newCls) line.styleClasses = newCls;
        else if (oldCls) line.styleClasses = null;
        var ischange = !oldStyles || oldStyles.length != line.styles.length ||
          oldCls != newCls && (!oldCls || !newCls || oldCls.bgClass != newCls.bgClass || oldCls.textClass != newCls.textClass);
        for (var i = 0; !ischange && i < oldStyles.length; ++i) ischange = oldStyles[i] != line.styles[i];
        if (ischange) changedLines.push(doc.frontier);
        line.stateAfter = tooLong ? state : copyState(doc.mode, state);
      } else {
        if (line.text.length <= cm.options.maxHighlightLength)
          processLine(cm, line.text, state);
        line.stateAfter = doc.frontier % 5 == 0 ? copyState(doc.mode, state) : null;
      }
      ++doc.frontier;
      if (+new Date > end) {
        startWorker(cm, cm.options.workDelay);
        return true;
      }
    });
    if (changedLines.length) runInOp(cm, function() {
      for (var i = 0; i < changedLines.length; i++)
        regLineChange(cm, changedLines[i], "text");
    });
  }

  // Finds the line to start with when starting a parse. Tries to
  // find a line with a stateAfter, so that it can start with a
  // valid state. If that fails, it returns the line with the
  // smallest indentation, which tends to need the least context to
  // parse correctly.
  function findStartLine(cm, n, precise) {
    var minindent, minline, doc = cm.doc;
    var lim = precise ? -1 : n - (cm.doc.mode.innerMode ? 1000 : 100);
    for (var search = n; search > lim; --search) {
      if (search <= doc.first) return doc.first;
      var line = getLine(doc, search - 1);
      if (line.stateAfter && (!precise || search <= doc.frontier)) return search;
      var indented = countColumn(line.text, null, cm.options.tabSize);
      if (minline == null || minindent > indented) {
        minline = search - 1;
        minindent = indented;
      }
    }
    return minline;
  }

  function getStateBefore(cm, n, precise) {
    var doc = cm.doc, display = cm.display;
    if (!doc.mode.startState) return true;
    var pos = findStartLine(cm, n, precise), state = pos > doc.first && getLine(doc, pos-1).stateAfter;
    if (!state) state = startState(doc.mode);
    else state = copyState(doc.mode, state);
    doc.iter(pos, n, function(line) {
      processLine(cm, line.text, state);
      var save = pos == n - 1 || pos % 5 == 0 || pos >= display.viewFrom && pos < display.viewTo;
      line.stateAfter = save ? copyState(doc.mode, state) : null;
      ++pos;
    });
    if (precise) doc.frontier = pos;
    return state;
  }

  // POSITION MEASUREMENT

  function paddingTop(display) {return display.lineSpace.offsetTop;}
  function paddingVert(display) {return display.mover.offsetHeight - display.lineSpace.offsetHeight;}
  function paddingH(display) {
    if (display.cachedPaddingH) return display.cachedPaddingH;
    var e = removeChildrenAndAdd(display.measure, elt("pre", "x"));
    var style = window.getComputedStyle ? window.getComputedStyle(e) : e.currentStyle;
    var data = {left: parseInt(style.paddingLeft), right: parseInt(style.paddingRight)};
    if (!isNaN(data.left) && !isNaN(data.right)) display.cachedPaddingH = data;
    return data;
  }

  function scrollGap(cm) { return scrollerGap - cm.display.nativeBarWidth; }
  function displayWidth(cm) {
    return cm.display.scroller.clientWidth - scrollGap(cm) - cm.display.barWidth;
  }
  function displayHeight(cm) {
    return cm.display.scroller.clientHeight - scrollGap(cm) - cm.display.barHeight;
  }

  // Ensure the lineView.wrapping.heights array is populated. This is
  // an array of bottom offsets for the lines that make up a drawn
  // line. When lineWrapping is on, there might be more than one
  // height.
  function ensureLineHeights(cm, lineView, rect) {
    var wrapping = cm.options.lineWrapping;
    var curWidth = wrapping && displayWidth(cm);
    if (!lineView.measure.heights || wrapping && lineView.measure.width != curWidth) {
      var heights = lineView.measure.heights = [];
      if (wrapping) {
        lineView.measure.width = curWidth;
        var rects = lineView.text.firstChild.getClientRects();
        for (var i = 0; i < rects.length - 1; i++) {
          var cur = rects[i], next = rects[i + 1];
          if (Math.abs(cur.bottom - next.bottom) > 2)
            heights.push((cur.bottom + next.top) / 2 - rect.top);
        }
      }
      heights.push(rect.bottom - rect.top);
    }
  }

  // Find a line map (mapping character offsets to text nodes) and a
  // measurement cache for the given line number. (A line view might
  // contain multiple lines when collapsed ranges are present.)
  function mapFromLineView(lineView, line, lineN) {
    if (lineView.line == line)
      return {map: lineView.measure.map, cache: lineView.measure.cache};
    for (var i = 0; i < lineView.rest.length; i++)
      if (lineView.rest[i] == line)
        return {map: lineView.measure.maps[i], cache: lineView.measure.caches[i]};
    for (var i = 0; i < lineView.rest.length; i++)
      if (lineNo(lineView.rest[i]) > lineN)
        return {map: lineView.measure.maps[i], cache: lineView.measure.caches[i], before: true};
  }

  // Render a line into the hidden node display.externalMeasured. Used
  // when measurement is needed for a line that's not in the viewport.
  function updateExternalMeasurement(cm, line) {
    line = visualLine(line);
    var lineN = lineNo(line);
    var view = cm.display.externalMeasured = new LineView(cm.doc, line, lineN);
    view.lineN = lineN;
    var built = view.built = buildLineContent(cm, view);
    view.text = built.pre;
    removeChildrenAndAdd(cm.display.lineMeasure, built.pre);
    return view;
  }

  // Get a {top, bottom, left, right} box (in line-local coordinates)
  // for a given character.
  function measureChar(cm, line, ch, bias) {
    return measureCharPrepared(cm, prepareMeasureForLine(cm, line), ch, bias);
  }

  // Find a line view that corresponds to the given line number.
  function findViewForLine(cm, lineN) {
    if (lineN >= cm.display.viewFrom && lineN < cm.display.viewTo)
      return cm.display.view[findViewIndex(cm, lineN)];
    var ext = cm.display.externalMeasured;
    if (ext && lineN >= ext.lineN && lineN < ext.lineN + ext.size)
      return ext;
  }

  // Measurement can be split in two steps, the set-up work that
  // applies to the whole line, and the measurement of the actual
  // character. Functions like coordsChar, that need to do a lot of
  // measurements in a row, can thus ensure that the set-up work is
  // only done once.
  function prepareMeasureForLine(cm, line) {
    var lineN = lineNo(line);
    var view = findViewForLine(cm, lineN);
    if (view && !view.text) {
      view = null;
    } else if (view && view.changes) {
      updateLineForChanges(cm, view, lineN, getDimensions(cm));
      cm.curOp.forceUpdate = true;
    }
    if (!view)
      view = updateExternalMeasurement(cm, line);

    var info = mapFromLineView(view, line, lineN);
    return {
      line: line, view: view, rect: null,
      map: info.map, cache: info.cache, before: info.before,
      hasHeights: false
    };
  }

  // Given a prepared measurement object, measures the position of an
  // actual character (or fetches it from the cache).
  function measureCharPrepared(cm, prepared, ch, bias, varHeight) {
    if (prepared.before) ch = -1;
    var key = ch + (bias || ""), found;
    if (prepared.cache.hasOwnProperty(key)) {
      found = prepared.cache[key];
    } else {
      if (!prepared.rect)
        prepared.rect = prepared.view.text.getBoundingClientRect();
      if (!prepared.hasHeights) {
        ensureLineHeights(cm, prepared.view, prepared.rect);
        prepared.hasHeights = true;
      }
      found = measureCharInner(cm, prepared, ch, bias);
      if (!found.bogus) prepared.cache[key] = found;
    }
    return {left: found.left, right: found.right,
            top: varHeight ? found.rtop : found.top,
            bottom: varHeight ? found.rbottom : found.bottom};
  }

  var nullRect = {left: 0, right: 0, top: 0, bottom: 0};

  function nodeAndOffsetInLineMap(map, ch, bias) {
    var node, start, end, collapse;
    // First, search the line map for the text node corresponding to,
    // or closest to, the target character.
    for (var i = 0; i < map.length; i += 3) {
      var mStart = map[i], mEnd = map[i + 1];
      if (ch < mStart) {
        start = 0; end = 1;
        collapse = "left";
      } else if (ch < mEnd) {
        start = ch - mStart;
        end = start + 1;
      } else if (i == map.length - 3 || ch == mEnd && map[i + 3] > ch) {
        end = mEnd - mStart;
        start = end - 1;
        if (ch >= mEnd) collapse = "right";
      }
      if (start != null) {
        node = map[i + 2];
        if (mStart == mEnd && bias == (node.insertLeft ? "left" : "right"))
          collapse = bias;
        if (bias == "left" && start == 0)
          while (i && map[i - 2] == map[i - 3] && map[i - 1].insertLeft) {
            node = map[(i -= 3) + 2];
            collapse = "left";
          }
        if (bias == "right" && start == mEnd - mStart)
          while (i < map.length - 3 && map[i + 3] == map[i + 4] && !map[i + 5].insertLeft) {
            node = map[(i += 3) + 2];
            collapse = "right";
          }
        break;
      }
    }
    return {node: node, start: start, end: end, collapse: collapse, coverStart: mStart, coverEnd: mEnd};
  }

  function measureCharInner(cm, prepared, ch, bias) {
    var place = nodeAndOffsetInLineMap(prepared.map, ch, bias);
    var node = place.node, start = place.start, end = place.end, collapse = place.collapse;

    var rect;
    if (node.nodeType == 3) { // If it is a text node, use a range to retrieve the coordinates.
      for (var i = 0; i < 4; i++) { // Retry a maximum of 4 times when nonsense rectangles are returned
        while (start && isExtendingChar(prepared.line.text.charAt(place.coverStart + start))) --start;
        while (place.coverStart + end < place.coverEnd && isExtendingChar(prepared.line.text.charAt(place.coverStart + end))) ++end;
        if (ie && ie_version < 9 && start == 0 && end == place.coverEnd - place.coverStart) {
          rect = node.parentNode.getBoundingClientRect();
        } else if (ie && cm.options.lineWrapping) {
          var rects = range(node, start, end).getClientRects();
          if (rects.length)
            rect = rects[bias == "right" ? rects.length - 1 : 0];
          else
            rect = nullRect;
        } else {
          rect = range(node, start, end).getBoundingClientRect() || nullRect;
        }
        if (rect.left || rect.right || start == 0) break;
        end = start;
        start = start - 1;
        collapse = "right";
      }
      if (ie && ie_version < 11) rect = maybeUpdateRectForZooming(cm.display.measure, rect);
    } else { // If it is a widget, simply get the box for the whole widget.
      if (start > 0) collapse = bias = "right";
      var rects;
      if (cm.options.lineWrapping && (rects = node.getClientRects()).length > 1)
        rect = rects[bias == "right" ? rects.length - 1 : 0];
      else
        rect = node.getBoundingClientRect();
    }
    if (ie && ie_version < 9 && !start && (!rect || !rect.left && !rect.right)) {
      var rSpan = node.parentNode.getClientRects()[0];
      if (rSpan)
        rect = {left: rSpan.left, right: rSpan.left + charWidth(cm.display), top: rSpan.top, bottom: rSpan.bottom};
      else
        rect = nullRect;
    }

    var rtop = rect.top - prepared.rect.top, rbot = rect.bottom - prepared.rect.top;
    var mid = (rtop + rbot) / 2;
    var heights = prepared.view.measure.heights;
    for (var i = 0; i < heights.length - 1; i++)
      if (mid < heights[i]) break;
    var top = i ? heights[i - 1] : 0, bot = heights[i];
    var result = {left: (collapse == "right" ? rect.right : rect.left) - prepared.rect.left,
                  right: (collapse == "left" ? rect.left : rect.right) - prepared.rect.left,
                  top: top, bottom: bot};
    if (!rect.left && !rect.right) result.bogus = true;
    if (!cm.options.singleCursorHeightPerLine) { result.rtop = rtop; result.rbottom = rbot; }

    return result;
  }

  // Work around problem with bounding client rects on ranges being
  // returned incorrectly when zoomed on IE10 and below.
  function maybeUpdateRectForZooming(measure, rect) {
    if (!window.screen || screen.logicalXDPI == null ||
        screen.logicalXDPI == screen.deviceXDPI || !hasBadZoomedRects(measure))
      return rect;
    var scaleX = screen.logicalXDPI / screen.deviceXDPI;
    var scaleY = screen.logicalYDPI / screen.deviceYDPI;
    return {left: rect.left * scaleX, right: rect.right * scaleX,
            top: rect.top * scaleY, bottom: rect.bottom * scaleY};
  }

  function clearLineMeasurementCacheFor(lineView) {
    if (lineView.measure) {
      lineView.measure.cache = {};
      lineView.measure.heights = null;
      if (lineView.rest) for (var i = 0; i < lineView.rest.length; i++)
        lineView.measure.caches[i] = {};
    }
  }

  function clearLineMeasurementCache(cm) {
    cm.display.externalMeasure = null;
    removeChildren(cm.display.lineMeasure);
    for (var i = 0; i < cm.display.view.length; i++)
      clearLineMeasurementCacheFor(cm.display.view[i]);
  }

  function clearCaches(cm) {
    clearLineMeasurementCache(cm);
    cm.display.cachedCharWidth = cm.display.cachedTextHeight = cm.display.cachedPaddingH = null;
    if (!cm.options.lineWrapping) cm.display.maxLineChanged = true;
    cm.display.lineNumChars = null;
  }

  function pageScrollX() { return window.pageXOffset || (document.documentElement || document.body).scrollLeft; }
  function pageScrollY() { return window.pageYOffset || (document.documentElement || document.body).scrollTop; }

  // Converts a {top, bottom, left, right} box from line-local
  // coordinates into another coordinate system. Context may be one of
  // "line", "div" (display.lineDiv), "local"/null (editor), "window",
  // or "page".
  function intoCoordSystem(cm, lineObj, rect, context) {
    if (lineObj.widgets) for (var i = 0; i < lineObj.widgets.length; ++i) if (lineObj.widgets[i].above) {
      var size = widgetHeight(lineObj.widgets[i]);
      rect.top += size; rect.bottom += size;
    }
    if (context == "line") return rect;
    if (!context) context = "local";
    var yOff = heightAtLine(lineObj);
    if (context == "local") yOff += paddingTop(cm.display);
    else yOff -= cm.display.viewOffset;
    if (context == "page" || context == "window") {
      var lOff = cm.display.lineSpace.getBoundingClientRect();
      yOff += lOff.top + (context == "window" ? 0 : pageScrollY());
      var xOff = lOff.left + (context == "window" ? 0 : pageScrollX());
      rect.left += xOff; rect.right += xOff;
    }
    rect.top += yOff; rect.bottom += yOff;
    return rect;
  }

  // Coverts a box from "div" coords to another coordinate system.
  // Context may be "window", "page", "div", or "local"/null.
  function fromCoordSystem(cm, coords, context) {
    if (context == "div") return coords;
    var left = coords.left, top = coords.top;
    // First move into "page" coordinate system
    if (context == "page") {
      left -= pageScrollX();
      top -= pageScrollY();
    } else if (context == "local" || !context) {
      var localBox = cm.display.sizer.getBoundingClientRect();
      left += localBox.left;
      top += localBox.top;
    }

    var lineSpaceBox = cm.display.lineSpace.getBoundingClientRect();
    return {left: left - lineSpaceBox.left, top: top - lineSpaceBox.top};
  }

  function charCoords(cm, pos, context, lineObj, bias) {
    if (!lineObj) lineObj = getLine(cm.doc, pos.line);
    return intoCoordSystem(cm, lineObj, measureChar(cm, lineObj, pos.ch, bias), context);
  }

  // Returns a box for a given cursor position, which may have an
  // 'other' property containing the position of the secondary cursor
  // on a bidi boundary.
  function cursorCoords(cm, pos, context, lineObj, preparedMeasure, varHeight) {
    lineObj = lineObj || getLine(cm.doc, pos.line);
    if (!preparedMeasure) preparedMeasure = prepareMeasureForLine(cm, lineObj);
    function get(ch, right) {
      var m = measureCharPrepared(cm, preparedMeasure, ch, right ? "right" : "left", varHeight);
      if (right) m.left = m.right; else m.right = m.left;
      return intoCoordSystem(cm, lineObj, m, context);
    }
    function getBidi(ch, partPos) {
      var part = order[partPos], right = part.level % 2;
      if (ch == bidiLeft(part) && partPos && part.level < order[partPos - 1].level) {
        part = order[--partPos];
        ch = bidiRight(part) - (part.level % 2 ? 0 : 1);
        right = true;
      } else if (ch == bidiRight(part) && partPos < order.length - 1 && part.level < order[partPos + 1].level) {
        part = order[++partPos];
        ch = bidiLeft(part) - part.level % 2;
        right = false;
      }
      if (right && ch == part.to && ch > part.from) return get(ch - 1);
      return get(ch, right);
    }
    var order = getOrder(lineObj), ch = pos.ch;
    if (!order) return get(ch);
    var partPos = getBidiPartAt(order, ch);
    var val = getBidi(ch, partPos);
    if (bidiOther != null) val.other = getBidi(ch, bidiOther);
    return val;
  }

  // Used to cheaply estimate the coordinates for a position. Used for
  // intermediate scroll updates.
  function estimateCoords(cm, pos) {
    var left = 0, pos = clipPos(cm.doc, pos);
    if (!cm.options.lineWrapping) left = charWidth(cm.display) * pos.ch;
    var lineObj = getLine(cm.doc, pos.line);
    var top = heightAtLine(lineObj) + paddingTop(cm.display);
    return {left: left, right: left, top: top, bottom: top + lineObj.height};
  }

  // Positions returned by coordsChar contain some extra information.
  // xRel is the relative x position of the input coordinates compared
  // to the found position (so xRel > 0 means the coordinates are to
  // the right of the character position, for example). When outside
  // is true, that means the coordinates lie outside the line's
  // vertical range.
  function PosWithInfo(line, ch, outside, xRel) {
    var pos = Pos(line, ch);
    pos.xRel = xRel;
    if (outside) pos.outside = true;
    return pos;
  }

  // Compute the character position closest to the given coordinates.
  // Input must be lineSpace-local ("div" coordinate system).
  function coordsChar(cm, x, y) {
    var doc = cm.doc;
    y += cm.display.viewOffset;
    if (y < 0) return PosWithInfo(doc.first, 0, true, -1);
    var lineN = lineAtHeight(doc, y), last = doc.first + doc.size - 1;
    if (lineN > last)
      return PosWithInfo(doc.first + doc.size - 1, getLine(doc, last).text.length, true, 1);
    if (x < 0) x = 0;

    var lineObj = getLine(doc, lineN);
    for (;;) {
      var found = coordsCharInner(cm, lineObj, lineN, x, y);
      var merged = collapsedSpanAtEnd(lineObj);
      var mergedPos = merged && merged.find(0, true);
      if (merged && (found.ch > mergedPos.from.ch || found.ch == mergedPos.from.ch && found.xRel > 0))
        lineN = lineNo(lineObj = mergedPos.to.line);
      else
        return found;
    }
  }

  function coordsCharInner(cm, lineObj, lineNo, x, y) {
    var innerOff = y - heightAtLine(lineObj);
    var wrongLine = false, adjust = 2 * cm.display.wrapper.clientWidth;
    var preparedMeasure = prepareMeasureForLine(cm, lineObj);

    function getX(ch) {
      var sp = cursorCoords(cm, Pos(lineNo, ch), "line", lineObj, preparedMeasure);
      wrongLine = true;
      if (innerOff > sp.bottom) return sp.left - adjust;
      else if (innerOff < sp.top) return sp.left + adjust;
      else wrongLine = false;
      return sp.left;
    }

    var bidi = getOrder(lineObj), dist = lineObj.text.length;
    var from = lineLeft(lineObj), to = lineRight(lineObj);
    var fromX = getX(from), fromOutside = wrongLine, toX = getX(to), toOutside = wrongLine;

    if (x > toX) return PosWithInfo(lineNo, to, toOutside, 1);
    // Do a binary search between these bounds.
    for (;;) {
      if (bidi ? to == from || to == moveVisually(lineObj, from, 1) : to - from <= 1) {
        var ch = x < fromX || x - fromX <= toX - x ? from : to;
        var xDiff = x - (ch == from ? fromX : toX);
        while (isExtendingChar(lineObj.text.charAt(ch))) ++ch;
        var pos = PosWithInfo(lineNo, ch, ch == from ? fromOutside : toOutside,
                              xDiff < -1 ? -1 : xDiff > 1 ? 1 : 0);
        return pos;
      }
      var step = Math.ceil(dist / 2), middle = from + step;
      if (bidi) {
        middle = from;
        for (var i = 0; i < step; ++i) middle = moveVisually(lineObj, middle, 1);
      }
      var middleX = getX(middle);
      if (middleX > x) {to = middle; toX = middleX; if (toOutside = wrongLine) toX += 1000; dist = step;}
      else {from = middle; fromX = middleX; fromOutside = wrongLine; dist -= step;}
    }
  }

  var measureText;
  // Compute the default text height.
  function textHeight(display) {
    if (display.cachedTextHeight != null) return display.cachedTextHeight;
    if (measureText == null) {
      measureText = elt("pre");
      // Measure a bunch of lines, for browsers that compute
      // fractional heights.
      for (var i = 0; i < 49; ++i) {
        measureText.appendChild(document.createTextNode("x"));
        measureText.appendChild(elt("br"));
      }
      measureText.appendChild(document.createTextNode("x"));
    }
    removeChildrenAndAdd(display.measure, measureText);
    var height = measureText.offsetHeight / 50;
    if (height > 3) display.cachedTextHeight = height;
    removeChildren(display.measure);
    return height || 1;
  }

  // Compute the default character width.
  function charWidth(display) {
    if (display.cachedCharWidth != null) return display.cachedCharWidth;
    var anchor = elt("span", "xxxxxxxxxx");
    var pre = elt("pre", [anchor]);
    removeChildrenAndAdd(display.measure, pre);
    var rect = anchor.getBoundingClientRect(), width = (rect.right - rect.left) / 10;
    if (width > 2) display.cachedCharWidth = width;
    return width || 10;
  }

  // OPERATIONS

  // Operations are used to wrap a series of changes to the editor
  // state in such a way that each change won't have to update the
  // cursor and display (which would be awkward, slow, and
  // error-prone). Instead, display updates are batched and then all
  // combined and executed at once.

  var operationGroup = null;

  var nextOpId = 0;
  // Start a new operation.
  function startOperation(cm) {
    cm.curOp = {
      cm: cm,
      viewChanged: false,      // Flag that indicates that lines might need to be redrawn
      startHeight: cm.doc.height, // Used to detect need to update scrollbar
      forceUpdate: false,      // Used to force a redraw
      updateInput: null,       // Whether to reset the input textarea
      typing: false,           // Whether this reset should be careful to leave existing text (for compositing)
      changeObjs: null,        // Accumulated changes, for firing change events
      cursorActivityHandlers: null, // Set of handlers to fire cursorActivity on
      cursorActivityCalled: 0, // Tracks which cursorActivity handlers have been called already
      selectionChanged: false, // Whether the selection needs to be redrawn
      updateMaxLine: false,    // Set when the widest line needs to be determined anew
      scrollLeft: null, scrollTop: null, // Intermediate scroll position, not pushed to DOM yet
      scrollToPos: null,       // Used to scroll to a specific position
      focus: false,
      id: ++nextOpId           // Unique ID
    };
    if (operationGroup) {
      operationGroup.ops.push(cm.curOp);
    } else {
      cm.curOp.ownsGroup = operationGroup = {
        ops: [cm.curOp],
        delayedCallbacks: []
      };
    }
  }

  function fireCallbacksForOps(group) {
    // Calls delayed callbacks and cursorActivity handlers until no
    // new ones appear
    var callbacks = group.delayedCallbacks, i = 0;
    do {
      for (; i < callbacks.length; i++)
        callbacks[i].call(null);
      for (var j = 0; j < group.ops.length; j++) {
        var op = group.ops[j];
        if (op.cursorActivityHandlers)
          while (op.cursorActivityCalled < op.cursorActivityHandlers.length)
            op.cursorActivityHandlers[op.cursorActivityCalled++].call(null, op.cm);
      }
    } while (i < callbacks.length);
  }

  // Finish an operation, updating the display and signalling delayed events
  function endOperation(cm) {
    var op = cm.curOp, group = op.ownsGroup;
    if (!group) return;

    try { fireCallbacksForOps(group); }
    finally {
      operationGroup = null;
      for (var i = 0; i < group.ops.length; i++)
        group.ops[i].cm.curOp = null;
      endOperations(group);
    }
  }

  // The DOM updates done when an operation finishes are batched so
  // that the minimum number of relayouts are required.
  function endOperations(group) {
    var ops = group.ops;
    for (var i = 0; i < ops.length; i++) // Read DOM
      endOperation_R1(ops[i]);
    for (var i = 0; i < ops.length; i++) // Write DOM (maybe)
      endOperation_W1(ops[i]);
    for (var i = 0; i < ops.length; i++) // Read DOM
      endOperation_R2(ops[i]);
    for (var i = 0; i < ops.length; i++) // Write DOM (maybe)
      endOperation_W2(ops[i]);
    for (var i = 0; i < ops.length; i++) // Read DOM
      endOperation_finish(ops[i]);
  }

  function endOperation_R1(op) {
    var cm = op.cm, display = cm.display;
    maybeClipScrollbars(cm);
    if (op.updateMaxLine) findMaxLine(cm);

    op.mustUpdate = op.viewChanged || op.forceUpdate || op.scrollTop != null ||
      op.scrollToPos && (op.scrollToPos.from.line < display.viewFrom ||
                         op.scrollToPos.to.line >= display.viewTo) ||
      display.maxLineChanged && cm.options.lineWrapping;
    op.update = op.mustUpdate &&
      new DisplayUpdate(cm, op.mustUpdate && {top: op.scrollTop, ensure: op.scrollToPos}, op.forceUpdate);
  }

  function endOperation_W1(op) {
    op.updatedDisplay = op.mustUpdate && updateDisplayIfNeeded(op.cm, op.update);
  }

  function endOperation_R2(op) {
    var cm = op.cm, display = cm.display;
    if (op.updatedDisplay) updateHeightsInViewport(cm);

    op.barMeasure = measureForScrollbars(cm);

    // If the max line changed since it was last measured, measure it,
    // and ensure the document's width matches it.
    // updateDisplay_W2 will use these properties to do the actual resizing
    if (display.maxLineChanged && !cm.options.lineWrapping) {
      op.adjustWidthTo = measureChar(cm, display.maxLine, display.maxLine.text.length).left + 3;
      cm.display.sizerWidth = op.adjustWidthTo;
      op.barMeasure.scrollWidth =
        Math.max(display.scroller.clientWidth, display.sizer.offsetLeft + op.adjustWidthTo + scrollGap(cm) + cm.display.barWidth);
      op.maxScrollLeft = Math.max(0, display.sizer.offsetLeft + op.adjustWidthTo - displayWidth(cm));
    }

    if (op.updatedDisplay || op.selectionChanged)
      op.preparedSelection = display.input.prepareSelection();
  }

  function endOperation_W2(op) {
    var cm = op.cm;

    if (op.adjustWidthTo != null) {
      cm.display.sizer.style.minWidth = op.adjustWidthTo + "px";
      if (op.maxScrollLeft < cm.doc.scrollLeft)
        setScrollLeft(cm, Math.min(cm.display.scroller.scrollLeft, op.maxScrollLeft), true);
      cm.display.maxLineChanged = false;
    }

    if (op.preparedSelection)
      cm.display.input.showSelection(op.preparedSelection);
    if (op.updatedDisplay)
      setDocumentHeight(cm, op.barMeasure);
    if (op.updatedDisplay || op.startHeight != cm.doc.height)
      updateScrollbars(cm, op.barMeasure);

    if (op.selectionChanged) restartBlink(cm);

    if (cm.state.focused && op.updateInput)
      cm.display.input.reset(op.typing);
    if (op.focus && op.focus == activeElt()) ensureFocus(op.cm);
  }

  function endOperation_finish(op) {
    var cm = op.cm, display = cm.display, doc = cm.doc;

    if (op.updatedDisplay) postUpdateDisplay(cm, op.update);

    // Abort mouse wheel delta measurement, when scrolling explicitly
    if (display.wheelStartX != null && (op.scrollTop != null || op.scrollLeft != null || op.scrollToPos))
      display.wheelStartX = display.wheelStartY = null;

    // Propagate the scroll position to the actual DOM scroller
    if (op.scrollTop != null && (display.scroller.scrollTop != op.scrollTop || op.forceScroll)) {
      doc.scrollTop = Math.max(0, Math.min(display.scroller.scrollHeight - display.scroller.clientHeight, op.scrollTop));
      display.scrollbars.setScrollTop(doc.scrollTop);
      display.scroller.scrollTop = doc.scrollTop;
    }
    if (op.scrollLeft != null && (display.scroller.scrollLeft != op.scrollLeft || op.forceScroll)) {
      doc.scrollLeft = Math.max(0, Math.min(display.scroller.scrollWidth - displayWidth(cm), op.scrollLeft));
      display.scrollbars.setScrollLeft(doc.scrollLeft);
      display.scroller.scrollLeft = doc.scrollLeft;
      alignHorizontally(cm);
    }
    // If we need to scroll a specific position into view, do so.
    if (op.scrollToPos) {
      var coords = scrollPosIntoView(cm, clipPos(doc, op.scrollToPos.from),
                                     clipPos(doc, op.scrollToPos.to), op.scrollToPos.margin);
      if (op.scrollToPos.isCursor && cm.state.focused) maybeScrollWindow(cm, coords);
    }

    // Fire events for markers that are hidden/unidden by editing or
    // undoing
    var hidden = op.maybeHiddenMarkers, unhidden = op.maybeUnhiddenMarkers;
    if (hidden) for (var i = 0; i < hidden.length; ++i)
      if (!hidden[i].lines.length) signal(hidden[i], "hide");
    if (unhidden) for (var i = 0; i < unhidden.length; ++i)
      if (unhidden[i].lines.length) signal(unhidden[i], "unhide");

    if (display.wrapper.offsetHeight)
      doc.scrollTop = cm.display.scroller.scrollTop;

    // Fire change events, and delayed event handlers
    if (op.changeObjs)
      signal(cm, "changes", cm, op.changeObjs);
    if (op.update)
      op.update.finish();
  }

  // Run the given function in an operation
  function runInOp(cm, f) {
    if (cm.curOp) return f();
    startOperation(cm);
    try { return f(); }
    finally { endOperation(cm); }
  }
  // Wraps a function in an operation. Returns the wrapped function.
  function operation(cm, f) {
    return function() {
      if (cm.curOp) return f.apply(cm, arguments);
      startOperation(cm);
      try { return f.apply(cm, arguments); }
      finally { endOperation(cm); }
    };
  }
  // Used to add methods to editor and doc instances, wrapping them in
  // operations.
  function methodOp(f) {
    return function() {
      if (this.curOp) return f.apply(this, arguments);
      startOperation(this);
      try { return f.apply(this, arguments); }
      finally { endOperation(this); }
    };
  }
  function docMethodOp(f) {
    return function() {
      var cm = this.cm;
      if (!cm || cm.curOp) return f.apply(this, arguments);
      startOperation(cm);
      try { return f.apply(this, arguments); }
      finally { endOperation(cm); }
    };
  }

  // VIEW TRACKING

  // These objects are used to represent the visible (currently drawn)
  // part of the document. A LineView may correspond to multiple
  // logical lines, if those are connected by collapsed ranges.
  function LineView(doc, line, lineN) {
    // The starting line
    this.line = line;
    // Continuing lines, if any
    this.rest = visualLineContinued(line);
    // Number of logical lines in this visual line
    this.size = this.rest ? lineNo(lst(this.rest)) - lineN + 1 : 1;
    this.node = this.text = null;
    this.hidden = lineIsHidden(doc, line);
  }

  // Create a range of LineView objects for the given lines.
  function buildViewArray(cm, from, to) {
    var array = [], nextPos;
    for (var pos = from; pos < to; pos = nextPos) {
      var view = new LineView(cm.doc, getLine(cm.doc, pos), pos);
      nextPos = pos + view.size;
      array.push(view);
    }
    return array;
  }

  // Updates the display.view data structure for a given change to the
  // document. From and to are in pre-change coordinates. Lendiff is
  // the amount of lines added or subtracted by the change. This is
  // used for changes that span multiple lines, or change the way
  // lines are divided into visual lines. regLineChange (below)
  // registers single-line changes.
  function regChange(cm, from, to, lendiff) {
    if (from == null) from = cm.doc.first;
    if (to == null) to = cm.doc.first + cm.doc.size;
    if (!lendiff) lendiff = 0;

    var display = cm.display;
    if (lendiff && to < display.viewTo &&
        (display.updateLineNumbers == null || display.updateLineNumbers > from))
      display.updateLineNumbers = from;

    cm.curOp.viewChanged = true;

    if (from >= display.viewTo) { // Change after
      if (sawCollapsedSpans && visualLineNo(cm.doc, from) < display.viewTo)
        resetView(cm);
    } else if (to <= display.viewFrom) { // Change before
      if (sawCollapsedSpans && visualLineEndNo(cm.doc, to + lendiff) > display.viewFrom) {
        resetView(cm);
      } else {
        display.viewFrom += lendiff;
        display.viewTo += lendiff;
      }
    } else if (from <= display.viewFrom && to >= display.viewTo) { // Full overlap
      resetView(cm);
    } else if (from <= display.viewFrom) { // Top overlap
      var cut = viewCuttingPoint(cm, to, to + lendiff, 1);
      if (cut) {
        display.view = display.view.slice(cut.index);
        display.viewFrom = cut.lineN;
        display.viewTo += lendiff;
      } else {
        resetView(cm);
      }
    } else if (to >= display.viewTo) { // Bottom overlap
      var cut = viewCuttingPoint(cm, from, from, -1);
      if (cut) {
        display.view = display.view.slice(0, cut.index);
        display.viewTo = cut.lineN;
      } else {
        resetView(cm);
      }
    } else { // Gap in the middle
      var cutTop = viewCuttingPoint(cm, from, from, -1);
      var cutBot = viewCuttingPoint(cm, to, to + lendiff, 1);
      if (cutTop && cutBot) {
        display.view = display.view.slice(0, cutTop.index)
          .concat(buildViewArray(cm, cutTop.lineN, cutBot.lineN))
          .concat(display.view.slice(cutBot.index));
        display.viewTo += lendiff;
      } else {
        resetView(cm);
      }
    }

    var ext = display.externalMeasured;
    if (ext) {
      if (to < ext.lineN)
        ext.lineN += lendiff;
      else if (from < ext.lineN + ext.size)
        display.externalMeasured = null;
    }
  }

  // Register a change to a single line. Type must be one of "text",
  // "gutter", "class", "widget"
  function regLineChange(cm, line, type) {
    cm.curOp.viewChanged = true;
    var display = cm.display, ext = cm.display.externalMeasured;
    if (ext && line >= ext.lineN && line < ext.lineN + ext.size)
      display.externalMeasured = null;

    if (line < display.viewFrom || line >= display.viewTo) return;
    var lineView = display.view[findViewIndex(cm, line)];
    if (lineView.node == null) return;
    var arr = lineView.changes || (lineView.changes = []);
    if (indexOf(arr, type) == -1) arr.push(type);
  }

  // Clear the view.
  function resetView(cm) {
    cm.display.viewFrom = cm.display.viewTo = cm.doc.first;
    cm.display.view = [];
    cm.display.viewOffset = 0;
  }

  // Find the view element corresponding to a given line. Return null
  // when the line isn't visible.
  function findViewIndex(cm, n) {
    if (n >= cm.display.viewTo) return null;
    n -= cm.display.viewFrom;
    if (n < 0) return null;
    var view = cm.display.view;
    for (var i = 0; i < view.length; i++) {
      n -= view[i].size;
      if (n < 0) return i;
    }
  }

  function viewCuttingPoint(cm, oldN, newN, dir) {
    var index = findViewIndex(cm, oldN), diff, view = cm.display.view;
    if (!sawCollapsedSpans || newN == cm.doc.first + cm.doc.size)
      return {index: index, lineN: newN};
    for (var i = 0, n = cm.display.viewFrom; i < index; i++)
      n += view[i].size;
    if (n != oldN) {
      if (dir > 0) {
        if (index == view.length - 1) return null;
        diff = (n + view[index].size) - oldN;
        index++;
      } else {
        diff = n - oldN;
      }
      oldN += diff; newN += diff;
    }
    while (visualLineNo(cm.doc, newN) != newN) {
      if (index == (dir < 0 ? 0 : view.length - 1)) return null;
      newN += dir * view[index - (dir < 0 ? 1 : 0)].size;
      index += dir;
    }
    return {index: index, lineN: newN};
  }

  // Force the view to cover a given range, adding empty view element
  // or clipping off existing ones as needed.
  function adjustView(cm, from, to) {
    var display = cm.display, view = display.view;
    if (view.length == 0 || from >= display.viewTo || to <= display.viewFrom) {
      display.view = buildViewArray(cm, from, to);
      display.viewFrom = from;
    } else {
      if (display.viewFrom > from)
        display.view = buildViewArray(cm, from, display.viewFrom).concat(display.view);
      else if (display.viewFrom < from)
        display.view = display.view.slice(findViewIndex(cm, from));
      display.viewFrom = from;
      if (display.viewTo < to)
        display.view = display.view.concat(buildViewArray(cm, display.viewTo, to));
      else if (display.viewTo > to)
        display.view = display.view.slice(0, findViewIndex(cm, to));
    }
    display.viewTo = to;
  }

  // Count the number of lines in the view whose DOM representation is
  // out of date (or nonexistent).
  function countDirtyView(cm) {
    var view = cm.display.view, dirty = 0;
    for (var i = 0; i < view.length; i++) {
      var lineView = view[i];
      if (!lineView.hidden && (!lineView.node || lineView.changes)) ++dirty;
    }
    return dirty;
  }

  // EVENT HANDLERS

  // Attach the necessary event handlers when initializing the editor
  function registerEventHandlers(cm) {
    var d = cm.display;
    on(d.scroller, "mousedown", operation(cm, onMouseDown));
    // Older IE's will not fire a second mousedown for a double click
    if (ie && ie_version < 11)
      on(d.scroller, "dblclick", operation(cm, function(e) {
        if (signalDOMEvent(cm, e)) return;
        var pos = posFromMouse(cm, e);
        if (!pos || clickInGutter(cm, e) || eventInWidget(cm.display, e)) return;
        e_preventDefault(e);
        var word = cm.findWordAt(pos);
        extendSelection(cm.doc, word.anchor, word.head);
      }));
    else
      on(d.scroller, "dblclick", function(e) { signalDOMEvent(cm, e) || e_preventDefault(e); });
    // Some browsers fire contextmenu *after* opening the menu, at
    // which point we can't mess with it anymore. Context menu is
    // handled in onMouseDown for these browsers.
    if (!captureRightClick) on(d.scroller, "contextmenu", function(e) {onContextMenu(cm, e);});

    // Used to suppress mouse event handling when a touch happens
    var touchFinished, prevTouch = {end: 0};
    function finishTouch() {
      if (d.activeTouch) {
        touchFinished = setTimeout(function() {d.activeTouch = null;}, 1000);
        prevTouch = d.activeTouch;
        prevTouch.end = +new Date;
      }
    };
    function isMouseLikeTouchEvent(e) {
      if (e.touches.length != 1) return false;
      var touch = e.touches[0];
      return touch.radiusX <= 1 && touch.radiusY <= 1;
    }
    function farAway(touch, other) {
      if (other.left == null) return true;
      var dx = other.left - touch.left, dy = other.top - touch.top;
      return dx * dx + dy * dy > 20 * 20;
    }
    on(d.scroller, "touchstart", function(e) {
      if (!isMouseLikeTouchEvent(e)) {
        clearTimeout(touchFinished);
        var now = +new Date;
        d.activeTouch = {start: now, moved: false,
                         prev: now - prevTouch.end <= 300 ? prevTouch : null};
        if (e.touches.length == 1) {
          d.activeTouch.left = e.touches[0].pageX;
          d.activeTouch.top = e.touches[0].pageY;
        }
      }
    });
    on(d.scroller, "touchmove", function() {
      if (d.activeTouch) d.activeTouch.moved = true;
    });
    on(d.scroller, "touchend", function(e) {
      var touch = d.activeTouch;
      if (touch && !eventInWidget(d, e) && touch.left != null &&
          !touch.moved && new Date - touch.start < 300) {
        var pos = cm.coordsChar(d.activeTouch, "page"), range;
        if (!touch.prev || farAway(touch, touch.prev)) // Single tap
          range = new Range(pos, pos);
        else if (!touch.prev.prev || farAway(touch, touch.prev.prev)) // Double tap
          range = cm.findWordAt(pos);
        else // Triple tap
          range = new Range(Pos(pos.line, 0), clipPos(cm.doc, Pos(pos.line + 1, 0)));
        cm.setSelection(range.anchor, range.head);
        cm.focus();
        e_preventDefault(e);
      }
      finishTouch();
    });
    on(d.scroller, "touchcancel", finishTouch);

    // Sync scrolling between fake scrollbars and real scrollable
    // area, ensure viewport is updated when scrolling.
    on(d.scroller, "scroll", function() {
      if (d.scroller.clientHeight) {
        setScrollTop(cm, d.scroller.scrollTop);
        setScrollLeft(cm, d.scroller.scrollLeft, true);
        signal(cm, "scroll", cm);
      }
    });

    // Listen to wheel events in order to try and update the viewport on time.
    on(d.scroller, "mousewheel", function(e){onScrollWheel(cm, e);});
    on(d.scroller, "DOMMouseScroll", function(e){onScrollWheel(cm, e);});

    // Prevent wrapper from ever scrolling
    on(d.wrapper, "scroll", function() { d.wrapper.scrollTop = d.wrapper.scrollLeft = 0; });

    d.dragFunctions = {
      enter: function(e) {if (!signalDOMEvent(cm, e)) e_stop(e);},
      over: function(e) {if (!signalDOMEvent(cm, e)) { onDragOver(cm, e); e_stop(e); }},
      start: function(e){onDragStart(cm, e);},
      drop: operation(cm, onDrop),
      leave: function() {clearDragCursor(cm);}
    };

    var inp = d.input.getField();
    on(inp, "keyup", function(e) { onKeyUp.call(cm, e); });
    on(inp, "keydown", operation(cm, onKeyDown));
    on(inp, "keypress", operation(cm, onKeyPress));
    on(inp, "focus", bind(onFocus, cm));
    on(inp, "blur", bind(onBlur, cm));
  }

  function dragDropChanged(cm, value, old) {
    var wasOn = old && old != CodeMirror.Init;
    if (!value != !wasOn) {
      var funcs = cm.display.dragFunctions;
      var toggle = value ? on : off;
      toggle(cm.display.scroller, "dragstart", funcs.start);
      toggle(cm.display.scroller, "dragenter", funcs.enter);
      toggle(cm.display.scroller, "dragover", funcs.over);
      toggle(cm.display.scroller, "dragleave", funcs.leave);
      toggle(cm.display.scroller, "drop", funcs.drop);
    }
  }

  // Called when the window resizes
  function onResize(cm) {
    var d = cm.display;
    if (d.lastWrapHeight == d.wrapper.clientHeight && d.lastWrapWidth == d.wrapper.clientWidth)
      return;
    // Might be a text scaling operation, clear size caches.
    d.cachedCharWidth = d.cachedTextHeight = d.cachedPaddingH = null;
    d.scrollbarsClipped = false;
    cm.setSize();
  }

  // MOUSE EVENTS

  // Return true when the given mouse event happened in a widget
  function eventInWidget(display, e) {
    for (var n = e_target(e); n != display.wrapper; n = n.parentNode) {
      if (!n || (n.nodeType == 1 && n.getAttribute("cm-ignore-events") == "true") ||
          (n.parentNode == display.sizer && n != display.mover))
        return true;
    }
  }

  // Given a mouse event, find the corresponding position. If liberal
  // is false, it checks whether a gutter or scrollbar was clicked,
  // and returns null if it was. forRect is used by rectangular
  // selections, and tries to estimate a character position even for
  // coordinates beyond the right of the text.
  function posFromMouse(cm, e, liberal, forRect) {
    var display = cm.display;
    if (!liberal && e_target(e).getAttribute("cm-not-content") == "true") return null;

    var x, y, space = display.lineSpace.getBoundingClientRect();
    // Fails unpredictably on IE[67] when mouse is dragged around quickly.
    try { x = e.clientX - space.left; y = e.clientY - space.top; }
    catch (e) { return null; }
    var coords = coordsChar(cm, x, y), line;
    if (forRect && coords.xRel == 1 && (line = getLine(cm.doc, coords.line).text).length == coords.ch) {
      var colDiff = countColumn(line, line.length, cm.options.tabSize) - line.length;
      coords = Pos(coords.line, Math.max(0, Math.round((x - paddingH(cm.display).left) / charWidth(cm.display)) - colDiff));
    }
    return coords;
  }

  // A mouse down can be a single click, double click, triple click,
  // start of selection drag, start of text drag, new cursor
  // (ctrl-click), rectangle drag (alt-drag), or xwin
  // middle-click-paste. Or it might be a click on something we should
  // not interfere with, such as a scrollbar or widget.
  function onMouseDown(e) {
    var cm = this, display = cm.display;
    if (display.activeTouch && display.input.supportsTouch() || signalDOMEvent(cm, e)) return;
    display.shift = e.shiftKey;

    if (eventInWidget(display, e)) {
      if (!webkit) {
        // Briefly turn off draggability, to allow widgets to do
        // normal dragging things.
        display.scroller.draggable = false;
        setTimeout(function(){display.scroller.draggable = true;}, 100);
      }
      return;
    }
    if (clickInGutter(cm, e)) return;
    var start = posFromMouse(cm, e);
    window.focus();

    switch (e_button(e)) {
    case 1:
      // #3261: make sure, that we're not starting a second selection
      if (cm.state.selectingText)
        cm.state.selectingText(e);
      else if (start)
        leftButtonDown(cm, e, start);
      else if (e_target(e) == display.scroller)
        e_preventDefault(e);
      break;
    case 2:
      if (webkit) cm.state.lastMiddleDown = +new Date;
      if (start) extendSelection(cm.doc, start);
      setTimeout(function() {display.input.focus();}, 20);
      e_preventDefault(e);
      break;
    case 3:
      if (captureRightClick) onContextMenu(cm, e);
      else delayBlurEvent(cm);
      break;
    }
  }

  var lastClick, lastDoubleClick;
  function leftButtonDown(cm, e, start) {
    if (ie) setTimeout(bind(ensureFocus, cm), 0);
    else cm.curOp.focus = activeElt();

    var now = +new Date, type;
    if (lastDoubleClick && lastDoubleClick.time > now - 400 && cmp(lastDoubleClick.pos, start) == 0) {
      type = "triple";
    } else if (lastClick && lastClick.time > now - 400 && cmp(lastClick.pos, start) == 0) {
      type = "double";
      lastDoubleClick = {time: now, pos: start};
    } else {
      type = "single";
      lastClick = {time: now, pos: start};
    }

    var sel = cm.doc.sel, modifier = mac ? e.metaKey : e.ctrlKey, contained;
    if (cm.options.dragDrop && dragAndDrop && !isReadOnly(cm) &&
        type == "single" && (contained = sel.contains(start)) > -1 &&
        (cmp((contained = sel.ranges[contained]).from(), start) < 0 || start.xRel > 0) &&
        (cmp(contained.to(), start) > 0 || start.xRel < 0))
      leftButtonStartDrag(cm, e, start, modifier);
    else
      leftButtonSelect(cm, e, start, type, modifier);
  }

  // Start a text drag. When it ends, see if any dragging actually
  // happen, and treat as a click if it didn't.
  function leftButtonStartDrag(cm, e, start, modifier) {
    var display = cm.display, startTime = +new Date;
    var dragEnd = operation(cm, function(e2) {
      if (webkit) display.scroller.draggable = false;
      cm.state.draggingText = false;
      off(document, "mouseup", dragEnd);
      off(display.scroller, "drop", dragEnd);
      if (Math.abs(e.clientX - e2.clientX) + Math.abs(e.clientY - e2.clientY) < 10) {
        e_preventDefault(e2);
        if (!modifier && +new Date - 200 < startTime)
          extendSelection(cm.doc, start);
        // Work around unexplainable focus problem in IE9 (#2127) and Chrome (#3081)
        if (webkit || ie && ie_version == 9)
          setTimeout(function() {document.body.focus(); display.input.focus();}, 20);
        else
          display.input.focus();
      }
    });
    // Let the drag handler handle this.
    if (webkit) display.scroller.draggable = true;
    cm.state.draggingText = dragEnd;
    // IE's approach to draggable
    if (display.scroller.dragDrop) display.scroller.dragDrop();
    on(document, "mouseup", dragEnd);
    on(display.scroller, "drop", dragEnd);
  }

  // Normal selection, as opposed to text dragging.
  function leftButtonSelect(cm, e, start, type, addNew) {
    var display = cm.display, doc = cm.doc;
    e_preventDefault(e);

    var ourRange, ourIndex, startSel = doc.sel, ranges = startSel.ranges;
    if (addNew && !e.shiftKey) {
      ourIndex = doc.sel.contains(start);
      if (ourIndex > -1)
        ourRange = ranges[ourIndex];
      else
        ourRange = new Range(start, start);
    } else {
      ourRange = doc.sel.primary();
      ourIndex = doc.sel.primIndex;
    }

    if (e.altKey) {
      type = "rect";
      if (!addNew) ourRange = new Range(start, start);
      start = posFromMouse(cm, e, true, true);
      ourIndex = -1;
    } else if (type == "double") {
      var word = cm.findWordAt(start);
      if (cm.display.shift || doc.extend)
        ourRange = extendRange(doc, ourRange, word.anchor, word.head);
      else
        ourRange = word;
    } else if (type == "triple") {
      var line = new Range(Pos(start.line, 0), clipPos(doc, Pos(start.line + 1, 0)));
      if (cm.display.shift || doc.extend)
        ourRange = extendRange(doc, ourRange, line.anchor, line.head);
      else
        ourRange = line;
    } else {
      ourRange = extendRange(doc, ourRange, start);
    }

    if (!addNew) {
      ourIndex = 0;
      setSelection(doc, new Selection([ourRange], 0), sel_mouse);
      startSel = doc.sel;
    } else if (ourIndex == -1) {
      ourIndex = ranges.length;
      setSelection(doc, normalizeSelection(ranges.concat([ourRange]), ourIndex),
                   {scroll: false, origin: "*mouse"});
    } else if (ranges.length > 1 && ranges[ourIndex].empty() && type == "single" && !e.shiftKey) {
      setSelection(doc, normalizeSelection(ranges.slice(0, ourIndex).concat(ranges.slice(ourIndex + 1)), 0),
                   {scroll: false, origin: "*mouse"});
      startSel = doc.sel;
    } else {
      replaceOneSelection(doc, ourIndex, ourRange, sel_mouse);
    }

    var lastPos = start;
    function extendTo(pos) {
      if (cmp(lastPos, pos) == 0) return;
      lastPos = pos;

      if (type == "rect") {
        var ranges = [], tabSize = cm.options.tabSize;
        var startCol = countColumn(getLine(doc, start.line).text, start.ch, tabSize);
        var posCol = countColumn(getLine(doc, pos.line).text, pos.ch, tabSize);
        var left = Math.min(startCol, posCol), right = Math.max(startCol, posCol);
        for (var line = Math.min(start.line, pos.line), end = Math.min(cm.lastLine(), Math.max(start.line, pos.line));
             line <= end; line++) {
          var text = getLine(doc, line).text, leftPos = findColumn(text, left, tabSize);
          if (left == right)
            ranges.push(new Range(Pos(line, leftPos), Pos(line, leftPos)));
          else if (text.length > leftPos)
            ranges.push(new Range(Pos(line, leftPos), Pos(line, findColumn(text, right, tabSize))));
        }
        if (!ranges.length) ranges.push(new Range(start, start));
        setSelection(doc, normalizeSelection(startSel.ranges.slice(0, ourIndex).concat(ranges), ourIndex),
                     {origin: "*mouse", scroll: false});
        cm.scrollIntoView(pos);
      } else {
        var oldRange = ourRange;
        var anchor = oldRange.anchor, head = pos;
        if (type != "single") {
          if (type == "double")
            var range = cm.findWordAt(pos);
          else
            var range = new Range(Pos(pos.line, 0), clipPos(doc, Pos(pos.line + 1, 0)));
          if (cmp(range.anchor, anchor) > 0) {
            head = range.head;
            anchor = minPos(oldRange.from(), range.anchor);
          } else {
            head = range.anchor;
            anchor = maxPos(oldRange.to(), range.head);
          }
        }
        var ranges = startSel.ranges.slice(0);
        ranges[ourIndex] = new Range(clipPos(doc, anchor), head);
        setSelection(doc, normalizeSelection(ranges, ourIndex), sel_mouse);
      }
    }

    var editorSize = display.wrapper.getBoundingClientRect();
    // Used to ensure timeout re-tries don't fire when another extend
    // happened in the meantime (clearTimeout isn't reliable -- at
    // least on Chrome, the timeouts still happen even when cleared,
    // if the clear happens after their scheduled firing time).
    var counter = 0;

    function extend(e) {
      var curCount = ++counter;
      var cur = posFromMouse(cm, e, true, type == "rect");
      if (!cur) return;
      if (cmp(cur, lastPos) != 0) {
        cm.curOp.focus = activeElt();
        extendTo(cur);
        var visible = visibleLines(display, doc);
        if (cur.line >= visible.to || cur.line < visible.from)
          setTimeout(operation(cm, function(){if (counter == curCount) extend(e);}), 150);
      } else {
        var outside = e.clientY < editorSize.top ? -20 : e.clientY > editorSize.bottom ? 20 : 0;
        if (outside) setTimeout(operation(cm, function() {
          if (counter != curCount) return;
          display.scroller.scrollTop += outside;
          extend(e);
        }), 50);
      }
    }

    function done(e) {
      cm.state.selectingText = false;
      counter = Infinity;
      e_preventDefault(e);
      display.input.focus();
      off(document, "mousemove", move);
      off(document, "mouseup", up);
      doc.history.lastSelOrigin = null;
    }

    var move = operation(cm, function(e) {
      if (!e_button(e)) done(e);
      else extend(e);
    });
    var up = operation(cm, done);
    cm.state.selectingText = up;
    on(document, "mousemove", move);
    on(document, "mouseup", up);
  }

  // Determines whether an event happened in the gutter, and fires the
  // handlers for the corresponding event.
  function gutterEvent(cm, e, type, prevent, signalfn) {
    try { var mX = e.clientX, mY = e.clientY; }
    catch(e) { return false; }
    if (mX >= Math.floor(cm.display.gutters.getBoundingClientRect().right)) return false;
    if (prevent) e_preventDefault(e);

    var display = cm.display;
    var lineBox = display.lineDiv.getBoundingClientRect();

    if (mY > lineBox.bottom || !hasHandler(cm, type)) return e_defaultPrevented(e);
    mY -= lineBox.top - display.viewOffset;

    for (var i = 0; i < cm.options.gutters.length; ++i) {
      var g = display.gutters.childNodes[i];
      if (g && g.getBoundingClientRect().right >= mX) {
        var line = lineAtHeight(cm.doc, mY);
        var gutter = cm.options.gutters[i];
        signalfn(cm, type, cm, line, gutter, e);
        return e_defaultPrevented(e);
      }
    }
  }

  function clickInGutter(cm, e) {
    return gutterEvent(cm, e, "gutterClick", true, signalLater);
  }

  // Kludge to work around strange IE behavior where it'll sometimes
  // re-fire a series of drag-related events right after the drop (#1551)
  var lastDrop = 0;

  function onDrop(e) {
    var cm = this;
    clearDragCursor(cm);
    if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e))
      return;
    e_preventDefault(e);
    if (ie) lastDrop = +new Date;
    var pos = posFromMouse(cm, e, true), files = e.dataTransfer.files;
    if (!pos || isReadOnly(cm)) return;
    // Might be a file drop, in which case we simply extract the text
    // and insert it.
    if (files && files.length && window.FileReader && window.File) {
      var n = files.length, text = Array(n), read = 0;
      var loadFile = function(file, i) {
        if (cm.options.allowDropFileTypes &&
            indexOf(cm.options.allowDropFileTypes, file.type) == -1)
          return;

        var reader = new FileReader;
        reader.onload = operation(cm, function() {
          var content = reader.result;
          if (/[\x00-\x08\x0e-\x1f]{2}/.test(content)) content = "";
          text[i] = content;
          if (++read == n) {
            pos = clipPos(cm.doc, pos);
            var change = {from: pos, to: pos,
                          text: cm.doc.splitLines(text.join(cm.doc.lineSeparator())),
                          origin: "paste"};
            makeChange(cm.doc, change);
            setSelectionReplaceHistory(cm.doc, simpleSelection(pos, changeEnd(change)));
          }
        });
        reader.readAsText(file);
      };
      for (var i = 0; i < n; ++i) loadFile(files[i], i);
    } else { // Normal drop
      // Don't do a replace if the drop happened inside of the selected text.
      if (cm.state.draggingText && cm.doc.sel.contains(pos) > -1) {
        cm.state.draggingText(e);
        // Ensure the editor is re-focused
        setTimeout(function() {cm.display.input.focus();}, 20);
        return;
      }
      try {
        var text = e.dataTransfer.getData("Text");
        if (text) {
          if (cm.state.draggingText && !(mac ? e.altKey : e.ctrlKey))
            var selected = cm.listSelections();
          setSelectionNoUndo(cm.doc, simpleSelection(pos, pos));
          if (selected) for (var i = 0; i < selected.length; ++i)
            replaceRange(cm.doc, "", selected[i].anchor, selected[i].head, "drag");
          cm.replaceSelection(text, "around", "paste");
          cm.display.input.focus();
        }
      }
      catch(e){}
    }
  }

  function onDragStart(cm, e) {
    if (ie && (!cm.state.draggingText || +new Date - lastDrop < 100)) { e_stop(e); return; }
    if (signalDOMEvent(cm, e) || eventInWidget(cm.display, e)) return;

    e.dataTransfer.setData("Text", cm.getSelection());

    // Use dummy image instead of default browsers image.
    // Recent Safari (~6.0.2) have a tendency to segfault when this happens, so we don't do it there.
    if (e.dataTransfer.setDragImage && !safari) {
      var img = elt("img", null, null, "position: fixed; left: 0; top: 0;");
      img.src = "data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";
      if (presto) {
        img.width = img.height = 1;
        cm.display.wrapper.appendChild(img);
        // Force a relayout, or Opera won't use our image for some obscure reason
        img._top = img.offsetTop;
      }
      e.dataTransfer.setDragImage(img, 0, 0);
      if (presto) img.parentNode.removeChild(img);
    }
  }

  function onDragOver(cm, e) {
    var pos = posFromMouse(cm, e);
    if (!pos) return;
    var frag = document.createDocumentFragment();
    drawSelectionCursor(cm, pos, frag);
    if (!cm.display.dragCursor) {
      cm.display.dragCursor = elt("div", null, "CodeMirror-cursors CodeMirror-dragcursors");
      cm.display.lineSpace.insertBefore(cm.display.dragCursor, cm.display.cursorDiv);
    }
    removeChildrenAndAdd(cm.display.dragCursor, frag);
  }

  function clearDragCursor(cm) {
    if (cm.display.dragCursor) {
      cm.display.lineSpace.removeChild(cm.display.dragCursor);
      cm.display.dragCursor = null;
    }
  }

  // SCROLL EVENTS

  // Sync the scrollable area and scrollbars, ensure the viewport
  // covers the visible area.
  function setScrollTop(cm, val) {
    if (Math.abs(cm.doc.scrollTop - val) < 2) return;
    cm.doc.scrollTop = val;
    if (!gecko) updateDisplaySimple(cm, {top: val});
    if (cm.display.scroller.scrollTop != val) cm.display.scroller.scrollTop = val;
    cm.display.scrollbars.setScrollTop(val);
    if (gecko) updateDisplaySimple(cm);
    startWorker(cm, 100);
  }
  // Sync scroller and scrollbar, ensure the gutter elements are
  // aligned.
  function setScrollLeft(cm, val, isScroller) {
    if (isScroller ? val == cm.doc.scrollLeft : Math.abs(cm.doc.scrollLeft - val) < 2) return;
    val = Math.min(val, cm.display.scroller.scrollWidth - cm.display.scroller.clientWidth);
    cm.doc.scrollLeft = val;
    alignHorizontally(cm);
    if (cm.display.scroller.scrollLeft != val) cm.display.scroller.scrollLeft = val;
    cm.display.scrollbars.setScrollLeft(val);
  }

  // Since the delta values reported on mouse wheel events are
  // unstandardized between browsers and even browser versions, and
  // generally horribly unpredictable, this code starts by measuring
  // the scroll effect that the first few mouse wheel events have,
  // and, from that, detects the way it can convert deltas to pixel
  // offsets afterwards.
  //
  // The reason we want to know the amount a wheel event will scroll
  // is that it gives us a chance to update the display before the
  // actual scrolling happens, reducing flickering.

  var wheelSamples = 0, wheelPixelsPerUnit = null;
  // Fill in a browser-detected starting value on browsers where we
  // know one. These don't have to be accurate -- the result of them
  // being wrong would just be a slight flicker on the first wheel
  // scroll (if it is large enough).
  if (ie) wheelPixelsPerUnit = -.53;
  else if (gecko) wheelPixelsPerUnit = 15;
  else if (chrome) wheelPixelsPerUnit = -.7;
  else if (safari) wheelPixelsPerUnit = -1/3;

  var wheelEventDelta = function(e) {
    var dx = e.wheelDeltaX, dy = e.wheelDeltaY;
    if (dx == null && e.detail && e.axis == e.HORIZONTAL_AXIS) dx = e.detail;
    if (dy == null && e.detail && e.axis == e.VERTICAL_AXIS) dy = e.detail;
    else if (dy == null) dy = e.wheelDelta;
    return {x: dx, y: dy};
  };
  CodeMirror.wheelEventPixels = function(e) {
    var delta = wheelEventDelta(e);
    delta.x *= wheelPixelsPerUnit;
    delta.y *= wheelPixelsPerUnit;
    return delta;
  };

  function onScrollWheel(cm, e) {
    var delta = wheelEventDelta(e), dx = delta.x, dy = delta.y;

    var display = cm.display, scroll = display.scroller;
    // Quit if there's nothing to scroll here
    var canScrollX = scroll.scrollWidth > scroll.clientWidth;
    var canScrollY = scroll.scrollHeight > scroll.clientHeight;
    if (!(dx && canScrollX || dy && canScrollY)) return;

    // Webkit browsers on OS X abort momentum scrolls when the target
    // of the scroll event is removed from the scrollable element.
    // This hack (see related code in patchDisplay) makes sure the
    // element is kept around.
    if (dy && mac && webkit) {
      outer: for (var cur = e.target, view = display.view; cur != scroll; cur = cur.parentNode) {
        for (var i = 0; i < view.length; i++) {
          if (view[i].node == cur) {
            cm.display.currentWheelTarget = cur;
            break outer;
          }
        }
      }
    }

    // On some browsers, horizontal scrolling will cause redraws to
    // happen before the gutter has been realigned, causing it to
    // wriggle around in a most unseemly way. When we have an
    // estimated pixels/delta value, we just handle horizontal
    // scrolling entirely here. It'll be slightly off from native, but
    // better than glitching out.
    if (dx && !gecko && !presto && wheelPixelsPerUnit != null) {
      if (dy && canScrollY)
        setScrollTop(cm, Math.max(0, Math.min(scroll.scrollTop + dy * wheelPixelsPerUnit, scroll.scrollHeight - scroll.clientHeight)));
      setScrollLeft(cm, Math.max(0, Math.min(scroll.scrollLeft + dx * wheelPixelsPerUnit, scroll.scrollWidth - scroll.clientWidth)));
      // Only prevent default scrolling if vertical scrolling is
      // actually possible. Otherwise, it causes vertical scroll
      // jitter on OSX trackpads when deltaX is small and deltaY
      // is large (issue #3579)
      if (!dy || (dy && canScrollY))
        e_preventDefault(e);
      display.wheelStartX = null; // Abort measurement, if in progress
      return;
    }

    // 'Project' the visible viewport to cover the area that is being
    // scrolled into view (if we know enough to estimate it).
    if (dy && wheelPixelsPerUnit != null) {
      var pixels = dy * wheelPixelsPerUnit;
      var top = cm.doc.scrollTop, bot = top + display.wrapper.clientHeight;
      if (pixels < 0) top = Math.max(0, top + pixels - 50);
      else bot = Math.min(cm.doc.height, bot + pixels + 50);
      updateDisplaySimple(cm, {top: top, bottom: bot});
    }

    if (wheelSamples < 20) {
      if (display.wheelStartX == null) {
        display.wheelStartX = scroll.scrollLeft; display.wheelStartY = scroll.scrollTop;
        display.wheelDX = dx; display.wheelDY = dy;
        setTimeout(function() {
          if (display.wheelStartX == null) return;
          var movedX = scroll.scrollLeft - display.wheelStartX;
          var movedY = scroll.scrollTop - display.wheelStartY;
          var sample = (movedY && display.wheelDY && movedY / display.wheelDY) ||
            (movedX && display.wheelDX && movedX / display.wheelDX);
          display.wheelStartX = display.wheelStartY = null;
          if (!sample) return;
          wheelPixelsPerUnit = (wheelPixelsPerUnit * wheelSamples + sample) / (wheelSamples + 1);
          ++wheelSamples;
        }, 200);
      } else {
        display.wheelDX += dx; display.wheelDY += dy;
      }
    }
  }

  // KEY EVENTS

  // Run a handler that was bound to a key.
  function doHandleBinding(cm, bound, dropShift) {
    if (typeof bound == "string") {
      bound = commands[bound];
      if (!bound) return false;
    }
    // Ensure previous input has been read, so that the handler sees a
    // consistent view of the document
    cm.display.input.ensurePolled();
    var prevShift = cm.display.shift, done = false;
    try {
      if (isReadOnly(cm)) cm.state.suppressEdits = true;
      if (dropShift) cm.display.shift = false;
      done = bound(cm) != Pass;
    } finally {
      cm.display.shift = prevShift;
      cm.state.suppressEdits = false;
    }
    return done;
  }

  function lookupKeyForEditor(cm, name, handle) {
    for (var i = 0; i < cm.state.keyMaps.length; i++) {
      var result = lookupKey(name, cm.state.keyMaps[i], handle, cm);
      if (result) return result;
    }
    return (cm.options.extraKeys && lookupKey(name, cm.options.extraKeys, handle, cm))
      || lookupKey(name, cm.options.keyMap, handle, cm);
  }

  var stopSeq = new Delayed;
  function dispatchKey(cm, name, e, handle) {
    var seq = cm.state.keySeq;
    if (seq) {
      if (isModifierKey(name)) return "handled";
      stopSeq.set(50, function() {
        if (cm.state.keySeq == seq) {
          cm.state.keySeq = null;
          cm.display.input.reset();
        }
      });
      name = seq + " " + name;
    }
    var result = lookupKeyForEditor(cm, name, handle);

    if (result == "multi")
      cm.state.keySeq = name;
    if (result == "handled")
      signalLater(cm, "keyHandled", cm, name, e);

    if (result == "handled" || result == "multi") {
      e_preventDefault(e);
      restartBlink(cm);
    }

    if (seq && !result && /\'$/.test(name)) {
      e_preventDefault(e);
      return true;
    }
    return !!result;
  }

  // Handle a key from the keydown event.
  function handleKeyBinding(cm, e) {
    var name = keyName(e, true);
    if (!name) return false;

    if (e.shiftKey && !cm.state.keySeq) {
      // First try to resolve full name (including 'Shift-'). Failing
      // that, see if there is a cursor-motion command (starting with
      // 'go') bound to the keyname without 'Shift-'.
      return dispatchKey(cm, "Shift-" + name, e, function(b) {return doHandleBinding(cm, b, true);})
          || dispatchKey(cm, name, e, function(b) {
               if (typeof b == "string" ? /^go[A-Z]/.test(b) : b.motion)
                 return doHandleBinding(cm, b);
             });
    } else {
      return dispatchKey(cm, name, e, function(b) { return doHandleBinding(cm, b); });
    }
  }

  // Handle a key from the keypress event
  function handleCharBinding(cm, e, ch) {
    return dispatchKey(cm, "'" + ch + "'", e,
                       function(b) { return doHandleBinding(cm, b, true); });
  }

  var lastStoppedKey = null;
  function onKeyDown(e) {
    var cm = this;
    cm.curOp.focus = activeElt();
    if (signalDOMEvent(cm, e)) return;
    // IE does strange things with escape.
    if (ie && ie_version < 11 && e.keyCode == 27) e.returnValue = false;
    var code = e.keyCode;
    cm.display.shift = code == 16 || e.shiftKey;
    var handled = handleKeyBinding(cm, e);
    if (presto) {
      lastStoppedKey = handled ? code : null;
      // Opera has no cut event... we try to at least catch the key combo
      if (!handled && code == 88 && !hasCopyEvent && (mac ? e.metaKey : e.ctrlKey))
        cm.replaceSelection("", null, "cut");
    }

    // Turn mouse into crosshair when Alt is held on Mac.
    if (code == 18 && !/\bCodeMirror-crosshair\b/.test(cm.display.lineDiv.className))
      showCrossHair(cm);
  }

  function showCrossHair(cm) {
    var lineDiv = cm.display.lineDiv;
    addClass(lineDiv, "CodeMirror-crosshair");

    function up(e) {
      if (e.keyCode == 18 || !e.altKey) {
        rmClass(lineDiv, "CodeMirror-crosshair");
        off(document, "keyup", up);
        off(document, "mouseover", up);
      }
    }
    on(document, "keyup", up);
    on(document, "mouseover", up);
  }

  function onKeyUp(e) {
    if (e.keyCode == 16) this.doc.sel.shift = false;
    signalDOMEvent(this, e);
  }

  function onKeyPress(e) {
    var cm = this;
    if (eventInWidget(cm.display, e) || signalDOMEvent(cm, e) || e.ctrlKey && !e.altKey || mac && e.metaKey) return;
    var keyCode = e.keyCode, charCode = e.charCode;
    if (presto && keyCode == lastStoppedKey) {lastStoppedKey = null; e_preventDefault(e); return;}
    if ((presto && (!e.which || e.which < 10)) && handleKeyBinding(cm, e)) return;
    var ch = String.fromCharCode(charCode == null ? keyCode : charCode);
    if (handleCharBinding(cm, e, ch)) return;
    cm.display.input.onKeyPress(e);
  }

  // FOCUS/BLUR EVENTS

  function delayBlurEvent(cm) {
    cm.state.delayingBlurEvent = true;
    setTimeout(function() {
      if (cm.state.delayingBlurEvent) {
        cm.state.delayingBlurEvent = false;
        onBlur(cm);
      }
    }, 100);
  }

  function onFocus(cm) {
    if (cm.state.delayingBlurEvent) cm.state.delayingBlurEvent = false;

    if (cm.options.readOnly == "nocursor") return;
    if (!cm.state.focused) {
      signal(cm, "focus", cm);
      cm.state.focused = true;
      addClass(cm.display.wrapper, "CodeMirror-focused");
      // This test prevents this from firing when a context
      // menu is closed (since the input reset would kill the
      // select-all detection hack)
      if (!cm.curOp && cm.display.selForContextMenu != cm.doc.sel) {
        cm.display.input.reset();
        if (webkit) setTimeout(function() { cm.display.input.reset(true); }, 20); // Issue #1730
      }
      cm.display.input.receivedFocus();
    }
    restartBlink(cm);
  }
  function onBlur(cm) {
    if (cm.state.delayingBlurEvent) return;

    if (cm.state.focused) {
      signal(cm, "blur", cm);
      cm.state.focused = false;
      rmClass(cm.display.wrapper, "CodeMirror-focused");
    }
    clearInterval(cm.display.blinker);
    setTimeout(function() {if (!cm.state.focused) cm.display.shift = false;}, 150);
  }

  // CONTEXT MENU HANDLING

  // To make the context menu work, we need to briefly unhide the
  // textarea (making it as unobtrusive as possible) to let the
  // right-click take effect on it.
  function onContextMenu(cm, e) {
    if (eventInWidget(cm.display, e) || contextMenuInGutter(cm, e)) return;
    if (signalDOMEvent(cm, e, "contextmenu")) return;
    cm.display.input.onContextMenu(e);
  }

  function contextMenuInGutter(cm, e) {
    if (!hasHandler(cm, "gutterContextMenu")) return false;
    return gutterEvent(cm, e, "gutterContextMenu", false, signal);
  }

  // UPDATING

  // Compute the position of the end of a change (its 'to' property
  // refers to the pre-change end).
  var changeEnd = CodeMirror.changeEnd = function(change) {
    if (!change.text) return change.to;
    return Pos(change.from.line + change.text.length - 1,
               lst(change.text).length + (change.text.length == 1 ? change.from.ch : 0));
  };

  // Adjust a position to refer to the post-change position of the
  // same text, or the end of the change if the change covers it.
  function adjustForChange(pos, change) {
    if (cmp(pos, change.from) < 0) return pos;
    if (cmp(pos, change.to) <= 0) return changeEnd(change);

    var line = pos.line + change.text.length - (change.to.line - change.from.line) - 1, ch = pos.ch;
    if (pos.line == change.to.line) ch += changeEnd(change).ch - change.to.ch;
    return Pos(line, ch);
  }

  function computeSelAfterChange(doc, change) {
    var out = [];
    for (var i = 0; i < doc.sel.ranges.length; i++) {
      var range = doc.sel.ranges[i];
      out.push(new Range(adjustForChange(range.anchor, change),
                         adjustForChange(range.head, change)));
    }
    return normalizeSelection(out, doc.sel.primIndex);
  }

  function offsetPos(pos, old, nw) {
    if (pos.line == old.line)
      return Pos(nw.line, pos.ch - old.ch + nw.ch);
    else
      return Pos(nw.line + (pos.line - old.line), pos.ch);
  }

  // Used by replaceSelections to allow moving the selection to the
  // start or around the replaced test. Hint may be "start" or "around".
  function computeReplacedSel(doc, changes, hint) {
    var out = [];
    var oldPrev = Pos(doc.first, 0), newPrev = oldPrev;
    for (var i = 0; i < changes.length; i++) {
      var change = changes[i];
      var from = offsetPos(change.from, oldPrev, newPrev);
      var to = offsetPos(changeEnd(change), oldPrev, newPrev);
      oldPrev = change.to;
      newPrev = to;
      if (hint == "around") {
        var range = doc.sel.ranges[i], inv = cmp(range.head, range.anchor) < 0;
        out[i] = new Range(inv ? to : from, inv ? from : to);
      } else {
        out[i] = new Range(from, from);
      }
    }
    return new Selection(out, doc.sel.primIndex);
  }

  // Allow "beforeChange" event handlers to influence a change
  function filterChange(doc, change, update) {
    var obj = {
      canceled: false,
      from: change.from,
      to: change.to,
      text: change.text,
      origin: change.origin,
      cancel: function() { this.canceled = true; }
    };
    if (update) obj.update = function(from, to, text, origin) {
      if (from) this.from = clipPos(doc, from);
      if (to) this.to = clipPos(doc, to);
      if (text) this.text = text;
      if (origin !== undefined) this.origin = origin;
    };
    signal(doc, "beforeChange", doc, obj);
    if (doc.cm) signal(doc.cm, "beforeChange", doc.cm, obj);

    if (obj.canceled) return null;
    return {from: obj.from, to: obj.to, text: obj.text, origin: obj.origin};
  }

  // Apply a change to a document, and add it to the document's
  // history, and propagating it to all linked documents.
  function makeChange(doc, change, ignoreReadOnly) {
    if (doc.cm) {
      if (!doc.cm.curOp) return operation(doc.cm, makeChange)(doc, change, ignoreReadOnly);
      if (doc.cm.state.suppressEdits) return;
    }

    if (hasHandler(doc, "beforeChange") || doc.cm && hasHandler(doc.cm, "beforeChange")) {
      change = filterChange(doc, change, true);
      if (!change) return;
    }

    // Possibly split or suppress the update based on the presence
    // of read-only spans in its range.
    var split = sawReadOnlySpans && !ignoreReadOnly && removeReadOnlyRanges(doc, change.from, change.to);
    if (split) {
      for (var i = split.length - 1; i >= 0; --i)
        makeChangeInner(doc, {from: split[i].from, to: split[i].to, text: i ? [""] : change.text});
    } else {
      makeChangeInner(doc, change);
    }
  }

  function makeChangeInner(doc, change) {
    if (change.text.length == 1 && change.text[0] == "" && cmp(change.from, change.to) == 0) return;
    var selAfter = computeSelAfterChange(doc, change);
    addChangeToHistory(doc, change, selAfter, doc.cm ? doc.cm.curOp.id : NaN);

    makeChangeSingleDoc(doc, change, selAfter, stretchSpansOverChange(doc, change));
    var rebased = [];

    linkedDocs(doc, function(doc, sharedHist) {
      if (!sharedHist && indexOf(rebased, doc.history) == -1) {
        rebaseHist(doc.history, change);
        rebased.push(doc.history);
      }
      makeChangeSingleDoc(doc, change, null, stretchSpansOverChange(doc, change));
    });
  }

  // Revert a change stored in a document's history.
  function makeChangeFromHistory(doc, type, allowSelectionOnly) {
    if (doc.cm && doc.cm.state.suppressEdits) return;

    var hist = doc.history, event, selAfter = doc.sel;
    var source = type == "undo" ? hist.done : hist.undone, dest = type == "undo" ? hist.undone : hist.done;

    // Verify that there is a useable event (so that ctrl-z won't
    // needlessly clear selection events)
    for (var i = 0; i < source.length; i++) {
      event = source[i];
      if (allowSelectionOnly ? event.ranges && !event.equals(doc.sel) : !event.ranges)
        break;
    }
    if (i == source.length) return;
    hist.lastOrigin = hist.lastSelOrigin = null;

    for (;;) {
      event = source.pop();
      if (event.ranges) {
        pushSelectionToHistory(event, dest);
        if (allowSelectionOnly && !event.equals(doc.sel)) {
          setSelection(doc, event, {clearRedo: false});
          return;
        }
        selAfter = event;
      }
      else break;
    }

    // Build up a reverse change object to add to the opposite history
    // stack (redo when undoing, and vice versa).
    var antiChanges = [];
    pushSelectionToHistory(selAfter, dest);
    dest.push({changes: antiChanges, generation: hist.generation});
    hist.generation = event.generation || ++hist.maxGeneration;

    var filter = hasHandler(doc, "beforeChange") || doc.cm && hasHandler(doc.cm, "beforeChange");

    for (var i = event.changes.length - 1; i >= 0; --i) {
      var change = event.changes[i];
      change.origin = type;
      if (filter && !filterChange(doc, change, false)) {
        source.length = 0;
        return;
      }

      antiChanges.push(historyChangeFromChange(doc, change));

      var after = i ? computeSelAfterChange(doc, change) : lst(source);
      makeChangeSingleDoc(doc, change, after, mergeOldSpans(doc, change));
      if (!i && doc.cm) doc.cm.scrollIntoView({from: change.from, to: changeEnd(change)});
      var rebased = [];

      // Propagate to the linked documents
      linkedDocs(doc, function(doc, sharedHist) {
        if (!sharedHist && indexOf(rebased, doc.history) == -1) {
          rebaseHist(doc.history, change);
          rebased.push(doc.history);
        }
        makeChangeSingleDoc(doc, change, null, mergeOldSpans(doc, change));
      });
    }
  }

  // Sub-views need their line numbers shifted when text is added
  // above or below them in the parent document.
  function shiftDoc(doc, distance) {
    if (distance == 0) return;
    doc.first += distance;
    doc.sel = new Selection(map(doc.sel.ranges, function(range) {
      return new Range(Pos(range.anchor.line + distance, range.anchor.ch),
                       Pos(range.head.line + distance, range.head.ch));
    }), doc.sel.primIndex);
    if (doc.cm) {
      regChange(doc.cm, doc.first, doc.first - distance, distance);
      for (var d = doc.cm.display, l = d.viewFrom; l < d.viewTo; l++)
        regLineChange(doc.cm, l, "gutter");
    }
  }

  // More lower-level change function, handling only a single document
  // (not linked ones).
  function makeChangeSingleDoc(doc, change, selAfter, spans) {
    if (doc.cm && !doc.cm.curOp)
      return operation(doc.cm, makeChangeSingleDoc)(doc, change, selAfter, spans);

    if (change.to.line < doc.first) {
      shiftDoc(doc, change.text.length - 1 - (change.to.line - change.from.line));
      return;
    }
    if (change.from.line > doc.lastLine()) return;

    // Clip the change to the size of this doc
    if (change.from.line < doc.first) {
      var shift = change.text.length - 1 - (doc.first - change.from.line);
      shiftDoc(doc, shift);
      change = {from: Pos(doc.first, 0), to: Pos(change.to.line + shift, change.to.ch),
                text: [lst(change.text)], origin: change.origin};
    }
    var last = doc.lastLine();
    if (change.to.line > last) {
      change = {from: change.from, to: Pos(last, getLine(doc, last).text.length),
                text: [change.text[0]], origin: change.origin};
    }

    change.removed = getBetween(doc, change.from, change.to);

    if (!selAfter) selAfter = computeSelAfterChange(doc, change);
    if (doc.cm) makeChangeSingleDocInEditor(doc.cm, change, spans);
    else updateDoc(doc, change, spans);
    setSelectionNoUndo(doc, selAfter, sel_dontScroll);
  }

  // Handle the interaction of a change to a document with the editor
  // that this document is part of.
  function makeChangeSingleDocInEditor(cm, change, spans) {
    var doc = cm.doc, display = cm.display, from = change.from, to = change.to;

    var recomputeMaxLength = false, checkWidthStart = from.line;
    if (!cm.options.lineWrapping) {
      checkWidthStart = lineNo(visualLine(getLine(doc, from.line)));
      doc.iter(checkWidthStart, to.line + 1, function(line) {
        if (line == display.maxLine) {
          recomputeMaxLength = true;
          return true;
        }
      });
    }

    if (doc.sel.contains(change.from, change.to) > -1)
      signalCursorActivity(cm);

    updateDoc(doc, change, spans, estimateHeight(cm));

    if (!cm.options.lineWrapping) {
      doc.iter(checkWidthStart, from.line + change.text.length, function(line) {
        var len = lineLength(line);
        if (len > display.maxLineLength) {
          display.maxLine = line;
          display.maxLineLength = len;
          display.maxLineChanged = true;
          recomputeMaxLength = false;
        }
      });
      if (recomputeMaxLength) cm.curOp.updateMaxLine = true;
    }

    // Adjust frontier, schedule worker
    doc.frontier = Math.min(doc.frontier, from.line);
    startWorker(cm, 400);

    var lendiff = change.text.length - (to.line - from.line) - 1;
    // Remember that these lines changed, for updating the display
    if (change.full)
      regChange(cm);
    else if (from.line == to.line && change.text.length == 1 && !isWholeLineUpdate(cm.doc, change))
      regLineChange(cm, from.line, "text");
    else
      regChange(cm, from.line, to.line + 1, lendiff);

    var changesHandler = hasHandler(cm, "changes"), changeHandler = hasHandler(cm, "change");
    if (changeHandler || changesHandler) {
      var obj = {
        from: from, to: to,
        text: change.text,
        removed: change.removed,
        origin: change.origin
      };
      if (changeHandler) signalLater(cm, "change", cm, obj);
      if (changesHandler) (cm.curOp.changeObjs || (cm.curOp.changeObjs = [])).push(obj);
    }
    cm.display.selForContextMenu = null;
  }

  function replaceRange(doc, code, from, to, origin) {
    if (!to) to = from;
    if (cmp(to, from) < 0) { var tmp = to; to = from; from = tmp; }
    if (typeof code == "string") code = doc.splitLines(code);
    makeChange(doc, {from: from, to: to, text: code, origin: origin});
  }

  // SCROLLING THINGS INTO VIEW

  // If an editor sits on the top or bottom of the window, partially
  // scrolled out of view, this ensures that the cursor is visible.
  function maybeScrollWindow(cm, coords) {
    if (signalDOMEvent(cm, "scrollCursorIntoView")) return;

    var display = cm.display, box = display.sizer.getBoundingClientRect(), doScroll = null;
    if (coords.top + box.top < 0) doScroll = true;
    else if (coords.bottom + box.top > (window.innerHeight || document.documentElement.clientHeight)) doScroll = false;
    if (doScroll != null && !phantom) {
      var scrollNode = elt("div", "\u200b", null, "position: absolute; top: " +
                           (coords.top - display.viewOffset - paddingTop(cm.display)) + "px; height: " +
                           (coords.bottom - coords.top + scrollGap(cm) + display.barHeight) + "px; left: " +
                           coords.left + "px; width: 2px;");
      cm.display.lineSpace.appendChild(scrollNode);
      scrollNode.scrollIntoView(doScroll);
      cm.display.lineSpace.removeChild(scrollNode);
    }
  }

  // Scroll a given position into view (immediately), verifying that
  // it actually became visible (as line heights are accurately
  // measured, the position of something may 'drift' during drawing).
  function scrollPosIntoView(cm, pos, end, margin) {
    if (margin == null) margin = 0;
    for (var limit = 0; limit < 5; limit++) {
      var changed = false, coords = cursorCoords(cm, pos);
      var endCoords = !end || end == pos ? coords : cursorCoords(cm, end);
      var scrollPos = calculateScrollPos(cm, Math.min(coords.left, endCoords.left),
                                         Math.min(coords.top, endCoords.top) - margin,
                                         Math.max(coords.left, endCoords.left),
                                         Math.max(coords.bottom, endCoords.bottom) + margin);
      var startTop = cm.doc.scrollTop, startLeft = cm.doc.scrollLeft;
      if (scrollPos.scrollTop != null) {
        setScrollTop(cm, scrollPos.scrollTop);
        if (Math.abs(cm.doc.scrollTop - startTop) > 1) changed = true;
      }
      if (scrollPos.scrollLeft != null) {
        setScrollLeft(cm, scrollPos.scrollLeft);
        if (Math.abs(cm.doc.scrollLeft - startLeft) > 1) changed = true;
      }
      if (!changed) break;
    }
    return coords;
  }

  // Scroll a given set of coordinates into view (immediately).
  function scrollIntoView(cm, x1, y1, x2, y2) {
    var scrollPos = calculateScrollPos(cm, x1, y1, x2, y2);
    if (scrollPos.scrollTop != null) setScrollTop(cm, scrollPos.scrollTop);
    if (scrollPos.scrollLeft != null) setScrollLeft(cm, scrollPos.scrollLeft);
  }

  // Calculate a new scroll position needed to scroll the given
  // rectangle into view. Returns an object with scrollTop and
  // scrollLeft properties. When these are undefined, the
  // vertical/horizontal position does not need to be adjusted.
  function calculateScrollPos(cm, x1, y1, x2, y2) {
    var display = cm.display, snapMargin = textHeight(cm.display);
    if (y1 < 0) y1 = 0;
    var screentop = cm.curOp && cm.curOp.scrollTop != null ? cm.curOp.scrollTop : display.scroller.scrollTop;
    var screen = displayHeight(cm), result = {};
    if (y2 - y1 > screen) y2 = y1 + screen;
    var docBottom = cm.doc.height + paddingVert(display);
    var atTop = y1 < snapMargin, atBottom = y2 > docBottom - snapMargin;
    if (y1 < screentop) {
      result.scrollTop = atTop ? 0 : y1;
    } else if (y2 > screentop + screen) {
      var newTop = Math.min(y1, (atBottom ? docBottom : y2) - screen);
      if (newTop != screentop) result.scrollTop = newTop;
    }

    var screenleft = cm.curOp && cm.curOp.scrollLeft != null ? cm.curOp.scrollLeft : display.scroller.scrollLeft;
    var screenw = displayWidth(cm) - (cm.options.fixedGutter ? display.gutters.offsetWidth : 0);
    var tooWide = x2 - x1 > screenw;
    if (tooWide) x2 = x1 + screenw;
    if (x1 < 10)
      result.scrollLeft = 0;
    else if (x1 < screenleft)
      result.scrollLeft = Math.max(0, x1 - (tooWide ? 0 : 10));
    else if (x2 > screenw + screenleft - 3)
      result.scrollLeft = x2 + (tooWide ? 0 : 10) - screenw;
    return result;
  }

  // Store a relative adjustment to the scroll position in the current
  // operation (to be applied when the operation finishes).
  function addToScrollPos(cm, left, top) {
    if (left != null || top != null) resolveScrollToPos(cm);
    if (left != null)
      cm.curOp.scrollLeft = (cm.curOp.scrollLeft == null ? cm.doc.scrollLeft : cm.curOp.scrollLeft) + left;
    if (top != null)
      cm.curOp.scrollTop = (cm.curOp.scrollTop == null ? cm.doc.scrollTop : cm.curOp.scrollTop) + top;
  }

  // Make sure that at the end of the operation the current cursor is
  // shown.
  function ensureCursorVisible(cm) {
    resolveScrollToPos(cm);
    var cur = cm.getCursor(), from = cur, to = cur;
    if (!cm.options.lineWrapping) {
      from = cur.ch ? Pos(cur.line, cur.ch - 1) : cur;
      to = Pos(cur.line, cur.ch + 1);
    }
    cm.curOp.scrollToPos = {from: from, to: to, margin: cm.options.cursorScrollMargin, isCursor: true};
  }

  // When an operation has its scrollToPos property set, and another
  // scroll action is applied before the end of the operation, this
  // 'simulates' scrolling that position into view in a cheap way, so
  // that the effect of intermediate scroll commands is not ignored.
  function resolveScrollToPos(cm) {
    var range = cm.curOp.scrollToPos;
    if (range) {
      cm.curOp.scrollToPos = null;
      var from = estimateCoords(cm, range.from), to = estimateCoords(cm, range.to);
      var sPos = calculateScrollPos(cm, Math.min(from.left, to.left),
                                    Math.min(from.top, to.top) - range.margin,
                                    Math.max(from.right, to.right),
                                    Math.max(from.bottom, to.bottom) + range.margin);
      cm.scrollTo(sPos.scrollLeft, sPos.scrollTop);
    }
  }

  // API UTILITIES

  // Indent the given line. The how parameter can be "smart",
  // "add"/null, "subtract", or "prev". When aggressive is false
  // (typically set to true for forced single-line indents), empty
  // lines are not indented, and places where the mode returns Pass
  // are left alone.
  function indentLine(cm, n, how, aggressive) {
    var doc = cm.doc, state;
    if (how == null) how = "add";
    if (how == "smart") {
      // Fall back to "prev" when the mode doesn't have an indentation
      // method.
      if (!doc.mode.indent) how = "prev";
      else state = getStateBefore(cm, n);
    }

    var tabSize = cm.options.tabSize;
    var line = getLine(doc, n), curSpace = countColumn(line.text, null, tabSize);
    if (line.stateAfter) line.stateAfter = null;
    var curSpaceString = line.text.match(/^\s*/)[0], indentation;
    if (!aggressive && !/\S/.test(line.text)) {
      indentation = 0;
      how = "not";
    } else if (how == "smart") {
      indentation = doc.mode.indent(state, line.text.slice(curSpaceString.length), line.text);
      if (indentation == Pass || indentation > 150) {
        if (!aggressive) return;
        how = "prev";
      }
    }
    if (how == "prev") {
      if (n > doc.first) indentation = countColumn(getLine(doc, n-1).text, null, tabSize);
      else indentation = 0;
    } else if (how == "add") {
      indentation = curSpace + cm.options.indentUnit;
    } else if (how == "subtract") {
      indentation = curSpace - cm.options.indentUnit;
    } else if (typeof how == "number") {
      indentation = curSpace + how;
    }
    indentation = Math.max(0, indentation);

    var indentString = "", pos = 0;
    if (cm.options.indentWithTabs)
      for (var i = Math.floor(indentation / tabSize); i; --i) {pos += tabSize; indentString += "\t";}
    if (pos < indentation) indentString += spaceStr(indentation - pos);

    if (indentString != curSpaceString) {
      replaceRange(doc, indentString, Pos(n, 0), Pos(n, curSpaceString.length), "+input");
      line.stateAfter = null;
      return true;
    } else {
      // Ensure that, if the cursor was in the whitespace at the start
      // of the line, it is moved to the end of that space.
      for (var i = 0; i < doc.sel.ranges.length; i++) {
        var range = doc.sel.ranges[i];
        if (range.head.line == n && range.head.ch < curSpaceString.length) {
          var pos = Pos(n, curSpaceString.length);
          replaceOneSelection(doc, i, new Range(pos, pos));
          break;
        }
      }
    }
  }

  // Utility for applying a change to a line by handle or number,
  // returning the number and optionally registering the line as
  // changed.
  function changeLine(doc, handle, changeType, op) {
    var no = handle, line = handle;
    if (typeof handle == "number") line = getLine(doc, clipLine(doc, handle));
    else no = lineNo(handle);
    if (no == null) return null;
    if (op(line, no) && doc.cm) regLineChange(doc.cm, no, changeType);
    return line;
  }

  // Helper for deleting text near the selection(s), used to implement
  // backspace, delete, and similar functionality.
  function deleteNearSelection(cm, compute) {
    var ranges = cm.doc.sel.ranges, kill = [];
    // Build up a set of ranges to kill first, merging overlapping
    // ranges.
    for (var i = 0; i < ranges.length; i++) {
      var toKill = compute(ranges[i]);
      while (kill.length && cmp(toKill.from, lst(kill).to) <= 0) {
        var replaced = kill.pop();
        if (cmp(replaced.from, toKill.from) < 0) {
          toKill.from = replaced.from;
          break;
        }
      }
      kill.push(toKill);
    }
    // Next, remove those actual ranges.
    runInOp(cm, function() {
      for (var i = kill.length - 1; i >= 0; i--)
        replaceRange(cm.doc, "", kill[i].from, kill[i].to, "+delete");
      ensureCursorVisible(cm);
    });
  }

  // Used for horizontal relative motion. Dir is -1 or 1 (left or
  // right), unit can be "char", "column" (like char, but doesn't
  // cross line boundaries), "word" (across next word), or "group" (to
  // the start of next group of word or non-word-non-whitespace
  // chars). The visually param controls whether, in right-to-left
  // text, direction 1 means to move towards the next index in the
  // string, or towards the character to the right of the current
  // position. The resulting position will have a hitSide=true
  // property if it reached the end of the document.
  function findPosH(doc, pos, dir, unit, visually) {
    var line = pos.line, ch = pos.ch, origDir = dir;
    var lineObj = getLine(doc, line);
    var possible = true;
    function findNextLine() {
      var l = line + dir;
      if (l < doc.first || l >= doc.first + doc.size) return (possible = false);
      line = l;
      return lineObj = getLine(doc, l);
    }
    function moveOnce(boundToLine) {
      var next = (visually ? moveVisually : moveLogically)(lineObj, ch, dir, true);
      if (next == null) {
        if (!boundToLine && findNextLine()) {
          if (visually) ch = (dir < 0 ? lineRight : lineLeft)(lineObj);
          else ch = dir < 0 ? lineObj.text.length : 0;
        } else return (possible = false);
      } else ch = next;
      return true;
    }

    if (unit == "char") moveOnce();
    else if (unit == "column") moveOnce(true);
    else if (unit == "word" || unit == "group") {
      var sawType = null, group = unit == "group";
      var helper = doc.cm && doc.cm.getHelper(pos, "wordChars");
      for (var first = true;; first = false) {
        if (dir < 0 && !moveOnce(!first)) break;
        var cur = lineObj.text.charAt(ch) || "\n";
        var type = isWordChar(cur, helper) ? "w"
          : group && cur == "\n" ? "n"
          : !group || /\s/.test(cur) ? null
          : "p";
        if (group && !first && !type) type = "s";
        if (sawType && sawType != type) {
          if (dir < 0) {dir = 1; moveOnce();}
          break;
        }

        if (type) sawType = type;
        if (dir > 0 && !moveOnce(!first)) break;
      }
    }
    var result = skipAtomic(doc, Pos(line, ch), origDir, true);
    if (!possible) result.hitSide = true;
    return result;
  }

  // For relative vertical movement. Dir may be -1 or 1. Unit can be
  // "page" or "line". The resulting position will have a hitSide=true
  // property if it reached the end of the document.
  function findPosV(cm, pos, dir, unit) {
    var doc = cm.doc, x = pos.left, y;
    if (unit == "page") {
      var pageSize = Math.min(cm.display.wrapper.clientHeight, window.innerHeight || document.documentElement.clientHeight);
      y = pos.top + dir * (pageSize - (dir < 0 ? 1.5 : .5) * textHeight(cm.display));
    } else if (unit == "line") {
      y = dir > 0 ? pos.bottom + 3 : pos.top - 3;
    }
    for (;;) {
      var target = coordsChar(cm, x, y);
      if (!target.outside) break;
      if (dir < 0 ? y <= 0 : y >= doc.height) { target.hitSide = true; break; }
      y += dir * 5;
    }
    return target;
  }

  // EDITOR METHODS

  // The publicly visible API. Note that methodOp(f) means
  // 'wrap f in an operation, performed on its `this` parameter'.

  // This is not the complete set of editor methods. Most of the
  // methods defined on the Doc type are also injected into
  // CodeMirror.prototype, for backwards compatibility and
  // convenience.

  CodeMirror.prototype = {
    constructor: CodeMirror,
    focus: function(){window.focus(); this.display.input.focus();},

    setOption: function(option, value) {
      var options = this.options, old = options[option];
      if (options[option] == value && option != "mode") return;
      options[option] = value;
      if (optionHandlers.hasOwnProperty(option))
        operation(this, optionHandlers[option])(this, value, old);
    },

    getOption: function(option) {return this.options[option];},
    getDoc: function() {return this.doc;},

    addKeyMap: function(map, bottom) {
      this.state.keyMaps[bottom ? "push" : "unshift"](getKeyMap(map));
    },
    removeKeyMap: function(map) {
      var maps = this.state.keyMaps;
      for (var i = 0; i < maps.length; ++i)
        if (maps[i] == map || maps[i].name == map) {
          maps.splice(i, 1);
          return true;
        }
    },

    addOverlay: methodOp(function(spec, options) {
      var mode = spec.token ? spec : CodeMirror.getMode(this.options, spec);
      if (mode.startState) throw new Error("Overlays may not be stateful.");
      this.state.overlays.push({mode: mode, modeSpec: spec, opaque: options && options.opaque});
      this.state.modeGen++;
      regChange(this);
    }),
    removeOverlay: methodOp(function(spec) {
      var overlays = this.state.overlays;
      for (var i = 0; i < overlays.length; ++i) {
        var cur = overlays[i].modeSpec;
        if (cur == spec || typeof spec == "string" && cur.name == spec) {
          overlays.splice(i, 1);
          this.state.modeGen++;
          regChange(this);
          return;
        }
      }
    }),

    indentLine: methodOp(function(n, dir, aggressive) {
      if (typeof dir != "string" && typeof dir != "number") {
        if (dir == null) dir = this.options.smartIndent ? "smart" : "prev";
        else dir = dir ? "add" : "subtract";
      }
      if (isLine(this.doc, n)) indentLine(this, n, dir, aggressive);
    }),
    indentSelection: methodOp(function(how) {
      var ranges = this.doc.sel.ranges, end = -1;
      for (var i = 0; i < ranges.length; i++) {
        var range = ranges[i];
        if (!range.empty()) {
          var from = range.from(), to = range.to();
          var start = Math.max(end, from.line);
          end = Math.min(this.lastLine(), to.line - (to.ch ? 0 : 1)) + 1;
          for (var j = start; j < end; ++j)
            indentLine(this, j, how);
          var newRanges = this.doc.sel.ranges;
          if (from.ch == 0 && ranges.length == newRanges.length && newRanges[i].from().ch > 0)
            replaceOneSelection(this.doc, i, new Range(from, newRanges[i].to()), sel_dontScroll);
        } else if (range.head.line > end) {
          indentLine(this, range.head.line, how, true);
          end = range.head.line;
          if (i == this.doc.sel.primIndex) ensureCursorVisible(this);
        }
      }
    }),

    // Fetch the parser token for a given character. Useful for hacks
    // that want to inspect the mode state (say, for completion).
    getTokenAt: function(pos, precise) {
      return takeToken(this, pos, precise);
    },

    getLineTokens: function(line, precise) {
      return takeToken(this, Pos(line), precise, true);
    },

    getTokenTypeAt: function(pos) {
      pos = clipPos(this.doc, pos);
      var styles = getLineStyles(this, getLine(this.doc, pos.line));
      var before = 0, after = (styles.length - 1) / 2, ch = pos.ch;
      var type;
      if (ch == 0) type = styles[2];
      else for (;;) {
        var mid = (before + after) >> 1;
        if ((mid ? styles[mid * 2 - 1] : 0) >= ch) after = mid;
        else if (styles[mid * 2 + 1] < ch) before = mid + 1;
        else { type = styles[mid * 2 + 2]; break; }
      }
      var cut = type ? type.indexOf("cm-overlay ") : -1;
      return cut < 0 ? type : cut == 0 ? null : type.slice(0, cut - 1);
    },

    getModeAt: function(pos) {
      var mode = this.doc.mode;
      if (!mode.innerMode) return mode;
      return CodeMirror.innerMode(mode, this.getTokenAt(pos).state).mode;
    },

    getHelper: function(pos, type) {
      return this.getHelpers(pos, type)[0];
    },

    getHelpers: function(pos, type) {
      var found = [];
      if (!helpers.hasOwnProperty(type)) return found;
      var help = helpers[type], mode = this.getModeAt(pos);
      if (typeof mode[type] == "string") {
        if (help[mode[type]]) found.push(help[mode[type]]);
      } else if (mode[type]) {
        for (var i = 0; i < mode[type].length; i++) {
          var val = help[mode[type][i]];
          if (val) found.push(val);
        }
      } else if (mode.helperType && help[mode.helperType]) {
        found.push(help[mode.helperType]);
      } else if (help[mode.name]) {
        found.push(help[mode.name]);
      }
      for (var i = 0; i < help._global.length; i++) {
        var cur = help._global[i];
        if (cur.pred(mode, this) && indexOf(found, cur.val) == -1)
          found.push(cur.val);
      }
      return found;
    },

    getStateAfter: function(line, precise) {
      var doc = this.doc;
      line = clipLine(doc, line == null ? doc.first + doc.size - 1: line);
      return getStateBefore(this, line + 1, precise);
    },

    cursorCoords: function(start, mode) {
      var pos, range = this.doc.sel.primary();
      if (start == null) pos = range.head;
      else if (typeof start == "object") pos = clipPos(this.doc, start);
      else pos = start ? range.from() : range.to();
      return cursorCoords(this, pos, mode || "page");
    },

    charCoords: function(pos, mode) {
      return charCoords(this, clipPos(this.doc, pos), mode || "page");
    },

    coordsChar: function(coords, mode) {
      coords = fromCoordSystem(this, coords, mode || "page");
      return coordsChar(this, coords.left, coords.top);
    },

    lineAtHeight: function(height, mode) {
      height = fromCoordSystem(this, {top: height, left: 0}, mode || "page").top;
      return lineAtHeight(this.doc, height + this.display.viewOffset);
    },
    heightAtLine: function(line, mode) {
      var end = false, lineObj;
      if (typeof line == "number") {
        var last = this.doc.first + this.doc.size - 1;
        if (line < this.doc.first) line = this.doc.first;
        else if (line > last) { line = last; end = true; }
        lineObj = getLine(this.doc, line);
      } else {
        lineObj = line;
      }
      return intoCoordSystem(this, lineObj, {top: 0, left: 0}, mode || "page").top +
        (end ? this.doc.height - heightAtLine(lineObj) : 0);
    },

    defaultTextHeight: function() { return textHeight(this.display); },
    defaultCharWidth: function() { return charWidth(this.display); },

    setGutterMarker: methodOp(function(line, gutterID, value) {
      return changeLine(this.doc, line, "gutter", function(line) {
        var markers = line.gutterMarkers || (line.gutterMarkers = {});
        markers[gutterID] = value;
        if (!value && isEmpty(markers)) line.gutterMarkers = null;
        return true;
      });
    }),

    clearGutter: methodOp(function(gutterID) {
      var cm = this, doc = cm.doc, i = doc.first;
      doc.iter(function(line) {
        if (line.gutterMarkers && line.gutterMarkers[gutterID]) {
          line.gutterMarkers[gutterID] = null;
          regLineChange(cm, i, "gutter");
          if (isEmpty(line.gutterMarkers)) line.gutterMarkers = null;
        }
        ++i;
      });
    }),

    lineInfo: function(line) {
      if (typeof line == "number") {
        if (!isLine(this.doc, line)) return null;
        var n = line;
        line = getLine(this.doc, line);
        if (!line) return null;
      } else {
        var n = lineNo(line);
        if (n == null) return null;
      }
      return {line: n, handle: line, text: line.text, gutterMarkers: line.gutterMarkers,
              textClass: line.textClass, bgClass: line.bgClass, wrapClass: line.wrapClass,
              widgets: line.widgets};
    },

    getViewport: function() { return {from: this.display.viewFrom, to: this.display.viewTo};},

    addWidget: function(pos, node, scroll, vert, horiz) {
      var display = this.display;
      pos = cursorCoords(this, clipPos(this.doc, pos));
      var top = pos.bottom, left = pos.left;
      node.style.position = "absolute";
      node.setAttribute("cm-ignore-events", "true");
      this.display.input.setUneditable(node);
      display.sizer.appendChild(node);
      if (vert == "over") {
        top = pos.top;
      } else if (vert == "above" || vert == "near") {
        var vspace = Math.max(display.wrapper.clientHeight, this.doc.height),
        hspace = Math.max(display.sizer.clientWidth, display.lineSpace.clientWidth);
        // Default to positioning above (if specified and possible); otherwise default to positioning below
        if ((vert == 'above' || pos.bottom + node.offsetHeight > vspace) && pos.top > node.offsetHeight)
          top = pos.top - node.offsetHeight;
        else if (pos.bottom + node.offsetHeight <= vspace)
          top = pos.bottom;
        if (left + node.offsetWidth > hspace)
          left = hspace - node.offsetWidth;
      }
      node.style.top = top + "px";
      node.style.left = node.style.right = "";
      if (horiz == "right") {
        left = display.sizer.clientWidth - node.offsetWidth;
        node.style.right = "0px";
      } else {
        if (horiz == "left") left = 0;
        else if (horiz == "middle") left = (display.sizer.clientWidth - node.offsetWidth) / 2;
        node.style.left = left + "px";
      }
      if (scroll)
        scrollIntoView(this, left, top, left + node.offsetWidth, top + node.offsetHeight);
    },

    triggerOnKeyDown: methodOp(onKeyDown),
    triggerOnKeyPress: methodOp(onKeyPress),
    triggerOnKeyUp: onKeyUp,

    execCommand: function(cmd) {
      if (commands.hasOwnProperty(cmd))
        return commands[cmd].call(null, this);
    },

    triggerElectric: methodOp(function(text) { triggerElectric(this, text); }),

    findPosH: function(from, amount, unit, visually) {
      var dir = 1;
      if (amount < 0) { dir = -1; amount = -amount; }
      for (var i = 0, cur = clipPos(this.doc, from); i < amount; ++i) {
        cur = findPosH(this.doc, cur, dir, unit, visually);
        if (cur.hitSide) break;
      }
      return cur;
    },

    moveH: methodOp(function(dir, unit) {
      var cm = this;
      cm.extendSelectionsBy(function(range) {
        if (cm.display.shift || cm.doc.extend || range.empty())
          return findPosH(cm.doc, range.head, dir, unit, cm.options.rtlMoveVisually);
        else
          return dir < 0 ? range.from() : range.to();
      }, sel_move);
    }),

    deleteH: methodOp(function(dir, unit) {
      var sel = this.doc.sel, doc = this.doc;
      if (sel.somethingSelected())
        doc.replaceSelection("", null, "+delete");
      else
        deleteNearSelection(this, function(range) {
          var other = findPosH(doc, range.head, dir, unit, false);
          return dir < 0 ? {from: other, to: range.head} : {from: range.head, to: other};
        });
    }),

    findPosV: function(from, amount, unit, goalColumn) {
      var dir = 1, x = goalColumn;
      if (amount < 0) { dir = -1; amount = -amount; }
      for (var i = 0, cur = clipPos(this.doc, from); i < amount; ++i) {
        var coords = cursorCoords(this, cur, "div");
        if (x == null) x = coords.left;
        else coords.left = x;
        cur = findPosV(this, coords, dir, unit);
        if (cur.hitSide) break;
      }
      return cur;
    },

    moveV: methodOp(function(dir, unit) {
      var cm = this, doc = this.doc, goals = [];
      var collapse = !cm.display.shift && !doc.extend && doc.sel.somethingSelected();
      doc.extendSelectionsBy(function(range) {
        if (collapse)
          return dir < 0 ? range.from() : range.to();
        var headPos = cursorCoords(cm, range.head, "div");
        if (range.goalColumn != null) headPos.left = range.goalColumn;
        goals.push(headPos.left);
        var pos = findPosV(cm, headPos, dir, unit);
        if (unit == "page" && range == doc.sel.primary())
          addToScrollPos(cm, null, charCoords(cm, pos, "div").top - headPos.top);
        return pos;
      }, sel_move);
      if (goals.length) for (var i = 0; i < doc.sel.ranges.length; i++)
        doc.sel.ranges[i].goalColumn = goals[i];
    }),

    // Find the word at the given position (as returned by coordsChar).
    findWordAt: function(pos) {
      var doc = this.doc, line = getLine(doc, pos.line).text;
      var start = pos.ch, end = pos.ch;
      if (line) {
        var helper = this.getHelper(pos, "wordChars");
        if ((pos.xRel < 0 || end == line.length) && start) --start; else ++end;
        var startChar = line.charAt(start);
        var check = isWordChar(startChar, helper)
          ? function(ch) { return isWordChar(ch, helper); }
          : /\s/.test(startChar) ? function(ch) {return /\s/.test(ch);}
          : function(ch) {return !/\s/.test(ch) && !isWordChar(ch);};
        while (start > 0 && check(line.charAt(start - 1))) --start;
        while (end < line.length && check(line.charAt(end))) ++end;
      }
      return new Range(Pos(pos.line, start), Pos(pos.line, end));
    },

    toggleOverwrite: function(value) {
      if (value != null && value == this.state.overwrite) return;
      if (this.state.overwrite = !this.state.overwrite)
        addClass(this.display.cursorDiv, "CodeMirror-overwrite");
      else
        rmClass(this.display.cursorDiv, "CodeMirror-overwrite");

      signal(this, "overwriteToggle", this, this.state.overwrite);
    },
    hasFocus: function() { return this.display.input.getField() == activeElt(); },

    scrollTo: methodOp(function(x, y) {
      if (x != null || y != null) resolveScrollToPos(this);
      if (x != null) this.curOp.scrollLeft = x;
      if (y != null) this.curOp.scrollTop = y;
    }),
    getScrollInfo: function() {
      var scroller = this.display.scroller;
      return {left: scroller.scrollLeft, top: scroller.scrollTop,
              height: scroller.scrollHeight - scrollGap(this) - this.display.barHeight,
              width: scroller.scrollWidth - scrollGap(this) - this.display.barWidth,
              clientHeight: displayHeight(this), clientWidth: displayWidth(this)};
    },

    scrollIntoView: methodOp(function(range, margin) {
      if (range == null) {
        range = {from: this.doc.sel.primary().head, to: null};
        if (margin == null) margin = this.options.cursorScrollMargin;
      } else if (typeof range == "number") {
        range = {from: Pos(range, 0), to: null};
      } else if (range.from == null) {
        range = {from: range, to: null};
      }
      if (!range.to) range.to = range.from;
      range.margin = margin || 0;

      if (range.from.line != null) {
        resolveScrollToPos(this);
        this.curOp.scrollToPos = range;
      } else {
        var sPos = calculateScrollPos(this, Math.min(range.from.left, range.to.left),
                                      Math.min(range.from.top, range.to.top) - range.margin,
                                      Math.max(range.from.right, range.to.right),
                                      Math.max(range.from.bottom, range.to.bottom) + range.margin);
        this.scrollTo(sPos.scrollLeft, sPos.scrollTop);
      }
    }),

    setSize: methodOp(function(width, height) {
      var cm = this;
      function interpret(val) {
        return typeof val == "number" || /^\d+$/.test(String(val)) ? val + "px" : val;
      }
      if (width != null) cm.display.wrapper.style.width = interpret(width);
      if (height != null) cm.display.wrapper.style.height = interpret(height);
      if (cm.options.lineWrapping) clearLineMeasurementCache(this);
      var lineNo = cm.display.viewFrom;
      cm.doc.iter(lineNo, cm.display.viewTo, function(line) {
        if (line.widgets) for (var i = 0; i < line.widgets.length; i++)
          if (line.widgets[i].noHScroll) { regLineChange(cm, lineNo, "widget"); break; }
        ++lineNo;
      });
      cm.curOp.forceUpdate = true;
      signal(cm, "refresh", this);
    }),

    operation: function(f){return runInOp(this, f);},

    refresh: methodOp(function() {
      var oldHeight = this.display.cachedTextHeight;
      regChange(this);
      this.curOp.forceUpdate = true;
      clearCaches(this);
      this.scrollTo(this.doc.scrollLeft, this.doc.scrollTop);
      updateGutterSpace(this);
      if (oldHeight == null || Math.abs(oldHeight - textHeight(this.display)) > .5)
        estimateLineHeights(this);
      signal(this, "refresh", this);
    }),

    swapDoc: methodOp(function(doc) {
      var old = this.doc;
      old.cm = null;
      attachDoc(this, doc);
      clearCaches(this);
      this.display.input.reset();
      this.scrollTo(doc.scrollLeft, doc.scrollTop);
      this.curOp.forceScroll = true;
      signalLater(this, "swapDoc", this, old);
      return old;
    }),

    getInputField: function(){return this.display.input.getField();},
    getWrapperElement: function(){return this.display.wrapper;},
    getScrollerElement: function(){return this.display.scroller;},
    getGutterElement: function(){return this.display.gutters;}
  };
  eventMixin(CodeMirror);

  // OPTION DEFAULTS

  // The default configuration options.
  var defaults = CodeMirror.defaults = {};
  // Functions to run when options are changed.
  var optionHandlers = CodeMirror.optionHandlers = {};

  function option(name, deflt, handle, notOnInit) {
    CodeMirror.defaults[name] = deflt;
    if (handle) optionHandlers[name] =
      notOnInit ? function(cm, val, old) {if (old != Init) handle(cm, val, old);} : handle;
  }

  // Passed to option handlers when there is no old value.
  var Init = CodeMirror.Init = {toString: function(){return "CodeMirror.Init";}};

  // These two are, on init, called from the constructor because they
  // have to be initialized before the editor can start at all.
  option("value", "", function(cm, val) {
    cm.setValue(val);
  }, true);
  option("mode", null, function(cm, val) {
    cm.doc.modeOption = val;
    loadMode(cm);
  }, true);

  option("indentUnit", 2, loadMode, true);
  option("indentWithTabs", false);
  option("smartIndent", true);
  option("tabSize", 4, function(cm) {
    resetModeState(cm);
    clearCaches(cm);
    regChange(cm);
  }, true);
  option("lineSeparator", null, function(cm, val) {
    cm.doc.lineSep = val;
    if (!val) return;
    var newBreaks = [], lineNo = cm.doc.first;
    cm.doc.iter(function(line) {
      for (var pos = 0;;) {
        var found = line.text.indexOf(val, pos);
        if (found == -1) break;
        pos = found + val.length;
        newBreaks.push(Pos(lineNo, found));
      }
      lineNo++;
    });
    for (var i = newBreaks.length - 1; i >= 0; i--)
      replaceRange(cm.doc, val, newBreaks[i], Pos(newBreaks[i].line, newBreaks[i].ch + val.length))
  });
  option("specialChars", /[\t\u0000-\u0019\u00ad\u200b-\u200f\u2028\u2029\ufeff]/g, function(cm, val, old) {
    cm.state.specialChars = new RegExp(val.source + (val.test("\t") ? "" : "|\t"), "g");
    if (old != CodeMirror.Init) cm.refresh();
  });
  option("specialCharPlaceholder", defaultSpecialCharPlaceholder, function(cm) {cm.refresh();}, true);
  option("electricChars", true);
  option("inputStyle", mobile ? "contenteditable" : "textarea", function() {
    throw new Error("inputStyle can not (yet) be changed in a running editor"); // FIXME
  }, true);
  option("rtlMoveVisually", !windows);
  option("wholeLineUpdateBefore", true);

  option("theme", "default", function(cm) {
    themeChanged(cm);
    guttersChanged(cm);
  }, true);
  option("keyMap", "default", function(cm, val, old) {
    var next = getKeyMap(val);
    var prev = old != CodeMirror.Init && getKeyMap(old);
    if (prev && prev.detach) prev.detach(cm, next);
    if (next.attach) next.attach(cm, prev || null);
  });
  option("extraKeys", null);

  option("lineWrapping", false, wrappingChanged, true);
  option("gutters", [], function(cm) {
    setGuttersForLineNumbers(cm.options);
    guttersChanged(cm);
  }, true);
  option("fixedGutter", true, function(cm, val) {
    cm.display.gutters.style.left = val ? compensateForHScroll(cm.display) + "px" : "0";
    cm.refresh();
  }, true);
  option("coverGutterNextToScrollbar", false, function(cm) {updateScrollbars(cm);}, true);
  option("scrollbarStyle", "native", function(cm) {
    initScrollbars(cm);
    updateScrollbars(cm);
    cm.display.scrollbars.setScrollTop(cm.doc.scrollTop);
    cm.display.scrollbars.setScrollLeft(cm.doc.scrollLeft);
  }, true);
  option("lineNumbers", false, function(cm) {
    setGuttersForLineNumbers(cm.options);
    guttersChanged(cm);
  }, true);
  option("firstLineNumber", 1, guttersChanged, true);
  option("lineNumberFormatter", function(integer) {return integer;}, guttersChanged, true);
  option("showCursorWhenSelecting", false, updateSelection, true);

  option("resetSelectionOnContextMenu", true);
  option("lineWiseCopyCut", true);

  option("readOnly", false, function(cm, val) {
    if (val == "nocursor") {
      onBlur(cm);
      cm.display.input.blur();
      cm.display.disabled = true;
    } else {
      cm.display.disabled = false;
    }
    cm.display.input.readOnlyChanged(val)
  });
  option("disableInput", false, function(cm, val) {if (!val) cm.display.input.reset();}, true);
  option("dragDrop", true, dragDropChanged);
  option("allowDropFileTypes", null);

  option("cursorBlinkRate", 530);
  option("cursorScrollMargin", 0);
  option("cursorHeight", 1, updateSelection, true);
  option("singleCursorHeightPerLine", true, updateSelection, true);
  option("workTime", 100);
  option("workDelay", 100);
  option("flattenSpans", true, resetModeState, true);
  option("addModeClass", false, resetModeState, true);
  option("pollInterval", 100);
  option("undoDepth", 200, function(cm, val){cm.doc.history.undoDepth = val;});
  option("historyEventDelay", 1250);
  option("viewportMargin", 10, function(cm){cm.refresh();}, true);
  option("maxHighlightLength", 10000, resetModeState, true);
  option("moveInputWithCursor", true, function(cm, val) {
    if (!val) cm.display.input.resetPosition();
  });

  option("tabindex", null, function(cm, val) {
    cm.display.input.getField().tabIndex = val || "";
  });
  option("autofocus", null);

  // MODE DEFINITION AND QUERYING

  // Known modes, by name and by MIME
  var modes = CodeMirror.modes = {}, mimeModes = CodeMirror.mimeModes = {};

  // Extra arguments are stored as the mode's dependencies, which is
  // used by (legacy) mechanisms like loadmode.js to automatically
  // load a mode. (Preferred mechanism is the require/define calls.)
  CodeMirror.defineMode = function(name, mode) {
    if (!CodeMirror.defaults.mode && name != "null") CodeMirror.defaults.mode = name;
    if (arguments.length > 2)
      mode.dependencies = Array.prototype.slice.call(arguments, 2);
    modes[name] = mode;
  };

  CodeMirror.defineMIME = function(mime, spec) {
    mimeModes[mime] = spec;
  };

  // Given a MIME type, a {name, ...options} config object, or a name
  // string, return a mode config object.
  CodeMirror.resolveMode = function(spec) {
    if (typeof spec == "string" && mimeModes.hasOwnProperty(spec)) {
      spec = mimeModes[spec];
    } else if (spec && typeof spec.name == "string" && mimeModes.hasOwnProperty(spec.name)) {
      var found = mimeModes[spec.name];
      if (typeof found == "string") found = {name: found};
      spec = createObj(found, spec);
      spec.name = found.name;
    } else if (typeof spec == "string" && /^[\w\-]+\/[\w\-]+\+xml$/.test(spec)) {
      return CodeMirror.resolveMode("application/xml");
    }
    if (typeof spec == "string") return {name: spec};
    else return spec || {name: "null"};
  };

  // Given a mode spec (anything that resolveMode accepts), find and
  // initialize an actual mode object.
  CodeMirror.getMode = function(options, spec) {
    var spec = CodeMirror.resolveMode(spec);
    var mfactory = modes[spec.name];
    if (!mfactory) return CodeMirror.getMode(options, "text/plain");
    var modeObj = mfactory(options, spec);
    if (modeExtensions.hasOwnProperty(spec.name)) {
      var exts = modeExtensions[spec.name];
      for (var prop in exts) {
        if (!exts.hasOwnProperty(prop)) continue;
        if (modeObj.hasOwnProperty(prop)) modeObj["_" + prop] = modeObj[prop];
        modeObj[prop] = exts[prop];
      }
    }
    modeObj.name = spec.name;
    if (spec.helperType) modeObj.helperType = spec.helperType;
    if (spec.modeProps) for (var prop in spec.modeProps)
      modeObj[prop] = spec.modeProps[prop];

    return modeObj;
  };

  // Minimal default mode.
  CodeMirror.defineMode("null", function() {
    return {token: function(stream) {stream.skipToEnd();}};
  });
  CodeMirror.defineMIME("text/plain", "null");

  // This can be used to attach properties to mode objects from
  // outside the actual mode definition.
  var modeExtensions = CodeMirror.modeExtensions = {};
  CodeMirror.extendMode = function(mode, properties) {
    var exts = modeExtensions.hasOwnProperty(mode) ? modeExtensions[mode] : (modeExtensions[mode] = {});
    copyObj(properties, exts);
  };

  // EXTENSIONS

  CodeMirror.defineExtension = function(name, func) {
    CodeMirror.prototype[name] = func;
  };
  CodeMirror.defineDocExtension = function(name, func) {
    Doc.prototype[name] = func;
  };
  CodeMirror.defineOption = option;

  var initHooks = [];
  CodeMirror.defineInitHook = function(f) {initHooks.push(f);};

  var helpers = CodeMirror.helpers = {};
  CodeMirror.registerHelper = function(type, name, value) {
    if (!helpers.hasOwnProperty(type)) helpers[type] = CodeMirror[type] = {_global: []};
    helpers[type][name] = value;
  };
  CodeMirror.registerGlobalHelper = function(type, name, predicate, value) {
    CodeMirror.registerHelper(type, name, value);
    helpers[type]._global.push({pred: predicate, val: value});
  };

  // MODE STATE HANDLING

  // Utility functions for working with state. Exported because nested
  // modes need to do this for their inner modes.

  var copyState = CodeMirror.copyState = function(mode, state) {
    if (state === true) return state;
    if (mode.copyState) return mode.copyState(state);
    var nstate = {};
    for (var n in state) {
      var val = state[n];
      if (val instanceof Array) val = val.concat([]);
      nstate[n] = val;
    }
    return nstate;
  };

  var startState = CodeMirror.startState = function(mode, a1, a2) {
    return mode.startState ? mode.startState(a1, a2) : true;
  };

  // Given a mode and a state (for that mode), find the inner mode and
  // state at the position that the state refers to.
  CodeMirror.innerMode = function(mode, state) {
    while (mode.innerMode) {
      var info = mode.innerMode(state);
      if (!info || info.mode == mode) break;
      state = info.state;
      mode = info.mode;
    }
    return info || {mode: mode, state: state};
  };

  // STANDARD COMMANDS

  // Commands are parameter-less actions that can be performed on an
  // editor, mostly used for keybindings.
  var commands = CodeMirror.commands = {
    selectAll: function(cm) {cm.setSelection(Pos(cm.firstLine(), 0), Pos(cm.lastLine()), sel_dontScroll);},
    singleSelection: function(cm) {
      cm.setSelection(cm.getCursor("anchor"), cm.getCursor("head"), sel_dontScroll);
    },
    killLine: function(cm) {
      deleteNearSelection(cm, function(range) {
        if (range.empty()) {
          var len = getLine(cm.doc, range.head.line).text.length;
          if (range.head.ch == len && range.head.line < cm.lastLine())
            return {from: range.head, to: Pos(range.head.line + 1, 0)};
          else
            return {from: range.head, to: Pos(range.head.line, len)};
        } else {
          return {from: range.from(), to: range.to()};
        }
      });
    },
    deleteLine: function(cm) {
      deleteNearSelection(cm, function(range) {
        return {from: Pos(range.from().line, 0),
                to: clipPos(cm.doc, Pos(range.to().line + 1, 0))};
      });
    },
    delLineLeft: function(cm) {
      deleteNearSelection(cm, function(range) {
        return {from: Pos(range.from().line, 0), to: range.from()};
      });
    },
    delWrappedLineLeft: function(cm) {
      deleteNearSelection(cm, function(range) {
        var top = cm.charCoords(range.head, "div").top + 5;
        var leftPos = cm.coordsChar({left: 0, top: top}, "div");
        return {from: leftPos, to: range.from()};
      });
    },
    delWrappedLineRight: function(cm) {
      deleteNearSelection(cm, function(range) {
        var top = cm.charCoords(range.head, "div").top + 5;
        var rightPos = cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, "div");
        return {from: range.from(), to: rightPos };
      });
    },
    undo: function(cm) {cm.undo();},
    redo: function(cm) {cm.redo();},
    undoSelection: function(cm) {cm.undoSelection();},
    redoSelection: function(cm) {cm.redoSelection();},
    goDocStart: function(cm) {cm.extendSelection(Pos(cm.firstLine(), 0));},
    goDocEnd: function(cm) {cm.extendSelection(Pos(cm.lastLine()));},
    goLineStart: function(cm) {
      cm.extendSelectionsBy(function(range) { return lineStart(cm, range.head.line); },
                            {origin: "+move", bias: 1});
    },
    goLineStartSmart: function(cm) {
      cm.extendSelectionsBy(function(range) {
        return lineStartSmart(cm, range.head);
      }, {origin: "+move", bias: 1});
    },
    goLineEnd: function(cm) {
      cm.extendSelectionsBy(function(range) { return lineEnd(cm, range.head.line); },
                            {origin: "+move", bias: -1});
    },
    goLineRight: function(cm) {
      cm.extendSelectionsBy(function(range) {
        var top = cm.charCoords(range.head, "div").top + 5;
        return cm.coordsChar({left: cm.display.lineDiv.offsetWidth + 100, top: top}, "div");
      }, sel_move);
    },
    goLineLeft: function(cm) {
      cm.extendSelectionsBy(function(range) {
        var top = cm.charCoords(range.head, "div").top + 5;
        return cm.coordsChar({left: 0, top: top}, "div");
      }, sel_move);
    },
    goLineLeftSmart: function(cm) {
      cm.extendSelectionsBy(function(range) {
        var top = cm.charCoords(range.head, "div").top + 5;
        var pos = cm.coordsChar({left: 0, top: top}, "div");
        if (pos.ch < cm.getLine(pos.line).search(/\S/)) return lineStartSmart(cm, range.head);
        return pos;
      }, sel_move);
    },
    goLineUp: function(cm) {cm.moveV(-1, "line");},
    goLineDown: function(cm) {cm.moveV(1, "line");},
    goPageUp: function(cm) {cm.moveV(-1, "page");},
    goPageDown: function(cm) {cm.moveV(1, "page");},
    goCharLeft: function(cm) {cm.moveH(-1, "char");},
    goCharRight: function(cm) {cm.moveH(1, "char");},
    goColumnLeft: function(cm) {cm.moveH(-1, "column");},
    goColumnRight: function(cm) {cm.moveH(1, "column");},
    goWordLeft: function(cm) {cm.moveH(-1, "word");},
    goGroupRight: function(cm) {cm.moveH(1, "group");},
    goGroupLeft: function(cm) {cm.moveH(-1, "group");},
    goWordRight: function(cm) {cm.moveH(1, "word");},
    delCharBefore: function(cm) {cm.deleteH(-1, "char");},
    delCharAfter: function(cm) {cm.deleteH(1, "char");},
    delWordBefore: function(cm) {cm.deleteH(-1, "word");},
    delWordAfter: function(cm) {cm.deleteH(1, "word");},
    delGroupBefore: function(cm) {cm.deleteH(-1, "group");},
    delGroupAfter: function(cm) {cm.deleteH(1, "group");},
    indentAuto: function(cm) {cm.indentSelection("smart");},
    indentMore: function(cm) {cm.indentSelection("add");},
    indentLess: function(cm) {cm.indentSelection("subtract");},
    insertTab: function(cm) {cm.replaceSelection("\t");},
    insertSoftTab: function(cm) {
      var spaces = [], ranges = cm.listSelections(), tabSize = cm.options.tabSize;
      for (var i = 0; i < ranges.length; i++) {
        var pos = ranges[i].from();
        var col = countColumn(cm.getLine(pos.line), pos.ch, tabSize);
        spaces.push(new Array(tabSize - col % tabSize + 1).join(" "));
      }
      cm.replaceSelections(spaces);
    },
    defaultTab: function(cm) {
      if (cm.somethingSelected()) cm.indentSelection("add");
      else cm.execCommand("insertTab");
    },
    transposeChars: function(cm) {
      runInOp(cm, function() {
        var ranges = cm.listSelections(), newSel = [];
        for (var i = 0; i < ranges.length; i++) {
          var cur = ranges[i].head, line = getLine(cm.doc, cur.line).text;
          if (line) {
            if (cur.ch == line.length) cur = new Pos(cur.line, cur.ch - 1);
            if (cur.ch > 0) {
              cur = new Pos(cur.line, cur.ch + 1);
              cm.replaceRange(line.charAt(cur.ch - 1) + line.charAt(cur.ch - 2),
                              Pos(cur.line, cur.ch - 2), cur, "+transpose");
            } else if (cur.line > cm.doc.first) {
              var prev = getLine(cm.doc, cur.line - 1).text;
              if (prev)
                cm.replaceRange(line.charAt(0) + cm.doc.lineSeparator() +
                                prev.charAt(prev.length - 1),
                                Pos(cur.line - 1, prev.length - 1), Pos(cur.line, 1), "+transpose");
            }
          }
          newSel.push(new Range(cur, cur));
        }
        cm.setSelections(newSel);
      });
    },
    newlineAndIndent: function(cm) {
      runInOp(cm, function() {
        var len = cm.listSelections().length;
        for (var i = 0; i < len; i++) {
          var range = cm.listSelections()[i];
          cm.replaceRange(cm.doc.lineSeparator(), range.anchor, range.head, "+input");
          cm.indentLine(range.from().line + 1, null, true);
        }
        ensureCursorVisible(cm);
      });
    },
    toggleOverwrite: function(cm) {cm.toggleOverwrite();}
  };


  // STANDARD KEYMAPS

  var keyMap = CodeMirror.keyMap = {};

  keyMap.basic = {
    "Left": "goCharLeft", "Right": "goCharRight", "Up": "goLineUp", "Down": "goLineDown",
    "End": "goLineEnd", "Home": "goLineStartSmart", "PageUp": "goPageUp", "PageDown": "goPageDown",
    "Delete": "delCharAfter", "Backspace": "delCharBefore", "Shift-Backspace": "delCharBefore",
    "Tab": "defaultTab", "Shift-Tab": "indentAuto",
    "Enter": "newlineAndIndent", "Insert": "toggleOverwrite",
    "Esc": "singleSelection"
  };
  // Note that the save and find-related commands aren't defined by
  // default. User code or addons can define them. Unknown commands
  // are simply ignored.
  keyMap.pcDefault = {
    "Ctrl-A": "selectAll", "Ctrl-D": "deleteLine", "Ctrl-Z": "undo", "Shift-Ctrl-Z": "redo", "Ctrl-Y": "redo",
    "Ctrl-Home": "goDocStart", "Ctrl-End": "goDocEnd", "Ctrl-Up": "goLineUp", "Ctrl-Down": "goLineDown",
    "Ctrl-Left": "goGroupLeft", "Ctrl-Right": "goGroupRight", "Alt-Left": "goLineStart", "Alt-Right": "goLineEnd",
    "Ctrl-Backspace": "delGroupBefore", "Ctrl-Delete": "delGroupAfter", "Ctrl-S": "save", "Ctrl-F": "find",
    "Ctrl-G": "findNext", "Shift-Ctrl-G": "findPrev", "Shift-Ctrl-F": "replace", "Shift-Ctrl-R": "replaceAll",
    "Ctrl-[": "indentLess", "Ctrl-]": "indentMore",
    "Ctrl-U": "undoSelection", "Shift-Ctrl-U": "redoSelection", "Alt-U": "redoSelection",
    fallthrough: "basic"
  };
  // Very basic readline/emacs-style bindings, which are standard on Mac.
  keyMap.emacsy = {
    "Ctrl-F": "goCharRight", "Ctrl-B": "goCharLeft", "Ctrl-P": "goLineUp", "Ctrl-N": "goLineDown",
    "Alt-F": "goWordRight", "Alt-B": "goWordLeft", "Ctrl-A": "goLineStart", "Ctrl-E": "goLineEnd",
    "Ctrl-V": "goPageDown", "Shift-Ctrl-V": "goPageUp", "Ctrl-D": "delCharAfter", "Ctrl-H": "delCharBefore",
    "Alt-D": "delWordAfter", "Alt-Backspace": "delWordBefore", "Ctrl-K": "killLine", "Ctrl-T": "transposeChars"
  };
  keyMap.macDefault = {
    "Cmd-A": "selectAll", "Cmd-D": "deleteLine", "Cmd-Z": "undo", "Shift-Cmd-Z": "redo", "Cmd-Y": "redo",
    "Cmd-Home": "goDocStart", "Cmd-Up": "goDocStart", "Cmd-End": "goDocEnd", "Cmd-Down": "goDocEnd", "Alt-Left": "goGroupLeft",
    "Alt-Right": "goGroupRight", "Cmd-Left": "goLineLeft", "Cmd-Right": "goLineRight", "Alt-Backspace": "delGroupBefore",
    "Ctrl-Alt-Backspace": "delGroupAfter", "Alt-Delete": "delGroupAfter", "Cmd-S": "save", "Cmd-F": "find",
    "Cmd-G": "findNext", "Shift-Cmd-G": "findPrev", "Cmd-Alt-F": "replace", "Shift-Cmd-Alt-F": "replaceAll",
    "Cmd-[": "indentLess", "Cmd-]": "indentMore", "Cmd-Backspace": "delWrappedLineLeft", "Cmd-Delete": "delWrappedLineRight",
    "Cmd-U": "undoSelection", "Shift-Cmd-U": "redoSelection", "Ctrl-Up": "goDocStart", "Ctrl-Down": "goDocEnd",
    fallthrough: ["basic", "emacsy"]
  };
  keyMap["default"] = mac ? keyMap.macDefault : keyMap.pcDefault;

  // KEYMAP DISPATCH

  function normalizeKeyName(name) {
    var parts = name.split(/-(?!$)/), name = parts[parts.length - 1];
    var alt, ctrl, shift, cmd;
    for (var i = 0; i < parts.length - 1; i++) {
      var mod = parts[i];
      if (/^(cmd|meta|m)$/i.test(mod)) cmd = true;
      else if (/^a(lt)?$/i.test(mod)) alt = true;
      else if (/^(c|ctrl|control)$/i.test(mod)) ctrl = true;
      else if (/^s(hift)$/i.test(mod)) shift = true;
      else throw new Error("Unrecognized modifier name: " + mod);
    }
    if (alt) name = "Alt-" + name;
    if (ctrl) name = "Ctrl-" + name;
    if (cmd) name = "Cmd-" + name;
    if (shift) name = "Shift-" + name;
    return name;
  }

  // This is a kludge to keep keymaps mostly working as raw objects
  // (backwards compatibility) while at the same time support features
  // like normalization and multi-stroke key bindings. It compiles a
  // new normalized keymap, and then updates the old object to reflect
  // this.
  CodeMirror.normalizeKeyMap = function(keymap) {
    var copy = {};
    for (var keyname in keymap) if (keymap.hasOwnProperty(keyname)) {
      var value = keymap[keyname];
      if (/^(name|fallthrough|(de|at)tach)$/.test(keyname)) continue;
      if (value == "...") { delete keymap[keyname]; continue; }

      var keys = map(keyname.split(" "), normalizeKeyName);
      for (var i = 0; i < keys.length; i++) {
        var val, name;
        if (i == keys.length - 1) {
          name = keys.join(" ");
          val = value;
        } else {
          name = keys.slice(0, i + 1).join(" ");
          val = "...";
        }
        var prev = copy[name];
        if (!prev) copy[name] = val;
        else if (prev != val) throw new Error("Inconsistent bindings for " + name);
      }
      delete keymap[keyname];
    }
    for (var prop in copy) keymap[prop] = copy[prop];
    return keymap;
  };

  var lookupKey = CodeMirror.lookupKey = function(key, map, handle, context) {
    map = getKeyMap(map);
    var found = map.call ? map.call(key, context) : map[key];
    if (found === false) return "nothing";
    if (found === "...") return "multi";
    if (found != null && handle(found)) return "handled";

    if (map.fallthrough) {
      if (Object.prototype.toString.call(map.fallthrough) != "[object Array]")
        return lookupKey(key, map.fallthrough, handle, context);
      for (var i = 0; i < map.fallthrough.length; i++) {
        var result = lookupKey(key, map.fallthrough[i], handle, context);
        if (result) return result;
      }
    }
  };

  // Modifier key presses don't count as 'real' key presses for the
  // purpose of keymap fallthrough.
  var isModifierKey = CodeMirror.isModifierKey = function(value) {
    var name = typeof value == "string" ? value : keyNames[value.keyCode];
    return name == "Ctrl" || name == "Alt" || name == "Shift" || name == "Mod";
  };

  // Look up the name of a key as indicated by an event object.
  var keyName = CodeMirror.keyName = function(event, noShift) {
    if (presto && event.keyCode == 34 && event["char"]) return false;
    var base = keyNames[event.keyCode], name = base;
    if (name == null || event.altGraphKey) return false;
    if (event.altKey && base != "Alt") name = "Alt-" + name;
    if ((flipCtrlCmd ? event.metaKey : event.ctrlKey) && base != "Ctrl") name = "Ctrl-" + name;
    if ((flipCtrlCmd ? event.ctrlKey : event.metaKey) && base != "Cmd") name = "Cmd-" + name;
    if (!noShift && event.shiftKey && base != "Shift") name = "Shift-" + name;
    return name;
  };

  function getKeyMap(val) {
    return typeof val == "string" ? keyMap[val] : val;
  }

  // FROMTEXTAREA

  CodeMirror.fromTextArea = function(textarea, options) {
    options = options ? copyObj(options) : {};
    options.value = textarea.value;
    if (!options.tabindex && textarea.tabIndex)
      options.tabindex = textarea.tabIndex;
    if (!options.placeholder && textarea.placeholder)
      options.placeholder = textarea.placeholder;
    // Set autofocus to true if this textarea is focused, or if it has
    // autofocus and no other element is focused.
    if (options.autofocus == null) {
      var hasFocus = activeElt();
      options.autofocus = hasFocus == textarea ||
        textarea.getAttribute("autofocus") != null && hasFocus == document.body;
    }

    function save() {textarea.value = cm.getValue();}
    if (textarea.form) {
      on(textarea.form, "submit", save);
      // Deplorable hack to make the submit method do the right thing.
      if (!options.leaveSubmitMethodAlone) {
        var form = textarea.form, realSubmit = form.submit;
        try {
          var wrappedSubmit = form.submit = function() {
            save();
            form.submit = realSubmit;
            form.submit();
            form.submit = wrappedSubmit;
          };
        } catch(e) {}
      }
    }

    options.finishInit = function(cm) {
      cm.save = save;
      cm.getTextArea = function() { return textarea; };
      cm.toTextArea = function() {
        cm.toTextArea = isNaN; // Prevent this from being ran twice
        save();
        textarea.parentNode.removeChild(cm.getWrapperElement());
        textarea.style.display = "";
        if (textarea.form) {
          off(textarea.form, "submit", save);
          if (typeof textarea.form.submit == "function")
            textarea.form.submit = realSubmit;
        }
      };
    };

    textarea.style.display = "none";
    var cm = CodeMirror(function(node) {
      textarea.parentNode.insertBefore(node, textarea.nextSibling);
    }, options);
    return cm;
  };

  // STRING STREAM

  // Fed to the mode parsers, provides helper functions to make
  // parsers more succinct.

  var StringStream = CodeMirror.StringStream = function(string, tabSize) {
    this.pos = this.start = 0;
    this.string = string;
    this.tabSize = tabSize || 8;
    this.lastColumnPos = this.lastColumnValue = 0;
    this.lineStart = 0;
  };

  StringStream.prototype = {
    eol: function() {return this.pos >= this.string.length;},
    sol: function() {return this.pos == this.lineStart;},
    peek: function() {return this.string.charAt(this.pos) || undefined;},
    next: function() {
      if (this.pos < this.string.length)
        return this.string.charAt(this.pos++);
    },
    eat: function(match) {
      var ch = this.string.charAt(this.pos);
      if (typeof match == "string") var ok = ch == match;
      else var ok = ch && (match.test ? match.test(ch) : match(ch));
      if (ok) {++this.pos; return ch;}
    },
    eatWhile: function(match) {
      var start = this.pos;
      while (this.eat(match)){}
      return this.pos > start;
    },
    eatSpace: function() {
      var start = this.pos;
      while (/[\s\u00a0]/.test(this.string.charAt(this.pos))) ++this.pos;
      return this.pos > start;
    },
    skipToEnd: function() {this.pos = this.string.length;},
    skipTo: function(ch) {
      var found = this.string.indexOf(ch, this.pos);
      if (found > -1) {this.pos = found; return true;}
    },
    backUp: function(n) {this.pos -= n;},
    column: function() {
      if (this.lastColumnPos < this.start) {
        this.lastColumnValue = countColumn(this.string, this.start, this.tabSize, this.lastColumnPos, this.lastColumnValue);
        this.lastColumnPos = this.start;
      }
      return this.lastColumnValue - (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0);
    },
    indentation: function() {
      return countColumn(this.string, null, this.tabSize) -
        (this.lineStart ? countColumn(this.string, this.lineStart, this.tabSize) : 0);
    },
    match: function(pattern, consume, caseInsensitive) {
      if (typeof pattern == "string") {
        var cased = function(str) {return caseInsensitive ? str.toLowerCase() : str;};
        var substr = this.string.substr(this.pos, pattern.length);
        if (cased(substr) == cased(pattern)) {
          if (consume !== false) this.pos += pattern.length;
          return true;
        }
      } else {
        var match = this.string.slice(this.pos).match(pattern);
        if (match && match.index > 0) return null;
        if (match && consume !== false) this.pos += match[0].length;
        return match;
      }
    },
    current: function(){return this.string.slice(this.start, this.pos);},
    hideFirstChars: function(n, inner) {
      this.lineStart += n;
      try { return inner(); }
      finally { this.lineStart -= n; }
    }
  };

  // TEXTMARKERS

  // Created with markText and setBookmark methods. A TextMarker is a
  // handle that can be used to clear or find a marked position in the
  // document. Line objects hold arrays (markedSpans) containing
  // {from, to, marker} object pointing to such marker objects, and
  // indicating that such a marker is present on that line. Multiple
  // lines may point to the same marker when it spans across lines.
  // The spans will have null for their from/to properties when the
  // marker continues beyond the start/end of the line. Markers have
  // links back to the lines they currently touch.

  var nextMarkerId = 0;

  var TextMarker = CodeMirror.TextMarker = function(doc, type) {
    this.lines = [];
    this.type = type;
    this.doc = doc;
    this.id = ++nextMarkerId;
  };
  eventMixin(TextMarker);

  // Clear the marker.
  TextMarker.prototype.clear = function() {
    if (this.explicitlyCleared) return;
    var cm = this.doc.cm, withOp = cm && !cm.curOp;
    if (withOp) startOperation(cm);
    if (hasHandler(this, "clear")) {
      var found = this.find();
      if (found) signalLater(this, "clear", found.from, found.to);
    }
    var min = null, max = null;
    for (var i = 0; i < this.lines.length; ++i) {
      var line = this.lines[i];
      var span = getMarkedSpanFor(line.markedSpans, this);
      if (cm && !this.collapsed) regLineChange(cm, lineNo(line), "text");
      else if (cm) {
        if (span.to != null) max = lineNo(line);
        if (span.from != null) min = lineNo(line);
      }
      line.markedSpans = removeMarkedSpan(line.markedSpans, span);
      if (span.from == null && this.collapsed && !lineIsHidden(this.doc, line) && cm)
        updateLineHeight(line, textHeight(cm.display));
    }
    if (cm && this.collapsed && !cm.options.lineWrapping) for (var i = 0; i < this.lines.length; ++i) {
      var visual = visualLine(this.lines[i]), len = lineLength(visual);
      if (len > cm.display.maxLineLength) {
        cm.display.maxLine = visual;
        cm.display.maxLineLength = len;
        cm.display.maxLineChanged = true;
      }
    }

    if (min != null && cm && this.collapsed) regChange(cm, min, max + 1);
    this.lines.length = 0;
    this.explicitlyCleared = true;
    if (this.atomic && this.doc.cantEdit) {
      this.doc.cantEdit = false;
      if (cm) reCheckSelection(cm.doc);
    }
    if (cm) signalLater(cm, "markerCleared", cm, this);
    if (withOp) endOperation(cm);
    if (this.parent) this.parent.clear();
  };

  // Find the position of the marker in the document. Returns a {from,
  // to} object by default. Side can be passed to get a specific side
  // -- 0 (both), -1 (left), or 1 (right). When lineObj is true, the
  // Pos objects returned contain a line object, rather than a line
  // number (used to prevent looking up the same line twice).
  TextMarker.prototype.find = function(side, lineObj) {
    if (side == null && this.type == "bookmark") side = 1;
    var from, to;
    for (var i = 0; i < this.lines.length; ++i) {
      var line = this.lines[i];
      var span = getMarkedSpanFor(line.markedSpans, this);
      if (span.from != null) {
        from = Pos(lineObj ? line : lineNo(line), span.from);
        if (side == -1) return from;
      }
      if (span.to != null) {
        to = Pos(lineObj ? line : lineNo(line), span.to);
        if (side == 1) return to;
      }
    }
    return from && {from: from, to: to};
  };

  // Signals that the marker's widget changed, and surrounding layout
  // should be recomputed.
  TextMarker.prototype.changed = function() {
    var pos = this.find(-1, true), widget = this, cm = this.doc.cm;
    if (!pos || !cm) return;
    runInOp(cm, function() {
      var line = pos.line, lineN = lineNo(pos.line);
      var view = findViewForLine(cm, lineN);
      if (view) {
        clearLineMeasurementCacheFor(view);
        cm.curOp.selectionChanged = cm.curOp.forceUpdate = true;
      }
      cm.curOp.updateMaxLine = true;
      if (!lineIsHidden(widget.doc, line) && widget.height != null) {
        var oldHeight = widget.height;
        widget.height = null;
        var dHeight = widgetHeight(widget) - oldHeight;
        if (dHeight)
          updateLineHeight(line, line.height + dHeight);
      }
    });
  };

  TextMarker.prototype.attachLine = function(line) {
    if (!this.lines.length && this.doc.cm) {
      var op = this.doc.cm.curOp;
      if (!op.maybeHiddenMarkers || indexOf(op.maybeHiddenMarkers, this) == -1)
        (op.maybeUnhiddenMarkers || (op.maybeUnhiddenMarkers = [])).push(this);
    }
    this.lines.push(line);
  };
  TextMarker.prototype.detachLine = function(line) {
    this.lines.splice(indexOf(this.lines, line), 1);
    if (!this.lines.length && this.doc.cm) {
      var op = this.doc.cm.curOp;
      (op.maybeHiddenMarkers || (op.maybeHiddenMarkers = [])).push(this);
    }
  };

  // Collapsed markers have unique ids, in order to be able to order
  // them, which is needed for uniquely determining an outer marker
  // when they overlap (they may nest, but not partially overlap).
  var nextMarkerId = 0;

  // Create a marker, wire it up to the right lines, and
  function markText(doc, from, to, options, type) {
    // Shared markers (across linked documents) are handled separately
    // (markTextShared will call out to this again, once per
    // document).
    if (options && options.shared) return markTextShared(doc, from, to, options, type);
    // Ensure we are in an operation.
    if (doc.cm && !doc.cm.curOp) return operation(doc.cm, markText)(doc, from, to, options, type);

    var marker = new TextMarker(doc, type), diff = cmp(from, to);
    if (options) copyObj(options, marker, false);
    // Don't connect empty markers unless clearWhenEmpty is false
    if (diff > 0 || diff == 0 && marker.clearWhenEmpty !== false)
      return marker;
    if (marker.replacedWith) {
      // Showing up as a widget implies collapsed (widget replaces text)
      marker.collapsed = true;
      marker.widgetNode = elt("span", [marker.replacedWith], "CodeMirror-widget");
      if (!options.handleMouseEvents) marker.widgetNode.setAttribute("cm-ignore-events", "true");
      if (options.insertLeft) marker.widgetNode.insertLeft = true;
    }
    if (marker.collapsed) {
      if (conflictingCollapsedRange(doc, from.line, from, to, marker) ||
          from.line != to.line && conflictingCollapsedRange(doc, to.line, from, to, marker))
        throw new Error("Inserting collapsed marker partially overlapping an existing one");
      sawCollapsedSpans = true;
    }

    if (marker.addToHistory)
      addChangeToHistory(doc, {from: from, to: to, origin: "markText"}, doc.sel, NaN);

    var curLine = from.line, cm = doc.cm, updateMaxLine;
    doc.iter(curLine, to.line + 1, function(line) {
      if (cm && marker.collapsed && !cm.options.lineWrapping && visualLine(line) == cm.display.maxLine)
        updateMaxLine = true;
      if (marker.collapsed && curLine != from.line) updateLineHeight(line, 0);
      addMarkedSpan(line, new MarkedSpan(marker,
                                         curLine == from.line ? from.ch : null,
                                         curLine == to.line ? to.ch : null));
      ++curLine;
    });
    // lineIsHidden depends on the presence of the spans, so needs a second pass
    if (marker.collapsed) doc.iter(from.line, to.line + 1, function(line) {
      if (lineIsHidden(doc, line)) updateLineHeight(line, 0);
    });

    if (marker.clearOnEnter) on(marker, "beforeCursorEnter", function() { marker.clear(); });

    if (marker.readOnly) {
      sawReadOnlySpans = true;
      if (doc.history.done.length || doc.history.undone.length)
        doc.clearHistory();
    }
    if (marker.collapsed) {
      marker.id = ++nextMarkerId;
      marker.atomic = true;
    }
    if (cm) {
      // Sync editor state
      if (updateMaxLine) cm.curOp.updateMaxLine = true;
      if (marker.collapsed)
        regChange(cm, from.line, to.line + 1);
      else if (marker.className || marker.title || marker.startStyle || marker.endStyle || marker.css)
        for (var i = from.line; i <= to.line; i++) regLineChange(cm, i, "text");
      if (marker.atomic) reCheckSelection(cm.doc);
      signalLater(cm, "markerAdded", cm, marker);
    }
    return marker;
  }

  // SHARED TEXTMARKERS

  // A shared marker spans multiple linked documents. It is
  // implemented as a meta-marker-object controlling multiple normal
  // markers.
  var SharedTextMarker = CodeMirror.SharedTextMarker = function(markers, primary) {
    this.markers = markers;
    this.primary = primary;
    for (var i = 0; i < markers.length; ++i)
      markers[i].parent = this;
  };
  eventMixin(SharedTextMarker);

  SharedTextMarker.prototype.clear = function() {
    if (this.explicitlyCleared) return;
    this.explicitlyCleared = true;
    for (var i = 0; i < this.markers.length; ++i)
      this.markers[i].clear();
    signalLater(this, "clear");
  };
  SharedTextMarker.prototype.find = function(side, lineObj) {
    return this.primary.find(side, lineObj);
  };

  function markTextShared(doc, from, to, options, type) {
    options = copyObj(options);
    options.shared = false;
    var markers = [markText(doc, from, to, options, type)], primary = markers[0];
    var widget = options.widgetNode;
    linkedDocs(doc, function(doc) {
      if (widget) options.widgetNode = widget.cloneNode(true);
      markers.push(markText(doc, clipPos(doc, from), clipPos(doc, to), options, type));
      for (var i = 0; i < doc.linked.length; ++i)
        if (doc.linked[i].isParent) return;
      primary = lst(markers);
    });
    return new SharedTextMarker(markers, primary);
  }

  function findSharedMarkers(doc) {
    return doc.findMarks(Pos(doc.first, 0), doc.clipPos(Pos(doc.lastLine())),
                         function(m) { return m.parent; });
  }

  function copySharedMarkers(doc, markers) {
    for (var i = 0; i < markers.length; i++) {
      var marker = markers[i], pos = marker.find();
      var mFrom = doc.clipPos(pos.from), mTo = doc.clipPos(pos.to);
      if (cmp(mFrom, mTo)) {
        var subMark = markText(doc, mFrom, mTo, marker.primary, marker.primary.type);
        marker.markers.push(subMark);
        subMark.parent = marker;
      }
    }
  }

  function detachSharedMarkers(markers) {
    for (var i = 0; i < markers.length; i++) {
      var marker = markers[i], linked = [marker.primary.doc];;
      linkedDocs(marker.primary.doc, function(d) { linked.push(d); });
      for (var j = 0; j < marker.markers.length; j++) {
        var subMarker = marker.markers[j];
        if (indexOf(linked, subMarker.doc) == -1) {
          subMarker.parent = null;
          marker.markers.splice(j--, 1);
        }
      }
    }
  }

  // TEXTMARKER SPANS

  function MarkedSpan(marker, from, to) {
    this.marker = marker;
    this.from = from; this.to = to;
  }

  // Search an array of spans for a span matching the given marker.
  function getMarkedSpanFor(spans, marker) {
    if (spans) for (var i = 0; i < spans.length; ++i) {
      var span = spans[i];
      if (span.marker == marker) return span;
    }
  }
  // Remove a span from an array, returning undefined if no spans are
  // left (we don't store arrays for lines without spans).
  function removeMarkedSpan(spans, span) {
    for (var r, i = 0; i < spans.length; ++i)
      if (spans[i] != span) (r || (r = [])).push(spans[i]);
    return r;
  }
  // Add a span to a line.
  function addMarkedSpan(line, span) {
    line.markedSpans = line.markedSpans ? line.markedSpans.concat([span]) : [span];
    span.marker.attachLine(line);
  }

  // Used for the algorithm that adjusts markers for a change in the
  // document. These functions cut an array of spans at a given
  // character position, returning an array of remaining chunks (or
  // undefined if nothing remains).
  function markedSpansBefore(old, startCh, isInsert) {
    if (old) for (var i = 0, nw; i < old.length; ++i) {
      var span = old[i], marker = span.marker;
      var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= startCh : span.from < startCh);
      if (startsBefore || span.from == startCh && marker.type == "bookmark" && (!isInsert || !span.marker.insertLeft)) {
        var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= startCh : span.to > startCh);
        (nw || (nw = [])).push(new MarkedSpan(marker, span.from, endsAfter ? null : span.to));
      }
    }
    return nw;
  }
  function markedSpansAfter(old, endCh, isInsert) {
    if (old) for (var i = 0, nw; i < old.length; ++i) {
      var span = old[i], marker = span.marker;
      var endsAfter = span.to == null || (marker.inclusiveRight ? span.to >= endCh : span.to > endCh);
      if (endsAfter || span.from == endCh && marker.type == "bookmark" && (!isInsert || span.marker.insertLeft)) {
        var startsBefore = span.from == null || (marker.inclusiveLeft ? span.from <= endCh : span.from < endCh);
        (nw || (nw = [])).push(new MarkedSpan(marker, startsBefore ? null : span.from - endCh,
                                              span.to == null ? null : span.to - endCh));
      }
    }
    return nw;
  }

  // Given a change object, compute the new set of marker spans that
  // cover the line in which the change took place. Removes spans
  // entirely within the change, reconnects spans belonging to the
  // same marker that appear on both sides of the change, and cuts off
  // spans partially within the change. Returns an array of span
  // arrays with one element for each line in (after) the change.
  function stretchSpansOverChange(doc, change) {
    if (change.full) return null;
    var oldFirst = isLine(doc, change.from.line) && getLine(doc, change.from.line).markedSpans;
    var oldLast = isLine(doc, change.to.line) && getLine(doc, change.to.line).markedSpans;
    if (!oldFirst && !oldLast) return null;

    var startCh = change.from.ch, endCh = change.to.ch, isInsert = cmp(change.from, change.to) == 0;
    // Get the spans that 'stick out' on both sides
    var first = markedSpansBefore(oldFirst, startCh, isInsert);
    var last = markedSpansAfter(oldLast, endCh, isInsert);

    // Next, merge those two ends
    var sameLine = change.text.length == 1, offset = lst(change.text).length + (sameLine ? startCh : 0);
    if (first) {
      // Fix up .to properties of first
      for (var i = 0; i < first.length; ++i) {
        var span = first[i];
        if (span.to == null) {
          var found = getMarkedSpanFor(last, span.marker);
          if (!found) span.to = startCh;
          else if (sameLine) span.to = found.to == null ? null : found.to + offset;
        }
      }
    }
    if (last) {
      // Fix up .from in last (or move them into first in case of sameLine)
      for (var i = 0; i < last.length; ++i) {
        var span = last[i];
        if (span.to != null) span.to += offset;
        if (span.from == null) {
          var found = getMarkedSpanFor(first, span.marker);
          if (!found) {
            span.from = offset;
            if (sameLine) (first || (first = [])).push(span);
          }
        } else {
          span.from += offset;
          if (sameLine) (first || (first = [])).push(span);
        }
      }
    }
    // Make sure we didn't create any zero-length spans
    if (first) first = clearEmptySpans(first);
    if (last && last != first) last = clearEmptySpans(last);

    var newMarkers = [first];
    if (!sameLine) {
      // Fill gap with whole-line-spans
      var gap = change.text.length - 2, gapMarkers;
      if (gap > 0 && first)
        for (var i = 0; i < first.length; ++i)
          if (first[i].to == null)
            (gapMarkers || (gapMarkers = [])).push(new MarkedSpan(first[i].marker, null, null));
      for (var i = 0; i < gap; ++i)
        newMarkers.push(gapMarkers);
      newMarkers.push(last);
    }
    return newMarkers;
  }

  // Remove spans that are empty and don't have a clearWhenEmpty
  // option of false.
  function clearEmptySpans(spans) {
    for (var i = 0; i < spans.length; ++i) {
      var span = spans[i];
      if (span.from != null && span.from == span.to && span.marker.clearWhenEmpty !== false)
        spans.splice(i--, 1);
    }
    if (!spans.length) return null;
    return spans;
  }

  // Used for un/re-doing changes from the history. Combines the
  // result of computing the existing spans with the set of spans that
  // existed in the history (so that deleting around a span and then
  // undoing brings back the span).
  function mergeOldSpans(doc, change) {
    var old = getOldSpans(doc, change);
    var stretched = stretchSpansOverChange(doc, change);
    if (!old) return stretched;
    if (!stretched) return old;

    for (var i = 0; i < old.length; ++i) {
      var oldCur = old[i], stretchCur = stretched[i];
      if (oldCur && stretchCur) {
        spans: for (var j = 0; j < stretchCur.length; ++j) {
          var span = stretchCur[j];
          for (var k = 0; k < oldCur.length; ++k)
            if (oldCur[k].marker == span.marker) continue spans;
          oldCur.push(span);
        }
      } else if (stretchCur) {
        old[i] = stretchCur;
      }
    }
    return old;
  }

  // Used to 'clip' out readOnly ranges when making a change.
  function removeReadOnlyRanges(doc, from, to) {
    var markers = null;
    doc.iter(from.line, to.line + 1, function(line) {
      if (line.markedSpans) for (var i = 0; i < line.markedSpans.length; ++i) {
        var mark = line.markedSpans[i].marker;
        if (mark.readOnly && (!markers || indexOf(markers, mark) == -1))
          (markers || (markers = [])).push(mark);
      }
    });
    if (!markers) return null;
    var parts = [{from: from, to: to}];
    for (var i = 0; i < markers.length; ++i) {
      var mk = markers[i], m = mk.find(0);
      for (var j = 0; j < parts.length; ++j) {
        var p = parts[j];
        if (cmp(p.to, m.from) < 0 || cmp(p.from, m.to) > 0) continue;
        var newParts = [j, 1], dfrom = cmp(p.from, m.from), dto = cmp(p.to, m.to);
        if (dfrom < 0 || !mk.inclusiveLeft && !dfrom)
          newParts.push({from: p.from, to: m.from});
        if (dto > 0 || !mk.inclusiveRight && !dto)
          newParts.push({from: m.to, to: p.to});
        parts.splice.apply(parts, newParts);
        j += newParts.length - 1;
      }
    }
    return parts;
  }

  // Connect or disconnect spans from a line.
  function detachMarkedSpans(line) {
    var spans = line.markedSpans;
    if (!spans) return;
    for (var i = 0; i < spans.length; ++i)
      spans[i].marker.detachLine(line);
    line.markedSpans = null;
  }
  function attachMarkedSpans(line, spans) {
    if (!spans) return;
    for (var i = 0; i < spans.length; ++i)
      spans[i].marker.attachLine(line);
    line.markedSpans = spans;
  }

  // Helpers used when computing which overlapping collapsed span
  // counts as the larger one.
  function extraLeft(marker) { return marker.inclusiveLeft ? -1 : 0; }
  function extraRight(marker) { return marker.inclusiveRight ? 1 : 0; }

  // Returns a number indicating which of two overlapping collapsed
  // spans is larger (and thus includes the other). Falls back to
  // comparing ids when the spans cover exactly the same range.
  function compareCollapsedMarkers(a, b) {
    var lenDiff = a.lines.length - b.lines.length;
    if (lenDiff != 0) return lenDiff;
    var aPos = a.find(), bPos = b.find();
    var fromCmp = cmp(aPos.from, bPos.from) || extraLeft(a) - extraLeft(b);
    if (fromCmp) return -fromCmp;
    var toCmp = cmp(aPos.to, bPos.to) || extraRight(a) - extraRight(b);
    if (toCmp) return toCmp;
    return b.id - a.id;
  }

  // Find out whether a line ends or starts in a collapsed span. If
  // so, return the marker for that span.
  function collapsedSpanAtSide(line, start) {
    var sps = sawCollapsedSpans && line.markedSpans, found;
    if (sps) for (var sp, i = 0; i < sps.length; ++i) {
      sp = sps[i];
      if (sp.marker.collapsed && (start ? sp.from : sp.to) == null &&
          (!found || compareCollapsedMarkers(found, sp.marker) < 0))
        found = sp.marker;
    }
    return found;
  }
  function collapsedSpanAtStart(line) { return collapsedSpanAtSide(line, true); }
  function collapsedSpanAtEnd(line) { return collapsedSpanAtSide(line, false); }

  // Test whether there exists a collapsed span that partially
  // overlaps (covers the start or end, but not both) of a new span.
  // Such overlap is not allowed.
  function conflictingCollapsedRange(doc, lineNo, from, to, marker) {
    var line = getLine(doc, lineNo);
    var sps = sawCollapsedSpans && line.markedSpans;
    if (sps) for (var i = 0; i < sps.length; ++i) {
      var sp = sps[i];
      if (!sp.marker.collapsed) continue;
      var found = sp.marker.find(0);
      var fromCmp = cmp(found.from, from) || extraLeft(sp.marker) - extraLeft(marker);
      var toCmp = cmp(found.to, to) || extraRight(sp.marker) - extraRight(marker);
      if (fromCmp >= 0 && toCmp <= 0 || fromCmp <= 0 && toCmp >= 0) continue;
      if (fromCmp <= 0 && (cmp(found.to, from) > 0 || (sp.marker.inclusiveRight && marker.inclusiveLeft)) ||
          fromCmp >= 0 && (cmp(found.from, to) < 0 || (sp.marker.inclusiveLeft && marker.inclusiveRight)))
        return true;
    }
  }

  // A visual line is a line as drawn on the screen. Folding, for
  // example, can cause multiple logical lines to appear on the same
  // visual line. This finds the start of the visual line that the
  // given line is part of (usually that is the line itself).
  function visualLine(line) {
    var merged;
    while (merged = collapsedSpanAtStart(line))
      line = merged.find(-1, true).line;
    return line;
  }

  // Returns an array of logical lines that continue the visual line
  // started by the argument, or undefined if there are no such lines.
  function visualLineContinued(line) {
    var merged, lines;
    while (merged = collapsedSpanAtEnd(line)) {
      line = merged.find(1, true).line;
      (lines || (lines = [])).push(line);
    }
    return lines;
  }

  // Get the line number of the start of the visual line that the
  // given line number is part of.
  function visualLineNo(doc, lineN) {
    var line = getLine(doc, lineN), vis = visualLine(line);
    if (line == vis) return lineN;
    return lineNo(vis);
  }
  // Get the line number of the start of the next visual line after
  // the given line.
  function visualLineEndNo(doc, lineN) {
    if (lineN > doc.lastLine()) return lineN;
    var line = getLine(doc, lineN), merged;
    if (!lineIsHidden(doc, line)) return lineN;
    while (merged = collapsedSpanAtEnd(line))
      line = merged.find(1, true).line;
    return lineNo(line) + 1;
  }

  // Compute whether a line is hidden. Lines count as hidden when they
  // are part of a visual line that starts with another line, or when
  // they are entirely covered by collapsed, non-widget span.
  function lineIsHidden(doc, line) {
    var sps = sawCollapsedSpans && line.markedSpans;
    if (sps) for (var sp, i = 0; i < sps.length; ++i) {
      sp = sps[i];
      if (!sp.marker.collapsed) continue;
      if (sp.from == null) return true;
      if (sp.marker.widgetNode) continue;
      if (sp.from == 0 && sp.marker.inclusiveLeft && lineIsHiddenInner(doc, line, sp))
        return true;
    }
  }
  function lineIsHiddenInner(doc, line, span) {
    if (span.to == null) {
      var end = span.marker.find(1, true);
      return lineIsHiddenInner(doc, end.line, getMarkedSpanFor(end.line.markedSpans, span.marker));
    }
    if (span.marker.inclusiveRight && span.to == line.text.length)
      return true;
    for (var sp, i = 0; i < line.markedSpans.length; ++i) {
      sp = line.markedSpans[i];
      if (sp.marker.collapsed && !sp.marker.widgetNode && sp.from == span.to &&
          (sp.to == null || sp.to != span.from) &&
          (sp.marker.inclusiveLeft || span.marker.inclusiveRight) &&
          lineIsHiddenInner(doc, line, sp)) return true;
    }
  }

  // LINE WIDGETS

  // Line widgets are block elements displayed above or below a line.

  var LineWidget = CodeMirror.LineWidget = function(doc, node, options) {
    if (options) for (var opt in options) if (options.hasOwnProperty(opt))
      this[opt] = options[opt];
    this.doc = doc;
    this.node = node;
  };
  eventMixin(LineWidget);

  function adjustScrollWhenAboveVisible(cm, line, diff) {
    if (heightAtLine(line) < ((cm.curOp && cm.curOp.scrollTop) || cm.doc.scrollTop))
      addToScrollPos(cm, null, diff);
  }

  LineWidget.prototype.clear = function() {
    var cm = this.doc.cm, ws = this.line.widgets, line = this.line, no = lineNo(line);
    if (no == null || !ws) return;
    for (var i = 0; i < ws.length; ++i) if (ws[i] == this) ws.splice(i--, 1);
    if (!ws.length) line.widgets = null;
    var height = widgetHeight(this);
    updateLineHeight(line, Math.max(0, line.height - height));
    if (cm) runInOp(cm, function() {
      adjustScrollWhenAboveVisible(cm, line, -height);
      regLineChange(cm, no, "widget");
    });
  };
  LineWidget.prototype.changed = function() {
    var oldH = this.height, cm = this.doc.cm, line = this.line;
    this.height = null;
    var diff = widgetHeight(this) - oldH;
    if (!diff) return;
    updateLineHeight(line, line.height + diff);
    if (cm) runInOp(cm, function() {
      cm.curOp.forceUpdate = true;
      adjustScrollWhenAboveVisible(cm, line, diff);
    });
  };

  function widgetHeight(widget) {
    if (widget.height != null) return widget.height;
    var cm = widget.doc.cm;
    if (!cm) return 0;
    if (!contains(document.body, widget.node)) {
      var parentStyle = "position: relative;";
      if (widget.coverGutter)
        parentStyle += "margin-left: -" + cm.display.gutters.offsetWidth + "px;";
      if (widget.noHScroll)
        parentStyle += "width: " + cm.display.wrapper.clientWidth + "px;";
      removeChildrenAndAdd(cm.display.measure, elt("div", [widget.node], null, parentStyle));
    }
    return widget.height = widget.node.offsetHeight;
  }

  function addLineWidget(doc, handle, node, options) {
    var widget = new LineWidget(doc, node, options);
    var cm = doc.cm;
    if (cm && widget.noHScroll) cm.display.alignWidgets = true;
    changeLine(doc, handle, "widget", function(line) {
      var widgets = line.widgets || (line.widgets = []);
      if (widget.insertAt == null) widgets.push(widget);
      else widgets.splice(Math.min(widgets.length - 1, Math.max(0, widget.insertAt)), 0, widget);
      widget.line = line;
      if (cm && !lineIsHidden(doc, line)) {
        var aboveVisible = heightAtLine(line) < doc.scrollTop;
        updateLineHeight(line, line.height + widgetHeight(widget));
        if (aboveVisible) addToScrollPos(cm, null, widget.height);
        cm.curOp.forceUpdate = true;
      }
      return true;
    });
    return widget;
  }

  // LINE DATA STRUCTURE

  // Line objects. These hold state related to a line, including
  // highlighting info (the styles array).
  var Line = CodeMirror.Line = function(text, markedSpans, estimateHeight) {
    this.text = text;
    attachMarkedSpans(this, markedSpans);
    this.height = estimateHeight ? estimateHeight(this) : 1;
  };
  eventMixin(Line);
  Line.prototype.lineNo = function() { return lineNo(this); };

  // Change the content (text, markers) of a line. Automatically
  // invalidates cached information and tries to re-estimate the
  // line's height.
  function updateLine(line, text, markedSpans, estimateHeight) {
    line.text = text;
    if (line.stateAfter) line.stateAfter = null;
    if (line.styles) line.styles = null;
    if (line.order != null) line.order = null;
    detachMarkedSpans(line);
    attachMarkedSpans(line, markedSpans);
    var estHeight = estimateHeight ? estimateHeight(line) : 1;
    if (estHeight != line.height) updateLineHeight(line, estHeight);
  }

  // Detach a line from the document tree and its markers.
  function cleanUpLine(line) {
    line.parent = null;
    detachMarkedSpans(line);
  }

  function extractLineClasses(type, output) {
    if (type) for (;;) {
      var lineClass = type.match(/(?:^|\s+)line-(background-)?(\S+)/);
      if (!lineClass) break;
      type = type.slice(0, lineClass.index) + type.slice(lineClass.index + lineClass[0].length);
      var prop = lineClass[1] ? "bgClass" : "textClass";
      if (output[prop] == null)
        output[prop] = lineClass[2];
      else if (!(new RegExp("(?:^|\s)" + lineClass[2] + "(?:$|\s)")).test(output[prop]))
        output[prop] += " " + lineClass[2];
    }
    return type;
  }

  function callBlankLine(mode, state) {
    if (mode.blankLine) return mode.blankLine(state);
    if (!mode.innerMode) return;
    var inner = CodeMirror.innerMode(mode, state);
    if (inner.mode.blankLine) return inner.mode.blankLine(inner.state);
  }

  function readToken(mode, stream, state, inner) {
    for (var i = 0; i < 10; i++) {
      if (inner) inner[0] = CodeMirror.innerMode(mode, state).mode;
      var style = mode.token(stream, state);
      if (stream.pos > stream.start) return style;
    }
    throw new Error("Mode " + mode.name + " failed to advance stream.");
  }

  // Utility for getTokenAt and getLineTokens
  function takeToken(cm, pos, precise, asArray) {
    function getObj(copy) {
      return {start: stream.start, end: stream.pos,
              string: stream.current(),
              type: style || null,
              state: copy ? copyState(doc.mode, state) : state};
    }

    var doc = cm.doc, mode = doc.mode, style;
    pos = clipPos(doc, pos);
    var line = getLine(doc, pos.line), state = getStateBefore(cm, pos.line, precise);
    var stream = new StringStream(line.text, cm.options.tabSize), tokens;
    if (asArray) tokens = [];
    while ((asArray || stream.pos < pos.ch) && !stream.eol()) {
      stream.start = stream.pos;
      style = readToken(mode, stream, state);
      if (asArray) tokens.push(getObj(true));
    }
    return asArray ? tokens : getObj();
  }

  // Run the given mode's parser over a line, calling f for each token.
  function runMode(cm, text, mode, state, f, lineClasses, forceToEnd) {
    var flattenSpans = mode.flattenSpans;
    if (flattenSpans == null) flattenSpans = cm.options.flattenSpans;
    var curStart = 0, curStyle = null;
    var stream = new StringStream(text, cm.options.tabSize), style;
    var inner = cm.options.addModeClass && [null];
    if (text == "") extractLineClasses(callBlankLine(mode, state), lineClasses);
    while (!stream.eol()) {
      if (stream.pos > cm.options.maxHighlightLength) {
        flattenSpans = false;
        if (forceToEnd) processLine(cm, text, state, stream.pos);
        stream.pos = text.length;
        style = null;
      } else {
        style = extractLineClasses(readToken(mode, stream, state, inner), lineClasses);
      }
      if (inner) {
        var mName = inner[0].name;
        if (mName) style = "m-" + (style ? mName + " " + style : mName);
      }
      if (!flattenSpans || curStyle != style) {
        while (curStart < stream.start) {
          curStart = Math.min(stream.start, curStart + 50000);
          f(curStart, curStyle);
        }
        curStyle = style;
      }
      stream.start = stream.pos;
    }
    while (curStart < stream.pos) {
      // Webkit seems to refuse to render text nodes longer than 57444 characters
      var pos = Math.min(stream.pos, curStart + 50000);
      f(pos, curStyle);
      curStart = pos;
    }
  }

  // Compute a style array (an array starting with a mode generation
  // -- for invalidation -- followed by pairs of end positions and
  // style strings), which is used to highlight the tokens on the
  // line.
  function highlightLine(cm, line, state, forceToEnd) {
    // A styles array always starts with a number identifying the
    // mode/overlays that it is based on (for easy invalidation).
    var st = [cm.state.modeGen], lineClasses = {};
    // Compute the base array of styles
    runMode(cm, line.text, cm.doc.mode, state, function(end, style) {
      st.push(end, style);
    }, lineClasses, forceToEnd);

    // Run overlays, adjust style array.
    for (var o = 0; o < cm.state.overlays.length; ++o) {
      var overlay = cm.state.overlays[o], i = 1, at = 0;
      runMode(cm, line.text, overlay.mode, true, function(end, style) {
        var start = i;
        // Ensure there's a token end at the current position, and that i points at it
        while (at < end) {
          var i_end = st[i];
          if (i_end > end)
            st.splice(i, 1, end, st[i+1], i_end);
          i += 2;
          at = Math.min(end, i_end);
        }
        if (!style) return;
        if (overlay.opaque) {
          st.splice(start, i - start, end, "cm-overlay " + style);
          i = start + 2;
        } else {
          for (; start < i; start += 2) {
            var cur = st[start+1];
            st[start+1] = (cur ? cur + " " : "") + "cm-overlay " + style;
          }
        }
      }, lineClasses);
    }

    return {styles: st, classes: lineClasses.bgClass || lineClasses.textClass ? lineClasses : null};
  }

  function getLineStyles(cm, line, updateFrontier) {
    if (!line.styles || line.styles[0] != cm.state.modeGen) {
      var state = getStateBefore(cm, lineNo(line));
      var result = highlightLine(cm, line, line.text.length > cm.options.maxHighlightLength ? copyState(cm.doc.mode, state) : state);
      line.stateAfter = state;
      line.styles = result.styles;
      if (result.classes) line.styleClasses = result.classes;
      else if (line.styleClasses) line.styleClasses = null;
      if (updateFrontier === cm.doc.frontier) cm.doc.frontier++;
    }
    return line.styles;
  }

  // Lightweight form of highlight -- proceed over this line and
  // update state, but don't save a style array. Used for lines that
  // aren't currently visible.
  function processLine(cm, text, state, startAt) {
    var mode = cm.doc.mode;
    var stream = new StringStream(text, cm.options.tabSize);
    stream.start = stream.pos = startAt || 0;
    if (text == "") callBlankLine(mode, state);
    while (!stream.eol()) {
      readToken(mode, stream, state);
      stream.start = stream.pos;
    }
  }

  // Convert a style as returned by a mode (either null, or a string
  // containing one or more styles) to a CSS style. This is cached,
  // and also looks for line-wide styles.
  var styleToClassCache = {}, styleToClassCacheWithMode = {};
  function interpretTokenStyle(style, options) {
    if (!style || /^\s*$/.test(style)) return null;
    var cache = options.addModeClass ? styleToClassCacheWithMode : styleToClassCache;
    return cache[style] ||
      (cache[style] = style.replace(/\S+/g, "cm-$&"));
  }

  // Render the DOM representation of the text of a line. Also builds
  // up a 'line map', which points at the DOM nodes that represent
  // specific stretches of text, and is used by the measuring code.
  // The returned object contains the DOM node, this map, and
  // information about line-wide styles that were set by the mode.
  function buildLineContent(cm, lineView) {
    // The padding-right forces the element to have a 'border', which
    // is needed on Webkit to be able to get line-level bounding
    // rectangles for it (in measureChar).
    var content = elt("span", null, null, webkit ? "padding-right: .1px" : null);
    var builder = {pre: elt("pre", [content], "CodeMirror-line"), content: content,
                   col: 0, pos: 0, cm: cm,
                   splitSpaces: (ie || webkit) && cm.getOption("lineWrapping")};
    lineView.measure = {};

    // Iterate over the logical lines that make up this visual line.
    for (var i = 0; i <= (lineView.rest ? lineView.rest.length : 0); i++) {
      var line = i ? lineView.rest[i - 1] : lineView.line, order;
      builder.pos = 0;
      builder.addToken = buildToken;
      // Optionally wire in some hacks into the token-rendering
      // algorithm, to deal with browser quirks.
      if (hasBadBidiRects(cm.display.measure) && (order = getOrder(line)))
        builder.addToken = buildTokenBadBidi(builder.addToken, order);
      builder.map = [];
      var allowFrontierUpdate = lineView != cm.display.externalMeasured && lineNo(line);
      insertLineContent(line, builder, getLineStyles(cm, line, allowFrontierUpdate));
      if (line.styleClasses) {
        if (line.styleClasses.bgClass)
          builder.bgClass = joinClasses(line.styleClasses.bgClass, builder.bgClass || "");
        if (line.styleClasses.textClass)
          builder.textClass = joinClasses(line.styleClasses.textClass, builder.textClass || "");
      }

      // Ensure at least a single node is present, for measuring.
      if (builder.map.length == 0)
        builder.map.push(0, 0, builder.content.appendChild(zeroWidthElement(cm.display.measure)));

      // Store the map and a cache object for the current logical line
      if (i == 0) {
        lineView.measure.map = builder.map;
        lineView.measure.cache = {};
      } else {
        (lineView.measure.maps || (lineView.measure.maps = [])).push(builder.map);
        (lineView.measure.caches || (lineView.measure.caches = [])).push({});
      }
    }

    // See issue #2901
    if (webkit && /\bcm-tab\b/.test(builder.content.lastChild.className))
      builder.content.className = "cm-tab-wrap-hack";

    signal(cm, "renderLine", cm, lineView.line, builder.pre);
    if (builder.pre.className)
      builder.textClass = joinClasses(builder.pre.className, builder.textClass || "");

    return builder;
  }

  function defaultSpecialCharPlaceholder(ch) {
    var token = elt("span", "\u2022", "cm-invalidchar");
    token.title = "\\u" + ch.charCodeAt(0).toString(16);
    token.setAttribute("aria-label", token.title);
    return token;
  }

  // Build up the DOM representation for a single token, and add it to
  // the line map. Takes care to render special characters separately.
  function buildToken(builder, text, style, startStyle, endStyle, title, css) {
    if (!text) return;
    var displayText = builder.splitSpaces ? text.replace(/ {3,}/g, splitSpaces) : text;
    var special = builder.cm.state.specialChars, mustWrap = false;
    if (!special.test(text)) {
      builder.col += text.length;
      var content = document.createTextNode(displayText);
      builder.map.push(builder.pos, builder.pos + text.length, content);
      if (ie && ie_version < 9) mustWrap = true;
      builder.pos += text.length;
    } else {
      var content = document.createDocumentFragment(), pos = 0;
      while (true) {
        special.lastIndex = pos;
        var m = special.exec(text);
        var skipped = m ? m.index - pos : text.length - pos;
        if (skipped) {
          var txt = document.createTextNode(displayText.slice(pos, pos + skipped));
          if (ie && ie_version < 9) content.appendChild(elt("span", [txt]));
          else content.appendChild(txt);
          builder.map.push(builder.pos, builder.pos + skipped, txt);
          builder.col += skipped;
          builder.pos += skipped;
        }
        if (!m) break;
        pos += skipped + 1;
        if (m[0] == "\t") {
          var tabSize = builder.cm.options.tabSize, tabWidth = tabSize - builder.col % tabSize;
          var txt = content.appendChild(elt("span", spaceStr(tabWidth), "cm-tab"));
          txt.setAttribute("role", "presentation");
          txt.setAttribute("cm-text", "\t");
          builder.col += tabWidth;
        } else if (m[0] == "\r" || m[0] == "\n") {
          var txt = content.appendChild(elt("span", m[0] == "\r" ? "\u240d" : "\u2424", "cm-invalidchar"));
          txt.setAttribute("cm-text", m[0]);
          builder.col += 1;
        } else {
          var txt = builder.cm.options.specialCharPlaceholder(m[0]);
          txt.setAttribute("cm-text", m[0]);
          if (ie && ie_version < 9) content.appendChild(elt("span", [txt]));
          else content.appendChild(txt);
          builder.col += 1;
        }
        builder.map.push(builder.pos, builder.pos + 1, txt);
        builder.pos++;
      }
    }
    if (style || startStyle || endStyle || mustWrap || css) {
      var fullStyle = style || "";
      if (startStyle) fullStyle += startStyle;
      if (endStyle) fullStyle += endStyle;
      var token = elt("span", [content], fullStyle, css);
      if (title) token.title = title;
      return builder.content.appendChild(token);
    }
    builder.content.appendChild(content);
  }

  function splitSpaces(old) {
    var out = " ";
    for (var i = 0; i < old.length - 2; ++i) out += i % 2 ? " " : "\u00a0";
    out += " ";
    return out;
  }

  // Work around nonsense dimensions being reported for stretches of
  // right-to-left text.
  function buildTokenBadBidi(inner, order) {
    return function(builder, text, style, startStyle, endStyle, title, css) {
      style = style ? style + " cm-force-border" : "cm-force-border";
      var start = builder.pos, end = start + text.length;
      for (;;) {
        // Find the part that overlaps with the start of this text
        for (var i = 0; i < order.length; i++) {
          var part = order[i];
          if (part.to > start && part.from <= start) break;
        }
        if (part.to >= end) return inner(builder, text, style, startStyle, endStyle, title, css);
        inner(builder, text.slice(0, part.to - start), style, startStyle, null, title, css);
        startStyle = null;
        text = text.slice(part.to - start);
        start = part.to;
      }
    };
  }

  function buildCollapsedSpan(builder, size, marker, ignoreWidget) {
    var widget = !ignoreWidget && marker.widgetNode;
    if (widget) builder.map.push(builder.pos, builder.pos + size, widget);
    if (!ignoreWidget && builder.cm.display.input.needsContentAttribute) {
      if (!widget)
        widget = builder.content.appendChild(document.createElement("span"));
      widget.setAttribute("cm-marker", marker.id);
    }
    if (widget) {
      builder.cm.display.input.setUneditable(widget);
      builder.content.appendChild(widget);
    }
    builder.pos += size;
  }

  // Outputs a number of spans to make up a line, taking highlighting
  // and marked text into account.
  function insertLineContent(line, builder, styles) {
    var spans = line.markedSpans, allText = line.text, at = 0;
    if (!spans) {
      for (var i = 1; i < styles.length; i+=2)
        builder.addToken(builder, allText.slice(at, at = styles[i]), interpretTokenStyle(styles[i+1], builder.cm.options));
      return;
    }

    var len = allText.length, pos = 0, i = 1, text = "", style, css;
    var nextChange = 0, spanStyle, spanEndStyle, spanStartStyle, title, collapsed;
    for (;;) {
      if (nextChange == pos) { // Update current marker set
        spanStyle = spanEndStyle = spanStartStyle = title = css = "";
        collapsed = null; nextChange = Infinity;
        var foundBookmarks = [];
        for (var j = 0; j < spans.length; ++j) {
          var sp = spans[j], m = sp.marker;
          if (m.type == "bookmark" && sp.from == pos && m.widgetNode) {
            foundBookmarks.push(m);
          } else if (sp.from <= pos && (sp.to == null || sp.to > pos || m.collapsed && sp.to == pos && sp.from == pos)) {
            if (sp.to != null && sp.to != pos && nextChange > sp.to) {
              nextChange = sp.to;
              spanEndStyle = "";
            }
            if (m.className) spanStyle += " " + m.className;
            if (m.css) css = m.css;
            if (m.startStyle && sp.from == pos) spanStartStyle += " " + m.startStyle;
            if (m.endStyle && sp.to == nextChange) spanEndStyle += " " + m.endStyle;
            if (m.title && !title) title = m.title;
            if (m.collapsed && (!collapsed || compareCollapsedMarkers(collapsed.marker, m) < 0))
              collapsed = sp;
          } else if (sp.from > pos && nextChange > sp.from) {
            nextChange = sp.from;
          }
        }
        if (collapsed && (collapsed.from || 0) == pos) {
          buildCollapsedSpan(builder, (collapsed.to == null ? len + 1 : collapsed.to) - pos,
                             collapsed.marker, collapsed.from == null);
          if (collapsed.to == null) return;
          if (collapsed.to == pos) collapsed = false;
        }
        if (!collapsed && foundBookmarks.length) for (var j = 0; j < foundBookmarks.length; ++j)
          buildCollapsedSpan(builder, 0, foundBookmarks[j]);
      }
      if (pos >= len) break;

      var upto = Math.min(len, nextChange);
      while (true) {
        if (text) {
          var end = pos + text.length;
          if (!collapsed) {
            var tokenText = end > upto ? text.slice(0, upto - pos) : text;
            builder.addToken(builder, tokenText, style ? style + spanStyle : spanStyle,
                             spanStartStyle, pos + tokenText.length == nextChange ? spanEndStyle : "", title, css);
          }
          if (end >= upto) {text = text.slice(upto - pos); pos = upto; break;}
          pos = end;
          spanStartStyle = "";
        }
        text = allText.slice(at, at = styles[i++]);
        style = interpretTokenStyle(styles[i++], builder.cm.options);
      }
    }
  }

  // DOCUMENT DATA STRUCTURE

  // By default, updates that start and end at the beginning of a line
  // are treated specially, in order to make the association of line
  // widgets and marker elements with the text behave more intuitive.
  function isWholeLineUpdate(doc, change) {
    return change.from.ch == 0 && change.to.ch == 0 && lst(change.text) == "" &&
      (!doc.cm || doc.cm.options.wholeLineUpdateBefore);
  }

  // Perform a change on the document data structure.
  function updateDoc(doc, change, markedSpans, estimateHeight) {
    function spansFor(n) {return markedSpans ? markedSpans[n] : null;}
    function update(line, text, spans) {
      updateLine(line, text, spans, estimateHeight);
      signalLater(line, "change", line, change);
    }
    function linesFor(start, end) {
      for (var i = start, result = []; i < end; ++i)
        result.push(new Line(text[i], spansFor(i), estimateHeight));
      return result;
    }

    var from = change.from, to = change.to, text = change.text;
    var firstLine = getLine(doc, from.line), lastLine = getLine(doc, to.line);
    var lastText = lst(text), lastSpans = spansFor(text.length - 1), nlines = to.line - from.line;

    // Adjust the line structure
    if (change.full) {
      doc.insert(0, linesFor(0, text.length));
      doc.remove(text.length, doc.size - text.length);
    } else if (isWholeLineUpdate(doc, change)) {
      // This is a whole-line replace. Treated specially to make
      // sure line objects move the way they are supposed to.
      var added = linesFor(0, text.length - 1);
      update(lastLine, lastLine.text, lastSpans);
      if (nlines) doc.remove(from.line, nlines);
      if (added.length) doc.insert(from.line, added);
    } else if (firstLine == lastLine) {
      if (text.length == 1) {
        update(firstLine, firstLine.text.slice(0, from.ch) + lastText + firstLine.text.slice(to.ch), lastSpans);
      } else {
        var added = linesFor(1, text.length - 1);
        added.push(new Line(lastText + firstLine.text.slice(to.ch), lastSpans, estimateHeight));
        update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));
        doc.insert(from.line + 1, added);
      }
    } else if (text.length == 1) {
      update(firstLine, firstLine.text.slice(0, from.ch) + text[0] + lastLine.text.slice(to.ch), spansFor(0));
      doc.remove(from.line + 1, nlines);
    } else {
      update(firstLine, firstLine.text.slice(0, from.ch) + text[0], spansFor(0));
      update(lastLine, lastText + lastLine.text.slice(to.ch), lastSpans);
      var added = linesFor(1, text.length - 1);
      if (nlines > 1) doc.remove(from.line + 1, nlines - 1);
      doc.insert(from.line + 1, added);
    }

    signalLater(doc, "change", doc, change);
  }

  // The document is represented as a BTree consisting of leaves, with
  // chunk of lines in them, and branches, with up to ten leaves or
  // other branch nodes below them. The top node is always a branch
  // node, and is the document object itself (meaning it has
  // additional methods and properties).
  //
  // All nodes have parent links. The tree is used both to go from
  // line numbers to line objects, and to go from objects to numbers.
  // It also indexes by height, and is used to convert between height
  // and line object, and to find the total height of the document.
  //
  // See also http://marijnhaverbeke.nl/blog/codemirror-line-tree.html

  function LeafChunk(lines) {
    this.lines = lines;
    this.parent = null;
    for (var i = 0, height = 0; i < lines.length; ++i) {
      lines[i].parent = this;
      height += lines[i].height;
    }
    this.height = height;
  }

  LeafChunk.prototype = {
    chunkSize: function() { return this.lines.length; },
    // Remove the n lines at offset 'at'.
    removeInner: function(at, n) {
      for (var i = at, e = at + n; i < e; ++i) {
        var line = this.lines[i];
        this.height -= line.height;
        cleanUpLine(line);
        signalLater(line, "delete");
      }
      this.lines.splice(at, n);
    },
    // Helper used to collapse a small branch into a single leaf.
    collapse: function(lines) {
      lines.push.apply(lines, this.lines);
    },
    // Insert the given array of lines at offset 'at', count them as
    // having the given height.
    insertInner: function(at, lines, height) {
      this.height += height;
      this.lines = this.lines.slice(0, at).concat(lines).concat(this.lines.slice(at));
      for (var i = 0; i < lines.length; ++i) lines[i].parent = this;
    },
    // Used to iterate over a part of the tree.
    iterN: function(at, n, op) {
      for (var e = at + n; at < e; ++at)
        if (op(this.lines[at])) return true;
    }
  };

  function BranchChunk(children) {
    this.children = children;
    var size = 0, height = 0;
    for (var i = 0; i < children.length; ++i) {
      var ch = children[i];
      size += ch.chunkSize(); height += ch.height;
      ch.parent = this;
    }
    this.size = size;
    this.height = height;
    this.parent = null;
  }

  BranchChunk.prototype = {
    chunkSize: function() { return this.size; },
    removeInner: function(at, n) {
      this.size -= n;
      for (var i = 0; i < this.children.length; ++i) {
        var child = this.children[i], sz = child.chunkSize();
        if (at < sz) {
          var rm = Math.min(n, sz - at), oldHeight = child.height;
          child.removeInner(at, rm);
          this.height -= oldHeight - child.height;
          if (sz == rm) { this.children.splice(i--, 1); child.parent = null; }
          if ((n -= rm) == 0) break;
          at = 0;
        } else at -= sz;
      }
      // If the result is smaller than 25 lines, ensure that it is a
      // single leaf node.
      if (this.size - n < 25 &&
          (this.children.length > 1 || !(this.children[0] instanceof LeafChunk))) {
        var lines = [];
        this.collapse(lines);
        this.children = [new LeafChunk(lines)];
        this.children[0].parent = this;
      }
    },
    collapse: function(lines) {
      for (var i = 0; i < this.children.length; ++i) this.children[i].collapse(lines);
    },
    insertInner: function(at, lines, height) {
      this.size += lines.length;
      this.height += height;
      for (var i = 0; i < this.children.length; ++i) {
        var child = this.children[i], sz = child.chunkSize();
        if (at <= sz) {
          child.insertInner(at, lines, height);
          if (child.lines && child.lines.length > 50) {
            while (child.lines.length > 50) {
              var spilled = child.lines.splice(child.lines.length - 25, 25);
              var newleaf = new LeafChunk(spilled);
              child.height -= newleaf.height;
              this.children.splice(i + 1, 0, newleaf);
              newleaf.parent = this;
            }
            this.maybeSpill();
          }
          break;
        }
        at -= sz;
      }
    },
    // When a node has grown, check whether it should be split.
    maybeSpill: function() {
      if (this.children.length <= 10) return;
      var me = this;
      do {
        var spilled = me.children.splice(me.children.length - 5, 5);
        var sibling = new BranchChunk(spilled);
        if (!me.parent) { // Become the parent node
          var copy = new BranchChunk(me.children);
          copy.parent = me;
          me.children = [copy, sibling];
          me = copy;
        } else {
          me.size -= sibling.size;
          me.height -= sibling.height;
          var myIndex = indexOf(me.parent.children, me);
          me.parent.children.splice(myIndex + 1, 0, sibling);
        }
        sibling.parent = me.parent;
      } while (me.children.length > 10);
      me.parent.maybeSpill();
    },
    iterN: function(at, n, op) {
      for (var i = 0; i < this.children.length; ++i) {
        var child = this.children[i], sz = child.chunkSize();
        if (at < sz) {
          var used = Math.min(n, sz - at);
          if (child.iterN(at, used, op)) return true;
          if ((n -= used) == 0) break;
          at = 0;
        } else at -= sz;
      }
    }
  };

  var nextDocId = 0;
  var Doc = CodeMirror.Doc = function(text, mode, firstLine, lineSep) {
    if (!(this instanceof Doc)) return new Doc(text, mode, firstLine, lineSep);
    if (firstLine == null) firstLine = 0;

    BranchChunk.call(this, [new LeafChunk([new Line("", null)])]);
    this.first = firstLine;
    this.scrollTop = this.scrollLeft = 0;
    this.cantEdit = false;
    this.cleanGeneration = 1;
    this.frontier = firstLine;
    var start = Pos(firstLine, 0);
    this.sel = simpleSelection(start);
    this.history = new History(null);
    this.id = ++nextDocId;
    this.modeOption = mode;
    this.lineSep = lineSep;

    if (typeof text == "string") text = this.splitLines(text);
    updateDoc(this, {from: start, to: start, text: text});
    setSelection(this, simpleSelection(start), sel_dontScroll);
  };

  Doc.prototype = createObj(BranchChunk.prototype, {
    constructor: Doc,
    // Iterate over the document. Supports two forms -- with only one
    // argument, it calls that for each line in the document. With
    // three, it iterates over the range given by the first two (with
    // the second being non-inclusive).
    iter: function(from, to, op) {
      if (op) this.iterN(from - this.first, to - from, op);
      else this.iterN(this.first, this.first + this.size, from);
    },

    // Non-public interface for adding and removing lines.
    insert: function(at, lines) {
      var height = 0;
      for (var i = 0; i < lines.length; ++i) height += lines[i].height;
      this.insertInner(at - this.first, lines, height);
    },
    remove: function(at, n) { this.removeInner(at - this.first, n); },

    // From here, the methods are part of the public interface. Most
    // are also available from CodeMirror (editor) instances.

    getValue: function(lineSep) {
      var lines = getLines(this, this.first, this.first + this.size);
      if (lineSep === false) return lines;
      return lines.join(lineSep || this.lineSeparator());
    },
    setValue: docMethodOp(function(code) {
      var top = Pos(this.first, 0), last = this.first + this.size - 1;
      makeChange(this, {from: top, to: Pos(last, getLine(this, last).text.length),
                        text: this.splitLines(code), origin: "setValue", full: true}, true);
      setSelection(this, simpleSelection(top));
    }),
    replaceRange: function(code, from, to, origin) {
      from = clipPos(this, from);
      to = to ? clipPos(this, to) : from;
      replaceRange(this, code, from, to, origin);
    },
    getRange: function(from, to, lineSep) {
      var lines = getBetween(this, clipPos(this, from), clipPos(this, to));
      if (lineSep === false) return lines;
      return lines.join(lineSep || this.lineSeparator());
    },

    getLine: function(line) {var l = this.getLineHandle(line); return l && l.text;},

    getLineHandle: function(line) {if (isLine(this, line)) return getLine(this, line);},
    getLineNumber: function(line) {return lineNo(line);},

    getLineHandleVisualStart: function(line) {
      if (typeof line == "number") line = getLine(this, line);
      return visualLine(line);
    },

    lineCount: function() {return this.size;},
    firstLine: function() {return this.first;},
    lastLine: function() {return this.first + this.size - 1;},

    clipPos: function(pos) {return clipPos(this, pos);},

    getCursor: function(start) {
      var range = this.sel.primary(), pos;
      if (start == null || start == "head") pos = range.head;
      else if (start == "anchor") pos = range.anchor;
      else if (start == "end" || start == "to" || start === false) pos = range.to();
      else pos = range.from();
      return pos;
    },
    listSelections: function() { return this.sel.ranges; },
    somethingSelected: function() {return this.sel.somethingSelected();},

    setCursor: docMethodOp(function(line, ch, options) {
      setSimpleSelection(this, clipPos(this, typeof line == "number" ? Pos(line, ch || 0) : line), null, options);
    }),
    setSelection: docMethodOp(function(anchor, head, options) {
      setSimpleSelection(this, clipPos(this, anchor), clipPos(this, head || anchor), options);
    }),
    extendSelection: docMethodOp(function(head, other, options) {
      extendSelection(this, clipPos(this, head), other && clipPos(this, other), options);
    }),
    extendSelections: docMethodOp(function(heads, options) {
      extendSelections(this, clipPosArray(this, heads, options));
    }),
    extendSelectionsBy: docMethodOp(function(f, options) {
      extendSelections(this, map(this.sel.ranges, f), options);
    }),
    setSelections: docMethodOp(function(ranges, primary, options) {
      if (!ranges.length) return;
      for (var i = 0, out = []; i < ranges.length; i++)
        out[i] = new Range(clipPos(this, ranges[i].anchor),
                           clipPos(this, ranges[i].head));
      if (primary == null) primary = Math.min(ranges.length - 1, this.sel.primIndex);
      setSelection(this, normalizeSelection(out, primary), options);
    }),
    addSelection: docMethodOp(function(anchor, head, options) {
      var ranges = this.sel.ranges.slice(0);
      ranges.push(new Range(clipPos(this, anchor), clipPos(this, head || anchor)));
      setSelection(this, normalizeSelection(ranges, ranges.length - 1), options);
    }),

    getSelection: function(lineSep) {
      var ranges = this.sel.ranges, lines;
      for (var i = 0; i < ranges.length; i++) {
        var sel = getBetween(this, ranges[i].from(), ranges[i].to());
        lines = lines ? lines.concat(sel) : sel;
      }
      if (lineSep === false) return lines;
      else return lines.join(lineSep || this.lineSeparator());
    },
    getSelections: function(lineSep) {
      var parts = [], ranges = this.sel.ranges;
      for (var i = 0; i < ranges.length; i++) {
        var sel = getBetween(this, ranges[i].from(), ranges[i].to());
        if (lineSep !== false) sel = sel.join(lineSep || this.lineSeparator());
        parts[i] = sel;
      }
      return parts;
    },
    replaceSelection: function(code, collapse, origin) {
      var dup = [];
      for (var i = 0; i < this.sel.ranges.length; i++)
        dup[i] = code;
      this.replaceSelections(dup, collapse, origin || "+input");
    },
    replaceSelections: docMethodOp(function(code, collapse, origin) {
      var changes = [], sel = this.sel;
      for (var i = 0; i < sel.ranges.length; i++) {
        var range = sel.ranges[i];
        changes[i] = {from: range.from(), to: range.to(), text: this.splitLines(code[i]), origin: origin};
      }
      var newSel = collapse && collapse != "end" && computeReplacedSel(this, changes, collapse);
      for (var i = changes.length - 1; i >= 0; i--)
        makeChange(this, changes[i]);
      if (newSel) setSelectionReplaceHistory(this, newSel);
      else if (this.cm) ensureCursorVisible(this.cm);
    }),
    undo: docMethodOp(function() {makeChangeFromHistory(this, "undo");}),
    redo: docMethodOp(function() {makeChangeFromHistory(this, "redo");}),
    undoSelection: docMethodOp(function() {makeChangeFromHistory(this, "undo", true);}),
    redoSelection: docMethodOp(function() {makeChangeFromHistory(this, "redo", true);}),

    setExtending: function(val) {this.extend = val;},
    getExtending: function() {return this.extend;},

    historySize: function() {
      var hist = this.history, done = 0, undone = 0;
      for (var i = 0; i < hist.done.length; i++) if (!hist.done[i].ranges) ++done;
      for (var i = 0; i < hist.undone.length; i++) if (!hist.undone[i].ranges) ++undone;
      return {undo: done, redo: undone};
    },
    clearHistory: function() {this.history = new History(this.history.maxGeneration);},

    markClean: function() {
      this.cleanGeneration = this.changeGeneration(true);
    },
    changeGeneration: function(forceSplit) {
      if (forceSplit)
        this.history.lastOp = this.history.lastSelOp = this.history.lastOrigin = null;
      return this.history.generation;
    },
    isClean: function (gen) {
      return this.history.generation == (gen || this.cleanGeneration);
    },

    getHistory: function() {
      return {done: copyHistoryArray(this.history.done),
              undone: copyHistoryArray(this.history.undone)};
    },
    setHistory: function(histData) {
      var hist = this.history = new History(this.history.maxGeneration);
      hist.done = copyHistoryArray(histData.done.slice(0), null, true);
      hist.undone = copyHistoryArray(histData.undone.slice(0), null, true);
    },

    addLineClass: docMethodOp(function(handle, where, cls) {
      return changeLine(this, handle, where == "gutter" ? "gutter" : "class", function(line) {
        var prop = where == "text" ? "textClass"
                 : where == "background" ? "bgClass"
                 : where == "gutter" ? "gutterClass" : "wrapClass";
        if (!line[prop]) line[prop] = cls;
        else if (classTest(cls).test(line[prop])) return false;
        else line[prop] += " " + cls;
        return true;
      });
    }),
    removeLineClass: docMethodOp(function(handle, where, cls) {
      return changeLine(this, handle, where == "gutter" ? "gutter" : "class", function(line) {
        var prop = where == "text" ? "textClass"
                 : where == "background" ? "bgClass"
                 : where == "gutter" ? "gutterClass" : "wrapClass";
        var cur = line[prop];
        if (!cur) return false;
        else if (cls == null) line[prop] = null;
        else {
          var found = cur.match(classTest(cls));
          if (!found) return false;
          var end = found.index + found[0].length;
          line[prop] = cur.slice(0, found.index) + (!found.index || end == cur.length ? "" : " ") + cur.slice(end) || null;
        }
        return true;
      });
    }),

    addLineWidget: docMethodOp(function(handle, node, options) {
      return addLineWidget(this, handle, node, options);
    }),
    removeLineWidget: function(widget) { widget.clear(); },

    markText: function(from, to, options) {
      return markText(this, clipPos(this, from), clipPos(this, to), options, options && options.type || "range");
    },
    setBookmark: function(pos, options) {
      var realOpts = {replacedWith: options && (options.nodeType == null ? options.widget : options),
                      insertLeft: options && options.insertLeft,
                      clearWhenEmpty: false, shared: options && options.shared,
                      handleMouseEvents: options && options.handleMouseEvents};
      pos = clipPos(this, pos);
      return markText(this, pos, pos, realOpts, "bookmark");
    },
    findMarksAt: function(pos) {
      pos = clipPos(this, pos);
      var markers = [], spans = getLine(this, pos.line).markedSpans;
      if (spans) for (var i = 0; i < spans.length; ++i) {
        var span = spans[i];
        if ((span.from == null || span.from <= pos.ch) &&
            (span.to == null || span.to >= pos.ch))
          markers.push(span.marker.parent || span.marker);
      }
      return markers;
    },
    findMarks: function(from, to, filter) {
      from = clipPos(this, from); to = clipPos(this, to);
      var found = [], lineNo = from.line;
      this.iter(from.line, to.line + 1, function(line) {
        var spans = line.markedSpans;
        if (spans) for (var i = 0; i < spans.length; i++) {
          var span = spans[i];
          if (!(lineNo == from.line && from.ch > span.to ||
                span.from == null && lineNo != from.line||
                lineNo == to.line && span.from > to.ch) &&
              (!filter || filter(span.marker)))
            found.push(span.marker.parent || span.marker);
        }
        ++lineNo;
      });
      return found;
    },
    getAllMarks: function() {
      var markers = [];
      this.iter(function(line) {
        var sps = line.markedSpans;
        if (sps) for (var i = 0; i < sps.length; ++i)
          if (sps[i].from != null) markers.push(sps[i].marker);
      });
      return markers;
    },

    posFromIndex: function(off) {
      var ch, lineNo = this.first;
      this.iter(function(line) {
        var sz = line.text.length + 1;
        if (sz > off) { ch = off; return true; }
        off -= sz;
        ++lineNo;
      });
      return clipPos(this, Pos(lineNo, ch));
    },
    indexFromPos: function (coords) {
      coords = clipPos(this, coords);
      var index = coords.ch;
      if (coords.line < this.first || coords.ch < 0) return 0;
      this.iter(this.first, coords.line, function (line) {
        index += line.text.length + 1;
      });
      return index;
    },

    copy: function(copyHistory) {
      var doc = new Doc(getLines(this, this.first, this.first + this.size),
                        this.modeOption, this.first, this.lineSep);
      doc.scrollTop = this.scrollTop; doc.scrollLeft = this.scrollLeft;
      doc.sel = this.sel;
      doc.extend = false;
      if (copyHistory) {
        doc.history.undoDepth = this.history.undoDepth;
        doc.setHistory(this.getHistory());
      }
      return doc;
    },

    linkedDoc: function(options) {
      if (!options) options = {};
      var from = this.first, to = this.first + this.size;
      if (options.from != null && options.from > from) from = options.from;
      if (options.to != null && options.to < to) to = options.to;
      var copy = new Doc(getLines(this, from, to), options.mode || this.modeOption, from, this.lineSep);
      if (options.sharedHist) copy.history = this.history;
      (this.linked || (this.linked = [])).push({doc: copy, sharedHist: options.sharedHist});
      copy.linked = [{doc: this, isParent: true, sharedHist: options.sharedHist}];
      copySharedMarkers(copy, findSharedMarkers(this));
      return copy;
    },
    unlinkDoc: function(other) {
      if (other instanceof CodeMirror) other = other.doc;
      if (this.linked) for (var i = 0; i < this.linked.length; ++i) {
        var link = this.linked[i];
        if (link.doc != other) continue;
        this.linked.splice(i, 1);
        other.unlinkDoc(this);
        detachSharedMarkers(findSharedMarkers(this));
        break;
      }
      // If the histories were shared, split them again
      if (other.history == this.history) {
        var splitIds = [other.id];
        linkedDocs(other, function(doc) {splitIds.push(doc.id);}, true);
        other.history = new History(null);
        other.history.done = copyHistoryArray(this.history.done, splitIds);
        other.history.undone = copyHistoryArray(this.history.undone, splitIds);
      }
    },
    iterLinkedDocs: function(f) {linkedDocs(this, f);},

    getMode: function() {return this.mode;},
    getEditor: function() {return this.cm;},

    splitLines: function(str) {
      if (this.lineSep) return str.split(this.lineSep);
      return splitLinesAuto(str);
    },
    lineSeparator: function() { return this.lineSep || "\n"; }
  });

  // Public alias.
  Doc.prototype.eachLine = Doc.prototype.iter;

  // Set up methods on CodeMirror's prototype to redirect to the editor's document.
  var dontDelegate = "iter insert remove copy getEditor constructor".split(" ");
  for (var prop in Doc.prototype) if (Doc.prototype.hasOwnProperty(prop) && indexOf(dontDelegate, prop) < 0)
    CodeMirror.prototype[prop] = (function(method) {
      return function() {return method.apply(this.doc, arguments);};
    })(Doc.prototype[prop]);

  eventMixin(Doc);

  // Call f for all linked documents.
  function linkedDocs(doc, f, sharedHistOnly) {
    function propagate(doc, skip, sharedHist) {
      if (doc.linked) for (var i = 0; i < doc.linked.length; ++i) {
        var rel = doc.linked[i];
        if (rel.doc == skip) continue;
        var shared = sharedHist && rel.sharedHist;
        if (sharedHistOnly && !shared) continue;
        f(rel.doc, shared);
        propagate(rel.doc, doc, shared);
      }
    }
    propagate(doc, null, true);
  }

  // Attach a document to an editor.
  function attachDoc(cm, doc) {
    if (doc.cm) throw new Error("This document is already in use.");
    cm.doc = doc;
    doc.cm = cm;
    estimateLineHeights(cm);
    loadMode(cm);
    if (!cm.options.lineWrapping) findMaxLine(cm);
    cm.options.mode = doc.modeOption;
    regChange(cm);
  }

  // LINE UTILITIES

  // Find the line object corresponding to the given line number.
  function getLine(doc, n) {
    n -= doc.first;
    if (n < 0 || n >= doc.size) throw new Error("There is no line " + (n + doc.first) + " in the document.");
    for (var chunk = doc; !chunk.lines;) {
      for (var i = 0;; ++i) {
        var child = chunk.children[i], sz = child.chunkSize();
        if (n < sz) { chunk = child; break; }
        n -= sz;
      }
    }
    return chunk.lines[n];
  }

  // Get the part of a document between two positions, as an array of
  // strings.
  function getBetween(doc, start, end) {
    var out = [], n = start.line;
    doc.iter(start.line, end.line + 1, function(line) {
      var text = line.text;
      if (n == end.line) text = text.slice(0, end.ch);
      if (n == start.line) text = text.slice(start.ch);
      out.push(text);
      ++n;
    });
    return out;
  }
  // Get the lines between from and to, as array of strings.
  function getLines(doc, from, to) {
    var out = [];
    doc.iter(from, to, function(line) { out.push(line.text); });
    return out;
  }

  // Update the height of a line, propagating the height change
  // upwards to parent nodes.
  function updateLineHeight(line, height) {
    var diff = height - line.height;
    if (diff) for (var n = line; n; n = n.parent) n.height += diff;
  }

  // Given a line object, find its line number by walking up through
  // its parent links.
  function lineNo(line) {
    if (line.parent == null) return null;
    var cur = line.parent, no = indexOf(cur.lines, line);
    for (var chunk = cur.parent; chunk; cur = chunk, chunk = chunk.parent) {
      for (var i = 0;; ++i) {
        if (chunk.children[i] == cur) break;
        no += chunk.children[i].chunkSize();
      }
    }
    return no + cur.first;
  }

  // Find the line at the given vertical position, using the height
  // information in the document tree.
  function lineAtHeight(chunk, h) {
    var n = chunk.first;
    outer: do {
      for (var i = 0; i < chunk.children.length; ++i) {
        var child = chunk.children[i], ch = child.height;
        if (h < ch) { chunk = child; continue outer; }
        h -= ch;
        n += child.chunkSize();
      }
      return n;
    } while (!chunk.lines);
    for (var i = 0; i < chunk.lines.length; ++i) {
      var line = chunk.lines[i], lh = line.height;
      if (h < lh) break;
      h -= lh;
    }
    return n + i;
  }


  // Find the height above the given line.
  function heightAtLine(lineObj) {
    lineObj = visualLine(lineObj);

    var h = 0, chunk = lineObj.parent;
    for (var i = 0; i < chunk.lines.length; ++i) {
      var line = chunk.lines[i];
      if (line == lineObj) break;
      else h += line.height;
    }
    for (var p = chunk.parent; p; chunk = p, p = chunk.parent) {
      for (var i = 0; i < p.children.length; ++i) {
        var cur = p.children[i];
        if (cur == chunk) break;
        else h += cur.height;
      }
    }
    return h;
  }

  // Get the bidi ordering for the given line (and cache it). Returns
  // false for lines that are fully left-to-right, and an array of
  // BidiSpan objects otherwise.
  function getOrder(line) {
    var order = line.order;
    if (order == null) order = line.order = bidiOrdering(line.text);
    return order;
  }

  // HISTORY

  function History(startGen) {
    // Arrays of change events and selections. Doing something adds an
    // event to done and clears undo. Undoing moves events from done
    // to undone, redoing moves them in the other direction.
    this.done = []; this.undone = [];
    this.undoDepth = Infinity;
    // Used to track when changes can be merged into a single undo
    // event
    this.lastModTime = this.lastSelTime = 0;
    this.lastOp = this.lastSelOp = null;
    this.lastOrigin = this.lastSelOrigin = null;
    // Used by the isClean() method
    this.generation = this.maxGeneration = startGen || 1;
  }

  // Create a history change event from an updateDoc-style change
  // object.
  function historyChangeFromChange(doc, change) {
    var histChange = {from: copyPos(change.from), to: changeEnd(change), text: getBetween(doc, change.from, change.to)};
    attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1);
    linkedDocs(doc, function(doc) {attachLocalSpans(doc, histChange, change.from.line, change.to.line + 1);}, true);
    return histChange;
  }

  // Pop all selection events off the end of a history array. Stop at
  // a change event.
  function clearSelectionEvents(array) {
    while (array.length) {
      var last = lst(array);
      if (last.ranges) array.pop();
      else break;
    }
  }

  // Find the top change event in the history. Pop off selection
  // events that are in the way.
  function lastChangeEvent(hist, force) {
    if (force) {
      clearSelectionEvents(hist.done);
      return lst(hist.done);
    } else if (hist.done.length && !lst(hist.done).ranges) {
      return lst(hist.done);
    } else if (hist.done.length > 1 && !hist.done[hist.done.length - 2].ranges) {
      hist.done.pop();
      return lst(hist.done);
    }
  }

  // Register a change in the history. Merges changes that are within
  // a single operation, ore are close together with an origin that
  // allows merging (starting with "+") into a single event.
  function addChangeToHistory(doc, change, selAfter, opId) {
    var hist = doc.history;
    hist.undone.length = 0;
    var time = +new Date, cur;

    if ((hist.lastOp == opId ||
         hist.lastOrigin == change.origin && change.origin &&
         ((change.origin.charAt(0) == "+" && doc.cm && hist.lastModTime > time - doc.cm.options.historyEventDelay) ||
          change.origin.charAt(0) == "*")) &&
        (cur = lastChangeEvent(hist, hist.lastOp == opId))) {
      // Merge this change into the last event
      var last = lst(cur.changes);
      if (cmp(change.from, change.to) == 0 && cmp(change.from, last.to) == 0) {
        // Optimized case for simple insertion -- don't want to add
        // new changesets for every character typed
        last.to = changeEnd(change);
      } else {
        // Add new sub-event
        cur.changes.push(historyChangeFromChange(doc, change));
      }
    } else {
      // Can not be merged, start a new event.
      var before = lst(hist.done);
      if (!before || !before.ranges)
        pushSelectionToHistory(doc.sel, hist.done);
      cur = {changes: [historyChangeFromChange(doc, change)],
             generation: hist.generation};
      hist.done.push(cur);
      while (hist.done.length > hist.undoDepth) {
        hist.done.shift();
        if (!hist.done[0].ranges) hist.done.shift();
      }
    }
    hist.done.push(selAfter);
    hist.generation = ++hist.maxGeneration;
    hist.lastModTime = hist.lastSelTime = time;
    hist.lastOp = hist.lastSelOp = opId;
    hist.lastOrigin = hist.lastSelOrigin = change.origin;

    if (!last) signal(doc, "historyAdded");
  }

  function selectionEventCanBeMerged(doc, origin, prev, sel) {
    var ch = origin.charAt(0);
    return ch == "*" ||
      ch == "+" &&
      prev.ranges.length == sel.ranges.length &&
      prev.somethingSelected() == sel.somethingSelected() &&
      new Date - doc.history.lastSelTime <= (doc.cm ? doc.cm.options.historyEventDelay : 500);
  }

  // Called whenever the selection changes, sets the new selection as
  // the pending selection in the history, and pushes the old pending
  // selection into the 'done' array when it was significantly
  // different (in number of selected ranges, emptiness, or time).
  function addSelectionToHistory(doc, sel, opId, options) {
    var hist = doc.history, origin = options && options.origin;

    // A new event is started when the previous origin does not match
    // the current, or the origins don't allow matching. Origins
    // starting with * are always merged, those starting with + are
    // merged when similar and close together in time.
    if (opId == hist.lastSelOp ||
        (origin && hist.lastSelOrigin == origin &&
         (hist.lastModTime == hist.lastSelTime && hist.lastOrigin == origin ||
          selectionEventCanBeMerged(doc, origin, lst(hist.done), sel))))
      hist.done[hist.done.length - 1] = sel;
    else
      pushSelectionToHistory(sel, hist.done);

    hist.lastSelTime = +new Date;
    hist.lastSelOrigin = origin;
    hist.lastSelOp = opId;
    if (options && options.clearRedo !== false)
      clearSelectionEvents(hist.undone);
  }

  function pushSelectionToHistory(sel, dest) {
    var top = lst(dest);
    if (!(top && top.ranges && top.equals(sel)))
      dest.push(sel);
  }

  // Used to store marked span information in the history.
  function attachLocalSpans(doc, change, from, to) {
    var existing = change["spans_" + doc.id], n = 0;
    doc.iter(Math.max(doc.first, from), Math.min(doc.first + doc.size, to), function(line) {
      if (line.markedSpans)
        (existing || (existing = change["spans_" + doc.id] = {}))[n] = line.markedSpans;
      ++n;
    });
  }

  // When un/re-doing restores text containing marked spans, those
  // that have been explicitly cleared should not be restored.
  function removeClearedSpans(spans) {
    if (!spans) return null;
    for (var i = 0, out; i < spans.length; ++i) {
      if (spans[i].marker.explicitlyCleared) { if (!out) out = spans.slice(0, i); }
      else if (out) out.push(spans[i]);
    }
    return !out ? spans : out.length ? out : null;
  }

  // Retrieve and filter the old marked spans stored in a change event.
  function getOldSpans(doc, change) {
    var found = change["spans_" + doc.id];
    if (!found) return null;
    for (var i = 0, nw = []; i < change.text.length; ++i)
      nw.push(removeClearedSpans(found[i]));
    return nw;
  }

  // Used both to provide a JSON-safe object in .getHistory, and, when
  // detaching a document, to split the history in two
  function copyHistoryArray(events, newGroup, instantiateSel) {
    for (var i = 0, copy = []; i < events.length; ++i) {
      var event = events[i];
      if (event.ranges) {
        copy.push(instantiateSel ? Selection.prototype.deepCopy.call(event) : event);
        continue;
      }
      var changes = event.changes, newChanges = [];
      copy.push({changes: newChanges});
      for (var j = 0; j < changes.length; ++j) {
        var change = changes[j], m;
        newChanges.push({from: change.from, to: change.to, text: change.text});
        if (newGroup) for (var prop in change) if (m = prop.match(/^spans_(\d+)$/)) {
          if (indexOf(newGroup, Number(m[1])) > -1) {
            lst(newChanges)[prop] = change[prop];
            delete change[prop];
          }
        }
      }
    }
    return copy;
  }

  // Rebasing/resetting history to deal with externally-sourced changes

  function rebaseHistSelSingle(pos, from, to, diff) {
    if (to < pos.line) {
      pos.line += diff;
    } else if (from < pos.line) {
      pos.line = from;
      pos.ch = 0;
    }
  }

  // Tries to rebase an array of history events given a change in the
  // document. If the change touches the same lines as the event, the
  // event, and everything 'behind' it, is discarded. If the change is
  // before the event, the event's positions are updated. Uses a
  // copy-on-write scheme for the positions, to avoid having to
  // reallocate them all on every rebase, but also avoid problems with
  // shared position objects being unsafely updated.
  function rebaseHistArray(array, from, to, diff) {
    for (var i = 0; i < array.length; ++i) {
      var sub = array[i], ok = true;
      if (sub.ranges) {
        if (!sub.copied) { sub = array[i] = sub.deepCopy(); sub.copied = true; }
        for (var j = 0; j < sub.ranges.length; j++) {
          rebaseHistSelSingle(sub.ranges[j].anchor, from, to, diff);
          rebaseHistSelSingle(sub.ranges[j].head, from, to, diff);
        }
        continue;
      }
      for (var j = 0; j < sub.changes.length; ++j) {
        var cur = sub.changes[j];
        if (to < cur.from.line) {
          cur.from = Pos(cur.from.line + diff, cur.from.ch);
          cur.to = Pos(cur.to.line + diff, cur.to.ch);
        } else if (from <= cur.to.line) {
          ok = false;
          break;
        }
      }
      if (!ok) {
        array.splice(0, i + 1);
        i = 0;
      }
    }
  }

  function rebaseHist(hist, change) {
    var from = change.from.line, to = change.to.line, diff = change.text.length - (to - from) - 1;
    rebaseHistArray(hist.done, from, to, diff);
    rebaseHistArray(hist.undone, from, to, diff);
  }

  // EVENT UTILITIES

  // Due to the fact that we still support jurassic IE versions, some
  // compatibility wrappers are needed.

  var e_preventDefault = CodeMirror.e_preventDefault = function(e) {
    if (e.preventDefault) e.preventDefault();
    else e.returnValue = false;
  };
  var e_stopPropagation = CodeMirror.e_stopPropagation = function(e) {
    if (e.stopPropagation) e.stopPropagation();
    else e.cancelBubble = true;
  };
  function e_defaultPrevented(e) {
    return e.defaultPrevented != null ? e.defaultPrevented : e.returnValue == false;
  }
  var e_stop = CodeMirror.e_stop = function(e) {e_preventDefault(e); e_stopPropagation(e);};

  function e_target(e) {return e.target || e.srcElement;}
  function e_button(e) {
    var b = e.which;
    if (b == null) {
      if (e.button & 1) b = 1;
      else if (e.button & 2) b = 3;
      else if (e.button & 4) b = 2;
    }
    if (mac && e.ctrlKey && b == 1) b = 3;
    return b;
  }

  // EVENT HANDLING

  // Lightweight event framework. on/off also work on DOM nodes,
  // registering native DOM handlers.

  var on = CodeMirror.on = function(emitter, type, f) {
    if (emitter.addEventListener)
      emitter.addEventListener(type, f, false);
    else if (emitter.attachEvent)
      emitter.attachEvent("on" + type, f);
    else {
      var map = emitter._handlers || (emitter._handlers = {});
      var arr = map[type] || (map[type] = []);
      arr.push(f);
    }
  };

  var noHandlers = []
  function getHandlers(emitter, type, copy) {
    var arr = emitter._handlers && emitter._handlers[type]
    if (copy) return arr && arr.length > 0 ? arr.slice() : noHandlers
    else return arr || noHandlers
  }

  var off = CodeMirror.off = function(emitter, type, f) {
    if (emitter.removeEventListener)
      emitter.removeEventListener(type, f, false);
    else if (emitter.detachEvent)
      emitter.detachEvent("on" + type, f);
    else {
      var handlers = getHandlers(emitter, type, false)
      for (var i = 0; i < handlers.length; ++i)
        if (handlers[i] == f) { handlers.splice(i, 1); break; }
    }
  };

  var signal = CodeMirror.signal = function(emitter, type /*, values...*/) {
    var handlers = getHandlers(emitter, type, true)
    if (!handlers.length) return;
    var args = Array.prototype.slice.call(arguments, 2);
    for (var i = 0; i < handlers.length; ++i) handlers[i].apply(null, args);
  };

  var orphanDelayedCallbacks = null;

  // Often, we want to signal events at a point where we are in the
  // middle of some work, but don't want the handler to start calling
  // other methods on the editor, which might be in an inconsistent
  // state or simply not expect any other events to happen.
  // signalLater looks whether there are any handlers, and schedules
  // them to be executed when the last operation ends, or, if no
  // operation is active, when a timeout fires.
  function signalLater(emitter, type /*, values...*/) {
    var arr = getHandlers(emitter, type, false)
    if (!arr.length) return;
    var args = Array.prototype.slice.call(arguments, 2), list;
    if (operationGroup) {
      list = operationGroup.delayedCallbacks;
    } else if (orphanDelayedCallbacks) {
      list = orphanDelayedCallbacks;
    } else {
      list = orphanDelayedCallbacks = [];
      setTimeout(fireOrphanDelayed, 0);
    }
    function bnd(f) {return function(){f.apply(null, args);};};
    for (var i = 0; i < arr.length; ++i)
      list.push(bnd(arr[i]));
  }

  function fireOrphanDelayed() {
    var delayed = orphanDelayedCallbacks;
    orphanDelayedCallbacks = null;
    for (var i = 0; i < delayed.length; ++i) delayed[i]();
  }

  // The DOM events that CodeMirror handles can be overridden by
  // registering a (non-DOM) handler on the editor for the event name,
  // and preventDefault-ing the event in that handler.
  function signalDOMEvent(cm, e, override) {
    if (typeof e == "string")
      e = {type: e, preventDefault: function() { this.defaultPrevented = true; }};
    signal(cm, override || e.type, cm, e);
    return e_defaultPrevented(e) || e.codemirrorIgnore;
  }

  function signalCursorActivity(cm) {
    var arr = cm._handlers && cm._handlers.cursorActivity;
    if (!arr) return;
    var set = cm.curOp.cursorActivityHandlers || (cm.curOp.cursorActivityHandlers = []);
    for (var i = 0; i < arr.length; ++i) if (indexOf(set, arr[i]) == -1)
      set.push(arr[i]);
  }

  function hasHandler(emitter, type) {
    return getHandlers(emitter, type).length > 0
  }

  // Add on and off methods to a constructor's prototype, to make
  // registering events on such objects more convenient.
  function eventMixin(ctor) {
    ctor.prototype.on = function(type, f) {on(this, type, f);};
    ctor.prototype.off = function(type, f) {off(this, type, f);};
  }

  // MISC UTILITIES

  // Number of pixels added to scroller and sizer to hide scrollbar
  var scrollerGap = 30;

  // Returned or thrown by various protocols to signal 'I'm not
  // handling this'.
  var Pass = CodeMirror.Pass = {toString: function(){return "CodeMirror.Pass";}};

  // Reused option objects for setSelection & friends
  var sel_dontScroll = {scroll: false}, sel_mouse = {origin: "*mouse"}, sel_move = {origin: "+move"};

  function Delayed() {this.id = null;}
  Delayed.prototype.set = function(ms, f) {
    clearTimeout(this.id);
    this.id = setTimeout(f, ms);
  };

  // Counts the column offset in a string, taking tabs into account.
  // Used mostly to find indentation.
  var countColumn = CodeMirror.countColumn = function(string, end, tabSize, startIndex, startValue) {
    if (end == null) {
      end = string.search(/[^\s\u00a0]/);
      if (end == -1) end = string.length;
    }
    for (var i = startIndex || 0, n = startValue || 0;;) {
      var nextTab = string.indexOf("\t", i);
      if (nextTab < 0 || nextTab >= end)
        return n + (end - i);
      n += nextTab - i;
      n += tabSize - (n % tabSize);
      i = nextTab + 1;
    }
  };

  // The inverse of countColumn -- find the offset that corresponds to
  // a particular column.
  var findColumn = CodeMirror.findColumn = function(string, goal, tabSize) {
    for (var pos = 0, col = 0;;) {
      var nextTab = string.indexOf("\t", pos);
      if (nextTab == -1) nextTab = string.length;
      var skipped = nextTab - pos;
      if (nextTab == string.length || col + skipped >= goal)
        return pos + Math.min(skipped, goal - col);
      col += nextTab - pos;
      col += tabSize - (col % tabSize);
      pos = nextTab + 1;
      if (col >= goal) return pos;
    }
  }

  var spaceStrs = [""];
  function spaceStr(n) {
    while (spaceStrs.length <= n)
      spaceStrs.push(lst(spaceStrs) + " ");
    return spaceStrs[n];
  }

  function lst(arr) { return arr[arr.length-1]; }

  var selectInput = function(node) { node.select(); };
  if (ios) // Mobile Safari apparently has a bug where select() is broken.
    selectInput = function(node) { node.selectionStart = 0; node.selectionEnd = node.value.length; };
  else if (ie) // Suppress mysterious IE10 errors
    selectInput = function(node) { try { node.select(); } catch(_e) {} };

  function indexOf(array, elt) {
    for (var i = 0; i < array.length; ++i)
      if (array[i] == elt) return i;
    return -1;
  }
  function map(array, f) {
    var out = [];
    for (var i = 0; i < array.length; i++) out[i] = f(array[i], i);
    return out;
  }

  function nothing() {}

  function createObj(base, props) {
    var inst;
    if (Object.create) {
      inst = Object.create(base);
    } else {
      nothing.prototype = base;
      inst = new nothing();
    }
    if (props) copyObj(props, inst);
    return inst;
  };

  function copyObj(obj, target, overwrite) {
    if (!target) target = {};
    for (var prop in obj)
      if (obj.hasOwnProperty(prop) && (overwrite !== false || !target.hasOwnProperty(prop)))
        target[prop] = obj[prop];
    return target;
  }

  function bind(f) {
    var args = Array.prototype.slice.call(arguments, 1);
    return function(){return f.apply(null, args);};
  }

  var nonASCIISingleCaseWordChar = /[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;
  var isWordCharBasic = CodeMirror.isWordChar = function(ch) {
    return /\w/.test(ch) || ch > "\x80" &&
      (ch.toUpperCase() != ch.toLowerCase() || nonASCIISingleCaseWordChar.test(ch));
  };
  function isWordChar(ch, helper) {
    if (!helper) return isWordCharBasic(ch);
    if (helper.source.indexOf("\\w") > -1 && isWordCharBasic(ch)) return true;
    return helper.test(ch);
  }

  function isEmpty(obj) {
    for (var n in obj) if (obj.hasOwnProperty(n) && obj[n]) return false;
    return true;
  }

  // Extending unicode characters. A series of a non-extending char +
  // any number of extending chars is treated as a single unit as far
  // as editing and measuring is concerned. This is not fully correct,
  // since some scripts/fonts/browsers also treat other configurations
  // of code points as a group.
  var extendingChars = /[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;
  function isExtendingChar(ch) { return ch.charCodeAt(0) >= 768 && extendingChars.test(ch); }

  // DOM UTILITIES

  function elt(tag, content, className, style) {
    var e = document.createElement(tag);
    if (className) e.className = className;
    if (style) e.style.cssText = style;
    if (typeof content == "string") e.appendChild(document.createTextNode(content));
    else if (content) for (var i = 0; i < content.length; ++i) e.appendChild(content[i]);
    return e;
  }

  var range;
  if (document.createRange) range = function(node, start, end, endNode) {
    var r = document.createRange();
    r.setEnd(endNode || node, end);
    r.setStart(node, start);
    return r;
  };
  else range = function(node, start, end) {
    var r = document.body.createTextRange();
    try { r.moveToElementText(node.parentNode); }
    catch(e) { return r; }
    r.collapse(true);
    r.moveEnd("character", end);
    r.moveStart("character", start);
    return r;
  };

  function removeChildren(e) {
    for (var count = e.childNodes.length; count > 0; --count)
      e.removeChild(e.firstChild);
    return e;
  }

  function removeChildrenAndAdd(parent, e) {
    return removeChildren(parent).appendChild(e);
  }

  var contains = CodeMirror.contains = function(parent, child) {
    if (child.nodeType == 3) // Android browser always returns false when child is a textnode
      child = child.parentNode;
    if (parent.contains)
      return parent.contains(child);
    do {
      if (child.nodeType == 11) child = child.host;
      if (child == parent) return true;
    } while (child = child.parentNode);
  };

  function activeElt() {
    var activeElement = document.activeElement;
    while (activeElement && activeElement.root && activeElement.root.activeElement)
      activeElement = activeElement.root.activeElement;
    return activeElement;
  }
  // Older versions of IE throws unspecified error when touching
  // document.activeElement in some cases (during loading, in iframe)
  if (ie && ie_version < 11) activeElt = function() {
    try { return document.activeElement; }
    catch(e) { return document.body; }
  };

  function classTest(cls) { return new RegExp("(^|\\s)" + cls + "(?:$|\\s)\\s*"); }
  var rmClass = CodeMirror.rmClass = function(node, cls) {
    var current = node.className;
    var match = classTest(cls).exec(current);
    if (match) {
      var after = current.slice(match.index + match[0].length);
      node.className = current.slice(0, match.index) + (after ? match[1] + after : "");
    }
  };
  var addClass = CodeMirror.addClass = function(node, cls) {
    var current = node.className;
    if (!classTest(cls).test(current)) node.className += (current ? " " : "") + cls;
  };
  function joinClasses(a, b) {
    var as = a.split(" ");
    for (var i = 0; i < as.length; i++)
      if (as[i] && !classTest(as[i]).test(b)) b += " " + as[i];
    return b;
  }

  // WINDOW-WIDE EVENTS

  // These must be handled carefully, because naively registering a
  // handler for each editor will cause the editors to never be
  // garbage collected.

  function forEachCodeMirror(f) {
    if (!document.body.getElementsByClassName) return;
    var byClass = document.body.getElementsByClassName("CodeMirror");
    for (var i = 0; i < byClass.length; i++) {
      var cm = byClass[i].CodeMirror;
      if (cm) f(cm);
    }
  }

  var globalsRegistered = false;
  function ensureGlobalHandlers() {
    if (globalsRegistered) return;
    registerGlobalHandlers();
    globalsRegistered = true;
  }
  function registerGlobalHandlers() {
    // When the window resizes, we need to refresh active editors.
    var resizeTimer;
    on(window, "resize", function() {
      if (resizeTimer == null) resizeTimer = setTimeout(function() {
        resizeTimer = null;
        forEachCodeMirror(onResize);
      }, 100);
    });
    // When the window loses focus, we want to show the editor as blurred
    on(window, "blur", function() {
      forEachCodeMirror(onBlur);
    });
  }

  // FEATURE DETECTION

  // Detect drag-and-drop
  var dragAndDrop = function() {
    // There is *some* kind of drag-and-drop support in IE6-8, but I
    // couldn't get it to work yet.
    if (ie && ie_version < 9) return false;
    var div = elt('div');
    return "draggable" in div || "dragDrop" in div;
  }();

  var zwspSupported;
  function zeroWidthElement(measure) {
    if (zwspSupported == null) {
      var test = elt("span", "\u200b");
      removeChildrenAndAdd(measure, elt("span", [test, document.createTextNode("x")]));
      if (measure.firstChild.offsetHeight != 0)
        zwspSupported = test.offsetWidth <= 1 && test.offsetHeight > 2 && !(ie && ie_version < 8);
    }
    var node = zwspSupported ? elt("span", "\u200b") :
      elt("span", "\u00a0", null, "display: inline-block; width: 1px; margin-right: -1px");
    node.setAttribute("cm-text", "");
    return node;
  }

  // Feature-detect IE's crummy client rect reporting for bidi text
  var badBidiRects;
  function hasBadBidiRects(measure) {
    if (badBidiRects != null) return badBidiRects;
    var txt = removeChildrenAndAdd(measure, document.createTextNode("A\u062eA"));
    var r0 = range(txt, 0, 1).getBoundingClientRect();
    if (!r0 || r0.left == r0.right) return false; // Safari returns null in some cases (#2780)
    var r1 = range(txt, 1, 2).getBoundingClientRect();
    return badBidiRects = (r1.right - r0.right < 3);
  }

  // See if "".split is the broken IE version, if so, provide an
  // alternative way to split lines.
  var splitLinesAuto = CodeMirror.splitLines = "\n\nb".split(/\n/).length != 3 ? function(string) {
    var pos = 0, result = [], l = string.length;
    while (pos <= l) {
      var nl = string.indexOf("\n", pos);
      if (nl == -1) nl = string.length;
      var line = string.slice(pos, string.charAt(nl - 1) == "\r" ? nl - 1 : nl);
      var rt = line.indexOf("\r");
      if (rt != -1) {
        result.push(line.slice(0, rt));
        pos += rt + 1;
      } else {
        result.push(line);
        pos = nl + 1;
      }
    }
    return result;
  } : function(string){return string.split(/\r\n?|\n/);};

  var hasSelection = window.getSelection ? function(te) {
    try { return te.selectionStart != te.selectionEnd; }
    catch(e) { return false; }
  } : function(te) {
    try {var range = te.ownerDocument.selection.createRange();}
    catch(e) {}
    if (!range || range.parentElement() != te) return false;
    return range.compareEndPoints("StartToEnd", range) != 0;
  };

  var hasCopyEvent = (function() {
    var e = elt("div");
    if ("oncopy" in e) return true;
    e.setAttribute("oncopy", "return;");
    return typeof e.oncopy == "function";
  })();

  var badZoomedRects = null;
  function hasBadZoomedRects(measure) {
    if (badZoomedRects != null) return badZoomedRects;
    var node = removeChildrenAndAdd(measure, elt("span", "x"));
    var normal = node.getBoundingClientRect();
    var fromRange = range(node, 0, 1).getBoundingClientRect();
    return badZoomedRects = Math.abs(normal.left - fromRange.left) > 1;
  }

  // KEY NAMES

  var keyNames = CodeMirror.keyNames = {
    3: "Enter", 8: "Backspace", 9: "Tab", 13: "Enter", 16: "Shift", 17: "Ctrl", 18: "Alt",
    19: "Pause", 20: "CapsLock", 27: "Esc", 32: "Space", 33: "PageUp", 34: "PageDown", 35: "End",
    36: "Home", 37: "Left", 38: "Up", 39: "Right", 40: "Down", 44: "PrintScrn", 45: "Insert",
    46: "Delete", 59: ";", 61: "=", 91: "Mod", 92: "Mod", 93: "Mod",
    106: "*", 107: "=", 109: "-", 110: ".", 111: "/", 127: "Delete",
    173: "-", 186: ";", 187: "=", 188: ",", 189: "-", 190: ".", 191: "/", 192: "`", 219: "[", 220: "\\",
    221: "]", 222: "'", 63232: "Up", 63233: "Down", 63234: "Left", 63235: "Right", 63272: "Delete",
    63273: "Home", 63275: "End", 63276: "PageUp", 63277: "PageDown", 63302: "Insert"
  };
  (function() {
    // Number keys
    for (var i = 0; i < 10; i++) keyNames[i + 48] = keyNames[i + 96] = String(i);
    // Alphabetic keys
    for (var i = 65; i <= 90; i++) keyNames[i] = String.fromCharCode(i);
    // Function keys
    for (var i = 1; i <= 12; i++) keyNames[i + 111] = keyNames[i + 63235] = "F" + i;
  })();

  // BIDI HELPERS

  function iterateBidiSections(order, from, to, f) {
    if (!order) return f(from, to, "ltr");
    var found = false;
    for (var i = 0; i < order.length; ++i) {
      var part = order[i];
      if (part.from < to && part.to > from || from == to && part.to == from) {
        f(Math.max(part.from, from), Math.min(part.to, to), part.level == 1 ? "rtl" : "ltr");
        found = true;
      }
    }
    if (!found) f(from, to, "ltr");
  }

  function bidiLeft(part) { return part.level % 2 ? part.to : part.from; }
  function bidiRight(part) { return part.level % 2 ? part.from : part.to; }

  function lineLeft(line) { var order = getOrder(line); return order ? bidiLeft(order[0]) : 0; }
  function lineRight(line) {
    var order = getOrder(line);
    if (!order) return line.text.length;
    return bidiRight(lst(order));
  }

  function lineStart(cm, lineN) {
    var line = getLine(cm.doc, lineN);
    var visual = visualLine(line);
    if (visual != line) lineN = lineNo(visual);
    var order = getOrder(visual);
    var ch = !order ? 0 : order[0].level % 2 ? lineRight(visual) : lineLeft(visual);
    return Pos(lineN, ch);
  }
  function lineEnd(cm, lineN) {
    var merged, line = getLine(cm.doc, lineN);
    while (merged = collapsedSpanAtEnd(line)) {
      line = merged.find(1, true).line;
      lineN = null;
    }
    var order = getOrder(line);
    var ch = !order ? line.text.length : order[0].level % 2 ? lineLeft(line) : lineRight(line);
    return Pos(lineN == null ? lineNo(line) : lineN, ch);
  }
  function lineStartSmart(cm, pos) {
    var start = lineStart(cm, pos.line);
    var line = getLine(cm.doc, start.line);
    var order = getOrder(line);
    if (!order || order[0].level == 0) {
      var firstNonWS = Math.max(0, line.text.search(/\S/));
      var inWS = pos.line == start.line && pos.ch <= firstNonWS && pos.ch;
      return Pos(start.line, inWS ? 0 : firstNonWS);
    }
    return start;
  }

  function compareBidiLevel(order, a, b) {
    var linedir = order[0].level;
    if (a == linedir) return true;
    if (b == linedir) return false;
    return a < b;
  }
  var bidiOther;
  function getBidiPartAt(order, pos) {
    bidiOther = null;
    for (var i = 0, found; i < order.length; ++i) {
      var cur = order[i];
      if (cur.from < pos && cur.to > pos) return i;
      if ((cur.from == pos || cur.to == pos)) {
        if (found == null) {
          found = i;
        } else if (compareBidiLevel(order, cur.level, order[found].level)) {
          if (cur.from != cur.to) bidiOther = found;
          return i;
        } else {
          if (cur.from != cur.to) bidiOther = i;
          return found;
        }
      }
    }
    return found;
  }

  function moveInLine(line, pos, dir, byUnit) {
    if (!byUnit) return pos + dir;
    do pos += dir;
    while (pos > 0 && isExtendingChar(line.text.charAt(pos)));
    return pos;
  }

  // This is needed in order to move 'visually' through bi-directional
  // text -- i.e., pressing left should make the cursor go left, even
  // when in RTL text. The tricky part is the 'jumps', where RTL and
  // LTR text touch each other. This often requires the cursor offset
  // to move more than one unit, in order to visually move one unit.
  function moveVisually(line, start, dir, byUnit) {
    var bidi = getOrder(line);
    if (!bidi) return moveLogically(line, start, dir, byUnit);
    var pos = getBidiPartAt(bidi, start), part = bidi[pos];
    var target = moveInLine(line, start, part.level % 2 ? -dir : dir, byUnit);

    for (;;) {
      if (target > part.from && target < part.to) return target;
      if (target == part.from || target == part.to) {
        if (getBidiPartAt(bidi, target) == pos) return target;
        part = bidi[pos += dir];
        return (dir > 0) == part.level % 2 ? part.to : part.from;
      } else {
        part = bidi[pos += dir];
        if (!part) return null;
        if ((dir > 0) == part.level % 2)
          target = moveInLine(line, part.to, -1, byUnit);
        else
          target = moveInLine(line, part.from, 1, byUnit);
      }
    }
  }

  function moveLogically(line, start, dir, byUnit) {
    var target = start + dir;
    if (byUnit) while (target > 0 && isExtendingChar(line.text.charAt(target))) target += dir;
    return target < 0 || target > line.text.length ? null : target;
  }

  // Bidirectional ordering algorithm
  // See http://unicode.org/reports/tr9/tr9-13.html for the algorithm
  // that this (partially) implements.

  // One-char codes used for character types:
  // L (L):   Left-to-Right
  // R (R):   Right-to-Left
  // r (AL):  Right-to-Left Arabic
  // 1 (EN):  European Number
  // + (ES):  European Number Separator
  // % (ET):  European Number Terminator
  // n (AN):  Arabic Number
  // , (CS):  Common Number Separator
  // m (NSM): Non-Spacing Mark
  // b (BN):  Boundary Neutral
  // s (B):   Paragraph Separator
  // t (S):   Segment Separator
  // w (WS):  Whitespace
  // N (ON):  Other Neutrals

  // Returns null if characters are ordered as they appear
  // (left-to-right), or an array of sections ({from, to, level}
  // objects) in the order in which they occur visually.
  var bidiOrdering = (function() {
    // Character types for codepoints 0 to 0xff
    var lowTypes = "bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN";
    // Character types for codepoints 0x600 to 0x6ff
    var arabicTypes = "rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm";
    function charType(code) {
      if (code <= 0xf7) return lowTypes.charAt(code);
      else if (0x590 <= code && code <= 0x5f4) return "R";
      else if (0x600 <= code && code <= 0x6ed) return arabicTypes.charAt(code - 0x600);
      else if (0x6ee <= code && code <= 0x8ac) return "r";
      else if (0x2000 <= code && code <= 0x200b) return "w";
      else if (code == 0x200c) return "b";
      else return "L";
    }

    var bidiRE = /[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;
    var isNeutral = /[stwN]/, isStrong = /[LRr]/, countsAsLeft = /[Lb1n]/, countsAsNum = /[1n]/;
    // Browsers seem to always treat the boundaries of block elements as being L.
    var outerType = "L";

    function BidiSpan(level, from, to) {
      this.level = level;
      this.from = from; this.to = to;
    }

    return function(str) {
      if (!bidiRE.test(str)) return false;
      var len = str.length, types = [];
      for (var i = 0, type; i < len; ++i)
        types.push(type = charType(str.charCodeAt(i)));

      // W1. Examine each non-spacing mark (NSM) in the level run, and
      // change the type of the NSM to the type of the previous
      // character. If the NSM is at the start of the level run, it will
      // get the type of sor.
      for (var i = 0, prev = outerType; i < len; ++i) {
        var type = types[i];
        if (type == "m") types[i] = prev;
        else prev = type;
      }

      // W2. Search backwards from each instance of a European number
      // until the first strong type (R, L, AL, or sor) is found. If an
      // AL is found, change the type of the European number to Arabic
      // number.
      // W3. Change all ALs to R.
      for (var i = 0, cur = outerType; i < len; ++i) {
        var type = types[i];
        if (type == "1" && cur == "r") types[i] = "n";
        else if (isStrong.test(type)) { cur = type; if (type == "r") types[i] = "R"; }
      }

      // W4. A single European separator between two European numbers
      // changes to a European number. A single common separator between
      // two numbers of the same type changes to that type.
      for (var i = 1, prev = types[0]; i < len - 1; ++i) {
        var type = types[i];
        if (type == "+" && prev == "1" && types[i+1] == "1") types[i] = "1";
        else if (type == "," && prev == types[i+1] &&
                 (prev == "1" || prev == "n")) types[i] = prev;
        prev = type;
      }

      // W5. A sequence of European terminators adjacent to European
      // numbers changes to all European numbers.
      // W6. Otherwise, separators and terminators change to Other
      // Neutral.
      for (var i = 0; i < len; ++i) {
        var type = types[i];
        if (type == ",") types[i] = "N";
        else if (type == "%") {
          for (var end = i + 1; end < len && types[end] == "%"; ++end) {}
          var replace = (i && types[i-1] == "!") || (end < len && types[end] == "1") ? "1" : "N";
          for (var j = i; j < end; ++j) types[j] = replace;
          i = end - 1;
        }
      }

      // W7. Search backwards from each instance of a European number
      // until the first strong type (R, L, or sor) is found. If an L is
      // found, then change the type of the European number to L.
      for (var i = 0, cur = outerType; i < len; ++i) {
        var type = types[i];
        if (cur == "L" && type == "1") types[i] = "L";
        else if (isStrong.test(type)) cur = type;
      }

      // N1. A sequence of neutrals takes the direction of the
      // surrounding strong text if the text on both sides has the same
      // direction. European and Arabic numbers act as if they were R in
      // terms of their influence on neutrals. Start-of-level-run (sor)
      // and end-of-level-run (eor) are used at level run boundaries.
      // N2. Any remaining neutrals take the embedding direction.
      for (var i = 0; i < len; ++i) {
        if (isNeutral.test(types[i])) {
          for (var end = i + 1; end < len && isNeutral.test(types[end]); ++end) {}
          var before = (i ? types[i-1] : outerType) == "L";
          var after = (end < len ? types[end] : outerType) == "L";
          var replace = before || after ? "L" : "R";
          for (var j = i; j < end; ++j) types[j] = replace;
          i = end - 1;
        }
      }

      // Here we depart from the documented algorithm, in order to avoid
      // building up an actual levels array. Since there are only three
      // levels (0, 1, 2) in an implementation that doesn't take
      // explicit embedding into account, we can build up the order on
      // the fly, without following the level-based algorithm.
      var order = [], m;
      for (var i = 0; i < len;) {
        if (countsAsLeft.test(types[i])) {
          var start = i;
          for (++i; i < len && countsAsLeft.test(types[i]); ++i) {}
          order.push(new BidiSpan(0, start, i));
        } else {
          var pos = i, at = order.length;
          for (++i; i < len && types[i] != "L"; ++i) {}
          for (var j = pos; j < i;) {
            if (countsAsNum.test(types[j])) {
              if (pos < j) order.splice(at, 0, new BidiSpan(1, pos, j));
              var nstart = j;
              for (++j; j < i && countsAsNum.test(types[j]); ++j) {}
              order.splice(at, 0, new BidiSpan(2, nstart, j));
              pos = j;
            } else ++j;
          }
          if (pos < i) order.splice(at, 0, new BidiSpan(1, pos, i));
        }
      }
      if (order[0].level == 1 && (m = str.match(/^\s+/))) {
        order[0].from = m[0].length;
        order.unshift(new BidiSpan(0, 0, m[0].length));
      }
      if (lst(order).level == 1 && (m = str.match(/\s+$/))) {
        lst(order).to -= m[0].length;
        order.push(new BidiSpan(0, len - m[0].length, len));
      }
      if (order[0].level == 2)
        order.unshift(new BidiSpan(1, order[0].to, order[0].to));
      if (order[0].level != lst(order).level)
        order.push(new BidiSpan(order[0].level, len, len));

      return order;
    };
  })();

  // THE END

  CodeMirror.version = "5.8.0";

  return CodeMirror;
});

},{}],3:[function(require,module,exports){
// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

/**
 * Author: Hans Engel
 * Branched from CodeMirror's Scheme mode (by Koh Zi Han, based on implementation by Koh Zi Chun)
 */

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
"use strict";

CodeMirror.defineMode("clojure", function (options) {
    var BUILTIN = "builtin", COMMENT = "comment", STRING = "string", CHARACTER = "string-2",
        ATOM = "atom", NUMBER = "number", BRACKET = "bracket", KEYWORD = "keyword", VAR = "variable";
    var INDENT_WORD_SKIP = options.indentUnit || 2;
    var NORMAL_INDENT_UNIT = options.indentUnit || 2;

    function makeKeywords(str) {
        var obj = {}, words = str.split(" ");
        for (var i = 0; i < words.length; ++i) obj[words[i]] = true;
        return obj;
    }

    var atoms = makeKeywords("true false nil");

    var keywords = makeKeywords(
      "defn defn- def def- defonce defmulti defmethod defmacro defstruct deftype defprotocol defrecord defproject deftest slice defalias defhinted defmacro- defn-memo defnk defnk defonce- defunbound defunbound- defvar defvar- let letfn do case cond condp for loop recur when when-not when-let when-first if if-let if-not . .. -> ->> doto and or dosync doseq dotimes dorun doall load import unimport ns in-ns refer try catch finally throw with-open with-local-vars binding gen-class gen-and-load-class gen-and-save-class handler-case handle");

    var builtins = makeKeywords(
        "* *' *1 *2 *3 *agent* *allow-unresolved-vars* *assert* *clojure-version* *command-line-args* *compile-files* *compile-path* *compiler-options* *data-readers* *e *err* *file* *flush-on-newline* *fn-loader* *in* *math-context* *ns* *out* *print-dup* *print-length* *print-level* *print-meta* *print-readably* *read-eval* *source-path* *unchecked-math* *use-context-classloader* *verbose-defrecords* *warn-on-reflection* + +' - -' -> ->> ->ArrayChunk ->Vec ->VecNode ->VecSeq -cache-protocol-fn -reset-methods .. / < <= = == > >= EMPTY-NODE accessor aclone add-classpath add-watch agent agent-error agent-errors aget alength alias all-ns alter alter-meta! alter-var-root amap ancestors and apply areduce array-map aset aset-boolean aset-byte aset-char aset-double aset-float aset-int aset-long aset-short assert assoc assoc! assoc-in associative? atom await await-for await1 bases bean bigdec bigint biginteger binding bit-and bit-and-not bit-clear bit-flip bit-not bit-or bit-set bit-shift-left bit-shift-right bit-test bit-xor boolean boolean-array booleans bound-fn bound-fn* bound? butlast byte byte-array bytes case cast char char-array char-escape-string char-name-string char? chars chunk chunk-append chunk-buffer chunk-cons chunk-first chunk-next chunk-rest chunked-seq? class class? clear-agent-errors clojure-version coll? comment commute comp comparator compare compare-and-set! compile complement concat cond condp conj conj! cons constantly construct-proxy contains? count counted? create-ns create-struct cycle dec dec' decimal? declare default-data-readers definline definterface defmacro defmethod defmulti defn defn- defonce defprotocol defrecord defstruct deftype delay delay? deliver denominator deref derive descendants destructure disj disj! dissoc dissoc! distinct distinct? doall dorun doseq dosync dotimes doto double double-array doubles drop drop-last drop-while empty empty? ensure enumeration-seq error-handler error-mode eval even? every-pred every? ex-data ex-info extend extend-protocol extend-type extenders extends? false? ffirst file-seq filter filterv find find-keyword find-ns find-protocol-impl find-protocol-method find-var first flatten float float-array float? floats flush fn fn? fnext fnil for force format frequencies future future-call future-cancel future-cancelled? future-done? future? gen-class gen-interface gensym get get-in get-method get-proxy-class get-thread-bindings get-validator group-by hash hash-combine hash-map hash-set identical? identity if-let if-not ifn? import in-ns inc inc' init-proxy instance? int int-array integer? interleave intern interpose into into-array ints io! isa? iterate iterator-seq juxt keep keep-indexed key keys keyword keyword? last lazy-cat lazy-seq let letfn line-seq list list* list? load load-file load-reader load-string loaded-libs locking long long-array longs loop macroexpand macroexpand-1 make-array make-hierarchy map map-indexed map? mapcat mapv max max-key memfn memoize merge merge-with meta method-sig methods min min-key mod munge name namespace namespace-munge neg? newline next nfirst nil? nnext not not-any? not-empty not-every? not= ns ns-aliases ns-imports ns-interns ns-map ns-name ns-publics ns-refers ns-resolve ns-unalias ns-unmap nth nthnext nthrest num number? numerator object-array odd? or parents partial partition partition-all partition-by pcalls peek persistent! pmap pop pop! pop-thread-bindings pos? pr pr-str prefer-method prefers primitives-classnames print print-ctor print-dup print-method print-simple print-str printf println println-str prn prn-str promise proxy proxy-call-with-super proxy-mappings proxy-name proxy-super push-thread-bindings pvalues quot rand rand-int rand-nth range ratio? rational? rationalize re-find re-groups re-matcher re-matches re-pattern re-seq read read-line read-string realized? reduce reduce-kv reductions ref ref-history-count ref-max-history ref-min-history ref-set refer refer-clojure reify release-pending-sends rem remove remove-all-methods remove-method remove-ns remove-watch repeat repeatedly replace replicate require reset! reset-meta! resolve rest restart-agent resultset-seq reverse reversible? rseq rsubseq satisfies? second select-keys send send-off seq seq? seque sequence sequential? set set-error-handler! set-error-mode! set-validator! set? short short-array shorts shuffle shutdown-agents slurp some some-fn sort sort-by sorted-map sorted-map-by sorted-set sorted-set-by sorted? special-symbol? spit split-at split-with str string? struct struct-map subs subseq subvec supers swap! symbol symbol? sync take take-last take-nth take-while test the-ns thread-bound? time to-array to-array-2d trampoline transient tree-seq true? type unchecked-add unchecked-add-int unchecked-byte unchecked-char unchecked-dec unchecked-dec-int unchecked-divide-int unchecked-double unchecked-float unchecked-inc unchecked-inc-int unchecked-int unchecked-long unchecked-multiply unchecked-multiply-int unchecked-negate unchecked-negate-int unchecked-remainder-int unchecked-short unchecked-subtract unchecked-subtract-int underive unquote unquote-splicing update-in update-proxy use val vals var-get var-set var? vary-meta vec vector vector-of vector? when when-first when-let when-not while with-bindings with-bindings* with-in-str with-loading-context with-local-vars with-meta with-open with-out-str with-precision with-redefs with-redefs-fn xml-seq zero? zipmap *default-data-reader-fn* as-> cond-> cond->> reduced reduced? send-via set-agent-send-executor! set-agent-send-off-executor! some-> some->>");

    var indentKeys = makeKeywords(
        // Built-ins
        "ns fn def defn defmethod bound-fn if if-not case condp when while when-not when-first do future comment doto locking proxy with-open with-precision reify deftype defrecord defprotocol extend extend-protocol extend-type try catch " +

        // Binding forms
        "let letfn binding loop for doseq dotimes when-let if-let " +

        // Data structures
        "defstruct struct-map assoc " +

        // clojure.test
        "testing deftest " +

        // contrib
        "handler-case handle dotrace deftrace");

    var tests = {
        digit: /\d/,
        digit_or_colon: /[\d:]/,
        hex: /[0-9a-f]/i,
        sign: /[+-]/,
        exponent: /e/i,
        keyword_char: /[^\s\(\[\;\)\]]/,
        symbol: /[\w*+!\-\._?:<>\/\xa1-\uffff]/
    };

    function stateStack(indent, type, prev) { // represents a state stack object
        this.indent = indent;
        this.type = type;
        this.prev = prev;
    }

    function pushStack(state, indent, type) {
        state.indentStack = new stateStack(indent, type, state.indentStack);
    }

    function popStack(state) {
        state.indentStack = state.indentStack.prev;
    }

    function isNumber(ch, stream){
        // hex
        if ( ch === '0' && stream.eat(/x/i) ) {
            stream.eatWhile(tests.hex);
            return true;
        }

        // leading sign
        if ( ( ch == '+' || ch == '-' ) && ( tests.digit.test(stream.peek()) ) ) {
          stream.eat(tests.sign);
          ch = stream.next();
        }

        if ( tests.digit.test(ch) ) {
            stream.eat(ch);
            stream.eatWhile(tests.digit);

            if ( '.' == stream.peek() ) {
                stream.eat('.');
                stream.eatWhile(tests.digit);
            }

            if ( stream.eat(tests.exponent) ) {
                stream.eat(tests.sign);
                stream.eatWhile(tests.digit);
            }

            return true;
        }

        return false;
    }

    // Eat character that starts after backslash \
    function eatCharacter(stream) {
        var first = stream.next();
        // Read special literals: backspace, newline, space, return.
        // Just read all lowercase letters.
        if (first && first.match(/[a-z]/) && stream.match(/[a-z]+/, true)) {
            return;
        }
        // Read unicode character: \u1000 \uA0a1
        if (first === "u") {
            stream.match(/[0-9a-z]{4}/i, true);
        }
    }

    return {
        startState: function () {
            return {
                indentStack: null,
                indentation: 0,
                mode: false
            };
        },

        token: function (stream, state) {
            if (state.indentStack == null && stream.sol()) {
                // update indentation, but only if indentStack is empty
                state.indentation = stream.indentation();
            }

            // skip spaces
            if (stream.eatSpace()) {
                return null;
            }
            var returnType = null;

            switch(state.mode){
                case "string": // multi-line string parsing mode
                    var next, escaped = false;
                    while ((next = stream.next()) != null) {
                        if (next == "\"" && !escaped) {

                            state.mode = false;
                            break;
                        }
                        escaped = !escaped && next == "\\";
                    }
                    returnType = STRING; // continue on in string mode
                    break;
                default: // default parsing mode
                    var ch = stream.next();

                    if (ch == "\"") {
                        state.mode = "string";
                        returnType = STRING;
                    } else if (ch == "\\") {
                        eatCharacter(stream);
                        returnType = CHARACTER;
                    } else if (ch == "'" && !( tests.digit_or_colon.test(stream.peek()) )) {
                        returnType = ATOM;
                    } else if (ch == ";") { // comment
                        stream.skipToEnd(); // rest of the line is a comment
                        returnType = COMMENT;
                    } else if (isNumber(ch,stream)){
                        returnType = NUMBER;
                    } else if (ch == "(" || ch == "[" || ch == "{" ) {
                        var keyWord = '', indentTemp = stream.column(), letter;
                        /**
                        Either
                        (indent-word ..
                        (non-indent-word ..
                        (;something else, bracket, etc.
                        */

                        if (ch == "(") while ((letter = stream.eat(tests.keyword_char)) != null) {
                            keyWord += letter;
                        }

                        if (keyWord.length > 0 && (indentKeys.propertyIsEnumerable(keyWord) ||
                                                   /^(?:def|with)/.test(keyWord))) { // indent-word
                            pushStack(state, indentTemp + INDENT_WORD_SKIP, ch);
                        } else { // non-indent word
                            // we continue eating the spaces
                            stream.eatSpace();
                            if (stream.eol() || stream.peek() == ";") {
                                // nothing significant after
                                // we restart indentation the user defined spaces after
                                pushStack(state, indentTemp + NORMAL_INDENT_UNIT, ch);
                            } else {
                                pushStack(state, indentTemp + stream.current().length, ch); // else we match
                            }
                        }
                        stream.backUp(stream.current().length - 1); // undo all the eating

                        returnType = BRACKET;
                    } else if (ch == ")" || ch == "]" || ch == "}") {
                        returnType = BRACKET;
                        if (state.indentStack != null && state.indentStack.type == (ch == ")" ? "(" : (ch == "]" ? "[" :"{"))) {
                            popStack(state);
                        }
                    } else if ( ch == ":" ) {
                        stream.eatWhile(tests.symbol);
                        return ATOM;
                    } else {
                        stream.eatWhile(tests.symbol);

                        if (keywords && keywords.propertyIsEnumerable(stream.current())) {
                            returnType = KEYWORD;
                        } else if (builtins && builtins.propertyIsEnumerable(stream.current())) {
                            returnType = BUILTIN;
                        } else if (atoms && atoms.propertyIsEnumerable(stream.current())) {
                            returnType = ATOM;
                        } else {
                          returnType = VAR;
                        }
                    }
            }

            return returnType;
        },

        indent: function (state) {
            if (state.indentStack == null) return state.indentation;
            return state.indentStack.indent;
        },

        closeBrackets: {pairs: "()[]{}\"\""},
        lineComment: ";;"
    };
});

CodeMirror.defineMIME("text/x-clojure", "clojure");

});

},{"../../lib/codemirror":2}],4:[function(require,module,exports){
// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"), require("../markdown/markdown"), require("../../addon/mode/overlay"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror", "../markdown/markdown", "../../addon/mode/overlay"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
"use strict";

var urlRE = /^((?:(?:aaas?|about|acap|adiumxtra|af[ps]|aim|apt|attachment|aw|beshare|bitcoin|bolo|callto|cap|chrome(?:-extension)?|cid|coap|com-eventbrite-attendee|content|crid|cvs|data|dav|dict|dlna-(?:playcontainer|playsingle)|dns|doi|dtn|dvb|ed2k|facetime|feed|file|finger|fish|ftp|geo|gg|git|gizmoproject|go|gopher|gtalk|h323|hcp|https?|iax|icap|icon|im|imap|info|ipn|ipp|irc[6s]?|iris(?:\.beep|\.lwz|\.xpc|\.xpcs)?|itms|jar|javascript|jms|keyparc|lastfm|ldaps?|magnet|mailto|maps|market|message|mid|mms|ms-help|msnim|msrps?|mtqp|mumble|mupdate|mvn|news|nfs|nih?|nntp|notes|oid|opaquelocktoken|palm|paparazzi|platform|pop|pres|proxy|psyc|query|res(?:ource)?|rmi|rsync|rtmp|rtsp|secondlife|service|session|sftp|sgn|shttp|sieve|sips?|skype|sm[bs]|snmp|soap\.beeps?|soldat|spotify|ssh|steam|svn|tag|teamspeak|tel(?:net)?|tftp|things|thismessage|tip|tn3270|tv|udp|unreal|urn|ut2004|vemmi|ventrilo|view-source|webcal|wss?|wtai|wyciwyg|xcon(?:-userid)?|xfire|xmlrpc\.beeps?|xmpp|xri|ymsgr|z39\.50[rs]?):(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]|\([^\s()<>]*\))+(?:\([^\s()<>]*\)|[^\s`*!()\[\]{};:'".,<>?]))/i

CodeMirror.defineMode("gfm", function(config, modeConfig) {
  var codeDepth = 0;
  function blankLine(state) {
    state.code = false;
    return null;
  }
  var gfmOverlay = {
    startState: function() {
      return {
        code: false,
        codeBlock: false,
        ateSpace: false
      };
    },
    copyState: function(s) {
      return {
        code: s.code,
        codeBlock: s.codeBlock,
        ateSpace: s.ateSpace
      };
    },
    token: function(stream, state) {
      state.combineTokens = null;

      // Hack to prevent formatting override inside code blocks (block and inline)
      if (state.codeBlock) {
        if (stream.match(/^```+/)) {
          state.codeBlock = false;
          return null;
        }
        stream.skipToEnd();
        return null;
      }
      if (stream.sol()) {
        state.code = false;
      }
      if (stream.sol() && stream.match(/^```+/)) {
        stream.skipToEnd();
        state.codeBlock = true;
        return null;
      }
      // If this block is changed, it may need to be updated in Markdown mode
      if (stream.peek() === '`') {
        stream.next();
        var before = stream.pos;
        stream.eatWhile('`');
        var difference = 1 + stream.pos - before;
        if (!state.code) {
          codeDepth = difference;
          state.code = true;
        } else {
          if (difference === codeDepth) { // Must be exact
            state.code = false;
          }
        }
        return null;
      } else if (state.code) {
        stream.next();
        return null;
      }
      // Check if space. If so, links can be formatted later on
      if (stream.eatSpace()) {
        state.ateSpace = true;
        return null;
      }
      if (stream.sol() || state.ateSpace) {
        state.ateSpace = false;
        if (modeConfig.gitHubSpice !== false) {
          if(stream.match(/^(?:[a-zA-Z0-9\-_]+\/)?(?:[a-zA-Z0-9\-_]+@)?(?:[a-f0-9]{7,40}\b)/)) {
            // User/Project@SHA
            // User@SHA
            // SHA
            state.combineTokens = true;
            return "link";
          } else if (stream.match(/^(?:[a-zA-Z0-9\-_]+\/)?(?:[a-zA-Z0-9\-_]+)?#[0-9]+\b/)) {
            // User/Project#Num
            // User#Num
            // #Num
            state.combineTokens = true;
            return "link";
          }
        }
      }
      if (stream.match(urlRE) &&
          stream.string.slice(stream.start - 2, stream.start) != "](" &&
          (stream.start == 0 || /\W/.test(stream.string.charAt(stream.start - 1)))) {
        // URLs
        // Taken from http://daringfireball.net/2010/07/improved_regex_for_matching_urls
        // And then (issue #1160) simplified to make it not crash the Chrome Regexp engine
        // And then limited url schemes to the CommonMark list, so foo:bar isn't matched as a URL
        state.combineTokens = true;
        return "link";
      }
      stream.next();
      return null;
    },
    blankLine: blankLine
  };

  var markdownConfig = {
    underscoresBreakWords: false,
    taskLists: true,
    fencedCodeBlocks: '```',
    strikethrough: true
  };
  for (var attr in modeConfig) {
    markdownConfig[attr] = modeConfig[attr];
  }
  markdownConfig.name = "markdown";
  return CodeMirror.overlayMode(CodeMirror.getMode(config, markdownConfig), gfmOverlay);

}, "markdown");

  CodeMirror.defineMIME("text/x-gfm", "gfm");
});

},{"../../addon/mode/overlay":1,"../../lib/codemirror":2,"../markdown/markdown":5}],5:[function(require,module,exports){
// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"), require("../xml/xml"), require("../meta"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror", "../xml/xml", "../meta"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
"use strict";

CodeMirror.defineMode("markdown", function(cmCfg, modeCfg) {

  var htmlFound = CodeMirror.modes.hasOwnProperty("xml");
  var htmlMode = CodeMirror.getMode(cmCfg, htmlFound ? {name: "xml", htmlMode: true} : "text/plain");

  function getMode(name) {
    if (CodeMirror.findModeByName) {
      var found = CodeMirror.findModeByName(name);
      if (found) name = found.mime || found.mimes[0];
    }
    var mode = CodeMirror.getMode(cmCfg, name);
    return mode.name == "null" ? null : mode;
  }

  // Should characters that affect highlighting be highlighted separate?
  // Does not include characters that will be output (such as `1.` and `-` for lists)
  if (modeCfg.highlightFormatting === undefined)
    modeCfg.highlightFormatting = false;

  // Maximum number of nested blockquotes. Set to 0 for infinite nesting.
  // Excess `>` will emit `error` token.
  if (modeCfg.maxBlockquoteDepth === undefined)
    modeCfg.maxBlockquoteDepth = 0;

  // Should underscores in words open/close em/strong?
  if (modeCfg.underscoresBreakWords === undefined)
    modeCfg.underscoresBreakWords = true;

  // Use `fencedCodeBlocks` to configure fenced code blocks. false to
  // disable, string to specify a precise regexp that the fence should
  // match, and true to allow three or more backticks or tildes (as
  // per CommonMark).

  // Turn on task lists? ("- [ ] " and "- [x] ")
  if (modeCfg.taskLists === undefined) modeCfg.taskLists = false;

  // Turn on strikethrough syntax
  if (modeCfg.strikethrough === undefined)
    modeCfg.strikethrough = false;

  // Allow token types to be overridden by user-provided token types.
  if (modeCfg.tokenTypeOverrides === undefined)
    modeCfg.tokenTypeOverrides = {};

  var codeDepth = 0;

  var tokenTypes = {
    header: "header",
    code: "comment",
    quote: "quote",
    list1: "variable-2",
    list2: "variable-3",
    list3: "keyword",
    hr: "hr",
    image: "tag",
    formatting: "formatting",
    linkInline: "link",
    linkEmail: "link",
    linkText: "link",
    linkHref: "string",
    em: "em",
    strong: "strong",
    strikethrough: "strikethrough"
  };

  for (var tokenType in tokenTypes) {
    if (tokenTypes.hasOwnProperty(tokenType) && modeCfg.tokenTypeOverrides[tokenType]) {
      tokenTypes[tokenType] = modeCfg.tokenTypeOverrides[tokenType];
    }
  }

  var hrRE = /^([*\-_])(?:\s*\1){2,}\s*$/
  ,   ulRE = /^[*\-+]\s+/
  ,   olRE = /^[0-9]+([.)])\s+/
  ,   taskListRE = /^\[(x| )\](?=\s)/ // Must follow ulRE or olRE
  ,   atxHeaderRE = modeCfg.allowAtxHeaderWithoutSpace ? /^(#+)/ : /^(#+)(?: |$)/
  ,   setextHeaderRE = /^ *(?:\={1,}|-{1,})\s*$/
  ,   textRE = /^[^#!\[\]*_\\<>` "'(~]+/
  ,   fencedCodeRE = new RegExp("^(" + (modeCfg.fencedCodeBlocks === true ? "~~~+|```+" : modeCfg.fencedCodeBlocks) +
                                ")[ \\t]*([\\w+#]*)");

  function switchInline(stream, state, f) {
    state.f = state.inline = f;
    return f(stream, state);
  }

  function switchBlock(stream, state, f) {
    state.f = state.block = f;
    return f(stream, state);
  }

  function lineIsEmpty(line) {
    return !line || !/\S/.test(line.string)
  }

  // Blocks

  function blankLine(state) {
    // Reset linkTitle state
    state.linkTitle = false;
    // Reset EM state
    state.em = false;
    // Reset STRONG state
    state.strong = false;
    // Reset strikethrough state
    state.strikethrough = false;
    // Reset state.quote
    state.quote = 0;
    // Reset state.indentedCode
    state.indentedCode = false;
    if (!htmlFound && state.f == htmlBlock) {
      state.f = inlineNormal;
      state.block = blockNormal;
    }
    // Reset state.trailingSpace
    state.trailingSpace = 0;
    state.trailingSpaceNewLine = false;
    // Mark this line as blank
    state.prevLine = state.thisLine
    state.thisLine = null
    return null;
  }

  function blockNormal(stream, state) {

    var sol = stream.sol();

    var prevLineIsList = state.list !== false,
        prevLineIsIndentedCode = state.indentedCode;

    state.indentedCode = false;

    if (prevLineIsList) {
      if (state.indentationDiff >= 0) { // Continued list
        if (state.indentationDiff < 4) { // Only adjust indentation if *not* a code block
          state.indentation -= state.indentationDiff;
        }
        state.list = null;
      } else if (state.indentation > 0) {
        state.list = null;
        state.listDepth = Math.floor(state.indentation / 4);
      } else { // No longer a list
        state.list = false;
        state.listDepth = 0;
      }
    }

    var match = null;
    if (state.indentationDiff >= 4) {
      stream.skipToEnd();
      if (prevLineIsIndentedCode || lineIsEmpty(state.prevLine)) {
        state.indentation -= 4;
        state.indentedCode = true;
        return tokenTypes.code;
      } else {
        return null;
      }
    } else if (stream.eatSpace()) {
      return null;
    } else if ((match = stream.match(atxHeaderRE)) && match[1].length <= 6) {
      state.header = match[1].length;
      if (modeCfg.highlightFormatting) state.formatting = "header";
      state.f = state.inline;
      return getType(state);
    } else if (!lineIsEmpty(state.prevLine) && !state.quote && !prevLineIsList &&
               !prevLineIsIndentedCode && (match = stream.match(setextHeaderRE))) {
      state.header = match[0].charAt(0) == '=' ? 1 : 2;
      if (modeCfg.highlightFormatting) state.formatting = "header";
      state.f = state.inline;
      return getType(state);
    } else if (stream.eat('>')) {
      state.quote = sol ? 1 : state.quote + 1;
      if (modeCfg.highlightFormatting) state.formatting = "quote";
      stream.eatSpace();
      return getType(state);
    } else if (stream.peek() === '[') {
      return switchInline(stream, state, footnoteLink);
    } else if (stream.match(hrRE, true)) {
      state.hr = true;
      return tokenTypes.hr;
    } else if ((lineIsEmpty(state.prevLine) || prevLineIsList) && (stream.match(ulRE, false) || stream.match(olRE, false))) {
      var listType = null;
      if (stream.match(ulRE, true)) {
        listType = 'ul';
      } else {
        stream.match(olRE, true);
        listType = 'ol';
      }
      state.indentation = stream.column() + stream.current().length;
      state.list = true;
      state.listDepth++;
      if (modeCfg.taskLists && stream.match(taskListRE, false)) {
        state.taskList = true;
      }
      state.f = state.inline;
      if (modeCfg.highlightFormatting) state.formatting = ["list", "list-" + listType];
      return getType(state);
    } else if (modeCfg.fencedCodeBlocks && (match = stream.match(fencedCodeRE, true))) {
      state.fencedChars = match[1]
      // try switching mode
      state.localMode = getMode(match[2]);
      if (state.localMode) state.localState = state.localMode.startState();
      state.f = state.block = local;
      if (modeCfg.highlightFormatting) state.formatting = "code-block";
      state.code = true;
      return getType(state);
    }

    return switchInline(stream, state, state.inline);
  }

  function htmlBlock(stream, state) {
    var style = htmlMode.token(stream, state.htmlState);
    if ((htmlFound && state.htmlState.tagStart === null &&
         (!state.htmlState.context && state.htmlState.tokenize.isInText)) ||
        (state.md_inside && stream.current().indexOf(">") > -1)) {
      state.f = inlineNormal;
      state.block = blockNormal;
      state.htmlState = null;
    }
    return style;
  }

  function local(stream, state) {
    if (stream.sol() && state.fencedChars && stream.match(state.fencedChars, false)) {
      state.localMode = state.localState = null;
      state.f = state.block = leavingLocal;
      return null;
    } else if (state.localMode) {
      return state.localMode.token(stream, state.localState);
    } else {
      stream.skipToEnd();
      return tokenTypes.code;
    }
  }

  function leavingLocal(stream, state) {
    stream.match(state.fencedChars);
    state.block = blockNormal;
    state.f = inlineNormal;
    state.fencedChars = null;
    if (modeCfg.highlightFormatting) state.formatting = "code-block";
    state.code = true;
    var returnType = getType(state);
    state.code = false;
    return returnType;
  }

  // Inline
  function getType(state) {
    var styles = [];

    if (state.formatting) {
      styles.push(tokenTypes.formatting);

      if (typeof state.formatting === "string") state.formatting = [state.formatting];

      for (var i = 0; i < state.formatting.length; i++) {
        styles.push(tokenTypes.formatting + "-" + state.formatting[i]);

        if (state.formatting[i] === "header") {
          styles.push(tokenTypes.formatting + "-" + state.formatting[i] + "-" + state.header);
        }

        // Add `formatting-quote` and `formatting-quote-#` for blockquotes
        // Add `error` instead if the maximum blockquote nesting depth is passed
        if (state.formatting[i] === "quote") {
          if (!modeCfg.maxBlockquoteDepth || modeCfg.maxBlockquoteDepth >= state.quote) {
            styles.push(tokenTypes.formatting + "-" + state.formatting[i] + "-" + state.quote);
          } else {
            styles.push("error");
          }
        }
      }
    }

    if (state.taskOpen) {
      styles.push("meta");
      return styles.length ? styles.join(' ') : null;
    }
    if (state.taskClosed) {
      styles.push("property");
      return styles.length ? styles.join(' ') : null;
    }

    if (state.linkHref) {
      styles.push(tokenTypes.linkHref, "url");
    } else { // Only apply inline styles to non-url text
      if (state.strong) { styles.push(tokenTypes.strong); }
      if (state.em) { styles.push(tokenTypes.em); }
      if (state.strikethrough) { styles.push(tokenTypes.strikethrough); }
      if (state.linkText) { styles.push(tokenTypes.linkText); }
      if (state.code) { styles.push(tokenTypes.code); }
    }

    if (state.header) { styles.push(tokenTypes.header, tokenTypes.header + "-" + state.header); }

    if (state.quote) {
      styles.push(tokenTypes.quote);

      // Add `quote-#` where the maximum for `#` is modeCfg.maxBlockquoteDepth
      if (!modeCfg.maxBlockquoteDepth || modeCfg.maxBlockquoteDepth >= state.quote) {
        styles.push(tokenTypes.quote + "-" + state.quote);
      } else {
        styles.push(tokenTypes.quote + "-" + modeCfg.maxBlockquoteDepth);
      }
    }

    if (state.list !== false) {
      var listMod = (state.listDepth - 1) % 3;
      if (!listMod) {
        styles.push(tokenTypes.list1);
      } else if (listMod === 1) {
        styles.push(tokenTypes.list2);
      } else {
        styles.push(tokenTypes.list3);
      }
    }

    if (state.trailingSpaceNewLine) {
      styles.push("trailing-space-new-line");
    } else if (state.trailingSpace) {
      styles.push("trailing-space-" + (state.trailingSpace % 2 ? "a" : "b"));
    }

    return styles.length ? styles.join(' ') : null;
  }

  function handleText(stream, state) {
    if (stream.match(textRE, true)) {
      return getType(state);
    }
    return undefined;
  }

  function inlineNormal(stream, state) {
    var style = state.text(stream, state);
    if (typeof style !== 'undefined')
      return style;

    if (state.list) { // List marker (*, +, -, 1., etc)
      state.list = null;
      return getType(state);
    }

    if (state.taskList) {
      var taskOpen = stream.match(taskListRE, true)[1] !== "x";
      if (taskOpen) state.taskOpen = true;
      else state.taskClosed = true;
      if (modeCfg.highlightFormatting) state.formatting = "task";
      state.taskList = false;
      return getType(state);
    }

    state.taskOpen = false;
    state.taskClosed = false;

    if (state.header && stream.match(/^#+$/, true)) {
      if (modeCfg.highlightFormatting) state.formatting = "header";
      return getType(state);
    }

    // Get sol() value now, before character is consumed
    var sol = stream.sol();

    var ch = stream.next();

    if (ch === '\\') {
      stream.next();
      if (modeCfg.highlightFormatting) {
        var type = getType(state);
        var formattingEscape = tokenTypes.formatting + "-escape";
        return type ? type + " " + formattingEscape : formattingEscape;
      }
    }

    // Matches link titles present on next line
    if (state.linkTitle) {
      state.linkTitle = false;
      var matchCh = ch;
      if (ch === '(') {
        matchCh = ')';
      }
      matchCh = (matchCh+'').replace(/([.?*+^$[\]\\(){}|-])/g, "\\$1");
      var regex = '^\\s*(?:[^' + matchCh + '\\\\]+|\\\\\\\\|\\\\.)' + matchCh;
      if (stream.match(new RegExp(regex), true)) {
        return tokenTypes.linkHref;
      }
    }

    // If this block is changed, it may need to be updated in GFM mode
    if (ch === '`') {
      var previousFormatting = state.formatting;
      if (modeCfg.highlightFormatting) state.formatting = "code";
      var t = getType(state);
      var before = stream.pos;
      stream.eatWhile('`');
      var difference = 1 + stream.pos - before;
      if (!state.code) {
        codeDepth = difference;
        state.code = true;
        return getType(state);
      } else {
        if (difference === codeDepth) { // Must be exact
          state.code = false;
          return t;
        }
        state.formatting = previousFormatting;
        return getType(state);
      }
    } else if (state.code) {
      return getType(state);
    }

    if (ch === '!' && stream.match(/\[[^\]]*\] ?(?:\(|\[)/, false)) {
      stream.match(/\[[^\]]*\]/);
      state.inline = state.f = linkHref;
      return tokenTypes.image;
    }

    if (ch === '[' && stream.match(/.*\](\(.*\)| ?\[.*\])/, false)) {
      state.linkText = true;
      if (modeCfg.highlightFormatting) state.formatting = "link";
      return getType(state);
    }

    if (ch === ']' && state.linkText && stream.match(/\(.*\)| ?\[.*\]/, false)) {
      if (modeCfg.highlightFormatting) state.formatting = "link";
      var type = getType(state);
      state.linkText = false;
      state.inline = state.f = linkHref;
      return type;
    }

    if (ch === '<' && stream.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/, false)) {
      state.f = state.inline = linkInline;
      if (modeCfg.highlightFormatting) state.formatting = "link";
      var type = getType(state);
      if (type){
        type += " ";
      } else {
        type = "";
      }
      return type + tokenTypes.linkInline;
    }

    if (ch === '<' && stream.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/, false)) {
      state.f = state.inline = linkInline;
      if (modeCfg.highlightFormatting) state.formatting = "link";
      var type = getType(state);
      if (type){
        type += " ";
      } else {
        type = "";
      }
      return type + tokenTypes.linkEmail;
    }

    if (ch === '<' && stream.match(/^(!--|\w)/, false)) {
      var end = stream.string.indexOf(">", stream.pos);
      if (end != -1) {
        var atts = stream.string.substring(stream.start, end);
        if (/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(atts)) state.md_inside = true;
      }
      stream.backUp(1);
      state.htmlState = CodeMirror.startState(htmlMode);
      return switchBlock(stream, state, htmlBlock);
    }

    if (ch === '<' && stream.match(/^\/\w*?>/)) {
      state.md_inside = false;
      return "tag";
    }

    var ignoreUnderscore = false;
    if (!modeCfg.underscoresBreakWords) {
      if (ch === '_' && stream.peek() !== '_' && stream.match(/(\w)/, false)) {
        var prevPos = stream.pos - 2;
        if (prevPos >= 0) {
          var prevCh = stream.string.charAt(prevPos);
          if (prevCh !== '_' && prevCh.match(/(\w)/, false)) {
            ignoreUnderscore = true;
          }
        }
      }
    }
    if (ch === '*' || (ch === '_' && !ignoreUnderscore)) {
      if (sol && stream.peek() === ' ') {
        // Do nothing, surrounded by newline and space
      } else if (state.strong === ch && stream.eat(ch)) { // Remove STRONG
        if (modeCfg.highlightFormatting) state.formatting = "strong";
        var t = getType(state);
        state.strong = false;
        return t;
      } else if (!state.strong && stream.eat(ch)) { // Add STRONG
        state.strong = ch;
        if (modeCfg.highlightFormatting) state.formatting = "strong";
        return getType(state);
      } else if (state.em === ch) { // Remove EM
        if (modeCfg.highlightFormatting) state.formatting = "em";
        var t = getType(state);
        state.em = false;
        return t;
      } else if (!state.em) { // Add EM
        state.em = ch;
        if (modeCfg.highlightFormatting) state.formatting = "em";
        return getType(state);
      }
    } else if (ch === ' ') {
      if (stream.eat('*') || stream.eat('_')) { // Probably surrounded by spaces
        if (stream.peek() === ' ') { // Surrounded by spaces, ignore
          return getType(state);
        } else { // Not surrounded by spaces, back up pointer
          stream.backUp(1);
        }
      }
    }

    if (modeCfg.strikethrough) {
      if (ch === '~' && stream.eatWhile(ch)) {
        if (state.strikethrough) {// Remove strikethrough
          if (modeCfg.highlightFormatting) state.formatting = "strikethrough";
          var t = getType(state);
          state.strikethrough = false;
          return t;
        } else if (stream.match(/^[^\s]/, false)) {// Add strikethrough
          state.strikethrough = true;
          if (modeCfg.highlightFormatting) state.formatting = "strikethrough";
          return getType(state);
        }
      } else if (ch === ' ') {
        if (stream.match(/^~~/, true)) { // Probably surrounded by space
          if (stream.peek() === ' ') { // Surrounded by spaces, ignore
            return getType(state);
          } else { // Not surrounded by spaces, back up pointer
            stream.backUp(2);
          }
        }
      }
    }

    if (ch === ' ') {
      if (stream.match(/ +$/, false)) {
        state.trailingSpace++;
      } else if (state.trailingSpace) {
        state.trailingSpaceNewLine = true;
      }
    }

    return getType(state);
  }

  function linkInline(stream, state) {
    var ch = stream.next();

    if (ch === ">") {
      state.f = state.inline = inlineNormal;
      if (modeCfg.highlightFormatting) state.formatting = "link";
      var type = getType(state);
      if (type){
        type += " ";
      } else {
        type = "";
      }
      return type + tokenTypes.linkInline;
    }

    stream.match(/^[^>]+/, true);

    return tokenTypes.linkInline;
  }

  function linkHref(stream, state) {
    // Check if space, and return NULL if so (to avoid marking the space)
    if(stream.eatSpace()){
      return null;
    }
    var ch = stream.next();
    if (ch === '(' || ch === '[') {
      state.f = state.inline = getLinkHrefInside(ch === "(" ? ")" : "]");
      if (modeCfg.highlightFormatting) state.formatting = "link-string";
      state.linkHref = true;
      return getType(state);
    }
    return 'error';
  }

  function getLinkHrefInside(endChar) {
    return function(stream, state) {
      var ch = stream.next();

      if (ch === endChar) {
        state.f = state.inline = inlineNormal;
        if (modeCfg.highlightFormatting) state.formatting = "link-string";
        var returnState = getType(state);
        state.linkHref = false;
        return returnState;
      }

      if (stream.match(inlineRE(endChar), true)) {
        stream.backUp(1);
      }

      state.linkHref = true;
      return getType(state);
    };
  }

  function footnoteLink(stream, state) {
    if (stream.match(/^[^\]]*\]:/, false)) {
      state.f = footnoteLinkInside;
      stream.next(); // Consume [
      if (modeCfg.highlightFormatting) state.formatting = "link";
      state.linkText = true;
      return getType(state);
    }
    return switchInline(stream, state, inlineNormal);
  }

  function footnoteLinkInside(stream, state) {
    if (stream.match(/^\]:/, true)) {
      state.f = state.inline = footnoteUrl;
      if (modeCfg.highlightFormatting) state.formatting = "link";
      var returnType = getType(state);
      state.linkText = false;
      return returnType;
    }

    stream.match(/^[^\]]+/, true);

    return tokenTypes.linkText;
  }

  function footnoteUrl(stream, state) {
    // Check if space, and return NULL if so (to avoid marking the space)
    if(stream.eatSpace()){
      return null;
    }
    // Match URL
    stream.match(/^[^\s]+/, true);
    // Check for link title
    if (stream.peek() === undefined) { // End of line, set flag to check next line
      state.linkTitle = true;
    } else { // More content on line, check if link title
      stream.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/, true);
    }
    state.f = state.inline = inlineNormal;
    return tokenTypes.linkHref + " url";
  }

  var savedInlineRE = [];
  function inlineRE(endChar) {
    if (!savedInlineRE[endChar]) {
      // Escape endChar for RegExp (taken from http://stackoverflow.com/a/494122/526741)
      endChar = (endChar+'').replace(/([.?*+^$[\]\\(){}|-])/g, "\\$1");
      // Match any non-endChar, escaped character, as well as the closing
      // endChar.
      savedInlineRE[endChar] = new RegExp('^(?:[^\\\\]|\\\\.)*?(' + endChar + ')');
    }
    return savedInlineRE[endChar];
  }

  var mode = {
    startState: function() {
      return {
        f: blockNormal,

        prevLine: null,
        thisLine: null,

        block: blockNormal,
        htmlState: null,
        indentation: 0,

        inline: inlineNormal,
        text: handleText,

        formatting: false,
        linkText: false,
        linkHref: false,
        linkTitle: false,
        em: false,
        strong: false,
        header: 0,
        hr: false,
        taskList: false,
        list: false,
        listDepth: 0,
        quote: 0,
        trailingSpace: 0,
        trailingSpaceNewLine: false,
        strikethrough: false,
        fencedChars: null
      };
    },

    copyState: function(s) {
      return {
        f: s.f,

        prevLine: s.prevLine,
        thisLine: s.this,

        block: s.block,
        htmlState: s.htmlState && CodeMirror.copyState(htmlMode, s.htmlState),
        indentation: s.indentation,

        localMode: s.localMode,
        localState: s.localMode ? CodeMirror.copyState(s.localMode, s.localState) : null,

        inline: s.inline,
        text: s.text,
        formatting: false,
        linkTitle: s.linkTitle,
        code: s.code,
        em: s.em,
        strong: s.strong,
        strikethrough: s.strikethrough,
        header: s.header,
        hr: s.hr,
        taskList: s.taskList,
        list: s.list,
        listDepth: s.listDepth,
        quote: s.quote,
        indentedCode: s.indentedCode,
        trailingSpace: s.trailingSpace,
        trailingSpaceNewLine: s.trailingSpaceNewLine,
        md_inside: s.md_inside,
        fencedChars: s.fencedChars
      };
    },

    token: function(stream, state) {

      // Reset state.formatting
      state.formatting = false;

      if (stream != state.thisLine) {
        var forceBlankLine = state.header || state.hr;

        // Reset state.header and state.hr
        state.header = 0;
        state.hr = false;

        if (stream.match(/^\s*$/, true) || forceBlankLine) {
          blankLine(state);
          if (!forceBlankLine) return null
          state.prevLine = null
        }

        state.prevLine = state.thisLine
        state.thisLine = stream

        // Reset state.taskList
        state.taskList = false;

        // Reset state.trailingSpace
        state.trailingSpace = 0;
        state.trailingSpaceNewLine = false;

        state.f = state.block;
        var indentation = stream.match(/^\s*/, true)[0].replace(/\t/g, '    ').length;
        var difference = Math.floor((indentation - state.indentation) / 4) * 4;
        if (difference > 4) difference = 4;
        var adjustedIndentation = state.indentation + difference;
        state.indentationDiff = adjustedIndentation - state.indentation;
        state.indentation = adjustedIndentation;
        if (indentation > 0) return null;
      }
      return state.f(stream, state);
    },

    innerMode: function(state) {
      if (state.block == htmlBlock) return {state: state.htmlState, mode: htmlMode};
      if (state.localState) return {state: state.localState, mode: state.localMode};
      return {state: state, mode: mode};
    },

    blankLine: blankLine,

    getType: getType,

    fold: "markdown"
  };
  return mode;
}, "xml");

CodeMirror.defineMIME("text/x-markdown", "markdown");

});

},{"../../lib/codemirror":2,"../meta":6,"../xml/xml":7}],6:[function(require,module,exports){
// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../lib/codemirror"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../lib/codemirror"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
  "use strict";

  CodeMirror.modeInfo = [
    {name: "APL", mime: "text/apl", mode: "apl", ext: ["dyalog", "apl"]},
    {name: "PGP", mimes: ["application/pgp", "application/pgp-keys", "application/pgp-signature"], mode: "asciiarmor", ext: ["pgp"]},
    {name: "ASN.1", mime: "text/x-ttcn-asn", mode: "asn.1", ext: ["asn", "asn1"]},
    {name: "Asterisk", mime: "text/x-asterisk", mode: "asterisk", file: /^extensions\.conf$/i},
    {name: "Brainfuck", mime: "text/x-brainfuck", mode: "brainfuck", ext: ["b", "bf"]},
    {name: "C", mime: "text/x-csrc", mode: "clike", ext: ["c", "h"]},
    {name: "C++", mime: "text/x-c++src", mode: "clike", ext: ["cpp", "c++", "cc", "cxx", "hpp", "h++", "hh", "hxx"], alias: ["cpp"]},
    {name: "Cobol", mime: "text/x-cobol", mode: "cobol", ext: ["cob", "cpy"]},
    {name: "C#", mime: "text/x-csharp", mode: "clike", ext: ["cs"], alias: ["csharp"]},
    {name: "Clojure", mime: "text/x-clojure", mode: "clojure", ext: ["clj"]},
    {name: "Closure Stylesheets (GSS)", mime: "text/x-gss", mode: "css", ext: ["gss"]},
    {name: "CMake", mime: "text/x-cmake", mode: "cmake", ext: ["cmake", "cmake.in"], file: /^CMakeLists.txt$/},
    {name: "CoffeeScript", mime: "text/x-coffeescript", mode: "coffeescript", ext: ["coffee"], alias: ["coffee", "coffee-script"]},
    {name: "Common Lisp", mime: "text/x-common-lisp", mode: "commonlisp", ext: ["cl", "lisp", "el"], alias: ["lisp"]},
    {name: "Cypher", mime: "application/x-cypher-query", mode: "cypher", ext: ["cyp", "cypher"]},
    {name: "Cython", mime: "text/x-cython", mode: "python", ext: ["pyx", "pxd", "pxi"]},
    {name: "CSS", mime: "text/css", mode: "css", ext: ["css"]},
    {name: "CQL", mime: "text/x-cassandra", mode: "sql", ext: ["cql"]},
    {name: "D", mime: "text/x-d", mode: "d", ext: ["d"]},
    {name: "Dart", mimes: ["application/dart", "text/x-dart"], mode: "dart", ext: ["dart"]},
    {name: "diff", mime: "text/x-diff", mode: "diff", ext: ["diff", "patch"]},
    {name: "Django", mime: "text/x-django", mode: "django"},
    {name: "Dockerfile", mime: "text/x-dockerfile", mode: "dockerfile", file: /^Dockerfile$/},
    {name: "DTD", mime: "application/xml-dtd", mode: "dtd", ext: ["dtd"]},
    {name: "Dylan", mime: "text/x-dylan", mode: "dylan", ext: ["dylan", "dyl", "intr"]},
    {name: "EBNF", mime: "text/x-ebnf", mode: "ebnf"},
    {name: "ECL", mime: "text/x-ecl", mode: "ecl", ext: ["ecl"]},
    {name: "Eiffel", mime: "text/x-eiffel", mode: "eiffel", ext: ["e"]},
    {name: "Elm", mime: "text/x-elm", mode: "elm", ext: ["elm"]},
    {name: "Embedded Javascript", mime: "application/x-ejs", mode: "htmlembedded", ext: ["ejs"]},
    {name: "Embedded Ruby", mime: "application/x-erb", mode: "htmlembedded", ext: ["erb"]},
    {name: "Erlang", mime: "text/x-erlang", mode: "erlang", ext: ["erl"]},
    {name: "Factor", mime: "text/x-factor", mode: "factor", ext: ["factor"]},
    {name: "Forth", mime: "text/x-forth", mode: "forth", ext: ["forth", "fth", "4th"]},
    {name: "Fortran", mime: "text/x-fortran", mode: "fortran", ext: ["f", "for", "f77", "f90"]},
    {name: "F#", mime: "text/x-fsharp", mode: "mllike", ext: ["fs"], alias: ["fsharp"]},
    {name: "Gas", mime: "text/x-gas", mode: "gas", ext: ["s"]},
    {name: "Gherkin", mime: "text/x-feature", mode: "gherkin", ext: ["feature"]},
    {name: "GitHub Flavored Markdown", mime: "text/x-gfm", mode: "gfm", file: /^(readme|contributing|history).md$/i},
    {name: "Go", mime: "text/x-go", mode: "go", ext: ["go"]},
    {name: "Groovy", mime: "text/x-groovy", mode: "groovy", ext: ["groovy"]},
    {name: "HAML", mime: "text/x-haml", mode: "haml", ext: ["haml"]},
    {name: "Haskell", mime: "text/x-haskell", mode: "haskell", ext: ["hs"]},
    {name: "Haxe", mime: "text/x-haxe", mode: "haxe", ext: ["hx"]},
    {name: "HXML", mime: "text/x-hxml", mode: "haxe", ext: ["hxml"]},
    {name: "ASP.NET", mime: "application/x-aspx", mode: "htmlembedded", ext: ["aspx"], alias: ["asp", "aspx"]},
    {name: "HTML", mime: "text/html", mode: "htmlmixed", ext: ["html", "htm"], alias: ["xhtml"]},
    {name: "HTTP", mime: "message/http", mode: "http"},
    {name: "IDL", mime: "text/x-idl", mode: "idl", ext: ["pro"]},
    {name: "Jade", mime: "text/x-jade", mode: "jade", ext: ["jade"]},
    {name: "Java", mime: "text/x-java", mode: "clike", ext: ["java"]},
    {name: "Java Server Pages", mime: "application/x-jsp", mode: "htmlembedded", ext: ["jsp"], alias: ["jsp"]},
    {name: "JavaScript", mimes: ["text/javascript", "text/ecmascript", "application/javascript", "application/x-javascript", "application/ecmascript"],
     mode: "javascript", ext: ["js"], alias: ["ecmascript", "js", "node"]},
    {name: "JSON", mimes: ["application/json", "application/x-json"], mode: "javascript", ext: ["json", "map"], alias: ["json5"]},
    {name: "JSON-LD", mime: "application/ld+json", mode: "javascript", ext: ["jsonld"], alias: ["jsonld"]},
    {name: "Jinja2", mime: "null", mode: "jinja2"},
    {name: "Julia", mime: "text/x-julia", mode: "julia", ext: ["jl"]},
    {name: "Kotlin", mime: "text/x-kotlin", mode: "clike", ext: ["kt"]},
    {name: "LESS", mime: "text/x-less", mode: "css", ext: ["less"]},
    {name: "LiveScript", mime: "text/x-livescript", mode: "livescript", ext: ["ls"], alias: ["ls"]},
    {name: "Lua", mime: "text/x-lua", mode: "lua", ext: ["lua"]},
    {name: "Markdown", mime: "text/x-markdown", mode: "markdown", ext: ["markdown", "md", "mkd"]},
    {name: "mIRC", mime: "text/mirc", mode: "mirc"},
    {name: "MariaDB SQL", mime: "text/x-mariadb", mode: "sql"},
    {name: "Mathematica", mime: "text/x-mathematica", mode: "mathematica", ext: ["m", "nb"]},
    {name: "Modelica", mime: "text/x-modelica", mode: "modelica", ext: ["mo"]},
    {name: "MUMPS", mime: "text/x-mumps", mode: "mumps"},
    {name: "MS SQL", mime: "text/x-mssql", mode: "sql"},
    {name: "MySQL", mime: "text/x-mysql", mode: "sql"},
    {name: "Nginx", mime: "text/x-nginx-conf", mode: "nginx", file: /nginx.*\.conf$/i},
    {name: "NSIS", mime: "text/x-nsis", mode: "nsis", ext: ["nsh", "nsi"]},
    {name: "NTriples", mime: "text/n-triples", mode: "ntriples", ext: ["nt"]},
    {name: "Objective C", mime: "text/x-objectivec", mode: "clike", ext: ["m", "mm"]},
    {name: "OCaml", mime: "text/x-ocaml", mode: "mllike", ext: ["ml", "mli", "mll", "mly"]},
    {name: "Octave", mime: "text/x-octave", mode: "octave", ext: ["m"]},
    {name: "Oz", mime: "text/x-oz", mode: "oz", ext: ["oz"]},
    {name: "Pascal", mime: "text/x-pascal", mode: "pascal", ext: ["p", "pas"]},
    {name: "PEG.js", mime: "null", mode: "pegjs", ext: ["jsonld"]},
    {name: "Perl", mime: "text/x-perl", mode: "perl", ext: ["pl", "pm"]},
    {name: "PHP", mime: "application/x-httpd-php", mode: "php", ext: ["php", "php3", "php4", "php5", "phtml"]},
    {name: "Pig", mime: "text/x-pig", mode: "pig", ext: ["pig"]},
    {name: "Plain Text", mime: "text/plain", mode: "null", ext: ["txt", "text", "conf", "def", "list", "log"]},
    {name: "PLSQL", mime: "text/x-plsql", mode: "sql", ext: ["pls"]},
    {name: "Properties files", mime: "text/x-properties", mode: "properties", ext: ["properties", "ini", "in"], alias: ["ini", "properties"]},
    {name: "Python", mime: "text/x-python", mode: "python", ext: ["py", "pyw"]},
    {name: "Puppet", mime: "text/x-puppet", mode: "puppet", ext: ["pp"]},
    {name: "Q", mime: "text/x-q", mode: "q", ext: ["q"]},
    {name: "R", mime: "text/x-rsrc", mode: "r", ext: ["r"], alias: ["rscript"]},
    {name: "reStructuredText", mime: "text/x-rst", mode: "rst", ext: ["rst"], alias: ["rst"]},
    {name: "RPM Changes", mime: "text/x-rpm-changes", mode: "rpm"},
    {name: "RPM Spec", mime: "text/x-rpm-spec", mode: "rpm", ext: ["spec"]},
    {name: "Ruby", mime: "text/x-ruby", mode: "ruby", ext: ["rb"], alias: ["jruby", "macruby", "rake", "rb", "rbx"]},
    {name: "Rust", mime: "text/x-rustsrc", mode: "rust", ext: ["rs"]},
    {name: "Sass", mime: "text/x-sass", mode: "sass", ext: ["sass"]},
    {name: "Scala", mime: "text/x-scala", mode: "clike", ext: ["scala"]},
    {name: "Scheme", mime: "text/x-scheme", mode: "scheme", ext: ["scm", "ss"]},
    {name: "SCSS", mime: "text/x-scss", mode: "css", ext: ["scss"]},
    {name: "Shell", mime: "text/x-sh", mode: "shell", ext: ["sh", "ksh", "bash"], alias: ["bash", "sh", "zsh"], file: /^PKGBUILD$/},
    {name: "Sieve", mime: "application/sieve", mode: "sieve", ext: ["siv", "sieve"]},
    {name: "Slim", mimes: ["text/x-slim", "application/x-slim"], mode: "slim", ext: ["slim"]},
    {name: "Smalltalk", mime: "text/x-stsrc", mode: "smalltalk", ext: ["st"]},
    {name: "Smarty", mime: "text/x-smarty", mode: "smarty", ext: ["tpl"]},
    {name: "Solr", mime: "text/x-solr", mode: "solr"},
    {name: "Soy", mime: "text/x-soy", mode: "soy", ext: ["soy"], alias: ["closure template"]},
    {name: "SPARQL", mime: "application/sparql-query", mode: "sparql", ext: ["rq", "sparql"], alias: ["sparul"]},
    {name: "Spreadsheet", mime: "text/x-spreadsheet", mode: "spreadsheet", alias: ["excel", "formula"]},
    {name: "SQL", mime: "text/x-sql", mode: "sql", ext: ["sql"]},
    {name: "Squirrel", mime: "text/x-squirrel", mode: "clike", ext: ["nut"]},
    {name: "Swift", mime: "text/x-swift", mode: "swift", ext: ["swift"]},
    {name: "MariaDB", mime: "text/x-mariadb", mode: "sql"},
    {name: "sTeX", mime: "text/x-stex", mode: "stex"},
    {name: "LaTeX", mime: "text/x-latex", mode: "stex", ext: ["text", "ltx"], alias: ["tex"]},
    {name: "SystemVerilog", mime: "text/x-systemverilog", mode: "verilog", ext: ["v"]},
    {name: "Tcl", mime: "text/x-tcl", mode: "tcl", ext: ["tcl"]},
    {name: "Textile", mime: "text/x-textile", mode: "textile", ext: ["textile"]},
    {name: "TiddlyWiki ", mime: "text/x-tiddlywiki", mode: "tiddlywiki"},
    {name: "Tiki wiki", mime: "text/tiki", mode: "tiki"},
    {name: "TOML", mime: "text/x-toml", mode: "toml", ext: ["toml"]},
    {name: "Tornado", mime: "text/x-tornado", mode: "tornado"},
    {name: "troff", mime: "troff", mode: "troff", ext: ["1", "2", "3", "4", "5", "6", "7", "8", "9"]},
    {name: "TTCN", mime: "text/x-ttcn", mode: "ttcn", ext: ["ttcn", "ttcn3", "ttcnpp"]},
    {name: "TTCN_CFG", mime: "text/x-ttcn-cfg", mode: "ttcn-cfg", ext: ["cfg"]},
    {name: "Turtle", mime: "text/turtle", mode: "turtle", ext: ["ttl"]},
    {name: "TypeScript", mime: "application/typescript", mode: "javascript", ext: ["ts"], alias: ["ts"]},
    {name: "Twig", mime: "text/x-twig", mode: "twig"},
    {name: "VB.NET", mime: "text/x-vb", mode: "vb", ext: ["vb"]},
    {name: "VBScript", mime: "text/vbscript", mode: "vbscript", ext: ["vbs"]},
    {name: "Velocity", mime: "text/velocity", mode: "velocity", ext: ["vtl"]},
    {name: "Verilog", mime: "text/x-verilog", mode: "verilog", ext: ["v"]},
    {name: "VHDL", mime: "text/x-vhdl", mode: "vhdl", ext: ["vhd", "vhdl"]},
    {name: "XML", mimes: ["application/xml", "text/xml"], mode: "xml", ext: ["xml", "xsl", "xsd"], alias: ["rss", "wsdl", "xsd"]},
    {name: "XQuery", mime: "application/xquery", mode: "xquery", ext: ["xy", "xquery"]},
    {name: "YAML", mime: "text/x-yaml", mode: "yaml", ext: ["yaml", "yml"], alias: ["yml"]},
    {name: "Z80", mime: "text/x-z80", mode: "z80", ext: ["z80"]},
    {name: "mscgen", mime: "text/x-mscgen", mode: "mscgen", ext: ["mscgen", "mscin", "msc"]},
    {name: "xu", mime: "text/x-xu", mode: "mscgen", ext: ["xu"]},
    {name: "msgenny", mime: "text/x-msgenny", mode: "mscgen", ext: ["msgenny"]}
  ];
  // Ensure all modes have a mime property for backwards compatibility
  for (var i = 0; i < CodeMirror.modeInfo.length; i++) {
    var info = CodeMirror.modeInfo[i];
    if (info.mimes) info.mime = info.mimes[0];
  }

  CodeMirror.findModeByMIME = function(mime) {
    mime = mime.toLowerCase();
    for (var i = 0; i < CodeMirror.modeInfo.length; i++) {
      var info = CodeMirror.modeInfo[i];
      if (info.mime == mime) return info;
      if (info.mimes) for (var j = 0; j < info.mimes.length; j++)
        if (info.mimes[j] == mime) return info;
    }
  };

  CodeMirror.findModeByExtension = function(ext) {
    for (var i = 0; i < CodeMirror.modeInfo.length; i++) {
      var info = CodeMirror.modeInfo[i];
      if (info.ext) for (var j = 0; j < info.ext.length; j++)
        if (info.ext[j] == ext) return info;
    }
  };

  CodeMirror.findModeByFileName = function(filename) {
    for (var i = 0; i < CodeMirror.modeInfo.length; i++) {
      var info = CodeMirror.modeInfo[i];
      if (info.file && info.file.test(filename)) return info;
    }
    var dot = filename.lastIndexOf(".");
    var ext = dot > -1 && filename.substring(dot + 1, filename.length);
    if (ext) return CodeMirror.findModeByExtension(ext);
  };

  CodeMirror.findModeByName = function(name) {
    name = name.toLowerCase();
    for (var i = 0; i < CodeMirror.modeInfo.length; i++) {
      var info = CodeMirror.modeInfo[i];
      if (info.name.toLowerCase() == name) return info;
      if (info.alias) for (var j = 0; j < info.alias.length; j++)
        if (info.alias[j].toLowerCase() == name) return info;
    }
  };
});

},{"../lib/codemirror":2}],7:[function(require,module,exports){
// CodeMirror, copyright (c) by Marijn Haverbeke and others
// Distributed under an MIT license: http://codemirror.net/LICENSE

(function(mod) {
  if (typeof exports == "object" && typeof module == "object") // CommonJS
    mod(require("../../lib/codemirror"));
  else if (typeof define == "function" && define.amd) // AMD
    define(["../../lib/codemirror"], mod);
  else // Plain browser env
    mod(CodeMirror);
})(function(CodeMirror) {
"use strict";

CodeMirror.defineMode("xml", function(config, parserConfig) {
  var indentUnit = config.indentUnit;
  var multilineTagIndentFactor = parserConfig.multilineTagIndentFactor || 1;
  var multilineTagIndentPastTag = parserConfig.multilineTagIndentPastTag;
  if (multilineTagIndentPastTag == null) multilineTagIndentPastTag = true;

  var Kludges = parserConfig.htmlMode ? {
    autoSelfClosers: {'area': true, 'base': true, 'br': true, 'col': true, 'command': true,
                      'embed': true, 'frame': true, 'hr': true, 'img': true, 'input': true,
                      'keygen': true, 'link': true, 'meta': true, 'param': true, 'source': true,
                      'track': true, 'wbr': true, 'menuitem': true},
    implicitlyClosed: {'dd': true, 'li': true, 'optgroup': true, 'option': true, 'p': true,
                       'rp': true, 'rt': true, 'tbody': true, 'td': true, 'tfoot': true,
                       'th': true, 'tr': true},
    contextGrabbers: {
      'dd': {'dd': true, 'dt': true},
      'dt': {'dd': true, 'dt': true},
      'li': {'li': true},
      'option': {'option': true, 'optgroup': true},
      'optgroup': {'optgroup': true},
      'p': {'address': true, 'article': true, 'aside': true, 'blockquote': true, 'dir': true,
            'div': true, 'dl': true, 'fieldset': true, 'footer': true, 'form': true,
            'h1': true, 'h2': true, 'h3': true, 'h4': true, 'h5': true, 'h6': true,
            'header': true, 'hgroup': true, 'hr': true, 'menu': true, 'nav': true, 'ol': true,
            'p': true, 'pre': true, 'section': true, 'table': true, 'ul': true},
      'rp': {'rp': true, 'rt': true},
      'rt': {'rp': true, 'rt': true},
      'tbody': {'tbody': true, 'tfoot': true},
      'td': {'td': true, 'th': true},
      'tfoot': {'tbody': true},
      'th': {'td': true, 'th': true},
      'thead': {'tbody': true, 'tfoot': true},
      'tr': {'tr': true}
    },
    doNotIndent: {"pre": true},
    allowUnquoted: true,
    allowMissing: true,
    caseFold: true
  } : {
    autoSelfClosers: {},
    implicitlyClosed: {},
    contextGrabbers: {},
    doNotIndent: {},
    allowUnquoted: false,
    allowMissing: false,
    caseFold: false
  };
  var alignCDATA = parserConfig.alignCDATA;

  // Return variables for tokenizers
  var type, setStyle;

  function inText(stream, state) {
    function chain(parser) {
      state.tokenize = parser;
      return parser(stream, state);
    }

    var ch = stream.next();
    if (ch == "<") {
      if (stream.eat("!")) {
        if (stream.eat("[")) {
          if (stream.match("CDATA[")) return chain(inBlock("atom", "]]>"));
          else return null;
        } else if (stream.match("--")) {
          return chain(inBlock("comment", "-->"));
        } else if (stream.match("DOCTYPE", true, true)) {
          stream.eatWhile(/[\w\._\-]/);
          return chain(doctype(1));
        } else {
          return null;
        }
      } else if (stream.eat("?")) {
        stream.eatWhile(/[\w\._\-]/);
        state.tokenize = inBlock("meta", "?>");
        return "meta";
      } else {
        type = stream.eat("/") ? "closeTag" : "openTag";
        state.tokenize = inTag;
        return "tag bracket";
      }
    } else if (ch == "&") {
      var ok;
      if (stream.eat("#")) {
        if (stream.eat("x")) {
          ok = stream.eatWhile(/[a-fA-F\d]/) && stream.eat(";");
        } else {
          ok = stream.eatWhile(/[\d]/) && stream.eat(";");
        }
      } else {
        ok = stream.eatWhile(/[\w\.\-:]/) && stream.eat(";");
      }
      return ok ? "atom" : "error";
    } else {
      stream.eatWhile(/[^&<]/);
      return null;
    }
  }
  inText.isInText = true;

  function inTag(stream, state) {
    var ch = stream.next();
    if (ch == ">" || (ch == "/" && stream.eat(">"))) {
      state.tokenize = inText;
      type = ch == ">" ? "endTag" : "selfcloseTag";
      return "tag bracket";
    } else if (ch == "=") {
      type = "equals";
      return null;
    } else if (ch == "<") {
      state.tokenize = inText;
      state.state = baseState;
      state.tagName = state.tagStart = null;
      var next = state.tokenize(stream, state);
      return next ? next + " tag error" : "tag error";
    } else if (/[\'\"]/.test(ch)) {
      state.tokenize = inAttribute(ch);
      state.stringStartCol = stream.column();
      return state.tokenize(stream, state);
    } else {
      stream.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/);
      return "word";
    }
  }

  function inAttribute(quote) {
    var closure = function(stream, state) {
      while (!stream.eol()) {
        if (stream.next() == quote) {
          state.tokenize = inTag;
          break;
        }
      }
      return "string";
    };
    closure.isInAttribute = true;
    return closure;
  }

  function inBlock(style, terminator) {
    return function(stream, state) {
      while (!stream.eol()) {
        if (stream.match(terminator)) {
          state.tokenize = inText;
          break;
        }
        stream.next();
      }
      return style;
    };
  }
  function doctype(depth) {
    return function(stream, state) {
      var ch;
      while ((ch = stream.next()) != null) {
        if (ch == "<") {
          state.tokenize = doctype(depth + 1);
          return state.tokenize(stream, state);
        } else if (ch == ">") {
          if (depth == 1) {
            state.tokenize = inText;
            break;
          } else {
            state.tokenize = doctype(depth - 1);
            return state.tokenize(stream, state);
          }
        }
      }
      return "meta";
    };
  }

  function Context(state, tagName, startOfLine) {
    this.prev = state.context;
    this.tagName = tagName;
    this.indent = state.indented;
    this.startOfLine = startOfLine;
    if (Kludges.doNotIndent.hasOwnProperty(tagName) || (state.context && state.context.noIndent))
      this.noIndent = true;
  }
  function popContext(state) {
    if (state.context) state.context = state.context.prev;
  }
  function maybePopContext(state, nextTagName) {
    var parentTagName;
    while (true) {
      if (!state.context) {
        return;
      }
      parentTagName = state.context.tagName;
      if (!Kludges.contextGrabbers.hasOwnProperty(parentTagName) ||
          !Kludges.contextGrabbers[parentTagName].hasOwnProperty(nextTagName)) {
        return;
      }
      popContext(state);
    }
  }

  function baseState(type, stream, state) {
    if (type == "openTag") {
      state.tagStart = stream.column();
      return tagNameState;
    } else if (type == "closeTag") {
      return closeTagNameState;
    } else {
      return baseState;
    }
  }
  function tagNameState(type, stream, state) {
    if (type == "word") {
      state.tagName = stream.current();
      setStyle = "tag";
      return attrState;
    } else {
      setStyle = "error";
      return tagNameState;
    }
  }
  function closeTagNameState(type, stream, state) {
    if (type == "word") {
      var tagName = stream.current();
      if (state.context && state.context.tagName != tagName &&
          Kludges.implicitlyClosed.hasOwnProperty(state.context.tagName))
        popContext(state);
      if (state.context && state.context.tagName == tagName) {
        setStyle = "tag";
        return closeState;
      } else {
        setStyle = "tag error";
        return closeStateErr;
      }
    } else {
      setStyle = "error";
      return closeStateErr;
    }
  }

  function closeState(type, _stream, state) {
    if (type != "endTag") {
      setStyle = "error";
      return closeState;
    }
    popContext(state);
    return baseState;
  }
  function closeStateErr(type, stream, state) {
    setStyle = "error";
    return closeState(type, stream, state);
  }

  function attrState(type, _stream, state) {
    if (type == "word") {
      setStyle = "attribute";
      return attrEqState;
    } else if (type == "endTag" || type == "selfcloseTag") {
      var tagName = state.tagName, tagStart = state.tagStart;
      state.tagName = state.tagStart = null;
      if (type == "selfcloseTag" ||
          Kludges.autoSelfClosers.hasOwnProperty(tagName)) {
        maybePopContext(state, tagName);
      } else {
        maybePopContext(state, tagName);
        state.context = new Context(state, tagName, tagStart == state.indented);
      }
      return baseState;
    }
    setStyle = "error";
    return attrState;
  }
  function attrEqState(type, stream, state) {
    if (type == "equals") return attrValueState;
    if (!Kludges.allowMissing) setStyle = "error";
    return attrState(type, stream, state);
  }
  function attrValueState(type, stream, state) {
    if (type == "string") return attrContinuedState;
    if (type == "word" && Kludges.allowUnquoted) {setStyle = "string"; return attrState;}
    setStyle = "error";
    return attrState(type, stream, state);
  }
  function attrContinuedState(type, stream, state) {
    if (type == "string") return attrContinuedState;
    return attrState(type, stream, state);
  }

  return {
    startState: function() {
      return {tokenize: inText,
              state: baseState,
              indented: 0,
              tagName: null, tagStart: null,
              context: null};
    },

    token: function(stream, state) {
      if (!state.tagName && stream.sol())
        state.indented = stream.indentation();

      if (stream.eatSpace()) return null;
      type = null;
      var style = state.tokenize(stream, state);
      if ((style || type) && style != "comment") {
        setStyle = null;
        state.state = state.state(type || style, stream, state);
        if (setStyle)
          style = setStyle == "error" ? style + " error" : setStyle;
      }
      return style;
    },

    indent: function(state, textAfter, fullLine) {
      var context = state.context;
      // Indent multi-line strings (e.g. css).
      if (state.tokenize.isInAttribute) {
        if (state.tagStart == state.indented)
          return state.stringStartCol + 1;
        else
          return state.indented + indentUnit;
      }
      if (context && context.noIndent) return CodeMirror.Pass;
      if (state.tokenize != inTag && state.tokenize != inText)
        return fullLine ? fullLine.match(/^(\s*)/)[0].length : 0;
      // Indent the starts of attribute names.
      if (state.tagName) {
        if (multilineTagIndentPastTag)
          return state.tagStart + state.tagName.length + 2;
        else
          return state.tagStart + indentUnit * multilineTagIndentFactor;
      }
      if (alignCDATA && /<!\[CDATA\[/.test(textAfter)) return 0;
      var tagAfter = textAfter && /^<(\/)?([\w_:\.-]*)/.exec(textAfter);
      if (tagAfter && tagAfter[1]) { // Closing tag spotted
        while (context) {
          if (context.tagName == tagAfter[2]) {
            context = context.prev;
            break;
          } else if (Kludges.implicitlyClosed.hasOwnProperty(context.tagName)) {
            context = context.prev;
          } else {
            break;
          }
        }
      } else if (tagAfter) { // Opening tag spotted
        while (context) {
          var grabbers = Kludges.contextGrabbers[context.tagName];
          if (grabbers && grabbers.hasOwnProperty(tagAfter[2]))
            context = context.prev;
          else
            break;
        }
      }
      while (context && !context.startOfLine)
        context = context.prev;
      if (context) return context.indent + indentUnit;
      else return 0;
    },

    electricInput: /<\/[\s\w:]+>$/,
    blockCommentStart: "<!--",
    blockCommentEnd: "-->",

    configuration: parserConfig.htmlMode ? "html" : "xml",
    helperType: parserConfig.htmlMode ? "html" : "xml"
  };
});

CodeMirror.defineMIME("text/xml", "xml");
CodeMirror.defineMIME("application/xml", "xml");
if (!CodeMirror.mimeModes.hasOwnProperty("text/html"))
  CodeMirror.defineMIME("text/html", {name: "xml", htmlMode: true});

});

},{"../../lib/codemirror":2}],8:[function(require,module,exports){
var app_1 = require("./app");
(function (StateFlags) {
    StateFlags[StateFlags["COMPLETE"] = 0] = "COMPLETE";
    StateFlags[StateFlags["MOREINFO"] = 1] = "MOREINFO";
    StateFlags[StateFlags["NORESULT"] = 2] = "NORESULT";
})(exports.StateFlags || (exports.StateFlags = {}));
var StateFlags = exports.StateFlags;
// Entry point for NLQP
function parse(queryString) {
    var preTokens = preprocessQueryString(queryString);
    var tokens = formTokens(preTokens);
    var _a = formTree(tokens), tree = _a.tree, context = _a.context;
    var query = formQuery(tree);
    // Figure out the state flags
    var flag;
    if (query.projects.length === 0 && query.terms.length === 0) {
        flag = StateFlags.NORESULT;
    }
    else if (treeComplete(tree)) {
        flag = StateFlags.COMPLETE;
    }
    else {
        flag = StateFlags.MOREINFO;
    }
    return [{ tokens: tokens, tree: tree, context: context, query: query, score: undefined, state: flag }];
}
exports.parse = parse;
// Returns false if any nodes are not marked found
// Returns true if all nodes are marked found
function treeComplete(node) {
    if (node.found === false) {
        return false;
    }
    else {
        var childrenStatus = node.children.map(treeComplete);
        return childrenStatus.every(function (child) { return child === true; });
    }
}
// Performs some transformations to the query string before tokenizing
function preprocessQueryString(queryString) {
    // Add whitespace before commas
    var processedString = queryString.replace(new RegExp(",", 'g'), " , ");
    processedString = processedString.replace(new RegExp(";", 'g'), " ; ");
    processedString = processedString.replace(new RegExp("\\+", 'g'), " + ");
    processedString = processedString.replace(new RegExp("-", 'g'), " - ");
    processedString = processedString.replace(new RegExp("\\*", 'g'), " * ");
    processedString = processedString.replace(new RegExp("/", 'g'), " / ");
    processedString = processedString.replace(new RegExp("\\s+", 'g'), " ");
    // Get parts of speach with sentence information. It's okay if they're wrong; they 
    // will be corrected as we create the tree and match against the underlying data model
    var sentences = nlp.pos(processedString, { dont_combine: true }).sentences;
    // If no sentences were found, don't bother parsing
    if (sentences.length === 0) {
        return [];
    }
    var nlpcTokens = sentences[0].tokens;
    var preTokens = nlpcTokens.map(function (token, i) {
        return { ix: i, text: token.text, tag: token.pos.tag };
    });
    // Group quoted text here
    var quoteStarts = preTokens.filter(function (t) { return t.text.charAt(0) === "\""; });
    var quoteEnds = preTokens.filter(function (t) { return t.text.charAt(t.text.length - 1) === "\""; });
    // If we have balanced quotes, combine tokens
    if (quoteStarts.length === quoteEnds.length) {
        var end, start; // @HACK to get around block scoped variable restriction
        for (var i = 0; i < quoteStarts.length; i++) {
            start = quoteStarts[i];
            end = quoteEnds[i];
            // Get all tokens between quotes (inclusive)
            var quotedTokens = preTokens.filter(function (token) { return token.ix >= start.ix && token.ix <= end.ix; })
                .map(function (token) { return token.text; });
            var quotedText = quotedTokens.join(" ");
            // Remove quotes                           
            quotedText = quotedText.replace(new RegExp("\"", 'g'), "");
            // Create a new pretoken
            var newPreToken = { ix: start.ix, text: quotedText, tag: "NNQ" };
            preTokens.splice(preTokens.indexOf(start), quotedTokens.length, newPreToken);
        }
    }
    return preTokens;
}
exports.preprocessQueryString = preprocessQueryString;
var MajorPartsOfSpeech;
(function (MajorPartsOfSpeech) {
    MajorPartsOfSpeech[MajorPartsOfSpeech["ROOT"] = 0] = "ROOT";
    MajorPartsOfSpeech[MajorPartsOfSpeech["VERB"] = 1] = "VERB";
    MajorPartsOfSpeech[MajorPartsOfSpeech["ADJECTIVE"] = 2] = "ADJECTIVE";
    MajorPartsOfSpeech[MajorPartsOfSpeech["ADVERB"] = 3] = "ADVERB";
    MajorPartsOfSpeech[MajorPartsOfSpeech["NOUN"] = 4] = "NOUN";
    MajorPartsOfSpeech[MajorPartsOfSpeech["VALUE"] = 5] = "VALUE";
    MajorPartsOfSpeech[MajorPartsOfSpeech["GLUE"] = 6] = "GLUE";
    MajorPartsOfSpeech[MajorPartsOfSpeech["WHWORD"] = 7] = "WHWORD";
    MajorPartsOfSpeech[MajorPartsOfSpeech["SYMBOL"] = 8] = "SYMBOL";
})(MajorPartsOfSpeech || (MajorPartsOfSpeech = {}));
var MinorPartsOfSpeech;
(function (MinorPartsOfSpeech) {
    MinorPartsOfSpeech[MinorPartsOfSpeech["ROOT"] = 0] = "ROOT";
    // Verb
    MinorPartsOfSpeech[MinorPartsOfSpeech["VB"] = 1] = "VB";
    MinorPartsOfSpeech[MinorPartsOfSpeech["VBD"] = 2] = "VBD";
    MinorPartsOfSpeech[MinorPartsOfSpeech["VBN"] = 3] = "VBN";
    MinorPartsOfSpeech[MinorPartsOfSpeech["VBP"] = 4] = "VBP";
    MinorPartsOfSpeech[MinorPartsOfSpeech["VBZ"] = 5] = "VBZ";
    MinorPartsOfSpeech[MinorPartsOfSpeech["VBF"] = 6] = "VBF";
    MinorPartsOfSpeech[MinorPartsOfSpeech["CP"] = 7] = "CP";
    MinorPartsOfSpeech[MinorPartsOfSpeech["VBG"] = 8] = "VBG";
    // Adjective
    MinorPartsOfSpeech[MinorPartsOfSpeech["JJ"] = 9] = "JJ";
    MinorPartsOfSpeech[MinorPartsOfSpeech["JJR"] = 10] = "JJR";
    MinorPartsOfSpeech[MinorPartsOfSpeech["JJS"] = 11] = "JJS";
    // Adverb
    MinorPartsOfSpeech[MinorPartsOfSpeech["RB"] = 12] = "RB";
    MinorPartsOfSpeech[MinorPartsOfSpeech["RBR"] = 13] = "RBR";
    MinorPartsOfSpeech[MinorPartsOfSpeech["RBS"] = 14] = "RBS";
    // Noun
    MinorPartsOfSpeech[MinorPartsOfSpeech["NN"] = 15] = "NN";
    MinorPartsOfSpeech[MinorPartsOfSpeech["NNPA"] = 16] = "NNPA";
    MinorPartsOfSpeech[MinorPartsOfSpeech["NNAB"] = 17] = "NNAB";
    MinorPartsOfSpeech[MinorPartsOfSpeech["NG"] = 18] = "NG";
    MinorPartsOfSpeech[MinorPartsOfSpeech["PRP"] = 19] = "PRP";
    MinorPartsOfSpeech[MinorPartsOfSpeech["PP"] = 20] = "PP";
    // Legacy Noun
    MinorPartsOfSpeech[MinorPartsOfSpeech["NNP"] = 21] = "NNP";
    MinorPartsOfSpeech[MinorPartsOfSpeech["NNPS"] = 22] = "NNPS";
    MinorPartsOfSpeech[MinorPartsOfSpeech["NNO"] = 23] = "NNO";
    MinorPartsOfSpeech[MinorPartsOfSpeech["NNS"] = 24] = "NNS";
    MinorPartsOfSpeech[MinorPartsOfSpeech["NNA"] = 25] = "NNA";
    MinorPartsOfSpeech[MinorPartsOfSpeech["NNQ"] = 26] = "NNQ";
    // Glue
    MinorPartsOfSpeech[MinorPartsOfSpeech["FW"] = 27] = "FW";
    MinorPartsOfSpeech[MinorPartsOfSpeech["IN"] = 28] = "IN";
    MinorPartsOfSpeech[MinorPartsOfSpeech["MD"] = 29] = "MD";
    MinorPartsOfSpeech[MinorPartsOfSpeech["CC"] = 30] = "CC";
    MinorPartsOfSpeech[MinorPartsOfSpeech["PDT"] = 31] = "PDT";
    MinorPartsOfSpeech[MinorPartsOfSpeech["DT"] = 32] = "DT";
    MinorPartsOfSpeech[MinorPartsOfSpeech["UH"] = 33] = "UH";
    MinorPartsOfSpeech[MinorPartsOfSpeech["EX"] = 34] = "EX";
    // Value
    MinorPartsOfSpeech[MinorPartsOfSpeech["CD"] = 35] = "CD";
    MinorPartsOfSpeech[MinorPartsOfSpeech["DA"] = 36] = "DA";
    MinorPartsOfSpeech[MinorPartsOfSpeech["NU"] = 37] = "NU";
    // Symbol
    MinorPartsOfSpeech[MinorPartsOfSpeech["LT"] = 38] = "LT";
    MinorPartsOfSpeech[MinorPartsOfSpeech["GT"] = 39] = "GT";
    MinorPartsOfSpeech[MinorPartsOfSpeech["GTE"] = 40] = "GTE";
    MinorPartsOfSpeech[MinorPartsOfSpeech["LTE"] = 41] = "LTE";
    MinorPartsOfSpeech[MinorPartsOfSpeech["EQ"] = 42] = "EQ";
    MinorPartsOfSpeech[MinorPartsOfSpeech["NEQ"] = 43] = "NEQ";
    MinorPartsOfSpeech[MinorPartsOfSpeech["PLUS"] = 44] = "PLUS";
    MinorPartsOfSpeech[MinorPartsOfSpeech["MINUS"] = 45] = "MINUS";
    MinorPartsOfSpeech[MinorPartsOfSpeech["DIV"] = 46] = "DIV";
    MinorPartsOfSpeech[MinorPartsOfSpeech["MUL"] = 47] = "MUL";
    MinorPartsOfSpeech[MinorPartsOfSpeech["SEP"] = 48] = "SEP";
    // Wh- word
    MinorPartsOfSpeech[MinorPartsOfSpeech["WDT"] = 49] = "WDT";
    MinorPartsOfSpeech[MinorPartsOfSpeech["WP"] = 50] = "WP";
    MinorPartsOfSpeech[MinorPartsOfSpeech["WPO"] = 51] = "WPO";
    MinorPartsOfSpeech[MinorPartsOfSpeech["WRB"] = 52] = "WRB"; // Wh-adverb (however whenever where why)
})(MinorPartsOfSpeech || (MinorPartsOfSpeech = {}));
function cloneToken(token) {
    var clone = {
        ix: token.ix,
        originalWord: token.originalWord,
        normalizedWord: token.normalizedWord,
        POS: token.POS,
        properties: [],
    };
    token.properties.map(function (property) { return clone.properties.push(property); });
    return clone;
}
function newToken(word) {
    var token = {
        ix: 0,
        originalWord: word,
        normalizedWord: word,
        POS: MinorPartsOfSpeech.NN,
        properties: [],
    };
    return token;
}
var Properties;
(function (Properties) {
    Properties[Properties["ROOT"] = 0] = "ROOT";
    Properties[Properties["ENTITY"] = 1] = "ENTITY";
    Properties[Properties["COLLECTION"] = 2] = "COLLECTION";
    Properties[Properties["ATTRIBUTE"] = 3] = "ATTRIBUTE";
    Properties[Properties["QUANTITY"] = 4] = "QUANTITY";
    Properties[Properties["PROPER"] = 5] = "PROPER";
    Properties[Properties["PLURAL"] = 6] = "PLURAL";
    Properties[Properties["POSSESSIVE"] = 7] = "POSSESSIVE";
    Properties[Properties["BACKRELATIONSHIP"] = 8] = "BACKRELATIONSHIP";
    Properties[Properties["COMPARATIVE"] = 9] = "COMPARATIVE";
    Properties[Properties["SUPERLATIVE"] = 10] = "SUPERLATIVE";
    Properties[Properties["PRONOUN"] = 11] = "PRONOUN";
    Properties[Properties["SEPARATOR"] = 12] = "SEPARATOR";
    Properties[Properties["CONJUNCTION"] = 13] = "CONJUNCTION";
    Properties[Properties["COMPOUND"] = 14] = "COMPOUND";
    Properties[Properties["QUOTED"] = 15] = "QUOTED";
    Properties[Properties["FUNCTION"] = 16] = "FUNCTION";
    Properties[Properties["GROUPING"] = 17] = "GROUPING";
    Properties[Properties["OUTPUT"] = 18] = "OUTPUT";
    Properties[Properties["INPUT"] = 19] = "INPUT";
    Properties[Properties["NEGATES"] = 20] = "NEGATES";
    Properties[Properties["IMPLICIT"] = 21] = "IMPLICIT";
    Properties[Properties["AGGREGATE"] = 22] = "AGGREGATE";
    Properties[Properties["CALCULATE"] = 23] = "CALCULATE";
    Properties[Properties["OPERATOR"] = 24] = "OPERATOR";
})(Properties || (Properties = {}));
// Finds a given property in a token
function hasProperty(token, property) {
    var found = token.properties.indexOf(property);
    if (found !== -1) {
        return true;
    }
    else {
        return false;
    }
}
// take an input string, extract tokens
function formTokens(preTokens) {
    // Form a token for each word
    var cursorPos = -2;
    var tokens = preTokens.map(function (preToken, i) {
        var word = preToken.text;
        var tag = preToken.tag;
        var token = {
            ix: i + 1,
            originalWord: word,
            normalizedWord: word,
            start: cursorPos += 2,
            end: cursorPos += word.length - 1,
            POS: MinorPartsOfSpeech[tag],
            properties: [],
        };
        var before = "";
        // Add default attribute markers to nouns
        if (token.POS === MinorPartsOfSpeech.NNO ||
            token.POS === MinorPartsOfSpeech.PP) {
            token.properties.push(Properties.POSSESSIVE);
        }
        if (token.POS === MinorPartsOfSpeech.NNP ||
            token.POS === MinorPartsOfSpeech.NNPS ||
            token.POS === MinorPartsOfSpeech.NNPA) {
            token.properties.push(Properties.PROPER);
        }
        if (token.POS === MinorPartsOfSpeech.NNPS ||
            token.POS === MinorPartsOfSpeech.NNS) {
            token.properties.push(Properties.PLURAL);
        }
        if (token.POS === MinorPartsOfSpeech.PP ||
            token.POS === MinorPartsOfSpeech.PRP) {
            token.properties.push(Properties.PRONOUN);
        }
        if (token.POS === MinorPartsOfSpeech.NNQ) {
            token.properties.push(Properties.PROPER);
            token.properties.push(Properties.QUOTED);
        }
        // Add default properties to adjectives and adverbs
        if (token.POS === MinorPartsOfSpeech.JJR || token.POS === MinorPartsOfSpeech.RBR) {
            token.properties.push(Properties.COMPARATIVE);
        }
        else if (token.POS === MinorPartsOfSpeech.JJS || token.POS === MinorPartsOfSpeech.RBS) {
            token.properties.push(Properties.SUPERLATIVE);
        }
        // Add default properties to values
        if (token.POS === MinorPartsOfSpeech.CD ||
            token.POS === MinorPartsOfSpeech.NU) {
            token.properties.push(Properties.QUANTITY);
        }
        // Add default properties to separators
        if (token.POS === MinorPartsOfSpeech.CC) {
            token.properties.push(Properties.CONJUNCTION);
        }
        // normalize the word with the following transformations: 
        // --- strip punctuation
        // --- get rid of possessive ending 
        // --- convert to lower case
        // --- singularize
        // If the word is quoted
        if (token.POS === MinorPartsOfSpeech.NNQ ||
            token.POS === MinorPartsOfSpeech.CD) {
            token.normalizedWord = word;
        }
        else {
            var normalizedWord = word;
            // --- strip punctuation
            normalizedWord = normalizedWord.replace(/\.|\?|\!|/g, '');
            // --- get rid of possessive ending
            before = normalizedWord;
            normalizedWord = normalizedWord.replace(/'s|'$/, '');
            // Heuristic: If the word had a possessive ending, it has to be a possessive noun of some sort      
            if (before !== normalizedWord) {
                if (getMajorPOS(token.POS) !== MajorPartsOfSpeech.NOUN) {
                    token.POS = MinorPartsOfSpeech.NN;
                }
                token.properties.push(Properties.POSSESSIVE);
            }
            // --- convert to lowercase
            before = normalizedWord;
            normalizedWord = normalizedWord.toLowerCase();
            // Heuristic: if the word is not the first word in the sentence and it had capitalization, then it is probably a proper noun
            if (before !== normalizedWord && i !== 0) {
                token.POS = MinorPartsOfSpeech.NNP;
                token.properties.push(Properties.PROPER);
            }
            // --- if the word is a (not proper) noun or verb, singularize
            if ((getMajorPOS(token.POS) === MajorPartsOfSpeech.NOUN || getMajorPOS(token.POS) === MajorPartsOfSpeech.VERB) && !hasProperty(token, Properties.PROPER)) {
                before = normalizedWord;
                normalizedWord = singularize(normalizedWord);
                // Heuristic: If the word changed after singularizing it, then it was plural to begin with
                if (before !== normalizedWord) {
                    token.properties.push(Properties.PLURAL);
                }
            }
            token.normalizedWord = normalizedWord;
        }
        // Heuristic: Special case "in" classified as an adjective. e.g. "the in crowd". This is an uncommon usage
        if (token.normalizedWord === "in" && getMajorPOS(token.POS) === MajorPartsOfSpeech.ADJECTIVE) {
            token.POS = MinorPartsOfSpeech.IN;
        }
        // Heuristic: Special case words with no ambiguous POS that NLPC misclassifies
        switch (token.normalizedWord) {
            case "of":
                token.properties.push(Properties.BACKRELATIONSHIP);
                break;
            case "per":
                token.properties.push(Properties.BACKRELATIONSHIP);
                token.properties.push(Properties.GROUPING);
                break;
            case "all":
                token.POS = MinorPartsOfSpeech.PDT;
                break;
            case "had":
                token.POS = MinorPartsOfSpeech.VBD;
                break;
            case "has":
                token.POS = MinorPartsOfSpeech.VBZ;
                break;
            case "is":
                token.POS = MinorPartsOfSpeech.CP;
                break;
            case "was":
                token.POS = MinorPartsOfSpeech.CP;
                break;
            case "as":
                token.POS = MinorPartsOfSpeech.CP;
                break;
            case "were":
                token.POS = MinorPartsOfSpeech.CP;
                break;
            case "be":
                token.POS = MinorPartsOfSpeech.CP;
                break;
            case "do":
                token.POS = MinorPartsOfSpeech.VBP;
                break;
            case "no":
                token.properties.push(Properties.NEGATES);
                break;
            case "neither":
                token.POS = MinorPartsOfSpeech.CC;
                token.properties.push(Properties.NEGATES);
                break;
            case "nor":
                token.POS = MinorPartsOfSpeech.CC;
                token.properties.push(Properties.NEGATES);
                break;
            case "except":
                token.POS = MinorPartsOfSpeech.CC;
                token.properties.push(Properties.NEGATES);
                break;
            case "without":
                token.POS = MinorPartsOfSpeech.CC;
                token.properties.push(Properties.NEGATES);
                break;
            case "not":
                token.POS = MinorPartsOfSpeech.CC;
                token.properties.push(Properties.NEGATES);
                break;
            case "average":
                token.POS = MinorPartsOfSpeech.NN;
                break;
            case "mean":
                token.POS = MinorPartsOfSpeech.NN;
                break;
            case "their":
                token.properties.push(Properties.PLURAL);
                break;
            case "most":
                token.POS = MinorPartsOfSpeech.JJS;
                token.properties.push(Properties.SUPERLATIVE);
                break;
            case "best":
                token.POS = MinorPartsOfSpeech.JJS;
                token.properties.push(Properties.SUPERLATIVE);
                break;
            case "will":
                // 'will' can be a noun
                if (getMajorPOS(token.POS) !== MajorPartsOfSpeech.NOUN) {
                    token.POS = MinorPartsOfSpeech.MD;
                }
                break;
            case "years":
                token.POS = MinorPartsOfSpeech.NN;
                token.normalizedWord = "year";
                token.properties.push(Properties.PLURAL);
                break;
        }
        // Special case symbols
        switch (token.normalizedWord) {
            case ">":
                token.POS = MinorPartsOfSpeech.GT;
                token.properties.push(Properties.COMPARATIVE);
                break;
            case ">=":
                token.POS = MinorPartsOfSpeech.GTE;
                token.properties.push(Properties.COMPARATIVE);
                break;
            case "<":
                token.POS = MinorPartsOfSpeech.LT;
                token.properties.push(Properties.COMPARATIVE);
                break;
            case "<=":
                token.POS = MinorPartsOfSpeech.LTE;
                token.properties.push(Properties.COMPARATIVE);
                break;
            case "=":
                token.POS = MinorPartsOfSpeech.EQ;
                token.properties.push(Properties.COMPARATIVE);
                break;
            case "!=":
                token.POS = MinorPartsOfSpeech.NEQ;
                token.properties.push(Properties.COMPARATIVE);
                break;
            case "+":
                token.POS = MinorPartsOfSpeech.PLUS;
                token.properties.push(Properties.OPERATOR);
                break;
            case "-":
                token.POS = MinorPartsOfSpeech.MINUS;
                token.properties.push(Properties.OPERATOR);
                break;
            case "*":
                token.POS = MinorPartsOfSpeech.MUL;
                token.properties.push(Properties.OPERATOR);
                break;
            case "/":
                token.POS = MinorPartsOfSpeech.DIV;
                token.properties.push(Properties.OPERATOR);
                break;
            case ",":
                token.POS = MinorPartsOfSpeech.SEP;
                token.properties.push(Properties.SEPARATOR);
                break;
            case ";":
                token.POS = MinorPartsOfSpeech.SEP;
                token.properties.push(Properties.SEPARATOR);
                break;
        }
        token.properties = token.properties.filter(onlyUnique);
        return token;
    });
    // Correct wh- tokens
    for (var _i = 0; _i < tokens.length; _i++) {
        var token = tokens[_i];
        if (token.normalizedWord === "that" ||
            token.normalizedWord === "whatever" ||
            token.normalizedWord === "which") {
            // determiners become wh- determiners
            if (token.POS === MinorPartsOfSpeech.DT) {
                token.POS = MinorPartsOfSpeech.WDT;
            }
            else if (token.POS === MinorPartsOfSpeech.PRP || token.POS === MinorPartsOfSpeech.PP) {
                token.POS = MinorPartsOfSpeech.WP;
            }
            continue;
        }
        // who and whom are wh- pronouns
        if (token.normalizedWord === "who" ||
            token.normalizedWord === "what" ||
            token.normalizedWord === "whom") {
            token.POS = MinorPartsOfSpeech.WP;
            continue;
        }
        // whose is the only wh- possessive pronoun
        if (token.normalizedWord === "whose") {
            token.POS = MinorPartsOfSpeech.WPO;
            token.properties.push(Properties.POSSESSIVE);
            continue;
        }
        // adverbs become wh- adverbs
        if (token.normalizedWord === "how" ||
            token.normalizedWord === "when" ||
            token.normalizedWord === "however" ||
            token.normalizedWord === "whenever" ||
            token.normalizedWord === "where" ||
            token.normalizedWord === "why") {
            token.POS = MinorPartsOfSpeech.WRB;
            continue;
        }
    }
    // Sentence-level POS corrections
    // Heuristic: If there are no verbs in the sentence, there can be no adverbs. Turn them into adjectives
    var verbs = tokens.filter(function (token) { return getMajorPOS(token.POS) === MajorPartsOfSpeech.VERB; });
    if (verbs.length === 0) {
        var adverbs = tokens.filter(function (token) { return getMajorPOS(token.POS) === MajorPartsOfSpeech.ADVERB; });
        adverbs.map(function (adverb) { return adverbToAdjective(adverb); });
    }
    else {
        // Heuristic: Adverbs are located close to verbs
        // Get the distance from each adverb to the closest verb as a percentage of the length of the sentence.
        var adverbs = tokens.filter(function (token) { return getMajorPOS(token.POS) === MajorPartsOfSpeech.ADVERB; });
        adverbs.map(function (adverb) {
            var closestVerb = tokens.length;
            verbs.map(function (verb) {
                var dist = Math.abs(adverb.ix - verb.ix);
                if (dist < closestVerb) {
                    closestVerb = dist;
                }
            });
            var distRatio = closestVerb / tokens.length;
            // Threshold the distance an adverb can be from the verb
            // if it is too far, make it an adjective instead
            if (distRatio > .25) {
                adverbToAdjective(adverb);
            }
        });
    }
    var rootToken = {
        ix: 0,
        originalWord: tokens.map(function (token) { return token.originalWord; }).join(" "),
        normalizedWord: tokens.map(function (token) { return token.normalizedWord; }).join(" "),
        POS: MinorPartsOfSpeech.ROOT,
        properties: [Properties.ROOT],
    };
    tokens = [rootToken].concat(tokens);
    // Link tokens to eachother
    for (var i = 0; i < tokens.length; i++) {
        var token = tokens[i];
        token.prev = tokens[i - 1];
        token.next = tokens[i + 1];
    }
    log(tokenArrayToString(tokens));
    return tokens;
}
function adverbToAdjective(token) {
    var word = token.normalizedWord;
    // Heuristic: Words that end in -est are superlative
    if (word.substr(word.length - 3, word.length) === "est") {
        token.POS = MinorPartsOfSpeech.JJS;
        token.properties.push(Properties.SUPERLATIVE);
    }
    else if (word.substr(word.length - 2, word.length) === "er") {
        token.POS = MinorPartsOfSpeech.JJR;
        token.properties.push(Properties.COMPARATIVE);
    }
    else {
        token.POS = MinorPartsOfSpeech.JJ;
    }
    return token;
}
function getMajorPOS(minorPartOfSpeech) {
    // ROOT
    if (minorPartOfSpeech === MinorPartsOfSpeech.ROOT) {
        return MajorPartsOfSpeech.ROOT;
    }
    // Verb
    if (minorPartOfSpeech === MinorPartsOfSpeech.VB ||
        minorPartOfSpeech === MinorPartsOfSpeech.VBD ||
        minorPartOfSpeech === MinorPartsOfSpeech.VBN ||
        minorPartOfSpeech === MinorPartsOfSpeech.VBP ||
        minorPartOfSpeech === MinorPartsOfSpeech.VBZ ||
        minorPartOfSpeech === MinorPartsOfSpeech.VBF ||
        minorPartOfSpeech === MinorPartsOfSpeech.VBG) {
        return MajorPartsOfSpeech.VERB;
    }
    // Adjective
    if (minorPartOfSpeech === MinorPartsOfSpeech.JJ ||
        minorPartOfSpeech === MinorPartsOfSpeech.JJR ||
        minorPartOfSpeech === MinorPartsOfSpeech.JJS) {
        return MajorPartsOfSpeech.ADJECTIVE;
    }
    // Adjverb
    if (minorPartOfSpeech === MinorPartsOfSpeech.RB ||
        minorPartOfSpeech === MinorPartsOfSpeech.RBR ||
        minorPartOfSpeech === MinorPartsOfSpeech.RBS) {
        return MajorPartsOfSpeech.ADVERB;
    }
    // Noun
    if (minorPartOfSpeech === MinorPartsOfSpeech.NN ||
        minorPartOfSpeech === MinorPartsOfSpeech.NNA ||
        minorPartOfSpeech === MinorPartsOfSpeech.NNPA ||
        minorPartOfSpeech === MinorPartsOfSpeech.NNAB ||
        minorPartOfSpeech === MinorPartsOfSpeech.NNP ||
        minorPartOfSpeech === MinorPartsOfSpeech.NNPS ||
        minorPartOfSpeech === MinorPartsOfSpeech.NNS ||
        minorPartOfSpeech === MinorPartsOfSpeech.NNQ ||
        minorPartOfSpeech === MinorPartsOfSpeech.NNO ||
        minorPartOfSpeech === MinorPartsOfSpeech.NG ||
        minorPartOfSpeech === MinorPartsOfSpeech.PRP ||
        minorPartOfSpeech === MinorPartsOfSpeech.PP) {
        return MajorPartsOfSpeech.NOUN;
    }
    // Value
    if (minorPartOfSpeech === MinorPartsOfSpeech.CD ||
        minorPartOfSpeech === MinorPartsOfSpeech.DA ||
        minorPartOfSpeech === MinorPartsOfSpeech.NU) {
        return MajorPartsOfSpeech.VALUE;
    }
    // Glue
    if (minorPartOfSpeech === MinorPartsOfSpeech.FW ||
        minorPartOfSpeech === MinorPartsOfSpeech.IN ||
        minorPartOfSpeech === MinorPartsOfSpeech.CP ||
        minorPartOfSpeech === MinorPartsOfSpeech.MD ||
        minorPartOfSpeech === MinorPartsOfSpeech.CC ||
        minorPartOfSpeech === MinorPartsOfSpeech.PDT ||
        minorPartOfSpeech === MinorPartsOfSpeech.DT ||
        minorPartOfSpeech === MinorPartsOfSpeech.UH ||
        minorPartOfSpeech === MinorPartsOfSpeech.EX) {
        return MajorPartsOfSpeech.GLUE;
    }
    // Symbol
    if (minorPartOfSpeech === MinorPartsOfSpeech.LT ||
        minorPartOfSpeech === MinorPartsOfSpeech.GT ||
        minorPartOfSpeech === MinorPartsOfSpeech.GTE ||
        minorPartOfSpeech === MinorPartsOfSpeech.LTE ||
        minorPartOfSpeech === MinorPartsOfSpeech.EQ ||
        minorPartOfSpeech === MinorPartsOfSpeech.NEQ ||
        minorPartOfSpeech === MinorPartsOfSpeech.PLUS ||
        minorPartOfSpeech === MinorPartsOfSpeech.MINUS ||
        minorPartOfSpeech === MinorPartsOfSpeech.DIV ||
        minorPartOfSpeech === MinorPartsOfSpeech.MUL ||
        minorPartOfSpeech === MinorPartsOfSpeech.SEP) {
        return MajorPartsOfSpeech.SYMBOL;
    }
    // Wh-Word
    if (minorPartOfSpeech === MinorPartsOfSpeech.WDT ||
        minorPartOfSpeech === MinorPartsOfSpeech.WP ||
        minorPartOfSpeech === MinorPartsOfSpeech.WPO ||
        minorPartOfSpeech === MinorPartsOfSpeech.WRB) {
        return MajorPartsOfSpeech.WHWORD;
    }
}
// Wrap pluralize to special case certain words it gets wrong
function singularize(word) {
    var specialCases = ["his", "times", "has", "downstairs", "united states", "its"];
    for (var _i = 0; _i < specialCases.length; _i++) {
        var specialCase = specialCases[_i];
        if (specialCase === word) {
            return word;
        }
    }
    return pluralize(word, 1);
}
function cloneNode(node) {
    var token = cloneToken(node.token);
    var cloneNode = newNode(token);
    cloneNode.entity = node.entity;
    cloneNode.collection = node.collection;
    cloneNode.attribute = node.attribute;
    cloneNode.fxn = node.fxn;
    cloneNode.found = node.found;
    node.properties.map(function (property) { return cloneNode.properties.push(property); });
    return cloneNode;
}
function newNode(token) {
    var node = {
        ix: token.ix,
        name: token.normalizedWord,
        parent: undefined,
        children: [],
        token: token,
        properties: token.properties,
        found: false,
        hasProperty: hasProperty,
        toString: nodeToString,
        next: nextNode,
        prev: previousNode,
        addChild: addChild,
    };
    token.node = node;
    function hasProperty(property) {
        var found = node.properties.indexOf(property);
        if (found !== -1) {
            return true;
        }
        else {
            return false;
        }
    }
    function nextNode() {
        var token = node.token;
        var nextToken = token.next;
        if (nextToken !== undefined) {
            return nextToken.node;
        }
        return undefined;
    }
    function previousNode() {
        var token = node.token;
        var prevToken = token.prev;
        if (prevToken !== undefined) {
            return prevToken.node;
        }
        return undefined;
    }
    function addChild(newChild) {
        node.children.push(newChild);
        newChild.parent = node;
    }
    function nodeToString(depth) {
        if (depth === undefined) {
            depth = 0;
        }
        var childrenStrings = node.children.map(function (childNode) { return childNode.toString(depth + 1); }).join("\n");
        var children = childrenStrings.length > 0 ? "\n" + childrenStrings : "";
        var indent = Array(depth + 1).join(" ");
        var index = node.ix === undefined ? "+ " : node.ix + ": ";
        var properties = node.properties.length === 0 ? "" : "(" + node.properties.map(function (property) { return Properties[property]; }).join("|") + ")";
        var attribute = node.attribute === undefined ? "" : "[" + node.attribute.variable + " (" + node.attribute.value + ")] ";
        var entity = node.entity === undefined ? "" : "[" + node.entity.displayName + "] ";
        var collection = node.collection === undefined ? "" : "[" + node.collection.displayName + "] ";
        var fxn = node.fxn === undefined ? "" : "[" + node.fxn.name + "] ";
        var negated = node.hasProperty(Properties.NEGATES) ? "!" : "";
        var found = node.found ? "*" : " ";
        var entityOrProperties = found === " " ? "" + properties : "" + negated + fxn + entity + collection + attribute;
        properties = properties.length === 2 ? "" : properties;
        var nodeString = "|" + found + indent + index + node.name + " " + entityOrProperties + children;
        return nodeString;
    }
    return node;
}
//------------------------------------
// Various node manipulation functions
//------------------------------------
// Removes the node and its children from the tree, 
// and makes it a child of the target node
function reroot(node, target) {
    node.parent.children.splice(node.parent.children.indexOf(node), 1);
    target.addChild(node);
}
// Removes a node from the tree
// The node's children get added to its parent
// returns the node or undefined if the operation failed
function removeNode(node) {
    if (node.hasProperty(Properties.ROOT)) {
        return node;
    }
    if (node.parent === undefined && node.children.length === 0) {
        return node;
    }
    var parent = node.parent;
    var children = node.children;
    // Rewire
    parent.children = parent.children.concat(children);
    parent.children.sort(function (a, b) { return a.ix - b.ix; });
    children.map(function (child) { return child.parent = parent; });
    // Get rid of references on current node
    parent.children.splice(parent.children.indexOf(node), 1);
    node.parent = undefined;
    node.children = [];
    return node;
}
// Returns the first ancestor node that has been found
function previouslyMatched(node, ignoreFunctions) {
    if (ignoreFunctions === undefined) {
        ignoreFunctions = false;
    }
    if (node.parent === undefined) {
        return undefined;
    }
    else if (!ignoreFunctions && node.parent.hasProperty(Properties.FUNCTION) && !node.parent.hasProperty(Properties.CONJUNCTION)) {
        return undefined;
    }
    else if (node.parent.hasProperty(Properties.ENTITY) ||
        node.parent.hasProperty(Properties.ATTRIBUTE) ||
        node.parent.hasProperty(Properties.COLLECTION)) {
        return node.parent;
    }
    else {
        return previouslyMatched(node.parent, ignoreFunctions);
    }
}
// Returns the first ancestor node that has been found
function previouslyMatchedEntityOrCollection(node, ignoreFunctions) {
    if (ignoreFunctions === undefined) {
        ignoreFunctions = false;
    }
    if (node.parent === undefined) {
        return undefined;
    }
    else if (!ignoreFunctions && node.parent.hasProperty(Properties.FUNCTION) && !node.parent.hasProperty(Properties.CONJUNCTION)) {
        return undefined;
    }
    else if (node.parent.hasProperty(Properties.ENTITY) ||
        node.parent.hasProperty(Properties.COLLECTION)) {
        return node.parent;
    }
    else {
        return previouslyMatchedEntityOrCollection(node.parent, ignoreFunctions);
    }
}
// Inserts a node after the target, moving all of the
// target's children to the node
// Before: [Target] -> [Children]
// After:  [Target] -> [Node] -> [Children]
function insertAfterNode(node, target) {
    node.parent = target;
    node.children = target.children;
    target.children.map(function (n) { return n.parent = node; });
    target.children = [node];
}
// Find all leaf nodes stemming from a given node
function findLeafNodes(node) {
    if (node.children.length === 0) {
        return [node];
    }
    else {
        var foundLeafs = node.children.map(findLeafNodes);
        var flatLeafs = flattenNestedArray(foundLeafs);
        return flatLeafs;
    }
}
/*function moveNode(node: Node, target: Node): void {
  if (node.hasProperty(Properties.ROOT)) {
    return;
  }
  let parent = node.parent;
  parent.children.splice(parent.children.indexOf(node),1);
  parent.children = parent.children.concat(node.children);
  node.children.map((child) => child.parent = parent);
  node.children = [];
  node.parent = target;
  target.children.push(node);
}*/
// Finds a parent node with the specified property, 
// returns undefined if no node was found
function findParentWithProperty(node, property) {
    if (node.hasProperty(Properties.ROOT)) {
        return undefined;
    }
    if (node.parent.hasProperty(property)) {
        return node.parent;
    }
    else {
        return findParentWithProperty(node.parent, property);
    }
}
// Finds a parent node with the specified property, 
// returns undefined if no node was found
function findChildWithProperty(node, property) {
    if (node.children.length === 0) {
        return undefined;
    }
    if (node.hasProperty(property)) {
        return node;
    }
    else {
        var childrenWithProperty = node.children.filter(function (child) { return child.hasProperty(property); });
        if (childrenWithProperty !== undefined) {
            return childrenWithProperty[0];
        }
        else {
            var results = node.children.map(function (child) { return findChildWithProperty(child, property); }).filter(function (result) { return result !== undefined; });
            if (results.length > 0) {
                return results[0];
            }
        }
    }
}
// Finds a parent node with the specified POS, 
// returns undefined if no node was found
function findParentWithPOS(node, majorPOS) {
    if (getMajorPOS(node.token.POS) === MajorPartsOfSpeech.ROOT) {
        return undefined;
    }
    if (getMajorPOS(node.parent.token.POS) === majorPOS) {
        return node.parent;
    }
    else {
        return findParentWithPOS(node.parent, majorPOS);
    }
}
/*
// Sets node to be a sibling of its parent
// Before: [Grandparent] -> [Parent] -> [Node]
// After:  [Grandparent] -> [Parent]
//                       -> [Node]
function promoteNode(node: Node): void {
  if (node.parent.hasProperty(Properties.ROOT)) {
    return;
  }
  let newSibling = node.parent;
  let newParent = newSibling.parent;
  // Set parent
  node.parent = newParent;
  // Remove node from parent's children
  newSibling.children.splice(newSibling.children.indexOf(node),1);
  // Add node to new parent's children
  newParent.children.push(node);
}*/
// Makes the node's parent a child of the node.
// The node's grandparent is then the node's parent
// Before: [Grandparent] -> [Parent] -> [Node]
// After: [Grandparen] -> [Node] -> [Parent]
function makeParentChild(node) {
    var parent = node.parent;
    // Do not swap with root
    if (parent.hasProperty(Properties.ROOT)) {
        return;
    }
    // Set parents
    node.parent = parent.parent;
    parent.parent = node;
    // Remove node as a child from parent
    parent.children.splice(parent.children.indexOf(node), 1);
    // Set children
    node.children = node.children.concat(parent);
    node.parent.children.push(node);
    node.parent.children.splice(node.parent.children.indexOf(parent), 1);
}
// Swaps a node with its parent. The node's parent
// is then the parent's parent, and its child is the parent.
// The parent gets the node's children
function swapWithParent(node) {
    var parent = node.parent;
    var pparent = parent.parent;
    if (parent.hasProperty(Properties.ROOT)) {
        return;
    }
    parent.parent = node;
    parent.children = node.children;
    pparent.children.splice(pparent.children.indexOf(parent), 1);
    node.parent = pparent;
    node.children = [parent];
    pparent.children.push(node);
}
(function (FunctionTypes) {
    FunctionTypes[FunctionTypes["FILTER"] = 0] = "FILTER";
    FunctionTypes[FunctionTypes["AGGREGATE"] = 1] = "AGGREGATE";
    FunctionTypes[FunctionTypes["BOOLEAN"] = 2] = "BOOLEAN";
    FunctionTypes[FunctionTypes["CALCULATE"] = 3] = "CALCULATE";
})(exports.FunctionTypes || (exports.FunctionTypes = {}));
var FunctionTypes = exports.FunctionTypes;
function newContext() {
    return {
        entities: [],
        collections: [],
        attributes: [],
        fxns: [],
        groupings: [],
        relationships: [],
        maybeEntities: [],
        maybeAttributes: [],
        maybeCollections: [],
        maybeFunctions: [],
        maybeArguments: [],
    };
}
function wordToFunction(word) {
    switch (word) {
        case "taller":
            return { name: ">", type: FunctionTypes.FILTER, attribute: "height", fields: ["a", "b"], project: false };
        case "shorter":
            return { name: "<", type: FunctionTypes.FILTER, attribute: "length", fields: ["a", "b"], project: false };
        case "longer":
            return { name: ">", type: FunctionTypes.FILTER, attribute: "length", fields: ["a", "b"], project: false };
        case "younger":
            return { name: "<", type: FunctionTypes.FILTER, attribute: "age", fields: ["a", "b"], project: false };
        case "&":
        case "and":
            return { name: "and", type: FunctionTypes.BOOLEAN, fields: [], project: false };
        case "or":
            return { name: "or", type: FunctionTypes.BOOLEAN, fields: [], project: false };
        case "total":
        case "sum":
            return { name: "sum", type: FunctionTypes.AGGREGATE, fields: ["sum", "value"], project: true };
        case "average":
        case "avg":
        case "mean":
            return { name: "average", type: FunctionTypes.AGGREGATE, fields: ["average", "value"], project: true };
        case "plus":
        case "add":
        case "+":
            return { name: "+", type: FunctionTypes.CALCULATE, fields: ["result", "a", "b"], project: true };
        case "subtract":
        case "minus":
        case "-":
            return { name: "-", type: FunctionTypes.CALCULATE, fields: ["result", "a", "b"], project: true };
        case "times":
        case "multiply":
        case "multiplied":
        case "*":
            return { name: "*", type: FunctionTypes.CALCULATE, fields: ["result", "a", "b"], project: true };
        case "divide":
        case "divided":
        case "/":
            return { name: "/", type: FunctionTypes.CALCULATE, fields: ["result", "a", "b"], project: true };
        default:
            return undefined;
    }
}
function formTree(tokens) {
    var tree;
    var subsumedNodes = [];
    // Turn tokens into nodes
    var nodes = tokens.filter(function (token) { return token.node === undefined; }).map(newNode);
    // Build ngrams
    // @TODO Build ngrams by largest to smallest so I don't have to sort at the end
    // @HACK also this feels hacky, although it seems right. Maybe there is a better way
    var n = 4;
    var ngrams = [];
    var inode;
    for (var i = 1; i < nodes.length; i++) {
        var insideGrams = [];
        for (var j = 0; j < n; j++) {
            inode = nodes[i + j];
            if (inode === undefined) {
                break;
            }
            if (insideGrams.length === 0) {
                for (var k = j; k < Math.min(n, nodes.length - i); k++) {
                    insideGrams.push([inode]);
                }
            }
            else {
                for (var k = j; k < Math.min(n, nodes.length - i); k++) {
                    var igram = insideGrams[k];
                    igram.push(inode);
                }
            }
        }
        ngrams = ngrams.concat(insideGrams);
    }
    // Sort the ngrams by length
    ngrams.sort(function (b, a) { return a.length - b.length; });
    // Check each ngram for a display name      
    var matchedNgrams = [];
    for (var _i = 0; _i < ngrams.length; _i++) {
        var ngram = ngrams[_i];
        var allFound = ngram.every(function (node) { return node.found; });
        if (allFound !== true) {
            var displayName = ngram.map(function (node) { return node.name; }).join(" ");
            log(displayName);
            var foundName = app_1.eve.findOne("display name", { name: displayName });
            log(foundName);
            // If the display name is in the system, mark all the nodes as found 
            if (foundName !== undefined) {
                ngram.map(function (node) { return node.found = true; });
                matchedNgrams.push(ngram);
            }
        }
    }
    // Turn ngrams into compound nodes
    for (var _a = 0; _a < matchedNgrams.length; _a++) {
        var ngram = matchedNgrams[_a];
        // Don't do anything for 1-grams
        if (ngram.length === 1) {
            ngram[0].found = false;
            continue;
        }
        log(ngram);
        var displayName = ngram.map(function (node) { return node.name; }).join(" ");
        var lastGram = ngram[ngram.length - 1];
        var compoundToken = newToken(displayName);
        var compoundNode = newNode(compoundToken);
        compoundNode.constituents = ngram;
        compoundNode.ix = lastGram.ix;
        // Inherit properties from the nodes
        compoundNode.properties = lastGram.properties;
        // Insert compound node and remove constituent nodes
        nodes.splice(nodes.indexOf(ngram[0]), ngram.length, compoundNode);
    }
    // Do a quick pass to identify functions
    tokens.map(function (token) {
        var node = token.node;
        var fxn = wordToFunction(node.name);
        if (fxn !== undefined) {
            node.fxn = fxn;
            fxn.node = node;
            node.properties.push(Properties.FUNCTION);
            if (node.fxn.type === FunctionTypes.AGGREGATE) {
                node.properties.push(Properties.AGGREGATE);
            }
            else if (node.fxn.type === FunctionTypes.CALCULATE) {
                node.properties.push(Properties.CALCULATE);
            }
        }
    });
    // Link nodes end to end
    nodes.map(function (thisNode, i) {
        var nextNode = nodes[i + 1];
        if (nextNode !== undefined) {
            thisNode.found = false;
            thisNode.addChild(nextNode);
        }
    });
    // At this point we should only have a single root.
    nodes = nodes.filter(function (node) { return node.parent === undefined; });
    tree = nodes.pop();
    function resolveEntities(node, context) {
        var relationship;
        loop0: while (node !== undefined) {
            context.maybeAttributes = context.maybeAttributes.filter(function (maybeAttr) { return !maybeAttr.found; });
            log("------------------------------------------");
            log(node);
            // Handle nodes that we previously found but need to get hooked up to a function
            if (node.found && node.hasProperty(Properties.ATTRIBUTE) && node.children.length === 0 && context.maybeArguments.length > 0) {
                log("Handling missing attribute");
                var argument = context.maybeArguments.shift();
                if (node.parent.hasProperty(Properties.ENTITY) || node.parent.hasProperty(Properties.COLLECTION)) {
                    var parent_1 = removeNode(node.parent);
                    argument.addChild(parent_1);
                    removeNode(node);
                    parent_1.addChild(node);
                    argument.found = true;
                    if (parent_1.collection) {
                        parent_1.collection.project = false;
                    }
                    else {
                        parent_1.entity.project = false;
                    }
                }
                break;
            }
            // Skip certain nodes
            if (node.found ||
                node.hasProperty(Properties.IMPLICIT) ||
                node.hasProperty(Properties.ROOT)) {
                log("Skipping...");
                break;
            }
            // Remove certain nodes
            if (!node.hasProperty(Properties.FUNCTION)) {
                if (node.hasProperty(Properties.SEPARATOR) ||
                    getMajorPOS(node.token.POS) === MajorPartsOfSpeech.WHWORD ||
                    getMajorPOS(node.token.POS) === MajorPartsOfSpeech.GLUE) {
                    log("Removing node \"" + node.name + "\"");
                    node = node.children[0];
                    if (node !== undefined) {
                        var rNode = removeNode(node.parent);
                        if (rNode.hasProperty(Properties.GROUPING)) {
                            node.properties.push(Properties.GROUPING);
                        }
                        if (rNode.hasProperty(Properties.NEGATES)) {
                            node.properties.push(Properties.NEGATES);
                        }
                    }
                    continue;
                }
            }
            // Handle quantities
            if (node.hasProperty(Properties.QUANTITY)) {
                log("Handling quantity...");
                if (isNumeric(node.name) === false) {
                    break;
                }
                // Create an attribute for the quantity 
                var quantityAttribute = {
                    id: node.name,
                    displayName: node.name,
                    value: "" + node.name,
                    variable: "" + node.name,
                    node: node,
                    project: false,
                };
                node.attribute = quantityAttribute;
                node.properties.push(Properties.ATTRIBUTE);
                node.found = true;
                // If there is a maybeArgument, attach the quantity to it
                if (context.maybeArguments.length > 0) {
                    var argument = context.maybeArguments.shift();
                    var qNode = node;
                    node = qNode.children[0];
                    removeNode(qNode);
                    argument.addChild(qNode);
                    argument.found = true;
                    continue;
                }
                break;
            }
            // Handle functions
            if (node.hasProperty(Properties.FUNCTION)) {
                log("Handling function...");
                // Handle comparative functions
                if (node.hasProperty(Properties.COMPARATIVE)) {
                    var attribute = node.fxn.attribute;
                    var compAttrToken = newToken(node.fxn.attribute);
                    compAttrToken.properties.push(Properties.IMPLICIT);
                    var compAttrNode = newNode(compAttrToken);
                    compAttrNode.fxn = node.fxn;
                    // Add two argument nodes
                    var argumentTokenA = newToken("a");
                    var argumentNodeA = newNode(argumentTokenA);
                    argumentNodeA.properties.push(Properties.IMPLICIT);
                    argumentNodeA.properties.push(Properties.INPUT);
                    node.addChild(argumentNodeA);
                    context.maybeArguments.push(argumentNodeA);
                    var argumentTokenB = newToken("b");
                    var argumentNodeB = newNode(argumentTokenB);
                    argumentNodeB.properties.push(Properties.IMPLICIT);
                    argumentNodeB.properties.push(Properties.INPUT);
                    node.addChild(argumentNodeB);
                    context.maybeArguments.push(argumentNodeB);
                    // Find a node for the LHS of the comaparison
                    var matchedNode_1 = previouslyMatched(node);
                    var compAttrNode1 = cloneNode(compAttrNode);
                    relationship = findRelationship(matchedNode_1, compAttrNode1, context);
                    if (relationship.type === RelationshipTypes.DIRECT) {
                        removeNode(matchedNode_1);
                        matchedNode_1.addChild(compAttrNode1);
                        compAttrNode1.attribute.project = false;
                        argumentNodeA.addChild(matchedNode_1);
                        argumentNodeA.found = true;
                        context.maybeArguments.shift();
                    }
                    // Push the RHS attribute onto the context and continue searching
                    context.maybeAttributes.push(compAttrNode);
                    node.found = true;
                }
                else if (node.hasProperty(Properties.AGGREGATE)) {
                    // Add an output token
                    var outputToken = newToken("output");
                    var outputNode = newNode(outputToken);
                    outputNode.found = true;
                    outputNode.properties.push(Properties.IMPLICIT);
                    outputNode.properties.push(Properties.OUTPUT);
                    var outputAttribute = {
                        id: outputNode.name,
                        displayName: outputNode.name,
                        value: node.fxn.name + "|" + outputNode.name,
                        variable: node.fxn.name + "|" + outputNode.name,
                        node: outputNode,
                        project: true,
                    };
                    outputNode.attribute = outputAttribute;
                    node.addChild(outputNode);
                    // Add an input node
                    var argumentToken = newToken("input");
                    var argumentNode = newNode(argumentToken);
                    argumentNode.properties.push(Properties.IMPLICIT);
                    argumentNode.properties.push(Properties.INPUT);
                    node.addChild(argumentNode);
                    context.maybeArguments.push(argumentNode);
                    node.found = true;
                }
                else if (node.hasProperty(Properties.CALCULATE)) {
                    // Create a result node
                    var resultToken = newToken(node.fxn.fields[0]);
                    var resultNode = newNode(resultToken);
                    resultNode.properties.push(Properties.OUTPUT);
                    resultNode.properties.push(Properties.IMPLICIT);
                    var resultAttribute = {
                        id: resultNode.name,
                        displayName: resultNode.name,
                        value: node.fxn.name + "|" + resultNode.name,
                        variable: node.fxn.name + "|" + resultNode.name,
                        node: resultNode,
                        project: true,
                    };
                    resultNode.attribute = resultAttribute;
                    node.addChild(resultNode);
                    resultNode.found = true;
                    // Add two argument nodes
                    var argumentTokenA = newToken("a");
                    var argumentNodeA = newNode(argumentTokenA);
                    argumentNodeA.properties.push(Properties.IMPLICIT);
                    argumentNodeA.properties.push(Properties.INPUT);
                    node.addChild(argumentNodeA);
                    var argumentTokenB = newToken("b");
                    var argumentNodeB = newNode(argumentTokenB);
                    argumentNodeB.properties.push(Properties.IMPLICIT);
                    argumentNodeB.properties.push(Properties.INPUT);
                    node.addChild(argumentNodeB);
                    // If we already found a numerical attribute, rewire it
                    var foundQuantity = findParentWithProperty(node, Properties.QUANTITY);
                    if (foundQuantity !== undefined && foundQuantity.found === true) {
                        removeNode(foundQuantity);
                        argumentNodeA.addChild(foundQuantity);
                        argumentNodeA.found = true;
                        foundQuantity.attribute.project = false;
                        // If the node has an entity, rewire it as a child of the function
                        if (foundQuantity.attribute.entity) {
                            foundQuantity.attribute.entity.project = false;
                        }
                    }
                    else {
                        context.maybeArguments.push(argumentNodeA);
                    }
                    context.maybeArguments.push(argumentNodeB);
                    node.found = true;
                }
                else if (node.hasProperty(Properties.CONJUNCTION)) {
                    node.found = true;
                }
                context.fxns.push(node.fxn);
                log(tree.toString());
                break;
            }
            // Handle pronouns
            if (node.hasProperty(Properties.PRONOUN)) {
                log("Handling pronoun...");
                var matchedNode_2 = previouslyMatchedEntityOrCollection(node, true);
                if (matchedNode_2 !== undefined) {
                    if (matchedNode_2.collection !== undefined) {
                        node.collection = matchedNode_2.collection;
                        node.properties.push(Properties.COLLECTION);
                        node.found = true;
                        log("Found: " + matchedNode_2.name);
                        break;
                    }
                    else if (matchedNode_2.entity !== undefined) {
                        node.entity = matchedNode_2.entity;
                        node.properties.push(Properties.ENTITY);
                        node.found = true;
                        log("Found: " + matchedNode_2.name);
                        break;
                    }
                }
                log("No pronoun match found");
                break;
            }
            // Find the relationship between parent and child nodes
            // Previously matched node
            var matchedNode = previouslyMatched(node);
            if (matchedNode !== undefined) {
                log("Match in context of previously matched node \"" + matchedNode.name + "\"");
                // Find relationship between previously matched node and this one
                if (matchedNode.hasProperty(Properties.POSSESSIVE)) {
                    if (matchedNode.hasProperty(Properties.ENTITY)) {
                        var found = findEntityAttribute(node, matchedNode.entity, context);
                        if (found === true) {
                            relationship = { type: RelationshipTypes.DIRECT };
                        }
                        else {
                            findCollectionOrEntity(node, context);
                        }
                    }
                    else {
                        relationship = findRelationship(matchedNode, node, context);
                    }
                }
                else {
                    findCollectionOrEntity(node, context);
                    relationship = findRelationship(matchedNode, node, context);
                }
            }
            else {
                findCollectionOrEntity(node, context);
                for (var _i = 0, _a = context.maybeAttributes; _i < _a.length; _i++) {
                    var maybeAttr = _a[_i];
                    log("Matching previously unmatched nodes...");
                    relationship = findRelationship(maybeAttr, node, context);
                    // Rewire found attributes
                    if (maybeAttr.found === true) {
                        removeNode(maybeAttr);
                        // If the attr was an implicit attribute derived from a function,
                        // move the node to be a child of the function and reroot the rest of the query
                        if (maybeAttr.hasProperty(Properties.IMPLICIT)) {
                            maybeAttr.attribute.project = false;
                            var thisNode = node;
                            node = node.children[0];
                            if (node !== undefined) {
                                reroot(node, findParentWithProperty(node, Properties.ROOT));
                            }
                            thisNode.addChild(maybeAttr);
                            if (context.maybeArguments.length > 0) {
                                var fxnArgNode = context.maybeArguments.shift();
                                reroot(thisNode, fxnArgNode);
                                fxnArgNode.found = true;
                                continue loop0;
                            }
                        }
                        else {
                            node.addChild(maybeAttr);
                        }
                    }
                }
                ;
            }
            // Rewire node to reflect an argument of a function
            if (node.hasProperty(Properties.ATTRIBUTE) && context.maybeArguments.length > 0) {
                var argument = context.maybeArguments.shift();
                var qNode = node;
                node = qNode.children[0];
                removeNode(qNode);
                argument.addChild(qNode);
                argument.found = true;
                if (qNode.attribute.entity) {
                    qNode.attribute.entity.project = false;
                }
                continue;
            }
            // Rewire nodes to reflect found relationship
            if (relationship !== undefined && relationship.type !== RelationshipTypes.NONE) {
                // For a direct relationship, move the found node to the entity/collection
                if (relationship.type === RelationshipTypes.DIRECT) {
                    if (node.attribute) {
                        var targetNode = void 0;
                        if (node.attribute.collection && node.parent !== node.attribute.collection.node) {
                            targetNode = node.attribute.collection.node;
                        }
                        else if (node.attribute.entity && node.parent !== node.attribute.entity.node) {
                            targetNode = node.attribute.entity.node;
                        }
                        if (targetNode !== undefined) {
                            var rNode = node;
                            node = node.children[0];
                            removeNode(rNode);
                            targetNode.addChild(rNode);
                            continue;
                        }
                    }
                }
                else if (relationship.type === RelationshipTypes.ONEHOP) {
                    log(relationship);
                    if (relationship.nodes[0].collection) {
                        var collection = relationship.nodes[0].collection;
                        var linkID = relationship.links[0];
                        var nCollection = findEveCollection(linkID);
                        if (nCollection !== undefined) {
                            // Create a new link node
                            var token = newToken(nCollection.displayName);
                            var nNode = newNode(token);
                            insertAfterNode(nNode, collection.node);
                            nNode.collection = nCollection;
                            nCollection.node = nNode;
                            context.collections.push(nCollection);
                            // Build a collection attribute to link with parent
                            var collectionAttribute = {
                                id: collection.displayName,
                                displayName: collection.displayName,
                                collection: nCollection,
                                value: "" + collection.displayName,
                                variable: "" + collection.displayName,
                                node: nNode,
                                project: false,
                            };
                            nNode.properties.push(Properties.IMPLICIT);
                            nNode.properties.push(Properties.ATTRIBUTE);
                            nNode.properties.push(Properties.COLLECTION);
                            nNode.attribute = collectionAttribute;
                            context.attributes.push(collectionAttribute);
                            nNode.found = true;
                            nNode.children[0].attribute.collection = nCollection;
                        }
                    }
                    else if (relationship.nodes[0].entity) {
                        var entity = relationship.nodes[0].entity;
                        var linkID = relationship.links[0];
                        var nCollection = findEveCollection(linkID);
                        if (nCollection !== undefined) {
                            // Create a new link node
                            var token = newToken(nCollection.displayName);
                            var nNode = newNode(token);
                            insertAfterNode(nNode, entity.node);
                            nNode.collection = nCollection;
                            nCollection.node = nNode;
                            nNode.properties.push(Properties.IMPLICIT);
                            nNode.properties.push(Properties.ATTRIBUTE);
                            nNode.properties.push(Properties.COLLECTION);
                            nNode.found = true;
                            context.collections.push(nCollection);
                            // Build a collection attribute to link with parent
                            var collectionAttribute = {
                                id: undefined,
                                displayName: nCollection.displayName,
                                collection: nCollection,
                                value: "" + entity.id,
                                variable: "" + entity.displayName,
                                node: nNode,
                                project: false,
                            };
                            nNode.attribute = collectionAttribute;
                            context.attributes.push(collectionAttribute);
                            nNode.children[0].attribute.collection = nCollection;
                        }
                    }
                }
                else if (relationship.type === RelationshipTypes.INTERSECTION) {
                    var _b = relationship.nodes, nodeA = _b[0], nodeB = _b[1];
                    nodeA.collection.variable = nodeB.collection.variable;
                    nodeB.collection.project = false;
                }
            }
            // If no collection or entity has been found, do some work depending on the node
            if (node.found === false && !node.hasProperty(Properties.IMPLICIT)) {
                log("Not found");
                log(context);
                context.maybeAttributes.push(node);
            }
            break;
        }
        // Resolve entities for the children
        if (node !== undefined) {
            node.children.map(function (child) { return resolveEntities(child, context); });
        }
        return context;
    }
    log(tree.toString());
    log("Resolving entities...");
    var context = newContext();
    resolveEntities(tree, context);
    log("Entities resolved!");
    // Rewire groupings and aggregates
    // @TODO Do this in a rewire step
    var aggregate = findChildWithProperty(tree, Properties.AGGREGATE);
    if (aggregate !== undefined) {
        var grouping = findChildWithProperty(aggregate, Properties.GROUPING);
        if (grouping !== undefined) {
            removeNode(grouping);
            insertAfterNode(grouping, aggregate.parent);
        }
    }
    // Sort children to preserve argument order in functions
    function sortChildren(node) {
        node.children.sort(function (a, b) { return a.ix - b.ix; });
        node.children.map(sortChildren);
    }
    sortChildren(tree);
    // Mark root as found
    tree.found = true;
    log(tree.toString());
    return { tree: tree, context: context };
}
function cloneEntity(entity) {
    var clone = {
        id: entity.id,
        displayName: entity.displayName,
        content: entity.content,
        node: entity.node,
        entityAttribute: entity.entityAttribute,
        variable: entity.variable,
        project: entity.project,
    };
    return clone;
}
function cloneCollection(collection) {
    var clone = {
        id: collection.id,
        displayName: collection.displayName,
        count: collection.count,
        node: collection.node,
        variable: collection.variable,
        project: collection.project,
    };
    return clone;
}
// Returns the entity with the given display name.
// If the entity is not found, returns undefined
// Two error modes here: 
// 1) the name is not found in "display name"
// 2) the name is found in "display name" but not found in "entity"
// can 2) ever happen?
// Returns the collection with the given display name.
function findEveEntity(search) {
    log("Searching for entity: " + search);
    var foundEntity;
    var name;
    // Try to find by display name first
    var display = app_1.eve.findOne("display name", { name: search });
    if (display !== undefined) {
        foundEntity = app_1.eve.findOne("entity", { entity: display.id });
        name = search;
    }
    else {
        foundEntity = app_1.eve.findOne("entity", { entity: search });
    }
    // Build the entity
    if (foundEntity !== undefined) {
        if (name === undefined) {
            display = app_1.eve.findOne("display name", { id: search });
            name = display.name;
        }
        var entity = {
            id: foundEntity.entity,
            displayName: name,
            content: foundEntity.content,
            variable: foundEntity.entity,
            entityAttribute: false,
            project: true,
        };
        log(" Found: " + name);
        return entity;
    }
    else {
        log(" Not found: " + search);
        return undefined;
    }
}
exports.findEveEntity = findEveEntity;
// Returns the collection with the given display name.
function findEveCollection(search) {
    log("Searching for collection: " + search);
    var foundCollection;
    var name;
    // Try to find by display name first
    var display = app_1.eve.findOne("display name", { name: search });
    if (display !== undefined) {
        foundCollection = app_1.eve.findOne("collection", { collection: display.id });
        name = search;
    }
    else {
        foundCollection = app_1.eve.findOne("collection", { collection: search });
    }
    // Build the collection
    if (foundCollection !== undefined) {
        if (name === undefined) {
            display = app_1.eve.findOne("display name", { id: search });
            name = display.name;
        }
        var collection = {
            id: foundCollection.collection,
            displayName: name,
            count: foundCollection.count,
            variable: name,
            project: true,
        };
        log(" Found: " + name);
        return collection;
    }
    else {
        log(" Not found: " + search);
        return undefined;
    }
}
// Returns the attribute with the given display name attached to the given entity
// If the entity does not have that attribute, or the entity does not exist, returns undefined
function findEveAttribute(name, entity) {
    log("Searching for attribute: " + name);
    log(" Entity: " + entity.displayName);
    var foundAttribute = app_1.eve.findOne("entity eavs", { entity: entity.id, attribute: name });
    if (foundAttribute !== undefined) {
        var attribute = {
            id: foundAttribute.attribute,
            displayName: name,
            entity: entity,
            value: foundAttribute.value,
            variable: (entity.displayName + "|" + name).replace(/ /g, ''),
            project: true,
        };
        log(" Found: " + name + " " + attribute.variable + " => " + attribute.value);
        log(attribute);
        return attribute;
    }
    log(" Not found: " + name);
    return undefined;
}
var RelationshipTypes;
(function (RelationshipTypes) {
    RelationshipTypes[RelationshipTypes["NONE"] = 0] = "NONE";
    RelationshipTypes[RelationshipTypes["DIRECT"] = 1] = "DIRECT";
    RelationshipTypes[RelationshipTypes["ONEHOP"] = 2] = "ONEHOP";
    RelationshipTypes[RelationshipTypes["TWOHOP"] = 3] = "TWOHOP";
    RelationshipTypes[RelationshipTypes["INTERSECTION"] = 4] = "INTERSECTION";
})(RelationshipTypes || (RelationshipTypes = {}));
function findRelationship(nodeA, nodeB, context) {
    if (nodeA.hasProperty(Properties.QUANTITY) || nodeB.hasProperty(Properties.QUANTITY)) {
        log("Quantities have no relationship to anything else in the system");
        return { type: RelationshipTypes.NONE };
    }
    log("Finding relationship between \"" + nodeA.name + "\" and \"" + nodeB.name + "\"");
    var relationship;
    // If both nodes are Collections, find their relationship
    if (nodeA.hasProperty(Properties.COLLECTION) && nodeB.hasProperty(Properties.COLLECTION)) {
        relationship = findCollectionToCollectionRelationship(nodeA.collection, nodeB.collection);
    }
    else if (nodeA.hasProperty(Properties.COLLECTION) && !(nodeB.hasProperty(Properties.COLLECTION) || nodeB.hasProperty(Properties.ENTITY))) {
        relationship = findCollectionToAttrRelationship(nodeA.collection, nodeB, context);
    }
    else if (nodeB.hasProperty(Properties.COLLECTION) && !(nodeA.hasProperty(Properties.COLLECTION) || nodeA.hasProperty(Properties.ENTITY))) {
        relationship = findCollectionToAttrRelationship(nodeB.collection, nodeA, context);
    }
    else if (nodeA.hasProperty(Properties.COLLECTION) && nodeB.hasProperty(Properties.ENTITY)) {
        relationship = findCollectionToEntRelationship(nodeA.collection, nodeB.entity);
    }
    else if (nodeB.hasProperty(Properties.COLLECTION) && nodeA.hasProperty(Properties.ENTITY)) {
        relationship = findCollectionToEntRelationship(nodeB.collection, nodeA.entity);
    }
    else if (nodeA.hasProperty(Properties.ENTITY) && !(nodeB.hasProperty(Properties.COLLECTION) || nodeB.hasProperty(Properties.ENTITY))) {
        relationship = findEntToAttrRelationship(nodeA.entity, nodeB, context);
    }
    else if (nodeB.hasProperty(Properties.ENTITY) && !(nodeA.hasProperty(Properties.COLLECTION) || nodeA.hasProperty(Properties.ENTITY))) {
        relationship = findEntToAttrRelationship(nodeB.entity, nodeA, context);
    }
    else if (nodeA.hasProperty(Properties.ATTRIBUTE) && !(nodeB.hasProperty(Properties.COLLECTION) || nodeB.hasProperty(Properties.ENTITY))) {
        relationship = findEntToAttrRelationship(nodeA.attribute.entity, nodeB, context);
    }
    else if (nodeB.hasProperty(Properties.ATTRIBUTE) && !(nodeA.hasProperty(Properties.COLLECTION) || nodeA.hasProperty(Properties.ENTITY))) {
        relationship = findEntToAttrRelationship(nodeB.attribute.entity, nodeA, context);
    }
    // If we found a relationship, add it to the context
    if (relationship !== undefined && relationship.type !== RelationshipTypes.NONE) {
        context.relationships.push(relationship);
        return relationship;
    }
    else {
        return { type: RelationshipTypes.NONE };
    }
}
// e.g. "meetings john was in"
function findCollectionToEntRelationship(coll, ent) {
    log("Finding Coll -> Ent relationship between \"" + coll.displayName + "\" and \"" + ent.displayName + "\"...");
    /*if (coll === "collections") {
      if (eve.findOne("collection entities", { entity: ent.id })) {
        return { type: RelationshipTypes.DIRECT };
      }
    }*/
    if (app_1.eve.findOne("collection entities", { collection: coll.id, entity: ent.id })) {
        log("Found Direct relationship");
        return { type: RelationshipTypes.DIRECT };
    }
    var relationship = app_1.eve.query("")
        .select("collection entities", { collection: coll.id }, "collection")
        .select("directionless links", { entity: ["collection", "entity"], link: ent.id }, "links")
        .exec();
    if (relationship.unprojected.length) {
        log("Found One-Hop Relationship");
        return { type: RelationshipTypes.ONEHOP };
    } /*
    // e.g. events with chris granger (events -> meetings -> chris granger)
    let relationships2 = eve.query(``)
      .select("collection entities", { collection: coll }, "collection")
      .select("directionless links", { entity: ["collection", "entity"] }, "links")
      .select("directionless links", { entity: ["links", "link"], link: ent }, "links2")
      .exec();
    if (relationships2.unprojected.length) {
      let entities = extractFromUnprojected(relationships2.unprojected, 1, 3);
      return { type: RelationshipTypes.TWOHOP };
    }*/
    log("No relationship found :(");
    return { type: RelationshipTypes.NONE };
}
function findEntToAttrRelationship(entity, attr, context) {
    log("Finding Ent -> Attr relationship between \"" + entity.displayName + "\" and \"" + attr.name + "\"...");
    // Check for a direct relationship
    // e.g. "Josh's age"
    var found = findEntityAttribute(attr, entity, context);
    if (found === true) {
        return { type: RelationshipTypes.DIRECT };
    }
    // Check for a one-hop relationship
    // e.g. "Salaries in engineering"
    var relationship = app_1.eve.query("")
        .select("directionless links", { entity: entity.id }, "links")
        .select("entity eavs", { entity: ["links", "link"], attribute: attr.name }, "eav")
        .exec();
    if (relationship.unprojected.length) {
        log("Found One-Hop Relationship");
        log(relationship);
        // Find the one-hop link
        var entities = extractFromUnprojected(relationship.unprojected, 0, 2);
        var collections = findCommonCollections(entities);
        var linkID;
        if (collections.length > 0) {
            // @HACK Choose the correct collection in a smart way. 
            // Largest collection other than entity or testdata?
            linkID = collections[0];
        }
        var entityAttribute = {
            id: attr.name,
            displayName: attr.name,
            value: entity.displayName + "|" + attr.name,
            variable: entity.displayName + "|" + attr.name,
            node: attr,
            project: true,
        };
        attr.attribute = entityAttribute;
        context.attributes.push(entityAttribute);
        attr.properties.push(Properties.ATTRIBUTE);
        attr.found = true;
        return { links: [linkID], type: RelationshipTypes.ONEHOP, nodes: [entity.node, attr] };
    }
    /*
    let relationships2 = eve.query(``)
      .select("directionless links", { entity: entity.id }, "links")
      .select("directionless links", { entity: ["links", "link"] }, "links2")
      .select("entity eavs", { entity: ["links2", "link"], attribute: attr }, "eav")
      .exec();
    if (relationships2.unprojected.length) {
      let entities = extractFromUnprojected(relationships2.unprojected, 0, 3);
      let entities2 = extractFromUnprojected(relationships2.unprojected, 1, 3);
      //return { distance: 2, type: RelationshipTypes.ENTITY_ATTRIBUTE, nodes: [findCommonCollections(entities), findCommonCollections(entities2)] };
    }*/
    log("No relationship found :(");
    return { type: RelationshipTypes.NONE };
}
function findCollectionToCollectionRelationship(collA, collB) {
    log("Finding Coll -> Coll relationship between \"" + collA.displayName + "\" and \"" + collB.displayName + "\"...");
    // are there things in both sets?
    var intersection = app_1.eve.query(collA.displayName + "->" + collB.displayName)
        .select("collection entities", { collection: collA.id }, "collA")
        .select("collection entities", { collection: collB.id, entity: ["collA", "entity"] }, "collB")
        .exec();
    // is there a relationship between things in both sets
    var relationships = app_1.eve.query("relationships between " + collA.displayName + " and " + collB.displayName)
        .select("collection entities", { collection: collA.id }, "collA")
        .select("directionless links", { entity: ["collA", "entity"] }, "links")
        .select("collection entities", { collection: collB.id, entity: ["links", "link"] }, "collB")
        .group([["links", "link"]])
        .aggregate("count", {}, "count")
        .project({ type: ["links", "link"], count: ["count", "count"] })
        .exec();
    var maxRel = { count: 0 };
    for (var _i = 0, _a = relationships.results; _i < _a.length; _i++) {
        var result = _a[_i];
        if (result.count > maxRel.count)
            maxRel = result;
    }
    // we divide by two because unprojected results pack rows next to eachother
    // and we have two selects.
    var intersectionSize = intersection.unprojected.length / 2;
    if (maxRel.count > intersectionSize) {
        // @TODO
        return { type: RelationshipTypes.NONE };
    }
    else if (intersectionSize > maxRel.count) {
        return { type: RelationshipTypes.INTERSECTION, nodes: [collA.node, collB.node] };
    }
    else if (maxRel.count === 0 && intersectionSize === 0) {
        return { type: RelationshipTypes.NONE };
    }
    else {
        // @TODO
        return { type: RelationshipTypes.NONE };
    }
}
exports.findCollectionToCollectionRelationship = findCollectionToCollectionRelationship;
function findCollectionToAttrRelationship(coll, attr, context) {
    // Finds a direct relationship between collection and attribute
    // e.g. "pets' lengths"" => pet -> length
    log("Finding Coll -> Attr relationship between \"" + coll.displayName + "\" and \"" + attr.name + "\"...");
    var relationship = app_1.eve.query("")
        .select("collection entities", { collection: coll.id }, "collection")
        .select("entity eavs", { entity: ["collection", "entity"], attribute: attr.name }, "eav")
        .exec();
    if (relationship.unprojected.length > 0) {
        log("Found Direct Relationship");
        var collectionAttribute = {
            id: attr.name,
            displayName: attr.name,
            collection: coll,
            value: coll.displayName + "|" + attr.name,
            variable: coll.displayName + "|" + attr.name,
            node: attr,
            project: true,
        };
        attr.attribute = collectionAttribute;
        context.attributes.push(collectionAttribute);
        attr.properties.push(Properties.ATTRIBUTE);
        attr.found = true;
        return { type: RelationshipTypes.DIRECT, nodes: [coll.node, attr] };
    }
    // Finds a one hop relationship
    // e.g. "department salaries" => department -> employee -> salary
    relationship = app_1.eve.query("")
        .select("collection entities", { collection: coll.id }, "collection")
        .select("directionless links", { entity: ["collection", "entity"] }, "links")
        .select("entity eavs", { entity: ["links", "link"], attribute: attr.name }, "eav")
        .exec();
    if (relationship.unprojected.length > 0) {
        log("Found One-Hop Relationship");
        log(relationship);
        // Find the one-hop link
        var entities = extractFromUnprojected(relationship.unprojected, 1, 3);
        var collections = findCommonCollections(entities);
        var linkID;
        if (collections.length > 0) {
            // @HACK Choose the correct collection in a smart way. 
            // Largest collection other than entity or testdata?
            linkID = collections[0];
        }
        // Build an attribute for the node
        var attribute = {
            id: attr.name,
            displayName: attr.name,
            collection: coll,
            value: coll.displayName + "|" + attr.name,
            variable: coll.displayName + "|" + attr.name,
            node: attr,
            project: true,
        };
        attr.attribute = attribute;
        context.attributes.push(attribute);
        attr.properties.push(Properties.ATTRIBUTE);
        attr.found = true;
        return { links: [linkID], type: RelationshipTypes.ONEHOP, nodes: [coll.node, attr] };
    }
    // Not sure if this one works... using the entity table, a 2 hop link can
    // be found almost anywhere, yielding results like
    // e.g. "Pets heights" => pets -> snake -> entity -> corey -> height
    /*relationship = eve.query(``)
      .select("collection entities", { collection: coll.id }, "collection")
      .select("directionless links", { entity: ["collection", "entity"] }, "links")
      .select("directionless links", { entity: ["links", "link"] }, "links2")
      .select("entity eavs", { entity: ["links2", "link"], attribute: attr }, "eav")
      .exec();
    if (relationship.unprojected.length > 0) {
      return true;
    }*/
    log("No relationship found :(");
    return { type: RelationshipTypes.NONE };
}
// Extracts entities from unprojected results
function extractFromUnprojected(coll, ix, size) {
    var results = [];
    for (var i = 0, len = coll.length; i < len; i += size) {
        results.push(coll[i + ix]["link"]);
    }
    return results;
}
// Find collections that entities have in common
function findCommonCollections(entities) {
    var intersection = entityTocollectionsArray(entities[0]);
    intersection.sort();
    for (var _i = 0, _a = entities.slice(1); _i < _a.length; _i++) {
        var entId = _a[_i];
        var cur = entityTocollectionsArray(entId);
        cur.sort();
        arrayIntersect(intersection, cur);
    }
    intersection.sort(function (a, b) {
        return app_1.eve.findOne("collection", { collection: a })["count"] - app_1.eve.findOne("collection", { collection: b })["count"];
    });
    return intersection;
}
function entityTocollectionsArray(entity) {
    var entities = app_1.eve.find("collection entities", { entity: entity });
    return entities.map(function (a) { return a["collection"]; });
}
function findCollectionAttribute(node, collection, context, relationship) {
    // The attribute is an attribute of members of the collection
    if (relationship.type === RelationshipTypes.DIRECT) {
        var collectionAttribute = {
            id: node.name,
            displayName: node.name,
            collection: collection,
            value: collection.displayName + "|" + node.name,
            variable: collection.displayName + "|" + node.name,
            node: node,
            project: true,
        };
        node.attribute = collectionAttribute;
        context.attributes.push(collectionAttribute);
        node.found = true;
        return true;
    }
    else if (relationship.type === RelationshipTypes.ONEHOP) {
        var linkID = relationship.links[0];
        var nCollection = findEveCollection(linkID);
        if (nCollection !== undefined) {
            // Create a new link node
            var token = {
                ix: 0,
                originalWord: nCollection.displayName,
                normalizedWord: nCollection.displayName,
                POS: MinorPartsOfSpeech.NN,
                properties: [],
            };
            var nNode = newNode(token);
            insertAfterNode(nNode, collection.node);
            nNode.collection = nCollection;
            nCollection.node = nNode;
            context.collections.push(nCollection);
            // Build a collection attribute to link with parent
            var collectionAttribute = {
                id: collection.displayName,
                displayName: collection.displayName,
                collection: nCollection,
                value: "" + collection.displayName,
                variable: "" + collection.displayName,
                node: nNode,
                project: false,
            };
            nNode.attribute = collectionAttribute;
            context.attributes.push(collectionAttribute);
            nNode.found = true;
            // Build an attribute for the referenced node
            var attribute = {
                id: node.name,
                displayName: node.name,
                collection: nCollection,
                value: nCollection.displayName + "|" + node.name,
                variable: nCollection.displayName + "|" + node.name,
                node: node,
                project: true,
            };
            node.attribute = attribute;
            context.attributes.push(attribute);
            node.found = true;
            return true;
        }
        else {
            var entity = findEveEntity(linkID);
            if (entity !== undefined) {
            }
        }
    }
    return false;
}
function findEntityAttribute(node, entity, context) {
    var attribute = findEveAttribute(node.name, entity);
    if (attribute !== undefined) {
        if (isNumeric(attribute.value)) {
            node.properties.push(Properties.QUANTITY);
        }
        context.attributes.push(attribute);
        node.attribute = attribute;
        node.properties.push(Properties.ATTRIBUTE);
        attribute.node = node;
        // If the node is possessive, check to see if it is an entity
        if (node.hasProperty(Properties.POSSESSIVE) || node.hasProperty(Properties.BACKRELATIONSHIP)) {
            var entity_1 = findEveEntity("" + attribute.value);
            if (entity_1 !== undefined) {
                node.entity = entity_1;
                entity_1.variable = attribute.variable;
                entity_1.entityAttribute = true;
                entity_1.node = node;
                node.parent.entity.project = false;
                attribute.project = false;
                context.entities.push(entity_1);
                node.properties.push(Properties.ENTITY);
            }
        }
        node.found = true;
        var entityNode = entity.node;
        return true;
    }
    return false;
}
// searches for a collection first, then tries to find an entity
function findCollectionOrEntity(node, context) {
    var foundCollection = findCollection(node, context);
    if (foundCollection === true) {
        return true;
    }
    else {
        var foundEntity = findEntity(node, context);
        if (foundEntity === true) {
            return true;
        }
    }
    return false;
}
// searches for a collection first, then tries to find an entity
function findEntityOrCollection(node, context) {
    var foundEntity = findEntity(node, context);
    if (foundEntity === true) {
        return true;
    }
    else {
        var foundCollection = findCollection(node, context);
        if (foundCollection === true) {
            return true;
        }
    }
    return false;
}
function findCollection(node, context) {
    var collection = findEveCollection(node.name);
    if (collection !== undefined) {
        context.collections.push(collection);
        collection.node = node;
        node.collection = collection;
        node.found = true;
        node.properties.push(Properties.COLLECTION);
        if (node.hasProperty(Properties.GROUPING)) {
            context.groupings.push(node);
        }
        return true;
    }
    return false;
}
function findEntity(node, context) {
    var entity = findEveEntity(node.name);
    if (entity !== undefined) {
        context.entities.push(entity);
        entity.node = node;
        node.entity = entity;
        node.found = true;
        node.properties.push(Properties.ENTITY);
        if (node.hasProperty(Properties.GROUPING)) {
            context.groupings.push(node);
        }
        return true;
    }
    return false;
}
function negateTerm(term) {
    var negate = newQuery([term]);
    negate.type = "negate";
    return negate;
}
function newQuery(terms, subqueries, projects) {
    if (terms === undefined) {
        terms = [];
    }
    if (subqueries === undefined) {
        subqueries = [];
    }
    if (projects === undefined) {
        projects = [];
    }
    // Dedupe terms
    var termStrings = terms.map(termToString);
    var uniqueTerms = termStrings.map(function (value, index, self) {
        return self.indexOf(value) === index;
    });
    terms = terms.filter(function (term, index) { return uniqueTerms[index]; });
    var query = {
        type: "query",
        terms: terms,
        subqueries: subqueries,
        projects: projects,
        toString: queryToString,
    };
    function queryToString(depth) {
        if (query.terms.length === 0 && query.projects.length === 0) {
            return "";
        }
        if (depth === undefined) {
            depth = 0;
        }
        var indent = Array(depth + 1).join("\t");
        var queryString = indent + "(";
        // Map each term/subquery/project to a string
        var typeString = query.type;
        var termString = query.terms.map(function (term) { return termToString(term, depth + 1); }).join("\n");
        var subqueriesString = query.subqueries.map(function (query) { return query.toString(depth + 1); }).join("\n");
        var projectsString = query.projects.map(function (term) { return termToString(term, depth + 1); }).join("\n");
        // Now compose the query string
        queryString += typeString;
        queryString += termString === "" ? "" : "\n" + termString;
        queryString += subqueriesString === "" ? "" : "\n" + subqueriesString;
        queryString += projectsString === "" ? "" : "\n" + projectsString;
        // Close out the query
        queryString += "\n" + indent + ")";
        return queryString;
    }
    function termToString(term, depth) {
        if (depth === undefined) {
            depth = 0;
        }
        var indent = Array(depth + 1).join("\t");
        var termString = indent + "(";
        termString += term.type + " ";
        termString += "" + (term.table === undefined ? "" : "\"" + term.table + "\" ");
        termString += term.fields.map(function (field) { return (":" + field.name + " " + (field.variable ? field.value : "\"" + field.value + "\"")); }).join(" ");
        termString += ")";
        return termString;
    }
    return query;
}
exports.newQuery = newQuery;
function formQuery(node) {
    var query = newQuery();
    var projectFields = [];
    // Handle the child nodes
    var childQueries = node.children.map(formQuery);
    // Subsume child queries
    var combinedProjectFields = [];
    for (var _i = 0; _i < childQueries.length; _i++) {
        var cQuery = childQueries[_i];
        query.terms = query.terms.concat(cQuery.terms);
        query.subqueries = query.subqueries.concat(cQuery.subqueries);
        // Combine unnamed projects
        for (var _a = 0, _b = cQuery.projects; _a < _b.length; _a++) {
            var project_1 = _b[_a];
            if (project_1.table === undefined) {
                combinedProjectFields = combinedProjectFields.concat(project_1.fields);
            }
        }
    }
    if (combinedProjectFields.length > 0) {
        var project_2 = {
            type: "project!",
            fields: combinedProjectFields,
        };
        query.projects.push(project_2);
    }
    // If the node is a grouping node, stuff the query into a subquery
    // and take its projects
    if (node.hasProperty(Properties.GROUPING)) {
        var subquery = query;
        query = newQuery();
        query.projects = query.projects.concat(subquery.projects);
        subquery.projects = [];
        query.subqueries.push(subquery);
    }
    // Handle the current node
    // Just return at the root
    if (node.hasProperty(Properties.ROOT)) {
        // Reverse the order of fields in the projects
        for (var _c = 0, _d = query.projects; _c < _d.length; _c++) {
            var project_3 = _d[_c];
            project_3.fields = project_3.fields.reverse();
        }
        return query;
    }
    // Handle functions -------------------------------
    if (node.fxn !== undefined) {
        // Skip functions with no arguments
        if (node.fxn.fields.length === 0) {
            return query;
        }
        // Collection all input and output nodes which were found
        var nestedArgs = node.children.filter(function (child) { return (child.hasProperty(Properties.INPUT) || child.hasProperty(Properties.OUTPUT))
            && child.found === true; })
            .map(findLeafNodes);
        var args = flattenNestedArray(nestedArgs);
        // If we have the right number of arguments, proceed
        // @TODO surface an error if the arguments are wrong
        var output;
        if (args.length === node.fxn.fields.length) {
            var fields = args.map(function (arg, i) {
                return { name: "" + node.fxn.fields[i],
                    value: "" + arg.attribute.variable,
                    variable: true };
            });
            var term = {
                type: "select",
                table: node.fxn.name,
                fields: fields,
            };
            // If an aggregate is grouped, we have to push the aggregate into a subquery
            if (node.fxn.type === FunctionTypes.AGGREGATE && query.subqueries.length > 0) {
                var subquery = query.subqueries[0];
                if (subquery !== undefined) {
                    subquery.terms.push(term);
                }
            }
            else {
                query.terms.push(term);
            }
            // project output if necessary
            if (node.fxn.project === true) {
                var outputFields = args.filter(function (arg) { return arg.hasProperty(Properties.OUTPUT); })
                    .map(function (arg) {
                    return { name: "" + node.fxn.name,
                        value: "" + arg.attribute.variable,
                        variable: true };
                });
                projectFields = projectFields.concat(outputFields);
                query.projects = [];
            }
        }
    }
    // Handle attributes -------------------------------
    if (node.attribute !== undefined) {
        var attr = node.attribute;
        var entity = attr.entity;
        var collection = attr.collection;
        var fields = [];
        var entityField;
        // Entity
        if (entity !== undefined) {
            entityField = { name: "entity",
                value: "" + (attr.entity.entityAttribute ? attr.entity.variable : attr.entity.id),
                variable: attr.entity.entityAttribute };
        }
        else if (collection !== undefined) {
            entityField = { name: "entity",
                value: "" + attr.collection.displayName,
                variable: true };
        }
        else {
            return query;
        }
        fields.push(entityField);
        // Attribute
        if (attr.id !== undefined) {
            var attrField = { name: "attribute",
                value: attr.id,
                variable: false };
            fields.push(attrField);
        }
        // Value
        var valueField = { name: "value",
            value: attr.id === undefined ? attr.value : attr.variable,
            variable: attr.id !== undefined };
        fields.push(valueField);
        var term = {
            type: "select",
            table: "entity eavs",
            fields: fields,
        };
        query.terms.push(term);
        // project if necessary
        if (node.attribute.project === true && !node.hasProperty(Properties.NEGATES)) {
            var attributeField = { name: "" + node.attribute.id,
                value: node.attribute.variable,
                variable: true };
            projectFields.push(attributeField);
        }
    }
    // Handle collections -------------------------------
    if (node.collection !== undefined && !node.hasProperty(Properties.PRONOUN)) {
        var entityField = { name: "entity",
            value: node.collection.variable,
            variable: true };
        var collectionField = { name: "collection",
            value: node.collection.id,
            variable: false };
        var term = {
            type: "select",
            table: "is a attributes",
            fields: [entityField, collectionField],
        };
        query.terms.push(term);
        // project if necessary
        if (node.collection.project === true && !node.hasProperty(Properties.NEGATES)) {
            var collectionField_1 = { name: "" + node.collection.displayName.replace(new RegExp(" ", 'g'), ""),
                value: "" + node.collection.variable,
                variable: true };
            projectFields.push(collectionField_1);
        }
    }
    // Handle entities -------------------------------
    if (node.entity !== undefined && !node.hasProperty(Properties.PRONOUN)) {
        // project if necessary
        if (node.entity.project === true) {
            var entityField = { name: "" + node.entity.displayName.replace(new RegExp(" ", 'g'), ""),
                value: "" + (node.entity.entityAttribute ? node.entity.variable : node.entity.id),
                variable: node.entity.entityAttribute };
            projectFields.push(entityField);
        }
    }
    var project = {
        type: "project!",
        fields: projectFields,
    };
    if (node.hasProperty(Properties.NEGATES)) {
        var negatedTerm = query.terms.pop();
        var negatedQuery = negateTerm(negatedTerm);
        query.subqueries.push(negatedQuery);
    }
    query.projects.push(project);
    return query;
}
// ----------------------------------------------------------------------------
// Debug utility functions
// ---------------------------------------------------------------------------- 
var divider = "--------------------------------------------------------------------------------";
exports.debug = false;
function log(x) {
    if (exports.debug) {
        console.log(x);
    }
}
function nodeArrayToString(nodes) {
    var nodeArrayString = nodes.map(function (node) { return node.toString(); }).join("\n" + divider + "\n");
    return divider + "\n" + nodeArrayString + "\n" + divider;
}
exports.nodeArrayToString = nodeArrayToString;
function tokenToString(token) {
    var properties = "(" + token.properties.map(function (property) { return Properties[property]; }).join("|") + ")";
    properties = properties.length === 2 ? "" : properties;
    var tokenSpan = token.start === undefined ? " " : " [" + token.start + "-" + token.end + "] ";
    var tokenString = token.ix + ": " + token.originalWord + " | " + token.normalizedWord + " | " + MajorPartsOfSpeech[getMajorPOS(token.POS)] + " | " + MinorPartsOfSpeech[token.POS] + " | " + properties;
    return tokenString;
}
exports.tokenToString = tokenToString;
function tokenArrayToString(tokens) {
    var tokenArrayString = tokens.map(function (token) { return tokenToString(token); }).join("\n");
    return divider + "\n" + tokenArrayString + "\n" + divider;
}
exports.tokenArrayToString = tokenArrayToString;
// ----------------------------------------------------------------------------
// Utility functions
// ----------------------------------------------------------------------------
function flattenNestedArray(nestedArray) {
    var flattened = [].concat.apply([], nestedArray);
    return flattened;
}
function onlyUnique(value, index, self) {
    return self.indexOf(value) === index;
}
function arrayIntersect(a, b) {
    var ai = 0;
    var bi = 0;
    var result = [];
    while (ai < a.length && bi < b.length) {
        if (a[ai] < b[bi])
            ai++;
        else if (a[ai] > b[bi])
            bi++;
        else {
            result.push(a[ai]);
            ai++;
            bi++;
        }
    }
    return result;
}
function isNumeric(n) {
    return !isNaN(parseFloat(n)) && isFinite(n);
}
window["NLQP"] = exports;

},{"./app":9}],9:[function(require,module,exports){
/// <reference path="microReact.ts" />
/// <reference path="../vendor/marked.d.ts" />
var microReact = require("./microReact");
var runtime = require("./runtime");
var uiRenderer_1 = require("./uiRenderer");
var utils_1 = require("./utils");
exports.syncedTables = ["sourced eav", "view", "action", "action source", "action mapping", "action mapping constant", "action mapping sorted", "action mapping limit"];
exports.eveLocalStorageKey = "eve";
//---------------------------------------------------------
// Renderer
//---------------------------------------------------------
var perfStats;
var perfStatsUi;
var updateStat = 0;
function initRenderer() {
    exports.renderer = new microReact.Renderer();
    exports.uiRenderer = new uiRenderer_1.UIRenderer(exports.eve);
    document.body.appendChild(exports.renderer.content);
    window.addEventListener("resize", render);
    perfStatsUi = document.createElement("div");
    perfStatsUi.id = "perfStats";
    document.body.appendChild(perfStatsUi);
}
if (utils_1.ENV === "browser")
    var performance = window["performance"] || { now: function () { return (new Date()).getTime(); } };
exports.renderRoots = {};
function render() {
    if (!exports.renderer || exports.renderer.queued)
        return;
    exports.renderer.queued = true;
    requestAnimationFrame(function () {
        var stats = {};
        var start = performance.now();
        var trees = [];
        for (var root in exports.renderRoots) {
            trees.push(exports.renderRoots[root]());
        }
        stats.root = (performance.now() - start).toFixed(2);
        if (+stats.root > 10)
            console.info("Slow root: " + stats.root);
        start = performance.now();
        var dynamicUI = exports.eve.find("system ui").map(function (ui) { return ui["template"]; });
        if (utils_1.DEBUG && utils_1.DEBUG.UI_COMPILE) {
            console.info("compiling", dynamicUI);
            console.info("*", exports.uiRenderer.compile(dynamicUI));
        }
        trees.push.apply(trees, exports.uiRenderer.compile(dynamicUI));
        stats.uiCompile = (performance.now() - start).toFixed(2);
        if (+stats.uiCompile > 10)
            console.info("Slow ui compile: " + stats.uiCompile);
        start = performance.now();
        exports.renderer.render(trees);
        stats.render = (performance.now() - start).toFixed(2);
        stats.update = updateStat.toFixed(2);
        perfStatsUi.textContent = "";
        perfStatsUi.textContent += "root: " + stats.root;
        perfStatsUi.textContent += " | ui compile: " + stats.uiCompile;
        perfStatsUi.textContent += " | render: " + stats.render;
        perfStatsUi.textContent += " | update: " + stats.update;
        perfStats = stats;
        exports.renderer.queued = false;
    });
}
exports.render = render;
var storeQueued = false;
function storeLocally() {
    if (storeQueued)
        return;
    storeQueued = true;
    setTimeout(function () {
        var serialized = exports.eve.serialize(true);
        if (exports.eveLocalStorageKey === "eve") {
            for (var _i = 0; _i < exports.syncedTables.length; _i++) {
                var synced = exports.syncedTables[_i];
                delete serialized[synced];
            }
        }
        delete serialized["provenance"];
        localStorage[exports.eveLocalStorageKey] = JSON.stringify(serialized);
        storeQueued = false;
    }, 1000);
}
//---------------------------------------------------------
// Dispatch
//---------------------------------------------------------
var dispatches = {};
function handle(event, func) {
    if (dispatches[event]) {
        console.error("Overwriting handler for '" + event + "'");
    }
    dispatches[event] = func;
}
exports.handle = handle;
function dispatch(event, info, dispatchInfo) {
    var result = dispatchInfo;
    if (!result) {
        result = exports.eve.diff();
        result.meta.render = true;
        result.meta.store = true;
    }
    result.dispatch = function (event, info) {
        return dispatch(event, info, result);
    };
    result.commit = function () {
        var start = performance.now();
        // result.remove("builtin entity", {entity: "render performance statistics"});
        // result.add("builtin entity", {entity: "render performance statistics", content: `
        // # Render performance statistics ({is a: system})
        // root: {root: ${perfStats.root}}
        // ui compile: {ui compile: ${perfStats.uiCompile}}
        // render: {render: ${perfStats.render}}
        // update: {update: ${perfStats.update}}
        // Horrible hack, disregard this: {perf stats: render performance statistics}
        // `});
        if (!runtime.INCREMENTAL) {
            exports.eve.applyDiff(result);
        }
        else {
            exports.eve.applyDiffIncremental(result);
        }
        if (result.meta.render) {
            render();
        }
        if (result.meta.store) {
            storeLocally();
            if (exports.eveLocalStorageKey === "eve") {
                sendChangeSet(result);
            }
        }
        updateStat = performance.now() - start;
    };
    if (!event)
        return result;
    var func = dispatches[event];
    if (!func) {
        console.error("No dispatches for '" + event + "' with " + JSON.stringify(info));
    }
    else {
        func(result, info);
    }
    return result;
}
exports.dispatch = dispatch;
//---------------------------------------------------------
// State
//---------------------------------------------------------
exports.eve = runtime.indexer();
exports.initializers = {};
exports.activeSearches = {};
function init(name, func) {
    exports.initializers[name] = func;
}
exports.init = init;
function executeInitializers() {
    for (var initName in exports.initializers) {
        exports.initializers[initName]();
    }
}
//---------------------------------------------------------
// Websocket
//---------------------------------------------------------
var me = utils_1.uuid();
if (this.localStorage) {
    if (localStorage["me"])
        me = localStorage["me"];
    else
        localStorage["me"] = me;
}
function connectToServer() {
    exports.socket = new WebSocket("ws://" + (window.location.hostname || "localhost") + ":8080");
    exports.socket.onerror = function () {
        console.error("Failed to connect to server, falling back to local storage");
        exports.eveLocalStorageKey = "local-eve";
        executeInitializers();
        render();
    };
    exports.socket.onopen = function () {
        sendServer("connect", me);
    };
    exports.socket.onmessage = function (data) {
        var parsed = JSON.parse(data.data);
        console.log("WS MESSAGE:", parsed);
        if (parsed.kind === "load") {
            // eve.load(parsed.data);
            executeInitializers();
            render();
        }
        else if (parsed.kind === "changeset") {
            var diff = exports.eve.diff();
            diff.tables = parsed.data;
            exports.eve.applyDiff(diff);
            render();
        }
    };
}
function sendServer(messageKind, data) {
    if (!exports.socket)
        return;
    exports.socket.send(JSON.stringify({ kind: messageKind, me: me, time: (new Date).getTime(), data: data }));
}
function sendChangeSet(changeset) {
    if (!exports.socket)
        return;
    var changes = {};
    var send = false;
    for (var _i = 0; _i < exports.syncedTables.length; _i++) {
        var table = exports.syncedTables[_i];
        if (changeset.tables[table]) {
            send = true;
            changes[table] = changeset.tables[table];
        }
    }
    if (send)
        sendServer("changeset", changes);
}
//---------------------------------------------------------
// Go
//---------------------------------------------------------
if (utils_1.ENV === "browser") {
    document.addEventListener("DOMContentLoaded", function (event) {
        initRenderer();
        // connectToServer();
        exports.eveLocalStorageKey = "local-eve";
        executeInitializers();
        render();
    });
}
init("load data", function () {
    var stored = localStorage[exports.eveLocalStorageKey];
    if (stored) {
        exports.eve.load(stored);
    }
});
if (utils_1.ENV === "browser")
    window["app"] = exports;

},{"./microReact":12,"./runtime":15,"./uiRenderer":17,"./utils":19}],10:[function(require,module,exports){
var utils_1 = require("./utils");
var runtime = require("./runtime");
var app = require("./app");
var app_1 = require("./app");
var parser_1 = require("./parser");
var uiRenderer_1 = require("./uiRenderer");
exports.ixer = app_1.eve;
//-----------------------------------------------------------------------------
// Utilities
//-----------------------------------------------------------------------------
// export function UIFromDSL(str:string):UI {
//   function processElem(data:UIElem):UI {
//     let elem = new UI(data.id || uuid());
//     if(data.binding) elem.bind(data.bindingKind === "query" ? parseDSL(data.binding);
//     if(data.embedded) elem.embed(data.embedded);
//     if(data.attributes) elem.attributes(data.attributes);
//     if(data.events) elem.events(data.events);
//     if(data.children) {
//       for(let child of data.children) elem.child(processElem(child));
//     }
//     return elem;
//   }
//   return processElem(parseUI(str));
// }
var BSPhase = (function () {
    function BSPhase(ixer, changeset) {
        if (changeset === void 0) { changeset = ixer.diff(); }
        this.ixer = ixer;
        this.changeset = changeset;
        this._views = {};
        this._viewFields = {};
        this._entities = [];
        this._uis = {};
        this._queries = {};
        this._names = {};
    }
    BSPhase.prototype.viewKind = function (view) {
        return this._views[view];
    };
    BSPhase.prototype.viewFields = function (view) {
        return this._viewFields[view];
    };
    BSPhase.prototype.apply = function (nukeExisting) {
        for (var view in this._views) {
            if (this._views[view] === "table")
                exports.ixer.addTable(view, this._viewFields[view]);
        }
        if (nukeExisting) {
            for (var view in this._views) {
                if (this._views[view] !== "table")
                    this.changeset.merge(runtime.Query.remove(view, this.ixer));
            }
            for (var _i = 0, _a = this._entities; _i < _a.length; _i++) {
                var entity = _a[_i];
                this.changeset.remove("builtin entity", { entity: entity });
            }
            for (var ui in this._uis)
                this.changeset.merge(uiRenderer_1.UI.remove(ui, this.ixer));
        }
        exports.ixer.applyDiff(this.changeset);
    };
    //-----------------------------------------------------------------------------
    // Macros
    //-----------------------------------------------------------------------------
    BSPhase.prototype.addFact = function (table, fact) {
        this.changeset.add(table, fact);
        return this;
    };
    BSPhase.prototype.addEntity = function (entity, name, kinds, attributes, extraContent) {
        entity = utils_1.builtinId(entity);
        this._names[name] = entity;
        this._entities.push(entity);
        this.addFact("display name", { id: entity, name: name });
        var isAs = [];
        for (var _i = 0; _i < kinds.length; _i++) {
            var kind = kinds[_i];
            var sourceId = entity + ",is a," + kind;
            isAs.push("{" + kind + "|rep=link; eav source = " + sourceId + "}");
            var collEntity = utils_1.builtinId(kind);
            this.addFact("display name", { id: collEntity, name: kind });
            this.addFact("sourced eav", { entity: entity, attribute: "is a", value: collEntity, source: sourceId });
        }
        var collectionsText = "";
        if (isAs.length)
            collectionsText = utils_1.titlecase(name) + " is a " + isAs.slice(0, -1).join(", ") + " " + (isAs.length > 1 ? "and" : "") + " " + isAs[isAs.length - 1] + ".";
        var content = (_a = ["\n      #", "\n      ", "\n    "], _a.raw = ["\n      #", "\n      ", "\n    "], utils_1.unpad(6)(_a, name, collectionsText));
        if (attributes) {
            content += "\n##Attributes\n";
            for (var attr in attributes) {
                var sourceId = entity + "," + attr + "," + attributes[attr];
                var query = name + "'s " + attr;
                var queryId = query.replace(" ", "-");
                content += attr + ": {" + query + "|rep=CSV; field=" + attr + "; eav source = " + sourceId + "}\n";
                var value = this._names[attributes[attr]] || attributes[attr];
                this.addFact("sourced eav", { entity: entity, attribute: attr, value: value, source: sourceId });
                var artifacts = parser_1.parseDSL("(query :$$view \"" + queryId + "\"\n                                     (entity-eavs :entity \"" + entity + "\" :attribute \"" + attr + "\" :value v)\n                                     (project! :entity \"" + entity + "\" :" + attr + " v))");
                this.addArtifacts(artifacts);
                this.addFact("query to id", { query: query, id: queryId });
            }
        }
        if (extraContent)
            content += "\n" + extraContent;
        var page = entity + "|root";
        this.addFact("page content", { page: page, content: content });
        this.addFact("entity page", { entity: entity, page: page });
        return this;
        var _a;
    };
    BSPhase.prototype.addView = function (view, kind, fields) {
        this._views[view] = kind;
        this._viewFields[view] = fields;
        this.addFact("view", { view: view, kind: kind });
        for (var _i = 0; _i < fields.length; _i++) {
            var field = fields[_i];
            this.addFact("field", { view: view, field: field });
        }
        var entity = view + " view";
        this.addEntity(entity, entity, ["system", kind], undefined, (_a = ["\n      ## Fields\n      ", "\n    "], _a.raw = ["\n      ## Fields\n      ", "\n    "], utils_1.unpad(6)(_a, fields.map(function (field) { return ("* " + field); }).join("\n      "))));
        return this;
        var _a;
    };
    BSPhase.prototype.addTable = function (view, fields) {
        this.addView(view, "table", fields);
        return this;
    };
    BSPhase.prototype.addUnion = function (view, fields, builtin) {
        if (builtin === void 0) { builtin = true; }
        this.addView(view, "union", fields);
        if (builtin) {
            var table = "builtin " + view;
            this.addTable(table, fields);
            this.addUnionMember(view, table);
        }
        return this;
    };
    BSPhase.prototype.addUnionMember = function (union, member, mapping) {
        // apply the natural mapping.
        if (!mapping) {
            if (this.viewKind(union) !== "union")
                throw new Error("Union '" + union + "' must be added before adding members");
            mapping = {};
            for (var _i = 0, _a = this.viewFields(union); _i < _a.length; _i++) {
                var field = _a[_i];
                mapping[field] = field;
            }
        }
        var action = union + " <-- " + member + " <-- " + JSON.stringify(mapping);
        this.addFact("action", { view: union, action: action, kind: "union", ix: 0 })
            .addFact("action source", { action: action, "source view": member });
        for (var field in mapping) {
            var mapped = mapping[field];
            if (mapped.constructor === Array) {
                this.addFact("action mapping constant", { action: action, from: field, "value": mapped[0] });
            }
            else {
                this.addFact("action mapping", { action: action, from: field, "to source": member, "to field": mapped });
            }
        }
        return this;
    };
    BSPhase.prototype.addQuery = function (view, query) {
        query.name = view;
        this._queries[view] = query;
        this.addView(view, "query", Object.keys(query.projectionMap || {}));
        this.changeset.merge(query.changeset(this.ixer));
        return this;
    };
    BSPhase.prototype.addArtifacts = function (artifacts) {
        var views = artifacts.views;
        for (var view in artifacts.views) {
            this._views[view] = "query";
        }
        for (var id in views)
            this.changeset.merge(views[id].changeset(app_1.eve));
        return this;
    };
    BSPhase.prototype.addUI = function (id, ui) {
        ui.id = id;
        this._uis[id] = ui;
        this.addEntity(id, id, ["system", "ui"]);
        this.changeset.merge(ui.changeset(this.ixer));
        return this;
    };
    return BSPhase;
})();
//-----------------------------------------------------------------------------
// Runtime Setup
//-----------------------------------------------------------------------------
app.init("bootstrap", function bootstrap() {
    //-----------------------------------------------------------------------------
    // Entity System
    //-----------------------------------------------------------------------------
    var phase = new BSPhase(app_1.eve);
    phase.addTable("manual entity", ["entity", "content"]);
    phase.addTable("sourced eav", ["entity", "attribute", "value", "source"]);
    phase.addTable("page content", ["page", "content"]);
    phase.addTable("entity page", ["entity", "page"]);
    phase.addTable("action entity", ["entity", "content", "source"]);
    phase
        .addEntity("entity", "entity", ["system"])
        .addEntity("collection", "collection", ["system"])
        .addEntity("system", "system", ["system", "collection"])
        .addEntity("union", "union", ["system", "collection"])
        .addEntity("query", "query", ["system", "collection"])
        .addEntity("table", "table", ["system", "collection"])
        .addEntity("ui", "ui", ["system", "collection"])
        .addEntity("home", "home", ["system"], undefined, (_a = ["\n      {entity|rep = directory}\n    "], _a.raw = ["\n      {entity|rep = directory}\n    "], utils_1.unpad(6)(_a)));
    phase.addUnion("entity eavs", ["entity", "attribute", "value"], true)
        .addUnionMember("entity eavs", "generated eav", { entity: "entity", attribute: "attribute", value: "value" })
        .addUnionMember("entity eavs", "sourced eav", { entity: "entity", attribute: "attribute", value: "value" })
        .addUnionMember("entity eavs", "added eavs");
    phase.addUnion("entity links", ["entity", "link", "type"])
        .addUnionMember("entity links", "eav entity links")
        .addUnionMember("entity links", "is a attributes", { entity: "entity", link: "collection", type: ["is a"] });
    phase.addUnion("directionless links", ["entity", "link"])
        .addUnionMember("directionless links", "entity links")
        .addUnionMember("directionless links", "entity links", { entity: "link", link: "entity" });
    phase.addUnion("collection entities", ["entity", "collection"])
        .addUnionMember("collection entities", "is a attributes");
    phase.addArtifacts(parser_1.parseDSL("\n    (query :$$view \"bs: entity\"\n      (entity-page :entity entity :page page)\n      (page-content :page page :content content)\n      (project! \"entity\" :entity entity :content content))\n  "));
    phase.addArtifacts(parser_1.parseDSL("\n    (query :$$view \"bs: unmodified added bits\"\n      (added-bits :entity entity :content content)\n      (negate (manual-entity :entity entity))\n      (project! \"unmodified added bits\" :entity entity :content content))\n  "));
    phase.addArtifacts(parser_1.parseDSL("\n    (query :$$view \"bs: is a attributes\"\n      (entity-eavs :attribute \"is a\" :entity entity :value value)\n      (project! \"is a attributes\" :collection value :entity entity))\n  "));
    // @HACK: this view is required because you can't currently join a select on the result of a function.
    // so we create a version of the eavs table that already has everything lowercased.
    phase.addArtifacts(parser_1.parseDSL("\n    (query :$$view \"bs: lowercase eavs\"\n      (entity-eavs :entity entity :attribute attribute :value value)\n      (lowercase :text value :result lowercased)\n      (project! \"lowercase eavs\" :entity entity :attribute attribute :value lowercased))\n  "));
    phase.addArtifacts(parser_1.parseDSL("\n    (query :$$view \"bs: eav entity links\"\n      (entity-eavs :entity entity :attribute attribute :value value)\n      (entity :entity value)\n      (project! \"eav entity links\" :entity entity :type attribute :link value))\n  "));
    phase.addArtifacts(parser_1.parseDSL("\n    (query :$$view \"bs: collection\"\n      (is-a-attributes :collection entity)\n      (query :$$view \"bs: collection count\"\n        (is-a-attributes :collection entity :entity child)\n        (count :count childCount))\n      (project! \"collection\" :collection entity :count childCount))\n  "));
    phase.addEntity("entity", "entity", ["system"]);
    phase.addEntity("collection", "collection", ["system"]);
    phase.addArtifacts(parser_1.parseDSL((_b = ["\n    (query :$$view \"bs: entity eavs from entities\"\n      (entity :entity entity)\n      (project! \"entity eavs\" :entity entity :attribute \"is a\" :value \"", "\"))\n  "], _b.raw = ["\n    (query :$$view \"bs: entity eavs from entities\"\n      (entity :entity entity)\n      (project! \"entity eavs\" :entity entity :attribute \"is a\" :value \"", "\"))\n  "], utils_1.unpad(4)(_b, utils_1.builtinId("entity")))));
    phase.addArtifacts(parser_1.parseDSL((_c = ["\n    (query :$$view \"bs: entity eavs from collections\"\n      (is-a-attributes :collection coll)\n      (project! \"entity eavs\" :entity coll :attribute \"is a\" :value \"", "\"))\n  "], _c.raw = ["\n    (query :$$view \"bs: entity eavs from collections\"\n      (is-a-attributes :collection coll)\n      (project! \"entity eavs\" :entity coll :attribute \"is a\" :value \"", "\"))\n  "], utils_1.unpad(4)(_c, utils_1.builtinId("collection")))));
    /*  phase.addArtifacts(parseDSL(unpad(4) `
        (query
          (entity :entity entity)
          (negate (query
            (directionless-links :entity entity :link link)
            (!= link "AUTOGENERATED entity THIS SHOULDN'T SHOW UP ANYWHERE")
            (!= link "AUTOGENERATED orphaned THIS SHOULDN'T SHOW UP ANYWHERE")
            ))
          (project! "entity eavs" :entity coll :attribute "is a" :value "AUTOGENERATED collection THIS SHOULDN'T SHOW UP ANYWHERE"))
    `));*/
    phase.addTable("ui pane", ["pane", "contains", "kind"]);
    if (app_1.eve.find("ui pane").length === 0)
        phase.addFact("ui pane", { pane: "p1", contains: "pet", kind: 0 });
    phase.apply(true);
    //-----------------------------------------------------------------------------
    // UI
    //-----------------------------------------------------------------------------
    phase = new BSPhase(app_1.eve);
    // @FIXME: These should probably be unionized.
    function resolve(table, fields) {
        return fields.map(function (field) { return (table + ": " + field); });
    }
    phase.addTable("ui template", resolve("ui template", ["template", "parent", "ix"]));
    phase.addTable("ui template binding", resolve("ui template binding", ["template", "query"]));
    phase.addTable("ui embed", resolve("ui embed", ["embed", "template", "parent", "ix"]));
    phase.addTable("ui embed scope", resolve("ui embed scope", ["embed", "key", "value"]));
    phase.addTable("ui embed scope binding", resolve("ui embed scope binding", ["embed", "key", "source", "alias"]));
    phase.addTable("ui attribute", resolve("ui attribute", ["template", "property", "value"]));
    phase.addTable("ui attribute binding", resolve("ui attribute binding", ["template", "property", "source", "alias"]));
    phase.addTable("ui event", resolve("ui event", ["template", "event"]));
    phase.addTable("ui event state", resolve("ui event state", ["template", "event", "key", "value"]));
    phase.addTable("ui event state binding", resolve("ui event state binding", ["template", "event", "key", "source", "alias"]));
    phase.addTable("system ui", ["template"]);
    phase.apply(true);
    //-----------------------------------------------------------------------------
    // Testing
    //-----------------------------------------------------------------------------
    phase = new BSPhase(app_1.eve);
    var testData = {
        "test data": [],
        pet: [],
        exotic: [],
        dangerous: [],
        cat: ["pet"],
        dog: ["pet"],
        fish: ["pet"],
        snake: ["pet", "exotic"],
        koala: ["pet", "exotic"],
        sloth: ["pet", "exotic"],
        kangaroo: ["exotic"],
        giraffe: ["exotic"],
        gorilla: ["exotic", "dangerous"],
        company: [],
        kodowa: ["company"],
        department: [],
        engineering: ["department"],
        operations: ["department"],
        magic: ["department"],
        employee: [],
        josh: ["employee"],
        corey: ["employee"],
        chris: ["employee"],
        rob: ["employee"],
        eric: ["employee"],
    };
    var testAttrs = {
        cat: { length: 4 },
        dog: { length: 3 },
        fish: { length: 1 },
        snake: { length: 4 },
        koala: { length: 3 },
        sloth: { length: 3 },
        engineering: { company: "kodowa" },
        operations: { company: "kodowa" },
        magic: { company: "kodowa" },
        josh: { department: "engineering", salary: 7 },
        corey: { department: "engineering", salary: 10 },
        chris: { department: "engineering", salary: 10 },
        eric: { department: "engineering", salary: 7 },
        rob: { department: "operations", salary: 10 },
    };
    for (var entity in testData)
        phase.addEntity(entity, entity, ["test data"].concat(testData[entity]), testAttrs[entity], "");
    // phase.addTable("department", ["department"])
    //   .addFact("department", {department: "engineering"})
    //   .addFact("department", {department: "operations"})
    //   .addFact("department", {department: "magic"});
    // phase.addTable("employee", ["department", "employee", "salary"])
    //   .addFact("employee", {department: "engineering", employee: "josh", salary: 10})
    //   .addFact("employee", {department: "engineering", employee: "corey", salary: 11})
    //   .addFact("employee", {department: "engineering", employee: "chris", salary: 7})
    //   .addFact("employee", {department: "operations", employee: "rob", salary: 7});
    phase.apply(true);
    window["p"] = phase;
    var _a, _b, _c;
});
window["bootstrap"] = exports;

},{"./app":9,"./parser":13,"./runtime":15,"./uiRenderer":17,"./utils":19}],11:[function(require,module,exports){
var utils_1 = require("./utils");
function sum(list) {
    var total = 0;
    for (var _i = 0; _i < list.length; _i++) {
        var num = list[_i];
        total += num;
    }
    return total;
}
function vecmul(a, b) {
    if (!a || !b || a.length !== b.length)
        throw new Error("Lists must be same length");
    var result = [];
    for (var i = 0, len = a.length; i < len; i++)
        result[i] = a[i] * b[i];
    return result;
}
var _layouts = [
    { size: 4, c: "big" },
    { size: 2, c: "detailed" },
    { size: 1, c: "normal", grouped: 2 },
];
function masonry(elem) {
    var _a = elem.seed, seed = _a === void 0 ? 0 : _a, _b = elem.rowSize, rowSize = _b === void 0 ? 8 : _b, _c = elem.layouts, layouts = _c === void 0 ? _layouts : _c, _d = elem.styles, styles = _d === void 0 ? undefined : _d, children = elem.children;
    var rand = utils_1.srand(seed);
    layouts.sort(utils_1.sortByField("size"));
    // Assign notional tiles an initial size based on the visual frequency of each layout
    var ix = 0;
    var tilesPerLayout = [];
    var totalLayoutFreq = 0;
    var sizes = [];
    for (var _i = 0; _i < layouts.length; _i++) {
        var layout = layouts[_i];
        layout.freq = layout.freq || 1 / layout.size;
        totalLayoutFreq += layout.freq;
    }
    for (var _e = 0; _e < layouts.length; _e++) {
        var layout = layouts[_e];
        sizes[ix] = layout.size;
        tilesPerLayout[ix++] = Math.round(layout.freq / totalLayoutFreq * children.length);
    }
    // Ensure every notional tile has an assigned size (to fix rounding errors)
    var total;
    var tryIx = 0;
    while ((total = sum(tilesPerLayout)) !== children.length) {
        if (sum(tilesPerLayout) > children.length)
            tilesPerLayout[tilesPerLayout.length - 1] -= 1;
        else if (sum(tilesPerLayout) < children.length)
            tilesPerLayout[tilesPerLayout.length - 1] += 1;
    }
    // Optimize distribution of notional tiles to maximally fill rows
    tryIx = 0, ix = 0;
    var minSize = layouts[layouts.length - 1].size;
    while (true) {
        var filledSize_1 = sum(vecmul(tilesPerLayout, sizes));
        var rowCount_1 = Math.ceil(filledSize_1 / rowSize);
        var delta = rowSize * rowCount_1 - filledSize_1;
        if (delta <= 0 || tryIx++ > 1000)
            break;
        // Since we'll be shifting one of the smallest layout tiles to a bigger size, we offset by that size
        if (ix === layouts.length - 1)
            ix = 0;
        if (delta >= layouts[ix].size - minSize) {
            tilesPerLayout[layouts.length - 1]--;
            tilesPerLayout[ix]++;
        }
        else if (ix === layouts.length - 2) {
            // The second smallest size was still too large, we're done.
            break;
        }
        ix++;
    }
    // Assign discrete tiles to sizes based on their relative size ordering
    children.sort(utils_1.sortByField("size"));
    var tiles = [], layoutIx = 0, tileIx = 0;
    for (var _f = 0; _f < tilesPerLayout.length; _f++) {
        var count = tilesPerLayout[_f];
        var layout = layouts[layoutIx++];
        if (!layout.grouped) {
            for (var ix_1 = tileIx; ix_1 < tileIx + count; ix_1++) {
                var tile = children[ix_1];
                tile.c = "tile " + (tile.c || "") + " " + (layout.c || "");
                if (styles)
                    tile.c += " " + styles[tileIx % styles.length];
                if (layout.format)
                    tile = layout.format(tile);
                tiles.push({ c: "group " + (layout.c || ""), layout: layout, size: layout.size, children: [tile] });
            }
        }
        else {
            // Grouped layouts are grouped at this stage to keep the layout process 1-dimensional
            var added = 0;
            ;
            for (var ix_2 = tileIx; ix_2 < tileIx + count; ix_2 += layout.grouped) {
                var group = { c: "group " + (layout.c || ""), layout: layout, size: layout.size * layout.grouped, children: [] };
                for (var partIx = 0; partIx < layout.grouped && added < count; partIx++) {
                    var tile = children[ix_2 + partIx];
                    tile.c = "tile " + (tile.c || "") + " " + (layout.c || "");
                    if (styles)
                        tile.c += " " + styles[(tileIx + partIx) % styles.length];
                    if (layout.format)
                        tile = layout.format(tile);
                    group.children.push(tile);
                    added++;
                }
                tiles.push(group);
            }
        }
        tileIx += count;
    }
    // @TODO: Pull tiles from bag, distributing them evenly into rows
    var filledSize = sum(vecmul(tilesPerLayout, sizes));
    var rowCount = Math.ceil(filledSize / rowSize);
    var rows = [];
    for (var ix_3 = 0; ix_3 < rowCount; ix_3++)
        rows.push({ c: "masonry-row", children: [], size: 0 });
    tryIx = 0;
    var rowIx = 0;
    for (var _g = 0; _g < tiles.length; _g++) {
        var tile = tiles[_g];
        var size = tile.layout.size * (tile.layout.grouped || 1);
        var placed = false;
        var attempts = 0;
        while (!placed) {
            var row = rows[rowIx];
            if (row.size + size <= rowSize) {
                row.size += size;
                row.children.push(tile);
                placed = true;
            }
            rowIx++;
            if (rowIx >= rowCount)
                rowIx = 0;
            attempts++;
            if (attempts === rowCount)
                break;
        }
        if (!placed)
            console.error("Could not place tile", tile);
    }
    ix = 0;
    // Shuffle the row contents and the set of rows for pleasing irregularity
    for (var _h = 0; _h < rows.length; _h++) {
        var row = rows[_h];
        utils_1.shuffle(row.children, rand);
    }
    utils_1.shuffle(rows, rand);
    elem.c = "masonry " + (elem.c || "");
    elem.children = rows;
    return elem;
}
exports.masonry = masonry;

},{"./utils":19}],12:[function(require,module,exports){
function now() {
    if (window.performance) {
        return window.performance.now();
    }
    return (new Date()).getTime();
}
function shallowEquals(a, b) {
    if (a === b)
        return true;
    if (!a || !b)
        return false;
    for (var k in a) {
        if (a[k] !== b[k])
            return false;
    }
    for (var k in b) {
        if (b[k] !== a[k])
            return false;
    }
    return true;
}
function postAnimationRemove(elements) {
    for (var _i = 0; _i < elements.length; _i++) {
        var elem = elements[_i];
        if (elem.parentNode)
            elem.parentNode.removeChild(elem);
    }
}
var Renderer = (function () {
    function Renderer() {
        this.content = document.createElement("div");
        this.content.className = "__root";
        this.elementCache = { "__root": this.content };
        this.prevTree = {};
        this.tree = {};
        this.postRenders = [];
        this.lastDiff = { adds: [], updates: {} };
        var self = this;
        this.handleEvent = function handleEvent(e) {
            var id = (e.currentTarget || e.target)["_id"];
            var elem = self.tree[id];
            if (!elem)
                return;
            var handler = elem[e.type];
            if (handler) {
                handler(e, elem);
            }
        };
    }
    Renderer.compile = function (elem) {
        if (!elem.id)
            throw new Error("Cannot compile element with id " + elem.id);
        var renderer = Renderer._compileRenderer[elem.id];
        if (!renderer)
            renderer = Renderer._compileRenderer[elem.id] = new Renderer();
        renderer.render([elem]);
        return renderer.elementCache[elem.id];
    };
    Renderer.prototype.reset = function () {
        this.prevTree = this.tree;
        this.tree = {};
        this.postRenders = [];
    };
    Renderer.prototype.domify = function () {
        var fakePrev = {}; //create an empty object once instead of every instance of the loop
        var elements = this.tree;
        var prevElements = this.prevTree;
        var diff = this.lastDiff;
        var adds = diff.adds;
        var updates = diff.updates;
        var elemKeys = Object.keys(updates);
        var elementCache = this.elementCache;
        var tempTween = {};
        //Create all the new elements to ensure that they're there when they need to be
        //parented
        for (var i = 0, len = adds.length; i < len; i++) {
            var id = adds[i];
            var cur = elements[id];
            var div;
            if (cur.svg) {
                div = document.createElementNS("http://www.w3.org/2000/svg", cur.t || "rect");
            }
            else {
                div = document.createElement(cur.t || "div");
            }
            div._id = id;
            elementCache[id] = div;
            if (cur.enter) {
                if (cur.enter.delay) {
                    cur.enter.display = "auto";
                    div.style.display = "none";
                }
                Velocity(div, cur.enter, cur.enter);
            }
        }
        for (var i = 0, len = elemKeys.length; i < len; i++) {
            var id = elemKeys[i];
            var cur = elements[id];
            var prev = prevElements[id] || fakePrev;
            var type = updates[id];
            var div;
            if (type === "replaced") {
                var me = elementCache[id];
                if (me.parentNode)
                    me.parentNode.removeChild(me);
                if (cur.svg) {
                    div = document.createElementNS("http://www.w3.org/2000/svg", cur.t || "rect");
                }
                else {
                    div = document.createElement(cur.t || "div");
                }
                prev = fakePrev;
                div._id = id;
                elementCache[id] = div;
            }
            else if (type === "removed") {
                //NOTE: Batching the removes such that you only remove the parent
                //didn't actually make this faster surprisingly. Given that this
                //strategy is much simpler and there's no noticable perf difference
                //we'll just do the dumb thing and remove all the children one by one.
                var me = elementCache[id];
                if (prev.leave) {
                    prev.leave.complete = postAnimationRemove;
                    if (prev.leave.absolute) {
                        me.style.position = "absolute";
                    }
                    Velocity(me, prev.leave, prev.leave);
                }
                else if (me.parentNode)
                    me.parentNode.removeChild(me);
                elementCache[id] = null;
                continue;
            }
            else {
                div = elementCache[id];
            }
            var style = div.style;
            if (cur.c !== prev.c)
                div.className = cur.c;
            if (cur.draggable !== prev.draggable)
                div.draggable = cur.draggable === undefined ? null : "true";
            if (cur.contentEditable !== prev.contentEditable)
                div.contentEditable = cur.contentEditable !== undefined ? JSON.stringify(cur.contentEditable) : "inherit";
            if (cur.colspan !== prev.colspan)
                div.colSpan = cur.colspan;
            if (cur.placeholder !== prev.placeholder)
                div.placeholder = cur.placeholder;
            if (cur.selected !== prev.selected)
                div.selected = cur.selected;
            if (cur.value !== prev.value)
                div.value = cur.value;
            if (cur.t === "input" && cur.type !== prev.type)
                div.type = cur.type;
            if (cur.t === "input" && cur.checked !== prev.checked)
                div.checked = cur.checked;
            if ((cur.text !== prev.text || cur.strictText) && div.textContent !== cur.text)
                div.textContent = cur.text === undefined ? "" : cur.text;
            if (cur.tabindex !== prev.tabindex)
                div.setAttribute("tabindex", cur.tabindex);
            if (cur.href !== prev.href)
                div.setAttribute("href", cur.href);
            if (cur.src !== prev.src)
                div.setAttribute("src", cur.src);
            if (cur.data !== prev.data)
                div.setAttribute("data", cur.data);
            if (cur.download !== prev.download)
                div.setAttribute("download", cur.download);
            if (cur.allowfullscreen !== prev.allowfullscreen)
                div.setAttribute("allowfullscreen", cur.allowfullscreen);
            // animateable properties
            var tween = cur.tween || tempTween;
            if (cur.flex !== prev.flex) {
                if (tween.flex)
                    tempTween.flex = cur.flex;
                else
                    style.flex = cur.flex === undefined ? "" : cur.flex;
            }
            if (cur.left !== prev.left) {
                if (tween.left)
                    tempTween.left = cur.left;
                else
                    style.left = cur.left === undefined ? "" : cur.left;
            }
            if (cur.top !== prev.top) {
                if (tween.top)
                    tempTween.top = cur.top;
                else
                    style.top = cur.top === undefined ? "" : cur.top;
            }
            if (cur.height !== prev.height) {
                if (tween.height)
                    tempTween.height = cur.height;
                else
                    style.height = cur.height === undefined ? "auto" : cur.height;
            }
            if (cur.width !== prev.width) {
                if (tween.width)
                    tempTween.width = cur.width;
                else
                    style.width = cur.width === undefined ? "auto" : cur.width;
            }
            if (cur.zIndex !== prev.zIndex) {
                if (tween.zIndex)
                    tempTween.zIndex = cur.zIndex;
                else
                    style.zIndex = cur.zIndex;
            }
            if (cur.backgroundColor !== prev.backgroundColor) {
                if (tween.backgroundColor)
                    tempTween.backgroundColor = cur.backgroundColor;
                else
                    style.backgroundColor = cur.backgroundColor || "transparent";
            }
            if (cur.borderColor !== prev.borderColor) {
                if (tween.borderColor)
                    tempTween.borderColor = cur.borderColor;
                else
                    style.borderColor = cur.borderColor || "none";
            }
            if (cur.borderWidth !== prev.borderWidth) {
                if (tween.borderWidth)
                    tempTween.borderWidth = cur.borderWidth;
                else
                    style.borderWidth = cur.borderWidth || 0;
            }
            if (cur.borderRadius !== prev.borderRadius) {
                if (tween.borderRadius)
                    tempTween.borderRadius = cur.borderRadius;
                else
                    style.borderRadius = (cur.borderRadius || 0) + "px";
            }
            if (cur.opacity !== prev.opacity) {
                if (tween.opacity)
                    tempTween.opacity = cur.opacity;
                else
                    style.opacity = cur.opacity === undefined ? 1 : cur.opacity;
            }
            if (cur.fontSize !== prev.fontSize) {
                if (tween.fontSize)
                    tempTween.fontSize = cur.fontSize;
                else
                    style.fontSize = cur.fontSize;
            }
            if (cur.color !== prev.color) {
                if (tween.color)
                    tempTween.color = cur.color;
                else
                    style.color = cur.color || "inherit";
            }
            var animKeys = Object.keys(tempTween);
            if (animKeys.length) {
                Velocity(div, tempTween, tween);
                tempTween = {};
            }
            // non-animation style properties
            if (cur.backgroundImage !== prev.backgroundImage)
                style.backgroundImage = "url('" + cur.backgroundImage + "')";
            if (cur.border !== prev.border)
                style.border = cur.border || "none";
            if (cur.textAlign !== prev.textAlign) {
                style.alignItems = cur.textAlign;
                if (cur.textAlign === "center") {
                    style.textAlign = "center";
                }
                else if (cur.textAlign === "flex-end") {
                    style.textAlign = "right";
                }
                else {
                    style.textAlign = "left";
                }
            }
            if (cur.verticalAlign !== prev.verticalAlign)
                style.justifyContent = cur.verticalAlign;
            if (cur.fontFamily !== prev.fontFamily)
                style.fontFamily = cur.fontFamily || "inherit";
            if (cur.transform !== prev.transform)
                style.transform = cur.transform || "none";
            if (cur.style !== prev.style)
                div.setAttribute("style", cur.style);
            if (cur.dangerouslySetInnerHTML !== prev.dangerouslySetInnerHTML)
                div.innerHTML = cur.dangerouslySetInnerHTML;
            // debug/programmatic properties
            if (cur.semantic !== prev.semantic)
                div.setAttribute("data-semantic", cur.semantic);
            if (cur.debug !== prev.debug)
                div.setAttribute("data-debug", cur.debug);
            // SVG properties
            if (cur.svg) {
                if (cur.fill !== prev.fill)
                    div.setAttributeNS(null, "fill", cur.fill);
                if (cur.stroke !== prev.stroke)
                    div.setAttributeNS(null, "stroke", cur.stroke);
                if (cur.strokeWidth !== prev.strokeWidth)
                    div.setAttributeNS(null, "stroke-width", cur.strokeWidth);
                if (cur.d !== prev.d)
                    div.setAttributeNS(null, "d", cur.d);
                if (cur.c !== prev.c)
                    div.setAttributeNS(null, "class", cur.c);
                if (cur.x !== prev.x)
                    div.setAttributeNS(null, "x", cur.x);
                if (cur.y !== prev.y)
                    div.setAttributeNS(null, "y", cur.y);
                if (cur.dx !== prev.dx)
                    div.setAttributeNS(null, "dx", cur.dx);
                if (cur.dy !== prev.dy)
                    div.setAttributeNS(null, "dy", cur.dy);
                if (cur.cx !== prev.cx)
                    div.setAttributeNS(null, "cx", cur.cx);
                if (cur.cy !== prev.cy)
                    div.setAttributeNS(null, "cy", cur.cy);
                if (cur.r !== prev.r)
                    div.setAttributeNS(null, "r", cur.r);
                if (cur.height !== prev.height)
                    div.setAttributeNS(null, "height", cur.height);
                if (cur.width !== prev.width)
                    div.setAttributeNS(null, "width", cur.width);
                if (cur.xlinkhref !== prev.xlinkhref)
                    div.setAttributeNS('http://www.w3.org/1999/xlink', "href", cur.xlinkhref);
                if (cur.startOffset !== prev.startOffset)
                    div.setAttributeNS(null, "startOffset", cur.startOffset);
                if (cur.id !== prev.id)
                    div.setAttributeNS(null, "id", cur.id);
                if (cur.viewBox !== prev.viewBox)
                    div.setAttributeNS(null, "viewBox", cur.viewBox);
                if (cur.transform !== prev.transform)
                    div.setAttributeNS(null, "transform", cur.transform);
                if (cur.draggable !== prev.draggable)
                    div.setAttributeNS(null, "draggable", cur.draggable);
                if (cur.textAnchor !== prev.textAnchor)
                    div.setAttributeNS(null, "text-anchor", cur.textAnchor);
            }
            //events
            if (cur.dblclick !== prev.dblclick)
                div.ondblclick = cur.dblclick !== undefined ? this.handleEvent : undefined;
            if (cur.click !== prev.click)
                div.onclick = cur.click !== undefined ? this.handleEvent : undefined;
            if (cur.contextmenu !== prev.contextmenu)
                div.oncontextmenu = cur.contextmenu !== undefined ? this.handleEvent : undefined;
            if (cur.mousedown !== prev.mousedown)
                div.onmousedown = cur.mousedown !== undefined ? this.handleEvent : undefined;
            if (cur.mousemove !== prev.mousemove)
                div.onmousemove = cur.mousemove !== undefined ? this.handleEvent : undefined;
            if (cur.mouseup !== prev.mouseup)
                div.onmouseup = cur.mouseup !== undefined ? this.handleEvent : undefined;
            if (cur.mouseover !== prev.mouseover)
                div.onmouseover = cur.mouseover !== undefined ? this.handleEvent : undefined;
            if (cur.mouseout !== prev.mouseout)
                div.onmouseout = cur.mouseout !== undefined ? this.handleEvent : undefined;
            if (cur.mouseleave !== prev.mouseleave)
                div.onmouseleave = cur.mouseleave !== undefined ? this.handleEvent : undefined;
            if (cur.mousewheel !== prev.mousewheel)
                div.onmouseheel = cur.mousewheel !== undefined ? this.handleEvent : undefined;
            if (cur.dragover !== prev.dragover)
                div.ondragover = cur.dragover !== undefined ? this.handleEvent : undefined;
            if (cur.dragstart !== prev.dragstart)
                div.ondragstart = cur.dragstart !== undefined ? this.handleEvent : undefined;
            if (cur.dragend !== prev.dragend)
                div.ondragend = cur.dragend !== undefined ? this.handleEvent : undefined;
            if (cur.drag !== prev.drag)
                div.ondrag = cur.drag !== undefined ? this.handleEvent : undefined;
            if (cur.drop !== prev.drop)
                div.ondrop = cur.drop !== undefined ? this.handleEvent : undefined;
            if (cur.scroll !== prev.scroll)
                div.onscroll = cur.scroll !== undefined ? this.handleEvent : undefined;
            if (cur.focus !== prev.focus)
                div.onfocus = cur.focus !== undefined ? this.handleEvent : undefined;
            if (cur.blur !== prev.blur)
                div.onblur = cur.blur !== undefined ? this.handleEvent : undefined;
            if (cur.input !== prev.input)
                div.oninput = cur.input !== undefined ? this.handleEvent : undefined;
            if (cur.change !== prev.change)
                div.onchange = cur.change !== undefined ? this.handleEvent : undefined;
            if (cur.keyup !== prev.keyup)
                div.onkeyup = cur.keyup !== undefined ? this.handleEvent : undefined;
            if (cur.keydown !== prev.keydown)
                div.onkeydown = cur.keydown !== undefined ? this.handleEvent : undefined;
            if (type === "added" || type === "replaced" || type === "moved") {
                var parentEl = elementCache[cur.parent];
                if (parentEl) {
                    if (cur.ix >= parentEl.children.length) {
                        parentEl.appendChild(div);
                    }
                    else {
                        parentEl.insertBefore(div, parentEl.children[cur.ix]);
                    }
                }
            }
        }
    };
    Renderer.prototype.diff = function () {
        var a = this.prevTree;
        var b = this.tree;
        var as = Object.keys(a);
        var bs = Object.keys(b);
        var updated = {};
        var adds = [];
        for (var i = 0, len = as.length; i < len; i++) {
            var id = as[i];
            var curA = a[id];
            var curB = b[id];
            if (curB === undefined) {
                updated[id] = "removed";
                continue;
            }
            if (curA.t !== curB.t) {
                updated[id] = "replaced";
                continue;
            }
            if (curA.ix !== curB.ix || curA.parent !== curB.parent) {
                updated[id] = "moved";
                continue;
            }
            if (!curB.dirty
                && curA.c === curB.c
                && curA.key === curB.key
                && curA.dangerouslySetInnerHTML === curB.dangerouslySetInnerHTML
                && curA.tabindex === curB.tabindex
                && curA.href === curB.href
                && curA.src === curB.src
                && curA.data === curB.data
                && curA.download === curB.download
                && curA.allowfullscreen === curB.allowfullscreen
                && curA.placeholder === curB.placeholder
                && curA.selected === curB.selected
                && curA.draggable === curB.draggable
                && curA.contentEditable === curB.contentEditable
                && curA.value === curB.value
                && curA.type === curB.type
                && curA.checked === curB.checked
                && curA.text === curB.text
                && curA.top === curB.top
                && curA.flex === curB.flex
                && curA.left === curB.left
                && curA.width === curB.width
                && curA.height === curB.height
                && curA.zIndex === curB.zIndex
                && curA.backgroundColor === curB.backgroundColor
                && curA.backgroundImage === curB.backgroundImage
                && curA.color === curB.color
                && curA.colspan === curB.colspan
                && curA.border === curB.border
                && curA.borderColor === curB.borderColor
                && curA.borderWidth === curB.borderWidth
                && curA.borderRadius === curB.borderRadius
                && curA.opacity === curB.opacity
                && curA.fontFamily === curB.fontFamily
                && curA.fontSize === curB.fontSize
                && curA.textAlign === curB.textAlign
                && curA.transform === curB.transform
                && curA.verticalAlign === curB.verticalAlign
                && curA.semantic === curB.semantic
                && curA.debug === curB.debug
                && curA.style === curB.style
                && (curB.svg === undefined || (curA.x === curB.x
                    && curA.y === curB.y
                    && curA.dx === curB.dx
                    && curA.dy === curB.dy
                    && curA.cx === curB.cx
                    && curA.cy === curB.cy
                    && curA.r === curB.r
                    && curA.d === curB.d
                    && curA.fill === curB.fill
                    && curA.stroke === curB.stroke
                    && curA.strokeWidth === curB.strokeWidth
                    && curA.startOffset === curB.startOffset
                    && curA.textAnchor === curB.textAnchor
                    && curA.viewBox === curB.viewBox
                    && curA.xlinkhref === curB.xlinkhref))) {
                continue;
            }
            updated[id] = "updated";
        }
        for (var i = 0, len = bs.length; i < len; i++) {
            var id = bs[i];
            var curA = a[id];
            if (curA === undefined) {
                adds.push(id);
                updated[id] = "added";
                continue;
            }
        }
        this.lastDiff = { adds: adds, updates: updated };
        return this.lastDiff;
    };
    Renderer.prototype.prepare = function (root) {
        var elemLen = 1;
        var tree = this.tree;
        var elements = [root];
        var elem;
        for (var elemIx = 0; elemIx < elemLen; elemIx++) {
            elem = elements[elemIx];
            if (elem.parent === undefined)
                elem.parent = "__root";
            if (elem.id === undefined)
                elem.id = "__root__" + elemIx;
            tree[elem.id] = elem;
            if (elem.postRender !== undefined) {
                this.postRenders.push(elem);
            }
            var children = elem.children;
            if (children !== undefined) {
                for (var childIx = 0, len = children.length; childIx < len; childIx++) {
                    var child = children[childIx];
                    if (child === undefined)
                        continue;
                    if (child.id === undefined) {
                        child.id = elem.id + "__" + childIx;
                    }
                    if (child.ix === undefined) {
                        child.ix = childIx;
                    }
                    if (child.parent === undefined) {
                        child.parent = elem.id;
                    }
                    elements.push(child);
                    elemLen++;
                }
            }
        }
        return tree;
    };
    Renderer.prototype.postDomify = function () {
        var postRenders = this.postRenders;
        var diff = this.lastDiff.updates;
        var elementCache = this.elementCache;
        for (var i = 0, len = postRenders.length; i < len; i++) {
            var elem = postRenders[i];
            var id = elem.id;
            if (diff[id] === "updated" || diff[id] === "added" || diff[id] === "replaced" || elem.dirty || diff[id] === "moved") {
                elem.postRender(elementCache[elem.id], elem);
            }
        }
    };
    Renderer.prototype.render = function (elems) {
        this.reset();
        // We sort elements by depth to allow them to be self referential.
        elems.sort(function (a, b) { return (a.parent ? a.parent.split("__").length : 0) - (b.parent ? b.parent.split("__").length : 0); });
        var start = now();
        for (var _i = 0; _i < elems.length; _i++) {
            var elem = elems[_i];
            var post = this.prepare(elem);
        }
        var prepare = now();
        var d = this.diff();
        var diff = now();
        this.domify();
        var domify = now();
        this.postDomify();
        var postDomify = now();
        var time = now() - start;
        if (time > 5) {
            console.log("slow render (> 5ms): ", time, {
                prepare: prepare - start,
                diff: diff - prepare,
                domify: domify - diff,
                postDomify: postDomify - domify
            });
        }
    };
    // @TODO: A more performant implementation would have a way of rendering subtrees and just have a lambda Renderer to compile into
    Renderer._compileRenderer = {};
    return Renderer;
})();
exports.Renderer = Renderer;

},{}],13:[function(require,module,exports){
var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var utils_1 = require("./utils");
var runtime = require("./runtime");
var app_1 = require("./app");
var ParseError = (function (_super) {
    __extends(ParseError, _super);
    function ParseError(message, line, lineIx, charIx, length) {
        if (charIx === void 0) { charIx = 0; }
        if (length === void 0) { length = line && (line.length - charIx); }
        _super.call(this, message);
        this.message = message;
        this.line = line;
        this.lineIx = lineIx;
        this.charIx = charIx;
        this.length = length;
        this.name = "Parse Error";
    }
    ParseError.prototype.toString = function () {
        return (_a = ["\n      ", ": ", "\n      ", "\n      ", "\n      ", "\n    "], _a.raw = ["\n      ", ": ", "\n      ", "\n      ", "\n      ", "\n    "], utils_1.unpad(6)(_a, this.name, this.message, this.lineIx !== undefined ? "On line " + (this.lineIx + 1) + ":" + this.charIx : "", this.line, utils_1.underline(this.charIx, this.length)));
        var _a;
    };
    return ParseError;
})(Error);
function readWhile(str, pattern, startIx) {
    var endIx = startIx;
    while (str[endIx] !== undefined && str[endIx].match(pattern))
        endIx++;
    return str.slice(startIx, endIx);
}
function readUntil(str, sentinel, startIx, unsatisfiedErr) {
    var endIx = str.indexOf(sentinel, startIx);
    if (endIx === -1) {
        if (unsatisfiedErr)
            return unsatisfiedErr;
        return str.slice(startIx);
    }
    return str.slice(startIx, endIx);
}
function readUntilAny(str, sentinels, startIx, unsatisfiedErr) {
    var endIx = -1;
    for (var _i = 0; _i < sentinels.length; _i++) {
        var sentinel = sentinels[_i];
        var ix = str.indexOf(sentinel, startIx);
        if (ix === -1 || endIx !== -1 && ix > endIx)
            continue;
        endIx = ix;
    }
    if (endIx === -1) {
        if (unsatisfiedErr)
            return unsatisfiedErr;
        return str.slice(startIx);
    }
    return str.slice(startIx, endIx);
}
// export function parseUI(str:string):UIElem {
//   let root:UIElem = {};
//   let errors = [];
//   let lineIx = 0;
//   let lines = str.split("\n");
//   let stack:{indent: number, elem: UIElem}[] = [{indent: -2, elem: root}];
//   // @FIXME: Chunk into element chunks instead of lines to enable in-argument continuation.
//   for(let line of lines) {
//     let charIx = 0;
//     while(line[charIx] === " ") charIx++;
//     let indent = charIx;
//     if(line[charIx] === undefined)  continue;
//     let parent:UIElem;
//     for(let stackIx = stack.length - 1; stackIx >= 0; stackIx--) {
//       if(indent > stack[stackIx].indent) {
//         parent = stack[stackIx].elem;
//         break;
//       } else stack.pop();
//     }
//     let keyword = readUntil(line, " ", charIx);
//     charIx += keyword.length;
//     if(keyword[0] === "~" || keyword[0] === "%") { // Handle binding
//       charIx -= keyword.length - 1;
//       let kind = keyword[0] === "~" ? "plan" : "query";
//       if(!parent.binding) {
//         parent.binding = line.slice(charIx);
//         parent.bindingKind = kind;
//       } else if(kind === parent.bindingKind) parent.binding += "\n" + line.slice(charIx);
//       else {
//         errors.push(new ParseError(`UI must be bound to a single type of query.`, line, lineIx));
//         continue;
//       }
//       charIx = line.length;
//     } else if(keyword[0] === "@") { // Handle event
//       charIx -= keyword.length - 1;
//       let err;
//       while(line[charIx] === " ") charIx++;
//       let lastIx = charIx;
//       let eventRaw = readUntil(line, "{", charIx);
//       charIx += eventRaw.length;
//       let event = eventRaw.trim();
//       if(!event) err = new ParseError(`UI event must specify a valid event name`, line, lineIx, lastIx, eventRaw.length);
//       let state;
//       [state, charIx] = getMapArgs(line, lineIx, charIx);
//       if(state instanceof Error && !err) err = state;
//       if(err) {
//         errors.push(err);
//         lineIx++;
//         continue;
//       }
//       if(!parent.events) parent.events = {};
//       parent.events[event] = state;
//     } else if(keyword[0] === ">") { // Handle embed
//       charIx -= keyword.length - 1;
//       let err;
//       while(line[charIx] === " ") charIx++;
//       let lastIx = charIx;
//       let embedIdRaw = readUntil(line, "{", charIx);
//       charIx += embedIdRaw.length;
//       let embedId = embedIdRaw.trim();
//       if(!embedId) err = new ParseError(`UI embed must specify a valid element id`, line, lineIx, lastIx, embedIdRaw.length);
//       let scope;
//       [scope = {}, charIx] = getMapArgs(line, lineIx, charIx);
//       if(scope instanceof Error && !err) err = scope;
//       if(err) {
//         errors.push(err);
//         lineIx++;
//         continue;
//       }
//       let elem = {embedded: scope, id: embedId};
//       if(!parent.children) parent.children = [];
//       parent.children.push(elem);
//       stack.push({indent, elem});
//     } else { // Handle element
//       let err;
//       if(!keyword) err = new ParseError(`UI element must specify a valid tag name`, line, lineIx, charIx, 0);
//       while(line[charIx] === " ") charIx++;
//       let classesRaw = readUntil(line, "{", charIx);
//       charIx += classesRaw.length;
//       let classes = classesRaw.trim();
//       let attributes;
//       [attributes = {}, charIx] = getMapArgs(line, lineIx, charIx);
//       if(attributes instanceof Error && !err) err = attributes;
//       if(err) {
//         errors.push(err);
//         lineIx++;
//         continue;
//       }
//       attributes["t"] = keyword;
//       if(classes) attributes["c"] = classes;
//       let elem:UIElem = {id: attributes["id"], attributes};
//       if(!parent.children) parent.children = [];
//       parent.children.push(elem);
//       stack.push({indent, elem});
//     }
//     lineIx++;
//   }
//   if(errors.length) {
//     for(let err of errors) {
//       console.error(err);
//     }
//   }
//   return root;
// }
//-----------------------------------------------------------------------------
// Eve DSL Parser
//-----------------------------------------------------------------------------
var TOKEN_TYPE;
(function (TOKEN_TYPE) {
    TOKEN_TYPE[TOKEN_TYPE["EXPR"] = 0] = "EXPR";
    TOKEN_TYPE[TOKEN_TYPE["IDENTIFIER"] = 1] = "IDENTIFIER";
    TOKEN_TYPE[TOKEN_TYPE["KEYWORD"] = 2] = "KEYWORD";
    TOKEN_TYPE[TOKEN_TYPE["STRING"] = 3] = "STRING";
    TOKEN_TYPE[TOKEN_TYPE["LITERAL"] = 4] = "LITERAL";
})(TOKEN_TYPE || (TOKEN_TYPE = {}));
;
var Token = (function () {
    function Token(type, value, lineIx, charIx) {
        this.type = type;
        this.value = value;
        this.lineIx = lineIx;
        this.charIx = charIx;
    }
    Token.identifier = function (value, lineIx, charIx) {
        return new Token(Token.TYPE.IDENTIFIER, value, lineIx, charIx);
    };
    Token.keyword = function (value, lineIx, charIx) {
        return new Token(Token.TYPE.KEYWORD, value, lineIx, charIx);
    };
    Token.string = function (value, lineIx, charIx) {
        return new Token(Token.TYPE.STRING, value, lineIx, charIx);
    };
    Token.literal = function (value, lineIx, charIx) {
        return new Token(Token.TYPE.LITERAL, value, lineIx, charIx);
    };
    Token.prototype.toString = function () {
        if (this.type === Token.TYPE.KEYWORD)
            return ":" + this.value;
        else if (this.type === Token.TYPE.STRING)
            return "\"" + this.value + "\"";
        else
            return this.value.toString();
    };
    Token.TYPE = TOKEN_TYPE;
    return Token;
})();
exports.Token = Token;
var Sexpr = (function () {
    function Sexpr(val, lineIx, charIx, syntax) {
        if (syntax === void 0) { syntax = "expr"; }
        this.lineIx = lineIx;
        this.charIx = charIx;
        this.syntax = syntax;
        this.type = Token.TYPE.EXPR;
        if (val)
            this.value = val.slice();
    }
    Sexpr.list = function (value, lineIx, charIx, syntax) {
        if (value === void 0) { value = []; }
        value = value.slice();
        value.unshift(Token.identifier("list", lineIx, charIx ? charIx + 1 : undefined));
        return new Sexpr(value, lineIx, charIx, syntax ? "list" : undefined);
    };
    Sexpr.hash = function (value, lineIx, charIx, syntax) {
        if (value === void 0) { value = []; }
        value = value.slice();
        value.unshift(Token.identifier("hash", lineIx, charIx ? charIx + 1 : undefined));
        return new Sexpr(value, lineIx, charIx, syntax ? "hash" : undefined);
    };
    Sexpr.asSexprs = function (values) {
        for (var _i = 0; _i < values.length; _i++) {
            var raw = values[_i];
            if (!(raw instanceof Sexpr))
                throw new ParseError("All top level entries must be expressions (got " + raw + ")", undefined, raw.lineIx, raw.charIx);
            else {
                var op = raw.operator;
                if (op.type !== Token.TYPE.IDENTIFIER)
                    throw new ParseError("All expressions must begin with an identifier", undefined, raw.lineIx, raw.charIx);
            }
        }
        return values;
    };
    Sexpr.prototype.toString = function () {
        var content = this.value && this.value.map(function (token) { return token.toString(); }).join(" ");
        var argsContent = this.value && this.arguments.map(function (token) { return token.toString(); }).join(" ");
        if (this.syntax === "hash")
            return "{" + argsContent + "}";
        else if (this.syntax === "list")
            return "[" + argsContent + "]";
        else
            return "(" + content + ")";
    };
    Sexpr.prototype.push = function (val) {
        this.value = this.value || [];
        return this.value.push(val);
    };
    Sexpr.prototype.nth = function (n, val) {
        if (val) {
            this.value = this.value || [];
            return this.value[n] = val;
        }
        return this.value && this.value[n];
    };
    Object.defineProperty(Sexpr.prototype, "operator", {
        get: function () {
            return this.value && this.value[0];
        },
        set: function (op) {
            this.value = this.value || [];
            this.value[0] = op;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Sexpr.prototype, "arguments", {
        get: function () {
            return this.value && this.value.slice(1);
        },
        set: function (args) {
            this.value = this.value || [];
            this.value.length = 1;
            this.value.push.apply(this.value, args);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Sexpr.prototype, "length", {
        get: function () {
            return this.value && this.value.length;
        },
        enumerable: true,
        configurable: true
    });
    return Sexpr;
})();
exports.Sexpr = Sexpr;
var TOKEN_TO_TYPE = {
    "(": "expr",
    ")": "expr",
    "[": "list",
    "]": "list",
    "{": "hash",
    "}": "hash"
};
var hygienicSymbolCounter = 0;
function readSexprs(text) {
    var root = Sexpr.list();
    var token;
    var sexpr = root;
    var sexprs = [root];
    var lines = text.split("\n");
    var lineIx = 0;
    var mode;
    for (var _i = 0; _i < lines.length; _i++) {
        var line = lines[_i];
        var line_1 = lines[lineIx];
        var charIx = 0;
        if (mode === "string")
            token.value += "\n";
        while (charIx < line_1.length) {
            if (mode === "string") {
                if (line_1[charIx] === "\"" && line_1[charIx - 1] !== "\\") {
                    sexpr.push(token);
                    token = mode = undefined;
                    charIx++;
                }
                else
                    token.value += line_1[charIx++];
                continue;
            }
            var padding = readWhile(line_1, /\s/, charIx);
            charIx += padding.length;
            if (padding.length) {
                if (token)
                    sexpr.push(token);
                token = undefined;
            }
            if (charIx >= line_1.length)
                continue;
            if (line_1[charIx] === ";") {
                charIx = line_1.length;
            }
            else if (line_1[charIx] === "\"") {
                if (!sexpr.length)
                    throw new ParseError("Literal must be an argument in a sexpr.", line_1, lineIx, charIx);
                mode = "string";
                token = Token.string("", lineIx, charIx);
                charIx++;
            }
            else if (line_1[charIx] === ":") {
                if (!sexpr.length)
                    throw new ParseError("Literal must be an argument in a sexpr.", line_1, lineIx, charIx);
                var keyword = readUntilAny(line_1, [" ", ")", "]", "}"], ++charIx);
                sexpr.push(Token.keyword(keyword, lineIx, charIx - 1));
                charIx += keyword.length;
            }
            else if (line_1[charIx] === "(" || line_1[charIx] === "[" || line_1[charIx] === "{") {
                if (token)
                    throw new ParseError("Sexpr arguments must be space separated.", line_1, lineIx, charIx);
                var type = TOKEN_TO_TYPE[line_1[charIx]];
                if (type === "hash")
                    sexpr = Sexpr.hash(undefined, lineIx, charIx);
                else if (type === "list")
                    sexpr = Sexpr.list(undefined, lineIx, charIx);
                else
                    sexpr = new Sexpr(undefined, lineIx, charIx);
                sexpr.syntax = type;
                sexprs.push(sexpr);
                charIx++;
            }
            else if (line_1[charIx] === ")" || line_1[charIx] === "]" || line_1[charIx] === "}") {
                var child = sexprs.pop();
                var type = TOKEN_TO_TYPE[line_1[charIx]];
                if (child.syntax !== type)
                    throw new ParseError("Must terminate " + child.syntax + " before terminating " + type, line_1, lineIx, charIx);
                sexpr = sexprs[sexprs.length - 1];
                if (!sexpr)
                    throw new ParseError("Too many closing parens", line_1, lineIx, charIx);
                sexpr.push(child);
                charIx++;
            }
            else {
                var literal = readUntilAny(line_1, [" ", ")", "]", "}"], charIx);
                var length_1 = literal.length;
                literal = utils_1.coerceInput(literal);
                var type = typeof literal === "string" ? "identifier" : "literal";
                if (!sexpr.length && type !== "identifier")
                    throw new ParseError("Expr must begin with identifier.", line_1, lineIx, charIx);
                if (type === "identifier") {
                    var dotIx = literal.indexOf(".");
                    if (dotIx !== -1) {
                        var child = new Sexpr([
                            Token.identifier("get", lineIx, charIx + 1),
                            Token.identifier(literal.slice(0, dotIx), lineIx, charIx + 3),
                            Token.string(literal.slice(dotIx + 1), lineIx, charIx + 5 + dotIx)
                        ], lineIx, charIx);
                        sexpr.push(child);
                    }
                    else
                        sexpr.push(Token.identifier(literal, lineIx, charIx));
                }
                else
                    sexpr.push(Token.literal(literal, lineIx, charIx));
                charIx += length_1;
            }
        }
        lineIx++;
    }
    if (token)
        throw new ParseError("Unterminated " + TOKEN_TYPE[token.type] + " token", lines[lineIx - 1], lineIx - 1);
    var lastIx = lines.length - 1;
    if (sexprs.length > 1)
        throw new ParseError("Too few closing parens", lines[lastIx], lastIx, lines[lastIx].length);
    return root;
}
exports.readSexprs = readSexprs;
function macroexpandDSL(sexpr) {
    // @TODO: Implement me.
    var op = sexpr.operator;
    if (op.value === "eav") {
        throw new Error("@TODO: Implement me!");
    }
    else if (op.value === "one-of") {
        // (one-of (query ...body) (query ...body) ...) =>
        // (union
        //   (def q1 (query ...body1))
        //   (def q2 (query (negate q1) ...body2)))
        throw new Error("@TODO: Implement me!");
    }
    else if (op.value === "negate") {
        if (sexpr.length > 2)
            throw new ParseError("Negate only takes a single body", undefined, sexpr.lineIx, sexpr.charIx);
        var select = macroexpandDSL(Sexpr.asSexprs(sexpr.arguments)[0]);
        select.push(Token.keyword("$$negated"));
        select.push(Token.literal(true));
        return select;
    }
    else if (["hash", "list", "get", "def", "query", "union", "select", "member", "project!", "insert!", "remove!", "load!"].indexOf(op.value) === -1) {
        // (foo-bar :a 5) => (select "foo bar" :a 5)
        var source = op;
        source.type = Token.TYPE.STRING;
        source.value = source.value.replace(/(.?)-(.)/g, "$1 $2");
        var args = sexpr.arguments;
        args.unshift(source);
        sexpr.arguments = args;
        sexpr.operator = Token.identifier("select");
    }
    return sexpr;
}
exports.macroexpandDSL = macroexpandDSL;
var VALUE;
(function (VALUE) {
    VALUE[VALUE["NULL"] = 0] = "NULL";
    VALUE[VALUE["SCALAR"] = 1] = "SCALAR";
    VALUE[VALUE["SET"] = 2] = "SET";
    VALUE[VALUE["VIEW"] = 3] = "VIEW";
})(VALUE || (VALUE = {}));
;
function parseDSL(text) {
    var artifacts = { views: {} };
    var lines = text.split("\n");
    var root = readSexprs(text);
    for (var _i = 0, _a = Sexpr.asSexprs(root.arguments); _i < _a.length; _i++) {
        var raw = _a[_i];
        parseDSLSexpr(raw, artifacts);
    }
    return artifacts;
}
exports.parseDSL = parseDSL;
function parseDSLSexpr(raw, artifacts, context, parent, resultVariable) {
    if (parent instanceof runtime.Query)
        var query = parent;
    else
        var union = parent;
    var sexpr = macroexpandDSL(raw);
    var op = sexpr.operator;
    if (op.type !== Token.TYPE.IDENTIFIER)
        throw new ParseError("Evaluated sexpr must begin with an identifier ('" + op + "' is a " + Token.TYPE[op.type] + ")", "", raw.lineIx, raw.charIx);
    if (op.value === "list") {
        var $$body = parseArguments(sexpr, undefined, "$$body").$$body;
        return { type: VALUE.SCALAR, value: $$body.map(function (token, ix) { return resolveTokenValue("list item " + ix, token, context); }) };
    }
    if (op.value === "hash") {
        var args = parseArguments(sexpr);
        for (var arg in args)
            args[arg] = resolveTokenValue("hash item " + arg, args[arg], context);
        return { type: VALUE.SET, value: args };
    }
    if (op.value === "insert!") {
        var changeset = artifacts.changeset || app_1.eve.diff();
        for (var _i = 0, _a = sexpr.arguments; _i < _a.length; _i++) {
            var arg = _a[_i];
            var table = arg.value[0];
            var fact = {};
            for (var ix = 1; ix < arg.value.length; ix += 2) {
                var key = arg.value[ix];
                var value = arg.value[ix + 1];
                fact[key.value] = value.value;
            }
            changeset.add(table.value, fact);
        }
        artifacts.changeset = changeset;
        return;
    }
    if (op.value === "remove!") {
        var changeset = artifacts.changeset || app_1.eve.diff();
        for (var _b = 0, _c = sexpr.arguments; _b < _c.length; _b++) {
            var arg = _c[_b];
            var table = arg.value[0];
            var fact = {};
            for (var ix = 1; ix < arg.value.length; ix += 2) {
                var key = arg.value[ix];
                var value = arg.value[ix + 1];
                fact[key.value] = value.value;
            }
            changeset.remove(table.value, fact);
        }
        artifacts.changeset = changeset;
        return;
    }
    if (op.value === "load!") {
        throw new Error("(load! ..) has not been implemented yet");
    }
    if (op.value === "query") {
        var neueContext = [];
        var _d = parseArguments(sexpr, undefined, "$$body"), $$view = _d.$$view, $$negated = _d.$$negated, $$body = _d.$$body;
        var queryId = $$view ? resolveTokenValue("view", $$view, context, VALUE.SCALAR) : utils_1.uuid();
        var neue = new runtime.Query(app_1.eve, queryId);
        neue["displayName"] = sexpr.toString();
        if (utils_1.DEBUG.instrumentQuery)
            instrumentQuery(neue, utils_1.DEBUG.instrumentQuery);
        artifacts.views[queryId] = neue;
        var aggregated = false;
        for (var _e = 0, _f = Sexpr.asSexprs($$body); _e < _f.length; _e++) {
            var raw_1 = _f[_e];
            var state = parseDSLSexpr(raw_1, artifacts, neueContext, neue);
            if (state && state.aggregated)
                aggregated = true;
        }
        var projectionMap = neue.projectionMap;
        var projected = true;
        if (!projectionMap) {
            projectionMap = {};
            projected = false;
            for (var _g = 0; _g < neueContext.length; _g++) {
                var variable = neueContext[_g];
                projectionMap[variable.name] = variable.value;
            }
        }
        if (Object.keys(projectionMap).length)
            neue.project(projectionMap);
        // Join subquery to parent.
        if (parent) {
            var select = new Sexpr([Token.identifier(query ? "select" : "member"), Token.string(queryId)], raw.lineIx, raw.charIx);
            var groups = [];
            for (var _h = 0; _h < neueContext.length; _h++) {
                var variable = neueContext[_h];
                if (projected && !variable.projection)
                    continue;
                var field = variable.projection || variable.name;
                select.push(Token.keyword(field));
                if (query)
                    select.push(Token.identifier(variable.name));
                else
                    select.push(Sexpr.list([Token.string(field)]));
                if (context) {
                    for (var _j = 0; _j < context.length; _j++) {
                        var parentVar = context[_j];
                        if (parentVar.name === variable.name)
                            groups.push(variable.value);
                    }
                }
            }
            if ($$negated) {
                select.push(Token.keyword("$$negated"));
                select.push($$negated);
            }
            if (groups.length && aggregated)
                neue.group(groups);
            parseDSLSexpr(select, artifacts, context, parent);
        }
        return { value: queryId, type: VALUE.VIEW, projected: projected, context: neueContext };
    }
    if (op.value === "union") {
        var _k = parseArguments(sexpr, undefined, "$$body"), $$view = _k.$$view, $$body = _k.$$body, $$negated = _k.$$negated;
        var unionId = $$view ? resolveTokenValue("view", $$view, context, VALUE.SCALAR) : utils_1.uuid();
        var neue = new runtime.Union(app_1.eve, unionId);
        if (utils_1.DEBUG.instrumentQuery)
            instrumentQuery(neue, utils_1.DEBUG.instrumentQuery);
        artifacts.views[unionId] = neue;
        var mappings = {};
        for (var _l = 0, _m = Sexpr.asSexprs($$body); _l < _m.length; _l++) {
            var raw_2 = _m[_l];
            var child = macroexpandDSL(raw_2);
            if (child.operator.value !== "query" && child.operator.value !== "union")
                throw new ParseError("Unions may only contain queries", "", raw_2.lineIx, raw_2.charIx);
            var res = parseDSLSexpr(child, artifacts, context, neue);
            for (var _o = 0, _p = res.context; _o < _p.length; _o++) {
                var variable = _p[_o];
                if (res.projected && !variable.projection)
                    continue;
                var field = variable.projection || variable.name;
                if (!mappings[field])
                    mappings[field] = {};
                mappings[field][variable.name] = true;
            }
        }
        // Join subunion to parent
        if (parent) {
            var select = new Sexpr([Token.identifier(query ? "select" : "member"), Token.string(unionId)], raw.lineIx, raw.charIx);
            for (var field in mappings) {
                var mappingVariables = Object.keys(mappings[field]);
                if (mappingVariables.length > 1)
                    throw new ParseError("All variables projected to a single union field must have the same name. Field '" + field + "' has " + mappingVariables.length + " fields (" + mappingVariables.join(", ") + ")", "", raw.lineIx, raw.charIx);
                select.push(Token.keyword(field));
                select.push(Token.identifier(mappingVariables[0]));
            }
            console.log("union select", select.toString());
            parseDSLSexpr(select, artifacts, context, parent);
        }
        return { type: VALUE.VIEW, value: unionId, mappings: mappings };
    }
    if (op.value === "member") {
        if (!union)
            throw new ParseError("Cannot add member to non-union parent", "", raw.lineIx, raw.charIx);
        var args = parseArguments(sexpr, ["$$view"]);
        var $$view = args.$$view, $$negated = args.$$negated;
        var view = resolveTokenValue("view", $$view, context, VALUE.SCALAR);
        if (view === undefined)
            throw new ParseError("Must specify a view to be unioned", "", raw.lineIx, raw.charIx);
        var join = {};
        for (var arg in args) {
            if (arg === "$$view" || arg === "$$negated")
                continue;
            join[arg] = resolveTokenValue("member field", args[arg], context);
        }
        if (runtime.QueryFunctions[view])
            throw new ParseError("Cannot union primitive view '" + view + "'", "", raw.lineIx, raw.charIx);
        union.union(view, join);
        return;
    }
    if (!parent)
        throw new ParseError("Non-query or union sexprs must be contained within a query or union", "", raw.lineIx, raw.charIx);
    if (op.value === "select") {
        if (!query)
            throw new ParseError("Cannot add select to non-query parent", "", raw.lineIx, raw.charIx);
        var selectId = utils_1.uuid();
        var $$view = getArgument(sexpr, "$$view", ["$$view"]);
        var view = resolveTokenValue("view", $$view, context, VALUE.SCALAR);
        if (view === undefined)
            throw new ParseError("Must specify a view to be selected", "", raw.lineIx, raw.charIx);
        var primitive = runtime.QueryFunctions[view];
        //@TODO: Move this to an eve table to allow user defined defaults
        var args = parseArguments(sexpr, ["$$view"].concat(getDefaults(view)));
        var $$negated = args.$$negated;
        var join = {};
        for (var arg in args) {
            var value = args[arg];
            var variable = void 0;
            if (arg === "$$view" || arg === "$$negated")
                continue;
            if (value instanceof Token && value.type !== Token.TYPE.IDENTIFIER) {
                join[arg] = args[arg].value;
                continue;
            }
            if (value instanceof Sexpr) {
                var result = parseDSLSexpr(value, artifacts, context, parent, "$$temp-" + hygienicSymbolCounter++ + "-" + arg);
                if (!result || result.type === VALUE.NULL)
                    throw new Error("Cannot set parameter '" + arg + "' to null value '" + value.toString() + "'");
                if (result.type === VALUE.VIEW) {
                    var view_1 = result.value;
                    var resultField_1 = getResult(view_1);
                    if (!resultField_1)
                        throw new Error("Cannot set parameter '" + arg + "' to select without default result field");
                    for (var _q = 0; _q < context.length; _q++) {
                        var curVar = context[_q];
                        for (var _r = 0, _s = curVar.constraints; _r < _s.length; _r++) {
                            var constraint = _s[_r];
                            if (constraint[0] === view_1 && constraint[1] === resultField_1) {
                                variable = curVar;
                                break;
                            }
                        }
                    }
                }
            }
            else
                variable = getDSLVariable(value.value, context);
            if (variable) {
                join[arg] = variable.value;
                variable.constraints.push([view, arg]);
            }
            else if ($$negated && $$negated.value)
                throw new ParseError("Cannot bind field in negated select to undefined variable '" + value.value + "'", "", raw.lineIx, raw.charIx);
            else
                context.push({ name: value.value, type: VALUE.SCALAR, value: [selectId, arg], constraints: [[view, arg]] }); // @TODO: does this not need to add to the join map?
        }
        var resultField = getResult(view);
        if (resultVariable && resultField && !join[resultField]) {
            join[resultField] = [selectId, resultField];
            context.push({ name: resultVariable, type: VALUE.SCALAR, value: [selectId, resultField], constraints: [[view, resultField]] });
        }
        if (primitive) {
            if ($$negated) {
                if (primitive.inverse)
                    view = primitive.inverse;
                else
                    throw new ParseError("Cannot invert primitive calculation '" + view + "'", "", raw.lineIx, raw.charIx);
            }
            if (primitive.aggregate)
                query.aggregate(view, join, selectId);
            else
                query.calculate(view, join, selectId);
        }
        else if ($$negated)
            query.deselect(view, join);
        else
            query.select(view, join, selectId);
        return {
            type: VALUE.VIEW,
            value: view,
            aggregated: primitive && primitive.aggregate
        };
    }
    if (op.value === "project!") {
        var args = parseArguments(sexpr, ["$$view"]);
        var $$view = args.$$view, $$negated = args.$$negated;
        var projectionMap = {};
        for (var arg in args) {
            var value = args[arg];
            if (arg === "$$view" || arg === "$$negated")
                continue;
            if (value.type !== Token.TYPE.IDENTIFIER) {
                projectionMap[arg] = args[arg].value;
                continue;
            }
            var variable = getDSLVariable(value.value, context);
            if (variable) {
                if (variable.static)
                    projectionMap[arg] = variable.value;
                else if (!$$view) {
                    variable.projection = arg;
                    projectionMap[arg] = variable.value;
                }
                else
                    projectionMap[arg] = [variable.name];
            }
            else
                throw new ParseError("Cannot bind projected field to undefined variable '" + value.value + "'", "", raw.lineIx, raw.charIx);
        }
        var view = resolveTokenValue("view", $$view, context, VALUE.SCALAR);
        if (view === undefined) {
            if (query.projectionMap)
                throw new ParseError("Query can only self-project once", "", raw.lineIx, raw.charIx);
            if ($$negated && $$negated.value)
                throw new ParseError("Cannot negate self-projection", "", raw.lineIx, raw.charIx);
            // Project self
            query.project(projectionMap);
        }
        else {
            var union_1 = artifacts.views[view] || new runtime.Union(app_1.eve, view);
            if (utils_1.DEBUG.instrumentQuery && !artifacts.views[view])
                instrumentQuery(union_1, utils_1.DEBUG.instrumentQuery);
            artifacts.views[view] = union_1;
            // if($$negated && $$negated.value) union.ununion(queryId, projectionMap);
            if ($$negated && $$negated.value)
                throw new ParseError("Union projections may not be negated in the current runtime", "", raw.lineIx, raw.charIx);
            else
                union_1.union(query.name, projectionMap);
        }
        return;
    }
    throw new ParseError("Unknown DSL operator '" + op.value + "'", "", raw.lineIx, raw.charIx);
}
function resolveTokenValue(name, token, context, type) {
    if (!token)
        return;
    if (token instanceof Sexpr)
        return parseDSLSexpr(token, undefined, context);
    if (token instanceof Token && token.type === Token.TYPE.IDENTIFIER) {
        var variable = getDSLVariable(token.value, context, VALUE.SCALAR);
        if (!variable)
            throw new Error("Cannot bind " + name + " to undefined variable '" + token.value + "'");
        if (!variable.static)
            throw new Error("Cannot bind " + name + " to dynamic variable '" + token.value + "'");
        return variable.value;
    }
    return token.value;
}
function getDSLVariable(name, context, type) {
    if (!context)
        return;
    for (var _i = 0; _i < context.length; _i++) {
        var variable = context[_i];
        if (variable.name === name) {
            if (variable.static === false)
                throw new Error("Cannot statically look up dynamic variable '" + name + "'");
            if (type !== undefined && variable.type !== type)
                throw new Error("Expected variable '" + name + "' to have type '" + type + "', but instead has type '" + variable.type + "'");
            return variable;
        }
    }
}
function getDefaults(view) {
    return (runtime.QueryFunctions[view] && runtime.QueryFunctions[view].params) || [];
}
function getResult(view) {
    return runtime.QueryFunctions[view] && runtime.QueryFunctions[view].result;
}
function getArgument(root, param, defaults) {
    var ix = 1;
    var defaultIx = 0;
    for (var ix_1 = 1, cur = root.nth(ix_1); ix_1 < root.length; ix_1++) {
        if (cur.type === Token.TYPE.KEYWORD) {
            if (cur.value === param)
                return root.nth(ix_1 + 1);
            else
                ix_1 + 1;
        }
        else {
            if (defaults && defaultIx < defaults.length) {
                var keyword = defaults[defaultIx++];
                if (keyword === param)
                    return cur;
                else
                    ix_1 + 1;
            }
            throw new Error("Param '" + param + "' not in sexpr " + root.toString());
        }
    }
    throw new Error("Param '" + param + "' not in sexpr " + root.toString());
}
exports.getArgument = getArgument;
function parseArguments(root, defaults, rest) {
    var args = {};
    var defaultIx = 0;
    var keyword;
    var kwarg = false;
    for (var _i = 0, _a = root.arguments; _i < _a.length; _i++) {
        var raw = _a[_i];
        if (raw.type === Token.TYPE.KEYWORD) {
            if (keyword)
                throw new Error("Keywords may not be values '" + raw + "'");
            else
                keyword = raw.value;
        }
        else if (keyword) {
            if (args[keyword] === undefined) {
                args[keyword] = raw;
            }
            else {
                if (!(args[keyword] instanceof Array))
                    args[keyword] = [args[keyword]];
                args[keyword].push(raw);
            }
            keyword = undefined;
            defaultIx = defaults ? defaults.length : 0;
            kwarg = true;
        }
        else if (defaults && defaultIx < defaults.length) {
            args[defaults[defaultIx++]] = raw;
        }
        else if (rest) {
            args[rest] = args[rest] || [];
            args[rest].push(raw);
        }
        else {
            if (kwarg)
                throw new Error("Cannot specify an arg after a kwarg");
            else if (defaultIx)
                throw new Error("Too many args, expected: " + defaults.length + ", got: " + (defaultIx + 1));
            else
                throw new Error("Cannot specify an arg without default keys specified");
        }
    }
    return args;
}
exports.parseArguments = parseArguments;
if (utils_1.ENV === "browser")
    window["parser"] = exports;
function instrumentQuery(q, instrument) {
    var instrumentation = instrument;
    if (!instrument || instrument === true)
        instrumentation = function (fn, args) { return console.log("*", fn, ":", args); };
    var keys = [];
    for (var key in q)
        keys.push(key);
    keys.forEach(function (fn) {
        if (!q.constructor.prototype.hasOwnProperty(fn) || typeof q[fn] !== "function")
            return;
        var old = q[fn];
        q[fn] = function () {
            instrumentation(fn, arguments);
            return old.apply(this, arguments);
        };
    });
    return q;
}
exports.instrumentQuery = instrumentQuery;
function asDiff(ixer, artifacts) {
    var views = artifacts.views;
    var diff = ixer.diff();
    for (var id in views)
        diff.merge(views[id].changeset(app_1.eve));
    return diff;
}
exports.asDiff = asDiff;
function applyAsDiffs(artifacts) {
    var views = artifacts.views;
    for (var id in views)
        app_1.eve.applyDiff(views[id].changeset(app_1.eve));
    console.log("Applied diffs for:");
    for (var id in views)
        console.log("  * ", views[id] instanceof runtime.Query ? "Query" : "Union", views[id].name);
    return artifacts;
}
exports.applyAsDiffs = applyAsDiffs;
function logArtifacts(artifacts) {
    for (var view in artifacts.views)
        console.log(view, "\n", app_1.eve.find(view));
}
exports.logArtifacts = logArtifacts;

},{"./app":9,"./runtime":15,"./utils":19}],14:[function(require,module,exports){
var microReact_1 = require("./microReact");
var utils_1 = require("./utils");
var CodeMirror = require("codemirror");
require("codemirror/mode/gfm/gfm");
require("codemirror/mode/clojure/clojure");
function replaceAll(str, find, replace) {
    var regex = new RegExp(find.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&'), 'g');
    return str.replace(regex, replace);
}
function wrapWithMarkdown(cm, wrapping) {
    cm.operation(function () {
        var from = cm.getCursor("from");
        // if there's something selected wrap it
        if (cm.somethingSelected()) {
            var selected = cm.getSelection();
            var cleaned = replaceAll(selected, wrapping, "");
            if (selected.substring(0, wrapping.length) === wrapping
                && selected.substring(selected.length - wrapping.length) === wrapping) {
                cm.replaceRange(cleaned, from, cm.getCursor("to"));
                cm.setSelection(from, cm.getCursor("from"));
            }
            else {
                var str = "" + wrapping + cleaned + wrapping;
                cm.replaceRange(str, from, cm.getCursor("to"));
                cm.setSelection(from, cm.getCursor("from"));
            }
        }
        else {
            cm.replaceRange("" + wrapping + wrapping, from);
            var newLocation = { line: from.line, ch: from.ch + wrapping.length };
            cm.setCursor(newLocation);
        }
    });
}
function prefixWithMarkdown(cm, prefix) {
    cm.operation(function () {
        var from = cm.getCursor("from");
        var to = cm.getCursor("to");
        var toPrefix = [];
        for (var lineIx = from.line; lineIx <= to.line; lineIx++) {
            var currentPrefix = cm.getRange({ line: lineIx, ch: 0 }, { line: lineIx, ch: prefix.length });
            if (currentPrefix !== prefix && currentPrefix !== "") {
                toPrefix.push(lineIx);
            }
        }
        // if everything in the selection has been prefixed, then we need to unprefix
        if (toPrefix.length === 0) {
            for (var lineIx = from.line; lineIx <= to.line; lineIx++) {
                cm.replaceRange("", { line: lineIx, ch: 0 }, { line: lineIx, ch: prefix.length });
            }
        }
        else {
            for (var _i = 0; _i < toPrefix.length; _i++) {
                var lineIx = toPrefix[_i];
                cm.replaceRange(prefix, { line: lineIx, ch: 0 });
            }
        }
    });
}
var defaultKeys = {
    "Cmd-B": function (cm) {
        wrapWithMarkdown(cm, "**");
    },
    "Cmd-I": function (cm) {
        wrapWithMarkdown(cm, "_");
    },
};
var RichTextEditor = (function () {
    function RichTextEditor(node, options) {
        //format bar
        this.formatBarDelay = 100;
        this.showingFormatBar = false;
        this.formatBarElement = null;
        this.marks = {};
        this.meta = {};
        var extraKeys = utils_1.mergeObject(utils_1.copy(defaultKeys), options.keys || {});
        this.cmInstance = CodeMirror(node, {
            mode: "eve",
            lineWrapping: true,
            autoCloseBrackets: true,
            viewportMargin: Infinity,
            extraKeys: extraKeys
        });
        var cm = this.cmInstance;
        var self = this;
        cm.on("changes", function (cm, changes) {
            self.onChanges(cm, changes);
            if (self.onUpdate) {
                self.onUpdate(self.meta, cm.getValue());
            }
        });
        cm.on("cursorActivity", function (cm) { self.onCursorActivity(cm); });
        cm.on("mousedown", function (cm, e) { self.onMouseDown(cm, e); });
        cm.getWrapperElement().addEventListener("mouseup", function (e) {
            self.onMouseUp(cm, e);
        });
    }
    RichTextEditor.prototype.showFormatBar = function () {
        //@ TODO: re-enable the format bar
        return;
        this.showingFormatBar = true;
        var renderer = new microReact_1.Renderer();
        var cm = this.cmInstance;
        var head = cm.getCursor("head");
        var from = cm.getCursor("from");
        var to = cm.getCursor("to");
        var start = cm.cursorCoords(head, "local");
        var top = start.bottom + 5;
        if ((head.line === from.line && head.ch === from.ch)
            || (cm.cursorCoords(from, "local").top === cm.cursorCoords(to, "local").top)) {
            top = start.top - 40;
        }
        var barSize = 300 / 2;
        var item = { c: "formatBar", style: "position:absolute; left: " + (start.left - barSize) + "px; top:" + top + "px;", children: [
                { c: "button ", text: "H1", click: function () { prefixWithMarkdown(cm, "# "); } },
                { c: "button ", text: "H2", click: function () { prefixWithMarkdown(cm, "## "); } },
                { c: "sep" },
                { c: "button bold", text: "B", click: function () { wrapWithMarkdown(cm, "**"); } },
                { c: "button italic", text: "I", click: function () { wrapWithMarkdown(cm, "_"); } },
                { c: "sep" },
                { c: "button ", text: "-", click: function () { prefixWithMarkdown(cm, "- "); } },
                { c: "button ", text: "1.", click: function () { prefixWithMarkdown(cm, "1. "); } },
                { c: "button ", text: "[ ]", click: function () { prefixWithMarkdown(cm, "[ ] "); } },
                { c: "sep" },
                { c: "button ", text: "link" },
            ] };
        renderer.render([item]);
        var elem = renderer.content.firstChild;
        this.formatBarElement = elem;
        cm.getWrapperElement().appendChild(elem);
        // this.cmInstance.addWidget(pos, elem);
    };
    RichTextEditor.prototype.hideFormatBar = function () {
        this.showingFormatBar = false;
        this.formatBarElement.parentNode.removeChild(this.formatBarElement);
        this.formatBarElement = null;
    };
    RichTextEditor.prototype.onChanges = function (cm, changes) {
        var self = this;
    };
    RichTextEditor.prototype.onCursorActivity = function (cm) {
        if (this.showingFormatBar && !cm.somethingSelected()) {
            this.hideFormatBar();
        }
    };
    RichTextEditor.prototype.onMouseUp = function (cm, e) {
        if (!this.showingFormatBar) {
            var self = this;
            clearTimeout(this.timeout);
            this.timeout = setTimeout(function () {
                if (cm.somethingSelected()) {
                    self.showFormatBar();
                }
            }, this.formatBarDelay);
        }
    };
    RichTextEditor.prototype.onMouseDown = function (cm, e) {
        var cursor = cm.coordsChar({ left: e.clientX, top: e.clientY });
        var pos = cm.indexFromPos(cursor);
        var marks = cm.findMarksAt(cursor);
    };
    RichTextEditor.prototype.addMark = function (paneId, cell, from, to, mark) {
        var cm = this.cmInstance;
        var cellId = cell.id;
        var dom;
        if (!mark) {
            dom = document.createElement("div");
            dom.id = paneId + "|" + cellId + "|container";
        }
        else {
            dom = mark.replacedWith;
            mark.clear();
        }
        var newMark = cm.markText(cm.posFromIndex(from), cm.posFromIndex(to), { replacedWith: dom });
        newMark.cell = cell;
        dom["mark"] = newMark;
        this.marks[cellId] = newMark;
    };
    return RichTextEditor;
})();
exports.RichTextEditor = RichTextEditor;
function createEditor(node, elem) {
    var options = elem.options || {};
    var editor = node.editor;
    var cm;
    if (!editor) {
        editor = node.editor = new RichTextEditor(node, options);
        cm = node.editor.cmInstance;
        if (!options.noFocus) {
            cm.focus();
        }
        cm.refresh(); // @FIXME: This also needs to be called any time it is hidden and added again.
    }
    else {
        cm = node.editor.cmInstance;
    }
    editor.onUpdate = elem.onUpdate;
    editor.meta = elem.meta || editor.meta;
    var doc = cm.getDoc();
    if (doc.getValue() !== elem.value) {
        doc.setValue(elem.value || "");
        doc.clearHistory();
        doc.setCursor({ line: 1, ch: 0 });
    }
    if (elem.cells) {
        cm.operation(function () {
            var cellIds = {};
            for (var _i = 0, _a = elem.cells; _i < _a.length; _i++) {
                var cell = _a[_i];
                cellIds[cell.id] = true;
                var mark = editor.marks[cell.id];
                var add = false;
                if (!mark) {
                    add = true;
                }
                else {
                    var found = mark.find();
                    if (!found) {
                        add = true;
                    }
                    else {
                        // if the mark doesn't contain the correct text, we need to nuke it.
                        var from = found.from, to = found.to;
                        if (cm.getRange(from, to) !== cell.value || cell.start !== cm.indexFromPos(from)) {
                            add = true;
                        }
                    }
                }
                if (add) {
                    editor.addMark(elem["meta"].paneId, cell, cell.start, cell.start + cell.length, mark);
                }
            }
            for (var markId in editor.marks) {
                if (!cellIds[markId]) {
                    editor.marks[markId].clear();
                    delete editor.marks[markId];
                }
            }
        });
    }
}
exports.createEditor = createEditor;
CodeMirror.defineMode("eve", function () {
    return {
        startState: function () {
            return {};
        },
        token: function (stream, state) {
            if (stream.sol() && stream.peek() === "#") {
                state.header = true;
                stream.eatWhile("#");
                state.headerNum = stream.current().length;
                return "header-indicator header-indicator-" + state.headerNum;
            }
            else if (state.header) {
                stream.skipToEnd();
                state.header = false;
                return "header header-" + state.headerNum;
            }
            else {
                state.header = false;
                stream.skipToEnd();
            }
        }
    };
});
CodeMirror.defineMIME("text/x-eve", "eve");

},{"./microReact":12,"./utils":19,"codemirror":2,"codemirror/mode/clojure/clojure":3,"codemirror/mode/gfm/gfm":4}],15:[function(require,module,exports){
var utils_1 = require("./utils");
var runtime = exports;
exports.MAX_NUMBER = 9007199254740991;
exports.INCREMENTAL = false;
function objectsIdentical(a, b) {
    var aKeys = Object.keys(a);
    for (var _i = 0; _i < aKeys.length; _i++) {
        var key = aKeys[_i];
        //TODO: handle non-scalar values
        if (a[key] !== b[key])
            return false;
    }
    return true;
}
function indexOfFact(haystack, needle) {
    var ix = 0;
    for (var _i = 0; _i < haystack.length; _i++) {
        var fact = haystack[_i];
        if (fact.__id === needle.__id) {
            return ix;
        }
        ix++;
    }
    return -1;
}
function removeFact(haystack, needle) {
    var ix = indexOfFact(haystack, needle);
    if (ix > -1)
        haystack.splice(ix, 1);
    return haystack;
}
exports.removeFact = removeFact;
function diffAddsAndRemoves(adds, removes) {
    var localHash = {};
    var hashToFact = {};
    var hashes = [];
    for (var _i = 0; _i < adds.length; _i++) {
        var add = adds[_i];
        var hash = add.__id;
        if (localHash[hash] === undefined) {
            localHash[hash] = 1;
            hashToFact[hash] = add;
            hashes.push(hash);
        }
        else {
            localHash[hash]++;
        }
        add.__id = hash;
    }
    for (var _a = 0; _a < removes.length; _a++) {
        var remove = removes[_a];
        var hash = remove.__id;
        if (localHash[hash] === undefined) {
            localHash[hash] = -1;
            hashToFact[hash] = remove;
            hashes.push(hash);
        }
        else {
            localHash[hash]--;
        }
        remove.__id = hash;
    }
    var realAdds = [];
    var realRemoves = [];
    for (var _b = 0; _b < hashes.length; _b++) {
        var hash = hashes[_b];
        var count = localHash[hash];
        if (count > 0) {
            var fact = hashToFact[hash];
            realAdds.push(fact);
        }
        else if (count < 0) {
            var fact = hashToFact[hash];
            realRemoves.push(fact);
        }
    }
    return { adds: realAdds, removes: realRemoves };
}
function generateEqualityFn(keys) {
    return new Function("a", "b", "return " + keys.map(function (key, ix) {
        if (key.constructor === Array) {
            return "a['" + key[0] + "']['" + key[1] + "'] === b['" + key[0] + "']['" + key[1] + "']";
        }
        else {
            return "a[\"" + key + "\"] === b[\"" + key + "\"]";
        }
    }).join(" && ") + ";");
}
function generateStringFn(keys) {
    var keyStrings = [];
    for (var _i = 0; _i < keys.length; _i++) {
        var key = keys[_i];
        if (key.constructor === Array) {
            keyStrings.push("a['" + key[0] + "']['" + key[1] + "']");
        }
        else {
            keyStrings.push("a['" + key + "']");
        }
    }
    var final = keyStrings.join(' + "|" + ');
    return new Function("a", "return " + final + ";");
}
function generateUnprojectedSorterCode(unprojectedSize, sorts) {
    var conditions = [];
    var path = [];
    var distance = unprojectedSize;
    for (var _i = 0; _i < sorts.length; _i++) {
        var sort = sorts[_i];
        var condition = "";
        for (var _a = 0; _a < path.length; _a++) {
            var prev = path[_a];
            var table_1 = prev[0], key_1 = prev[1];
            condition += "unprojected[j-" + (distance - table_1) + "]['" + key_1 + "'] === item" + table_1 + "['" + key_1 + "'] && ";
        }
        var table = sort[0], key = sort[1], dir = sort[2];
        var op = ">";
        if (dir === "descending") {
            op = "<";
        }
        condition += "unprojected[j-" + (distance - table) + "]['" + key + "'] " + op + " item" + table + "['" + key + "']";
        conditions.push(condition);
        path.push(sort);
    }
    var items = [];
    var repositioned = [];
    var itemAssignments = [];
    for (var ix = 0; ix < distance; ix++) {
        items.push("item" + ix + " = unprojected[j+" + ix + "]");
        repositioned.push("unprojected[j+" + ix + "] = unprojected[j - " + (distance - ix) + "]");
        itemAssignments.push(("unprojected[j+" + ix + "] = item" + ix));
    }
    return "for (var i = 0, len = unprojected.length; i < len; i += " + distance + ") {\n      var j = i, " + items.join(", ") + ";\n      for(; j > " + (distance - 1) + " && (" + conditions.join(" || ") + "); j -= " + distance + ") {\n        " + repositioned.join(";\n") + "\n      }\n      " + itemAssignments.join(";\n") + "\n  }";
}
function generateCollector(keys) {
    var code = "var runtime = this;\n";
    var ix = 0;
    var checks = "";
    var removes = "var cur = index";
    for (var _i = 0; _i < keys.length; _i++) {
        var key = keys[_i];
        if (key.constructor === Array) {
            removes += "[remove['" + key[0] + "']['" + key[1] + "']]";
        }
        else {
            removes += "[remove['" + key + "']]";
        }
    }
    removes += ";\nruntime.removeFact(cur, remove);";
    for (var _a = 0; _a < keys.length; _a++) {
        var key = keys[_a];
        ix++;
        if (key.constructor === Array) {
            checks += "value = add['" + key[0] + "']['" + key[1] + "']\n";
        }
        else {
            checks += "value = add['" + key + "']\n";
        }
        var path = "cursor[value]";
        checks += "if(!" + path + ") " + path + " = ";
        if (ix === keys.length) {
            checks += "[]\n";
        }
        else {
            checks += "{}\n";
        }
        checks += "cursor = " + path + "\n";
    }
    code += "\nfor(var ix = 0, len = removes.length; ix < len; ix++) {\nvar remove = removes[ix];\n" + removes + "\n}\nfor(var ix = 0, len = adds.length; ix < len; ix++) {\nvar add = adds[ix];\nvar cursor = index;\nvar value;\n" + checks + "  cursor.push(add);\n}\nreturn index;";
    return (new Function("index", "adds", "removes", code)).bind(runtime);
}
function generateCollector2(keys) {
    var hashParts = [];
    for (var _i = 0; _i < keys.length; _i++) {
        var key = keys[_i];
        if (key.constructor === Array) {
            hashParts.push("add['" + key[0] + "']['" + key[1] + "']");
        }
        else {
            hashParts.push("add['" + key + "']");
        }
    }
    var code = "\n    var ixCache = cache.ix;\n    var idCache = cache.id;\n    for(var ix = 0, len = removes.length; ix < len; ix++) {\n      var remove = removes[ix];\n      var id = remove.__id;\n      var key = idCache[id];\n      var factIx = ixCache[id];\n      var facts = index[key];\n      //swap the last fact with this one to prevent holes\n      var lastFact = facts.pop();\n      if(lastFact && lastFact.__id !== remove.__id) {\n        facts[factIx] = lastFact;\n        ixCache[lastFact.__id] = factIx;\n      } else if(facts.length === 0) {\n        delete index[key];\n      }\n      delete idCache[id];\n      delete ixCache[id];\n    }\n    for(var ix = 0, len = adds.length; ix < len; ix++) {\n      var add = adds[ix];\n      var id = add.__id;\n      var key = idCache[id] = " + hashParts.join(" + '|' + ") + ";\n      if(index[key] === undefined) index[key] = [];\n      var arr = index[key];\n      ixCache[id] = arr.length;\n      arr.push(add);\n    }\n    return index;";
    return new Function("index", "adds", "removes", "cache", code);
}
function mergeArrays(as, bs) {
    var ix = as.length;
    var start = ix;
    for (var _i = 0; _i < bs.length; _i++) {
        var b = bs[_i];
        as[ix] = bs[ix - start];
        ix++;
    }
    return as;
}
var Diff = (function () {
    function Diff(ixer) {
        this.ixer = ixer;
        this.tables = {};
        this.length = 0;
        this.meta = {};
    }
    Diff.prototype.ensureTable = function (table) {
        var tableDiff = this.tables[table];
        if (!tableDiff) {
            tableDiff = this.tables[table] = { adds: [], removes: [] };
        }
        return tableDiff;
    };
    Diff.prototype.add = function (table, obj) {
        var tableDiff = this.ensureTable(table);
        this.length++;
        tableDiff.adds.push(obj);
        return this;
    };
    Diff.prototype.addMany = function (table, objs) {
        var tableDiff = this.ensureTable(table);
        this.length += objs.length;
        mergeArrays(tableDiff.adds, objs);
        return this;
    };
    Diff.prototype.removeFacts = function (table, objs) {
        var tableDiff = this.ensureTable(table);
        this.length += objs.length;
        mergeArrays(tableDiff.removes, objs);
        return this;
    };
    Diff.prototype.remove = function (table, query) {
        var tableDiff = this.ensureTable(table);
        var found = this.ixer.find(table, query);
        this.length += found.length;
        mergeArrays(tableDiff.removes, found);
        return this;
    };
    Diff.prototype.merge = function (diff) {
        for (var table in diff.tables) {
            var tableDiff = diff.tables[table];
            this.addMany(table, tableDiff.adds);
            this.removeFacts(table, tableDiff.removes);
        }
        return this;
    };
    Diff.prototype.reverse = function () {
        var reversed = new Diff(this.ixer);
        for (var table in this.tables) {
            var diff = this.tables[table];
            reversed.addMany(table, diff.removes);
            reversed.removeFacts(table, diff.adds);
        }
        return reversed;
    };
    return Diff;
})();
exports.Diff = Diff;
var Indexer = (function () {
    function Indexer() {
        this.tables = {};
        this.globalCount = 0;
        this.edbTables = {};
    }
    Indexer.prototype.addTable = function (name, keys) {
        if (keys === void 0) { keys = []; }
        var table = this.tables[name];
        keys = keys.filter(function (key) { return key !== "__id"; });
        if (table && keys.length) {
            table.fields = keys;
            table.stringify = generateStringFn(keys);
        }
        else {
            table = this.tables[name] = { table: [], hashToIx: {}, factHash: {}, indexes: {}, triggers: {}, fields: keys, stringify: generateStringFn(keys), keyLookup: {} };
            this.edbTables[name] = true;
        }
        for (var _i = 0; _i < keys.length; _i++) {
            var key = keys[_i];
            if (key.constructor === Array) {
                table.keyLookup[key[0]] = key;
            }
            else {
                table.keyLookup[key] = key;
            }
        }
        return table;
    };
    Indexer.prototype.clearTable = function (name) {
        var table = this.tables[name];
        if (!table)
            return;
        table.table = [];
        table.factHash = {};
        for (var indexName in table.indexes) {
            table.indexes[indexName].index = {};
            table.indexes[indexName].cache = { id: {}, ix: {} };
        }
    };
    Indexer.prototype.updateTable = function (tableId, adds, removes) {
        var table = this.tables[tableId];
        if (!table || !table.fields.length) {
            var example = adds[0] || removes[0];
            table = this.addTable(tableId, Object.keys(example));
        }
        var stringify = table.stringify;
        var facts = table.table;
        var factHash = table.factHash;
        var hashToIx = table.hashToIx;
        var localHash = {};
        var hashToFact = {};
        var hashes = [];
        for (var _i = 0; _i < adds.length; _i++) {
            var add = adds[_i];
            var hash = add.__id || stringify(add);
            if (localHash[hash] === undefined) {
                localHash[hash] = 1;
                hashToFact[hash] = add;
                hashes.push(hash);
            }
            else {
                localHash[hash]++;
            }
            add.__id = hash;
        }
        for (var _a = 0; _a < removes.length; _a++) {
            var remove = removes[_a];
            var hash = remove.__id || stringify(remove);
            if (localHash[hash] === undefined) {
                localHash[hash] = -1;
                hashToFact[hash] = remove;
                hashes.push(hash);
            }
            else {
                localHash[hash]--;
            }
            remove.__id = hash;
        }
        var realAdds = [];
        var realRemoves = [];
        for (var _b = 0; _b < hashes.length; _b++) {
            var hash = hashes[_b];
            var count = localHash[hash];
            if (count > 0 && !factHash[hash]) {
                var fact = hashToFact[hash];
                realAdds.push(fact);
                facts.push(fact);
                factHash[hash] = fact;
                hashToIx[hash] = facts.length - 1;
            }
            else if (count < 0 && factHash[hash]) {
                var fact = hashToFact[hash];
                var ix = hashToIx[hash];
                //swap the last fact with this one to prevent holes
                var lastFact = facts.pop();
                if (lastFact && lastFact.__id !== fact.__id) {
                    facts[ix] = lastFact;
                    hashToIx[lastFact.__id] = ix;
                }
                realRemoves.push(fact);
                delete factHash[hash];
                delete hashToIx[hash];
            }
        }
        return { adds: realAdds, removes: realRemoves };
    };
    Indexer.prototype.collector = function (keys) {
        return {
            index: {},
            cache: { id: {}, ix: {} },
            hasher: generateStringFn(keys),
            collect: generateCollector2(keys),
        };
    };
    Indexer.prototype.factToIndex = function (table, fact) {
        var keys = Object.keys(fact);
        if (!keys.length)
            return table.table.slice();
        var index = this.index(table, keys);
        var result = index.index[index.hasher(fact)];
        if (result) {
            return result.slice();
        }
        return [];
    };
    Indexer.prototype.execDiff = function (diff) {
        var triggers = {};
        var realDiffs = {};
        var tableIds = Object.keys(diff.tables);
        for (var _i = 0; _i < tableIds.length; _i++) {
            var tableId = tableIds[_i];
            var tableDiff = diff.tables[tableId];
            if (tableDiff.adds.length === 0 && tableDiff.removes.length === 0)
                continue;
            var realDiff = this.updateTable(tableId, tableDiff.adds, tableDiff.removes);
            // go through all the indexes and update them.
            var table = this.tables[tableId];
            var indexes = Object.keys(table.indexes);
            for (var _a = 0; _a < indexes.length; _a++) {
                var indexName = indexes[_a];
                var index = table.indexes[indexName];
                index.collect(index.index, realDiff.adds, realDiff.removes, index.cache);
            }
            var curTriggers = Object.keys(table.triggers);
            for (var _b = 0; _b < curTriggers.length; _b++) {
                var triggerName = curTriggers[_b];
                var trigger = table.triggers[triggerName];
                triggers[triggerName] = trigger;
            }
            realDiffs[tableId] = realDiff;
        }
        return { triggers: triggers, realDiffs: realDiffs };
    };
    Indexer.prototype.execTrigger = function (trigger) {
        var table = this.table(trigger.name);
        // since views might be changed during the triggering process, we want to favor
        // just using the view itself as the trigger if it is one. Otherwise, we use the
        // trigger's exec function. This ensures that if a view is recompiled and added
        // that any already queued triggers will use the updated version of the view instead
        // of the old queued one.
        var _a = (table.view ? table.view.exec() : trigger.exec(this)) || {}, _b = _a.results, results = _b === void 0 ? undefined : _b, _c = _a.unprojected, unprojected = _c === void 0 ? undefined : _c;
        if (!results)
            return;
        var prevResults = table.factHash;
        var prevHashes = Object.keys(prevResults);
        table.unprojected = unprojected;
        if (results) {
            var diff = new Diff(this);
            this.clearTable(trigger.name);
            diff.addMany(trigger.name, results);
            var triggers = this.execDiff(diff).triggers;
            var newHashes = table.factHash;
            if (prevHashes.length === Object.keys(newHashes).length) {
                var same = true;
                for (var _i = 0; _i < prevHashes.length; _i++) {
                    var hash = prevHashes[_i];
                    if (!newHashes[hash]) {
                        same = false;
                        break;
                    }
                }
                return same ? undefined : triggers;
            }
            else {
                return triggers;
            }
        }
        return;
    };
    Indexer.prototype.transitivelyClearTriggers = function (startingTriggers) {
        var cleared = {};
        var remaining = Object.keys(startingTriggers);
        for (var ix = 0; ix < remaining.length; ix++) {
            var trigger = remaining[ix];
            if (cleared[trigger])
                continue;
            this.clearTable(trigger);
            cleared[trigger] = true;
            remaining.push.apply(remaining, Object.keys(this.table(trigger).triggers));
        }
        return cleared;
    };
    Indexer.prototype.execTriggers = function (triggers) {
        var newTriggers = {};
        var retrigger = false;
        for (var triggerName in triggers) {
            // console.log("Calling:", triggerName);
            var trigger = triggers[triggerName];
            var nextRound = this.execTrigger(trigger);
            if (nextRound) {
                retrigger = true;
                for (var trigger_1 in nextRound) {
                    // console.log("Queuing:", trigger);
                    newTriggers[trigger_1] = nextRound[trigger_1];
                }
            }
        }
        if (retrigger) {
            return newTriggers;
        }
    };
    //---------------------------------------------------------
    // Indexer Public API
    //---------------------------------------------------------
    Indexer.prototype.serialize = function (asObject) {
        var dump = {};
        for (var tableName in this.tables) {
            var table = this.tables[tableName];
            if (!table.isView) {
                dump[tableName] = table.table;
            }
        }
        if (asObject) {
            return dump;
        }
        return JSON.stringify(dump);
    };
    Indexer.prototype.load = function (serialized) {
        var dump = JSON.parse(serialized);
        var diff = this.diff();
        for (var tableName in dump) {
            diff.addMany(tableName, dump[tableName]);
        }
        if (exports.INCREMENTAL) {
            this.applyDiffIncremental(diff);
        }
        else {
            this.applyDiff(diff);
        }
    };
    Indexer.prototype.diff = function () {
        return new Diff(this);
    };
    Indexer.prototype.applyDiff = function (diff) {
        if (exports.INCREMENTAL) {
            return this.applyDiffIncremental(diff);
        }
        var _a = this.execDiff(diff), triggers = _a.triggers, realDiffs = _a.realDiffs;
        var cleared;
        var round = 0;
        if (triggers)
            cleared = this.transitivelyClearTriggers(triggers);
        while (triggers) {
            for (var trigger in triggers) {
                cleared[trigger] = false;
            }
            // console.group(`ROUND ${round}`);
            triggers = this.execTriggers(triggers);
            round++;
        }
        for (var _i = 0, _b = Object.keys(cleared); _i < _b.length; _i++) {
            var trigger = _b[_i];
            if (!cleared[trigger])
                continue;
            var view = this.table(trigger).view;
            if (view) {
                this.execTrigger(view);
            }
        }
    };
    Indexer.prototype.table = function (tableId) {
        var table = this.tables[tableId];
        if (table)
            return table;
        return this.addTable(tableId);
    };
    Indexer.prototype.index = function (tableOrId, keys) {
        var table;
        if (typeof tableOrId === "string")
            table = this.table(tableOrId);
        else
            table = tableOrId;
        keys.sort();
        var indexName = keys.filter(function (key) { return key !== "__id"; }).join("|");
        var index = table.indexes[indexName];
        if (!index) {
            var tableKeys = [];
            for (var _i = 0; _i < keys.length; _i++) {
                var key = keys[_i];
                tableKeys.push(table.keyLookup[key] || key);
            }
            index = table.indexes[indexName] = this.collector(tableKeys);
            index.collect(index.index, table.table, [], index.cache);
        }
        return index;
    };
    Indexer.prototype.find = function (tableId, query) {
        var table = this.tables[tableId];
        if (!table) {
            return [];
        }
        else if (!query) {
            return table.table.slice();
        }
        else {
            return this.factToIndex(table, query);
        }
    };
    Indexer.prototype.findOne = function (tableId, query) {
        return this.find(tableId, query)[0];
    };
    Indexer.prototype.query = function (name) {
        if (name === void 0) { name = "unknown"; }
        return new Query(this, name);
    };
    Indexer.prototype.union = function (name) {
        return new Union(this, name);
    };
    Indexer.prototype.trigger = function (name, table, exec, execIncremental) {
        var tables = (typeof table === "string") ? [table] : table;
        var trigger = { name: name, tables: tables, exec: exec, execIncremental: execIncremental };
        for (var _i = 0; _i < tables.length; _i++) {
            var tableId = tables[_i];
            var table_2 = this.table(tableId);
            table_2.triggers[name] = trigger;
        }
        if (!exports.INCREMENTAL) {
            var nextRound = this.execTrigger(trigger);
            while (nextRound) {
                nextRound = this.execTriggers(nextRound);
            }
            ;
        }
        else {
            if (!tables.length) {
                return exec(this);
            }
            var initial = (_a = {}, _a[tables[0]] = { adds: this.tables[tables[0]].table, removes: [] }, _a);
            var _b = this.execTriggerIncremental(trigger, initial), triggers = _b.triggers, changes = _b.changes;
            while (triggers) {
                var results = this.execTriggersIncremental(triggers, changes);
                if (!results)
                    break;
                triggers = results.triggers;
                changes = results.changes;
            }
        }
        var _a;
    };
    Indexer.prototype.asView = function (query) {
        var name = query.name;
        if (this.tables[name]) {
            this.removeView(name);
        }
        var view = this.table(name);
        this.edbTables[name] = false;
        view.view = query;
        view.isView = true;
        this.trigger(name, query.tables, query.exec.bind(query), query.execIncremental.bind(query));
    };
    Indexer.prototype.removeView = function (id) {
        for (var _i = 0, _a = this.tables; _i < _a.length; _i++) {
            var table = _a[_i];
            delete table.triggers[id];
        }
    };
    Indexer.prototype.totalFacts = function () {
        var total = 0;
        for (var tableName in this.tables) {
            total += this.tables[tableName].table.length;
        }
        return total;
    };
    Indexer.prototype.factsPerTable = function () {
        var info = {};
        for (var tableName in this.tables) {
            info[tableName] = this.tables[tableName].table.length;
        }
        return info;
    };
    Indexer.prototype.applyDiffIncremental = function (diff) {
        if (diff.length === 0)
            return;
        // console.log("DIFF SIZE: ", diff.length, diff);
        var _a = this.execDiff(diff), triggers = _a.triggers, realDiffs = _a.realDiffs;
        var round = 0;
        var changes = realDiffs;
        while (triggers) {
            // console.group(`ROUND ${round}`);
            // console.log("CHANGES: ", changes);
            var results = this.execTriggersIncremental(triggers, changes);
            // console.groupEnd();
            if (!results)
                break;
            triggers = results.triggers;
            changes = results.changes;
            round++;
        }
    };
    Indexer.prototype.execTriggerIncremental = function (trigger, changes) {
        var table = this.table(trigger.name);
        var adds, provenance, removes, info;
        if (trigger.execIncremental) {
            info = trigger.execIncremental(changes, table) || {};
            adds = info.adds;
            removes = info.removes;
        }
        else {
            trigger.exec();
            return;
        }
        var diff = new runtime.Diff(this);
        if (adds.length) {
            diff.addMany(trigger.name, adds);
        }
        if (removes.length) {
            diff.removeFacts(trigger.name, removes);
        }
        var updated = this.execDiff(diff);
        var realDiffs = updated.realDiffs;
        if (realDiffs[trigger.name] && (realDiffs[trigger.name].adds.length || realDiffs[trigger.name].removes)) {
            return { changes: realDiffs[trigger.name], triggers: updated.triggers };
        }
        else {
            return {};
        }
    };
    Indexer.prototype.execTriggersIncremental = function (triggers, changes) {
        var newTriggers = {};
        var nextChanges = {};
        var retrigger = false;
        var triggerKeys = Object.keys(triggers);
        for (var _i = 0; _i < triggerKeys.length; _i++) {
            var triggerName = triggerKeys[_i];
            // console.log("Calling:", triggerName);
            var trigger = triggers[triggerName];
            var nextRound = this.execTriggerIncremental(trigger, changes);
            if (nextRound && nextRound.changes) {
                nextChanges[triggerName] = nextRound.changes;
                if (nextRound.triggers) {
                    var nextRoundKeys = Object.keys(nextRound.triggers);
                    for (var _a = 0; _a < nextRoundKeys.length; _a++) {
                        var trigger_2 = nextRoundKeys[_a];
                        if (trigger_2 && nextRound.triggers[trigger_2]) {
                            retrigger = true;
                            // console.log("Queuing:", trigger);
                            newTriggers[trigger_2] = nextRound.triggers[trigger_2];
                        }
                    }
                }
            }
        }
        if (retrigger) {
            return { changes: nextChanges, triggers: newTriggers };
        }
    };
    return Indexer;
})();
exports.Indexer = Indexer;
function addProvenanceTable(ixer) {
    var table = ixer.addTable("provenance", ["table", ["row", "__id"], "row instance", "source", ["source row", "__id"]]);
    // generate some indexes that we know we're going to need upfront
    ixer.index("provenance", ["table", "row"]);
    ixer.index("provenance", ["table", "row instance"]);
    ixer.index("provenance", ["table", "source", "source row"]);
    ixer.index("provenance", ["table"]);
    return ixer;
}
exports.addProvenanceTable = addProvenanceTable;
function mappingToDiff(diff, action, mapping, aliases, reverseLookup) {
    for (var from in mapping) {
        var to = mapping[from];
        if (to.constructor === Array) {
            var source = to[0];
            if (typeof source === "number") {
                source = aliases[reverseLookup[source]];
            }
            else {
                source = aliases[source];
            }
            diff.add("action mapping", { action: action, from: from, "to source": source, "to field": to[1] });
        }
        else {
            diff.add("action mapping constant", { action: action, from: from, value: to });
        }
    }
    return diff;
}
exports.QueryFunctions = {};
var STRIP_COMMENTS = /((\/\/.*$)|(\/\*[\s\S]*?\*\/))/mg;
var ARGUMENT_NAMES = /([^\s,]+)/g;
function getParamNames(func) {
    var fnStr = func.toString().replace(STRIP_COMMENTS, '');
    var result = fnStr.slice(fnStr.indexOf('(') + 1, fnStr.indexOf(')')).match(ARGUMENT_NAMES);
    if (result === null)
        result = [];
    return result;
}
function define(name, opts, func) {
    var params = getParamNames(func);
    opts.name = name;
    opts.params = params;
    opts.func = func;
    exports.QueryFunctions[name] = opts;
}
exports.define = define;
var Query = (function () {
    function Query(ixer, name) {
        if (name === void 0) { name = "unknown"; }
        this.name = name;
        this.ixer = ixer;
        this.dirty = true;
        this.tables = [];
        this.joins = [];
        this.aliases = {};
        this.funcs = [];
        this.aggregates = [];
        this.unprojectedSize = 0;
        this.hasOrdinal = false;
    }
    Query.remove = function (view, ixer) {
        var diff = ixer.diff();
        diff.remove("view", { view: view });
        for (var _i = 0, _a = ixer.find("action", { view: view }); _i < _a.length; _i++) {
            var actionItem = _a[_i];
            var action = actionItem.action;
            diff.remove("action", { action: action });
            diff.remove("action source", { action: action });
            diff.remove("action mapping", { action: action });
            diff.remove("action mapping constant", { action: action });
            diff.remove("action mapping sorted", { action: action });
            diff.remove("action mapping limit", { action: action });
        }
        return diff;
    };
    Query.prototype.changeset = function (ixer) {
        var diff = ixer.diff();
        var aliases = {};
        var reverseLookup = {};
        for (var alias in this.aliases) {
            reverseLookup[this.aliases[alias]] = alias;
        }
        var view = this.name;
        diff.add("view", { view: view, kind: "query" });
        //joins
        for (var _i = 0, _a = this.joins; _i < _a.length; _i++) {
            var join = _a[_i];
            var action = utils_1.uuid();
            aliases[join.as] = action;
            if (!join.negated) {
                diff.add("action", { view: view, action: action, kind: "select", ix: join.ix });
            }
            else {
                diff.add("action", { view: view, action: action, kind: "deselect", ix: join.ix });
            }
            diff.add("action source", { action: action, "source view": join.table });
            mappingToDiff(diff, action, join.join, aliases, reverseLookup);
        }
        //functions
        for (var _b = 0, _c = this.funcs; _b < _c.length; _b++) {
            var func = _c[_b];
            var action = utils_1.uuid();
            aliases[func.as] = action;
            diff.add("action", { view: view, action: action, kind: "calculate", ix: func.ix });
            diff.add("action source", { action: action, "source view": func.name });
            mappingToDiff(diff, action, func.args, aliases, reverseLookup);
        }
        //aggregates
        for (var _d = 0, _e = this.aggregates; _d < _e.length; _d++) {
            var agg = _e[_d];
            var action = utils_1.uuid();
            aliases[agg.as] = action;
            diff.add("action", { view: view, action: action, kind: "aggregate", ix: agg.ix });
            diff.add("action source", { action: action, "source view": agg.name });
            mappingToDiff(diff, action, agg.args, aliases, reverseLookup);
        }
        //sort
        if (this.sorts) {
            var action = utils_1.uuid();
            diff.add("action", { view: view, action: action, kind: "sort", ix: exports.MAX_NUMBER });
            var ix = 0;
            for (var _f = 0, _g = this.sorts; _f < _g.length; _f++) {
                var sort = _g[_f];
                var source = sort[0], field = sort[1], direction = sort[2];
                if (typeof source === "number") {
                    source = aliases[reverseLookup[source]];
                }
                else {
                    source = aliases[source];
                }
                diff.add("action mapping sorted", { action: action, ix: ix, source: source, field: field, direction: direction });
                ix++;
            }
        }
        //group
        if (this.groups) {
            var action = utils_1.uuid();
            diff.add("action", { view: view, action: action, kind: "group", ix: exports.MAX_NUMBER });
            var ix = 0;
            for (var _h = 0, _j = this.groups; _h < _j.length; _h++) {
                var group = _j[_h];
                var source = group[0], field = group[1];
                if (typeof source === "number") {
                    source = aliases[reverseLookup[source]];
                }
                else {
                    source = aliases[source];
                }
                diff.add("action mapping sorted", { action: action, ix: ix, source: source, field: field, direction: "ascending" });
                ix++;
            }
        }
        //limit
        if (this.limitInfo) {
            var action = utils_1.uuid();
            diff.add("action", { view: view, action: action, kind: "limit", ix: exports.MAX_NUMBER });
            for (var limitType in this.limitInfo) {
                diff.add("action mapping limit", { action: action, "limit type": limitType, value: this.limitInfo[limitType] });
            }
        }
        //projection
        if (this.projectionMap) {
            var action = utils_1.uuid();
            diff.add("action", { view: view, action: action, kind: "project", ix: exports.MAX_NUMBER });
            mappingToDiff(diff, action, this.projectionMap, aliases, reverseLookup);
        }
        return diff;
    };
    Query.prototype.validateFields = function (tableName, joinObject) {
        var table = this.ixer.table(tableName);
        for (var field in joinObject) {
            if (table.fields.length && !table.keyLookup[field]) {
                throw new Error("Table '" + tableName + "' doesn't have a field '" + field + "'.\n\nAvailable fields: " + table.fields.join(", "));
            }
            var joinInfo = joinObject[field];
            if (joinInfo.constructor === Array) {
                var joinNumber = joinInfo[0], referencedField = joinInfo[1];
                if (typeof joinNumber !== "number") {
                    joinNumber = this.aliases[joinNumber];
                }
                var join = this.joins[joinNumber];
                if (join && join.ix === joinNumber) {
                    var referencedTable = this.ixer.table(join.table);
                    if (!referencedTable.fields.length)
                        continue;
                    if (!referencedTable.keyLookup[referencedField]) {
                        throw new Error("Table '" + join.table + "' doesn't have a field '" + referencedField + "'.\n\nAvailable fields: " + referencedTable.fields.join(", "));
                    }
                }
            }
        }
    };
    Query.prototype.select = function (table, join, as) {
        this.dirty = true;
        if (as) {
            this.aliases[as] = Object.keys(this.aliases).length;
        }
        this.unprojectedSize++;
        this.tables.push(table);
        this.validateFields(table, join);
        this.joins.push({ negated: false, table: table, join: join, as: as, ix: this.aliases[as] });
        return this;
    };
    Query.prototype.deselect = function (table, join) {
        this.dirty = true;
        this.tables.push(table);
        this.validateFields(table, join);
        this.joins.push({ negated: true, table: table, join: join, ix: this.joins.length * 1000 });
        return this;
    };
    Query.prototype.calculate = function (funcName, args, as) {
        this.dirty = true;
        if (as) {
            this.aliases[as] = Object.keys(this.aliases).length;
        }
        if (!exports.QueryFunctions[funcName].filter) {
            this.unprojectedSize++;
        }
        this.funcs.push({ name: funcName, args: args, as: as, ix: this.aliases[as] });
        return this;
    };
    Query.prototype.project = function (projectionMap) {
        this.projectionMap = projectionMap;
        this.validateFields(undefined, projectionMap);
        return this;
    };
    Query.prototype.group = function (groups) {
        this.dirty = true;
        if (groups[0] && groups[0].constructor === Array) {
            this.groups = groups;
        }
        else {
            if (!this.groups)
                this.groups = [];
            this.groups.push(groups);
        }
        return this;
    };
    Query.prototype.sort = function (sorts) {
        this.dirty = true;
        if (sorts[0] && sorts[0].constructor === Array) {
            this.sorts = sorts;
        }
        else {
            if (!this.sorts)
                this.sorts = [];
            this.sorts.push(sorts);
        }
        return this;
    };
    Query.prototype.limit = function (limitInfo) {
        this.dirty = true;
        if (!this.limitInfo) {
            this.limitInfo = {};
        }
        for (var key in limitInfo) {
            this.limitInfo[key] = limitInfo[key];
        }
        return this;
    };
    Query.prototype.aggregate = function (funcName, args, as) {
        this.dirty = true;
        if (as) {
            this.aliases[as] = Object.keys(this.aliases).length;
        }
        this.unprojectedSize++;
        this.aggregates.push({ name: funcName, args: args, as: as, ix: this.aliases[as] });
        return this;
    };
    Query.prototype.ordinal = function () {
        this.dirty = true;
        this.hasOrdinal = true;
        this.unprojectedSize++;
        return this;
    };
    Query.prototype.applyAliases = function (joinMap) {
        for (var field in joinMap) {
            var joinInfo = joinMap[field];
            if (joinInfo.constructor !== Array || typeof joinInfo[0] === "number")
                continue;
            var joinTable = joinInfo[0];
            if (joinTable === "ordinal") {
                joinInfo[0] = this.unprojectedSize - 1;
            }
            else if (this.aliases[joinTable] !== undefined) {
                joinInfo[0] = this.aliases[joinTable];
            }
            else {
                throw new Error("Invalid alias used: " + joinTable);
            }
        }
    };
    Query.prototype.toAST = function () {
        var cursor = { type: "query",
            children: [] };
        var root = cursor;
        var results = [];
        // by default the only thing we return are the unprojected results
        var returns = ["unprojected", "provenance"];
        // we need an array to store our unprojected results
        root.children.push({ type: "declaration", var: "unprojected", value: "[]" });
        root.children.push({ type: "declaration", var: "provenance", value: "[]" });
        root.children.push({ type: "declaration", var: "projected", value: "{}" });
        // run through each table nested in the order they were given doing pairwise
        // joins along the way.
        for (var _i = 0, _a = this.joins; _i < _a.length; _i++) {
            var join = _a[_i];
            var table = join.table, ix = join.ix, negated = join.negated;
            var cur = {
                type: "select",
                table: table,
                passed: ix === 0,
                ix: ix,
                negated: negated,
                children: [],
                join: false,
            };
            // we only want to eat the cost of dealing with indexes
            // if we are actually joining on something
            var joinMap = join.join;
            this.applyAliases(joinMap);
            if (joinMap && Object.keys(joinMap).length !== 0) {
                root.children.unshift({ type: "declaration", var: "query" + ix, value: "{}" });
                cur.join = joinMap;
            }
            cursor.children.push(cur);
            if (!negated) {
                results.push({ type: "select", ix: ix });
            }
            cursor = cur;
        }
        // at the bottom of the joins, we calculate all the functions based on the values
        // collected
        for (var _b = 0, _c = this.funcs; _b < _c.length; _b++) {
            var func = _c[_b];
            var args = func.args, name_1 = func.name, ix = func.ix;
            var funcInfo = exports.QueryFunctions[name_1];
            this.applyAliases(args);
            root.children.unshift({ type: "functionDeclaration", ix: ix, info: funcInfo });
            if (funcInfo.multi || funcInfo.filter) {
                var node = { type: "functionCallMultiReturn", ix: ix, args: args, info: funcInfo, children: [] };
                cursor.children.push(node);
                cursor = node;
            }
            else {
                cursor.children.push({ type: "functionCall", ix: ix, args: args, info: funcInfo, children: [] });
            }
            if (!funcInfo.noReturn && !funcInfo.filter) {
                results.push({ type: "function", ix: ix });
            }
        }
        // now that we're at the bottom of the join, store the unprojected result
        cursor.children.push({ type: "result", results: results });
        //Aggregation
        //sort the unprojected results based on groupings and the given sorts
        var sorts = [];
        var alreadySorted = {};
        if (this.groups) {
            this.applyAliases(this.groups);
            for (var _d = 0, _e = this.groups; _d < _e.length; _d++) {
                var group = _e[_d];
                var table = group[0], field = group[1];
                sorts.push(group);
                alreadySorted[(table + "|" + field)] = true;
            }
        }
        if (this.sorts) {
            this.applyAliases(this.sorts);
            for (var _f = 0, _g = this.sorts; _f < _g.length; _f++) {
                var sort = _g[_f];
                var table = sort[0], field = sort[1];
                if (!alreadySorted[(table + "|" + field)]) {
                    sorts.push(sort);
                }
            }
        }
        var size = this.unprojectedSize;
        if (sorts.length) {
            root.children.push({ type: "sort", sorts: sorts, size: size, children: [] });
        }
        //then we need to run through the sorted items and do the aggregate as a fold.
        if (this.aggregates.length || sorts.length || this.limitInfo || this.hasOrdinal) {
            // we need to store group info for post processing of the unprojected results
            // this will indicate what group number, if any, that each unprojected result belongs to
            root.children.unshift({ type: "declaration", var: "groupInfo", value: "[]" });
            returns.push("groupInfo");
            var aggregateChildren = [];
            for (var _h = 0, _j = this.aggregates; _h < _j.length; _h++) {
                var func = _j[_h];
                var args = func.args, name_2 = func.name, ix = func.ix;
                var funcInfo = exports.QueryFunctions[name_2];
                this.applyAliases(args);
                root.children.unshift({ type: "functionDeclaration", ix: ix, info: funcInfo });
                aggregateChildren.push({ type: "functionCall", ix: ix, resultsIx: results.length, args: args, info: funcInfo, unprojected: true, children: [] });
                results.push({ type: "placeholder" });
            }
            if (this.hasOrdinal === true) {
                aggregateChildren.push({ type: "ordinal" });
                results.push({ type: "placeholder" });
            }
            var aggregate = { type: "aggregate loop", groups: this.groups, limit: this.limitInfo, size: size, children: aggregateChildren };
            root.children.push(aggregate);
            cursor = aggregate;
        }
        if (this.projectionMap) {
            this.applyAliases(this.projectionMap);
            root.children.unshift({ type: "declaration", var: "results", value: "[]" });
            if (exports.INCREMENTAL) {
                cursor.children.push({ type: "provenance" });
            }
            cursor.children.push({ type: "projection", projectionMap: this.projectionMap, unprojected: this.aggregates.length });
            returns.push("results");
        }
        root.children.push({ type: "return", vars: returns });
        return root;
    };
    Query.prototype.compileParamString = function (funcInfo, args, unprojected) {
        if (unprojected === void 0) { unprojected = false; }
        var code = "";
        var params = funcInfo.params;
        if (unprojected)
            params = params.slice(1);
        for (var _i = 0; _i < params.length; _i++) {
            var param = params[_i];
            var arg = args[param];
            var argCode = void 0;
            if (arg.constructor === Array) {
                var property = "";
                if (arg[1]) {
                    property = "['" + arg[1] + "']";
                }
                if (!unprojected) {
                    argCode = "row" + arg[0] + property;
                }
                else {
                    argCode = "unprojected[ix + " + arg[0] + "]" + property;
                }
            }
            else {
                argCode = JSON.stringify(arg);
            }
            code += argCode + ", ";
        }
        return code.substring(0, code.length - 2);
    };
    Query.prototype.compileAST = function (root) {
        var code = "";
        var type = root.type;
        switch (type) {
            case "query":
                for (var _i = 0, _a = root.children; _i < _a.length; _i++) {
                    var child = _a[_i];
                    code += this.compileAST(child);
                }
                break;
            case "declaration":
                code += "var " + root.var + " = " + root.value + ";\n";
                break;
            case "functionDeclaration":
                code += "var func" + root.ix + " = QueryFunctions['" + root.info.name + "'].func;\n";
                break;
            case "functionCall":
                var ix = root.ix;
                var prev = "";
                if (root.unprojected) {
                    prev = "row" + ix;
                    if (root.info.params.length > 1)
                        prev += ",";
                }
                code += "var row" + ix + " = func" + ix + "(" + prev + this.compileParamString(root.info, root.args, root.unprojected) + ");\n";
                break;
            case "functionCallMultiReturn":
                var ix = root.ix;
                code += "var rows" + ix + " = func" + ix + "(" + this.compileParamString(root.info, root.args) + ");\n";
                code += "for(var funcResultIx" + ix + " = 0, funcLen" + ix + " = rows" + ix + ".length; funcResultIx" + ix + " < funcLen" + ix + "; funcResultIx" + ix + "++) {\n";
                code += "var row" + ix + " = rows" + ix + "[funcResultIx" + ix + "];\n";
                for (var _b = 0, _c = root.children; _b < _c.length; _b++) {
                    var child = _c[_b];
                    code += this.compileAST(child);
                }
                code += "}\n";
                break;
            case "select":
                var ix = root.ix;
                if (root.passed) {
                    code += "var rows" + ix + " = rootRows;\n";
                }
                else if (root.join) {
                    for (var key in root.join) {
                        var mapping = root.join[key];
                        if (mapping.constructor === Array) {
                            var tableIx = mapping[0], value = mapping[1];
                            code += "query" + ix + "['" + key + "'] = row" + tableIx + "['" + value + "'];\n";
                        }
                        else {
                            code += "query" + ix + "['" + key + "'] = " + JSON.stringify(mapping) + ";\n";
                        }
                    }
                    code += "var rows" + ix + " = ixer.factToIndex(ixer.table('" + root.table + "'), query" + ix + ");\n";
                }
                else {
                    code += "var rows" + ix + " = ixer.table('" + root.table + "').table;\n";
                }
                if (!root.negated) {
                    code += "for(var rowIx" + ix + " = 0, rowsLen" + ix + " = rows" + ix + ".length; rowIx" + ix + " < rowsLen" + ix + "; rowIx" + ix + "++) {\n";
                    code += "var row" + ix + " = rows" + ix + "[rowIx" + ix + "];\n";
                }
                else {
                    code += "if(!rows" + ix + ".length) {\n";
                }
                for (var _d = 0, _e = root.children; _d < _e.length; _d++) {
                    var child = _e[_d];
                    code += this.compileAST(child);
                }
                code += "}\n";
                break;
            case "result":
                var results = [];
                for (var _f = 0, _g = root.results; _f < _g.length; _f++) {
                    var result = _g[_f];
                    if (result.type === "placeholder") {
                        results.push("undefined");
                    }
                    else {
                        var ix_1 = result.ix;
                        results.push("row" + ix_1);
                    }
                }
                code += "unprojected.push(" + results.join(", ") + ");\n";
                break;
            case "sort":
                code += generateUnprojectedSorterCode(root.size, root.sorts) + "\n";
                break;
            case "aggregate loop":
                var projection = "";
                var aggregateCalls = [];
                var aggregateStates = [];
                var aggregateResets = [];
                var unprojected = {};
                var ordinal = false;
                var provenanceCode;
                for (var _h = 0, _j = root.children; _h < _j.length; _h++) {
                    var agg = _j[_h];
                    if (agg.type === "functionCall") {
                        unprojected[agg.ix] = true;
                        var compiled = this.compileAST(agg);
                        compiled += "\nunprojected[ix + " + agg.resultsIx + "] = row" + agg.ix + ";\n";
                        aggregateCalls.push(compiled);
                        aggregateStates.push("var row" + agg.ix + " = {};");
                        aggregateResets.push("row" + agg.ix + " = {};");
                    }
                    else if (agg.type === "projection") {
                        agg.unprojected = unprojected;
                        projection = this.compileAST(agg);
                    }
                    else if (agg.type === "ordinal") {
                        ordinal = "unprojected[ix+" + (this.unprojectedSize - 1) + "] = resultCount;\n";
                    }
                    else if (agg.type === "provenance") {
                        provenanceCode = this.compileAST(agg);
                    }
                }
                var aggregateCallsCode = aggregateCalls.join("");
                var differentGroupChecks = [];
                var groupCheck = "false";
                if (root.groups) {
                    for (var _k = 0, _l = root.groups; _k < _l.length; _k++) {
                        var group = _l[_k];
                        var table = group[0], field = group[1];
                        differentGroupChecks.push("unprojected[nextIx + " + table + "]['" + field + "'] !== unprojected[ix + " + table + "]['" + field + "']");
                    }
                    groupCheck = "(" + differentGroupChecks.join(" || ") + ")";
                }
                var resultsCheck = "";
                if (root.limit && root.limit.results) {
                    var limitValue = root.limit.results;
                    var offset = root.limit.offset;
                    if (offset) {
                        limitValue += offset;
                        projection = "if(resultCount >= " + offset + ") {\n              " + projection + "\n            }";
                    }
                    resultsCheck = "if(resultCount === " + limitValue + ") break;";
                }
                var groupLimitCheck = "";
                if (root.limit && root.limit.perGroup && root.groups) {
                    var limitValue = root.limit.perGroup;
                    var offset = root.limit.offset;
                    if (offset) {
                        limitValue += offset;
                        aggregateCallsCode = "if(perGroupCount >= " + offset + ") {\n              " + aggregateCallsCode + "\n            }";
                    }
                    groupLimitCheck = "if(perGroupCount === " + limitValue + ") {\n            while(!differentGroup) {\n              nextIx += " + root.size + ";\n              if(nextIx >= len) break;\n              groupInfo[nextIx] = undefined;\n              differentGroup = " + groupCheck + ";\n            }\n          }";
                }
                var groupDifference = "";
                var groupInfo = "";
                if (this.groups) {
                    groupInfo = "groupInfo[ix] = resultCount;";
                    var groupProjection = projection + "resultCount++;";
                    if (root.limit && root.limit.offset) {
                        groupProjection = "if(perGroupCount > " + root.limit.offset + ") {\n              " + groupProjection + "\n            }";
                        groupInfo = "if(perGroupCount >= " + root.limit.offset + ") {\n              " + groupInfo + "\n            }";
                    }
                    groupDifference = "\n          perGroupCount++\n          var differentGroup = " + groupCheck + ";\n          " + groupLimitCheck + "\n          if(differentGroup) {\n            " + groupProjection + "\n            " + aggregateResets.join("\n") + "\n            perGroupCount = 0;\n          }\n";
                }
                else {
                    groupDifference = "resultCount++;\n";
                    groupInfo = "groupInfo[ix] = 0;";
                }
                // if there are neither aggregates to calculate nor groups to build,
                // then we just need to worry about limiting
                if (!this.groups && aggregateCalls.length === 0) {
                    code = "var ix = 0;\n                  var resultCount = 0;\n                  var len = unprojected.length;\n                  while(ix < len) {\n                    " + resultsCheck + "\n                    " + (ordinal || "") + "\n                    " + provenanceCode + "\n                    " + projection + "\n                    groupInfo[ix] = resultCount;\n                    resultCount++;\n                    ix += " + root.size + ";\n                  }\n";
                    break;
                }
                code = "var resultCount = 0;\n                var perGroupCount = 0;\n                var ix = 0;\n                var nextIx = 0;\n                var len = unprojected.length;\n                " + aggregateStates.join("\n") + "\n                while(ix < len) {\n                  " + aggregateCallsCode + "\n                  " + groupInfo + "\n                  " + (ordinal || "") + "\n                  " + provenanceCode + "\n                  if(ix + " + root.size + " === len) {\n                    " + projection + "\n                    break;\n                  }\n                  nextIx += " + root.size + ";\n                  " + groupDifference + "\n                  " + resultsCheck + "\n                  ix = nextIx;\n                }\n";
                break;
            case "projection":
                var projectedVars = [];
                var idStringParts = [];
                for (var newField in root.projectionMap) {
                    var mapping = root.projectionMap[newField];
                    var value = "";
                    if (mapping.constructor === Array) {
                        if (mapping[1] === undefined) {
                            value = "unprojected[ix + " + mapping[0] + "]";
                        }
                        else if (!root.unprojected || root.unprojected[mapping[0]]) {
                            value = "row" + mapping[0] + "['" + mapping[1] + "']";
                        }
                        else {
                            value = "unprojected[ix + " + mapping[0] + "]['" + mapping[1] + "']";
                        }
                    }
                    else {
                        value = JSON.stringify(mapping);
                    }
                    projectedVars.push("projected['" + newField.replace(/'/g, "\\'") + "'] = " + value);
                    idStringParts.push(value);
                }
                code += projectedVars.join(";\n") + "\n";
                code += "projected.__id = " + idStringParts.join(" + \"|\" + ") + ";\n";
                code += "results.push(projected);\n";
                code += "projected = {};\n";
                break;
            case "provenance":
                var provenance = "var provenance__id = '';\n";
                var ids = [];
                for (var _m = 0, _o = this.joins; _m < _o.length; _m++) {
                    var join = _o[_m];
                    if (join.negated)
                        continue;
                    provenance += "provenance__id = tableId + '|' + projected.__id + '|' + rowInstance + '|" + join.table + "|' + row" + join.ix + ".__id; \n";
                    provenance += "provenance.push({table: tableId, row: projected, \"row instance\": rowInstance, source: \"" + join.table + "\", \"source row\": row" + join.ix + "});\n";
                    ids.push("row" + join.ix + ".__id");
                }
                code = "var rowInstance = " + ids.join(" + '|' + ") + ";\n        " + provenance;
                break;
            case "return":
                var returns = [];
                for (var _p = 0, _q = root.vars; _p < _q.length; _p++) {
                    var curVar = _q[_p];
                    returns.push(curVar + ": " + curVar);
                }
                code += "return {" + returns.join(", ") + "};";
                break;
        }
        return code;
    };
    // given a set of changes and a join order, determine the root facts that need
    // to be joined again to cover all the adds
    Query.prototype.reverseJoin = function (joins) {
        var changed = joins[0];
        var reverseJoinMap = {};
        // collect all the constraints and reverse them
        for (var _i = 0; _i < joins.length; _i++) {
            var join = joins[_i];
            for (var key in join.join) {
                var _a = join.join[key], source = _a[0], field = _a[1];
                if (source <= changed.ix) {
                    if (!reverseJoinMap[source]) {
                        reverseJoinMap[source] = {};
                    }
                    if (!reverseJoinMap[source][field])
                        reverseJoinMap[source][field] = [join.ix, key];
                }
            }
        }
        var recurse = function (joins, joinIx) {
            var code = "";
            if (joinIx >= joins.length) {
                return "others.push(row0)";
            }
            var _a = joins[joinIx], table = _a.table, ix = _a.ix, negated = _a.negated;
            var joinMap = joins[joinIx].join;
            // we only care about this guy if he's joined with at least one thing
            if (!reverseJoinMap[ix] && joinIx < joins.length - 1)
                return recurse(joins, joinIx + 1);
            else if (!reverseJoinMap)
                return "";
            var mappings = [];
            for (var key in reverseJoinMap[ix]) {
                var _b = reverseJoinMap[ix][key], sourceIx = _b[0], field = _b[1];
                if (sourceIx === changed.ix || reverseJoinMap[sourceIx] !== undefined) {
                    mappings.push("'" + key + "': row" + sourceIx + "['" + field + "']");
                }
            }
            for (var key in joinMap) {
                var value = joinMap[key];
                if (value.constructor !== Array) {
                    mappings.push("'" + key + "': " + JSON.stringify(value));
                }
            }
            if (negated) {
            }
            code += "\n            var rows" + ix + " = eve.find('" + table + "', {" + mappings.join(", ") + "});\n            for(var rowsIx" + ix + " = 0, rowsLen" + ix + " = rows" + ix + ".length; rowsIx" + ix + " < rowsLen" + ix + "; rowsIx" + ix + "++) {\n                var row" + ix + " = rows" + ix + "[rowsIx" + ix + "];\n                " + recurse(joins, joinIx + 1) + "\n            }\n            ";
            return code;
        };
        return recurse(joins, 1);
    };
    Query.prototype.compileIncrementalRowFinderCode = function () {
        var code = "var others = [];\n";
        var reversed = this.joins.slice().reverse();
        var checks = [];
        var ix = 0;
        for (var _i = 0; _i < reversed.length; _i++) {
            var join = reversed[_i];
            // we don't want to do this for the root
            if (ix === reversed.length - 1)
                break;
            checks.push("\n\t\t\tif(changes[\"" + join.table + "\"] && changes[\"" + join.table + "\"].adds) {\n                var curChanges" + join.ix + " = changes[\"" + join.table + "\"].adds;\n                for(var changeIx" + join.ix + " = 0, changeLen" + join.ix + " = curChanges" + join.ix + ".length; changeIx" + join.ix + " < changeLen" + join.ix + "; changeIx" + join.ix + "++) {\n                    var row" + join.ix + " = curChanges" + join.ix + "[changeIx" + join.ix + "];\n\t\t\t\t\t" + this.reverseJoin(reversed.slice(ix)) + "\n\t\t\t\t}\n\t\t\t}");
            ix++;
        }
        code += checks.join(" else");
        var last = reversed[ix];
        code += "\n\t\t\tif(changes[\"" + last.table + "\"] && changes[\"" + last.table + "\"].adds) {\n                var curChanges = changes[\"" + last.table + "\"].adds;\n\t\t\t\tfor(var changeIx = 0, changeLen = curChanges.length; changeIx < changeLen; changeIx++) {\n\t\t\t\t\tothers.push(curChanges[changeIx]);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn others;";
        return code;
    };
    Query.prototype.incrementalRemove = function (changes) {
        var ixer = this.ixer;
        var rowsToPostCheck = [];
        var provenanceDiff = this.ixer.diff();
        var removes = [];
        var indexes = ixer.table("provenance").indexes;
        var sourceRowLookup = indexes["source|source row|table"].index;
        var rowInstanceLookup = indexes["row instance|table"].index;
        var tableRowLookup = indexes["row|table"].index;
        var provenanceRemoves = [];
        var visited = {};
        for (var _i = 0, _a = this.joins; _i < _a.length; _i++) {
            var join = _a[_i];
            var change = changes[join.table];
            if (!visited[join.table] && change && change.removes.length) {
                visited[join.table] = true;
                for (var _b = 0, _c = change.removes; _b < _c.length; _b++) {
                    var remove = _c[_b];
                    var provenances = sourceRowLookup[join.table + '|' + remove.__id + '|' + this.name];
                    if (provenances) {
                        for (var _d = 0; _d < provenances.length; _d++) {
                            var provenance = provenances[_d];
                            if (!visited[provenance["row instance"]]) {
                                visited[provenance["row instance"]] = true;
                                var relatedProvenance = rowInstanceLookup[provenance["row instance"] + '|' + provenance.table];
                                for (var _e = 0; _e < relatedProvenance.length; _e++) {
                                    var related = relatedProvenance[_e];
                                    provenanceRemoves.push(related);
                                }
                            }
                            rowsToPostCheck.push(provenance);
                        }
                    }
                }
            }
        }
        provenanceDiff.removeFacts("provenance", provenanceRemoves);
        ixer.applyDiffIncremental(provenanceDiff);
        var isEdb = ixer.edbTables;
        for (var _f = 0; _f < rowsToPostCheck.length; _f++) {
            var row = rowsToPostCheck[_f];
            var supports = tableRowLookup[row.row.__id + '|' + row.table];
            if (!supports || supports.length === 0) {
                removes.push(row.row);
            }
        }
        return removes;
    };
    Query.prototype.canBeIncremental = function () {
        if (this.aggregates.length)
            return false;
        if (this.sorts)
            return false;
        if (this.groups)
            return false;
        if (this.limitInfo)
            return false;
        for (var _i = 0, _a = this.joins; _i < _a.length; _i++) {
            var join = _a[_i];
            if (join.negated)
                return false;
        }
        if (!this.joins.length)
            return false;
        return true;
    };
    Query.prototype.compile = function () {
        var ast = this.toAST();
        var code = this.compileAST(ast);
        this.compiled = new Function("ixer", "QueryFunctions", "tableId", "rootRows", code);
        if (this.canBeIncremental()) {
            this.incrementalRowFinder = new Function("changes", this.compileIncrementalRowFinderCode());
        }
        else {
            this.incrementalRowFinder = undefined;
        }
        this.dirty = false;
        return this;
    };
    Query.prototype.exec = function () {
        if (this.dirty) {
            this.compile();
        }
        var root = this.joins[0];
        var rows;
        if (root) {
            rows = this.ixer.find(root.table, root.join);
        }
        else {
            rows = [];
        }
        return this.compiled(this.ixer, exports.QueryFunctions, this.name, rows);
    };
    Query.prototype.execIncremental = function (changes, table) {
        if (this.dirty) {
            this.compile();
        }
        if (this.incrementalRowFinder) {
            var potentialRows = this.incrementalRowFinder(changes);
            // if the root select has some constant filters, then
            // the above rows need to be filtered down to only those that
            // match.
            var rows = [];
            var root = this.joins[0];
            var rootKeys = Object.keys(root.join);
            if (rootKeys.length > 0) {
                rowLoop: for (var _i = 0; _i < potentialRows.length; _i++) {
                    var row = potentialRows[_i];
                    for (var _a = 0; _a < rootKeys.length; _a++) {
                        var key = rootKeys[_a];
                        if (row[key] !== root.join[key])
                            continue rowLoop;
                    }
                    rows.push(row);
                }
            }
            else {
                rows = potentialRows;
            }
            var results = this.compiled(this.ixer, exports.QueryFunctions, this.name, rows);
            var adds = [];
            var prevHashes = table.factHash;
            var prevKeys = Object.keys(prevHashes);
            var suggestedRemoves = this.incrementalRemove(changes);
            var realDiff = diffAddsAndRemoves(results.results, suggestedRemoves);
            for (var _b = 0, _c = realDiff.adds; _b < _c.length; _b++) {
                var result = _c[_b];
                var id = result.__id;
                if (prevHashes[id] === undefined) {
                    adds.push(result);
                }
            }
            var diff = this.ixer.diff();
            diff.addMany("provenance", results.provenance);
            this.ixer.applyDiffIncremental(diff);
            // console.log("INC PROV DIFF", this.name, diff.length);
            return { provenance: results.provenance, adds: adds, removes: realDiff.removes };
        }
        else {
            var results = this.exec();
            var adds = [];
            var removes = [];
            var prevHashes = table.factHash;
            var prevKeys = Object.keys(prevHashes);
            var newHashes = {};
            for (var _d = 0, _e = results.results; _d < _e.length; _d++) {
                var result = _e[_d];
                var id = result.__id;
                newHashes[id] = result;
                if (prevHashes[id] === undefined) {
                    adds.push(result);
                }
            }
            for (var _f = 0; _f < prevKeys.length; _f++) {
                var hash = prevKeys[_f];
                var value = newHashes[hash];
                if (value === undefined) {
                    removes.push(prevHashes[hash]);
                }
            }
            var realDiff = diffAddsAndRemoves(adds, removes);
            var diff = this.ixer.diff();
            diff.remove("provenance", { table: this.name });
            diff.addMany("provenance", results.provenance);
            this.ixer.applyDiffIncremental(diff);
            // console.log("FULL PROV SIZE", this.name, diff.length);
            return { provenance: results.provenance, adds: realDiff.adds, removes: realDiff.removes };
        }
    };
    Query.prototype.debug = function () {
        console.log(this.compileAST(this.toAST()));
        console.time("exec");
        var results = this.exec();
        console.timeEnd("exec");
        console.log(results);
        return results;
    };
    return Query;
})();
exports.Query = Query;
var Union = (function () {
    function Union(ixer, name) {
        if (name === void 0) { name = "unknown"; }
        this.name = name;
        this.ixer = ixer;
        this.tables = [];
        this.sources = [];
        this.isStateful = false;
        this.prev = { results: [], hashes: {} };
        this.dirty = true;
    }
    Union.prototype.changeset = function (ixer) {
        var diff = ixer.diff();
        diff.add("view", { view: this.name, kind: "union" });
        for (var _i = 0, _a = this.sources; _i < _a.length; _i++) {
            var source = _a[_i];
            if (source.type === "+") {
                var action = utils_1.uuid();
                diff.add("action", { view: this.name, action: action, kind: "union", ix: 0 });
                diff.add("action source", { action: action, "source view": source.table });
                for (var field in source.mapping) {
                    var mapped = source.mapping[field];
                    if (mapped.constructor === Array)
                        diff.add("action mapping", { action: action, from: field, "to source": source.table, "to field": mapped[0] });
                    else
                        diff.add("action mapping constant", { action: action, from: field, value: mapped });
                }
            }
            else
                throw new Error("Unknown source type: '" + source.type + "'");
        }
        return diff;
    };
    Union.prototype.ensureHasher = function (mapping) {
        if (!this.hasher) {
            this.hasher = generateStringFn(Object.keys(mapping));
        }
    };
    Union.prototype.union = function (tableName, mapping) {
        this.dirty = true;
        this.ensureHasher(mapping);
        this.tables.push(tableName);
        this.sources.push({ type: "+", table: tableName, mapping: mapping });
        return this;
    };
    Union.prototype.toAST = function () {
        var root = { type: "union", children: [] };
        root.children.push({ type: "declaration", var: "results", value: "[]" });
        root.children.push({ type: "declaration", var: "provenance", value: "[]" });
        var hashesValue = "{}";
        if (this.isStateful) {
            hashesValue = "prevHashes";
        }
        root.children.push({ type: "declaration", var: "hashes", value: hashesValue });
        var ix = 0;
        for (var _i = 0, _a = this.sources; _i < _a.length; _i++) {
            var source = _a[_i];
            var action = void 0;
            if (source.type === "+") {
                action = { type: "result", ix: ix, children: [{ type: "provenance", source: source, ix: ix }] };
            }
            root.children.push({
                type: "source",
                ix: ix,
                table: source.table,
                mapping: source.mapping,
                children: [action],
            });
            ix++;
        }
        root.children.push({ type: "hashesToResults" });
        root.children.push({ type: "return", vars: ["results", "hashes", "provenance"] });
        return root;
    };
    Union.prototype.compileAST = function (root) {
        var code = "";
        var type = root.type;
        switch (type) {
            case "union":
                for (var _i = 0, _a = root.children; _i < _a.length; _i++) {
                    var child = _a[_i];
                    code += this.compileAST(child);
                }
                break;
            case "declaration":
                code += "var " + root.var + " = " + root.value + ";\n";
                break;
            case "source":
                var ix = root.ix;
                var mappingItems = [];
                for (var key in root.mapping) {
                    var mapping = root.mapping[key];
                    var value = void 0;
                    if (mapping.constructor === Array && mapping.length === 1) {
                        var field = mapping[0];
                        value = "sourceRow" + ix + "['" + field + "']";
                    }
                    else if (mapping.constructor === Array && mapping.length === 2) {
                        var _ = mapping[0], field = mapping[1];
                        value = "sourceRow" + ix + "['" + field + "']";
                    }
                    else {
                        value = JSON.stringify(mapping);
                    }
                    mappingItems.push("'" + key + "': " + value);
                }
                code += "var sourceRows" + ix + " = changes['" + root.table.replace(/'/g, "\\'") + "'];\n";
                code += "for(var rowIx" + ix + " = 0, rowsLen" + ix + " = sourceRows" + ix + ".length; rowIx" + ix + " < rowsLen" + ix + "; rowIx" + ix + "++) {\n";
                code += "var sourceRow" + ix + " = sourceRows" + ix + "[rowIx" + ix + "];\n";
                code += "var mappedRow" + ix + " = {" + mappingItems.join(", ") + "};\n";
                for (var _b = 0, _c = root.children; _b < _c.length; _b++) {
                    var child = _c[_b];
                    code += this.compileAST(child);
                }
                code += "}\n";
                break;
            case "result":
                var ix = root.ix;
                code += "var hash" + ix + " = hasher(mappedRow" + ix + ");\n";
                code += "mappedRow" + ix + ".__id = hash" + ix + ";\n";
                code += "hashes[hash" + ix + "] = mappedRow" + ix + ";\n";
                for (var _d = 0, _e = root.children; _d < _e.length; _d++) {
                    var child = _e[_d];
                    code += this.compileAST(child);
                }
                break;
            case "removeResult":
                var ix = root.ix;
                code += "hashes[hasher(mappedRow" + ix + ")] = false;\n";
                break;
            case "hashesToResults":
                code += "var hashKeys = Object.keys(hashes);\n";
                code += "for(var hashKeyIx = 0, hashKeyLen = hashKeys.length; hashKeyIx < hashKeyLen; hashKeyIx++) {\n";
                code += "var curHashKey = hashKeys[hashKeyIx];";
                code += "var value = hashes[curHashKey];\n";
                code += "if(value !== false) {\n";
                code += "value.__id = curHashKey;\n";
                code += "results.push(value);\n";
                code += "}\n";
                code += "}\n";
                break;
            case "provenance":
                var source = root.source.table;
                var ix = root.ix;
                var provenance = "var provenance__id = '';\n";
                provenance += "provenance__id = '" + this.name.replace(/'/g, "\\'") + "|' + mappedRow" + ix + ".__id + '|' + rowInstance + '|" + source.replace(/'/g, "\\'") + "|' + sourceRow" + ix + ".__id; \n";
                provenance += "provenance.push({table: '" + this.name.replace(/'/g, "\\'") + "', row: mappedRow" + ix + ", \"row instance\": rowInstance, source: \"" + source.replace(/'/g, "\\'") + "\", \"source row\": sourceRow" + ix + "});\n";
                code = "var rowInstance = \"" + source.replace(/'/g, "\\'") + "|\" + mappedRow" + ix + ".__id;\n        " + provenance;
                break;
            case "return":
                code += "return {" + root.vars.map(function (name) { return (name + ": " + name); }).join(", ") + "};";
                break;
        }
        return code;
    };
    Union.prototype.compile = function () {
        var ast = this.toAST();
        var code = this.compileAST(ast);
        this.compiled = new Function("ixer", "hasher", "changes", code);
        this.dirty = false;
        return this;
    };
    Union.prototype.debug = function () {
        var code = this.compileAST(this.toAST());
        console.log(code);
        return code;
    };
    Union.prototype.exec = function () {
        if (this.dirty) {
            this.compile();
        }
        var changes = {};
        for (var _i = 0, _a = this.sources; _i < _a.length; _i++) {
            var source = _a[_i];
            changes[source.table] = this.ixer.table(source.table).table;
        }
        var results = this.compiled(this.ixer, this.hasher, changes);
        return results;
    };
    Union.prototype.incrementalRemove = function (changes) {
        var ixer = this.ixer;
        var rowsToPostCheck = [];
        var provenanceDiff = this.ixer.diff();
        var removes = [];
        var indexes = ixer.table("provenance").indexes;
        var sourceRowLookup = indexes["source|source row|table"].index;
        var rowInstanceLookup = indexes["row instance|table"].index;
        var tableRowLookup = indexes["row|table"].index;
        var provenanceRemoves = [];
        var visited = {};
        for (var _i = 0, _a = this.sources; _i < _a.length; _i++) {
            var source = _a[_i];
            var change = changes[source.table];
            if (!visited[source.table] && change && change.removes.length) {
                visited[source.table] = true;
                for (var _b = 0, _c = change.removes; _b < _c.length; _b++) {
                    var remove = _c[_b];
                    var provenances = sourceRowLookup[source.table + '|' + remove.__id + '|' + this.name];
                    if (provenances) {
                        for (var _d = 0; _d < provenances.length; _d++) {
                            var provenance = provenances[_d];
                            if (!visited[provenance["row instance"]]) {
                                visited[provenance["row instance"]] = true;
                                var relatedProvenance = rowInstanceLookup[provenance["row instance"] + '|' + provenance.table];
                                for (var _e = 0; _e < relatedProvenance.length; _e++) {
                                    var related = relatedProvenance[_e];
                                    provenanceRemoves.push(related);
                                }
                            }
                            rowsToPostCheck.push(provenance);
                        }
                    }
                }
            }
        }
        provenanceDiff.removeFacts("provenance", provenanceRemoves);
        ixer.applyDiffIncremental(provenanceDiff);
        var isEdb = ixer.edbTables;
        for (var _f = 0; _f < rowsToPostCheck.length; _f++) {
            var row = rowsToPostCheck[_f];
            var supports = tableRowLookup[row.row.__id + '|' + row.table];
            if (!supports || supports.length === 0) {
                removes.push(row.row);
            }
            else if (this.sources.length > 2) {
                var supportsToRemove = [];
                // otherwise if there are supports, then we need to walk the support
                // graph backwards and make sure every supporting row terminates at an
                // edb value. If not, then that support also needs to be removed
                for (var _g = 0; _g < supports.length; _g++) {
                    var support = supports[_g];
                    // if the support is already an edb, we're good to go.
                    if (isEdb[support.source])
                        continue;
                    if (!tableRowLookup[support["source row"].__id + '|' + support.source]) {
                        supportsToRemove.push(support);
                        continue;
                    }
                    // get all the supports for this support
                    var nodes = tableRowLookup[support["source row"].__id + '|' + support.source].slice();
                    var nodeIx = 0;
                    // iterate through all the nodes, if they have further supports then
                    // assume this node is ok and add those supports to the list of nodes to
                    // check. If we run into a node with no supports it must either be an edb
                    // or it's unsupported and this row instance needs to be removed.
                    while (nodeIx < nodes.length) {
                        var node = nodes[nodeIx];
                        if (isEdb[node.source]) {
                            nodeIx++;
                            continue;
                        }
                        var nodeSupports = tableRowLookup[node["source row"].__id + '|' + node.source];
                        if (!nodeSupports || nodeSupports.length === 0) {
                            supportsToRemove.push(support);
                            break;
                        }
                        else {
                            for (var _h = 0; _h < nodeSupports.length; _h++) {
                                var nodeSupport = nodeSupports[_h];
                                nodes.push(nodeSupport);
                            }
                            nodeIx++;
                        }
                    }
                }
                if (supportsToRemove.length) {
                    // we need to remove all the supports
                    var provenanceRemoves_1 = [];
                    for (var _j = 0; _j < supportsToRemove.length; _j++) {
                        var support = supportsToRemove[_j];
                        var relatedProvenance = rowInstanceLookup[support["row instance"] + '|' + support.table];
                        for (var _k = 0; _k < relatedProvenance.length; _k++) {
                            var related = relatedProvenance[_k];
                            provenanceRemoves_1.push(related);
                        }
                    }
                    var diff = ixer.diff();
                    diff.removeFacts("provenance", provenanceRemoves_1);
                    ixer.applyDiffIncremental(diff);
                    // now that all the unsupported provenances have been removed, check if there's anything
                    // left.
                    if (!tableRowLookup[row.row.__id + '|' + row.table] || tableRowLookup[row.row.__id + '|' + row.table].length === 0) {
                        removes.push(row.row);
                    }
                }
            }
        }
        return removes;
    };
    Union.prototype.execIncremental = function (changes, table) {
        if (this.dirty) {
            this.compile();
        }
        var sourceChanges = {};
        for (var _i = 0, _a = this.sources; _i < _a.length; _i++) {
            var source = _a[_i];
            var value = void 0;
            if (!changes[source.table]) {
                value = [];
            }
            else {
                value = changes[source.table].adds;
            }
            sourceChanges[source.table] = value;
        }
        var results = this.compiled(this.ixer, this.hasher, sourceChanges);
        var adds = [];
        var prevHashes = table.factHash;
        var prevKeys = Object.keys(prevHashes);
        var suggestedRemoves = this.incrementalRemove(changes);
        var realDiff = diffAddsAndRemoves(results.results, suggestedRemoves);
        for (var _b = 0, _c = realDiff.adds; _b < _c.length; _b++) {
            var result = _c[_b];
            var id = result.__id;
            if (prevHashes[id] === undefined) {
                adds.push(result);
            }
        }
        var diff = this.ixer.diff();
        diff.addMany("provenance", results.provenance);
        this.ixer.applyDiffIncremental(diff);
        return { provenance: results.provenance, adds: adds, removes: realDiff.removes };
    };
    return Union;
})();
exports.Union = Union;
//---------------------------------------------------------
// Builtin Primitives
//---------------------------------------------------------
runtime.define("count", { aggregate: true, result: "count" }, function (prev) {
    if (!prev.count) {
        prev.count = 0;
    }
    prev.count++;
    return prev;
});
runtime.define("sum", { aggregate: true, result: "sum" }, function (prev, value) {
    if (!prev.sum) {
        prev.sum = 0;
    }
    prev.sum += value;
    return prev;
});
runtime.define("average", { aggregate: true, result: "average" }, function (prev, value) {
    if (!prev.sum) {
        prev.sum = 0;
        prev.count = 0;
    }
    prev.count++;
    prev.sum += value;
    prev.average = prev.sum / prev.count;
    return prev;
});
runtime.define("lowercase", { result: "lowercase" }, function (text) {
    if (typeof text === "string") {
        return { result: text.toLowerCase() };
    }
    return { result: text };
});
runtime.define("=", { filter: true, inverse: "!=" }, function (a, b) {
    return a === b ? runtime.SUCCEED : runtime.FAIL;
});
runtime.define("!=", { filter: true, inverse: "=" }, function (a, b) {
    return a !== b ? runtime.SUCCEED : runtime.FAIL;
});
runtime.define(">", { filter: true, inverse: "<=" }, function (a, b) {
    return a > b ? runtime.SUCCEED : runtime.FAIL;
});
runtime.define("<", { filter: true, inverse: ">=" }, function (a, b) {
    return a < b ? runtime.SUCCEED : runtime.FAIL;
});
runtime.define(">=", { filter: true, inverse: "<" }, function (a, b) {
    return a >= b ? runtime.SUCCEED : runtime.FAIL;
});
runtime.define("<=", { filter: true, inverse: ">" }, function (a, b) {
    return a <= b ? runtime.SUCCEED : runtime.FAIL;
});
runtime.define("+", { result: "result" }, function (a, b) {
    return { result: a + b };
});
runtime.define("-", { result: "result" }, function (a, b) {
    return { result: a - b };
});
runtime.define("*", { result: "result" }, function (a, b) {
    return { result: a * b };
});
runtime.define("/", { result: "result" }, function (a, b) {
    return { result: a / b };
});
//---------------------------------------------------------
// AST and compiler
//---------------------------------------------------------
// view: view, kind[union|query|table]
// action: view, action, kind[select|calculate|project|union|ununion|stateful|limit|sort|group|aggregate], ix
// action source: action, source view
// action mapping: action, from, to source, to field
// action mapping constant: action, from, value
function addRecompileTriggers(eve) {
    var recompileTrigger = {
        exec: function (ixer) {
            for (var _i = 0, _a = ixer.find("view"); _i < _a.length; _i++) {
                var view = _a[_i];
                if (view.kind === "table")
                    continue;
                try {
                    var query = compile(ixer, view.view);
                    ixer.asView(query);
                }
                catch (e) {
                    console.error("BAD QUERY IN THE DB :(");
                    console.error("View Id: " + view.view);
                    console.log(e.stack);
                    ixer.applyDiff(Query.remove(view.view, ixer));
                }
            }
            return {};
        }
    };
    eve.addTable("view", ["view", "kind"]);
    eve.addTable("action", ["view", "action", "kind", "ix"]);
    eve.addTable("action source", ["action", "source view"]);
    eve.addTable("action mapping", ["action", "from", "to source", "to field"]);
    eve.addTable("action mapping constant", ["action", "from", "value"]);
    eve.addTable("action mapping sorted", ["action", "ix", "source", "field", "direction"]);
    eve.addTable("action mapping limit", ["action", "limit type", "value"]);
    eve.table("view").triggers["recompile"] = recompileTrigger;
    eve.table("action").triggers["recompile"] = recompileTrigger;
    eve.table("action source").triggers["recompile"] = recompileTrigger;
    eve.table("action mapping").triggers["recompile"] = recompileTrigger;
    eve.table("action mapping constant").triggers["recompile"] = recompileTrigger;
    eve.table("action mapping sorted").triggers["recompile"] = recompileTrigger;
    eve.table("action mapping limit").triggers["recompile"] = recompileTrigger;
    return eve;
}
function compile(ixer, viewId) {
    var view = ixer.findOne("view", { view: viewId });
    if (!view) {
        throw new Error("No view found for " + viewId + ".");
    }
    var compiled = ixer[view.kind](viewId);
    var actions = ixer.find("action", { view: viewId });
    if (!actions) {
        throw new Error("View " + viewId + " has no actions.");
    }
    // sort actions by ix
    actions.sort(function (a, b) { return a.ix - b.ix; });
    for (var _i = 0; _i < actions.length; _i++) {
        var action = actions[_i];
        var actionKind = action.kind;
        if (actionKind === "limit") {
            var limit = {};
            for (var _a = 0, _b = ixer.find("action mapping limit", { action: action.action }); _a < _b.length; _a++) {
                var limitMapping = _b[_a];
                limit[limitMapping["limit type"]] = limitMapping["value"];
            }
            compiled.limit(limit);
        }
        else if (actionKind === "sort" || actionKind === "group") {
            var sorted = [];
            var mappings = ixer.find("action mapping sorted", { action: action.action });
            mappings.sort(function (a, b) { return a.ix - b.ix; });
            for (var _c = 0; _c < mappings.length; _c++) {
                var mapping = mappings[_c];
                sorted.push([mapping["source"], mapping["field"], mapping["direction"]]);
            }
            if (sorted.length) {
                compiled[actionKind](sorted);
            }
            else {
                throw new Error(actionKind + " without any mappings: " + action.action);
            }
        }
        else {
            var mappings = ixer.find("action mapping", { action: action.action });
            var mappingObject = {};
            for (var _d = 0; _d < mappings.length; _d++) {
                var mapping = mappings[_d];
                var source_1 = mapping["to source"];
                var field = mapping["to field"];
                if (actionKind === "union" || actionKind === "ununion") {
                    mappingObject[mapping.from] = [field];
                }
                else {
                    mappingObject[mapping.from] = [source_1, field];
                }
            }
            var constants = ixer.find("action mapping constant", { action: action.action });
            for (var _e = 0; _e < constants.length; _e++) {
                var constant = constants[_e];
                mappingObject[constant.from] = constant.value;
            }
            var source = ixer.findOne("action source", { action: action.action });
            if (!source && actionKind !== "project") {
                throw new Error(actionKind + " action without a source in '" + viewId + "'");
            }
            if (actionKind !== "project") {
                compiled[actionKind](source["source view"], mappingObject, action.action);
            }
            else {
                compiled[actionKind](mappingObject);
            }
        }
    }
    return compiled;
}
exports.compile = compile;
//---------------------------------------------------------
// Public API
//---------------------------------------------------------
exports.SUCCEED = [{ success: true }];
exports.FAIL = [];
function indexer() {
    var ixer = new Indexer();
    addProvenanceTable(ixer);
    addRecompileTriggers(ixer);
    return ixer;
}
exports.indexer = indexer;
if (utils_1.ENV === "browser")
    window["runtime"] = exports;

},{"./utils":19}],16:[function(require,module,exports){
var CodeMirror = require("codemirror");
var utils_1 = require("./utils");
var runtime_1 = require("./runtime");
var richTextEditor_1 = require("./richTextEditor");
var uitk = require("./uitk");
var app_1 = require("./app");
var parser_1 = require("./parser");
var NLQueryParser_1 = require("./NLQueryParser");
(function (PANE) {
    PANE[PANE["FULL"] = 0] = "FULL";
    PANE[PANE["WINDOW"] = 1] = "WINDOW";
    PANE[PANE["POPOUT"] = 2] = "POPOUT";
})(exports.PANE || (exports.PANE = {}));
var PANE = exports.PANE;
;
var BLOCK;
(function (BLOCK) {
    BLOCK[BLOCK["TEXT"] = 0] = "TEXT";
    BLOCK[BLOCK["PROJECTION"] = 1] = "PROJECTION";
})(BLOCK || (BLOCK = {}));
;
// Because html5 is full of broken promises and broken dreams
var popoutHistory = [];
//------------------------------------------------------------------------------
// State
//------------------------------------------------------------------------------
exports.uiState = {
    widget: {
        search: {},
        table: {},
        collapsible: {},
        attributes: {},
    },
    pane: {},
    prompt: { open: false, paneId: undefined, prompt: undefined },
};
//---------------------------------------------------------
// Utils
//---------------------------------------------------------
function preventDefault(event) {
    event.preventDefault();
}
function setURL(paneId, contains, replace) {
    var name = uitk.resolveName(contains);
    if (paneId !== "p1")
        return; // @TODO: Make this a constant
    var url;
    if (contains.length === 0)
        url = "#";
    else if (name === contains)
        url = "#/search/" + utils_1.slugify(contains);
    else
        url = "#/" + utils_1.slugify(name) + "/" + utils_1.slugify(contains);
    var state = { paneId: paneId, contains: contains };
    window["states"] = window["states"] || [];
    window["states"].push(state);
    if (replace)
        window.history.replaceState(state, null, url);
    else
        window.history.pushState(state, null, url);
}
exports.setURL = setURL;
//---------------------------------------------------------
// Dispatches
//---------------------------------------------------------
app_1.handle("ui focus search", function (changes, _a) {
    var paneId = _a.paneId, value = _a.value;
    var state = exports.uiState.widget.search[paneId] = exports.uiState.widget.search[paneId] || { value: value };
    state.focused = true;
});
app_1.handle("ui set search", function (changes, _a) {
    var paneId = _a.paneId, value = _a.value, peek = _a.peek, x = _a.x, y = _a.y, popState = _a.popState;
    value = value.trim();
    var displays = app_1.eve.find("display name", { name: value });
    if (displays.length === 1)
        value = displays[0].id;
    var fact;
    if (paneId === "p1") {
        popoutHistory = [];
    }
    else if (!popState) {
        var popout = app_1.eve.findOne("ui pane", { kind: PANE.POPOUT });
        if (popout) {
            popoutHistory.push(popout.contains); // @FIXME: This is fragile
        }
    }
    if (!peek) {
        var state = exports.uiState.widget.search[paneId] = exports.uiState.widget.search[paneId] || { value: value };
        state.value = value;
        state.focused = false;
        fact = utils_1.copy(app_1.eve.findOne("ui pane", { pane: paneId }));
        fact.__id = undefined;
        fact.contains = value;
        changes.remove("ui pane", { pane: paneId });
        var children = app_1.eve.find("ui pane parent", { parent: paneId });
        for (var _i = 0; _i < children.length; _i++) {
            var child = children[_i].pane;
            changes.remove("ui pane position", { pane: child });
            changes.remove("ui pane", { pane: child });
        }
        changes.remove("ui pane parent", { parent: paneId });
        if (!popState)
            setURL(paneId, value);
    }
    else {
        var popout = app_1.eve.findOne("ui pane", { kind: PANE.POPOUT });
        var neuePaneId;
        if (!popout) {
            neuePaneId = utils_1.uuid();
        }
        else {
            neuePaneId = popout.pane;
            changes.remove("ui pane", { pane: neuePaneId });
        }
        var state = exports.uiState.widget.search[neuePaneId] = { value: value };
        fact = { contains: value, pane: neuePaneId, kind: PANE.POPOUT };
        if (!popout || paneId !== neuePaneId) {
            if (x !== undefined && y !== undefined) {
                changes.remove("ui pane position", { pane: neuePaneId });
                changes.add("ui pane position", { pane: neuePaneId, x: x, y: y });
            }
            changes.remove("ui pane parent", { parent: paneId });
            changes.add("ui pane parent", { pane: neuePaneId, parent: paneId });
        }
        paneId = neuePaneId;
    }
    changes.add("ui pane", fact);
});
app_1.handle("remove popup", function (changes, _a) {
    var popup = app_1.eve.findOne("ui pane", { kind: PANE.POPOUT });
    if (popup) {
        var paneId = popup.pane;
        changes.remove("ui pane", { pane: paneId });
        changes.remove("ui pane position", { pane: paneId });
    }
    popoutHistory = [];
});
app_1.handle("ui toggle search plan", function (changes, _a) {
    var paneId = _a.paneId;
    var state = exports.uiState.widget.search[paneId] = exports.uiState.widget.search[paneId] || { value: "" };
    state.plan = !state.plan;
});
app_1.handle("add sourced eav", function (changes, eav) {
    if (!eav.source) {
        eav.source = utils_1.uuid();
    }
    changes.add("sourced eav", eav);
});
app_1.handle("remove sourced eav", function (changes, eav) {
    changes.remove("sourced eav", eav);
});
app_1.handle("update page", function (changes, _a) {
    var page = _a.page, content = _a.content;
    changes.remove("page content", { page: page });
    changes.add("page content", { page: page, content: content });
    var trimmed = content.trim();
    var endIx = trimmed.indexOf("\n");
    var name = trimmed.slice(1, endIx !== -1 ? endIx : undefined).trim();
    var entity = app_1.eve.findOne("entity page", { page: page }).entity;
    var _b = (app_1.eve.findOne("display name", { id: entity }) || {}).name, prevName = _b === void 0 ? undefined : _b;
    if (name !== prevName) {
        changes.remove("display name", { id: entity, name: prevName });
        changes.add("display name", { id: entity, name: name });
        var parts = utils_1.location().split("/");
        if (parts.length > 2 && parts[2].replace(/_/gi, " ") === entity) {
            window.history.replaceState(window.history.state, null, "/" + utils_1.slugify(name) + "/" + utils_1.slugify(entity));
        }
    }
});
app_1.handle("create entity", function (changes, _a) {
    var entity = _a.entity, page = _a.page, _b = _a.name, name = _b === void 0 ? "Untitled" : _b;
    changes
        .add("entity page", { entity: entity, page: page })
        .add("display name", { id: entity, name: name });
});
app_1.handle("create page", function (changes, _a) {
    var page = _a.page, _b = _a.content, content = _b === void 0 ? undefined : _b;
    if (content === undefined)
        content = "This page is empty. Type something to add some content!";
    changes.add("page content", { page: page, content: content });
});
app_1.handle("create query", function (changes, _a) {
    var id = _a.id, content = _a.content;
    var page = utils_1.uuid();
    changes
        .add("page content", { page: page, content: "#" + content + " query" })
        .add("entity page", { id: id, page: page })
        .add("display name", { id: id, content: content })
        .add("sourced eav", { entity: id, attribute: "is a", value: utils_1.builtinId("query") })
        .add("sourced eav", { entity: id, attribute: "content", value: content });
    var artifacts = parser_1.parseDSL(content);
    if (artifacts.changeset)
        changes.merge(artifacts.changeset);
    for (var viewId in artifacts.views) {
        changes.add("sourced eav", { entity: id, attribute: "artifact", value: viewId });
        var name_1 = artifacts.views[viewId]["displayName"];
        if (!app_1.eve.findOne("display name", { id: viewId }) && name_1)
            changes.add("display name", { id: viewId, name: name_1 });
        changes.merge(artifacts.views[viewId].changeset(app_1.eve));
    }
});
app_1.handle("insert query", function (changes, _a) {
    var query = _a.query;
    if (app_1.eve.findOne("query to id", { query: query }))
        return;
    query = query.trim();
    var parsed = NLQueryParser_1.parse(query);
    if (parsed[0].state === NLQueryParser_1.StateFlags.COMPLETE) {
        var artifacts = parser_1.parseDSL(parsed[0].query.toString());
        if (artifacts.changeset)
            changes.merge(artifacts.changeset);
        var rootId;
        for (var viewId in artifacts.views) {
            if (!rootId)
                rootId = viewId;
            var name_2 = artifacts.views[viewId]["displayName"];
            if (!app_1.eve.findOne("display name", { id: viewId }) && name_2)
                changes.add("display name", { id: viewId, name: name_2 });
            changes.merge(artifacts.views[viewId].changeset(app_1.eve));
        }
        changes.add("query to id", { query: query, id: rootId });
    }
});
// @TODO: there's a lot of duplication between insert query, create query, and insert implication
app_1.handle("insert implication", function (changes, _a) {
    var query = _a.query;
    var artifacts = parser_1.parseDSL(query);
    if (artifacts.changeset)
        changes.merge(artifacts.changeset);
    for (var viewId in artifacts.views) {
        var name_3 = artifacts.views[viewId]["displayName"];
        if (!app_1.eve.findOne("display name", { id: viewId }) && name_3)
            changes.add("display name", { id: viewId, name: name_3 });
        changes.merge(artifacts.views[viewId].changeset(app_1.eve));
    }
});
app_1.handle("remove entity attribute", function (changes, _a) {
    var entity = _a.entity, attribute = _a.attribute, value = _a.value;
    changes.remove("sourced eav", { entity: entity, attribute: attribute, value: value });
    // @FIXME: Make embeds auto-gc themselves when invalidated.
});
app_1.handle("update entity attribute", function (changes, _a) {
    var entity = _a.entity, attribute = _a.attribute, prev = _a.prev, value = _a.value;
    // @FIXME: proper unique source id
    var _b = (app_1.eve.findOne("sourced eav", { entity: entity, attribute: attribute, value: prev }) || {}).source, source = _b === void 0 ? "<global>" : _b;
    if (prev !== undefined)
        changes.remove("sourced eav", { entity: entity, attribute: attribute, value: prev });
    changes.add("sourced eav", { entity: entity, attribute: attribute, value: value, source: source });
});
app_1.handle("rename entity attribute", function (changes, _a) {
    var entity = _a.entity, attribute = _a.attribute, prev = _a.prev, value = _a.value;
    // @FIXME: proper unique source id
    var _b = (app_1.eve.findOne("sourced eav", { entity: entity, attribute: prev, value: value }) || {}).source, source = _b === void 0 ? "<global>" : _b;
    if (prev !== undefined)
        changes.remove("sourced eav", { entity: entity, attribute: prev, value: value });
    changes.add("sourced eav", { entity: entity, attribute: attribute, value: value, source: source });
});
app_1.handle("sort table", function (changes, _a) {
    var key = _a.key, field = _a.field, direction = _a.direction;
    var state = exports.uiState.widget.table[key] || { field: undefined, direction: undefined };
    if (field !== undefined)
        state.field = field;
    if (direction !== undefined)
        state.direction = direction;
    exports.uiState.widget.table[key] = state;
});
app_1.handle("toggle settings", function (changes, _a) {
    var paneId = _a.paneId, _b = _a.open, open = _b === void 0 ? undefined : _b;
    var state = exports.uiState.pane[paneId] || { settings: false };
    state.settings = open !== undefined ? open : !state.settings;
    exports.uiState.pane[paneId] = state;
});
app_1.handle("toggle collapse", function (changes, _a) {
    var collapsible = _a.collapsible, _b = _a.open, open = _b === void 0 ? undefined : _b;
    var state = exports.uiState.widget.collapsible[collapsible] || { open: false };
    state.open = open !== undefined ? open : !state.open;
    exports.uiState.widget.collapsible[collapsible] = state;
});
app_1.handle("toggle prompt", function (changes, _a) {
    var _b = _a.prompt, prompt = _b === void 0 ? undefined : _b, _c = _a.paneId, paneId = _c === void 0 ? undefined : _c, _d = _a.open, open = _d === void 0 ? undefined : _d;
    var state = exports.uiState.prompt;
    if (state.prompt !== prompt) {
        state.prompt = prompt;
        state.open = open !== undefined ? open : true;
        state.paneId = paneId;
    }
    else {
        state.open !== undefined ? open : !state.open;
    }
    exports.uiState.prompt = state;
});
app_1.handle("remove entity", function (changes, _a) {
    var entity = _a.entity;
    changes.remove("sourced eav", { entity: entity })
        .remove("display name", { id: entity })
        .remove("manual eavs", { entity: entity })
        .remove("entity page", { entity: entity });
});
//---------------------------------------------------------
// Wiki Containers
//---------------------------------------------------------
function root() {
    var panes = [];
    for (var _i = 0, _a = app_1.eve.find("ui pane"); _i < _a.length; _i++) {
        var paneId = _a[_i].pane;
        panes.push(pane(paneId));
    }
    if (exports.uiState.prompt.open && exports.uiState.prompt.prompt && !exports.uiState.prompt.paneId) {
        panes.push({ c: "shade", click: closePrompt, children: [
                exports.uiState.prompt.prompt()
            ] });
    }
    return { c: "wiki-root", id: "root", children: panes, click: removePopup };
}
exports.root = root;
// @TODO: Add search functionality + Pane Chrome
var paneChrome = (_a = {},
    _a[PANE.FULL] = function (paneId, entityId) { return ({
        c: "fullscreen",
        header: { t: "header", c: "flex-row", children: [
                { c: "logo eve-logo", data: { paneId: paneId }, link: "", click: navigate },
                searchInput(paneId, entityId),
                { c: "controls visible", children: [
                        { c: "ion-gear-a toggle-settings", style: "font-size: 1.35em;", prompt: paneSettings, paneId: paneId, click: openPrompt }
                    ] }
            ] }
    }); },
    _a[PANE.POPOUT] = function (paneId, entityId) {
        var parent = app_1.eve.findOne("ui pane parent", { pane: paneId })["parent"];
        return {
            c: "window",
            captureClicks: true,
            header: { t: "header", c: "", children: [
                    { t: "button", c: "ion-android-open", click: navigateParent, link: entityId, paneId: paneId, parentId: parent, text: "" },
                ] },
        };
    },
    _a[PANE.WINDOW] = function (paneId, entityId) { return ({
        c: "window",
        header: { t: "header", c: "flex-row", children: [
                { c: "flex-grow title", text: entityId },
                { c: "flex-row controls", children: [
                        { c: "ion-android-search" },
                        { c: "ion-minus-round" },
                        { c: "ion-close-round" }
                    ] }
            ] }
    }); },
    _a
);
function openPrompt(event, elem) {
    app_1.dispatch("toggle prompt", { prompt: elem.prompt, paneId: elem.paneId, open: true }).commit();
}
function closePrompt(event, elem) {
    if (event.target === event.currentTarget) {
        app_1.dispatch("toggle prompt", { open: false }).commit();
    }
}
function navigateParent(event, elem) {
    app_1.dispatch("remove popup", { paneId: elem.paneId })
        .dispatch("ui set search", { paneId: elem.parentId, value: elem.link })
        .commit();
}
function removePopup(event, elem) {
    if (!event.defaultPrevented) {
        var chain = app_1.dispatch("remove popup", {}).dispatch("clearActiveCells", {});
        for (var entity_1 in exports.uiState.widget.attributes) {
            chain.dispatch("clearActiveAttribute", { entity: entity_1 });
        }
        chain.commit();
    }
}
function loadFromFile(event, elem) {
    var target = event.target;
    if (!target.files.length)
        return;
    if (target.files.length > 1)
        throw new Error("Cannot load multiple files at once");
    var file = target.files[0];
    var reader = new FileReader();
    reader.onload = function (event) {
        var serialized = event.target.result;
        app_1.eve.load(serialized);
        app_1.dispatch("toggle prompt", { prompt: loadedPrompt, open: true }).commit();
    };
    reader.readAsText(file);
}
function deleteDatabasePrompt() {
    return { c: "modal-prompt delete-prompt", children: [
            { t: "header", c: "flex-row", children: [
                    { t: "h2", text: "DELETE DATABASE" },
                    { c: "flex-grow" },
                    { c: "controls", children: [{ c: "ion-close-round", click: closePrompt }] }
                ] },
            { c: "info", text: "This will remove all information currently stored in Eve for you and cannot be undone." },
            { c: "flex-row", children: [
                    { t: "button", c: "delete-btn", text: "DELETE EVERYTHING FOREVER", click: nukeDatabase },
                    { c: "flex-grow" },
                    { t: "button", text: "Cancel", click: closePrompt },
                ] }
        ] };
}
function nukeDatabase() {
    localStorage.clear();
    window.location.reload();
}
function savePrompt() {
    var serialized = localStorage[app_1.eveLocalStorageKey];
    return { c: "modal-prompt save-prompt", children: [
            { t: "header", c: "flex-row", children: [
                    { t: "h2", text: "Save DB" },
                    { c: "flex-grow" },
                    { c: "controls", children: [{ c: "ion-close-round", click: closePrompt }] }
                ] },
            { t: "a", href: "data:application/octet-stream;charset=utf-16le;base64," + btoa(serialized), download: "save.evedb", text: "save to file" }
        ] };
}
function loadPrompt() {
    var serialized = localStorage[app_1.eveLocalStorageKey];
    return { c: "modal-prompt load-prompt", children: [
            { t: "header", c: "flex-row", children: [
                    { t: "h2", text: "Load DB" },
                    { c: "flex-grow" },
                    { c: "controls", children: [{ c: "ion-close-round", click: closePrompt }] }
                ] },
            { t: "p", children: [
                    { t: "span", text: "WARNING: This will overwrite your current database. This is irreversible. You should consider " },
                    { t: "a", text: "saving your DB", prompt: savePrompt, click: openPrompt },
                    { t: "span", text: " first." }
                ] },
            { t: "input", type: "file", text: "load from file", change: loadFromFile }
        ] };
}
function loadedPrompt() {
    return { c: "modal-prompt load-prompt", children: [
            { t: "header", c: "flex-row", children: [
                    { t: "h2", text: "Load DB" },
                    { c: "flex-grow" },
                    { c: "controls", children: [{ c: "ion-close-round", click: closePrompt }] }
                ] },
            { text: "Successfully loaded DB from file" }
        ] };
}
function pane(paneId) {
    // @FIXME: Add kind to ui panes
    var _a = app_1.eve.findOne("ui pane", { pane: paneId }) || {}, _b = _a.contains, contains = _b === void 0 ? undefined : _b, _c = _a.kind, kind = _c === void 0 ? PANE.FULL : _c;
    var makeChrome = paneChrome[kind];
    if (!makeChrome)
        throw new Error("Unknown pane kind: '" + kind + "' (" + PANE[kind] + ")");
    var _d = makeChrome(paneId, contains), klass = _d.c, header = _d.header, footer = _d.footer, captureClicks = _d.captureClicks;
    var content;
    var display = app_1.eve.findOne("display name", { name: contains }) || app_1.eve.findOne("display name", { id: contains });
    var contentType = "entity";
    if (contains.length === 0) {
        content = entity(utils_1.builtinId("home"), paneId, kind);
    }
    else if (contains.indexOf("search: ") === 0) {
        contentType = "search";
        content = search(contains.substring("search: ".length), paneId);
    }
    else if (display) {
        var options = {};
        content = entity(display.id, paneId, kind, options);
    }
    else if (app_1.eve.findOne("query to id", { query: contains })) {
        contentType = "search";
        content = search(contains, paneId);
    }
    else if (contains !== "") {
        content = { c: "flex-row spaced-row", children: [
                { t: "span", text: "The page " + contains + " does not exist. Would you like to" },
                { t: "a", c: "link btn add-btn", text: "create it?", name: contains, paneId: paneId, click: createPage }
            ] };
    }
    if (contentType === "search") {
        var disambiguation = { id: "search-disambiguation", c: "flex-row spaced-row disambiguation", children: [
                { text: "Did you mean to" },
                { t: "a", c: "link btn add-btn", text: "create a new page", name: contains, paneId: paneId, click: createPage },
                { text: "with this name?" }
            ] };
    }
    var pane = { c: "wiki-pane " + (klass || ""), paneId: paneId, children: [header, disambiguation, content, footer] };
    var pos = app_1.eve.findOne("ui pane position", { pane: paneId });
    if (pos) {
        pane.style = "left: " + (isNaN(pos.x) ? pos.x : pos.x + "px") + "; top: " + (isNaN(pos.y) ? pos.y : (pos.y + 20) + "px") + ";";
    }
    if (captureClicks) {
        pane.click = preventDefault;
    }
    if (exports.uiState.prompt.open && exports.uiState.prompt.paneId === paneId) {
        pane.children.push({ style: "position: absolute; top: 0; left: 0; bottom: 0; right: 0; z-index: 10; background: rgba(0, 0, 0, 0.0);", paneId: paneId, click: closePrompt }, exports.uiState.prompt.prompt(paneId));
    }
    return pane;
}
exports.pane = pane;
function createPage(evt, elem) {
    var name = elem["name"];
    var entity = utils_1.uuid();
    var page = utils_1.uuid();
    app_1.dispatch("create page", { page: page, content: "# " + name + "\n" })
        .dispatch("create entity", { entity: entity, page: page, name: name }).commit();
}
function deleteEntity(event, elem) {
    var name = uitk.resolveName(elem.entity);
    app_1.dispatch("remove entity", { entity: elem.entity }).commit();
    app_1.dispatch("ui set search", { paneId: elem.paneId, value: name }).commit();
}
function paneSettings(paneId) {
    var pane = app_1.eve.findOne("ui pane", { pane: paneId });
    var _a = (app_1.eve.findOne("entity", { entity: uitk.resolveId(pane.contains) }) || {}).entity, entity = _a === void 0 ? undefined : _a;
    var isSystem = !!(entity && app_1.eve.findOne("entity eavs", { entity: entity, attribute: "is a", value: utils_1.builtinId("system") }));
    return { t: "ul", c: "settings", children: [
            { t: "li", c: "save-btn", text: "save", prompt: savePrompt, click: openPrompt },
            { t: "li", c: "load-btn", text: "load", prompt: loadPrompt, click: openPrompt },
            entity && !isSystem ? { t: "li", c: "delete-btn", text: "delete page", entity: entity, paneId: paneId, click: deleteEntity } : undefined,
            { t: "li", c: "delete-btn", text: "DELETE DATABASE", prompt: deleteDatabasePrompt, click: openPrompt },
        ] };
}
function search(search, paneId) {
    var _a = search.split("|"), rawContent = _a[0], rawParams = _a[1];
    var parsedParams = getCellParams(rawContent, rawParams);
    var _b = queryUIInfo(search), results = _b.results, params = _b.params, content = _b.content;
    utils_1.mergeObject(params, parsedParams);
    var rep = represent(content, params["rep"], results, params);
    return { t: "content", c: "wiki-search", children: [
            rep
        ] };
}
exports.search = search;
function sizeColumns(node, elem) {
    // @FIXME: Horrible hack to get around randomly added "undefined" text node that's coming from in microreact.
    var cur = node;
    while (cur.parentElement)
        cur = cur.parentElement;
    if (cur.tagName !== "HTML")
        document.body.appendChild(cur);
    var child, ix = 0;
    var widths = {};
    var columns = node.querySelectorAll(".column");
    for (var _i = 0; _i < columns.length; _i++) {
        var column = columns[_i];
        column.style.width = "auto";
        widths[column["value"]] = widths[column["value"]] || 0;
        if (column.offsetWidth > widths[column["value"]])
            widths[column["value"]] = column.offsetWidth;
    }
    for (var _a = 0; _a < columns.length; _a++) {
        var column = columns[_a];
        column.style.width = widths[column["value"]] + 1;
    }
    if (cur.tagName !== "HTML")
        document.body.removeChild(cur);
}
//---------------------------------------------------------
// Wiki editor functions
//---------------------------------------------------------
function parseParams(rawParams) {
    var params = {};
    if (!rawParams)
        return params;
    for (var _i = 0, _a = rawParams.split(";"); _i < _a.length; _i++) {
        var kv = _a[_i];
        var _b = kv.split("="), key = _b[0], value = _b[1];
        if (!key || !key.trim())
            continue;
        if (!value || !value.trim())
            throw new Error("Must specify value for key '" + key + "'");
        params[key.trim()] = utils_1.coerceInput(value.trim());
    }
    return params;
}
function stringifyParams(params) {
    var rawParams = "";
    if (!params)
        return rawParams;
    for (var key in params)
        rawParams += "" + (rawParams.length ? "; " : "") + key + " = " + params[key];
    return rawParams;
}
function cellUI(paneId, query, cell) {
    var _a = queryUIInfo(query), params = _a.params, results = _a.results, content = _a.content;
    params["paneId"] = params["paneId"] || paneId;
    params["cell"] = cell;
    params["childRep"] = params["rep"];
    params["rep"] = "embeddedCell";
    return { c: "cell", children: [represent(content, params["rep"], results, params)] };
}
// Credit to https://mathiasbynens.be/demo/url-regex and @gruber
var urlRegex = /\b(([\w-]+:\/\/?|www[.])[^\s()<>]+(?:\([\w\d]+\)|([^[\.,\-\/#!$%' "^*;:{_`~()\-\s]|\/)))/i;
function queryUIInfo(query) {
    var _a = query.split("|"), content = _a[0], rawParams = _a[1];
    var embedType;
    // let params = getCellParams(content, rawParams);
    var params = parseParams(rawParams);
    var results;
    if (app_1.eve.findOne("display name", { id: content }) || app_1.eve.findOne("display name", { name: content })) {
        var id = content;
        var display = app_1.eve.findOne("display name", { name: content });
        if (display) {
            id = display["id"];
        }
        results = { unprojected: [{ entity: id }], results: [{ entity: id }] };
    }
    else if (urlRegex.exec(content)) {
        results = { unprojected: [{ url: content }], results: [{ url: content }] };
    }
    else {
        var queryId = app_1.eve.findOne("query to id", { query: content });
        if (queryId) {
            var queryResults = app_1.eve.find(queryId.id);
            var queryUnprojected = app_1.eve.table(queryId.id).unprojected;
            if (!queryResults.length) {
                params["rep"] = "error";
                params["message"] = "No results";
                results = {};
            }
            else {
                results = { unprojected: queryUnprojected, results: queryResults };
            }
        }
        else {
            params["rep"] = "error";
            params["message"] = "invalid search";
            results = {};
        }
    }
    return { results: results, params: params, content: content };
}
function getCellParams(content, rawParams) {
    content = content.trim();
    var display = app_1.eve.findOne("display name", { name: content });
    var params = parseParams(rawParams);
    var contentDisplay = app_1.eve.findOne("display name", { id: content }) || app_1.eve.findOne("display name", { name: content });
    if (contentDisplay) {
        params["rep"] = params["rep"] || "link";
    }
    else if (urlRegex.exec(content)) {
        params["rep"] = params["rep"] || "externalLink";
    }
    else {
        if (params["rep"])
            return params;
        var parsed = NLQueryParser_1.parse(content);
        var currentParse = parsed[0];
        var context = currentParse.context;
        var hasCollections = context.collections.length;
        var field;
        var rep;
        var aggregates = [];
        for (var _i = 0, _a = context.fxns; _i < _a.length; _i++) {
            var fxn = _a[_i];
            if (fxn.type === NLQueryParser_1.FunctionTypes.AGGREGATE) {
                aggregates.push(fxn);
            }
        }
        if (aggregates.length === 1 && context["groupings"].length === 0) {
            rep = "CSV";
            field = aggregates[0].name;
        }
        else if (!hasCollections && context.fxns.length === 1) {
            rep = "CSV";
            field = context.fxns[0].name;
        }
        else if (!hasCollections && context.attributes.length === 1) {
            rep = "CSV";
            field = context.attributes[0].displayName;
        }
        else {
            params["rep"] = "table";
        }
        if (rep) {
            params["rep"] = rep;
            params["field"] = field;
        }
    }
    return params;
}
var paneEditors = {};
function wikiEditor(node, elem) {
    richTextEditor_1.createEditor(node, elem);
    paneEditors[elem.meta.paneId] = node.editor;
}
function reparentCell(node, elem) {
    if (node.parentNode.id !== elem.containerId) {
        document.getElementById(elem.containerId).appendChild(node);
    }
    node.parentNode["mark"].changed();
}
function focusCellEditor(node, elem) {
    utils_1.autoFocus(node, elem);
    if (!node.didFocus) {
        node.didFocus = true;
        utils_1.setEndOfContentEditable(node);
    }
}
//---------------------------------------------------------
function cellEditor(entityId, paneId, cell) {
    var text = activeCells[cell.id].query;
    var _a = autocompleterOptions(entityId, paneId, cell), options = _a.options, selected = _a.selected;
    var autoFocus = true;
    if (text.match(/\$\$.*\$\$/)) {
        text = "";
    }
    var display = app_1.eve.findOne("display name", { id: text });
    if (display) {
        text = display["name"];
    }
    return { children: [
            { c: "embedded-cell", children: [
                    { c: "adornment", text: "=" },
                    { t: "span", c: "", contentEditable: true, text: text, click: preventDefault, input: updateActiveCell, keydown: embeddedCellKeys, cell: cell, selected: selected, paneId: paneId, postRender: autoFocus ? focusCellEditor : undefined },
                ] },
            autocompleter(options, paneId, cell)
        ] };
}
function autocompleter(options, paneId, cell) {
    var children = [];
    for (var _i = 0; _i < options.length; _i++) {
        var option = options[_i];
        var item = { c: "option", children: option.children, text: option.text, selected: option, cell: cell, paneId: paneId, click: executeAutocompleterOption, keydown: optionKeys };
        if (option.selected) {
            item.c += " selected";
        }
        children.push(item);
    }
    return { c: "autocompleter", key: performance.now().toString(), cell: cell, containerId: paneId + "|" + cell.id + "|container", children: children, postRender: positionAutocompleter };
}
function optionKeys(event, elem) {
    if (event.keyCode === utils_1.KEYS.ENTER) {
        executeAutocompleterOption(event.currentTarget, elem);
    }
}
function executeAutocompleterOption(event, elem) {
    if (event.defaultPrevented)
        return;
    var paneId = elem.paneId, cell = elem.cell;
    var editor = paneEditors[paneId];
    var cm = editor.cmInstance;
    var mark = editor.marks[cell.id];
    var doEmbed = makeDoEmbedFunction(cm, mark, cell, paneId);
    if (elem.selected && elem.selected.action) {
        if (typeof elem.selected.action === "function") {
            elem.selected.action(elem, cell.query, doEmbed);
        }
    }
}
function autocompleterOptions(entityId, paneId, cell) {
    var _a = cell.query.trim().split("|"), text = _a[0], rawParams = _a[1];
    if (text.match(/\$\$.*\$\$/)) {
        return { options: [], selected: {} };
    }
    var params = {};
    try {
        params = getCellParams(text, rawParams);
    }
    catch (e) {
    }
    var display = app_1.eve.findOne("display name", { id: text });
    if (display) {
        text = display["name"];
    }
    var isEntity = app_1.eve.findOne("display name", { name: text });
    var parsed = [];
    if (text !== "") {
        try {
            parsed = NLQueryParser_1.parse(text); // @TODO: this should come from the NLP parser once it's hooked up.
        }
        catch (e) {
        }
    }
    // the autocomplete can have multiple states
    var state = cell.state || "query";
    // every option has a score for how pertinent it is
    // things with a score of 0 will be filtered, everything else
    // will be sorted descending.
    var options;
    if (state === "query") {
        options = queryAutocompleteOptions(isEntity, parsed, text, params, entityId);
    }
    else if (state === "represent") {
        options = representAutocompleteOptions(isEntity, parsed, text, params, entityId);
    }
    else if (state === "create") {
        options = createAutocompleteOptions(isEntity, parsed, text, params, entityId);
    }
    else if (state === "define") {
        options = defineAutocompleteOptions(isEntity, parsed, text, params, entityId);
    }
    else if (state === "modify") {
        options = modifyAutocompleteOptions(isEntity, parsed, text, params, entityId);
    }
    else if (state === "property") {
        options = propertyAutocompleteOptions(isEntity, parsed, text, params, entityId);
    }
    else if (state === "attributes ui") {
        options = attributesUIAutocompleteOptions(isEntity, parsed, text, params, entityId);
    }
    else if (state === "url") {
        options = urlAutocompleteOptions(isEntity, parsed, text, params, entityId);
    }
    options = options.sort(function (a, b) { return b.score - a.score; });
    var selected;
    if (options.length) {
        var selectedIx = cell.selected % options.length;
        if (selectedIx < 0)
            selectedIx = options.length + selectedIx;
        selected = options[selectedIx];
        selected.selected = true;
    }
    for (var _i = 0; _i < options.length; _i++) {
        var option = options[_i];
        option["cell"] = cell;
        option["paneId"] = paneId;
    }
    return { options: options, selected: selected };
}
function positionAutocompleter(node, elem) {
    var containerId = elem.containerId;
    var container = document.getElementById(containerId);
    var _a = container.getBoundingClientRect(), bottom = _a.bottom, left = _a.left;
    document.body.appendChild(node);
    node.style.top = bottom;
    node.style.left = left;
}
function queryAutocompleteOptions(isEntity, parsed, text, params, entityId) {
    var pageName = app_1.eve.findOne("display name", { id: entityId })["name"];
    var options = [];
    var hasValidParse = parsed.some(function (parse) { return parse.state === NLQueryParser_1.StateFlags.COMPLETE; });
    parsed.sort(function (a, b) { return b.score - a.score; });
    var topOption = parsed[0];
    var joiner = "a";
    if (text && text[0].match(/[aeiou]/i)) {
        joiner = "an";
    }
    var isAttribute = false;
    if (topOption) {
        var totalFound = 0;
        var context = topOption.context;
        for (var item in context) {
            totalFound += context[item].length;
        }
        var isEntAttr = totalFound === 2 && (context.entities.length === 1 || context.collections.length === 1);
        if (isEntAttr && context.maybeAttributes.length === 1) {
            options.push({ score: 4, action: setCellState, state: "define", text: "add " + text });
            isAttribute = true;
        }
        else if (isEntAttr && context.attributes.length === 1) {
            options.push({ score: 2.5, action: setCellState, state: "modify", text: "modify " + text });
        }
    }
    // create
    if (!isEntity && text !== "" && text != "=") {
        options.push({ score: 1, action: setCellState, state: "create", text: "Create " + joiner + " \"" + text + "\" page" });
    }
    // disambiguations
    if (parsed.length > 1) {
        options.push({ score: 3, action: "disambiguate stuff", text: "DISAMBIGUATE!" });
    }
    if (!isEntity && hasValidParse && params["rep"]) {
        options.push({ score: 4, action: embedAs, rep: params["rep"], params: params, text: "embed as a " + params["rep"] });
    }
    // repesentation
    // we can only repesent things if we've found them
    if (isEntity || hasValidParse) {
        // @TODO: how do we figure out what representations actually make sense to show?
        options.push({ score: 2, action: setCellState, state: "represent", text: "embed as ..." });
    }
    // set attribute
    if (text && app_1.eve.findOne("display name", { id: entityId }).name !== text) {
        if (!isAttribute) {
            options.push({ score: 2.5, action: setCellState, state: "property", text: "add as a property of " + pageName });
        }
        if (isEntity) {
            var isAScore = 2.5;
            if (app_1.eve.findOne("collection", { collection: isEntity.id })) {
                isAScore = 3;
            }
            options.push({ score: 2.5, action: addAttributeAndEmbed, replace: "is a", entityId: entityId, value: isEntity.id, attribute: "related to", text: pageName + " is related to " + text });
            options.push({ score: isAScore, action: addAttributeAndEmbed, replace: "related to", entityId: entityId, value: isEntity.id, attribute: "is a", text: pageName + " is " + joiner + " " + text });
        }
    }
    // url embedding
    if (urlRegex.exec(text)) {
        options.push({ score: 3, action: setCellState, state: "url", text: "embed url as..." });
    }
    return options;
}
function addAttributeAndEmbed(elem, strValue, doEmbed) {
    var _a = elem.selected, entityId = _a.entityId, value = _a.value, attribute = _a.attribute, replace = _a.replace;
    var chain = app_1.dispatch("add sourced eav", { entity: entityId, attribute: attribute, value: value, source: utils_1.uuid() });
    if (replace) {
        chain.dispatch("remove entity attribute", { entity: entityId, attribute: replace, value: value });
    }
    chain.commit();
    doEmbed(value + "|rep=link;");
}
function setCellState(elem, value, doEmbed) {
    app_1.dispatch("setCellState", { id: elem.cell.id, state: elem.selected.state }).commit();
}
function createAutocompleteOptions(isEntity, parsed, text, params, entityId) {
    var options = [];
    var pageName = app_1.eve.findOne("display name", { id: entityId })["name"];
    var isCollection = isEntity ? app_1.eve.findOne("collection", { collection: isEntity.id }) : false;
    var joiner = "a";
    if (text && text[0].match(/[aeiou]/i)) {
        joiner = "an";
    }
    var isAScore = 2.5;
    if (isCollection) {
        isAScore = 3;
    }
    options.push({ score: 2.5, action: createAndEmbed, replace: "is a", entityId: entityId, attribute: "related to", text: pageName + " is related to " + text });
    options.push({ score: isAScore, action: createAndEmbed, replace: "related to", entityId: entityId, attribute: "is a", text: pageName + " is " + joiner + " " + text });
    return options;
}
function createAndEmbed(elem, value, doEmbed) {
    //create the page and embed a link to it
    var entity = utils_1.uuid();
    var page = utils_1.uuid();
    var _a = elem.selected, entityId = _a.entityId, attribute = _a.attribute, replace = _a.replace;
    var chain = app_1.dispatch("create page", { page: page, content: "#" + value + "\n" })
        .dispatch("create entity", { entity: entity, page: page, name: value })
        .dispatch("add sourced eav", { entity: entityId, attribute: attribute, value: entity, source: utils_1.uuid() });
    if (replace) {
        chain.dispatch("remove entity attribute", { entity: entityId, attribute: replace, value: entity });
    }
    chain.commit();
    doEmbed(value + "|rep=link;");
}
function representAutocompleteOptions(isEntity, parsed, text, params, entityId) {
    var options = [];
    var isCollection = isEntity ? app_1.eve.findOne("collection", { collection: isEntity.id }) : false;
    options.push({ score: 1, text: "a table", action: embedAs, rep: "table", params: params });
    // options.push({score:1, text: "embed as a value", action: embedAs, rep: "value"});
    if (isEntity) {
        options.push({ score: 1, text: "a link", action: embedAs, rep: "link", params: params });
    }
    if (isCollection) {
        options.push({ score: 1, text: "a list", action: embedAs, rep: "index", params: params });
        options.push({ score: 1, text: "a directory", action: embedAs, rep: "directory", params: params });
    }
    if (isEntity) {
        options.push({ score: 1, text: "a list of related pages", action: embedAs, rep: "related", params: params });
    }
    return options;
}
function urlAutocompleteOptions(isEntity, parsed, url, params, entityId) {
    // @NOTE: url must be normalized before reaching here.
    // @FIXME: Need to get a url property onto the params. Should that be done here?
    var ext = url.slice(url.lastIndexOf(".") + 1).trim().toLowerCase();
    var domain = url.slice(url.indexOf("//") + 2).split("/")[0];
    var isImage = ["png", "jpg", "jpeg", "bmp", "tiff"].indexOf(ext) !== -1;
    var isVideo = (["mp4", "ogv", "webm", "mov", "avi", "flv"].indexOf(ext) !== -1) || (["www.youtube.com", "youtu.be"].indexOf(domain) !== -1);
    var options = [
        { score: 2, text: "a link", action: embedAs, rep: "externalLink", params: params },
        { score: isImage ? 3 : 1, text: "an image", action: embedAs, rep: "externalImage", params: params },
        { score: isVideo ? 3 : 1, text: "a video", action: embedAs, rep: "externalVideo", params: params },
    ];
    return options;
}
function embedAs(elem, value, doEmbed) {
    var text = value.split("|")[0];
    var params = elem.selected.params;
    var rawParams = "rep=" + elem.selected.rep;
    for (var param in params) {
        if (param !== "rep") {
            rawParams += "; " + param + "=" + params[param];
        }
    }
    doEmbed(text + "|" + rawParams);
}
function propertyAutocompleteOptions(isEntity, parsed, text, params, entityId) {
    var options = [];
    var topParse = parsed[0];
    var asQuery = topParse && topParse.state === NLQueryParser_1.StateFlags.COMPLETE;
    var option = { score: 1, action: definePropertyAndEmbed, entityId: entityId, asQuery: asQuery };
    option.children = [
        { c: "attribute-name", text: "property" },
        { c: "inline-cell", contentEditable: true, selected: option, keydown: defineKeys, postRender: utils_1.autoFocus }
    ];
    options.push(option);
    return options;
}
function definePropertyAndEmbed(elem, value, doEmbed) {
    var selected = elem.selected;
    var entityId = selected.entityId, asQuery = selected.asQuery, defineValue = selected.defineValue;
    if (asQuery) {
        value = "= " + value;
    }
    var success = handleAttributeDefinition(entityId, defineValue, value);
    var entityName = app_1.eve.findOne("display name", { id: entityId }).name;
    doEmbed(entityName + "'s " + defineValue + "|rep=CSV;field=" + defineValue);
}
function defineAutocompleteOptions(isEntity, parsed, text, params, entityId) {
    var options = [];
    var topParse = parsed[0];
    var context = topParse.context;
    var attribute;
    if (context.maybeAttributes[0]) {
        attribute = context.maybeAttributes[0].name;
    }
    else {
        attribute = context.attributes[0].displayName;
    }
    var subject = context.entities[0] || context.collections[0];
    var entity = subject.id;
    var option = { score: 1, action: defineAndEmbed, attribute: attribute, entity: entity };
    option.children = [
        { c: "attribute-name", text: attribute },
        { c: "inline-cell", contentEditable: true, selected: option, keydown: defineKeys, postRender: utils_1.autoFocus }
    ];
    options.push(option);
    return options;
}
function focusSelected(node, elem) {
    if (elem.selected.selected && node !== document.activeElement) {
        node.focus();
        utils_1.setEndOfContentEditable(node);
    }
}
function selectOptionIx(event, elem) {
    event.preventDefault();
    app_1.dispatch("moveCellAutocomplete", { cell: elem.selected.cell, value: elem.optionIx }).commit();
}
function modifyAutocompleteOptions(isEntity, parsed, text, params, entityId) {
    var options = [];
    var topParse = parsed[0];
    var context = topParse.context;
    var attribute = context.attributes[0].displayName;
    var subject = context.entities[0] || context.collections[0];
    var entity = subject.id;
    var eavs = app_1.eve.find("entity eavs", { entity: entity, attribute: attribute });
    var ix = 0;
    var sourcesSeen = {};
    for (var _i = 0; _i < eavs.length; _i++) {
        var eav = eavs[_i];
        var option_1 = { score: 1, action: modifyAndEmbed, eav: eav, params: params };
        var generated = app_1.eve.findOne("generated eav", { entity: eav.entity, attribute: eav.attribute, value: eav.value });
        var text_1 = eav.value;
        var sourceView = void 0;
        var display = app_1.eve.findOne("display name", { id: text_1 });
        if (generated) {
            sourceView = generated.source;
            if (sourcesSeen[sourceView])
                continue;
            sourcesSeen[sourceView] = true;
            text_1 = "= " + app_1.eve.findOne("query to id", { id: sourceView }).query;
            option_1.sourceView = sourceView;
            option_1.query = text_1;
        }
        else if (display) {
            text_1 = "= " + display.name;
        }
        option_1.children = [
            { c: "attribute-name", text: attribute },
            { c: "inline-cell", contentEditable: true, text: text_1, optionIx: ix, click: selectOptionIx, selected: option_1, keydown: defineKeys, postRender: focusSelected }
        ];
        options.push(option_1);
        ix++;
    }
    var option = { score: 1, action: defineAndEmbed, attribute: attribute, entity: entity };
    option.children = [
        { c: "attribute-name", text: attribute },
        { c: "inline-cell", contentEditable: true, selected: option, keydown: defineKeys, postRender: focusSelected }
    ];
    options.push(option);
    return options;
}
function modifyAndEmbed(elem, text, doEmbed) {
    var _a = elem.selected, eav = _a.eav, defineValue = _a.defineValue, params = _a.params, sourceView = _a.sourceView, query = _a.query;
    var success = submitAttribute({ currentTarget: { value: defineValue } }, { eav: eav, sourceView: sourceView, query: query });
    if (!success) {
        console.log("I don't know what to do");
    }
    // if you didn't remove all the attributes, just re-embed what was there
    if (app_1.eve.findOne("entity eavs", { entity: eav.entity, attribute: eav.attribute })) {
        doEmbed(text + "|" + stringifyParams(params));
    }
    else {
        // otherwise there's no point in embedding an error cell
        doEmbed("");
    }
}
function interpretAttributeValue(value) {
    var cleaned = value.trim();
    if (cleaned[0] === "=") {
        //parse it
        cleaned = cleaned.substring(1).trim();
        var display = app_1.eve.findOne("display name", { name: cleaned }) || app_1.eve.findOne("display name", { id: cleaned });
        if (display) {
            return { isValue: true, value: display.id };
        }
        var parsed = NLQueryParser_1.parse(cleaned);
        return { isValue: false, parse: parsed, value: cleaned };
    }
    else {
        return { isValue: true, value: utils_1.coerceInput(cleaned) };
    }
}
function handleAttributeDefinition(entity, attribute, search, chain) {
    if (!chain) {
        chain = app_1.dispatch();
    }
    var _a = interpretAttributeValue(search), isValue = _a.isValue, value = _a.value, parse = _a.parse;
    if (isValue) {
        chain.dispatch("add sourced eav", { entity: entity, attribute: attribute, value: value }).commit();
    }
    else {
        var queryText = value.trim();
        // add the query
        app_1.dispatch("insert query", { query: queryText }).commit();
        // create another query that projects eavs
        var queryToId = app_1.eve.findOne("query to id", { query: queryText });
        if (!queryToId)
            return false;
        var id = queryToId.id;
        var params = getCellParams(queryText, "");
        if (!params["field"]) {
            return false;
        }
        else {
            //build a query
            var eavProject = "(query :$$view \"" + entity + "|" + attribute + "|" + id + "\" (select \"" + id + "\" :" + params["field"].replace(" ", "-") + " value)\n                               (project! \"generated eav\" :entity \"" + entity + "\" :attribute \"" + attribute + "\" :value value :source \"" + id + "\"))";
            chain.dispatch("insert implication", { query: eavProject }).commit();
        }
    }
    return true;
}
function defineAndEmbed(elem, text, doEmbed) {
    var selected = elem.selected;
    var entity = selected.entity, attribute = selected.attribute, defineValue = selected.defineValue;
    var success = handleAttributeDefinition(entity, attribute, defineValue);
    if (success) {
        doEmbed(text + "|rep=CSV;field=" + attribute);
    }
    else {
        console.error("Couldn't figure out subject of: " + defineValue);
        doEmbed(text + "|rep=error;message=I couldn't figure out the subject of that search;");
    }
}
function defineKeys(event, elem) {
    var cell = elem.selected.cell;
    if (event.keyCode === utils_1.KEYS.ENTER) {
        elem.selected.defineValue = event.currentTarget.textContent;
        event.preventDefault();
    }
    else if (event.keyCode === utils_1.KEYS.UP) {
        app_1.dispatch("moveCellAutocomplete", { cell: cell, direction: -1 }).commit();
    }
    else if (event.keyCode === utils_1.KEYS.DOWN) {
        app_1.dispatch("moveCellAutocomplete", { cell: cell, direction: 1 }).commit();
    }
    else if (event.keyCode === utils_1.KEYS.ESC) {
        app_1.dispatch("clearActiveCells").commit();
        if (elem.selected.paneId) {
            paneEditors[elem.selected.paneId].cmInstance.focus();
        }
    }
}
function entity(entityId, paneId, kind, options) {
    if (options === void 0) { options = {}; }
    var _a = (app_1.eve.findOne("entity", { entity: entityId }) || {}).content, content = _a === void 0 ? undefined : _a;
    if (content === undefined)
        return { text: "Could not find the requested page" };
    var page = app_1.eve.findOne("entity page", { entity: entityId })["page"];
    var name = app_1.eve.findOne("display name", { id: entityId }).name;
    var cells = getCells(content, paneId);
    var keys = {
        "Backspace": function (cm) { return maybeActivateCell(cm, paneId); },
        "Cmd-Enter": function (cm) { return maybeNavigate(cm, paneId); },
        "=": function (cm) { return createEmbedPopout(cm, paneId); }
    };
    if (kind === PANE.POPOUT) {
        keys["Esc"] = function () {
            app_1.dispatch("remove popup", {}).commit();
            var parent = app_1.eve.findOne("ui pane parent", { pane: paneId })["parent"];
            paneEditors[parent].cmInstance.focus();
        };
    }
    var finalOptions = utils_1.mergeObject({ keys: keys }, options);
    var cellItems = cells.map(function (cell, ix) {
        var ui;
        var active = activeCells[cell.id];
        if (active) {
            ui = cellEditor(entityId, paneId, active || cell);
        }
        else {
            ui = cellUI(paneId, cell.query, cell);
        }
        ui.id = paneId + "|" + cell.id;
        ui.postRender = reparentCell;
        ui["containerId"] = paneId + "|" + cell.id + "|container";
        ui["cell"] = cell;
        return ui;
    });
    var attrs;
    if (kind !== PANE.POPOUT) {
        // attrs = uitk.attributes({entity: entityId, data: {paneId}, key: `${paneId}|${entityId}`});
        attrs = attributesUI(entityId, paneId);
        attrs.c += " page-attributes";
    }
    return { id: paneId + "|" + entityId + "|editor", t: "content", c: "wiki-entity", children: [
            /* This is disabled because searching for just the name of a single entity resolves to a single find step which blows up on query compilation
               {c: "flex-row spaced-row disambiguation", children: [
               {text: "Did you mean to"},
               {t: "a", c: "link btn add-btn", text: `search for '${name}'`, href: "#", name: search, data: {paneId}, link: `search: ${name}`, click: navigate},
               {text: "instead?"}
               ]},
             */
            { c: "wiki-editor", postRender: wikiEditor, onUpdate: updatePage, meta: { entity: entityId, page: page, paneId: paneId }, value: content, options: finalOptions, cells: cells, children: cellItems },
            attrs,
        ] };
}
exports.entity = entity;
function maybeActivateCell(cm, paneId) {
    if (!cm.somethingSelected()) {
        var pos = cm.getCursor("from");
        var marks = cm.findMarksAt(pos);
        var cell;
        for (var _i = 0; _i < marks.length; _i++) {
            var mark = marks[_i];
            var to = mark.find().to;
            if (mark.cell && to.ch === pos.ch) {
                cell = mark.cell;
                break;
            }
        }
        if (cell) {
            var query = cell.query.split("|")[0];
            app_1.dispatch("addActiveCell", { id: cell.id, cell: cell, query: query }).commit();
            return;
        }
        else if (pos.line === 1 && pos.ch === 0) {
            return;
        }
    }
    return CodeMirror.Pass;
}
function maybeNavigate(cm, paneId) {
    if (!cm.somethingSelected()) {
        var pos = cm.getCursor("from");
        var marks = cm.findMarksAt(pos);
        var toClick;
        for (var _i = 0; _i < marks.length; _i++) {
            var mark = marks[_i];
            if (mark.cell) {
                toClick = mark;
            }
        }
        if (toClick) {
            // @HACK: there really should be a better way for me to find out
            // if there's a link in this cell and if it is what that link is
            // to.
            var link = toClick.widgetNode.querySelector(".link");
            if (link) {
                var elem = app_1.renderer.tree[link._id];
                var coords = cm.cursorCoords(true, "page");
                navigate({ clientX: coords.left, clientY: coords.top, preventDefault: function () { } }, elem);
            }
        }
    }
}
var activeCells = {};
app_1.handle("clearActiveCells", function (changes, info) {
    for (var cell in activeCells) {
        changes.dispatch("removeActiveCell", activeCells[cell]);
    }
});
app_1.handle("addActiveCell", function (changes, info) {
    changes.dispatch("clearActiveCells", {});
    var id = info.id;
    info.selected = 0;
    activeCells[id] = info;
});
app_1.handle("removeActiveCell", function (changes, info) {
    var id = info.id;
    delete activeCells[id];
});
app_1.handle("setCellState", function (changes, info) {
    var active = activeCells[info.id];
    active.selected = 0;
    active.state = info.state;
});
app_1.handle("updateActiveCell", function (changes, info) {
    var active = activeCells[info.id];
    active.query = info.query;
    active.selected = 0;
    active.state = "query";
});
app_1.handle("moveCellAutocomplete", function (changes, info) {
    var active = activeCells[info.cell.id];
    var direction = info.direction, value = info.value;
    if (value === undefined) {
        active.selected += direction;
    }
    else {
        active.selected = value;
    }
});
function updateActiveCell(event, elem) {
    var cell = elem.cell;
    app_1.dispatch("updateActiveCell", { id: cell.id, cell: cell, query: event.currentTarget.textContent }).commit();
}
function activateCell(event, elem) {
    var cell = elem.cell;
    var query = cell.query.split("|")[0];
    app_1.dispatch("addActiveCell", { id: cell.id, cell: cell, query: query }).commit();
    event.preventDefault();
}
function createEmbedPopout(cm, paneId) {
    var coords = cm.cursorCoords("head", "page");
    // dispatch("createEmbedPopout", {paneId, x: coords.left, y: coords.top - 20}).commit();
    cm.operation(function () {
        var from = cm.getCursor("from");
        var id = utils_1.uuid();
        cm.replaceRange("=", from, cm.getCursor("to"));
        if (from.line === 0)
            return;
        var to = cm.posFromIndex(cm.getCursor("from"));
        var fromIx = cm.indexFromPos(from);
        var toIx = cm.indexFromPos(to);
        var cell = { id: id, start: fromIx, length: toIx - fromIx, placeholder: true, query: "", paneId: paneId };
        app_1.dispatch("addActiveCell", { id: id, query: "", cell: cell, placeholder: true });
    });
}
function makeDoEmbedFunction(cm, mark, cell, paneId) {
    return function (value) {
        var _a = mark.find(), from = _a.from, to = _a.to;
        if (value[0] === "=") {
            value = value.substring(1);
        }
        value = value.trim();
        var _b = value.split("|"), text = _b[0], rawParams = _b[1];
        text = text.trim();
        // @TODO: this doesn't take disambiguations into account
        var display = app_1.eve.findOne("display name", { name: text });
        if (display) {
            text = display.id;
        }
        var replacement = "{" + text + "|" + (rawParams || "") + "}";
        if (text === "") {
            replacement = "";
        }
        if (cm.getRange(from, to) !== replacement) {
            cm.replaceRange(replacement, from, to);
        }
        paneEditors[paneId].cmInstance.focus();
        var chain = app_1.dispatch("removeActiveCell", cell);
        if (replacement) {
            chain.dispatch("insert query", { query: text });
        }
        chain.commit();
    };
}
function embeddedCellKeys(event, elem) {
    var paneId = elem.paneId, cell = elem.cell;
    var target = event.currentTarget;
    var value = target.textContent;
    var editor = paneEditors[paneId];
    var cm = editor.cmInstance;
    var mark = editor.marks[cell.id];
    if (event.keyCode === utils_1.KEYS.BACKSPACE && value === "") {
        var _a = mark.find(), from = _a.from, to = _a.to;
        cm.replaceRange("", from, to);
        paneEditors[paneId].cmInstance.focus();
        app_1.dispatch("removeActiveCell", cell).commit();
        event.preventDefault();
    }
    else if (event.keyCode === utils_1.KEYS.ESC || (event.keyCode === utils_1.KEYS.ENTER && value.trim() === "")) {
        var _b = mark.find(), from = _b.from, to = _b.to;
        if (cell.placeholder) {
            cm.replaceRange("= ", from, to);
        }
        paneEditors[paneId].cmInstance.focus();
        app_1.dispatch("removeActiveCell", cell).commit();
        event.preventDefault();
    }
    else if (event.keyCode === utils_1.KEYS.ENTER) {
        var doEmbed = makeDoEmbedFunction(cm, mark, cell, paneId);
        if (elem.selected && elem.selected.action) {
            if (typeof elem.selected.action === "function") {
                elem.selected.action(elem, value, doEmbed);
            }
        }
        event.preventDefault();
    }
    else if (event.keyCode === utils_1.KEYS.UP) {
        app_1.dispatch("moveCellAutocomplete", { cell: cell, direction: -1 }).commit();
        event.preventDefault();
    }
    else if (event.keyCode === utils_1.KEYS.DOWN) {
        app_1.dispatch("moveCellAutocomplete", { cell: cell, direction: 1 }).commit();
        event.preventDefault();
    }
    event.stopPropagation();
}
function updatePage(meta, content) {
    app_1.dispatch("update page", { page: meta.page, content: content }).commit();
}
function navigate(event, elem) {
    var paneId = elem.data.paneId;
    var info = { paneId: paneId, value: elem.link, peek: elem.peek };
    if (event.clientX) {
        info.x = "calc(50% - 350px)";
        info.y = event.clientY;
    }
    app_1.dispatch("ui set search", info).commit();
    event.preventDefault();
}
//---------------------------------------------------------
// Page parsing
//---------------------------------------------------------
function getCells(content, paneId) {
    var cells = [];
    var ix = 0;
    var ids = {};
    for (var _i = 0, _a = content.split(/({[^]*?})/gm); _i < _a.length; _i++) {
        var part = _a[_i];
        if (part[0] === "{") {
            var id = part;
            if (!ids[part]) {
                ids[part] = 2;
            }
            else if (ids[part] >= 2) {
                id += ids[part];
                ids[part]++;
            }
            var placeholder = false;
            if (part.match(/\{\$\$.*\$\$\}/)) {
                placeholder = true;
            }
            cells.push({ start: ix, length: part.length, value: part, query: part.substring(1, part.length - 1), id: id, placeholder: placeholder });
        }
        ix += part.length;
    }
    for (var active in activeCells) {
        var cell = activeCells[active].cell;
        if (cell.placeholder && cell.paneId === paneId) {
            cells.push(cell);
        }
    }
    return cells;
}
//---------------------------------------------------------
// Attributes
//---------------------------------------------------------
function sortOnAttribute(a, b) {
    var aAttr = a.eav.attribute;
    var bAttr = b.eav.attribute;
    if (aAttr < bAttr)
        return -1;
    if (aAttr > bAttr)
        return 1;
    return 0;
}
function attributesUI(entityId, paneId) {
    var eavs = app_1.eve.find("entity eavs", { entity: entityId });
    var items = [];
    for (var _i = 0; _i < eavs.length; _i++) {
        var eav = eavs[_i];
        var entity_2 = eav.entity, attribute = eav.attribute, value = eav.value;
        var found = app_1.eve.findOne("generated eav", { entity: entity_2, attribute: attribute, value: value });
        var item = { eav: eav, isManual: !found };
        if (found) {
            item.sourceView = found.source;
        }
        items.push(item);
    }
    items.sort(sortOnAttribute);
    var state = exports.uiState.widget.attributes[entityId] || {};
    var ix = 0;
    var len = items.length;
    var tableChildren = [];
    while (ix < len) {
        var item = items[ix];
        var group = { children: [] };
        var subItem = item;
        while (ix < len && subItem.eav.attribute === item.eav.attribute) {
            var child = { c: "value", eav: subItem.eav, children: [] };
            var valueUI = subItem;
            var relatedSourceView = false;
            valueUI.value = subItem.eav.value;
            valueUI["submit"] = submitAttribute;
            valueUI["eav"] = subItem.eav;
            if (!subItem.isManual) {
                child.c += " generated";
                relatedSourceView = state.sourceView === subItem.sourceView;
                valueUI.text = valueUI.value;
                if (state.active && state.active.__id === subItem.eav.__id) {
                    var query = app_1.eve.findOne("query to id", { id: subItem.sourceView }).query;
                    child.style = "background: red;";
                    valueUI.t = "input";
                    valueUI.value = "= " + query;
                    valueUI["query"] = valueUI.value;
                    valueUI["sourceView"] = subItem.sourceView;
                    valueUI.postRender = utils_1.autoFocus;
                    valueUI.text = undefined;
                    child.children.push(valueUI);
                }
                else if (relatedSourceView) {
                    child.style = "background: red;";
                    valueUI.text = "editing search...";
                }
                child["sourceView"] = subItem.sourceView;
                child.click = setActiveAttribute;
            }
            else {
                valueUI.t = "input";
            }
            var display = app_1.eve.findOne("display name", { id: valueUI.value });
            if (display && !relatedSourceView) {
                if (!state.active || state.active.__id !== subItem.eav.__id) {
                    child.children.push({ c: "link", text: display.name, data: { paneId: paneId }, link: display.id, click: navigate, peek: true });
                    child.click = setActiveAttribute;
                    valueUI.t = "div";
                }
                else {
                    valueUI.value = "= " + display.name;
                    valueUI.postRender = utils_1.autoFocus;
                    child.children.push(valueUI);
                }
            }
            else {
                child.children.push(valueUI);
            }
            if (valueUI.t === "input") {
                valueUI.keydown = handleAttributesKey;
            }
            else {
                child.children.push({ c: "spacer no-mouse" });
            }
            child.children.push({ c: "ion-android-close remove", eav: subItem.eav, sourceView: subItem.sourceView, query: valueUI["query"], click: removeSubItem });
            group.children.push(child);
            ix++;
            subItem = items[ix];
        }
        tableChildren.push({ id: entityId + "|" + paneId + "|" + item.eav.attribute, c: "attribute", children: [
                { c: "attribute-name", text: item.eav.attribute },
                group,
            ] });
    }
    tableChildren.push({ id: entityId + "|" + paneId + "|adder", c: "attribute adder", children: [
            { t: "input", c: "attribute-name value", placeholder: "property", keydown: handleAttributesKey, input: setAdder, submit: submitAdder, field: "adderAttribute", entityId: entityId, value: state.adderAttribute },
            { t: "input", c: "value", placeholder: "value", keydown: handleAttributesKey, input: setAdder, submit: submitAdder, field: "adderValue", entityId: entityId, value: state.adderValue },
        ] });
    return { c: "attributes", children: tableChildren };
}
function attributesUIAutocompleteOptions(isEntity, parsed, text, params, entityId) {
    var options = [];
    //there are two possible things either we're creating a page
    // or we need to pick what field of the result we want
    return options;
}
app_1.handle("setActiveAttribute", function (changes, _a) {
    var eav = _a.eav, sourceView = _a.sourceView;
    if (!exports.uiState.widget.attributes[eav.entity]) {
        exports.uiState.widget.attributes[eav.entity] = {};
    }
    var cur = exports.uiState.widget.attributes[eav.entity];
    cur.active = eav;
    cur.sourceView = sourceView;
});
app_1.handle("clearActiveAttribute", function (changes, _a) {
    var entity = _a.entity;
    var cur = exports.uiState.widget.attributes[entity];
    if (cur) {
        cur.active = false;
        cur.sourceView = false;
    }
});
function removeSubItem(event, elem) {
    event.preventDefault();
    submitAttribute(event, elem);
}
function setActiveAttribute(event, elem) {
    if (!event.defaultPrevented) {
        app_1.dispatch("setActiveAttribute", { eav: elem.eav, sourceView: elem.sourceView }).commit();
        event.preventDefault();
    }
}
function handleAttributesKey(event, elem) {
    if (event.keyCode === utils_1.KEYS.ENTER && elem.submit) {
        elem.submit(event, elem);
    }
    else if (event.keyCode === utils_1.KEYS.ESC) {
        app_1.dispatch("setActiveAttribute", { eav: { entity: elem.eav.entity }, sourceView: false }).commit();
    }
}
app_1.handle("setAttributeAdder", function (changes, _a) {
    var entityId = _a.entityId, field = _a.field, value = _a.value;
    var cur = exports.uiState.widget.attributes[entityId];
    if (!exports.uiState.widget.attributes[entityId]) {
        cur = exports.uiState.widget.attributes[entityId] = {};
    }
    cur[field] = value;
});
function setAdder(event, elem) {
    var value = event.currentTarget.value;
    app_1.dispatch("setAttributeAdder", { entityId: elem.entityId, field: elem.field, value: value }).commit();
}
function submitAdder(event, elem) {
    var entityId = elem.entityId;
    var state = exports.uiState.widget.attributes[entityId];
    if (!state)
        return;
    var adderAttribute = state.adderAttribute, adderValue = state.adderValue;
    var success = false;
    if (adderAttribute && adderValue) {
        var chain = app_1.dispatch("setAttributeAdder", { entityId: entityId, field: "adderAttribute", value: "" })
            .dispatch("setAttributeAdder", { entityId: entityId, field: "adderValue", value: "" });
        success = handleAttributeDefinition(entityId, adderAttribute, adderValue, chain);
    }
    //make sure the focus ends up back in the property input
    event.currentTarget.parentNode.firstChild.focus();
    return success;
}
app_1.handle("remove attribute generating query", function (changes, _a) {
    var eav = _a.eav, view = _a.view;
    var queryId = eav.entity + "|" + eav.attribute + "|" + view;
    app_1.eve.removeView(queryId);
    changes.merge(runtime_1.Query.remove(queryId, app_1.eve));
    //find all the unions this was used with
    for (var _i = 0, _b = app_1.eve.find("action source", { "source view": queryId }); _i < _b.length; _i++) {
        var source = _b[_i];
        var action = source.action;
        changes.remove("action", { action: action });
        changes.remove("action mapping", { action: action });
        changes.remove("action mapping constant", { action: action });
    }
    changes.remove("action source", { source: queryId });
});
function submitAttribute(event, elem) {
    var eav = elem.eav, sourceView = elem.sourceView, query = elem.query;
    var chain = app_1.dispatch("clearActiveAttribute", { entity: eav.entity });
    var value = event.currentTarget.value;
    if (query !== undefined && value === query) {
        return chain.commit();
    }
    if (elem.sourceView !== undefined) {
        //remove the previous source
        chain.dispatch("remove attribute generating query", { eav: eav, view: sourceView });
    }
    else {
        //remove the previous eav
        var fact = utils_1.copy(eav);
        fact.__id = undefined;
        chain.dispatch("remove entity attribute", fact);
    }
    if (value !== undefined && value !== "") {
        return handleAttributeDefinition(eav.entity, eav.attribute, value, chain);
    }
    else {
        chain.commit();
    }
}
//---------------------------------------------------------
// Wiki Widgets
//---------------------------------------------------------
function searchInput(paneId, value) {
    var display = app_1.eve.findOne("display name", { id: value });
    var name = value;
    if (display) {
        name = display.name;
    }
    var state = exports.uiState.widget.search[paneId] || { focused: false, plan: false };
    return {
        c: "flex-grow wiki-search-wrapper",
        children: [
            codeMirrorElement({
                c: "flex-grow wiki-search-input " + (state.focused ? "selected" : ""),
                paneId: paneId,
                value: name,
                focus: focusSearch,
                blur: setSearch,
                // change: updateSearch,
                shortcuts: { "Enter": setSearch }
            }),
            { c: "controls", children: [
                    { c: "ion-ios-arrow-" + (state.plan ? 'up' : 'down') + " plan", click: toggleSearchPlan, paneId: paneId },
                    // while technically a button, we don't need to do anything as clicking it will blur the editor
                    // which will execute the search
                    { c: "ion-android-search visible", paneId: paneId }
                ] },
        ]
    };
}
exports.searchInput = searchInput;
;
function focusSearch(event, elem) {
    app_1.dispatch("ui focus search", elem).commit();
}
function setSearch(event, elem) {
    var value = event.value;
    var pane = app_1.eve.findOne("ui pane", { pane: elem.paneId });
    if (!pane || pane.contains !== event.value) {
        app_1.dispatch("insert query", { query: value })
            .dispatch("ui set search", { paneId: elem.paneId, value: event.value })
            .commit();
    }
}
function updateSearch(event, elem) {
    app_1.dispatch("ui update search", elem).commit();
}
function toggleSearchPlan(event, elem) {
    app_1.dispatch("ui toggle search plan", elem).commit();
}
;
function codeMirrorElement(elem) {
    elem.postRender = codeMirrorPostRender(elem.postRender);
    return elem;
}
exports.codeMirrorElement = codeMirrorElement;
var _codeMirrorPostRenderMemo = {};
function handleCMEvent(handler, elem) {
    return function (cm) {
        var evt = (new CustomEvent("CMEvent"));
        evt.editor = cm;
        evt.value = cm.getDoc().getValue();
        handler(evt, elem);
    };
}
function codeMirrorPostRender(postRender) {
    var key = postRender ? postRender.toString() : "";
    if (_codeMirrorPostRenderMemo[key])
        return _codeMirrorPostRenderMemo[key];
    return _codeMirrorPostRenderMemo[key] = function (node, elem) {
        var cm = node.cm;
        if (!cm) {
            var extraKeys = {};
            if (elem.shortcuts) {
                for (var shortcut in elem.shortcuts)
                    extraKeys[shortcut] = handleCMEvent(elem.shortcuts[shortcut], elem);
            }
            cm = node.cm = CodeMirror(node, {
                lineWrapping: elem.lineWrapping !== false ? true : false,
                lineNumbers: elem.lineNumbers,
                mode: elem.mode || "text",
                extraKeys: extraKeys
            });
            if (elem.change)
                cm.on("change", handleCMEvent(elem.change, elem));
            if (elem.blur)
                cm.on("blur", handleCMEvent(elem.blur, elem));
            if (elem.focus)
                cm.on("focus", handleCMEvent(elem.focus, elem));
            if (elem.autofocus)
                cm.focus();
        }
        if (cm.getDoc().getValue() !== elem.value)
            cm.setValue(elem.value || "");
        if (postRender)
            postRender(node, elem);
    };
}
function getEntitiesFromResults(results, _a) {
    var _b = (_a === void 0 ? {} : _a).fields, fields = _b === void 0 ? ["entity"] : _b;
    var entities = [];
    if (!results.length)
        return entities;
    for (var _i = 0; _i < fields.length; _i++) {
        var field = fields[_i];
        if (results[0][field] === undefined)
            field = utils_1.builtinId(field);
        for (var _c = 0; _c < results.length; _c++) {
            var fact = results[_c];
            entities.push(fact[field]);
        }
    }
    return entities;
}
function getURLsFromResults(results, _a) {
    var _b = (_a === void 0 ? {} : _a).fields, fields = _b === void 0 ? ["url"] : _b;
    var urls = [];
    if (!results.length)
        return urls;
    for (var _i = 0; _i < fields.length; _i++) {
        var field = fields[_i];
        if (results[0][field] === undefined)
            field = utils_1.builtinId(field);
        for (var _c = 0; _c < results.length; _c++) {
            var fact = results[_c];
            if (urlRegex.exec(fact[field]))
                urls.push(fact[field]);
        }
    }
    return urls;
}
function prepareEntity(results, params) {
    var elem = {};
    var entities = getEntitiesFromResults(results, { fields: params.field ? [params.field] : undefined });
    var elems = [];
    for (var _i = 0; _i < entities.length; _i++) {
        var entity_3 = entities[_i];
        var elem_1 = utils_1.copy(params);
        elem_1.entity = entity_3;
        elems.push(elem_1);
    }
    if (elems.length === 1)
        return elems[0];
    else
        return elems;
}
function prepareURL(results, params) {
    var elem = {};
    var urls = getURLsFromResults(results, { fields: params.field ? [params.field] : undefined });
    var elems = [];
    for (var _i = 0; _i < urls.length; _i++) {
        var url = urls[_i];
        var elem_2 = utils_1.copy(params);
        elem_2.url = url;
        elems.push(elem_2);
    }
    if (elems.length === 1)
        return elems[0];
    else
        return elems;
}
var _prepare = {
    name: prepareEntity,
    link: prepareEntity,
    attributes: prepareEntity,
    related: prepareEntity,
    index: prepareEntity,
    view: prepareEntity,
    results: prepareEntity,
    value: function (results, params) {
        if (!params.field)
            throw new Error("Value representation requires a 'field' param indicating which field to represent");
        var field = params.field;
        if (!results.length)
            return [];
        // If field isn't in results, try to resolve it as a field name, otherwise error out
        if (results[0][field] === undefined) {
            var potentialIds = app_1.eve.find("display name", { name: field });
            var neueField;
            for (var _i = 0; _i < potentialIds.length; _i++) {
                var display = potentialIds[_i];
                if (results[0][display.id] !== undefined) {
                    if (neueField) {
                        neueField = undefined;
                        break;
                    }
                    neueField = display.id;
                }
            }
            if (!neueField)
                throw new Error("Unable to uniquely resolve field name " + field + " in result fields " + Object.keys(results[0]));
            else
                field = neueField;
        }
        var elems = [];
        for (var _a = 0; _a < results.length; _a++) {
            var row = results[_a];
            elems.push({ text: row[field], data: params.data });
        }
        return elems;
    },
    CSV: function (results, params) {
        if (!params.field)
            throw new Error("Value representation requires a 'field' param indicating which field to represent");
        var field = params.field;
        if (!results.length)
            return [];
        // If field isn't in results, try to resolve it as a field name, otherwise error out
        if (results[0][field] === undefined) {
            var potentialIds = app_1.eve.find("display name", { name: field });
            var neueField;
            for (var _i = 0; _i < potentialIds.length; _i++) {
                var display = potentialIds[_i];
                if (results[0][display.id] !== undefined) {
                    if (neueField) {
                        neueField = undefined;
                        break;
                    }
                    neueField = display.id;
                }
            }
            if (!neueField)
                throw new Error("Unable to uniquely resolve field name " + field + " in result fields " + Object.keys(results[0]));
            else
                field = neueField;
        }
        var values = [];
        for (var _a = 0; _a < results.length; _a++) {
            var row = results[_a];
            values.push(row[field]);
        }
        return { values: values, data: params.data };
    },
    error: function (results, params) {
        return { text: params["message"] };
    },
    table: function (results, params) {
        return { rows: results, data: params.data };
    },
    directory: function (results, params) {
        var entities = getEntitiesFromResults(results, { fields: params.field ? [params.field] : undefined });
        if (entities.length === 1) {
            var collection = entities[0];
            entities.length = 0;
            for (var _i = 0, _a = app_1.eve.find("is a attributes", { collection: collection }); _i < _a.length; _i++) {
                var fact = _a[_i];
                entities.push(fact.entity);
            }
        }
        return { entities: entities, data: params.data };
    },
    externalLink: prepareURL,
    externalImage: prepareURL,
    externalVideo: prepareURL,
    embeddedCell: function (results, params) {
        var rep = params["childRep"];
        var childInfo;
        if (_prepare[rep]) {
            params["data"] = params["data"] || params;
            childInfo = _prepare[rep](results, params);
            childInfo.data = childInfo.data || params;
        }
        else {
            childInfo = { data: params };
        }
        return { childInfo: childInfo, rep: rep, click: activateCell, cell: params["cell"] };
    },
};
function represent(search, rep, results, params) {
    // console.log("repping:", results, " as", rep, " with params ", params);
    if (rep in _prepare) {
        var embedParamSets = _prepare[rep](results.results, params);
        var isArray = embedParamSets && embedParamSets.constructor === Array;
        try {
            if (!embedParamSets || isArray && embedParamSets.length === 0) {
                return uitk.error({ text: search + " as " + rep });
            }
            else if (embedParamSets.constructor === Array) {
                var wrapper = { c: "flex-column", children: [] };
                for (var _i = 0; _i < embedParamSets.length; _i++) {
                    var embedParams = embedParamSets[_i];
                    embedParams["data"] = embedParams["data"] || params;
                    wrapper.children.push(uitk[rep](embedParams));
                }
                return wrapper;
            }
            else {
                var embedParams = embedParamSets;
                embedParams["data"] = embedParams["data"] || params;
                return uitk[rep](embedParams);
            }
        }
        catch (err) {
            console.error("REPRESENTATION ERROR");
            console.error({ search: search, rep: rep, results: results, params: params });
            console.error(err);
            return uitk.error({ text: "Failed to embed as " + (params["childRep"] || rep) });
        }
    }
}
var historyState = window.history.state;
var historyURL = utils_1.location();
window.addEventListener("popstate", function (evt) {
    var popout = app_1.eve.findOne("ui pane", { kind: PANE.POPOUT });
    if (popout && popoutHistory.length) {
        window.history.pushState(historyState, null, historyURL);
        var search_1 = popoutHistory.pop();
        app_1.dispatch("ui set search", { paneId: popout.pane, value: search_1, peek: true, popState: true }).commit();
        return;
    }
    else if (evt.state && evt.state.root) {
        window.history.back();
        return;
    }
    historyState = evt.state;
    historyURL = utils_1.location();
    var _a = evt.state || {}, _b = _a.paneId, paneId = _b === void 0 ? undefined : _b, _c = _a.contains, contains = _c === void 0 ? undefined : _c;
    if (paneId === undefined || contains === undefined)
        return;
    app_1.dispatch("ui set search", { paneId: paneId, value: contains, popState: true }).commit();
});
// Prevent backspace from going back
window.addEventListener("keydown", function (event) {
    var current = event.target;
    if (event.keyCode === utils_1.KEYS.BACKSPACE && current.nodeName !== "INPUT" && current.nodeName !== "TEXTAREA" && current.contentEditable !== "true") {
        event.preventDefault();
    }
});
// @NOTE: Uncomment this to enable the new UI, or type `window["NEUE_UI"] = true; app.render()` into the console to enable it transiently.
window["NEUE_UI"] = true;
var _a;

},{"./NLQueryParser":8,"./app":9,"./parser":13,"./richTextEditor":14,"./runtime":15,"./uitk":18,"./utils":19,"codemirror":2}],17:[function(require,module,exports){
var utils_1 = require("./utils");
var runtime_1 = require("./runtime");
function resolve(table, fact) {
    var neue = {};
    for (var field in fact)
        neue[(table + ": " + field)] = fact[field];
    return neue;
}
function humanize(table, fact) {
    var neue = {};
    for (var field in fact)
        neue[field.slice(table.length + 2)] = fact[field];
    return neue;
}
function resolvedAdd(changeset, table, fact) {
    return changeset.add(table, resolve(table, fact));
}
function resolvedRemove(changeset, table, fact) {
    return changeset.remove(table, resolve(table, fact));
}
function humanizedFind(ixer, table, query) {
    var results = [];
    for (var _i = 0, _a = ixer.find(table, resolve(table, query)); _i < _a.length; _i++) {
        var fact = _a[_i];
        results.push(humanize(table, fact));
    }
    var diag = {};
    for (var table_1 in ixer.tables)
        diag[table_1] = ixer.tables[table_1].table.length;
    return results;
}
var UI = (function () {
    function UI(id) {
        this.id = id;
        this._children = [];
        this._attributes = {};
        this._events = {};
    }
    UI.remove = function (template, ixer) {
        var changeset = ixer.diff();
        resolvedRemove(changeset, "ui template", { template: template });
        resolvedRemove(changeset, "ui template binding", { template: template });
        var bindings = humanizedFind(ixer, "ui template binding", { template: template });
        for (var _i = 0; _i < bindings.length; _i++) {
            var binding = bindings[_i];
            changeset.merge(runtime_1.Query.remove(binding.binding, ixer));
        }
        resolvedRemove(changeset, "ui embed", { template: template });
        var embeds = humanizedFind(ixer, "ui embed", { template: template });
        for (var _a = 0; _a < embeds.length; _a++) {
            var embed = embeds[_a];
            resolvedRemove(changeset, "ui embed scope", { template: template, embed: embed.embed });
            resolvedRemove(changeset, "ui embed scope binding", { template: template, embed: embed.embed });
        }
        resolvedRemove(changeset, "ui attribute", { template: template });
        resolvedRemove(changeset, "ui attribute binding", { template: template });
        resolvedRemove(changeset, "ui event", { template: template });
        var events = humanizedFind(ixer, "ui event", { template: template });
        for (var _b = 0; _b < events.length; _b++) {
            var event_1 = events[_b];
            resolvedRemove(changeset, "ui event state", { template: template, event: event_1.event });
            resolvedRemove(changeset, "ui event state binding", { template: template, event: event_1.event });
        }
        for (var _c = 0, _d = humanizedFind(ixer, "ui template", { parent: template }); _c < _d.length; _c++) {
            var child = _d[_c];
            changeset.merge(UI.remove(child.template, ixer));
        }
        return changeset;
    };
    UI.prototype.copy = function () {
        var neue = new UI(this.id);
        neue._binding = this._binding;
        neue._embedded = this._embedded;
        neue._children = this._children;
        neue._attributes = this._attributes;
        neue._events = this._events;
        neue._parent = this._parent;
        return neue;
    };
    UI.prototype.changeset = function (ixer) {
        var changeset = ixer.diff();
        var parent = this._attributes["parent"] || (this._parent && this._parent.id) || "";
        var ix = this._attributes["ix"];
        if (ix === undefined)
            ix = (this._parent && this._parent._children.indexOf(this));
        if (ix === -1 || ix === undefined)
            ix = "";
        if (this._embedded)
            parent = "";
        resolvedAdd(changeset, "ui template", { template: this.id, parent: parent, ix: ix });
        if (this._binding) {
            if (!this._binding.name || this._binding.name === "unknown")
                this._binding.name = "bound view " + this.id;
            changeset.merge(this._binding.changeset(ixer));
            resolvedAdd(changeset, "ui template binding", { template: this.id, binding: this._binding.name });
        }
        if (this._embedded) {
            var embed = utils_1.uuid();
            resolvedAdd(changeset, "ui embed", { embed: embed, template: this.id, parent: (this._parent || {}).id, ix: ix });
            for (var key in this._embedded) {
                var value = this._attributes[key];
                if (value instanceof Array)
                    resolvedAdd(changeset, "ui embed scope binding", { embed: embed, key: key, source: value[0], alias: value[1] });
                else
                    resolvedAdd(changeset, "ui embed scope", { embed: embed, key: key, value: value });
            }
        }
        for (var property in this._attributes) {
            var value = this._attributes[property];
            if (value instanceof Array)
                resolvedAdd(changeset, "ui attribute binding", { template: this.id, property: property, source: value[0], alias: value[1] });
            else
                resolvedAdd(changeset, "ui attribute", { template: this.id, property: property, value: value });
        }
        for (var event_2 in this._events) {
            resolvedAdd(changeset, "ui event", { template: this.id, event: event_2 });
            var state = this._events[event_2];
            for (var key in state) {
                var value = state[key];
                if (value instanceof Array)
                    resolvedAdd(changeset, "ui event state binding", { template: this.id, event: event_2, key: key, source: value[0], alias: value[1] });
                else
                    resolvedAdd(changeset, "ui event state", { template: this.id, event: event_2, key: key, value: value });
            }
        }
        for (var _i = 0, _a = this._children; _i < _a.length; _i++) {
            var child = _a[_i];
            changeset.merge(child.changeset(ixer));
        }
        return changeset;
    };
    UI.prototype.load = function (template, ixer, parent) {
        var fact = humanizedFind(ixer, "ui template", { template: template })[0];
        if (!fact)
            return this;
        if (parent || fact.parent)
            this._parent = parent || new UI(this._parent);
        var binding = humanizedFind(ixer, "ui template binding", { template: template })[0];
        if (binding)
            this.bind((new runtime_1.Query(ixer, binding.binding)));
        var embed = humanizedFind(ixer, "ui embed", { template: template, parent: this._parent ? this._parent.id : "" })[0];
        if (embed) {
            var scope = {};
            for (var _i = 0, _a = humanizedFind(ixer, "ui embed scope", { embed: embed.embed }); _i < _a.length; _i++) {
                var attr = _a[_i];
                scope[attr.key] = attr.value;
            }
            for (var _b = 0, _c = humanizedFind(ixer, "ui embed scope binding", { embed: embed.embed }); _b < _c.length; _b++) {
                var attr = _c[_b];
                scope[attr.key] = [attr.source, attr.alias];
            }
            this.embed(scope);
        }
        for (var _d = 0, _e = humanizedFind(ixer, "ui attribute", { template: template }); _d < _e.length; _d++) {
            var attr = _e[_d];
            this.attribute(attr.property, attr.value);
        }
        for (var _f = 0, _g = humanizedFind(ixer, "ui attribute binding", { template: template }); _f < _g.length; _f++) {
            var attr = _g[_f];
            this.attribute(attr.property, [attr.source, attr.alias]);
        }
        for (var _h = 0, _j = humanizedFind(ixer, "ui event", { template: template }); _h < _j.length; _h++) {
            var event_3 = _j[_h];
            var state = {};
            for (var _k = 0, _l = humanizedFind(ixer, "ui event state", { template: template, event: event_3.event }); _k < _l.length; _k++) {
                var attr = _l[_k];
                state[event_3.key] = event_3.value;
            }
            for (var _m = 0, _o = humanizedFind(ixer, "ui event state binding", { template: template, event: event_3.event }); _m < _o.length; _m++) {
                var attr = _o[_m];
                state[event_3.key] = [event_3.source, event_3.alias];
            }
            this.event(event_3.event, state);
        }
        for (var _p = 0, _q = humanizedFind(ixer, "ui template", { parent: template }); _p < _q.length; _p++) {
            var child = _q[_p];
            this.child((new UI(child.template)).load(child.template, ixer, this));
        }
        return this;
    };
    UI.prototype.children = function (neue, append) {
        if (append === void 0) { append = false; }
        if (!neue)
            return this._children;
        if (!append)
            this._children.length = 0;
        for (var _i = 0; _i < neue.length; _i++) {
            var child = neue[_i];
            var copied = child.copy();
            copied._parent = this;
            this._children.push(copied);
        }
        return this._children;
    };
    UI.prototype.child = function (child, ix, embed) {
        child = child.copy();
        child._parent = this;
        if (embed)
            child.embed(embed);
        if (!ix)
            this._children.push(child);
        else
            this._children.splice(ix, 0, child);
        return child;
    };
    UI.prototype.removeChild = function (ix) {
        return this._children.splice(ix, 1);
    };
    UI.prototype.attributes = function (properties, merge) {
        if (merge === void 0) { merge = false; }
        if (!properties)
            return this._attributes;
        if (!merge) {
            for (var prop in this._attributes)
                delete this._attributes[prop];
        }
        for (var prop in properties)
            this._attributes[prop] = properties[prop];
        return this;
    };
    UI.prototype.attribute = function (property, value) {
        if (value === undefined)
            return this._attributes[property];
        this._attributes[property] = value;
        return this;
    };
    UI.prototype.removeAttribute = function (property) {
        delete this._attributes[property];
        return this;
    };
    UI.prototype.events = function (events, merge) {
        if (merge === void 0) { merge = false; }
        if (!events)
            return this._events;
        if (!merge) {
            for (var event_4 in this._events)
                delete this._events[event_4];
        }
        for (var event_5 in events)
            this._events[event_5] = events[event_5];
        return this;
    };
    UI.prototype.event = function (event, state) {
        if (state === undefined)
            return this._events[event];
        this._attributes[event] = state;
        return this;
    };
    UI.prototype.removeEvent = function (event) {
        delete this._events[event];
        return this;
    };
    UI.prototype.embed = function (scope) {
        if (scope === void 0) { scope = {}; }
        if (!scope) {
            this._embedded = undefined;
            return this;
        }
        if (scope === true)
            scope = {};
        this._embedded = scope;
        return this;
    };
    UI.prototype.bind = function (binding) {
        this._binding = binding;
        return this;
    };
    return UI;
})();
exports.UI = UI;
// @TODO: Finish reference impl.
// @TODO: Then build bit-generating version
var UIRenderer = (function () {
    function UIRenderer(ixer) {
        this.ixer = ixer;
        this.compiled = 0;
        this._tagCompilers = {};
        this._handlers = [];
    }
    UIRenderer.prototype.compile = function (roots) {
        if (utils_1.DEBUG.RENDERER)
            console.group("ui compile");
        var compiledElems = [];
        for (var _i = 0; _i < roots.length; _i++) {
            var root = roots[_i];
            // @TODO: reparent dynamic roots if needed.
            if (typeof root === "string") {
                var elems = this._compileWrapper(root, compiledElems.length);
                compiledElems.push.apply(compiledElems, elems);
                var base = this.ixer.findOne("ui template", { "ui template: template": root });
                if (!base)
                    continue;
                var parent_1 = base["ui template: parent"];
                if (parent_1) {
                    for (var _a = 0; _a < elems.length; _a++) {
                        var elem = elems[_a];
                        elem.parent = parent_1;
                    }
                }
            }
            else {
                if (!root.ix)
                    root.ix = compiledElems.length;
                compiledElems.push(root);
            }
        }
        if (utils_1.DEBUG.RENDERER)
            console.groupEnd();
        return compiledElems;
    };
    UIRenderer.prototype._compileWrapper = function (template, baseIx, constraints, bindingStack, depth) {
        if (constraints === void 0) { constraints = {}; }
        if (bindingStack === void 0) { bindingStack = []; }
        if (depth === void 0) { depth = 0; }
        var elems = [];
        var binding = this.ixer.findOne("ui template binding", { "ui template binding: template": template });
        if (!binding) {
            var elem = this._compileElement(template, bindingStack, depth);
            if (elem)
                elems[0] = elem;
        }
        else {
            var boundQuery = binding["ui template binding: binding"];
            var facts = this.getBoundFacts(boundQuery, constraints);
            var ix = 0;
            for (var _i = 0; _i < facts.length; _i++) {
                var fact = facts[_i];
                bindingStack.push(fact);
                var elem = this._compileElement(template, bindingStack, depth);
                bindingStack.pop();
                if (elem)
                    elems.push(elem);
            }
        }
        elems.sort(function (a, b) { return a.ix - b.ix; });
        var prevIx = undefined;
        for (var _a = 0; _a < elems.length; _a++) {
            var elem = elems[_a];
            elem.ix = elem.ix ? elem.ix + baseIx : baseIx;
            if (elem.ix === prevIx)
                elem.ix++;
            prevIx = elem.ix;
        }
        return elems;
    };
    UIRenderer.prototype._compileElement = function (template, bindingStack, depth) {
        if (utils_1.DEBUG.RENDERER)
            console.log(utils_1.repeat("  ", depth) + "* compile", template);
        var elementToChildren = this.ixer.index("ui template", ["ui template: parent"]);
        var elementToEmbeds = this.ixer.index("ui embed", ["ui embed: parent"]);
        var embedToScope = this.ixer.index("ui embed scope", ["ui embed scope: embed"]);
        var embedToScopeBinding = this.ixer.index("ui embed scope binding", ["ui embed scope binding: embed"]);
        var elementToAttrs = this.ixer.index("ui attribute", ["ui attribute: template"]);
        var elementToAttrBindings = this.ixer.index("ui attribute binding", ["ui attribute binding: template"]);
        var elementToEvents = this.ixer.index("ui event", ["ui event: template"]);
        this.compiled++;
        var base = this.ixer.findOne("ui template", { "ui template: template": template });
        if (!base) {
            console.warn("ui template " + template + " does not exist. Ignoring.");
            return undefined;
        }
        var attrs = elementToAttrs[template];
        var boundAttrs = elementToAttrBindings[template];
        var events = elementToEvents[template];
        // Handle meta properties
        var elem = { _template: template, ix: base["ui template: ix"] };
        // Handle static properties
        if (attrs) {
            for (var _i = 0; _i < attrs.length; _i++) {
                var _a = attrs[_i], prop = _a["ui attribute: property"], val = _a["ui attribute: value"];
                elem[prop] = val;
            }
        }
        // Handle bound properties
        if (boundAttrs) {
            // @FIXME: What do with source?
            for (var _b = 0; _b < boundAttrs.length; _b++) {
                var _c = boundAttrs[_b], prop = _c["ui attribute binding: property"], source = _c["ui attribute binding: source"], alias = _c["ui attribute binding: alias"];
                elem[prop] = this.getBoundValue(source, alias, bindingStack);
            }
        }
        // Attach event handlers
        if (events) {
            for (var _d = 0; _d < events.length; _d++) {
                var event_6 = events[_d]["ui event: event"];
                elem[event_6] = this.generateEventHandler(elem, event_6, bindingStack);
            }
        }
        // Compile children
        var children = elementToChildren[template] || [];
        var embeds = elementToEmbeds[template] || [];
        if (children.length || embeds.length) {
            elem.children = [];
            var childIx = 0, embedIx = 0;
            while (childIx < children.length || embedIx < embeds.length) {
                var child = children[childIx];
                var embed = embeds[embedIx];
                var add = void 0, constraints = {}, childBindingStack = bindingStack;
                if (!embed || child && child.ix <= embed.ix) {
                    add = children[childIx++]["ui template: template"];
                    // Resolve bound aliases into constraints
                    constraints = this.getBoundScope(bindingStack);
                }
                else {
                    add = embeds[embedIx++]["ui embed: template"];
                    for (var _e = 0, _f = embedToScope[embed["ui embed: embed"]] || []; _e < _f.length; _e++) {
                        var scope = _f[_e];
                        constraints[scope["ui embed scope: key"]] = scope["ui embed scope: value"];
                    }
                    for (var _g = 0, _h = embedToScopeBinding[embed["ui embed: embed"]] || []; _g < _h.length; _g++) {
                        var scope = _h[_g];
                        // @FIXME: What do about source?
                        var key = scope["ui embed scope binding: key"], source = scope["ui embed scope binding: source"], alias = scope["ui embed scope binding: alias"];
                        constraints[key] = this.getBoundValue(source, alias, bindingStack);
                    }
                    childBindingStack = [constraints];
                }
                elem.children.push.apply(elem.children, this._compileWrapper(add, elem.children.length, constraints, childBindingStack, depth + 1));
            }
        }
        if (this._tagCompilers[elem.t]) {
            try {
                this._tagCompilers[elem.t](elem);
            }
            catch (err) {
                console.warn("Failed to compile template: '" + template + "' due to '" + err + "' for element '" + JSON.stringify(elem) + "'");
                elem.t = "ui-error";
            }
        }
        return elem;
    };
    UIRenderer.prototype.getBoundFacts = function (query, constraints) {
        return this.ixer.find(query, constraints);
    };
    UIRenderer.prototype.getBoundScope = function (bindingStack) {
        var scope = {};
        for (var _i = 0; _i < bindingStack.length; _i++) {
            var fact = bindingStack[_i];
            for (var alias in fact)
                scope[alias] = fact[alias];
        }
        return scope;
    };
    //@FIXME: What do about source?
    UIRenderer.prototype.getBoundValue = function (source, alias, bindingStack) {
        for (var ix = bindingStack.length - 1; ix >= 0; ix--) {
            var fact = bindingStack[ix];
            if (source in fact && fact[alias])
                return fact[alias];
        }
    };
    UIRenderer.prototype.generateEventHandler = function (elem, event, bindingStack) {
        var template = elem["_template"];
        var memoKey = template + "::" + event;
        var attrKey = event + "::state";
        elem[attrKey] = this.getEventState(template, event, bindingStack);
        if (this._handlers[memoKey])
            return this._handlers[memoKey];
        var self = this;
        if (event === "change" || event === "input") {
            this._handlers[memoKey] = function (evt, elem) {
                var props = {};
                if (elem.t === "select" || elem.t === "input" || elem.t === "textarea")
                    props.value = evt.target.value;
                if (elem.type === "checkbox")
                    props.value = evt.target.checked;
                self.handleEvent(template, event, evt, elem, props);
            };
        }
        else {
            this._handlers[memoKey] = function (evt, elem) {
                self.handleEvent(template, event, evt, elem, {});
            };
        }
        return this._handlers[memoKey];
    };
    UIRenderer.prototype.handleEvent = function (template, eventName, event, elem, eventProps) {
        var attrKey = eventName + "::state";
        var state = elem[attrKey];
        var content = (_a = ["\n      # ", " ({is a: event})\n      ## Meta\n      event target: {event target: ", "}\n      event template: {event template: ", "}\n      event type: {event type: ", "}\n\n      ## State\n    "], _a.raw = ["\n      # ", " ({is a: event})\n      ## Meta\n      event target: {event target: ", "}\n      event template: {event template: ", "}\n      event type: {event type: ", "}\n\n      ## State\n    "], utils_1.unpad(6)(_a, eventName, elem.id, template, eventName));
        if (state["*event*"]) {
            for (var prop in state["*event*"])
                content += prop + ": {" + prop + ": " + eventProps[state["*event*"][prop]] + "}\n";
        }
        for (var prop in state) {
            if (prop === "*event*")
                continue;
            content += prop + ": {" + prop + ": " + state[prop] + "}\n";
        }
        var changeset = this.ixer.diff();
        var raw = utils_1.uuid();
        var entity = eventName + " event " + raw.slice(-12);
        changeset.add("builtin entity", { entity: entity, content: content });
        this.ixer.applyDiff(changeset);
        console.log(entity);
        var _a;
    };
    UIRenderer.prototype.getEventState = function (template, event, bindingStack) {
        var state = {};
        var staticAttrs = this.ixer.find("ui event state", { "ui event state: template": template, "ui event state: event": event });
        for (var _i = 0; _i < staticAttrs.length; _i++) {
            var _a = staticAttrs[_i], key = _a["ui event state: key"], val = _a["ui event state: value"];
            state[key] = val;
        }
        var boundAttrs = this.ixer.find("ui event state binding", { "ui event state binding: template": template, "ui event state binding: event": event });
        for (var _b = 0; _b < boundAttrs.length; _b++) {
            var _c = boundAttrs[_b], key = _c["ui event state binding: key"], source = _c["ui event state binding: source"], alias = _c["ui event state binding: alias"];
            if (source === "*event*") {
                state["*event*"] = state["*event*"] || {};
                state["*event*"][key] = alias;
            }
            else {
                state[key] = this.getBoundValue(source, alias, bindingStack);
            }
        }
        return state;
    };
    return UIRenderer;
})();
exports.UIRenderer = UIRenderer;
if (this.window)
    window["uiRenderer"] = exports;

},{"./runtime":15,"./utils":19}],18:[function(require,module,exports){
var utils_1 = require("./utils");
var app_1 = require("./app");
var ui_1 = require("./ui");
var masonry_1 = require("./masonry");
//------------------------------------------------------------------------------
// Utilities
//------------------------------------------------------------------------------
function resolveName(maybeId) {
    var display = app_1.eve.findOne("display name", { id: maybeId });
    return display ? display.name : maybeId;
}
exports.resolveName = resolveName;
function resolveId(maybeName) {
    var display = app_1.eve.findOne("display name", { name: maybeName });
    return display ? display.id : maybeName;
}
exports.resolveId = resolveId;
function resolveValue(maybeValue) {
    if (typeof maybeValue !== "string")
        return maybeValue;
    var val = maybeValue.trim();
    if (val.indexOf("=") === 0) {
        // @TODO: Run through the full NLP.
        var search = val.substring(1).trim();
        return resolveId(search);
    }
    return val;
}
exports.resolveValue = resolveValue;
function isEntity(maybeId) {
    return !!app_1.eve.findOne("entity", { entity: maybeId });
}
exports.isEntity = isEntity;
var wordSplitter = /\s+/gi;
var statWeights = { links: 100, pages: 200, words: 1 };
function classifyEntities(rawEntities) {
    var entities = rawEntities.slice();
    var collections = [];
    var systems = [];
    // Measure relatedness + length of entities
    // @TODO: mtimes of entities
    var relatedCounts = {};
    var wordCounts = {};
    var childCounts = {};
    var scores = {};
    for (var _i = 0; _i < entities.length; _i++) {
        var entity = entities[_i];
        var _a = (app_1.eve.findOne("entity", { entity: entity }) || {}).content, content = _a === void 0 ? "" : _a;
        relatedCounts[entity] = app_1.eve.find("directionless links", { entity: entity }).length;
        wordCounts[entity] = content.trim().replace(wordSplitter, " ").split(" ").length;
        var _b = (app_1.eve.findOne("collection", { collection: entity }) || {}).count, childCount = _b === void 0 ? 0 : _b;
        childCounts[entity] = childCount;
        scores[entity] =
            relatedCounts[entity] * statWeights.links +
                wordCounts[entity] * statWeights.words +
                childCounts[entity] * statWeights.pages;
    }
    // Separate system entities
    var ix = 0;
    while (ix < entities.length) {
        if (app_1.eve.findOne("is a attributes", { collection: utils_1.builtinId("system"), entity: entities[ix] })) {
            systems.push(entities.splice(ix, 1)[0]);
        }
        else
            ix++;
    }
    // Separate user collections from other entities
    ix = 0;
    while (ix < entities.length) {
        if (childCounts[entities[ix]]) {
            collections.push(entities.splice(ix, 1)[0]);
        }
        else
            ix++;
    }
    return { systems: systems, collections: collections, entities: entities, scores: scores, relatedCounts: relatedCounts, wordCounts: wordCounts, childCounts: childCounts };
}
//------------------------------------------------------------------------------
// Handlers
//------------------------------------------------------------------------------
function preventDefault(event) {
    event.preventDefault();
}
function preventDefaultUnlessFocused(event) {
    if (event.target !== document.activeElement)
        event.preventDefault();
}
function closePopup() {
    var popout = app_1.eve.findOne("ui pane", { kind: ui_1.PANE.POPOUT });
    if (popout)
        app_1.dispatch("remove popup", { paneId: popout.pane }).commit();
}
function navigate(event, elem) {
    var paneId = elem.data.paneId;
    var info = { paneId: paneId, value: elem.link, peek: elem.peek };
    if (event.clientX) {
        info.x = "calc(50% - 350px)";
        info.y = event.clientY;
    }
    app_1.dispatch("ui set search", info).commit();
    event.preventDefault();
}
function navigateOrEdit(event, elem) {
    var popout = app_1.eve.findOne("ui pane", { kind: ui_1.PANE.POPOUT });
    var peeking = popout && popout.contains === elem.link;
    if (event.target === document.activeElement) { }
    else if (!peeking)
        navigate(event, elem);
    else {
        closePopup();
        event.target.focus();
    }
}
function updateEntityValue(event, elem) {
    var value = utils_1.coerceInput(event.detail);
    var rowElem = elem.row, field = elem.field;
    var tableElem = rowElem.table, row = rowElem.row;
    var entity = tableElem["entity"];
    var rows = elem.rows || [row];
    var chain = app_1.dispatch();
    for (var _i = 0; _i < rows.length; _i++) {
        var row_1 = rows[_i];
        if (field === "value" && row_1.value !== value && row_1.attribute !== undefined) {
            chain.dispatch("update entity attribute", { entity: entity, attribute: row_1.attribute, prev: row_1.value, value: value });
        }
        else if (field === "attribute" && row_1.attribute !== value && row_1.value !== undefined) {
            chain.dispatch("rename entity attribute", { entity: entity, prev: row_1.attribute, attribute: value, value: row_1.value });
        }
    }
    chain.commit();
}
function updateEntityAttributes(event, elem) {
    var _a = elem.row, tableElem = _a.table, row = _a.row;
    var entity = tableElem["entity"];
    if (event.detail === "add") {
        var state = elem["state"]["adder"];
        var valid = elem["fields"].every(function (field) {
            return state[field] !== undefined;
        });
        if (valid) {
            app_1.dispatch("add sourced eav", { entity: entity, attribute: state.attribute, value: resolveValue(state.value) }).commit();
            elem["state"]["adder"] = {};
        }
    }
    else {
        app_1.dispatch("remove entity attribute", { entity: entity, attribute: row.attribute, value: row.value }).commit();
    }
}
function sortTable(event, elem) {
    var key = elem.key, _a = elem.field, field = _a === void 0 ? undefined : _a, _b = elem.direction, direction = _b === void 0 ? undefined : _b;
    console.log(key, field, direction);
    if (field === undefined && direction === undefined) {
        field = event.target.value;
        console.log("ETV", field);
    }
    app_1.dispatch("sort table", { key: key, field: field, direction: direction }).commit();
}
//------------------------------------------------------------------------------
// Embedded cell representation wrapper
//------------------------------------------------------------------------------
var uitk = this;
function embeddedCell(elem) {
    var children = [];
    var childInfo = elem.childInfo, rep = elem.rep;
    if (childInfo.constructor === Array) {
        for (var _i = 0; _i < childInfo.length; _i++) {
            var child = childInfo[_i];
            child["data"] = child["data"] || childInfo.params;
            children.push(uitk[rep](child));
        }
    }
    else {
        children.push(uitk[rep](childInfo));
    }
    children.push({ c: "edit-button-container", children: [
            { c: "edit-button ion-edit", click: elem.click, cell: elem.cell }
        ] });
    return { c: "non-editing-embedded-cell", children: children, cell: elem.cell };
}
exports.embeddedCell = embeddedCell;
//------------------------------------------------------------------------------
// Representations for Errors
//------------------------------------------------------------------------------
function error(elem) {
    elem.c = "error-rep " + (elem.c || "");
    console.log(elem);
    return elem;
}
exports.error = error;
function name(elem) {
    var entity = elem.entity;
    var _a = (app_1.eve.findOne("display name", { id: entity }) || {}).name, name = _a === void 0 ? entity : _a;
    elem.text = name;
    elem.c = "entity " + (elem.c || "");
    return elem;
}
exports.name = name;
function link(elem) {
    var entity = elem.entity;
    var name = resolveName(entity);
    elem.c = (elem.c || "") + " entity link inline";
    elem.text = elem.text || name;
    elem["link"] = elem["link"] || entity;
    elem.click = elem.click || navigate;
    elem["peek"] = elem["peek"] !== undefined ? elem["peek"] : true;
    return elem;
}
exports.link = link;
function attributes(elem) {
    var entity = elem.entity;
    var attributes = [];
    for (var _i = 0, _a = app_1.eve.find("entity eavs", { entity: entity }); _i < _a.length; _i++) {
        var eav = _a[_i];
        attributes.push({ attribute: eav.attribute, value: eav.value });
    }
    attributes.sort(function (a, b) {
        if (a.attribute === b.attribute)
            return 0;
        else if (a.attribute < b.attribute)
            return -1;
        return 1;
    });
    elem["groups"] = ["attribute"];
    elem["rows"] = attributes;
    elem["editCell"] = updateEntityValue;
    elem["editRow"] = updateEntityAttributes;
    elem["noHeader"] = true;
    return table(elem);
}
exports.attributes = attributes;
function related(elem) {
    var entity = elem.entity, _a = elem.data, data = _a === void 0 ? undefined : _a;
    var name = resolveName(entity);
    var relations = [];
    for (var _i = 0, _b = app_1.eve.find("directionless links", { entity: entity }); _i < _b.length; _i++) {
        var link_1 = _b[_i];
        relations.push(link_1.link);
    }
    elem.c = elem.c !== undefined ? elem.c : "flex-row flex-wrap csv";
    if (relations.length) {
        elem.children = [{ t: "h2", text: name + " is related to " + relations.length + " " + pluralize("entities", relations.length) + ":" }];
        for (var _c = 0; _c < relations.length; _c++) {
            var rel = relations[_c];
            elem.children.push(link({ entity: rel, data: data }));
        }
    }
    else
        elem.text = name + " is not related to any other entities.";
    return elem;
}
exports.related = related;
function index(elem) {
    var entity = elem.entity;
    var name = resolveName(entity);
    var facts = app_1.eve.find("is a attributes", { collection: entity });
    var list = { t: "ul", children: [] };
    for (var _i = 0; _i < facts.length; _i++) {
        var fact = facts[_i];
        list.children.push(link({ t: "li", entity: fact.entity, data: elem.data }));
    }
    elem.children = [
        { t: "h2", text: "There " + pluralize("are", facts.length) + " " + facts.length + " " + pluralize(name, facts.length) + ":" },
        list
    ];
    return elem;
}
exports.index = index;
function view(elem) {
    var entity = elem.entity;
    var name = resolveName(entity);
    // @TODO: Check if given entity is a view, or render an error
    var rows = app_1.eve.find(entity);
    elem["rows"] = rows;
    return table(elem);
}
exports.view = view;
function results(elem) {
    var entity = elem.entity, _a = elem.data, data = _a === void 0 ? undefined : _a;
    elem.children = [name({ entity: entity, data: data })];
    for (var _i = 0, _b = app_1.eve.find("entity eavs", { entity: entity, attribute: "artifact" }); _i < _b.length; _i++) {
        var eav = _b[_i];
        elem.children.push(name({ t: "h3", entity: eav.value, data: data }), view({ entity: eav.value, data: data }));
    }
    return elem;
}
exports.results = results;
function value(elem) {
    var _a = elem.text, val = _a === void 0 ? "" : _a, _b = elem.autolink, autolink = _b === void 0 ? true : _b, _c = elem.editable, editable = _c === void 0 ? false : _c;
    elem["original"] = val;
    var cleanup;
    if (isEntity(val)) {
        elem["entity"] = val;
        elem.text = resolveName(val);
        if (autolink)
            elem = link(elem);
        if (editable && autolink) {
            elem.mousedown = preventDefaultUnlessFocused;
            elem.click = navigateOrEdit;
            cleanup = closePopup;
        }
    }
    if (editable) {
        if (elem.t !== "input") {
            elem.contentEditable = true;
        }
        // elem.t = "input";
        elem.placeholder = "<empty>";
        elem.value = elem.text || "";
        var _blur = elem.blur;
        elem.blur = function (event, elem) {
            var node = event.target;
            if (_blur)
                _blur(event, elem);
            if (node.value === "= " + elem.value)
                node.value = elem.value;
            if (elem.value !== val)
                node.classList.add("link");
            if (cleanup)
                cleanup(event, elem);
        };
        var _focus = elem.focus;
        elem.focus = function (event, elem) {
            var node = event.target;
            if (elem.value !== val) {
                node.value = "= " + elem.value;
                node.classList.remove("link");
            }
            if (_focus)
                _focus(event, elem);
        };
    }
    return elem;
}
exports.value = value;
function CSV(elem) {
    var values = elem.values, _a = elem.autolink, autolink = _a === void 0 ? undefined : _a, data = elem.data;
    return { c: "flex-row csv", children: values.map(function (val) { return value({ t: "span", autolink: autolink, text: val, data: data }); }) };
}
exports.CSV = CSV;
function table(elem) {
    var rows = elem.rows, _a = elem.ignoreFields, ignoreFields = _a === void 0 ? ["__id"] : _a, _b = elem.sortable, sortable = _b === void 0 ? false : _b, _c = elem.ignoreTemp, ignoreTemp = _c === void 0 ? true : _c, _d = elem.data, data = _d === void 0 ? undefined : _d, _e = elem.noHeader, noHeader = _e === void 0 ? false : _e, _f = elem.groups, groups = _f === void 0 ? [] : _f;
    if (!rows.length) {
        elem.text = "<Empty Table>";
        return elem;
    }
    if (sortable && !elem.key)
        throw new Error("Cannot track sorting state for a table without a key");
    var localState = ui_1.uiState.widget.table[elem.key] || {};
    ui_1.uiState.widget.table[elem.key] = localState;
    var _g = elem.editCell, editCell = _g === void 0 ? undefined : _g, _h = elem.editRow, editRow = _h === void 0 ? undefined : _h, _j = elem.editField, editField = _j === void 0 ? undefined : _j;
    if (editCell) {
        var _editCell = editCell;
        editCell = function (event, elem) {
            var node = event.target;
            var val;
            if (node.nodeName === "INPUT") {
                val = resolveValue(node.value);
            }
            else {
                val = resolveValue(node.textContent);
            }
            if (val === elem["original"])
                return;
            var neueEvent = new CustomEvent("editcell", { detail: val });
            _editCell(neueEvent, elem);
        };
    }
    if (editRow) {
        var addRow = function (evt, elem) {
            var event = new CustomEvent("editrow", { detail: "add" });
            editRow(event, elem);
        };
        var trackInput = function (evt, elem) {
            var node = evt.target;
            localState["adder"][elem["field"]] = node.value;
            app_1.dispatch().commit();
        };
        var removeRow = function (evt, elem) { return editRow(new CustomEvent("editrow", { detail: "remove" }), elem); };
    }
    if (editField) {
        // @FIXME: Wrap these with the logic for the editing modal, only add/remove on actual completed field
        var addField = function (evt, elem) { return editRow(new CustomEvent("editfield", { detail: "add" }), elem); };
        var removeField = function (evt, elem) { return editRow(new CustomEvent("editfield", { detail: "remove" }), elem); };
    }
    // Collate non-ignored fields
    var fields = Object.keys(rows[0]);
    var fieldIx = 0;
    while (fieldIx < fields.length) {
        if (ignoreFields && ignoreFields.indexOf(fields[fieldIx]) !== -1)
            fields.splice(fieldIx, 1);
        else if (ignoreTemp && fields[fieldIx].indexOf("$$temp") === 0)
            fields.splice(fieldIx, 1);
        else
            fieldIx++;
    }
    var header = { t: "header", children: [] };
    var _k = localState.field, sortField = _k === void 0 ? undefined : _k, sortDirection = localState.direction;
    sortDirection = sortDirection || 1;
    for (var _i = 0; _i < fields.length; _i++) {
        var field = fields[_i];
        var isActive = field === sortField;
        var direction = (field === sortField) ? sortDirection : 0;
        header.children.push({ c: "column field flex-row", children: [
                value({ text: field, data: data, autolink: false }),
                { c: "flex-grow" },
                { c: "controls", children: [
                        sortable ? {
                            c: "sort-toggle " + (isActive && direction < 0 ? "ion-arrow-up-b" : "ion-arrow-down-b") + " " + (isActive ? "active" : ""),
                            key: elem.key,
                            field: field,
                            direction: -direction,
                            click: sortTable
                        } : undefined
                    ] }
            ] });
    }
    if (sortable && sortField) {
        var back = -1 * sortDirection;
        var fwd = sortDirection;
        rows.sort(function sorter(rowA, rowB) {
            var a = resolveName(resolveValue(rowA[sortField])), b = resolveName(resolveValue(rowB[sortField]));
            return (a === b) ? 0 :
                (a === undefined) ? fwd :
                    (b === undefined) ? back :
                        (a > b) ? fwd : back;
        });
    }
    //@TODO: allow this to handle multiple groups
    if (groups.length > 1)
        throw new Error("Tables only support grouping on one field");
    if (groups.length) {
        var toGroup = groups[0];
        rows.sort(function (a, b) {
            var ag = a[toGroup];
            var bg = b[toGroup];
            if (ag === bg)
                return 0;
            if (ag < bg)
                return -1;
            return 1;
        });
    }
    //@FIXME: the grouping strategy here is a disaster
    var body = { c: "body", children: [] };
    var ix = 0;
    var rowsLen = rows.length;
    while (ix < rowsLen) {
        var row = rows[ix];
        var rowElem = { c: "row group", table: elem, row: row, children: [] };
        for (var _l = 0; _l < groups.length; _l++) {
            var grouped = groups[_l];
            var collected = [];
            rowElem.children.push(value({ c: "column field", text: row[grouped], editable: editCell ? true : false, blur: editCell, row: rowElem, grouped: true, rows: collected, field: grouped, data: data, keydown: handleCellKeys }));
            var subgroup = { c: "column sub-group", table: elem, row: row, children: [] };
            rowElem.children.push(subgroup);
            var subrow = rows[ix];
            while (ix < rowsLen && subrow[grouped] === row[grouped]) {
                var subrowElem = { c: "sub-row", table: elem, row: subrow, children: [] };
                subgroup.children.push(subrowElem);
                collected.push(subrow);
                for (var _m = 0; _m < fields.length; _m++) {
                    var field = fields[_m];
                    if (field === grouped)
                        continue;
                    subrowElem.children.push(value({ c: "field", text: subrow[field], editable: editCell ? true : false, blur: editCell, row: subrowElem, field: field, data: data, keydown: handleCellKeys }));
                }
                if (editRow)
                    subrowElem.children.push({ c: "controls", children: [{ c: "remove-row ion-android-close", row: subrowElem, click: removeRow }] });
                ix++;
                subrow = rows[ix];
            }
        }
        if (groups.length === 0) {
            for (var _o = 0; _o < fields.length; _o++) {
                var field = fields[_o];
                rowElem.children.push(value({ c: "column field", text: row[field], editable: editCell ? true : false, blur: editCell, row: rowElem, field: field, data: data, keydown: handleCellKeys }));
            }
            if (editRow)
                rowElem.children.push({ c: "controls", children: [{ c: "remove-row ion-android-close", row: rowElem, click: removeRow }] });
            ix++;
        }
        body.children.push(rowElem);
    }
    if (editRow) {
        if (!localState["adder"]) {
            localState["adder"] = {};
        }
        var rowElem = { c: "row group add-row", table: elem, row: [], children: [] };
        for (var _p = 0; _p < fields.length; _p++) {
            var field = fields[_p];
            rowElem.children.push(value({ t: "input", c: "column field", editable: true, input: trackInput, blur: addRow, row: rowElem, keydown: handleCellKeys, attribute: field, field: field, fields: fields, data: data, table: elem, state: localState, text: localState["adder"][field] || "" }));
        }
        body.children.push(rowElem);
    }
    elem.c = "table " + (elem.c || "");
    elem.children = [header, body];
    if (noHeader) {
        elem.children.shift();
    }
    return elem;
}
exports.table = table;
function handleCellKeys(event, elem) {
    if (event.keyCode === utils_1.KEYS.ENTER) {
        elem.blur(event, elem);
        event.preventDefault();
    }
}
function tableFilter(elem) {
    var key = elem.key, _a = elem.search, search = _a === void 0 ? undefined : _a, _b = elem.sortFields, sortFields = _b === void 0 ? undefined : _b;
    elem.children = [];
    if (sortFields) {
        var state = ui_1.uiState.widget.table[key] || { field: undefined, direction: undefined };
        var sortOpts = [];
        for (var _i = 0; _i < sortFields.length; _i++) {
            var field = sortFields[_i];
            sortOpts.push({ t: "option", text: resolveName(field), value: field, selected: field === state.field });
        }
        elem.children.push({ c: "flex-grow" });
        elem.children.push({ c: "sort", children: [
                { text: "Sort by" },
                { t: "select", c: "select-sort-field select", value: state.field, children: sortOpts, key: key, change: sortTable },
                { c: "toggle-sort-dir " + (state.direction === -1 ? "ion-arrow-up-b" : "ion-arrow-down-b"), key: key, direction: -state.direction || 1, click: sortTable },
            ] });
    }
    elem.c = "table-filter " + (elem.c || "");
    return elem;
}
exports.tableFilter = tableFilter;
function externalLink(elem) {
    elem.t = "a";
    elem.c = "link " + (elem.c || "");
    elem.href = elem.url;
    elem.text = elem.text || elem.url;
    return elem;
}
exports.externalLink = externalLink;
function externalImage(elem) {
    elem.t = "img";
    elem.c = "img " + (elem.c || "");
    elem.src = elem.url;
    return elem;
}
exports.externalImage = externalImage;
function externalVideo(elem) {
    var ext = elem.url.slice(elem.url.lastIndexOf(".")).trim().toLowerCase();
    var domain = elem.url.slice(elem.url.indexOf("//") + 2).split("/")[0];
    var isFile = ["mp4", "ogv", "webm", "mov", "avi", "flv"].indexOf(ext) !== -1;
    if (isFile) {
        elem.t = "video";
    }
    else {
        elem.t = "iframe";
    }
    elem.c = "video " + (elem.c || "");
    elem.src = elem.url;
    elem.allowfullscreen = true;
    return elem;
}
exports.externalVideo = externalVideo;
function collapsible(elem) {
    if (elem.key === undefined)
        throw new Error("Must specify a key to maintain collapsible state");
    var state = ui_1.uiState.widget.collapsible[elem.key] || { open: elem.open !== undefined ? elem.open : true };
    var content = { children: elem.children };
    var header = { t: "header", children: [{ c: "collapse-toggle " + (state.open ? "ion-chevron-up" : "ion-chevron-down"), collapsible: elem.key, open: state.open, click: toggleCollapse }, elem.header] };
    elem.c = "collapsible " + (elem.c || "");
    elem.children = [header, state.open ? content : undefined];
    return elem;
}
exports.collapsible = collapsible;
function toggleCollapse(evt, elem) {
    app_1.dispatch("toggle collapse", { collapsible: elem.collapsible, open: !elem.open });
}
var directoryTileLayouts = [
    { size: 4, c: "big", format: function (elem) {
            elem.children.unshift;
            elem.children.push({ text: "(" + elem["stats"][elem["stats"].best] + " " + elem["stats"].best + ")" });
            return elem;
        } },
    { size: 2, c: "detailed", format: function (elem) {
            elem.children.push({ text: "(" + elem["stats"][elem["stats"].best] + " " + elem["stats"].best + ")" });
            return elem;
        } },
    { size: 1, c: "normal", grouped: 2 }
];
var directoryTileStyles = ["tile-style-1", "tile-style-2", "tile-style-3", "tile-style-4", "tile-style-5", "tile-style-6", "tile-style-7"];
function directory(elem) {
    var MAX_ENTITIES_BEFORE_OVERFLOW = 14;
    var rawEntities = elem.entities, _a = elem.data, data = _a === void 0 ? undefined : _a;
    var _b = classifyEntities(rawEntities), systems = _b.systems, collections = _b.collections, entities = _b.entities, scores = _b.scores, relatedCounts = _b.relatedCounts, wordCounts = _b.wordCounts, childCounts = _b.childCounts;
    var sortByScores = utils_1.sortByLookup(scores);
    entities.sort(sortByScores);
    collections.sort(sortByScores);
    systems.sort(sortByScores);
    // Link to entity
    // Peek with most significant statistic (e.g. 13 related; or 14 childrenpages; or 5000 words)
    // Slider pane will all statistics
    // Click opens popup preview
    function formatTile(entity) {
        var stats = { best: "", links: relatedCounts[entity], pages: childCounts[entity], words: wordCounts[entity] };
        var maxContribution = 0;
        for (var stat in stats) {
            if (!statWeights[stat])
                continue;
            var contribution = stats[stat] * statWeights[stat];
            if (contribution > maxContribution) {
                maxContribution = contribution;
                stats.best = stat;
            }
        }
        return { size: scores[entity], stats: stats, children: [
                link({ entity: entity, data: data })
            ] };
    }
    function formatOverflow(key, entities, skipChildren) {
        if (skipChildren === void 0) { skipChildren = false; }
        var rows = [];
        for (var _i = 0; _i < entities.length; _i++) {
            var entity = entities[_i];
            rows.push({
                name: entity,
                score: scores[entity],
                words: wordCounts[entity],
                links: relatedCounts[entity],
                pages: childCounts[entity]
            });
            if (skipChildren)
                delete rows[rows.length - 1].pages;
        }
        return table({ c: "overflow-list", key: key, rows: rows, sortable: true, data: data });
    }
    // @TODO: Put formatOverflow into a collapsed container.
    return { c: "directory flex-column", children: [
            { t: "h2", text: "Collections" },
            exports.masonry({ c: "directory-listing", layouts: directoryTileLayouts, styles: directoryTileStyles, children: collections.map(formatTile) }),
            { t: "h2", text: "Entities" },
            exports.masonry({ c: "directory-listing", layouts: directoryTileLayouts, styles: directoryTileStyles, children: entities.slice(0, MAX_ENTITIES_BEFORE_OVERFLOW).map(formatTile) }),
            collapsible({
                key: elem.key + "|directory entities collapsible",
                header: { text: "Show all entities..." },
                children: [
                    //tableFilter({key: `${elem.key}|directory entities overflow`, sortFields: ["name", "score", "words", "links"]}),
                    formatOverflow(elem.key + "|directory entities overflow", entities, true)
                ],
                open: false
            }),
            { t: "h2", text: "Internals" },
            collapsible({
                key: elem.key + "|directory systems collapsible",
                header: { text: "Show all internal entities..." },
                children: [formatOverflow(elem.key + "|directory systems overflow", systems)],
                open: false
            }),
        ] };
}
exports.directory = directory;
exports.masonry = masonry_1.masonry;

},{"./app":9,"./masonry":11,"./ui":16,"./utils":19}],19:[function(require,module,exports){
var uuid_1 = require("../vendor/uuid");
exports.uuid = uuid_1.v4;
exports.ENV = "browser";
try {
    window;
    window["utils"] = exports;
}
catch (err) {
    exports.ENV = "node";
}
exports.DEBUG = {};
if (exports.ENV === "browser")
    window["DEBUG"] = exports.DEBUG;
function builtinId(name) {
    return "AUTOGENERATED " + name + " THIS SHOULDN'T SHOW UP ANYWHERE";
}
exports.builtinId = builtinId;
exports.unpad = function (indent) {
    if (exports.unpad.memo[indent])
        return exports.unpad.memo[indent];
    return exports.unpad.memo[indent] = function (strings) {
        var values = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            values[_i - 1] = arguments[_i];
        }
        if (!strings.length)
            return;
        var res = "";
        var ix = 0;
        for (var _a = 0; _a < strings.length; _a++) {
            var str = strings[_a];
            res += str + (values.length > ix ? values[ix++] : "");
        }
        if (res[0] === "\n")
            res = res.slice(1);
        var charIx = 0;
        while (true) {
            res = res.slice(0, charIx) + res.slice(charIx + indent);
            charIx = res.indexOf("\n", charIx) + 1;
            if (!charIx)
                break;
        }
        return res;
    };
};
exports.unpad.memo = {};
function repeat(str, length) {
    var len = length / str.length;
    var res = "";
    for (var ix = 0; ix < len; ix++)
        res += str;
    return (res.length > length) ? res.slice(0, length) : res;
}
exports.repeat = repeat;
function underline(startIx, length) {
    return repeat(" ", startIx) + "^" + repeat("~", length - 1);
}
exports.underline = underline;
function capitalize(word) {
    return word[0].toUpperCase() + word.slice(1);
}
exports.capitalize = capitalize;
function titlecase(name) {
    return name.split(" ").map(capitalize).join(" ");
}
exports.titlecase = titlecase;
var _slugifyReplacements = {
    "-": "dash",
    "_": "under",
    "$": "dollar",
    "&": "and",
    "+": "plus",
    ",": "comma",
    "/": "slash",
    ":": "colon",
    ";": "semicolon",
    "=": "equals",
    "?": "question",
    "@": "at",
    "<": "lt",
    ">": "gt",
    "#": "hash",
    "%": "percent",
    "{": "opencurly",
    "}": "closecurly",
    "|": "pipe",
    "\\": "whack",
    "^": "caret",
    "~": "tilde",
    "[": "openbracket",
    "]": "closebracket",
    "`": "grave"
};
var _deslugifyReplacements = {};
for (var char in _slugifyReplacements) {
    _deslugifyReplacements[_slugifyReplacements[char]] = char;
}
// Slugify encodes a uri component in a fairly human readable fashion
function slugify(text) {
    var url = "";
    for (var _i = 0; _i < text.length; _i++) {
        var char = text[_i];
        var replacement = _slugifyReplacements[char];
        if (char === " ") {
            url += "_";
        }
        else if (replacement) {
            url += "-'" + replacement + "-";
        }
        else {
            url += char;
        }
    }
    return encodeURIComponent(url);
}
exports.slugify = slugify;
function deslugify(url) {
    var text = [];
    for (var _i = 0, _a = url.split("_"); _i < _a.length; _i++) {
        var word = _a[_i];
        if (word.indexOf("-") === -1) {
            text.push(word);
            continue;
        }
        var replaced = "";
        var tokens = word.split("-");
        replaced += tokens.shift();
        var tail_1 = tokens.pop();
        for (var _b = 0; _b < tokens.length; _b++) {
            var token = tokens[_b];
            var replacement = _deslugifyReplacements[token.slice(1)];
            if (replacement && token.indexOf("'") === 0) {
                replaced += replacement;
            }
            else {
                replaced += token;
            }
        }
        replaced += tail_1;
        text.push(replaced);
    }
    return decodeURIComponent(text.join(" "));
}
exports.deslugify = deslugify;
exports.string = {
    unpad: exports.unpad,
    repeat: repeat,
    underline: underline,
    capitalize: capitalize,
    titlecase: titlecase,
    slugify: slugify,
    deslugify: deslugify
};
function tail(arr) {
    return arr[arr.length - 1];
}
exports.tail = tail;
exports.array = {
    tail: tail
};
function coerceInput(input) {
    // http://jsperf.com/regex-vs-plus-coercion
    if (!isNaN(+input))
        return +input;
    else if (input === "true")
        return true;
    else if (input === "false")
        return false;
    return input;
}
exports.coerceInput = coerceInput;
// Shallow copy the given object.
function copy(obj) {
    if (!obj || typeof obj !== "object")
        return obj;
    if (obj instanceof Array)
        return obj.slice();
    var res = {};
    for (var key in obj)
        res[key] = obj[key];
    return res;
}
exports.copy = copy;
function mergeObject(root, obj) {
    for (var key in obj) {
        root[key] = obj[key];
    }
    return root;
}
exports.mergeObject = mergeObject;
function autoFocus(node, elem) {
    if (!node.focused) {
        node.focused = true;
        node.focus();
    }
}
exports.autoFocus = autoFocus;
exports.KEYS = {
    ESC: 27,
    ENTER: 13,
    UP: 38,
    DOWN: 40,
    BACKSPACE: 8,
    "]": 221,
};
// FROM: http://stackoverflow.com/questions/1125292/how-to-move-cursor-to-end-of-contenteditable-entity/3866442#3866442
function setEndOfContentEditable(contentEditableElement) {
    var range, selection;
    if (document.createRange) {
        range = document.createRange(); //Create a range (a range is a like the selection but invisible)
        range.selectNodeContents(contentEditableElement); //Select the entire contents of the element with the range
        range.collapse(false); //collapse the range to the end point. false means collapse to end rather than the start
        selection = window.getSelection(); //get the selection object (allows you to change selection)
        selection.removeAllRanges(); //remove any selections already made
        selection.addRange(range); //make the range you have just created the visible selection
    }
}
exports.setEndOfContentEditable = setEndOfContentEditable;
// LCG courtesy of <https://gist.github.com/Protonk/5389384>
function srand(z) {
    var m = Math.pow(2, 24), a = 16598013, c = 12820163;
    return function () { return z = (a * z + c) % m / m; };
}
exports.srand = srand;
// Shuffle courtesy of <http://stackoverflow.com/a/6274381>
function shuffle(o, rand) {
    if (rand === void 0) { rand = Math.random; }
    for (var j, x, i = o.length; i; j = Math.floor(rand() * i), x = o[--i], o[i] = o[j], o[j] = x)
        ;
    return o;
}
exports.shuffle = shuffle;
function sortByField(field) {
    return function (a, b) {
        return (a[field] === b[field]) ? 0 :
            (a[field] > b[field]) ? -1 :
                (a[field] < b[field]) ? 1 :
                    (a[field] === undefined) ? 1 : -1;
    };
}
exports.sortByField = sortByField;
function sortByLookup(lookup) {
    return function (a, b) {
        return (lookup[a] === lookup[b]) ? 0 :
            (lookup[a] > lookup[b]) ? -1 :
                (lookup[a] < lookup[b]) ? 1 :
                    (lookup[a] === undefined) ? 1 : -1;
    };
}
exports.sortByLookup = sortByLookup;
function location() {
    return window.location.hash.slice(1);
}
exports.location = location;

},{"../vendor/uuid":23}],20:[function(require,module,exports){
"use strict";
var app = require("./app");
var bootstrap = require("./bootstrap");
var ui = require("./ui");
var utils_1 = require("./utils");
app.renderRoots["wiki"] = ui.root;
// @HACK: we have to use bootstrap in some way to get it to actually be included and
// executed
var ixer = bootstrap.ixer;
function initSearches(eve) {
    for (var _i = 0, _a = eve.find("ui pane"); _i < _a.length; _i++) {
        var pane = _a[_i];
        if (eve.findOne("entity", { entity: pane.contains }))
            continue;
    }
}
app.init("wiki", function () {
    document.body.classList.add(localStorage["theme"] || "light");
    app.activeSearches = {};
    initSearches(app.eve);
    window.history.replaceState({ root: true }, null, window.location.hash);
    var mainPane = app.eve.findOne("ui pane", { pane: "p1" });
    var path = utils_1.location();
    var _a = path.split("/"), _ = _a[0], kind = _a[1], _b = _a[2], raw = _b === void 0 ? "" : _b;
    var content = utils_1.deslugify(raw);
    var cur = app.dispatch("ui set search", { paneId: mainPane.pane, value: content });
    if (content && !app.eve.findOne("query to id", { query: content })) {
        cur.dispatch("insert query", { query: content });
    }
    cur.commit();
});
window.addEventListener("hashchange", function () {
    var mainPane = app.eve.findOne("ui pane", { pane: "p1" });
    var path = utils_1.location();
    var _a = path.split("/"), _ = _a[0], kind = _a[1], _b = _a[2], raw = _b === void 0 ? "" : _b;
    var content = utils_1.deslugify(raw);
    var displays = app.eve.find("display name", { name: content });
    if (displays.length === 1)
        content = displays[0].id;
    if (mainPane.contains === content)
        return;
    var cur = app.dispatch("ui set search", { paneId: mainPane.pane, value: content });
    if (content && !app.eve.findOne("query to id", { query: content })) {
        cur.dispatch("insert query", { query: content });
    }
    cur.commit();
});

},{"./app":9,"./bootstrap":10,"./ui":16,"./utils":19}],21:[function(require,module,exports){
var app = require("../src/app");
var runtime = require("../src/runtime");
require("../src/wiki");
var eve = runtime.addProvenanceTable(new runtime.Indexer());
window["eve"] = eve;
app.init("runtime test", function () {
    app.renderRoots = {};
    var testData = eve.diff();
    testData.add("foo", { a: 1, b: 2 });
    testData.add("foo", { a: 2, b: 3 });
    testData.add("foo", { a: 2, b: 4 });
    testData.add("bar", { a: 2, c: 5 });
    testData.add("bar", { a: 2, c: 6 });
    testData.remove("system ui", { template: "wiki root" });
    eve.applyDiff(testData);
    var query1 = eve.query("no group test")
        .select("foo", {}, "foo")
        .select("bar", { a: ["foo", "a"] }, "bar")
        .project({ c: ["bar", "c"] });
    var res = query1.exec();
    console.log(res);
    var query2 = eve.query("group test")
        .select("foo", {}, "foo")
        .select("bar", { a: ["foo", "a"] }, "bar")
        .group([["foo", "b"]])
        .aggregate("count", {}, "count")
        .project({ b: ["foo", "b"], count: ["count", "count"] });
    var res2 = query2.debug();
    console.log(res2);
    var provenance = eve.diff();
    provenance.addMany("provenance", res.provenance);
    provenance.addMany("provenance", res2.provenance);
    provenance.addMany("no group test", res.results);
    provenance.addMany("group test", res2.results);
    eve.applyDiff(provenance);
    function foo(changes, meh) {
        var others = [];
        if (changes["bar"] && changes["bar"].adds) {
            for (var _i = 0, _a = changes["bar"].adds; _i < _a.length; _i++) {
                var change0 = _a[_i];
                var rows1 = eve.find("foo", { a: change0["a"] });
                for (var _b = 0; _b < rows1.length; _b++) {
                    var row1 = rows1[_b];
                    others.push(row1);
                }
            }
        }
        if (changes["foo"] && changes["foo"].adds) {
            for (var _c = 0, _d = changes["foo"].adds; _c < _d.length; _c++) {
                var change = _d[_c];
                others.push(change);
            }
        }
        return others;
    }
    var func = query1.incrementalRowFinder;
    console.log(func);
    console.log(func({}));
    console.log(func({ "foo": { adds: [{ a: 2, b: 7 }] } }));
    console.log(func({ "bar": { adds: [{ a: 2, c: 7 }] } }));
    console.log(func({ "foo": { adds: [{ a: 2, b: 7 }] }, "bar": { adds: [{ a: 2, c: 7 }] } }));
    eve.asView(query1);
    eve.asView(query2);
    var changeInfo = { "foo": { adds: [{ a: 2, b: 7 }] }, "bar": { adds: [{ a: 2, c: 7 }] } };
    var changes = eve.diff();
    changes.remove("foo", { a: 2, b: 3 });
    // changes.remove("bar", {a: 2, c: 5});
    // changes.remove("bar", {a: 2, c: 6});
    eve.applyDiffIncremental(changes);
    // changeInfo["bar"] = undefined;
    // var incremental = query1.execIncremental(changeInfo, eve.table(query1.name));
    // console.log(incremental);
    // var incremental2 = query2.execIncremental(changeInfo, eve.table(query2.name));
    // console.log(incremental2);
    var parentAncestor = eve.query("parent ancestor")
        .select("parent", {}, "parent")
        .select("ancestor", { ancestor: ["parent", "child"] }, "ancestor")
        .project({ ancestor: ["parent", "parent"], child: ["ancestor", "child"] });
    eve.asView(parentAncestor);
    var ancestorUnion = eve.union("ancestor")
        .union("parent", { ancestor: ["parent"], child: ["child"] })
        .union("parent ancestor", { ancestor: ["ancestor"], child: ["child"] });
    eve.asView(ancestorUnion);
    var parents = eve.diff();
    parents.addMany("parent", [{ parent: "a", child: "b" }, { parent: "b", child: "c" }]);
    eve.applyDiffIncremental(parents);
});

},{"../src/app":9,"../src/runtime":15,"../src/wiki":20}],22:[function(require,module,exports){

},{}],23:[function(require,module,exports){
//     uuid.js
//
//     Copyright (c) 2010-2012 Robert Kieffer
//     MIT License - http://opensource.org/licenses/mit-license.php

(function() {
  var _global = this;

  // Unique ID creation requires a high quality random # generator.  We feature
  // detect to determine the best RNG source, normalizing to a function that
  // returns 128-bits of randomness, since that's what's usually required
  var _rng;

  // Node.js crypto-based RNG - http://nodejs.org/docs/v0.6.2/api/crypto.html
  //
  // Moderately fast, high quality
  if (typeof(_global.require) == 'function') {
    try {
      var _rb = _global.require('crypto').randomBytes;
      _rng = _rb && function() {return _rb(16);};
    } catch(e) {}
  }

  if (!_rng && _global.crypto && crypto.getRandomValues) {
    // WHATWG crypto-based RNG - http://wiki.whatwg.org/wiki/Crypto
    //
    // Moderately fast, high quality
    var _rnds8 = new Uint8Array(16);
    _rng = function whatwgRNG() {
      crypto.getRandomValues(_rnds8);
      return _rnds8;
    };
  }

  if (!_rng) {
    // Math.random()-based (RNG)
    //
    // If all else fails, use Math.random().  It's fast, but is of unspecified
    // quality.
    var  _rnds = new Array(16);
    _rng = function() {
      for (var i = 0, r; i < 16; i++) {
        if ((i & 0x03) === 0) r = Math.random() * 0x100000000;
        _rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;
      }

      return _rnds;
    };
  }

  // Buffer class to use
  var BufferClass = typeof(_global.Buffer) == 'function' ? _global.Buffer : Array;

  // Maps for number <-> hex string conversion
  var _byteToHex = [];
  var _hexToByte = {};
  for (var i = 0; i < 256; i++) {
    _byteToHex[i] = (i + 0x100).toString(16).substr(1);
    _hexToByte[_byteToHex[i]] = i;
  }

  // **`parse()` - Parse a UUID into it's component bytes**
  function parse(s, buf, offset) {
    var i = (buf && offset) || 0, ii = 0;

    buf = buf || [];
    s.toLowerCase().replace(/[0-9a-f]{2}/g, function(oct) {
      if (ii < 16) { // Don't overflow!
        buf[i + ii++] = _hexToByte[oct];
      }
    });

    // Zero out remaining bytes if string was short
    while (ii < 16) {
      buf[i + ii++] = 0;
    }

    return buf;
  }

  // **`unparse()` - Convert UUID byte array (ala parse()) into a string**
  function unparse(buf, offset) {
    var i = offset || 0, bth = _byteToHex;
    return  bth[buf[i++]] + bth[buf[i++]] +
            bth[buf[i++]] + bth[buf[i++]] + '-' +
            bth[buf[i++]] + bth[buf[i++]] + '-' +
            bth[buf[i++]] + bth[buf[i++]] + '-' +
            bth[buf[i++]] + bth[buf[i++]] + '-' +
            bth[buf[i++]] + bth[buf[i++]] +
            bth[buf[i++]] + bth[buf[i++]] +
            bth[buf[i++]] + bth[buf[i++]];
  }

  // **`v1()` - Generate time-based UUID**
  //
  // Inspired by https://github.com/LiosK/UUID.js
  // and http://docs.python.org/library/uuid.html

  // random #'s we need to init node and clockseq
  var _seedBytes = _rng();

  // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)
  var _nodeId = [
    _seedBytes[0] | 0x01,
    _seedBytes[1], _seedBytes[2], _seedBytes[3], _seedBytes[4], _seedBytes[5]
  ];

  // Per 4.2.2, randomize (14 bit) clockseq
  var _clockseq = (_seedBytes[6] << 8 | _seedBytes[7]) & 0x3fff;

  // Previous uuid creation time
  var _lastMSecs = 0, _lastNSecs = 0;

  // See https://github.com/broofa/node-uuid for API details
  function v1(options, buf, offset) {
    var i = buf && offset || 0;
    var b = buf || [];

    options = options || {};

    var clockseq = options.clockseq != null ? options.clockseq : _clockseq;

    // UUID timestamps are 100 nano-second units since the Gregorian epoch,
    // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so
    // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'
    // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.
    var msecs = options.msecs != null ? options.msecs : new Date().getTime();

    // Per 4.2.1.2, use count of uuid's generated during the current clock
    // cycle to simulate higher resolution clock
    var nsecs = options.nsecs != null ? options.nsecs : _lastNSecs + 1;

    // Time since last uuid creation (in msecs)
    var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;

    // Per 4.2.1.2, Bump clockseq on clock regression
    if (dt < 0 && options.clockseq == null) {
      clockseq = clockseq + 1 & 0x3fff;
    }

    // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new
    // time interval
    if ((dt < 0 || msecs > _lastMSecs) && options.nsecs == null) {
      nsecs = 0;
    }

    // Per 4.2.1.2 Throw error if too many uuids are requested
    if (nsecs >= 10000) {
      throw new Error('uuid.v1(): Can\'t create more than 10M uuids/sec');
    }

    _lastMSecs = msecs;
    _lastNSecs = nsecs;
    _clockseq = clockseq;

    // Per 4.1.4 - Convert from unix epoch to Gregorian epoch
    msecs += 12219292800000;

    // `time_low`
    var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;
    b[i++] = tl >>> 24 & 0xff;
    b[i++] = tl >>> 16 & 0xff;
    b[i++] = tl >>> 8 & 0xff;
    b[i++] = tl & 0xff;

    // `time_mid`
    var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;
    b[i++] = tmh >>> 8 & 0xff;
    b[i++] = tmh & 0xff;

    // `time_high_and_version`
    b[i++] = tmh >>> 24 & 0xf | 0x10; // include version
    b[i++] = tmh >>> 16 & 0xff;

    // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)
    b[i++] = clockseq >>> 8 | 0x80;

    // `clock_seq_low`
    b[i++] = clockseq & 0xff;

    // `node`
    var node = options.node || _nodeId;
    for (var n = 0; n < 6; n++) {
      b[i + n] = node[n];
    }

    return buf ? buf : unparse(b);
  }

  // **`v4()` - Generate random UUID**

  // See https://github.com/broofa/node-uuid for API details
  function v4(options, buf, offset) {
    // Deprecated - 'format' argument, as supported in v1.2
    var i = buf && offset || 0;

    if (typeof(options) == 'string') {
      buf = options == 'binary' ? new BufferClass(16) : null;
      options = null;
    }
    options = options || {};

    var rnds = options.random || (options.rng || _rng)();

    // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`
    rnds[6] = (rnds[6] & 0x0f) | 0x40;
    rnds[8] = (rnds[8] & 0x3f) | 0x80;

    // Copy bytes to buffer, if provided
    if (buf) {
      for (var ii = 0; ii < 16; ii++) {
        buf[i + ii] = rnds[ii];
      }
    }

    return buf || unparse(rnds);
  }

  // Export public API
  var uuid = v4;
  uuid.v1 = v1;
  uuid.v4 = v4;
  uuid.parse = parse;
  uuid.unparse = unparse;
  uuid.BufferClass = BufferClass;

  if (typeof define === 'function' && define.amd) {
    // Publish as AMD module
    define(function() {return uuid;});
  } else if (typeof(module) != 'undefined' && module.exports) {
    // Publish as node.js module
    module.exports = uuid;
  } else {
    // Publish as global (in browsers)
    var _previousRoot = _global.uuid;

    // **`noConflict()` - (browser only) to reset global 'uuid' var**
    uuid.noConflict = function() {
      _global.uuid = _previousRoot;
      return uuid;
    };

    _global.uuid = uuid;
  }
}).call(this);

},{}]},{},[21,22])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvY29kZW1pcnJvci9hZGRvbi9tb2RlL292ZXJsYXkuanMiLCJub2RlX21vZHVsZXMvY29kZW1pcnJvci9saWIvY29kZW1pcnJvci5qcyIsIm5vZGVfbW9kdWxlcy9jb2RlbWlycm9yL21vZGUvY2xvanVyZS9jbG9qdXJlLmpzIiwibm9kZV9tb2R1bGVzL2NvZGVtaXJyb3IvbW9kZS9nZm0vZ2ZtLmpzIiwibm9kZV9tb2R1bGVzL2NvZGVtaXJyb3IvbW9kZS9tYXJrZG93bi9tYXJrZG93bi5qcyIsIm5vZGVfbW9kdWxlcy9jb2RlbWlycm9yL21vZGUvbWV0YS5qcyIsIm5vZGVfbW9kdWxlcy9jb2RlbWlycm9yL21vZGUveG1sL3htbC5qcyIsInNyYy9OTFF1ZXJ5UGFyc2VyLnRzIiwic3JjL2FwcC50cyIsInNyYy9ib290c3RyYXAudHMiLCJzcmMvbWFzb25yeS50cyIsInNyYy9taWNyb1JlYWN0LnRzIiwic3JjL3BhcnNlci50cyIsInNyYy9yaWNoVGV4dEVkaXRvci50cyIsInNyYy9ydW50aW1lLnRzIiwic3JjL3VpLnRzIiwic3JjL3VpUmVuZGVyZXIudHMiLCJzcmMvdWl0ay50cyIsInNyYy91dGlscy50cyIsInNyYy93aWtpLnRzIiwidGVzdC9ydW50aW1lVGVzdC50cyIsInR5cGluZ3MvdHNkLmQudHMiLCJ2ZW5kb3IvdXVpZC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hwUkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNwUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNsSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ255QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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YyxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMzRCxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUM7b0JBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDMUQsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLEVBQUUsS0FBSyxJQUFJLENBQUMsRUFBRSxDQUFDO29CQUFFLEdBQUcsQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQy9ELEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDLEVBQUUsQ0FBQztvQkFBQyxHQUFHLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUM5RCxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsRUFBRSxLQUFLLElBQUksQ0FBQyxFQUFFLENBQUM7b0JBQUUsR0FBRyxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDL0QsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLEVBQUUsS0FBSyxJQUFJLENBQUMsRUFBRSxDQUFDO29CQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQzlELEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQztvQkFBQyxHQUFHLENBQUMsY0FBYyxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMxRCxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsTUFBTSxLQUFLLElBQUksQ0FB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QUksQ0FBQyxTQUFTLENBQUM7Z0JBQUMsR0FBRyxDQUFDLFdBQVcsR0FBRyxHQUFHLENBQUMsU0FBUyxLQUFLLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztZQUNsSCxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsT0FBTyxLQUFLLElBQUksQ0FBQyxPQUFPLENBQUM7Z0JBQUMsR0FBRyxDQUFDLFNBQVMsR0FBRyxHQUFHLENBQUMsT0FBTyxLQUFLLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztZQUMxRyxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsU0FBUyxLQUFLLElBQUksQ0FBQyxTQUFTLENBQUM7Z0JBQUMsR0FBRyxDQUFDLFdBQVcsR0FBRyxHQUFHLENBQUMsU0FBUyxLQUFLLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztZQUNsSCxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLElBQUksQ0FBQyxRQUFRLENBQUM7Z0JBQUMsR0FBRyxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUMsUUFBUSxLQUFLLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztZQUM5RyxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsVUFBVSxLQUFLLElBQUksQ0FBQyxVQUFVLENBQUM7Z0JBQUMsR0FBRyxDQUFDLFlBQVksR0FBRyxHQUFHLENBQUMsVUFBVSxLQUFLLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztZQUN0SCxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsVUFBVSxLQUFLLElBQUksQ0FBQyxVQUFVLENBQUM7Z0JBQUMsR0FBRyxDQUFDLFdBQVcsR0FBRyxHQUFHLENBQUMsVUFBVSxLQUFLLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztZQUNySCxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLElBQUksQ0FBQyxRQUFRLENBQUM7Z0JBQUMsR0FBRyxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUMsUUFBUSxLQUFLLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztZQUM5RyxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsU0FBUyxLQUFLLElBQUksQ0FBQyxTQUFTLENBQUM7Z0JBQUMsR0FBRyxDQUFDLFdBQVcsR0FBRyxHQUFHLENBQUMsU0FBUyxLQUFLLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztZQUNsSCxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsT0FBTyxLQUFLLElBQUksQ0FBQyxPQUFPLENBQUM7Z0JBQUMsR0FBRyxDQUFDLFNBQVMsR0FBRyxHQUFHLENBQUMsT0FBTyxLQUFLLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztZQUMxRyxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxJQUFJLENBQUM7Z0JBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsSUFBSSxLQUFLLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztZQUM5RixFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxJQUFJLENBQUM7Z0JBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsSUFBSSxLQUFLLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztZQUM5RixFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQyxNQUFNLENBQUM7Z0JBQUMsR0FBRyxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUMsTUFBTSxLQUFLLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztZQUN0RyxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsS0FBSyxLQUFLLElBQUksQ0FBQyxLQUFLLENBQUM7Z0JBQUMsR0FBRyxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUMsS0FBSyxLQUFLLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztZQUNsRyxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxJQUFJLENBQUM7Z0JBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsSUFBSSxLQUFLLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztZQUM5RixFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsS0FBSyxLQUFLLElBQUksQ0FBQyxLQUFLLENBQUM7Z0JBQUMsR0FBRyxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUMsS0FBSyxLQUFLLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztZQUNsRyxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQyxNQUFNLENBQUM7Z0JBQUMsR0FBRyxDQUFDLFFBQVEsR0FBRyxHQUFHLENBQUMsTUFBTSxLQUFLLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztZQUN0RyxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsS0FBSyxLQUFLLElBQUksQ0FBQyxLQUFLLENBQUM7Z0JBQUMsR0FBRyxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUMsS0FBSyxLQUFLLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztZQUNsRyxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsT0FBTyxLQUFLLElBQUksQ0FBQyxPQUFPLENBQUM7Z0JBQUMsR0FBRyxDQUFDLFNBQVMsR0FBRyxHQUFHLENBQUMsT0FBTyxLQUFLLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxHQUFHLFNBQVMsQ0FBQztZQUUxRyxFQUFFLENBQUEsQ0FBQyxJQUFJLEtBQUssT0FBTyxJQUFJLElBQUksS0FBSyxVQUFVLElBQUksSUFBSSxLQUFLLE9BQU8sQ0FBQyxDQUFDLENBQUM7Z0JBQy9E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SyxJQUFJLENBQUMsV0FBVzttQkFDckMsSUFBSSxDQUFDLFFBQVEsS0FBSyxJQUFJLENBQUMsUUFBUTttQkFDL0IsSUFBSSxDQUFDLFNBQVMsS0FBSyxJQUFJLENBQUMsU0FBUzttQkFDakMsSUFBSSxDQUFDLGVBQWUsS0FBSyxJQUFJLENBQUMsZUFBZTttQkFDN0MsSUFBSSxDQUFDLEtBQUssS0FBSyxJQUFJLENBQUMsS0FBSzttQkFDekIsSUFBSSxDQUFDLElBQUksS0FBSyxJQUFJLENBQUMsSUFBSTttQkFDdkIsSUFBSSxDQUFDLE9BQU8sS0FBSyxJQUFJLENBQUMsT0FBTzttQkFDN0IsSUFBSSxDQUFDLElBQUksS0FBSyxJQUFJLENBQUMsSUFBSTttQkFDdkIsSUFBSSxDQUFDLEdBQUcsS0FBSyxJQUFJLENBQUMsR0FBRzttQkFDckIsSUFBSSxDQUFDLElBQUksS0FBSyxJQUFJLENBQUMsSUFBSTttQkFDdkIsSUFBSSxDQUFDLElBQUksS0FBSyxJQUFJLENBQUMsSUFBSTttQkFDdkIsSUFBSSxDQUFDLEtBQUssS0FBSyxJQUFJLENBQUMsS0FBSzttQkFDekIsSUFBSSxDQUFDLE1BQU0sS0FBSyxJQUFJLENBQUMsTUFBTTttQkFDM0IsSUFBSSxDQUFDLE1BQU0sS0FBSyxJQUFJLENBQUMsTUFBTTttQkFDM0IsSUFBSSxDQUFDLGVBQWUsS0FBSyxJQUFJLENBQUMsZUFBZTttQkFDN0MsSUFBSSxDQUFDLGVBQWUsS0FBSyxJQUFJLENBQUMsZUFBZTttQkFDN0MsSUFBSSxDQUFDLEtBQUssS0FBSyxJQUFJLENBQUMsS0FBSzttQkFDekIsSUFBSSxDQUFDLE9BQU8sS0FBSyxJQUFJLENBQUMsT0FBTzttQkFDN0IsSUFBSSxDQUFDLE1BQU0sS0FBSyxJQUFJLENBQUMsTUFBTTttQkFDM0IsSUFBSSxDQUFDLFdBQVcsS0FBSyxJQUFJLENBQUMsV0FBVzttQkFDckMsSUFBSSxDQUFDLFdBQVcsS0FBSyxJQUFJLENBQUMsV0FBVzttQkFDckMsSUFBSSxDQUFDLFlBQVksS0FBSyxJQUFJLENBQUMsWUFBWTttQkFDdkMsSUFBSSxDQUFDLE9BQU8sS0FBSyxJQUFJLENBQUMsT0FBTzttQkFDN0IsSUFBSSxDQUFDLFVBQVUsS0FBSyxJQUFJLENBQUMsVUFBVTttQkFDbkMsSUFBSSxDQUFDLFFBQVEsS0FBSyxJQUFJLENBQUMsUUFBUTttQkFDL0IsSUFBSSxDQUFDLFNBQVMsS0FBSyxJQUFJLENBQUMsU0FBUzttQkFDakMsSUFBSSxDQUFDLFNBQVMsS0FBSyxJQUFJLENBQUMsU0FBUzttQkFDakMsSUFBSSxDQUFDLGFBQWEsS0FBSyxJQUFJLENBQUMsYUFBYTttQkFDekMsSUFBSSxDQUFDLFFBQVEsS0FBSyxJQUFJLENBQUMsUUFBUTttQkFDL0IsSUFBSSxDQUFDLEtBQUssS0FBSyxJQUFJLENBQUMsS0FBSzttQkFDekIsSUFBSSxDQUFDLEtBQUssS0FBSyxJQUFJLENBQUMsS0FBSzttQkFDekIsQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLFNBQVMsSUFBSSxDQUMxQixJQUFJLENBQUMsQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDO3VCQUNkLElBQUksQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUM7dUJBQ2pCLElBQUksQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDLEVBQUU7dUJBQ25CLElBQUksQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDLEVBQUU7dUJBQ25CLElBQUksQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDLEVBQUU7dUJBQ25CLElBQUksQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDLEVBQUU7dUJBQ25CLElBQUksQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUM7dUJBQ2pCLElBQUksQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUM7dUJBQ2pCLElBQUksQ0FBQyxJQUFJLEtBQUssSUFBSSxDQUFDLElBQUk7dUJBQ3ZCLElBQUksQ0FBQyxNQUFNLEtBQUssSUFBSSxDQUFDLE1BQU07dUJBQzNCLElBQUksQ0FBQyxXQUFXLEtBQUssSUFBSSxDQUFDLFdBQVc7dUJBQ3JDLElBQUksQ0FBQyxXQUFXLEtBQUssSUFBSSxDQUFDLFdBQVc7dUJBQ3JDLElBQUksQ0FBQyxVQUFVLEtBQUssSUFBSSxDQUFDLFVBQVU7dUJBQ25DLElBQUksQ0FBQyxPQUFPLEtBQUssSUFBSSxDQUFDLE9BQU87dUJBQzdCLElBQUksQ0FBQyxTQUFTLEtBQUssSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUNyQyxDQUFDLENBQUMsQ0FBQztnQkFDVCxRQUFRLENBQUM7WUFDWCxDQUFDO1lBQ0QsT0FBTyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFNBQVMsQ0FBQztRQUMxQixDQUFDO1FBQ0QsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQzdDLElBQUksRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNmLElBQUksSUFBSSxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNqQixFQUFFLENBQUEsQ0FBQyxJQUFJLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztnQkFDdEIsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDZCxPQUFPLENBQUMsRUFBRSxDQUFDLEdBQUcsT0FBTyxDQUFDO2dCQUN0QixRQUFRLENBQUM7WUFDWCxDQUFDO1FBQ0gsQ0FBQztRQUNELElBQUksQ0FBQyxRQUFRLEdBQUcsRUFBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUMsQ0FBQztRQUMvQyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQztJQUN2QixDQUFDO0lBRUQsMEJBQU8sR0FBUCxVQUFRLElBQVk7UUFDbEIsSUFBSSxPQUFPLEdBQUcsQ0FBQyxDQUFDO1FBQ2hCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDckIsSUFBSSxRQUFRLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN0QixJQUFJLElBQVksQ0FBQztRQUNqQixHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxNQUFNLEdBQUcsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFLENBQUM7WUFDL0MsSUFBSSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUN4QixFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsTUFBTSxLQUFLLFNBQVMsQ0FBQztnQkFBQyxJQUFJLENBQUMsTUFBTSxHQUFHLFFBQVEsQ0FBQztZQUNyRCxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLFNBQVMsQ0FBQztnQkFBQyxJQUFJLENBQUMsRUFBRSxHQUFHLFVBQVUsR0FBRyxNQUFNLENBQUM7WUFDeEQsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUM7WUFDckIsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLFVBQVUsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO2dCQUNqQyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM5QixDQUFDO1lBQ0QsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQztZQUM3QixFQUFFLENBQUEsQ0FBQyxRQUFRLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztnQkFDMUIsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLE9BQU8sR0FBRyxDQUFDLEVBQUUsR0FBRyxHQUFHLFFBQVEsQ0FBQyxNQUFNLEVBQUUsT0FBTyxHQUFHLEdBQUcsRUFBRSxPQUFPLEVBQUUsRUFBRSxDQUFDO29CQUNyRSxJQUFJLEtBQUssR0FBRyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7b0JBQzlCLEVBQUUsQ0FBQSxDQUFDLEtBQUssS0FBSyxTQUFTLENBQUM7d0JBQUMsUUFBUSxDQUFDO29CQUNqQyxFQUFFLENBQUEsQ0FBQyxLQUFLLENBQUMsRUFBRSxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7d0JBQUMsS0FBSyxDQUFDLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxHQUFHLElBQUksR0FBRyxPQUFPLENBQUM7b0JBQUMsQ0FBQztvQkFDbkUsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLEVBQUUsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO3dCQUFDLEtBQUssQ0FBQyxFQUFFLEdBQUcsT0FBTyxDQUFDO29CQUFDLENBQUM7b0JBQ2xELEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxNQUFNLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQzt3QkFBQyxLQUFLLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7b0JBQUMsQ0FBQztvQkFDMUQsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztvQkFDckIsT0FBTyxFQUFFLENBQUM7Z0JBQ1osQ0FBQztZQUNILENBQUM7UUFDSCxDQUFDO1FBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCw2QkFBVSxHQUFWO1FBQ0UsSUFBSSxXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztRQUNuQyxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQztRQUNqQyxJQUFJLFlBQVksR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDO1FBQ3JDLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxXQUFXLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUN0RCxJQUFJLElBQUksR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDMUIsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUNqQixFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEtBQUssU0FBUyxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxPQUFPLElBQUksSUFBSSxDQUFDLEVBQUUsQ0FBQyxLQUFLLFVBQVUsSUFBSSxJQUFJLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxPQUFPLENBQUMsQ0FBQyxDQUFDO2dCQUNuSCxJQUFJLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDL0MsQ0FBQztRQUNILENBQUM7SUFDSCxDQUFDO0lBRUQseUJBQU0sR0FBTixVQUFPLEtBQWU7UUFDbEIsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2Ysa0VBQWtFO1FBQ2xFLEtBQUssQ0FBQyxJQUFJLENBQUMsVUFBQyxDQUFDLEVBQUUsQ0FBQyxJQUFLLE9BQUEsQ0FBQyxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxFQUEzRixDQUEyRixDQUFDLENBQUM7UUFDbEgsSUFBSSxLQUFLLEdBQUcsR0FBRyxFQUFFLENBQUM7UUFDbEIsR0FBRyxDQUFBLENBQWEsVUFBSyxFQUFqQixpQkFBUSxFQUFSLElBQWlCLENBQUM7WUFBbEIsSUFBSSxJQUFJLEdBQUksS0FBSyxJQUFUO1lBQ1YsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUUvQjtRQUNELElBQUksT0FBTyxHQUFHLEdBQUcsRUFBRSxDQUFDO1FBQ3BCLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNwQixJQUFJLElBQUksR0FBRyxHQUFHLEVBQUUsQ0FBQztRQUNqQixJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDZCxJQUFJLE1BQU0sR0FBRyxHQUFHLEVBQUUsQ0FBQztRQUNuQixJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7UUFDbEIsSUFBSSxVQUFVLEdBQUcsR0FBRyxFQUFFLENBQUM7UUFDdkIsSUFBSSxJQUFJLEdBQUcsR0FBRyxFQUFFLEdBQUcsS0FBSyxDQUFDO1FBQ3pCLEVBQUUsQ0FBQSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ1osT0FBTyxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsRUFBRSxJQUFJLEVBQUU7Z0JBQ3pDLE9BQU8sRUFBRSxPQUFPLEdBQUcsS0FBSztnQkFDeEIsSUFBSSxFQUFFLElBQUksR0FBRyxPQUFPO2dCQUNwQixNQUFNLEVBQUUsTUFBTSxHQUFHLElBQUk7Z0JBQ3JCLFVBQVUsRUFBRSxVQUFVLEdBQUcsTUFBTTthQUNoQyxDQUFDLENBQUM7UUFDTCxDQUFDO0lBQ0gsQ0FBQztJQTViRCxpSUFBaUk7SUFDMUgseUJBQWdCLEdBQTJCLEVBQUUsQ0FBQztJQTRidkQsZUFBQztBQUFELENBOWJBLEFBOGJDLElBQUE7QUE5YlksZ0JBQVEsV0E4YnBCLENBQUE7Ozs7Ozs7O0FDM2tCRCxzQkFBOEQsU0FDOUQsQ0FBQyxDQURzRTtBQUN2RSxJQUFZLE9BQU8sV0FBTSxXQUN6QixDQUFDLENBRG1DO0FBQ3BDLG9CQUFrQixPQUNsQixDQUFDLENBRHdCO0FBR3pCO0lBQXlCLDhCQUFLO0lBRzVCLG9CQUFtQixPQUFjLEVBQVMsSUFBVyxFQUFTLE1BQWMsRUFBUyxNQUFpQixFQUFTLE1BQThDO1FBQS9FLHNCQUF3QixHQUF4QixVQUF3QjtRQUFFLHNCQUFxRCxHQUFyRCxTQUF1QixJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUMzSixrQkFBTSxPQUFPLENBQUMsQ0FBQztRQURFLFlBQU8sR0FBUCxPQUFPLENBQU87UUFBUyxTQUFJLEdBQUosSUFBSSxDQUFPO1FBQVMsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUFTLFdBQU0sR0FBTixNQUFNLENBQVc7UUFBUyxXQUFNLEdBQU4sTUFBTSxDQUF3QztRQUY3SixTQUFJLEdBQVcsYUFBYSxDQUFDO0lBSTdCLENBQUM7SUFDRCw2QkFBUSxHQUFSO1FBQ0UsTUFBTSxDQUFDLE9BQVMsVUFDWixFQUFTLElBQUssRUFBWSxVQUMxQixFQUE0RSxVQUM1RSxFQUFTLFVBQ1QsRUFBbUMsUUFDdEMsOEVBTE0sYUFBSyxDQUFDLENBQUMsQ0FBQyxLQUNYLElBQUksQ0FBQyxJQUFJLEVBQUssSUFBSSxDQUFDLE9BQU8sRUFDMUIsSUFBSSxDQUFDLE1BQU0sS0FBSyxTQUFTLEdBQUcsY0FBVyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsVUFBSSxJQUFJLENBQUMsTUFBUSxHQUFHLEVBQUUsRUFDNUUsSUFBSSxDQUFDLElBQUksRUFDVCxpQkFBUyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUN0QyxDQUFDOztJQUNKLENBQUM7SUFDSCxpQkFBQztBQUFELENBZEEsQUFjQyxFQWR3QixLQUFLLEVBYzdCO0FBRUQsbUJBQW1CLEdBQVUsRUFBRSxPQUFjLEVBQUUsT0FBYztJQUMzRCxJQUFJLEtBQUssR0FBRyxPQUFPLENBQUM7SUFDcEIsT0FBTSxHQUFHLENBQUMsS0FBSyxDQUFDLEtBQUssU0FBUyxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDO1FBQUUsS0FBSyxFQUFFLENBQUM7SUFDckUsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ25DLENBQUM7QUFJRCxtQkFBbUIsR0FBVSxFQUFFLFFBQWUsRUFBRSxPQUFjLEVBQUUsY0FBc0I7SUFDcEYsSUFBSSxLQUFLLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDM0MsRUFBRSxDQUFBLENBQUMsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNoQixFQUFFLENBQUEsQ0FBQyxjQUFjLENBQUM7WUFBQyxNQUFNLENBQUMsY0FBYyxDQUFDO1FBQ3pDLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFDRCxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDbkMsQ0FBQztBQUlELHNCQUFzQixHQUFVLEVBQUUsU0FBa0IsRUFBRSxPQUFjLEVBQUUsY0FBc0I7SUFDMUYsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDZixHQUFHLENBQUEsQ0FBaUIsVUFBUyxFQUF6QixxQkFBWSxFQUFaLElBQXlCLENBQUM7UUFBMUIsSUFBSSxRQUFRLEdBQUksU0FBUyxJQUFiO1FBQ2QsSUFBSSxFQUFFLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDeEMsRUFBRSxDQUFBLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxJQUFJLEtBQUssS0FBSyxDQUFDLENBQUMsSUFBSSxFQUFFLEdBQUcsS0FBSyxDQUFDO1lBQUMsUUFBUSxDQUFDO1FBQ3JELEtBQUssR0FBRyxFQUFFLENBQUM7S0FDWjtJQUNELEVBQUUsQ0FBQSxDQUFDLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDaEIsRUFBRSxDQUFBLENBQUMsY0FBYyxDQUFDO1lBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQztRQUN6QyxNQUFNLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUM1QixDQUFDO0lBQ0QsTUFBTSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQ25DLENBQUM7QUFlRCwrQ0FBK0M7QUFDL0MsMEJBQTBCO0FBQzFCLHFCQUFxQjtBQUNyQixvQkFBb0I7QUFDcEIsaUNBQWlDO0FBQ2pDLDZFQUE2RTtBQUM3RSw4RkFBOEY7QUFDOUYsNkJBQTZCO0FBQzdCLHNCQUFzQjtBQUN0Qiw0Q0FBNEM7QUFDNUMsMkJBQTJCO0FBQzNCLGdEQUFnRDtBQUNoRCx5QkFBeUI7QUFDekIscUVBQXFFO0FBQ3JFLDZDQUE2QztBQUM3Qyx3Q0FBd0M7QUFDeEMsaUJBQWlCO0FBQ2pCLDRCQUE0QjtBQUM1QixRQUFRO0FBQ1Isa0RBQWtEO0FBQ2xELGdDQUFnQztBQUVoQyx1RUFBdUU7QUFDdkUsc0NBQXNDO0FBQ3RDLDBEQUEwRDtBQUMxRCw4QkFBOEI7QUFDOUIsK0NBQStDO0FBQy9DLHFDQUFxQztBQUNyQyw0RkFBNEY7QUFDNUYsZUFBZTtBQUNmLG9HQUFvRztBQUNwRyxvQkFBb0I7QUFDcEIsVUFBVTtBQUNWLDhCQUE4QjtBQUU5QixzREFBc0Q7QUFDdEQsc0NBQXNDO0FBQ3RDLGlCQUFpQjtBQUNqQiw4Q0FBOEM7QUFDOUMsNkJBQTZCO0FBQzdCLHFEQUFxRDtBQUNyRCxtQ0FBbUM7QUFDbkMscUNBQXFDO0FBRXJDLDRIQUE0SDtBQUM1SCxtQkFBbUI7QUFDbkIsNERBQTREO0FBQzVELHdEQUF3RDtBQUN4RCxrQkFBa0I7QUFDbEIsNEJBQTRCO0FBQzVCLG9CQUFvQjtBQUNwQixvQkFBb0I7QUFDcEIsVUFBVTtBQUVWLCtDQUErQztBQUMvQyxzQ0FBc0M7QUFFdEMsc0RBQXNEO0FBQ3RELHNDQUFzQztBQUN0QyxpQkFBaUI7QUFDakIsOENBQThDO0FBQzlDLDZCQUE2QjtBQUM3Qix1REFBdUQ7QUFDdkQscUNBQXFDO0FBQ3JDLHlDQUF5QztBQUV6QyxnSUFBZ0k7QUFDaEksbUJBQW1CO0FBQ25CLGlFQUFpRTtBQUNqRSx3REFBd0Q7QUFDeEQsa0JBQWtCO0FBQ2xCLDRCQUE0QjtBQUM1QixvQkFBb0I7QUFDcEIsb0JBQW9CO0FBQ3BCLFVBQVU7QUFFVixtREFBbUQ7QUFDbkQsbURBQW1EO0FBQ25ELG9DQUFvQztBQUNwQyxvQ0FBb0M7QUFFcEMsaUNBQWlDO0FBQ2pDLGlCQUFpQjtBQUNqQixnSEFBZ0g7QUFDaEgsOENBQThDO0FBQzlDLHVEQUF1RDtBQUN2RCxxQ0FBcUM7QUFDckMseUNBQXlDO0FBRXpDLHdCQUF3QjtBQUN4QixzRUFBc0U7QUFDdEUsa0VBQWtFO0FBQ2xFLGtCQUFrQjtBQUNsQiw0QkFBNEI7QUFDNUIsb0JBQW9CO0FBQ3BCLG9CQUFvQjtBQUNwQixVQUFVO0FBQ1YsbUNBQW1DO0FBQ25DLCtDQUErQztBQUMvQyw4REFBOEQ7QUFDOUQsbURBQW1EO0FBQ25ELG9DQUFvQztBQUNwQyxvQ0FBb0M7QUFDcEMsUUFBUTtBQUVSLGdCQUFnQjtBQUNoQixNQUFNO0FBRU4sd0JBQXdCO0FBQ3hCLCtCQUErQjtBQUMvQiw0QkFBNEI7QUFDNUIsUUFBUTtBQUNSLE1BQU07QUFDTixpQkFBaUI7QUFDakIsSUFBSTtBQUdKLCtFQUErRTtBQUMvRSxpQkFBaUI7QUFDakIsK0VBQStFO0FBQy9FLElBQUssVUFBeUQ7QUFBOUQsV0FBSyxVQUFVO0lBQUcsMkNBQUksQ0FBQTtJQUFFLHVEQUFVLENBQUE7SUFBRSxpREFBTyxDQUFBO0lBQUUsK0NBQU0sQ0FBQTtJQUFFLGlEQUFPLENBQUE7QUFBQyxDQUFDLEVBQXpELFVBQVUsS0FBVixVQUFVLFFBQStDO0FBQUEsQ0FBQztBQUMvRDtJQWVFLGVBQW1CLElBQWlCLEVBQVMsS0FBVyxFQUFTLE1BQWUsRUFBUyxNQUFlO1FBQXJGLFNBQUksR0FBSixJQUFJLENBQWE7UUFBUyxVQUFLLEdBQUwsS0FBSyxDQUFNO1FBQVMsV0FBTSxHQUFOLE1BQU0sQ0FBUztRQUFTLFdBQU0sR0FBTixNQUFNLENBQVM7SUFBRyxDQUFDO0lBYnJHLGdCQUFVLEdBQWpCLFVBQWtCLEtBQVksRUFBRSxNQUFlLEVBQUUsTUFBZTtRQUM5RCxNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNqRSxDQUFDO0lBQ00sYUFBTyxHQUFkLFVBQWUsS0FBWSxFQUFFLE1BQWUsRUFBRSxNQUFlO1FBQzNELE1BQU0sQ0FBQyxJQUFJLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzlELENBQUM7SUFDTSxZQUFNLEdBQWIsVUFBYyxLQUFZLEVBQUUsTUFBZSxFQUFFLE1BQWU7UUFDMUQsTUFBTSxDQUFDLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDN0QsQ0FBQztJQUNNLGFBQU8sR0FBZCxVQUFlLEtBQVMsRUFBRSxNQUFlLEVBQUUsTUFBZTtRQUN4RCxNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztJQUM5RCxDQUFDO0lBR0Qsd0JBQVEsR0FBUjtRQUNFLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssS0FBSyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7WUFBQyxNQUFNLENBQUMsTUFBSSxJQUFJLENBQUMsS0FBTyxDQUFDO1FBQzdELElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsSUFBSSxLQUFLLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQUMsTUFBTSxDQUFDLE9BQUksSUFBSSxDQUFDLEtBQUssT0FBRyxDQUFDO1FBQ2xFLElBQUk7WUFBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUNwQyxDQUFDO0lBbkJNLFVBQUksR0FBRyxVQUFVLENBQUM7SUFvQjNCLFlBQUM7QUFBRCxDQXJCQSxBQXFCQyxJQUFBO0FBckJZLGFBQUssUUFxQmpCLENBQUE7QUFFRDtJQTBCRSxlQUFZLEdBQXFCLEVBQVMsTUFBZSxFQUFTLE1BQWUsRUFBUyxNQUFlO1FBQXRCLHNCQUFzQixHQUF0QixlQUFzQjtRQUEvRCxXQUFNLEdBQU4sTUFBTSxDQUFTO1FBQVMsV0FBTSxHQUFOLE1BQU0sQ0FBUztRQUFTLFdBQU0sR0FBTixNQUFNLENBQVM7UUFIbEcsU0FBSSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBSTVCLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQztZQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ25DLENBQUM7SUEzQk0sVUFBSSxHQUFYLFVBQVksS0FBMEIsRUFBRSxNQUFlLEVBQUUsTUFBZSxFQUFFLE1BQWdCO1FBQTlFLHFCQUEwQixHQUExQixVQUEwQjtRQUNwQyxLQUFLLEdBQUcsS0FBSyxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3RCLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sR0FBRyxNQUFNLEdBQUcsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDakYsTUFBTSxDQUFDLElBQUksS0FBSyxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLE1BQU0sR0FBRyxNQUFNLEdBQUcsU0FBUyxDQUFDLENBQUM7SUFDdkUsQ0FBQztJQUNNLFVBQUksR0FBWCxVQUFZLEtBQTBCLEVBQUUsTUFBZSxFQUFFLE1BQWUsRUFBRSxNQUFnQjtRQUE5RSxxQkFBMEIsR0FBMUIsVUFBMEI7UUFDcEMsS0FBSyxHQUFHLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN0QixLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLEdBQUcsTUFBTSxHQUFHLENBQUMsR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBQ2pGLE1BQU0sQ0FBQyxJQUFJLEtBQUssQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLEdBQUcsTUFBTSxHQUFHLFNBQVMsQ0FBQyxDQUFDO0lBQ3ZFLENBQUM7SUFDTSxjQUFRLEdBQWYsVUFBZ0IsTUFBc0I7UUFDcEMsR0FBRyxDQUFBLENBQVksVUFBTSxFQUFqQixrQkFBTyxFQUFQLElBQWlCLENBQUM7WUFBbEIsSUFBSSxHQUFHLEdBQUksTUFBTSxJQUFWO1lBQ1YsRUFBRSxDQUFBLENBQUMsQ0FBQyxDQUFDLEdBQUcsWUFBWSxLQUFLLENBQUMsQ0FBQztnQkFBQyxNQUFNLElBQUksVUFBVSxDQUFDLG9EQUFrRCxHQUFHLE1BQUcsRUFBRSxTQUFTLEVBQUUsR0FBRyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDN0ksSUFBSSxDQUFDLENBQUM7Z0JBQ0osSUFBSSxFQUFFLEdBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQztnQkFDdEIsRUFBRSxDQUFBLENBQUMsRUFBRSxDQUFDLElBQUksS0FBSyxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQztvQkFDbkMsTUFBTSxJQUFJLFVBQVUsQ0FBQywrQ0FBK0MsRUFBRSxTQUFTLEVBQUUsR0FBRyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDN0csQ0FBQztTQUNGO1FBQ0QsTUFBTSxDQUFVLE1BQU0sQ0FBQztJQUN6QixDQUFDO0lBUUQsd0JBQVEsR0FBUjtRQUNFLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsVUFBQyxLQUFLLElBQUssT0FBQSxLQUFLLENBQUMsUUFBUSxFQUFFLEVBQWhCLENBQWdCLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbEYsSUFBSSxXQUFXLEdBQUcsSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxVQUFDLEtBQUssSUFBSyxPQUFBLEtBQUssQ0FBQyxRQUFRLEVBQUUsRUFBaEIsQ0FBZ0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMxRixFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsTUFBTSxLQUFLLE1BQU0sQ0FBQztZQUFDLE1BQU0sQ0FBQyxNQUFJLFdBQVcsTUFBRyxDQUFDO1FBQ3JELElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsTUFBTSxLQUFLLE1BQU0sQ0FBQztZQUFDLE1BQU0sQ0FBQyxNQUFJLFdBQVcsTUFBRyxDQUFDO1FBQzFELElBQUk7WUFBQyxNQUFNLENBQUMsTUFBSSxPQUFPLE1BQUcsQ0FBQztJQUM3QixDQUFDO0lBRUQsb0JBQUksR0FBSixVQUFLLEdBQWU7UUFDbEIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQztRQUM5QixNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDOUIsQ0FBQztJQUNELG1CQUFHLEdBQUgsVUFBSSxDQUFDLEVBQUUsR0FBZ0I7UUFDckIsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNQLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssSUFBSSxFQUFFLENBQUM7WUFDOUIsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDO1FBQzdCLENBQUM7UUFDRCxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3JDLENBQUM7SUFDRCxzQkFBSSwyQkFBUTthQUFaO1lBQ0UsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNyQyxDQUFDO2FBQ0QsVUFBYSxFQUFlO1lBQzFCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssSUFBSSxFQUFFLENBQUM7WUFDOUIsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDckIsQ0FBQzs7O09BSkE7SUFLRCxzQkFBSSw0QkFBUzthQUFiO1lBQ0UsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDM0MsQ0FBQzthQUNELFVBQWMsSUFBcUI7WUFDakMsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQztZQUM5QixJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFDdEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDMUMsQ0FBQzs7O09BTEE7SUFNRCxzQkFBSSx5QkFBTTthQUFWO1lBQ0UsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUM7UUFDekMsQ0FBQzs7O09BQUE7SUFDSCxZQUFDO0FBQUQsQ0FsRUEsQUFrRUMsSUFBQTtBQWxFWSxhQUFLLFFBa0VqQixDQUFBO0FBRUQsSUFBTSxhQUFhLEdBQUc7SUFDcEIsR0FBRyxFQUFFLE1BQU07SUFDWCxHQUFHLEVBQUUsTUFBTTtJQUNYLEdBQUcsRUFBRSxNQUFNO0lBQ1gsR0FBRyxFQUFFLE1BQU07SUFDWCxHQUFHLEVBQUUsTUFBTTtJQUNYLEdBQUcsRUFBRSxNQUFNO0NBQ1osQ0FBQztBQUVGLElBQUkscUJBQXFCLEdBQUcsQ0FBQyxDQUFDO0FBRTlCLG9CQUEyQixJQUFXO0lBQ3BDLElBQUksSUFBSSxHQUFHLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUN4QixJQUFJLEtBQVcsQ0FBQztJQUNoQixJQUFJLEtBQUssR0FBUyxJQUFJLENBQUM7SUFDdkIsSUFBSSxNQUFNLEdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUU1QixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzdCLElBQUksTUFBTSxHQUFHLENBQUMsQ0FBQztJQUNmLElBQUksSUFBVyxDQUFDO0lBQ2hCLEdBQUcsQ0FBQSxDQUFhLFVBQUssRUFBakIsaUJBQVEsRUFBUixJQUFpQixDQUFDO1FBQWxCLElBQUksSUFBSSxHQUFJLEtBQUssSUFBVDtRQUNWLElBQUksTUFBSSxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN6QixJQUFJLE1BQU0sR0FBRyxDQUFDLENBQUM7UUFFZixFQUFFLENBQUEsQ0FBQyxJQUFJLEtBQUssUUFBUSxDQUFDO1lBQUMsS0FBSyxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUM7UUFFMUMsT0FBTSxNQUFNLEdBQUcsTUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQzNCLEVBQUUsQ0FBQSxDQUFDLElBQUksS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDO2dCQUNyQixFQUFFLENBQUEsQ0FBQyxNQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssSUFBSSxJQUFJLE1BQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQztvQkFDdEQsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztvQkFDbEIsS0FBSyxHQUFHLElBQUksR0FBRyxTQUFTLENBQUM7b0JBQ3pCLE1BQU0sRUFBRSxDQUFDO2dCQUVYLENBQUM7Z0JBQUMsSUFBSTtvQkFBQyxLQUFLLENBQUMsS0FBSyxJQUFJLE1BQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO2dCQUVyQyxRQUFRLENBQUM7WUFDWCxDQUFDO1lBRUQsSUFBSSxPQUFPLEdBQUcsU0FBUyxDQUFDLE1BQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDNUMsTUFBTSxJQUFJLE9BQU8sQ0FBQyxNQUFNLENBQUM7WUFDekIsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7Z0JBQ2xCLEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQztvQkFBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUM1QixLQUFLLEdBQUcsU0FBUyxDQUFDO1lBQ3BCLENBQUM7WUFDRCxFQUFFLENBQUEsQ0FBQyxNQUFNLElBQUksTUFBSSxDQUFDLE1BQU0sQ0FBQztnQkFBQyxRQUFRLENBQUM7WUFFbkMsRUFBRSxDQUFBLENBQUMsTUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ3hCLE1BQU0sR0FBRyxNQUFJLENBQUMsTUFBTSxDQUFDO1lBRXZCLENBQUM7WUFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsTUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQ2hDLEVBQUUsQ0FBQSxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQztvQkFBQyxNQUFNLElBQUksVUFBVSxDQUFDLHlDQUF5QyxFQUFFLE1BQUksRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7Z0JBQ3hHLElBQUksR0FBRyxRQUFRLENBQUM7Z0JBQ2hCLEtBQUssR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7Z0JBQ3pDLE1BQU0sRUFBRSxDQUFDO1lBRVgsQ0FBQztZQUFDLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxNQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDL0IsRUFBRSxDQUFBLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDO29CQUFDLE1BQU0sSUFBSSxVQUFVLENBQUMseUNBQXlDLEVBQUUsTUFBSSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztnQkFDeEcsSUFBSSxPQUFPLEdBQUcsWUFBWSxDQUFDLE1BQUksRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxFQUFFLEVBQUUsTUFBTSxDQUFDLENBQUM7Z0JBQ2pFLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN2RCxNQUFNLElBQUksT0FBTyxDQUFDLE1BQU0sQ0FBQztZQUUzQixDQUFDO1lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLE1BQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxHQUFHLElBQUksTUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxNQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztnQkFDL0UsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDO29CQUFDLE1BQU0sSUFBSSxVQUFVLENBQUMsMENBQTBDLEVBQUUsTUFBSSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztnQkFDakcsSUFBSSxJQUFJLEdBQUcsYUFBYSxDQUFDLE1BQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO2dCQUN2QyxFQUFFLENBQUEsQ0FBQyxJQUFJLEtBQUssTUFBTSxDQUFDO29CQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7Z0JBQ2xFLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxJQUFJLEtBQUssTUFBTSxDQUFDO29CQUFDLEtBQUssR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7Z0JBQ3ZFLElBQUk7b0JBQUMsS0FBSyxHQUFHLElBQUksS0FBSyxDQUFDLFNBQVMsRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7Z0JBQ2xELEtBQUssQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO2dCQUNwQixNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUNuQixNQUFNLEVBQUUsQ0FBQztZQUVYLENBQUM7WUFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsTUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxNQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxJQUFJLE1BQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUMvRSxJQUFJLEtBQUssR0FBRyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUM7Z0JBQ3pCLElBQUksSUFBSSxHQUFHLGFBQWEsQ0FBQyxNQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztnQkFDdkMsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLE1BQU0sS0FBSyxJQUFJLENBQUM7b0JBQUMsTUFBTSxJQUFJLFVBQVUsQ0FBQyxvQkFBa0IsS0FBSyxDQUFDLE1BQU0sNEJBQXVCLElBQU0sRUFBRSxNQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO2dCQUNsSSxLQUFLLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ2xDLEVBQUUsQ0FBQSxDQUFDLENBQUMsS0FBSyxDQUFDO29CQUFDLE1BQU0sSUFBSSxVQUFVLENBQUMseUJBQXlCLEVBQUUsTUFBSSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztnQkFDakYsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDbEIsTUFBTSxFQUFFLENBQUM7WUFFWCxDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ04sSUFBSSxPQUFPLEdBQUcsWUFBWSxDQUFDLE1BQUksRUFBRSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO2dCQUMvRCxJQUFJLFFBQU0sR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDO2dCQUM1QixPQUFPLEdBQUcsbUJBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDL0IsSUFBSSxJQUFJLEdBQUcsT0FBTyxPQUFPLEtBQUssUUFBUSxHQUFHLFlBQVksR0FBRyxTQUFTLENBQUM7Z0JBQ2xFLEVBQUUsQ0FBQSxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sSUFBSSxJQUFJLEtBQUssWUFBWSxDQUFDO29CQUFDLE1BQU0sSUFBSSxVQUFVLENBQUMsa0NBQWtDLEVBQUUsTUFBSSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsQ0FBQztnQkFDMUgsRUFBRSxDQUFBLENBQUMsSUFBSSxLQUFLLFlBQVksQ0FBQyxDQUFDLENBQUM7b0JBQ3pCLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQ2pDLEVBQUUsQ0FBQSxDQUFDLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ2hCLElBQUksS0FBSyxHQUFTLElBQUksS0FBSyxDQUFDOzRCQUMxQixLQUFLLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxHQUFHLENBQUMsQ0FBQzs0QkFDM0MsS0FBSyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsRUFBRSxNQUFNLEVBQUUsTUFBTSxHQUFHLENBQUMsQ0FBQzs0QkFDN0QsS0FBSyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsTUFBTSxHQUFHLENBQUMsR0FBRyxLQUFLLENBQUM7eUJBQ25FLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO3dCQUNuQixLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO29CQUVwQixDQUFDO29CQUFDLElBQUk7d0JBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQztnQkFFL0QsQ0FBQztnQkFBQyxJQUFJO29CQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7Z0JBQzFELE1BQU0sSUFBSSxRQUFNLENBQUM7WUFDbkIsQ0FBQztRQUNILENBQUM7UUFDRCxNQUFNLEVBQUUsQ0FBQztLQUNWO0lBQ0QsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDO1FBQUMsTUFBTSxJQUFJLFVBQVUsQ0FBQyxrQkFBZ0IsVUFBVSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsV0FBUSxFQUFFLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEVBQUUsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQzlHLElBQUksTUFBTSxHQUFHLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0lBQzlCLEVBQUUsQ0FBQSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1FBQUMsTUFBTSxJQUFJLFVBQVUsQ0FBQyx3QkFBd0IsRUFBRSxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUUsTUFBTSxFQUFFLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUVsSCxNQUFNLENBQUMsSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQWxHZSxrQkFBVSxhQWtHekIsQ0FBQTtBQUVELHdCQUErQixLQUFXO0lBQ3hDLHVCQUF1QjtJQUN2QixJQUFJLEVBQUUsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDO0lBQ3hCLEVBQUUsQ0FBQSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQztRQUN0QixNQUFNLElBQUksS0FBSyxDQUFDLHNCQUFzQixDQUFDLENBQUM7SUFFMUMsQ0FBQztJQUFDLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxFQUFFLENBQUMsS0FBSyxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDaEMsa0RBQWtEO1FBQ2xELFNBQVM7UUFDVCw4QkFBOEI7UUFDOUIsMkNBQTJDO1FBQzNDLE1BQU0sSUFBSSxLQUFLLENBQUMsc0JBQXNCLENBQUMsQ0FBQztJQUUxQyxDQUFDO0lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQztRQUNoQyxFQUFFLENBQUEsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztZQUFDLE1BQU0sSUFBSSxVQUFVLENBQUMsaUNBQWlDLEVBQUUsU0FBUyxFQUFFLEtBQUssQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3BILElBQUksTUFBTSxHQUFHLGNBQWMsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2hFLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1FBQ3hDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ2pDLE1BQU0sQ0FBQyxNQUFNLENBQUM7SUFFaEIsQ0FBQztJQUFDLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsT0FBTyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbkosNENBQTRDO1FBQzVDLElBQUksTUFBTSxHQUFHLEVBQUUsQ0FBQztRQUNoQixNQUFNLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO1FBQ2hDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQzFELElBQUksSUFBSSxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUM7UUFDM0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNyQixLQUFLLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQztRQUN2QixLQUFLLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUNELE1BQU0sQ0FBQyxLQUFLLENBQUM7QUFDZixDQUFDO0FBL0JlLHNCQUFjLGlCQStCN0IsQ0FBQTtBQUNELElBQUssS0FBaUM7QUFBdEMsV0FBSyxLQUFLO0lBQUcsaUNBQUksQ0FBQTtJQUFFLHFDQUFNLENBQUE7SUFBRSwrQkFBRyxDQUFBO0lBQUUsaUNBQUksQ0FBQTtBQUFDLENBQUMsRUFBakMsS0FBSyxLQUFMLEtBQUssUUFBNEI7QUFBQSxDQUFDO0FBS3ZDLGtCQUF5QixJQUFXO0lBQ2xDLElBQUksU0FBUyxHQUFhLEVBQUMsS0FBSyxFQUFFLEVBQUUsRUFBQyxDQUFDO0lBQ3RDLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDN0IsSUFBSSxJQUFJLEdBQUcsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRTVCLEdBQUcsQ0FBQSxDQUFZLFVBQThCLEVBQTlCLEtBQUEsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQXpDLGNBQU8sRUFBUCxJQUF5QyxDQUFDO1FBQTFDLElBQUksR0FBRyxTQUFBO1FBQW9DLGFBQWEsQ0FBQyxHQUFHLEVBQUUsU0FBUyxDQUFDLENBQUM7S0FBQTtJQUM3RSxNQUFNLENBQUMsU0FBUyxDQUFDO0FBQ25CLENBQUM7QUFQZSxnQkFBUSxXQU92QixDQUFBO0FBR0QsdUJBQXVCLEdBQVMsRUFBRSxTQUFtQixFQUFFLE9BQXdCLEVBQUUsTUFBbUMsRUFBRSxjQUFzQjtJQUMxSSxFQUFFLENBQUEsQ0FBQyxNQUFNLFlBQVksT0FBTyxDQUFDLEtBQUssQ0FBQztRQUFDLElBQUksS0FBSyxHQUFHLE1BQU0sQ0FBQztJQUN2RCxJQUFJO1FBQUMsSUFBSSxLQUFLLEdBQWtCLE1BQU0sQ0FBQztJQUN2QyxJQUFJLEtBQUssR0FBRyxjQUFjLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDaEMsSUFBSSxFQUFFLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQztJQUN4QixFQUFFLENBQUEsQ0FBQyxFQUFFLENBQUMsSUFBSSxLQUFLLEtBQUssQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBQ25DLE1BQU0sSUFBSSxVQUFVLENBQUMscURBQW1ELEVBQUUsZUFBVSxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBRyxFQUFFLEVBQUUsRUFBRSxHQUFHLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUUxSSxFQUFFLENBQUEsQ0FBQyxFQUFFLENBQUMsS0FBSyxLQUFLLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDdkIsSUFBSyxNQUFNLEdBQUksY0FBYyxDQUFDLEtBQUssRUFBRSxTQUFTLEVBQUUsUUFBUSxDQUFDLE9BQUEsQ0FBQztRQUMxRCxNQUFNLENBQUMsRUFBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQVEsTUFBTyxDQUFDLEdBQUcsQ0FBQyxVQUFDLEtBQUssRUFBRSxFQUFFLElBQUssT0FBQSxpQkFBaUIsQ0FBQyxlQUFhLEVBQUksRUFBRSxLQUFLLEVBQUUsT0FBTyxDQUFDLEVBQXBELENBQW9ELENBQUMsRUFBQyxDQUFDO0lBQzdILENBQUM7SUFDRCxFQUFFLENBQUEsQ0FBQyxFQUFFLENBQUMsS0FBSyxLQUFLLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDdkIsSUFBSSxJQUFJLEdBQUcsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2pDLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksSUFBSSxDQUFDO1lBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLGlCQUFpQixDQUFDLGVBQWEsR0FBSyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUMzRixNQUFNLENBQUMsRUFBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLEdBQUcsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFDLENBQUM7SUFDeEMsQ0FBQztJQUVELEVBQUUsQ0FBQSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztRQUN4QixJQUFJLFNBQVMsR0FBRyxTQUFTLENBQUMsU0FBUyxJQUFJLFNBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNsRCxHQUFHLENBQUEsQ0FBWSxVQUFlLEVBQWYsS0FBQSxLQUFLLENBQUMsU0FBUyxFQUExQixjQUFPLEVBQVAsSUFBMEIsQ0FBQztZQUEzQixJQUFJLEdBQUcsU0FBQTtZQUNQLElBQUksS0FBSyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDekIsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDO1lBQ2QsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxDQUFDLEVBQUUsRUFBRSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQztnQkFDN0MsSUFBSSxHQUFHLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDeEIsSUFBSSxLQUFLLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFLEdBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzVCLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQztZQUNsQyxDQUFDO1lBQ0QsU0FBUyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1NBQ3BDO1FBQ0QsU0FBUyxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7UUFDaEMsTUFBTSxDQUFDO0lBQ1gsQ0FBQztJQUVELEVBQUUsQ0FBQSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztRQUN4QixJQUFJLFNBQVMsR0FBRyxTQUFTLENBQUMsU0FBUyxJQUFJLFNBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNsRCxHQUFHLENBQUEsQ0FBWSxVQUFlLEVBQWYsS0FBQSxLQUFLLENBQUMsU0FBUyxFQUExQixjQUFPLEVBQVAsSUFBMEIsQ0FBQztZQUEzQixJQUFJLEdBQUcsU0FBQTtZQUNQLElBQUksS0FBSyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDekIsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDO1lBQ2QsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxDQUFDLEVBQUUsRUFBRSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQztnQkFDN0MsSUFBSSxHQUFHLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDeEIsSUFBSSxLQUFLLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFLEdBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzVCLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQztZQUNsQyxDQUFDO1lBQ0QsU0FBUyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1NBQ3ZDO1FBQ0QsU0FBUyxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7UUFDaEMsTUFBTSxDQUFDO0lBQ1gsQ0FBQztJQUVELEVBQUUsQ0FBQSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEtBQUssT0FBTyxDQUFDLENBQUMsQ0FBQztRQUN0QixNQUFNLElBQUksS0FBSyxDQUFDLHlDQUF5QyxDQUFDLENBQUM7SUFDL0QsQ0FBQztJQUVELEVBQUUsQ0FBQSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEtBQUssT0FBTyxDQUFDLENBQUMsQ0FBQztRQUN4QixJQUFJLFdBQVcsR0FBbUIsRUFBRSxDQUFDO1FBQ3JDLElBQUksS0FBOEIsY0FBYyxDQUFDLEtBQUssRUFBRSxTQUFTLEVBQUUsUUFBUSxDQUFDLEVBQXZFLE1BQU0sY0FBRSxTQUFTLGlCQUFFLE1BQU0sWUFBOEMsQ0FBQztRQUM3RSxJQUFJLE9BQU8sR0FBRyxNQUFNLEdBQUcsaUJBQWlCLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FBQyxHQUFHLFlBQUksRUFBRSxDQUFDO1FBQ3pGLElBQUksSUFBSSxHQUFHLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxTQUFHLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDM0MsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUN2QyxFQUFFLENBQUEsQ0FBQyxhQUFLLENBQUMsZUFBZSxDQUFDO1lBQUMsZUFBZSxDQUFDLElBQUksRUFBRSxhQUFLLENBQUMsZUFBZSxDQUFDLENBQUM7UUFDdkUsU0FBUyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxJQUFJLENBQUM7UUFDaEMsSUFBSSxVQUFVLEdBQUcsS0FBSyxDQUFDO1FBQ3ZCLEdBQUcsQ0FBQSxDQUFZLFVBQTJCLEVBQTNCLEtBQUEsS0FBSyxDQUFDLFFBQVEsQ0FBTSxNQUFNLENBQUMsRUFBdEMsY0FBTyxFQUFQLElBQXNDLENBQUM7WUFBdkMsSUFBSSxLQUFHLFNBQUE7WUFDVCxJQUFJLEtBQUssR0FBRyxhQUFhLENBQUMsS0FBRyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDN0QsRUFBRSxDQUFBLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQyxVQUFVLENBQUM7Z0JBQUMsVUFBVSxHQUFHLElBQUksQ0FBQztTQUNqRDtRQUVELElBQUksYUFBYSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUM7UUFDdkMsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDO1FBQ3JCLEVBQUUsQ0FBQSxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztZQUNsQixhQUFhLEdBQUcsRUFBRSxDQUFDO1lBQ25CLFNBQVMsR0FBRyxLQUFLLENBQUM7WUFDbEIsR0FBRyxDQUFBLENBQWlCLFVBQVcsRUFBM0IsdUJBQVksRUFBWixJQUEyQixDQUFDO2dCQUE1QixJQUFJLFFBQVEsR0FBSSxXQUFXLElBQWY7Z0JBQWlCLGFBQWEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQzthQUFBO1FBQ2pGLENBQUM7UUFDRCxFQUFFLENBQUEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLE1BQU0sQ0FBQztZQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7UUFFbEUsMkJBQTJCO1FBQzNCLEVBQUUsQ0FBQSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDVixJQUFJLE1BQU0sR0FBRyxJQUFJLEtBQUssQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsS0FBSyxHQUFHLFFBQVEsR0FBRyxRQUFRLENBQUMsRUFBRSxLQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDdkgsSUFBSSxNQUFNLEdBQUcsRUFBRSxDQUFDO1lBRWhCLEdBQUcsQ0FBQSxDQUFpQixVQUFXLEVBQTNCLHVCQUFZLEVBQVosSUFBMkIsQ0FBQztnQkFBNUIsSUFBSSxRQUFRLEdBQUksV0FBVyxJQUFmO2dCQUNkLEVBQUUsQ0FBQSxDQUFDLFNBQVMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUM7b0JBQUMsUUFBUSxDQUFDO2dCQUMvQyxJQUFJLEtBQUssR0FBRyxRQUFRLENBQUMsVUFBVSxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUM7Z0JBQ2pELE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUNsQyxFQUFFLENBQUEsQ0FBQyxLQUFLLENBQUM7b0JBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO2dCQUN2RCxJQUFJO29CQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBRXBELEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7b0JBQ1gsR0FBRyxDQUFBLENBQWtCLFVBQU8sRUFBeEIsbUJBQWEsRUFBYixJQUF3QixDQUFDO3dCQUF6QixJQUFJLFNBQVMsR0FBSSxPQUFPLElBQVg7d0JBQ2YsRUFBRSxDQUFBLENBQUMsU0FBUyxDQUFDLElBQUksS0FBSyxRQUFRLENBQUMsSUFBSSxDQUFDOzRCQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO3FCQUNsRTtnQkFDSCxDQUFDO2FBQ0Y7WUFFRCxFQUFFLENBQUEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO2dCQUNiLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO2dCQUN4QyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3pCLENBQUM7WUFDRCxFQUFFLENBQUEsQ0FBQyxNQUFNLENBQUMsTUFBTSxJQUFJLFVBQVUsQ0FBQztnQkFBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ25ELGFBQWEsQ0FBQyxNQUFNLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztRQUNwRCxDQUFDO1FBRUQsTUFBTSxDQUFDLEVBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLElBQUksRUFBRSxXQUFBLFNBQVMsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFDLENBQUM7SUFDN0UsQ0FBQztJQUVELEVBQUUsQ0FBQSxDQUFDLEVBQUUsQ0FBQyxLQUFLLEtBQUssT0FBTyxDQUFDLENBQUMsQ0FBQztRQUN4QixJQUFJLEtBQThCLGNBQWMsQ0FBQyxLQUFLLEVBQUUsU0FBUyxFQUFFLFFBQVEsQ0FBQyxFQUF2RSxNQUFNLGNBQUUsTUFBTSxjQUFFLFNBQVMsZUFBOEMsQ0FBQztRQUM3RSxJQUFJLE9BQU8sR0FBRyxNQUFNLEdBQUcsaUJBQWlCLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FBQyxHQUFHLFlBQUksRUFBRSxDQUFDO1FBQ3pGLElBQUksSUFBSSxHQUFHLElBQUksT0FBTyxDQUFDLEtBQUssQ0FBQyxTQUFHLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDM0MsRUFBRSxDQUFBLENBQUMsYUFBSyxDQUFDLGVBQWUsQ0FBQztZQUFDLGVBQWUsQ0FBQyxJQUFJLEVBQUUsYUFBSyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQ3ZFLFNBQVMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDO1FBQ2hDLElBQUksUUFBUSxHQUFHLEVBQUUsQ0FBQztRQUNsQixHQUFHLENBQUEsQ0FBWSxVQUEyQixFQUEzQixLQUFBLEtBQUssQ0FBQyxRQUFRLENBQU0sTUFBTSxDQUFDLEVBQXRDLGNBQU8sRUFBUCxJQUFzQyxDQUFDO1lBQXZDLElBQUksS0FBRyxTQUFBO1lBQ1QsSUFBSSxLQUFLLEdBQUcsY0FBYyxDQUFDLEtBQUcsQ0FBQyxDQUFDO1lBQ2hDLEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxLQUFLLE9BQU8sSUFBSSxLQUFLLENBQUMsUUFBUSxDQUFDLEtBQUssS0FBSyxPQUFPLENBQUM7Z0JBQ3RFLE1BQU0sSUFBSSxVQUFVLENBQUMsaUNBQWlDLEVBQUUsRUFBRSxFQUFFLEtBQUcsQ0FBQyxNQUFNLEVBQUUsS0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ3RGLElBQUksR0FBRyxHQUFHLGFBQWEsQ0FBQyxLQUFLLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQztZQUN6RCxHQUFHLENBQUEsQ0FBaUIsVUFBVyxFQUFYLEtBQUEsR0FBRyxDQUFDLE9BQU8sRUFBM0IsY0FBWSxFQUFaLElBQTJCLENBQUM7Z0JBQTVCLElBQUksUUFBUSxTQUFBO2dCQUNkLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxTQUFTLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDO29CQUFDLFFBQVEsQ0FBQztnQkFDbkQsSUFBSSxLQUFLLEdBQUcsUUFBUSxDQUFDLFVBQVUsSUFBSSxRQUFRLENBQUMsSUFBSSxDQUFDO2dCQUNqRCxFQUFFLENBQUEsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztvQkFBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsRUFBRSxDQUFDO2dCQUMxQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQzthQUN2QztTQUNGO1FBRUQsMEJBQTBCO1FBQzFCLEVBQUUsQ0FBQSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDVixJQUFJLE1BQU0sR0FBRyxJQUFJLEtBQUssQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsS0FBSyxHQUFHLFFBQVEsR0FBRyxRQUFRLENBQUMsRUFBRSxLQUFLLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDdEgsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLEtBQUssSUFBSSxRQUFRLENBQUMsQ0FBQyxDQUFDO2dCQUMxQixJQUFJLGdCQUFnQixHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7Z0JBQ3BELEVBQUUsQ0FBQSxDQUFDLGdCQUFnQixDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7b0JBQzlCLE1BQU0sSUFBSSxVQUFVLENBQ2xCLHFGQUFtRixLQUFLLGNBQVMsZ0JBQWdCLENBQUMsTUFBTSxpQkFBWSxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQUcsRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ3BNLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUNsQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3JELENBQUM7WUFFRCxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxNQUFNLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztZQUMvQyxhQUFhLENBQUMsTUFBTSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDcEQsQ0FBQztRQUVELE1BQU0sQ0FBQyxFQUFDLElBQUksRUFBRSxLQUFLLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsVUFBQSxRQUFRLEVBQUMsQ0FBQztJQUN0RCxDQUFDO0lBRUQsRUFBRSxDQUFBLENBQUMsRUFBRSxDQUFDLEtBQUssS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQ3pCLEVBQUUsQ0FBQSxDQUFDLENBQUMsS0FBSyxDQUFDO1lBQUMsTUFBTSxJQUFJLFVBQVUsQ0FBQyx1Q0FBdUMsRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDckcsSUFBSSxJQUFJLEdBQUcsY0FBYyxDQUFDLEtBQUssRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDN0MsSUFBSyxNQUFNLEdBQWUsSUFBSSxTQUFqQixTQUFTLEdBQUksSUFBSSxVQUFBLENBQUM7UUFDL0IsSUFBSSxJQUFJLEdBQUcsaUJBQWlCLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3BFLEVBQUUsQ0FBQSxDQUFDLElBQUksS0FBSyxTQUFTLENBQUM7WUFBQyxNQUFNLElBQUksVUFBVSxDQUFDLG1DQUFtQyxFQUFFLEVBQUUsRUFBRSxHQUFHLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUU3RyxJQUFJLElBQUksR0FBRyxFQUFFLENBQUM7UUFDZCxHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDcEIsRUFBRSxDQUFBLENBQUMsR0FBRyxLQUFLLFFBQVEsSUFBSSxHQUFHLEtBQUssV0FBVyxDQUFDO2dCQUFDLFFBQVEsQ0FBQztZQUNyRCxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsaUJBQWlCLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUNwRSxDQUFDO1FBQ0QsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUFDLE1BQU0sSUFBSSxVQUFVLENBQUMsa0NBQWdDLElBQUksTUFBRyxFQUFFLEVBQUUsRUFBRSxHQUFHLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMzSCxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN4QixNQUFNLENBQUM7SUFDVCxDQUFDO0lBRUQsRUFBRSxDQUFBLENBQUMsQ0FBQyxNQUFNLENBQUM7UUFBQyxNQUFNLElBQUksVUFBVSxDQUFDLHFFQUFxRSxFQUFFLEVBQUUsRUFBRSxHQUFHLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUVwSSxFQUFFLENBQUEsQ0FBQyxFQUFFLENBQUMsS0FBSyxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDekIsRUFBRSxDQUFBLENBQUMsQ0FBQyxLQUFLLENBQUM7WUFBQyxNQUFNLElBQUksVUFBVSxDQUFDLHVDQUF1QyxFQUFFLEVBQUUsRUFBRSxHQUFHLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNyRyxJQUFJLFFBQVEsR0FBRyxZQUFJLEVBQUUsQ0FBQztRQUN0QixJQUFJLE1BQU0sR0FBRyxXQUFXLENBQUMsS0FBSyxFQUFFLFFBQVEsRUFBRSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDdEQsSUFBSSxJQUFJLEdBQUcsaUJBQWlCLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3BFLEVBQUUsQ0FBQSxDQUFDLElBQUksS0FBSyxTQUFTLENBQUM7WUFBQyxNQUFNLElBQUksVUFBVSxDQUFDLG9DQUFvQyxFQUFFLEVBQUUsRUFBRSxHQUFHLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM5RyxJQUFJLFNBQVMsR0FBRyxPQUFPLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFBO1FBQzVDLGlFQUFpRTtRQUNqRSxJQUFJLElBQUksR0FBRyxjQUFjLENBQUMsS0FBSyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsTUFBTSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdkUsSUFBSyxTQUFTLEdBQUksSUFBSSxVQUFBLENBQUM7UUFFdkIsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ2QsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ3BCLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN0QixJQUFJLFFBQVEsU0FBQSxDQUFDO1lBQ2IsRUFBRSxDQUFBLENBQUMsR0FBRyxLQUFLLFFBQVEsSUFBSSxHQUFHLEtBQUssV0FBVyxDQUFDO2dCQUFDLFFBQVEsQ0FBQztZQUVyRCxFQUFFLENBQUEsQ0FBQyxLQUFLLFlBQVksS0FBSyxJQUFJLEtBQUssQ0FBQyxJQUFJLEtBQUssS0FBSyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO2dCQUNsRSxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssQ0FBQztnQkFDNUIsUUFBUSxDQUFDO1lBQ1gsQ0FBQztZQUVELEVBQUUsQ0FBQSxDQUFDLEtBQUssWUFBWSxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUMxQixJQUFJLE1BQU0sR0FBRyxhQUFhLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLFlBQVUscUJBQXFCLEVBQUUsU0FBSSxHQUFLLENBQUMsQ0FBQztnQkFDMUcsRUFBRSxDQUFBLENBQUMsQ0FBQyxNQUFNLElBQUksTUFBTSxDQUFDLElBQUksS0FBSyxLQUFLLENBQUMsSUFBSSxDQUFDO29CQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsMkJBQXlCLEdBQUcseUJBQW9CLEtBQUssQ0FBQyxRQUFRLEVBQUUsTUFBRyxDQUFDLENBQUM7Z0JBQy9ILEVBQUUsQ0FBQSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEtBQUssS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7b0JBQzlCLElBQUksTUFBSSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUM7b0JBQ3hCLElBQUksYUFBVyxHQUFHLFNBQVMsQ0FBQyxNQUFJLENBQUMsQ0FBQztvQkFDbEMsRUFBRSxDQUFBLENBQUMsQ0FBQyxhQUFXLENBQUM7d0JBQUMsTUFBTSxJQUFJLEtBQUssQ0FBQywyQkFBeUIsR0FBRyw2Q0FBMEMsQ0FBQyxDQUFDO29CQUN6RyxHQUFHLENBQUEsQ0FBZSxVQUFPLEVBQXJCLG1CQUFVLEVBQVYsSUFBcUIsQ0FBQzt3QkFBdEIsSUFBSSxNQUFNLEdBQUksT0FBTyxJQUFYO3dCQUNaLEdBQUcsQ0FBQSxDQUFtQixVQUFrQixFQUFsQixLQUFBLE1BQU0sQ0FBQyxXQUFXLEVBQXBDLGNBQWMsRUFBZCxJQUFvQyxDQUFDOzRCQUFyQyxJQUFJLFVBQVUsU0FBQTs0QkFDaEIsRUFBRSxDQUFBLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxLQUFLLE1BQUksSUFBSSxVQUFVLENBQUMsQ0FBQyxDQUFDLEtBQUssYUFBVyxDQUFDLENBQUMsQ0FBQztnQ0FDM0QsUUFBUSxHQUFHLE1BQU0sQ0FBQztnQ0FDbEIsS0FBSyxDQUFDOzRCQUNSLENBQUM7eUJBQ0Y7cUJBQ0Y7Z0JBQ0gsQ0FBQztZQUNILENBQUM7WUFBQyxJQUFJO2dCQUFDLFFBQVEsR0FBRyxjQUFjLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQztZQUV2RCxFQUFFLENBQUEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO2dCQUNaLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDO2dCQUMzQixRQUFRLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3pDLENBQUM7WUFDRCxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsU0FBUyxJQUFJLFNBQVMsQ0FBQyxLQUFLLENBQUM7Z0JBQ25DLE1BQU0sSUFBSSxVQUFVLENBQUMsZ0VBQThELEtBQUssQ0FBQyxLQUFLLE1BQUcsRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDakksSUFBSTtnQkFBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxFQUFFLFdBQVcsRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUMsb0RBQW9EO1FBQ3RLLENBQUM7UUFFRCxJQUFJLFdBQVcsR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEMsRUFBRSxDQUFBLENBQUMsY0FBYyxJQUFJLFdBQVcsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdkQsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1lBQzVDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBQyxJQUFJLEVBQUUsY0FBYyxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxDQUFDLFFBQVEsRUFBRSxXQUFXLENBQUMsRUFBRSxXQUFXLEVBQUUsQ0FBQyxDQUFDLElBQUksRUFBRSxXQUFXLENBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQztRQUMvSCxDQUFDO1FBRUQsRUFBRSxDQUFBLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztZQUNiLEVBQUUsQ0FBQSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2IsRUFBRSxDQUFBLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQztvQkFBQyxJQUFJLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQztnQkFDL0MsSUFBSTtvQkFBQyxNQUFNLElBQUksVUFBVSxDQUFDLDBDQUF3QyxJQUFJLE1BQUcsRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDekcsQ0FBQztZQUNELEVBQUUsQ0FBQSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUM7Z0JBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQzlELElBQUk7Z0JBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQzdDLENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsU0FBUyxDQUFDO1lBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDaEQsSUFBSTtZQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQztRQUN4QyxNQUFNLENBQUM7WUFDTCxJQUFJLEVBQUUsS0FBSyxDQUFDLElBQUk7WUFDaEIsS0FBSyxFQUFFLElBQUk7WUFDWCxVQUFVLEVBQUUsU0FBUyxJQUFJLFNBQVMsQ0FBQyxTQUFTO1NBQzdDLENBQUM7SUFDSixDQUFDO0lBRUQsRUFBRSxDQUFBLENBQUMsRUFBRSxDQUFDLEtBQUssS0FBSyxVQUFVLENBQUMsQ0FBQyxDQUFDO1FBQzNCLElBQUksSUFBSSxHQUFHLGNBQWMsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQzdDLElBQUssTUFBTSxHQUFlLElBQUksU0FBakIsU0FBUyxHQUFJLElBQUksVUFBQSxDQUFDO1FBRS9CLElBQUksYUFBYSxHQUFHLEVBQUUsQ0FBQztRQUN2QixHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDcEIsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3RCLEVBQUUsQ0FBQSxDQUFDLEdBQUcsS0FBSyxRQUFRLElBQUksR0FBRyxLQUFLLFdBQVcsQ0FBQztnQkFBQyxRQUFRLENBQUM7WUFDckQsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLElBQUksS0FBSyxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3hDLGFBQWEsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDO2dCQUNyQyxRQUFRLENBQUM7WUFDWCxDQUFDO1lBRUQsSUFBSSxRQUFRLEdBQUcsY0FBYyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDcEQsRUFBRSxDQUFBLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztnQkFDWixFQUFFLENBQUEsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDO29CQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDO2dCQUN4RCxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO29CQUNoQixRQUFRLENBQUMsVUFBVSxHQUFHLEdBQUcsQ0FBQztvQkFDMUIsYUFBYSxDQUFDLEdBQUcsQ0FBQyxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUM7Z0JBQ3RDLENBQUM7Z0JBQUMsSUFBSTtvQkFBQyxhQUFhLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDOUMsQ0FBQztZQUFDLElBQUk7Z0JBQUMsTUFBTSxJQUFJLFVBQVUsQ0FBQyx3REFBc0QsS0FBSyxDQUFDLEtBQUssTUFBRyxFQUFFLEVBQUUsRUFBRSxHQUFHLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNoSSxDQUFDO1FBRUQsSUFBSSxJQUFJLEdBQUcsaUJBQWlCLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3BFLEVBQUUsQ0FBQSxDQUFDLElBQUksS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ3RCLEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUM7Z0JBQUMsTUFBTSxJQUFJLFVBQVUsQ0FBQyxrQ0FBa0MsRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDN0csRUFBRSxDQUFBLENBQUMsU0FBUyxJQUFJLFNBQVMsQ0FBQyxLQUFLLENBQUM7Z0JBQUMsTUFBTSxJQUFJLFVBQVUsQ0FBQywrQkFBK0IsRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDLE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDbkgsZUFBZTtZQUNmLEtBQUssQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDL0IsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sSUFBSSxPQUFLLEdBQWtCLFNBQVMsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxPQUFPLENBQUMsS0FBSyxDQUFDLFNBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUNqRixFQUFFLENBQUEsQ0FBQyxhQUFLLENBQUMsZUFBZSxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFBQyxlQUFlLENBQUMsT0FBSyxFQUFFLGFBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUNsRyxTQUFTLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLE9BQUssQ0FBQztZQUU5QiwwRUFBMEU7WUFDMUUsRUFBRSxDQUFBLENBQUMsU0FBUyxJQUFJLFNBQVMsQ0FBQyxLQUFLLENBQUM7Z0JBQzlCLE1BQU0sSUFBSSxVQUFVLENBQUMsNkRBQTZELEVBQUUsRUFBRSxFQUFFLEdBQUcsQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ2xILElBQUk7Z0JBQUMsT0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLGFBQWEsQ0FBQyxDQUFDO1FBQzlDLENBQUM7UUFDRCxNQUFNLENBQUM7SUFDVCxDQUFDO0lBRUQsTUFBTSxJQUFJLFVBQVUsQ0FBQywyQkFBeUIsRUFBRSxDQUFDLEtBQUssTUFBRyxFQUFFLEVBQUUsRUFBRSxHQUFHLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUN6RixDQUFDO0FBRUQsMkJBQTJCLElBQVcsRUFBRSxLQUFpQixFQUFFLE9BQXVCLEVBQUUsSUFBVztJQUM3RixFQUFFLENBQUEsQ0FBQyxDQUFDLEtBQUssQ0FBQztRQUFDLE1BQU0sQ0FBQztJQUNsQixFQUFFLENBQUEsQ0FBQyxLQUFLLFlBQVksS0FBSyxDQUFDO1FBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUUsU0FBUyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQzNFLEVBQUUsQ0FBQSxDQUFDLEtBQUssWUFBWSxLQUFLLElBQUksS0FBSyxDQUFDLElBQUksS0FBSyxLQUFLLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7UUFDbEUsSUFBSSxRQUFRLEdBQUcsY0FBYyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNsRSxFQUFFLENBQUEsQ0FBQyxDQUFDLFFBQVEsQ0FBQztZQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsaUJBQWUsSUFBSSxnQ0FBMkIsS0FBSyxDQUFDLEtBQUssTUFBRyxDQUFDLENBQUM7UUFDNUYsRUFBRSxDQUFBLENBQUMsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDO1lBQUMsTUFBTSxJQUFJLEtBQUssQ0FBQyxpQkFBZSxJQUFJLDhCQUF5QixLQUFLLENBQUMsS0FBSyxNQUFHLENBQUMsQ0FBQztRQUNqRyxNQUFNLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQztJQUN4QixDQUFDO0lBQ0QsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUM7QUFDckIsQ0FBQztBQUVELHdCQUF3QixJQUFXLEVBQUUsT0FBdUIsRUFBRSxJQUFXO0lBQ3ZFLEVBQUUsQ0FBQSxDQUFDLENBQUMsT0FBTyxDQUFDO1FBQUMsTUFBTSxDQUFDO0lBQ3BCLEdBQUcsQ0FBQSxDQUFpQixVQUFPLEVBQXZCLG1CQUFZLEVBQVosSUFBdUIsQ0FBQztRQUF4QixJQUFJLFFBQVEsR0FBSSxPQUFPLElBQVg7UUFDZCxFQUFFLENBQUEsQ0FBQyxRQUFRLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDMUIsRUFBRSxDQUFBLENBQUMsUUFBUSxDQUFDLE1BQU0sS0FBSyxLQUFLLENBQUM7Z0JBQUMsTUFBTSxJQUFJLEtBQUssQ0FBQyxpREFBK0MsSUFBSSxNQUFHLENBQUMsQ0FBQztZQUN0RyxFQUFFLENBQUEsQ0FBQyxJQUFJLEtBQUssU0FBUyxJQUFJLFFBQVEsQ0FBQyxJQUFJLEtBQUssSUFBSSxDQUFDO2dCQUM5QyxNQUFNLElBQUksS0FBSyxDQUFDLHdCQUFzQixJQUFJLHdCQUFtQixJQUFJLGlDQUE0QixRQUFRLENBQUMsSUFBSSxNQUFHLENBQUMsQ0FBQztZQUNqSCxNQUFNLENBQUMsUUFBUSxDQUFDO1FBQ2xCLENBQUM7S0FDRjtBQUNILENBQUM7QUFFRCxxQkFBcUIsSUFBVztJQUM5QixNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLE9BQU8sQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDO0FBQ3JGLENBQUM7QUFDRCxtQkFBbUIsSUFBVztJQUM1QixNQUFNLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsSUFBSSxPQUFPLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQztBQUM3RSxDQUFDO0FBRUQscUJBQTRCLElBQVUsRUFBRSxLQUFZLEVBQUUsUUFBbUI7SUFDdkUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ1gsSUFBSSxTQUFTLEdBQUcsQ0FBQyxDQUFDO0lBQ2xCLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxJQUFFLEdBQUcsQ0FBQyxFQUFFLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUUsQ0FBQyxFQUFFLElBQUUsR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUUsRUFBRSxFQUFFLENBQUM7UUFDM0QsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLElBQUksS0FBSyxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDbkMsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLEtBQUssS0FBSyxLQUFLLENBQUM7Z0JBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ2hELElBQUk7Z0JBQUMsSUFBRSxHQUFHLENBQUMsQ0FBQztRQUNkLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLEVBQUUsQ0FBQSxDQUFDLFFBQVEsSUFBSSxTQUFTLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7Z0JBQzNDLElBQUksT0FBTyxHQUFHLFFBQVEsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDO2dCQUNwQyxFQUFFLENBQUEsQ0FBQyxPQUFPLEtBQUssS0FBSyxDQUFDO29CQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUM7Z0JBQ2pDLElBQUk7b0JBQUMsSUFBRSxHQUFHLENBQUMsQ0FBQztZQUNkLENBQUM7WUFDRCxNQUFNLElBQUksS0FBSyxDQUFDLFlBQVUsS0FBSyx1QkFBa0IsSUFBSSxDQUFDLFFBQVEsRUFBSSxDQUFDLENBQUM7UUFDdEUsQ0FBQztJQUNILENBQUM7SUFDRCxNQUFNLElBQUksS0FBSyxDQUFDLFlBQVUsS0FBSyx1QkFBa0IsSUFBSSxDQUFDLFFBQVEsRUFBSSxDQUFDLENBQUM7QUFDdEUsQ0FBQztBQWpCZSxtQkFBVyxjQWlCMUIsQ0FBQTtBQUVELHdCQUErQixJQUFVLEVBQUUsUUFBa0IsRUFBRSxJQUFZO0lBQ3pFLElBQUksSUFBSSxHQUFPLEVBQUUsQ0FBQztJQUNsQixJQUFJLFNBQVMsR0FBRyxDQUFDLENBQUM7SUFDbEIsSUFBSSxPQUFPLENBQUM7SUFDWixJQUFJLEtBQUssR0FBRyxLQUFLLENBQUM7SUFDbEIsR0FBRyxDQUFBLENBQVksVUFBYyxFQUFkLEtBQUEsSUFBSSxDQUFDLFNBQVMsRUFBekIsY0FBTyxFQUFQLElBQXlCLENBQUM7UUFBMUIsSUFBSSxHQUFHLFNBQUE7UUFDVCxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsSUFBSSxLQUFLLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNuQyxFQUFFLENBQUEsQ0FBQyxPQUFPLENBQUM7Z0JBQUMsTUFBTSxJQUFJLEtBQUssQ0FBQyxpQ0FBK0IsR0FBRyxNQUFHLENBQUMsQ0FBQztZQUNuRSxJQUFJO2dCQUFDLE9BQU8sR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDO1FBQzNCLENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNsQixFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztnQkFDL0IsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEdBQUcsQ0FBQztZQUN0QixDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ04sRUFBRSxDQUFBLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxLQUFLLENBQUMsQ0FBQztvQkFBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztnQkFDdEUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUMxQixDQUFDO1lBQ0QsT0FBTyxHQUFHLFNBQVMsQ0FBQztZQUNwQixTQUFTLEdBQUcsUUFBUSxHQUFHLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQzNDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDZixDQUFDO1FBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLFFBQVEsSUFBSSxTQUFTLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDbEQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDO1FBQ3BDLENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNmLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQzlCLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDdkIsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDO2dCQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMscUNBQXFDLENBQUMsQ0FBQztZQUNqRSxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsU0FBUyxDQUFDO2dCQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsOEJBQTRCLFFBQVEsQ0FBQyxNQUFNLGdCQUFVLFNBQVMsR0FBRyxDQUFDLENBQUUsQ0FBQyxDQUFDO1lBQ3pHLElBQUk7Z0JBQUMsTUFBTSxJQUFJLEtBQUssQ0FBQyxzREFBc0QsQ0FBQyxDQUFDO1FBQy9FLENBQUM7S0FDRjtJQUVELE1BQU0sQ0FBQyxJQUFJLENBQUM7QUFDZCxDQUFDO0FBaENlLHNCQUFjLGlCQWdDN0IsQ0FBQTtBQUdELEVBQUUsQ0FBQSxDQUFDLFdBQUcsS0FBSyxTQUFTLENBQUM7SUFBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEdBQUcsT0FBTyxDQUFDO0FBRWpELHlCQUFnQyxDQUFLLEVBQUUsVUFBNEI7SUFDakUsSUFBSSxlQUFlLEdBQXNCLFVBQVUsQ0FBQztJQUNwRCxFQUFFLENBQUEsQ0FBQyxDQUFDLFVBQVUsSUFBSSxVQUFVLEtBQUssSUFBSSxDQUFDO1FBQUMsZUFBZSxHQUFHLFVBQUMsRUFBRSxFQUFFLElBQUksSUFBSyxPQUFBLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLEVBQS9CLENBQStCLENBQUM7SUFDdkcsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDO0lBQ2QsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7UUFBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ2pDLElBQUksQ0FBQyxPQUFPLENBQUMsVUFBQyxFQUFFO1FBQ2QsRUFBRSxDQUFBLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDLElBQUksT0FBTyxDQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssVUFBVSxDQUFDO1lBQUMsTUFBTSxDQUFDO1FBQ3RGLElBQUksR0FBRyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNoQixDQUFDLENBQUMsRUFBRSxDQUFDLEdBQUc7WUFDTixlQUFlLENBQUMsRUFBRSxFQUFFLFNBQVMsQ0FBQyxDQUFDO1lBQy9CLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQztRQUNwQyxDQUFDLENBQUE7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUNILE1BQU0sQ0FBQyxDQUFDLENBQUM7QUFDWCxDQUFDO0FBZGUsdUJBQWUsa0JBYzlCLENBQUE7QUFFRCxnQkFBdUIsSUFBSSxFQUFFLFNBQW1CO0lBQzlDLElBQUksS0FBSyxHQUFHLFNBQVMsQ0FBQyxLQUFLLENBQUM7SUFDNUIsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3ZCLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxFQUFFLElBQUksS0FBSyxDQUFDO1FBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLFNBQUcsQ0FBQyxDQUFDLENBQUM7SUFDMUQsTUFBTSxDQUFDLElBQUksQ0FBQztBQUNkLENBQUM7QUFMZSxjQUFNLFNBS3JCLENBQUE7QUFFRCxzQkFBNkIsU0FBbUI7SUFDOUMsSUFBSSxLQUFLLEdBQUcsU0FBUyxDQUFDLEtBQUssQ0FBQztJQUM1QixHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsRUFBRSxJQUFJLEtBQUssQ0FBQztRQUFDLFNBQUcsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxTQUFHLENBQUMsQ0FBQyxDQUFDO0lBQzdELE9BQU8sQ0FBQyxHQUFHLENBQUMsb0JBQW9CLENBQUMsQ0FBQztJQUNsQyxHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsRUFBRSxJQUFJLEtBQUssQ0FBQztRQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQyxFQUFFLENBQUMsWUFBWSxPQUFPLENBQUMsS0FBSyxHQUFHLE9BQU8sR0FBRyxPQUFPLEVBQUUsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2pILE1BQU0sQ0FBQyxTQUFTLENBQUM7QUFDbkIsQ0FBQztBQU5lLG9CQUFZLGVBTTNCLENBQUE7QUFFRCxzQkFBNkIsU0FBbUI7SUFDOUMsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxTQUFTLENBQUMsS0FBSyxDQUFDO1FBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLFNBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUMzRSxDQUFDO0FBRmUsb0JBQVksZUFFM0IsQ0FBQTs7O0FDcjBCRCwyQkFBdUIsY0FBYyxDQUFDLENBQUE7QUFDdEMsc0JBQWdDLFNBQVMsQ0FBQyxDQUFBO0FBQzFDLElBQVksVUFBVSxXQUFNLFlBQVksQ0FBQyxDQUFBO0FBR3pDLE9BQU8sQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0FBQ25DLE9BQU8sQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDO0FBSTNDLG9CQUFvQixHQUFHLEVBQUUsSUFBSSxFQUFFLE9BQU87SUFDcEMsSUFBSSxLQUFLLEdBQUcsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyx3QkFBd0IsRUFBRSxNQUFNLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUM1RSxNQUFNLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFDckMsQ0FBQztBQUVELDBCQUEwQixFQUFFLEVBQUUsUUFBUTtJQUNwQyxFQUFFLENBQUMsU0FBUyxDQUFDO1FBQ1gsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNoQyx3Q0FBd0M7UUFDeEMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLGlCQUFpQixFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQzNCLElBQUksUUFBUSxHQUFHLEVBQUUsQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUNqQyxJQUFJLE9BQU8sR0FBRyxVQUFVLENBQUMsUUFBUSxFQUFFLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUNqRCxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBRSxRQUFRLENBQUMsTUFBTSxDQUFDLEtBQUssUUFBUTttQkFDbEQsUUFBUSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsTUFBTSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDO2dCQUN4RSxFQUFFLENBQUMsWUFBWSxDQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO2dCQUNuRCxFQUFFLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDOUMsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNOLElBQUksR0FBRyxHQUFHLEtBQUcsUUFBUSxHQUFHLE9BQU8sR0FBRyxRQUFVLENBQUM7Z0JBQzdDLEVBQUUsQ0FBQyxZQUFZLENBQUMsR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQy9DLEVBQUUsQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUM5QyxDQUFDO1FBQ0gsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sRUFBRSxDQUFDLFlBQVksQ0FBQyxLQUFHLFFBQVEsR0FBRyxRQUFVLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDaEQsSUFBSSxXQUFXLEdBQUcsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsR0FBRyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDckUsRUFBRSxDQUFDLFNBQVMsQ0FBQyxXQUFXLENBQUMsQ0FBQztRQUM1QixDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDO0FBRUQsNEJBQTRCLEVBQUUsRUFBRSxNQUFNO0lBQ3BDLEVBQUUsQ0FBQyxTQUFTLENBQUM7UUFDWCxJQUFJLElBQUksR0FBRyxFQUFFLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2hDLElBQUksRUFBRSxHQUFHLEVBQUUsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDNUIsSUFBSSxRQUFRLEdBQUcsRUFBRSxDQUFDO1FBQ2xCLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLElBQUksRUFBRSxNQUFNLElBQUksRUFBRSxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsRUFBRSxDQUFDO1lBQ3hELElBQUksYUFBYSxHQUFHLEVBQUUsQ0FBQyxRQUFRLENBQUMsRUFBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUMsRUFBRSxFQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLE1BQU0sQ0FBQyxNQUFNLEVBQUMsQ0FBQyxDQUFDO1lBQzFGLEVBQUUsQ0FBQSxDQUFDLGFBQWEsS0FBSyxNQUFNLElBQUksYUFBYSxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ3BELFFBQVEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDeEIsQ0FBQztRQUNILENBQUM7UUFFRCw2RUFBNkU7UUFDN0UsRUFBRSxDQUFBLENBQUMsUUFBUSxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzFCLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLElBQUksRUFBRSxNQUFNLElBQUksRUFBRSxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsRUFBRSxDQUFDO2dCQUN4RCxFQUFFLENBQUMsWUFBWSxDQUFDLEVBQUUsRUFBRSxFQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBQyxFQUFFLEVBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxFQUFFLEVBQUUsTUFBTSxDQUFDLE1BQU0sRUFBQyxDQUFDLENBQUM7WUFDL0UsQ0FBQztRQUNILENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLEdBQUcsQ0FBQSxDQUFlLFVBQVEsRUFBdEIsb0JBQVUsRUFBVixJQUFzQixDQUFDO2dCQUF2QixJQUFJLE1BQU0sR0FBSSxRQUFRLElBQVo7Z0JBQ1osRUFBRSxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsRUFBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUMsQ0FBQyxDQUFDO2FBQ2hEO1FBQ0gsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQUVELElBQUksV0FBVyxHQUFHO0lBQ2hCLE9BQU8sRUFBRSxVQUFDLEVBQUU7UUFDVixnQkFBZ0IsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUNELE9BQU8sRUFBRSxVQUFDLEVBQUU7UUFDVixnQkFBZ0IsQ0FBQyxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDNUIsQ0FBQztDQUNGLENBQUM7QUFFRjtJQWFFLHdCQUFZLElBQUksRUFBRSxPQUFPO1FBUHpCLFlBQVk7UUFDWixtQkFBYyxHQUFHLEdBQUcsQ0FBQztRQUNyQixxQkFBZ0IsR0FBRyxLQUFLLENBQUM7UUFDekIscUJBQWdCLEdBQVcsSUFBSSxDQUFDO1FBSzlCLElBQUksQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDO1FBQ2hCLElBQUksQ0FBQyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ2YsSUFBSSxTQUFTLEdBQUcsbUJBQVcsQ0FBQyxZQUFJLENBQUMsV0FBVyxDQUFDLEVBQUUsT0FBTyxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsQ0FBQztRQUNuRSxJQUFJLENBQUMsVUFBVSxHQUFzQixVQUFVLENBQUMsSUFBSSxFQUFFO1lBQ3BELElBQUksRUFBRSxLQUFLO1lBQ1gsWUFBWSxFQUFFLElBQUk7WUFDbEIsaUJBQWlCLEVBQUUsSUFBSTtZQUN2QixjQUFjLEVBQUUsUUFBUTtZQUN4QixXQUFBLFNBQVM7U0FDVixDQUFDLENBQUM7UUFDSCxJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBRXpCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQztRQUNoQixFQUFFLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxVQUFDLEVBQUUsRUFBRSxPQUFPO1lBQzNCLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQzVCLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO2dCQUNsQixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7WUFDMUMsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBQ0gsRUFBRSxDQUFDLEVBQUUsQ0FBQyxnQkFBZ0IsRUFBRSxVQUFDLEVBQUUsSUFBTyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxDQUFDLENBQUEsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMvRCxFQUFFLENBQUMsRUFBRSxDQUFDLFdBQVcsRUFBRSxVQUFDLEVBQUUsRUFBRSxDQUFDLElBQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUEsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzRCxFQUFFLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLEVBQUUsVUFBQyxDQUFDO1lBQ25ELElBQUksQ0FBQyxTQUFTLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3hCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELHNDQUFhLEdBQWI7UUFDRSxrQ0FBa0M7UUFDbEMsTUFBTSxDQUFDO1FBQ1AsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQztRQUM3QixJQUFJLFFBQVEsR0FBRyxJQUFJLHFCQUFRLEVBQUUsQ0FBQztRQUM5QixJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDO1FBQ3pCLElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDaEMsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNoQyxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzVCLElBQUksS0FBSyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQzNDLElBQUksR0FBRyxHQUFHLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1FBQzNCLEVBQUUsQ0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyxJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDLEVBQUUsQ0FBQztlQUM3QyxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDLEdBQUcsS0FBSyxFQUFFLENBQUMsWUFBWSxDQUFDLEVBQUUsRUFBRSxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDaEYsR0FBRyxHQUFHLEtBQUssQ0FBQyxHQUFHLEdBQUcsRUFBRSxDQUFDO1FBQ3ZCLENBQUM7UUFDRCxJQUFJLE9BQU8sR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDO1FBQ3RCLElBQUksSUFBSSxHQUFHLEVBQUMsQ0FBQyxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsK0JBQTRCLEtBQUssQ0FBQyxJQUFJLEdBQUcsT0FBTyxpQkFBVyxHQUFHLFFBQUssRUFBRSxRQUFRLEVBQUU7Z0JBQ2hILEVBQUMsQ0FBQyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxjQUFRLGtCQUFrQixDQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBQztnQkFDMUUsRUFBQyxDQUFDLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLGNBQVEsa0JBQWtCLENBQUMsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFDO2dCQUMzRSxFQUFDLENBQUMsRUFBRSxLQUFLLEVBQUM7Z0JBQ1YsRUFBQyxDQUFDLEVBQUUsYUFBYSxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLGNBQVEsZ0JBQWdCLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFDO2dCQUMzRSxFQUFDLENBQUMsRUFBRSxlQUFlLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsY0FBUSxnQkFBZ0IsQ0FBQyxFQUFFLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUM7Z0JBQzVFLEVBQUMsQ0FBQyxFQUFFLEtBQUssRUFBQztnQkFDVixFQUFDLENBQUMsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsY0FBUSxrQkFBa0IsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUM7Z0JBQ3pFLEVBQUMsQ0FBQyxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxjQUFRLGtCQUFrQixDQUFDLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBQztnQkFDM0UsRUFBQyxDQUFDLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLGNBQVEsa0JBQWtCLENBQUMsRUFBRSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFDO2dCQUM3RSxFQUFDLENBQUMsRUFBRSxLQUFLLEVBQUM7Z0JBQ1YsRUFBQyxDQUFDLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUM7YUFDN0IsRUFBQyxDQUFDO1FBQ0gsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDeEIsSUFBSSxJQUFJLEdBQVksUUFBUSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUM7UUFDaEQsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksQ0FBQztRQUM3QixFQUFFLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekMsd0NBQXdDO0lBQzFDLENBQUM7SUFFRCxzQ0FBYSxHQUFiO1FBQ0UsSUFBSSxDQUFDLGdCQUFnQixHQUFHLEtBQUssQ0FBQztRQUM5QixJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUNwRSxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDO0lBQy9CLENBQUM7SUFFRCxrQ0FBUyxHQUFULFVBQVUsRUFBRSxFQUFFLE9BQU87UUFDbkIsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDO0lBQ2xCLENBQUM7SUFFRCx5Q0FBZ0IsR0FBaEIsVUFBaUIsRUFBRTtRQUNqQixFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLElBQUksQ0FBQyxFQUFFLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDcEQsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3ZCLENBQUM7SUFDSCxDQUFDO0lBRUQsa0NBQVMsR0FBVCxVQUFVLEVBQUUsRUFBRSxDQUFDO1FBQ2IsRUFBRSxDQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO1lBQzFCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQztZQUNoQixZQUFZLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQzNCLElBQUksQ0FBQyxPQUFPLEdBQUcsVUFBVSxDQUFDO2dCQUN4QixFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsaUJBQWlCLEVBQUUsQ0FBQyxDQUFDLENBQUM7b0JBQzNCLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztnQkFDdkIsQ0FBQztZQUNILENBQUMsRUFBRSxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDMUIsQ0FBQztJQUNILENBQUM7SUFFRCxvQ0FBVyxHQUFYLFVBQVksRUFBRSxFQUFFLENBQUM7UUFDZixJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUMsVUFBVSxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1FBQ2hFLElBQUksR0FBRyxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDbEMsSUFBSSxLQUFLLEdBQUcsRUFBRSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNyQyxDQUFDO0lBRUQsZ0NBQU8sR0FBUCxVQUFRLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxJQUFLO1FBQ25DLElBQUksRUFBRSxHQUFPLElBQUksQ0FBQyxVQUFVLENBQUM7UUFDN0IsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUNyQixJQUFJLEdBQUcsQ0FBQztRQUNSLEVBQUUsQ0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNULEdBQUcsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3BDLEdBQUcsQ0FBQyxFQUFFLEdBQU0sTUFBTSxTQUFJLE1BQU0sZUFBWSxDQUFDO1FBQzNDLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLEdBQUcsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDO1lBQ3hCLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNmLENBQUM7UUFDRCxJQUFJLE9BQU8sR0FBRyxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFDLFlBQVksRUFBRSxHQUFHLEVBQUMsQ0FBQyxDQUFDO1FBQzNGLE9BQU8sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQ3BCLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxPQUFPLENBQUM7UUFDdEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxPQUFPLENBQUM7SUFDL0IsQ0FBQztJQUVILHFCQUFDO0FBQUQsQ0EvSEEsQUErSEMsSUFBQTtBQS9IWSxzQkFBYyxpQkErSDFCLENBQUE7QUFFRCxzQkFBNkIsSUFBSSxFQUFFLElBQUk7SUFDckMsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sSUFBSSxFQUFFLENBQUM7SUFDakMsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUN6QixJQUFJLEVBQU0sQ0FBQztJQUNYLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUNaLE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksY0FBYyxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztRQUN6RCxFQUFFLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUM7UUFDNUIsRUFBRSxDQUFBLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNwQixFQUFFLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDYixDQUFDO1FBQ0QsRUFBRSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsOEVBQThFO0lBQzlGLENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNOLEVBQUUsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQztJQUM5QixDQUFDO0lBQ0QsTUFBTSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDO0lBQ2hDLE1BQU0sQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ3ZDLElBQUksR0FBRyxHQUFHLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUN0QixFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDbEMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQy9CLEdBQUcsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNuQixHQUFHLENBQUMsU0FBUyxDQUFDLEVBQUMsSUFBSSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFDLENBQUMsQ0FBQztJQUNsQyxDQUFDO0lBQ0QsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDZCxFQUFFLENBQUMsU0FBUyxDQUFDO1lBQ1gsSUFBSSxPQUFPLEdBQUcsRUFBRSxDQUFDO1lBQ2pCLEdBQUcsQ0FBQSxDQUFhLFVBQVUsRUFBVixLQUFBLElBQUksQ0FBQyxLQUFLLEVBQXRCLGNBQVEsRUFBUixJQUFzQixDQUFDO2dCQUF2QixJQUFJLElBQUksU0FBQTtnQkFDVixPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQztnQkFDeEIsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQ2pDLElBQUksR0FBRyxHQUFHLEtBQUssQ0FBQztnQkFDaEIsRUFBRSxDQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO29CQUNULEdBQUcsR0FBRyxJQUFJLENBQUM7Z0JBQ2IsQ0FBQztnQkFBQyxJQUFJLENBQUMsQ0FBQztvQkFDTixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7b0JBQ3hCLEVBQUUsQ0FBQSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQzt3QkFDVixHQUFHLEdBQUcsSUFBSSxDQUFDO29CQUNiLENBQUM7b0JBQUMsSUFBSSxDQUFDLENBQUM7d0JBQ04sb0VBQW9FO3dCQUNwRSxJQUFLLElBQUksR0FBUSxLQUFLLE9BQVgsRUFBRSxHQUFJLEtBQUssR0FBQSxDQUFDO3dCQUN2QixFQUFFLENBQUEsQ0FBQyxFQUFFLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsS0FBSyxJQUFJLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxLQUFLLEtBQUssRUFBRSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7NEJBQ2hGLEdBQUcsR0FBRyxJQUFJLENBQUM7d0JBQ2IsQ0FBQztvQkFDSCxDQUFDO2dCQUNILENBQUM7Z0JBQ0QsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztvQkFDUCxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO2dCQUN4RixDQUFDO2FBQ0Y7WUFDRCxHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsTUFBTSxJQUFJLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUMvQixFQUFFLENBQUEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ3BCLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7b0JBQzdCLE9BQU8sTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDOUIsQ0FBQztZQUNILENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7QUFDSCxDQUFDO0FBdkRlLG9CQUFZLGVBdUQzQixDQUFBO0FBR0QsVUFBVSxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUU7SUFDM0IsTUFBTSxDQUFDO1FBQ0wsVUFBVSxFQUFFO1lBQ1YsTUFBTSxDQUFDLEVBQUUsQ0FBQztRQUNaLENBQUM7UUFDRCxLQUFLLEVBQUUsVUFBUyxNQUFNLEVBQUUsS0FBSztZQUMzQixFQUFFLENBQUEsQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLElBQUksTUFBTSxDQUFDLElBQUksRUFBRSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ3pDLEtBQUssQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO2dCQUNwQixNQUFNLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNyQixLQUFLLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQyxNQUFNLENBQUM7Z0JBQzFDLE1BQU0sQ0FBQyx1Q0FBcUMsS0FBSyxDQUFDLFNBQVcsQ0FBQztZQUNoRSxDQUFDO1lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO2dCQUN2QixNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7Z0JBQ25CLEtBQUssQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO2dCQUNyQixNQUFNLENBQUMsbUJBQWlCLEtBQUssQ0FBQyxTQUFXLENBQUM7WUFDNUMsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNOLEtBQUssQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO2dCQUNyQixNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDckIsQ0FBQztRQUNILENBQUM7S0FDRixDQUFDO0FBQ0osQ0FBQyxDQUFDLENBQUM7QUFFSCxVQUFVLENBQUMsVUFBVSxDQUFDLFlBQVksRUFBRSxLQUFLLENBQUMsQ0FBQzs7O0FDNVIzQyxzQkFBd0IsU0FBUyxDQUFDLENBQUE7QUFNbEMsSUFBSSxPQUFPLEdBQUcsT0FBTyxDQUFDO0FBRVgsa0JBQVUsR0FBRyxnQkFBZ0IsQ0FBQztBQUM5QixtQkFBVyxHQUFHLEtBQUssQ0FBQztBQUUvQiwwQkFBMEIsQ0FBcUIsRUFBRSxDQUFxQjtJQUNwRSxJQUFJLEtBQUssR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzNCLEdBQUcsQ0FBQSxDQUFZLFVBQUssRUFBaEIsaUJBQU8sRUFBUCxJQUFnQixDQUFDO1FBQWpCLElBQUksR0FBRyxHQUFJLEtBQUssSUFBVDtRQUNULGdDQUFnQztRQUNoQyxFQUFFLENBQUEsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztLQUNwQztJQUNELE1BQU0sQ0FBQyxJQUFJLENBQUM7QUFDZCxDQUFDO0FBRUQscUJBQXFCLFFBQVEsRUFBRSxNQUFNO0lBQ25DLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNYLEdBQUcsQ0FBQSxDQUFhLFVBQVEsRUFBcEIsb0JBQVEsRUFBUixJQUFvQixDQUFDO1FBQXJCLElBQUksSUFBSSxHQUFJLFFBQVEsSUFBWjtRQUNWLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDN0IsTUFBTSxDQUFDLEVBQUUsQ0FBQztRQUNaLENBQUM7UUFDRCxFQUFFLEVBQUUsQ0FBQztLQUNOO0lBQ0QsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ1osQ0FBQztBQUVELG9CQUEyQixRQUFRLEVBQUUsTUFBTTtJQUN6QyxJQUFJLEVBQUUsR0FBRyxXQUFXLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3ZDLEVBQUUsQ0FBQSxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQztRQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ25DLE1BQU0sQ0FBQyxRQUFRLENBQUM7QUFDbEIsQ0FBQztBQUplLGtCQUFVLGFBSXpCLENBQUE7QUFFRCw0QkFBNEIsSUFBSSxFQUFFLE9BQU87SUFDdkMsSUFBSSxTQUFTLEdBQUcsRUFBRSxDQUFDO0lBQ25CLElBQUksVUFBVSxHQUFHLEVBQUUsQ0FBQztJQUNwQixJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUM7SUFDaEIsR0FBRyxDQUFBLENBQVksVUFBSSxFQUFmLGdCQUFPLEVBQVAsSUFBZSxDQUFDO1FBQWhCLElBQUksR0FBRyxHQUFJLElBQUksSUFBUjtRQUNULElBQUksSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7UUFDcEIsRUFBRSxDQUFBLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7WUFDakMsU0FBUyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNwQixVQUFVLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDO1lBQ3ZCLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDcEIsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7UUFDcEIsQ0FBQztRQUNELEdBQUcsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0tBQ2pCO0lBQ0QsR0FBRyxDQUFBLENBQWUsVUFBTyxFQUFyQixtQkFBVSxFQUFWLElBQXFCLENBQUM7UUFBdEIsSUFBSSxNQUFNLEdBQUksT0FBTyxJQUFYO1FBQ1osSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQztRQUN2QixFQUFFLENBQUEsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztZQUNqQyxTQUFTLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDckIsVUFBVSxDQUFDLElBQUksQ0FBQyxHQUFHLE1BQU0sQ0FBQztZQUMxQixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BCLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLFNBQVMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1FBQ3BCLENBQUM7UUFDRCxNQUFNLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztLQUNwQjtJQUNELElBQUksUUFBUSxHQUFHLEVBQUUsQ0FBQztJQUNsQixJQUFJLFdBQVcsR0FBRyxFQUFFLENBQUM7SUFDckIsR0FBRyxDQUFBLENBQWEsVUFBTSxFQUFsQixrQkFBUSxFQUFSLElBQWtCLENBQUM7UUFBbkIsSUFBSSxJQUFJLEdBQUksTUFBTSxJQUFWO1FBQ1YsSUFBSSxLQUFLLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzVCLEVBQUUsQ0FBQSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2IsSUFBSSxJQUFJLEdBQUcsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzVCLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdEIsQ0FBQztRQUFDLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNwQixJQUFJLElBQUksR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDNUIsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN6QixDQUFDO0tBQ0Y7SUFDRCxNQUFNLENBQUMsRUFBQyxJQUFJLEVBQUMsUUFBUSxFQUFFLE9BQU8sRUFBQyxXQUFXLEVBQUMsQ0FBQztBQUM5QyxDQUFDO0FBRUQsNEJBQTRCLElBQUk7SUFDOUIsTUFBTSxDQUFDLElBQUksUUFBUSxDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUcsWUFBVSxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQVMsR0FBRyxFQUFFLEVBQUU7UUFDaEUsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLFdBQVcsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQzdCLE1BQU0sQ0FBQyxRQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsWUFBTyxHQUFHLENBQUMsQ0FBQyxDQUFDLGtCQUFhLEdBQUcsQ0FBQyxDQUFDLENBQUMsWUFBTyxHQUFHLENBQUMsQ0FBQyxDQUFDLE9BQUksQ0FBQztRQUN2RSxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixNQUFNLENBQUMsU0FBTSxHQUFHLG9CQUFhLEdBQUcsUUFBSSxDQUFDO1FBQ3ZDLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQUcsQ0FBQyxDQUFBO0FBQ3JCLENBQUM7QUFFRCwwQkFBMEIsSUFBSTtJQUM1QixJQUFJLFVBQVUsR0FBRyxFQUFFLENBQUM7SUFDcEIsR0FBRyxDQUFBLENBQVksVUFBSSxFQUFmLGdCQUFPLEVBQVAsSUFBZSxDQUFDO1FBQWhCLElBQUksR0FBRyxHQUFJLElBQUksSUFBUjtRQUNULEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQztZQUM3QixVQUFVLENBQUMsSUFBSSxDQUFDLFFBQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxZQUFPLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBSSxDQUFDLENBQUM7UUFDakQsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sVUFBVSxDQUFDLElBQUksQ0FBQyxRQUFNLEdBQUcsT0FBSSxDQUFDLENBQUM7UUFDakMsQ0FBQztLQUNGO0lBQ0QsSUFBSSxLQUFLLEdBQUcsVUFBVSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUN6QyxNQUFNLENBQUMsSUFBSSxRQUFRLENBQUMsR0FBRyxFQUFHLFlBQVUsS0FBSyxNQUFHLENBQUMsQ0FBQztBQUNoRCxDQUFDO0FBRUQsdUNBQXVDLGVBQWUsRUFBRSxLQUFLO0lBQzNELElBQUksVUFBVSxHQUFHLEVBQUUsQ0FBQztJQUNwQixJQUFJLElBQUksR0FBRyxFQUFFLENBQUM7SUFDZCxJQUFJLFFBQVEsR0FBRyxlQUFlLENBQUM7SUFDL0IsR0FBRyxDQUFBLENBQWEsVUFBSyxFQUFqQixpQkFBUSxFQUFSLElBQWlCLENBQUM7UUFBbEIsSUFBSSxJQUFJLEdBQUksS0FBSyxJQUFUO1FBQ1YsSUFBSSxTQUFTLEdBQUcsRUFBRSxDQUFDO1FBQ25CLEdBQUcsQ0FBQSxDQUFhLFVBQUksRUFBaEIsZ0JBQVEsRUFBUixJQUFnQixDQUFDO1lBQWpCLElBQUksSUFBSSxHQUFJLElBQUksSUFBUjtZQUNWLElBQUssT0FBSyxHQUFTLElBQUksS0FBWCxLQUFHLEdBQUksSUFBSSxHQUFBLENBQUM7WUFDeEIsU0FBUyxJQUFJLG9CQUFpQixRQUFRLEdBQUcsT0FBSyxZQUFNLEtBQUcsbUJBQWMsT0FBSyxVQUFLLEtBQUcsV0FBUSxDQUFDO1NBQzVGO1FBQ0QsSUFBSyxLQUFLLEdBQWMsSUFBSSxLQUFoQixHQUFHLEdBQVMsSUFBSSxLQUFYLEdBQUcsR0FBSSxJQUFJLEdBQUEsQ0FBQztRQUM3QixJQUFJLEVBQUUsR0FBRyxHQUFHLENBQUM7UUFDYixFQUFFLENBQUEsQ0FBQyxHQUFHLEtBQUssWUFBWSxDQUFDLENBQUMsQ0FBQztZQUN4QixFQUFFLEdBQUcsR0FBRyxDQUFDO1FBQ1gsQ0FBQztRQUNELFNBQVMsSUFBSSxvQkFBaUIsUUFBUSxHQUFHLEtBQUssWUFBTSxHQUFHLFdBQU0sRUFBRSxhQUFRLEtBQUssVUFBSyxHQUFHLE9BQUksQ0FBQztRQUN6RixVQUFVLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzNCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7S0FDakI7SUFDRCxJQUFJLEtBQUssR0FBRyxFQUFFLENBQUM7SUFDZixJQUFJLFlBQVksR0FBRyxFQUFFLENBQUM7SUFDdEIsSUFBSSxlQUFlLEdBQUcsRUFBRSxDQUFDO0lBQ3pCLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxFQUFFLEVBQUUsR0FBRyxRQUFRLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQztRQUNwQyxLQUFLLENBQUMsSUFBSSxDQUFDLFNBQU8sRUFBRSx5QkFBb0IsRUFBRSxNQUFHLENBQUMsQ0FBQztRQUMvQyxZQUFZLENBQUMsSUFBSSxDQUFDLG1CQUFpQixFQUFFLDZCQUF1QixRQUFRLEdBQUcsRUFBRSxPQUFHLENBQUMsQ0FBQztRQUM5RSxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUMsbUJBQWlCLEVBQUUsZ0JBQVcsRUFBSSxDQUFDLENBQUMsQ0FBQztJQUM3RCxDQUFDO0lBQ0QsTUFBTSxDQUFDLDZEQUEyRCxRQUFRLDhCQUN6RCxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyw0QkFDakIsUUFBUSxHQUFHLENBQUMsY0FBUSxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBVyxRQUFRLHFCQUN0RSxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyx5QkFFMUIsZUFBZSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsVUFDL0IsQ0FBQztBQUNMLENBQUM7QUFFRCwyQkFBMkIsSUFBSTtJQUM3QixJQUFJLElBQUksR0FBRyx1QkFBdUIsQ0FBQztJQUNuQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDWCxJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUM7SUFDaEIsSUFBSSxPQUFPLEdBQUcsaUJBQWlCLENBQUM7SUFDaEMsR0FBRyxDQUFBLENBQVksVUFBSSxFQUFmLGdCQUFPLEVBQVAsSUFBZSxDQUFDO1FBQWhCLElBQUksR0FBRyxHQUFJLElBQUksSUFBUjtRQUNULEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQztZQUM3QixPQUFPLElBQUksY0FBWSxHQUFHLENBQUMsQ0FBQyxDQUFDLFlBQU8sR0FBRyxDQUFDLENBQUMsQ0FBQyxRQUFLLENBQUM7UUFDbEQsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sT0FBTyxJQUFJLGNBQVksR0FBRyxRQUFLLENBQUM7UUFDbEMsQ0FBQztLQUNGO0lBQ0QsT0FBTyxJQUFJLHFDQUFxQyxDQUFDO0lBQ2pELEdBQUcsQ0FBQSxDQUFZLFVBQUksRUFBZixnQkFBTyxFQUFQLElBQWUsQ0FBQztRQUFoQixJQUFJLEdBQUcsR0FBSSxJQUFJLElBQVI7UUFDVCxFQUFFLEVBQUUsQ0FBQztRQUNMLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQztZQUM3QixNQUFNLElBQUksa0JBQWdCLEdBQUcsQ0FBQyxDQUFDLENBQUMsWUFBTyxHQUFHLENBQUMsQ0FBQyxDQUFDLFNBQU0sQ0FBQztRQUN0RCxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixNQUFNLElBQUksa0JBQWdCLEdBQUcsU0FBTSxDQUFDO1FBQ3RDLENBQUM7UUFDRCxJQUFJLElBQUksR0FBRyxlQUFlLENBQUM7UUFDM0IsTUFBTSxJQUFJLFNBQU8sSUFBSSxVQUFLLElBQUksUUFBSyxDQUFDO1FBQ3BDLEVBQUUsQ0FBQSxDQUFDLEVBQUUsS0FBSyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUN0QixNQUFNLElBQUksTUFBTSxDQUFDO1FBQ25CLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLE1BQU0sSUFBSSxNQUFNLENBQUM7UUFDbkIsQ0FBQztRQUNELE1BQU0sSUFBSSxjQUFZLElBQUksT0FBSSxDQUFDO0tBQ2hDO0lBQ0QsSUFBSSxJQUFJLDJGQUdSLE9BQU8seUhBTVAsTUFBTSwwQ0FFTSxDQUFBO0lBQ1osTUFBTSxDQUFDLENBQUMsSUFBSSxRQUFRLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7QUFDeEUsQ0FBQztBQUVELDRCQUE0QixJQUFJO0lBQzlCLElBQUksU0FBUyxHQUFHLEVBQUUsQ0FBQztJQUNuQixHQUFHLENBQUEsQ0FBWSxVQUFJLEVBQWYsZ0JBQU8sRUFBUCxJQUFlLENBQUM7UUFBaEIsSUFBSSxHQUFHLEdBQUksSUFBSSxJQUFSO1FBQ1QsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLFdBQVcsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQzdCLFNBQVMsQ0FBQyxJQUFJLENBQUMsVUFBUSxHQUFHLENBQUMsQ0FBQyxDQUFDLFlBQU8sR0FBRyxDQUFDLENBQUMsQ0FBQyxPQUFJLENBQUMsQ0FBQztRQUNsRCxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVEsR0FBRyxPQUFJLENBQUMsQ0FBQztRQUNsQyxDQUFDO0tBQ0Y7SUFDRCxJQUFJLElBQUksR0FBRyxreEJBdUJtQixTQUFTLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyx5S0FNekMsQ0FBQztJQUNmLE1BQU0sQ0FBQyxJQUFJLFFBQVEsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDbkUsQ0FBQztBQUVELHFCQUFxQixFQUFFLEVBQUUsRUFBRTtJQUN6QixJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsTUFBTSxDQUFDO0lBQ25CLElBQUksS0FBSyxHQUFHLEVBQUUsQ0FBQztJQUNmLEdBQUcsQ0FBQSxDQUFVLFVBQUUsRUFBWCxjQUFLLEVBQUwsSUFBVyxDQUFDO1FBQVosSUFBSSxDQUFDLEdBQUksRUFBRSxJQUFOO1FBQ1AsRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxFQUFFLEdBQUcsS0FBSyxDQUFDLENBQUM7UUFDeEIsRUFBRSxFQUFFLENBQUM7S0FDTjtJQUNELE1BQU0sQ0FBQyxFQUFFLENBQUM7QUFDWixDQUFDO0FBRUQ7SUFLRSxjQUFZLElBQUk7UUFDZCxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQztRQUNqQixJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztRQUNoQixJQUFJLENBQUMsSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUNqQixDQUFDO0lBQ0QsMEJBQVcsR0FBWCxVQUFZLEtBQUs7UUFDZixJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ25DLEVBQUUsQ0FBQSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztZQUNkLFNBQVMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUMsSUFBSSxFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsRUFBRSxFQUFDLENBQUM7UUFDM0QsQ0FBQztRQUNELE1BQU0sQ0FBQyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUNELGtCQUFHLEdBQUgsVUFBSSxLQUFLLEVBQUUsR0FBRztRQUNaLElBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDeEMsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ2QsU0FBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDekIsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUM7SUFDRCxzQkFBTyxHQUFQLFVBQVEsS0FBSyxFQUFFLElBQUk7UUFDakIsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN4QyxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDM0IsV0FBVyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDbEMsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUM7SUFDRCwwQkFBVyxHQUFYLFVBQVksS0FBSyxFQUFFLElBQUk7UUFDckIsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN4QyxJQUFJLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUM7UUFDM0IsV0FBVyxDQUFDLFNBQVMsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDckMsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUM7SUFDRCxxQkFBTSxHQUFOLFVBQU8sS0FBSyxFQUFFLEtBQU07UUFDbEIsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN4QyxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDekMsSUFBSSxDQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsTUFBTSxDQUFDO1FBQzVCLFdBQVcsQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3RDLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQ0Qsb0JBQUssR0FBTCxVQUFNLElBQUk7UUFDUixHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQzdCLElBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbkMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3BDLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM3QyxDQUFDO1FBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUM7SUFDRCxzQkFBTyxHQUFQO1FBQ0UsSUFBSSxRQUFRLEdBQUcsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ25DLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDN0IsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUM5QixRQUFRLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDdEMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pDLENBQUM7UUFDRCxNQUFNLENBQUMsUUFBUSxDQUFDO0lBQ2xCLENBQUM7SUFDSCxXQUFDO0FBQUQsQ0E1REEsQUE0REMsSUFBQTtBQTVEWSxZQUFJLE9BNERoQixDQUFBO0FBRUQ7SUFJRTtRQUNFLElBQUksQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDO1FBQ3JCLElBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO0lBQ3RCLENBQUM7SUFDRCwwQkFBUSxHQUFSLFVBQVMsSUFBSSxFQUFFLElBQVM7UUFBVCxvQkFBUyxHQUFULFNBQVM7UUFDdEIsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM5QixJQUFJLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFDLEdBQUcsSUFBSyxPQUFBLEdBQUcsS0FBSyxNQUFNLEVBQWQsQ0FBYyxDQUFDLENBQUM7UUFDNUMsRUFBRSxDQUFBLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ3hCLEtBQUssQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDO1lBQ3BCLEtBQUssQ0FBQyxTQUFTLEdBQUcsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDM0MsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBQyxLQUFLLEVBQUUsRUFBRSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsRUFBRSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLEVBQUUsU0FBUyxFQUFFLEVBQUUsRUFBQyxDQUFDO1lBQy9KLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDO1FBQzlCLENBQUM7UUFDRCxHQUFHLENBQUEsQ0FBWSxVQUFJLEVBQWYsZ0JBQU8sRUFBUCxJQUFlLENBQUM7WUFBaEIsSUFBSSxHQUFHLEdBQUksSUFBSSxJQUFSO1lBQ1QsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLFdBQVcsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUM3QixLQUFLLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQztZQUNoQyxDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ04sS0FBSyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUM7WUFDN0IsQ0FBQztTQUNGO1FBQ0QsTUFBTSxDQUFDLEtBQUssQ0FBQztJQUNmLENBQUM7SUFDRCw0QkFBVSxHQUFWLFVBQVcsSUFBSTtRQUNiLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDOUIsRUFBRSxDQUFBLENBQUMsQ0FBQyxLQUFLLENBQUM7WUFBQyxNQUFNLENBQUM7UUFFbEIsS0FBSyxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7UUFDakIsS0FBSyxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7UUFDcEIsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLFNBQVMsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNuQyxLQUFLLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7WUFDcEMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxLQUFLLEdBQUcsRUFBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUMsQ0FBQztRQUNwRCxDQUFDO0lBQ0gsQ0FBQztJQUNELDZCQUFXLEdBQVgsVUFBWSxPQUFPLEVBQUUsSUFBSSxFQUFFLE9BQU87UUFDaEMsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNqQyxFQUFFLENBQUEsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUNsQyxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLElBQUksT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BDLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDdkQsQ0FBQztRQUNELElBQUksU0FBUyxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUM7UUFDaEMsSUFBSSxLQUFLLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQztRQUN4QixJQUFJLFFBQVEsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDO1FBQzlCLElBQUksUUFBUSxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUM7UUFDOUIsSUFBSSxTQUFTLEdBQUcsRUFBRSxDQUFDO1FBQ25CLElBQUksVUFBVSxHQUFHLEVBQUUsQ0FBQztRQUNwQixJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUM7UUFDaEIsR0FBRyxDQUFBLENBQVksVUFBSSxFQUFmLGdCQUFPLEVBQVAsSUFBZSxDQUFDO1lBQWhCLElBQUksR0FBRyxHQUFJLElBQUksSUFBUjtZQUNULElBQUksSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLElBQUksU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3RDLEVBQUUsQ0FBQSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO2dCQUNqQyxTQUFTLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNwQixVQUFVLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDO2dCQUN2QixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3BCLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixTQUFTLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUNwQixDQUFDO1lBQ0QsR0FBRyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7U0FDakI7UUFDRCxHQUFHLENBQUEsQ0FBZSxVQUFPLEVBQXJCLG1CQUFVLEVBQVYsSUFBcUIsQ0FBQztZQUF0QixJQUFJLE1BQU0sR0FBSSxPQUFPLElBQVg7WUFDWixJQUFJLElBQUksR0FBRyxNQUFNLENBQUMsSUFBSSxJQUFJLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUM1QyxFQUFFLENBQUEsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztnQkFDakMsU0FBUyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUNyQixVQUFVLENBQUMsSUFBSSxDQUFDLEdBQUcsTUFBTSxDQUFDO2dCQUMxQixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3BCLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixTQUFTLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUNwQixDQUFDO1lBQ0QsTUFBTSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7U0FDcEI7UUFDRCxJQUFJLFFBQVEsR0FBRyxFQUFFLENBQUM7UUFDbEIsSUFBSSxXQUFXLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLEdBQUcsQ0FBQSxDQUFhLFVBQU0sRUFBbEIsa0JBQVEsRUFBUixJQUFrQixDQUFDO1lBQW5CLElBQUksSUFBSSxHQUFJLE1BQU0sSUFBVjtZQUNWLElBQUksS0FBSyxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM1QixFQUFFLENBQUEsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDaEMsSUFBSSxJQUFJLEdBQUcsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUM1QixRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNwQixLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNqQixRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDO2dCQUN0QixRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7WUFDcEMsQ0FBQztZQUFDLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3RDLElBQUksSUFBSSxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDNUIsSUFBSSxFQUFFLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUN4QixtREFBbUQ7Z0JBQ25ELElBQUksUUFBUSxHQUFHLEtBQUssQ0FBQyxHQUFHLEVBQUUsQ0FBQztnQkFDM0IsRUFBRSxDQUFBLENBQUMsUUFBUSxJQUFJLFFBQVEsQ0FBQyxJQUFJLEtBQUssSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7b0JBQzNDLEtBQUssQ0FBQyxFQUFFLENBQUMsR0FBRyxRQUFRLENBQUM7b0JBQ3JCLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO2dCQUMvQixDQUFDO2dCQUNELFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ3ZCLE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUN0QixPQUFPLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN4QixDQUFDO1NBQ0Y7UUFDRCxNQUFNLENBQUMsRUFBQyxJQUFJLEVBQUMsUUFBUSxFQUFFLE9BQU8sRUFBQyxXQUFXLEVBQUMsQ0FBQztJQUM5QyxDQUFDO0lBRUQsMkJBQVMsR0FBVCxVQUFVLElBQUk7UUFDWixNQUFNLENBQUM7WUFDTCxLQUFLLEVBQUUsRUFBRTtZQUNULEtBQUssRUFBRSxFQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBQztZQUN2QixNQUFNLEVBQUUsZ0JBQWdCLENBQUMsSUFBSSxDQUFDO1lBQzlCLE9BQU8sRUFBRSxrQkFBa0IsQ0FBQyxJQUFJLENBQUM7U0FDbEMsQ0FBQTtJQUNILENBQUM7SUFDRCw2QkFBVyxHQUFYLFVBQVksS0FBSyxFQUFFLElBQUk7UUFDckIsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM3QixFQUFFLENBQUEsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7WUFBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUM1QyxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNwQyxJQUFJLE1BQU0sR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUM3QyxFQUFFLENBQUEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ1YsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN4QixDQUFDO1FBQ0QsTUFBTSxDQUFDLEVBQUUsQ0FBQztJQUNaLENBQUM7SUFDRCwwQkFBUSxHQUFSLFVBQVMsSUFBVTtRQUNqQixJQUFJLFFBQVEsR0FBRyxFQUFFLENBQUM7UUFDbEIsSUFBSSxTQUFTLEdBQUcsRUFBRSxDQUFDO1FBQ25CLElBQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3hDLEdBQUcsQ0FBQSxDQUFnQixVQUFRLEVBQXZCLG9CQUFXLEVBQVgsSUFBdUIsQ0FBQztZQUF4QixJQUFJLE9BQU8sR0FBSSxRQUFRLElBQVo7WUFDYixJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3JDLEVBQUUsQ0FBQSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxLQUFLLENBQUMsSUFBSSxTQUFTLENBQUMsT0FBTyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUM7Z0JBQUMsUUFBUSxDQUFDO1lBQzNFLElBQUksUUFBUSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsT0FBTyxFQUFFLFNBQVMsQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQzVFLDhDQUE4QztZQUM5QyxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ2pDLElBQUksT0FBTyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3pDLEdBQUcsQ0FBQSxDQUFrQixVQUFPLEVBQXhCLG1CQUFhLEVBQWIsSUFBd0IsQ0FBQztnQkFBekIsSUFBSSxTQUFTLEdBQUksT0FBTyxJQUFYO2dCQUNmLElBQUksS0FBSyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7Z0JBQ3JDLEtBQUssQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO2FBQzFFO1lBQ0QsSUFBSSxXQUFXLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDOUMsR0FBRyxDQUFBLENBQW9CLFVBQVcsRUFBOUIsdUJBQWUsRUFBZixJQUE4QixDQUFDO2dCQUEvQixJQUFJLFdBQVcsR0FBSSxXQUFXLElBQWY7Z0JBQ2pCLElBQUksT0FBTyxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBQzFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsR0FBRyxPQUFPLENBQUM7YUFDakM7WUFDRCxTQUFTLENBQUMsT0FBTyxDQUFDLEdBQUcsUUFBUSxDQUFDO1NBQy9CO1FBQ0QsTUFBTSxDQUFDLEVBQUMsVUFBQSxRQUFRLEVBQUUsV0FBQSxTQUFTLEVBQUMsQ0FBQztJQUMvQixDQUFDO0lBQ0QsNkJBQVcsR0FBWCxVQUFZLE9BQU87UUFDakIsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDcEMsK0VBQStFO1FBQy9FLGdGQUFnRjtRQUNoRiwrRUFBK0U7UUFDL0Usb0ZBQW9GO1FBQ3BGLHlCQUF5QjtRQUN6QixJQUFJLEtBQWlELENBQUMsS0FBSyxDQUFDLElBQUksR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLG1CQUEzRyxPQUFPLG1CQUFHLFNBQVMsNEJBQUUsV0FBVyxtQkFBRyxTQUFTLEtBQStELENBQUM7UUFDakgsRUFBRSxDQUFBLENBQUMsQ0FBQyxPQUFPLENBQUM7WUFBQyxNQUFNLENBQUM7UUFDcEIsSUFBSSxXQUFXLEdBQUcsS0FBSyxDQUFDLFFBQVEsQ0FBQztRQUNqQyxJQUFJLFVBQVUsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzFDLEtBQUssQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1FBQ2hDLEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDWCxJQUFJLElBQUksR0FBRyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMxQixJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM5QixJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDcEMsSUFBSyxRQUFRLEdBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBQSxDQUFDO1lBQ3JDLElBQUksU0FBUyxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUM7WUFDL0IsRUFBRSxDQUFBLENBQUMsVUFBVSxDQUFDLE1BQU0sS0FBSyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7Z0JBQ3ZELElBQUksSUFBSSxHQUFHLElBQUksQ0FBQztnQkFDaEIsR0FBRyxDQUFBLENBQWEsVUFBVSxFQUF0QixzQkFBUSxFQUFSLElBQXNCLENBQUM7b0JBQXZCLElBQUksSUFBSSxHQUFJLFVBQVUsSUFBZDtvQkFDVixFQUFFLENBQUEsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ3BCLElBQUksR0FBRyxLQUFLLENBQUM7d0JBQ2IsS0FBSyxDQUFDO29CQUNSLENBQUM7aUJBQ0Y7Z0JBQ0QsTUFBTSxDQUFDLElBQUksR0FBRyxTQUFTLEdBQUcsUUFBUSxDQUFDO1lBQ3JDLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixNQUFNLENBQUMsUUFBUSxDQUFDO1lBQ2xCLENBQUM7UUFDSCxDQUFDO1FBQ0QsTUFBTSxDQUFDO0lBQ1QsQ0FBQztJQUNELDJDQUF5QixHQUF6QixVQUEwQixnQkFBZ0I7UUFDeEMsSUFBSSxPQUFPLEdBQUcsRUFBRSxDQUFDO1FBQ2pCLElBQUksU0FBUyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUU5QyxHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLENBQUMsRUFBRSxFQUFFLEdBQUcsU0FBUyxDQUFDLE1BQU0sRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDO1lBQzVDLElBQUksT0FBTyxHQUFHLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUM1QixFQUFFLENBQUEsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQUMsUUFBUSxDQUFDO1lBQzlCLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDekIsT0FBTyxDQUFDLE9BQU8sQ0FBQyxHQUFHLElBQUksQ0FBQztZQUN4QixTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFFN0UsQ0FBQztRQUNELE1BQU0sQ0FBQyxPQUFPLENBQUM7SUFDakIsQ0FBQztJQUNELDhCQUFZLEdBQVosVUFBYSxRQUFRO1FBQ25CLElBQUksV0FBVyxHQUFHLEVBQUUsQ0FBQztRQUNyQixJQUFJLFNBQVMsR0FBRyxLQUFLLENBQUM7UUFDdEIsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLFdBQVcsSUFBSSxRQUFRLENBQUMsQ0FBQyxDQUFDO1lBQ2hDLHdDQUF3QztZQUN4QyxJQUFJLE9BQU8sR0FBRyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDcEMsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUMxQyxFQUFFLENBQUEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO2dCQUNiLFNBQVMsR0FBRyxJQUFJLENBQUM7Z0JBQ2pCLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxTQUFPLElBQUksU0FBUyxDQUFDLENBQUMsQ0FBQztvQkFDN0Isb0NBQW9DO29CQUNwQyxXQUFXLENBQUMsU0FBTyxDQUFDLEdBQUcsU0FBUyxDQUFDLFNBQU8sQ0FBQyxDQUFDO2dCQUM1QyxDQUFDO1lBQ0gsQ0FBQztRQUNILENBQUM7UUFDRCxFQUFFLENBQUEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ2IsTUFBTSxDQUFDLFdBQVcsQ0FBQztRQUNyQixDQUFDO0lBQ0gsQ0FBQztJQUNELDJEQUEyRDtJQUMzRCxxQkFBcUI7SUFDckIsMkRBQTJEO0lBQzNELDJCQUFTLEdBQVQsVUFBVSxRQUFTO1FBQ2pCLElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUNkLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDakMsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUNuQyxFQUFFLENBQUEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO2dCQUNqQixJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQztZQUNoQyxDQUFDO1FBQ0gsQ0FBQztRQUNELEVBQUUsQ0FBQSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDWixNQUFNLENBQUMsSUFBSSxDQUFDO1FBQ2QsQ0FBQztRQUNELE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFDRCxzQkFBSSxHQUFKLFVBQUssVUFBVTtRQUNiLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDbEMsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3ZCLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQztZQUMxQixJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztRQUMzQyxDQUFDO1FBQ0QsRUFBRSxDQUFBLENBQUMsbUJBQVcsQ0FBQyxDQUFDLENBQUM7WUFDZixJQUFJLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEMsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN2QixDQUFDO0lBQ0gsQ0FBQztJQUNELHNCQUFJLEdBQUo7UUFDRSxNQUFNLENBQUMsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDeEIsQ0FBQztJQUNELDJCQUFTLEdBQVQsVUFBVSxJQUFTO1FBQ2pCLEVBQUUsQ0FBQSxDQUFDLG1CQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ2YsTUFBTSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN6QyxDQUFDO1FBQ0QsSUFBSSxLQUF3QixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUExQyxRQUFRLGdCQUFFLFNBQVMsZUFBdUIsQ0FBQztRQUNoRCxJQUFJLE9BQU8sQ0FBQztRQUNaLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQztRQUNkLEVBQUUsQ0FBQSxDQUFDLFFBQVEsQ0FBQztZQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMseUJBQXlCLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDaEUsT0FBTSxRQUFRLEVBQUUsQ0FBQztZQUNmLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxPQUFPLElBQUksUUFBUSxDQUFDLENBQUMsQ0FBQztnQkFDNUIsT0FBTyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEtBQUssQ0FBQztZQUMzQixDQUFDO1lBQ0QsbUNBQW1DO1lBQ25DLFFBQVEsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3ZDLEtBQUssRUFBRSxDQUFDO1FBRVYsQ0FBQztRQUNELEdBQUcsQ0FBQSxDQUFnQixVQUFvQixFQUFwQixLQUFBLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQW5DLGNBQVcsRUFBWCxJQUFtQyxDQUFDO1lBQXBDLElBQUksT0FBTyxTQUFBO1lBQ2IsRUFBRSxDQUFBLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQUMsUUFBUSxDQUFDO1lBQy9CLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDO1lBQ3BDLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQ1IsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN6QixDQUFDO1NBQ0Y7SUFDSCxDQUFDO0lBQ0QsdUJBQUssR0FBTCxVQUFNLE9BQU87UUFDWCxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2pDLEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQztZQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDdkIsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDaEMsQ0FBQztJQUNELHVCQUFLLEdBQUwsVUFBTSxTQUFtQixFQUFFLElBQVU7UUFDbkMsSUFBSSxLQUFLLENBQUM7UUFDVixFQUFFLENBQUEsQ0FBQyxPQUFPLFNBQVMsS0FBSyxRQUFRLENBQUM7WUFBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNoRSxJQUFJO1lBQUMsS0FBSyxHQUFHLFNBQVMsQ0FBQztRQUN2QixJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDWixJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFVBQUMsR0FBRyxJQUFLLE9BQUEsR0FBRyxLQUFLLE1BQU0sRUFBZCxDQUFjLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDL0QsSUFBSSxLQUFLLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNyQyxFQUFFLENBQUEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDVixJQUFJLFNBQVMsR0FBRyxFQUFFLENBQUM7WUFDbkIsR0FBRyxDQUFBLENBQVksVUFBSSxFQUFmLGdCQUFPLEVBQVAsSUFBZSxDQUFDO2dCQUFoQixJQUFJLEdBQUcsR0FBSSxJQUFJLElBQVI7Z0JBQ1QsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO2FBQzdDO1lBQ0QsS0FBSyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUM3RCxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLEVBQUUsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzNELENBQUM7UUFDRCxNQUFNLENBQUMsS0FBSyxDQUFDO0lBQ2YsQ0FBQztJQUNELHNCQUFJLEdBQUosVUFBSyxPQUFPLEVBQUUsS0FBTTtRQUNsQixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2pDLEVBQUUsQ0FBQSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNWLE1BQU0sQ0FBQyxFQUFFLENBQUM7UUFDWixDQUFDO1FBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNqQixNQUFNLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUM3QixDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixNQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDeEMsQ0FBQztJQUNILENBQUM7SUFDRCx5QkFBTyxHQUFQLFVBQVEsT0FBTyxFQUFFLEtBQU07UUFDckIsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3RDLENBQUM7SUFDRCx1QkFBSyxHQUFMLFVBQU0sSUFBZ0I7UUFBaEIsb0JBQWdCLEdBQWhCLGdCQUFnQjtRQUNwQixNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQy9CLENBQUM7SUFDRCx1QkFBSyxHQUFMLFVBQU0sSUFBSTtRQUNSLE1BQU0sQ0FBQyxJQUFJLEtBQUssQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUNELHlCQUFPLEdBQVAsVUFBUSxJQUFXLEVBQUUsS0FBcUIsRUFBRSxJQUEyQixFQUFFLGVBQXFDO1FBQzVHLElBQUksTUFBTSxHQUFHLENBQUMsT0FBTyxLQUFLLEtBQUssUUFBUSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxLQUFLLENBQUM7UUFDM0QsSUFBSSxPQUFPLEdBQUcsRUFBQyxNQUFBLElBQUksRUFBRSxRQUFBLE1BQU0sRUFBRSxNQUFBLElBQUksRUFBRSxpQkFBQSxlQUFlLEVBQUMsQ0FBQztRQUNwRCxHQUFHLENBQUEsQ0FBZ0IsVUFBTSxFQUFyQixrQkFBVyxFQUFYLElBQXFCLENBQUM7WUFBdEIsSUFBSSxPQUFPLEdBQUksTUFBTSxJQUFWO1lBQ2IsSUFBSSxPQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNoQyxPQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLE9BQU8sQ0FBQztTQUNoQztRQUNELEVBQUUsQ0FBQSxDQUFDLENBQUMsbUJBQVcsQ0FBQyxDQUFDLENBQUM7WUFDaEIsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUMxQyxPQUFNLFNBQVMsRUFBRSxDQUFDO2dCQUNoQixTQUFTLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUMzQyxDQUFDO1lBQUEsQ0FBQztRQUNKLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLEVBQUUsQ0FBQSxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7Z0JBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUFDLENBQUM7WUFDekMsSUFBSSxPQUFPLEdBQUcsVUFBQyxHQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFFLEVBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUMsS0FBQyxDQUFDO1lBQy9FLElBQUksS0FBc0IsSUFBSSxDQUFDLHNCQUFzQixDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsRUFBbEUsUUFBUSxnQkFBRSxPQUFPLGFBQWlELENBQUM7WUFDeEUsT0FBTSxRQUFRLEVBQUUsQ0FBQztnQkFDZixJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsdUJBQXVCLENBQUMsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDO2dCQUM5RCxFQUFFLENBQUEsQ0FBQyxDQUFDLE9BQU8sQ0FBQztvQkFBQyxLQUFLLENBQUE7Z0JBQ2xCLFFBQVEsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDO2dCQUM1QixPQUFPLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQztZQUM1QixDQUFDO1FBQ0gsQ0FBQzs7SUFDSCxDQUFDO0lBRUQsd0JBQU0sR0FBTixVQUFPLEtBQWlCO1FBQ3RCLElBQUksSUFBSSxHQUFHLEtBQUssQ0FBQyxJQUFJLENBQUM7UUFDdEIsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDckIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4QixDQUFDO1FBQ0QsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM1QixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxHQUFHLEtBQUssQ0FBQztRQUM3QixJQUFJLENBQUMsSUFBSSxHQUFHLEtBQUssQ0FBQztRQUNsQixJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQztRQUNuQixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFFLEtBQUssQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7SUFDOUYsQ0FBQztJQUNELDRCQUFVLEdBQVYsVUFBVyxFQUFTO1FBQ2xCLEdBQUcsQ0FBQSxDQUFjLFVBQVcsRUFBWCxLQUFBLElBQUksQ0FBQyxNQUFNLEVBQXhCLGNBQVMsRUFBVCxJQUF3QixDQUFDO1lBQXpCLElBQUksS0FBSyxTQUFBO1lBQ1gsT0FBTyxLQUFLLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQzNCO0lBQ0gsQ0FBQztJQUNELDRCQUFVLEdBQVY7UUFDRSxJQUFJLEtBQUssR0FBRyxDQUFDLENBQUM7UUFDZCxHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsU0FBUyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ2pDLEtBQUssSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUM7UUFDL0MsQ0FBQztRQUNELE1BQU0sQ0FBQyxLQUFLLENBQUM7SUFDZixDQUFDO0lBQ0QsK0JBQWEsR0FBYjtRQUNFLElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUNkLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDakMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQztRQUN4RCxDQUFDO1FBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxzQ0FBb0IsR0FBcEIsVUFBcUIsSUFBUztRQUM1QixFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQztZQUFDLE1BQU0sQ0FBQztRQUM3QixpREFBaUQ7UUFDbkQsSUFBSSxLQUF3QixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUExQyxRQUFRLGdCQUFFLFNBQVMsZUFBdUIsQ0FBQztRQUNoRCxJQUFJLEtBQUssR0FBRyxDQUFDLENBQUM7UUFDWixJQUFJLE9BQU8sR0FBRyxTQUFTLENBQUM7UUFDMUIsT0FBTSxRQUFRLEVBQUUsQ0FBQztZQUNmLG1DQUFtQztZQUNqQyxxQ0FBcUM7WUFDdkMsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLHVCQUF1QixDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQztZQUM1RCxzQkFBc0I7WUFDdEIsRUFBRSxDQUFBLENBQUMsQ0FBQyxPQUFPLENBQUM7Z0JBQUMsS0FBSyxDQUFBO1lBQ2xCLFFBQVEsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDO1lBQzVCLE9BQU8sR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFBO1lBQzNCLEtBQUssRUFBRSxDQUFDO1FBQ1YsQ0FBQztJQUNGLENBQUM7SUFFQSx3Q0FBc0IsR0FBdEIsVUFBdUIsT0FBTyxFQUFFLE9BQU87UUFDckMsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDckMsSUFBSSxJQUFJLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUM7UUFDcEMsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUM7WUFDM0IsSUFBSSxHQUFHLE9BQU8sQ0FBQyxlQUFlLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUNyRCxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztZQUNqQixPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQztRQUN6QixDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixPQUFPLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDZixNQUFNLENBQUM7UUFDVCxDQUFDO1FBQ0QsSUFBSSxJQUFJLEdBQUcsSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2xDLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ2YsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ25DLENBQUM7UUFDRCxFQUFFLENBQUEsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUNsQixJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDMUMsQ0FBQztRQUNELElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbEMsSUFBSyxTQUFTLEdBQUksT0FBTyxVQUFBLENBQUM7UUFDMUIsRUFBRSxDQUFBLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxTQUFTLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN2RyxNQUFNLENBQUMsRUFBQyxPQUFPLEVBQUUsU0FBUyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxRQUFRLEVBQUUsT0FBTyxDQUFDLFFBQVEsRUFBQyxDQUFDO1FBQ3hFLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLE1BQU0sQ0FBQyxFQUFFLENBQUM7UUFDWixDQUFDO0lBQ0gsQ0FBQztJQUVELHlDQUF1QixHQUF2QixVQUF3QixRQUFRLEVBQUUsT0FBTztRQUN2QyxJQUFJLFdBQVcsR0FBRyxFQUFFLENBQUM7UUFDckIsSUFBSSxXQUFXLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLElBQUksU0FBUyxHQUFHLEtBQUssQ0FBQztRQUN0QixJQUFJLFdBQVcsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3hDLEdBQUcsQ0FBQSxDQUFvQixVQUFXLEVBQTlCLHVCQUFlLEVBQWYsSUFBOEIsQ0FBQztZQUEvQixJQUFJLFdBQVcsR0FBSSxXQUFXLElBQWY7WUFDakIsd0NBQXdDO1lBQ3hDLElBQUksT0FBTyxHQUFHLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUNwQyxJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsc0JBQXNCLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQzlELEVBQUUsQ0FBQSxDQUFDLFNBQVMsSUFBSSxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztnQkFDbEMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxPQUFPLENBQUM7Z0JBQzdDLEVBQUUsQ0FBQSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO29CQUV0QixJQUFJLGFBQWEsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDcEQsR0FBRyxDQUFBLENBQWdCLFVBQWEsRUFBNUIseUJBQVcsRUFBWCxJQUE0QixDQUFDO3dCQUE3QixJQUFJLFNBQU8sR0FBSSxhQUFhLElBQWpCO3dCQUNiLEVBQUUsQ0FBQSxDQUFDLFNBQU8sSUFBSSxTQUFTLENBQUMsUUFBUSxDQUFDLFNBQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQzs0QkFDMUMsU0FBUyxHQUFHLElBQUksQ0FBQzs0QkFDakIsb0NBQW9DOzRCQUNwQyxXQUFXLENBQUMsU0FBTyxDQUFDLEdBQUcsU0FBUyxDQUFDLFFBQVEsQ0FBQyxTQUFPLENBQUMsQ0FBQzt3QkFDckQsQ0FBQztxQkFDRjtnQkFDSCxDQUFDO1lBQ0gsQ0FBQztTQUNGO1FBQ0QsRUFBRSxDQUFBLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztZQUNiLE1BQU0sQ0FBQyxFQUFDLE9BQU8sRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFLFdBQVcsRUFBQyxDQUFDO1FBQ3ZELENBQUM7SUFDSCxDQUFDO0lBQ0gsY0FBQztBQUFELENBbmJBLEFBbWJDLElBQUE7QUFuYlksZUFBTyxVQW1ibkIsQ0FBQTtBQUVELDRCQUFtQyxJQUFJO0lBQ3JDLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUMsS0FBSyxFQUFFLE1BQU0sQ0FBQyxFQUFFLGNBQWMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxZQUFZLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3RILGlFQUFpRTtJQUNqRSxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksRUFBRSxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQzNDLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxFQUFFLENBQUMsT0FBTyxFQUFFLGNBQWMsQ0FBQyxDQUFDLENBQUM7SUFDcEQsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUUsQ0FBQyxPQUFPLEVBQUUsUUFBUSxFQUFFLFlBQVksQ0FBQyxDQUFDLENBQUM7SUFDNUQsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO0lBQ3BDLE1BQU0sQ0FBQyxJQUFJLENBQUM7QUFDZCxDQUFDO0FBUmUsMEJBQWtCLHFCQVFqQyxDQUFBO0FBRUQsdUJBQXVCLElBQUksRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxhQUFhO0lBQ2xFLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksT0FBTyxDQUFDLENBQUMsQ0FBQztRQUN4QixJQUFJLEVBQUUsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkIsRUFBRSxDQUFBLENBQUMsRUFBRSxDQUFDLFdBQVcsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQzVCLElBQUksTUFBTSxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNuQixFQUFFLENBQUEsQ0FBQyxPQUFPLE1BQU0sS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDO2dCQUM5QixNQUFNLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQzFDLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixNQUFNLEdBQUcsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzNCLENBQUM7WUFDRCxJQUFJLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUUsTUFBQSxJQUFJLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQztRQUNyRixDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixJQUFJLENBQUMsR0FBRyxDQUFDLHlCQUF5QixFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUUsTUFBQSxJQUFJLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBQyxDQUFDLENBQUM7UUFDakUsQ0FBQztJQUNILENBQUM7SUFDRCxNQUFNLENBQUMsSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQUVVLHNCQUFjLEdBQUcsRUFBRSxDQUFBO0FBQzlCLElBQUksY0FBYyxHQUFHLGtDQUFrQyxDQUFDO0FBQ3hELElBQUksY0FBYyxHQUFHLFlBQVksQ0FBQztBQUNsQyx1QkFBdUIsSUFBSTtJQUN6QixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUN4RCxJQUFJLE1BQU0sR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUMsQ0FBQyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUM7SUFDekYsRUFBRSxDQUFBLENBQUMsTUFBTSxLQUFLLElBQUksQ0FBQztRQUNqQixNQUFNLEdBQUcsRUFBRSxDQUFDO0lBQ2QsTUFBTSxDQUFDLE1BQU0sQ0FBQztBQUNoQixDQUFDO0FBQ0QsZ0JBQXVCLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSTtJQUNyQyxJQUFJLE1BQU0sR0FBRyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDakMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7SUFDakIsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7SUFDckIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7SUFDakIsc0JBQWMsQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUM7QUFDOUIsQ0FBQztBQU5lLGNBQU0sU0FNckIsQ0FBQTtBQUVEO0lBaUNFLGVBQVksSUFBSSxFQUFFLElBQWdCO1FBQWhCLG9CQUFnQixHQUFoQixnQkFBZ0I7UUFDaEMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDbEIsSUFBSSxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUM7UUFDakIsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7UUFDaEIsSUFBSSxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7UUFDbEIsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7UUFDaEIsSUFBSSxDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUM7UUFDckIsSUFBSSxDQUFDLGVBQWUsR0FBRyxDQUFDLENBQUM7UUFDekIsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUM7SUFDMUIsQ0FBQztJQTFCTSxZQUFNLEdBQWIsVUFBYyxJQUFZLEVBQUUsSUFBWTtRQUN0QyxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDdkIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsRUFBQyxNQUFBLElBQUksRUFBQyxDQUFDLENBQUM7UUFDNUIsR0FBRyxDQUFBLENBQW1CLFVBQTJCLEVBQTNCLEtBQUEsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsRUFBQyxNQUFBLElBQUksRUFBQyxDQUFDLEVBQTdDLGNBQWMsRUFBZCxJQUE2QyxDQUFDO1lBQTlDLElBQUksVUFBVSxTQUFBO1lBQ2hCLElBQUksTUFBTSxHQUFHLFVBQVUsQ0FBQyxNQUFNLENBQUM7WUFDL0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsRUFBQyxRQUFBLE1BQU0sRUFBQyxDQUFDLENBQUM7WUFDaEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxlQUFlLEVBQUUsRUFBQyxRQUFBLE1BQU0sRUFBQyxDQUFDLENBQUM7WUFDdkMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRSxFQUFDLFFBQUEsTUFBTSxFQUFDLENBQUMsQ0FBQztZQUN4QyxJQUFJLENBQUMsTUFBTSxDQUFDLHlCQUF5QixFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUMsQ0FBQyxDQUFDO1lBQ2pELElBQUksQ0FBQyxNQUFNLENBQUMsdUJBQXVCLEVBQUUsRUFBQyxRQUFBLE1BQU0sRUFBQyxDQUFDLENBQUM7WUFDL0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxzQkFBc0IsRUFBRSxFQUFDLFFBQUEsTUFBTSxFQUFDLENBQUMsQ0FBQztTQUMvQztRQUNELE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBY0QseUJBQVMsR0FBVCxVQUFVLElBQVk7UUFDcEIsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3ZCLElBQUksT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNqQixJQUFJLGFBQWEsR0FBRyxFQUFFLENBQUM7UUFDdkIsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUM5QixhQUFhLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQztRQUM3QyxDQUFDO1FBQ0QsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUNyQixJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxFQUFDLE1BQUEsSUFBSSxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUMsQ0FBQyxDQUFDO1FBQ3hDLE9BQU87UUFDUCxHQUFHLENBQUEsQ0FBYSxVQUFVLEVBQVYsS0FBQSxJQUFJLENBQUMsS0FBSyxFQUF0QixjQUFRLEVBQVIsSUFBc0IsQ0FBQztZQUF2QixJQUFJLElBQUksU0FBQTtZQUNWLElBQUksTUFBTSxHQUFHLFlBQUksRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxDQUFDO1lBQzFCLEVBQUUsQ0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7Z0JBQ2pCLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLEVBQUMsTUFBQSxJQUFJLEVBQUUsUUFBQSxNQUFNLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBQyxDQUFDLENBQUM7WUFDbEUsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNOLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLEVBQUMsTUFBQSxJQUFJLEVBQUUsUUFBQSxNQUFNLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBQyxDQUFDLENBQUM7WUFDcEUsQ0FBQztZQUNELElBQUksQ0FBQyxHQUFHLENBQUMsZUFBZSxFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUUsYUFBYSxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQUMsQ0FBQyxDQUFDO1lBQy9ELGFBQWEsQ0FBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsT0FBTyxFQUFFLGFBQWEsQ0FBQyxDQUFDO1NBQ2hFO1FBQ0QsV0FBVztRQUNYLEdBQUcsQ0FBQSxDQUFhLFVBQVUsRUFBVixLQUFBLElBQUksQ0FBQyxLQUFLLEVBQXRCLGNBQVEsRUFBUixJQUFzQixDQUFDO1lBQXZCLElBQUksSUFBSSxTQUFBO1lBQ1YsSUFBSSxNQUFNLEdBQUcsWUFBSSxFQUFFLENBQUM7WUFDcEIsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLENBQUM7WUFDMUIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsRUFBQyxNQUFBLElBQUksRUFBRSxRQUFBLE1BQU0sRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFDLENBQUMsQ0FBQztZQUNuRSxJQUFJLENBQUMsR0FBRyxDQUFDLGVBQWUsRUFBRSxFQUFDLFFBQUEsTUFBTSxFQUFFLGFBQWEsRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFDLENBQUMsQ0FBQztZQUM5RCxhQUFhLENBQUMsSUFBSSxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLE9BQU8sRUFBRSxhQUFhLENBQUMsQ0FBQztTQUNoRTtRQUNELFlBQVk7UUFDWixHQUFHLENBQUEsQ0FBWSxVQUFlLEVBQWYsS0FBQSxJQUFJLENBQUMsVUFBVSxFQUExQixjQUFPLEVBQVAsSUFBMEIsQ0FBQztZQUEzQixJQUFJLEdBQUcsU0FBQTtZQUNULElBQUksTUFBTSxHQUFHLFlBQUksRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxDQUFDO1lBQ3pCLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLEVBQUMsTUFBQSxJQUFJLEVBQUUsUUFBQSxNQUFNLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDLEVBQUUsRUFBQyxDQUFDLENBQUM7WUFDbEUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxlQUFlLEVBQUUsRUFBQyxRQUFBLE1BQU0sRUFBRSxhQUFhLEVBQUUsR0FBRyxDQUFDLElBQUksRUFBQyxDQUFDLENBQUM7WUFDN0QsYUFBYSxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsR0FBRyxDQUFDLElBQUksRUFBRSxPQUFPLEVBQUUsYUFBYSxDQUFDLENBQUM7U0FDL0Q7UUFDRCxNQUFNO1FBQ04sRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDZCxJQUFJLE1BQU0sR0FBRyxZQUFJLEVBQUUsQ0FBQztZQUNwQixJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxFQUFDLE1BQUEsSUFBSSxFQUFFLFFBQUEsTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLGtCQUFVLEVBQUMsQ0FBQyxDQUFDO1lBQ2pFLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztZQUNYLEdBQUcsQ0FBQSxDQUFhLFVBQVUsRUFBVixLQUFBLElBQUksQ0FBQyxLQUFLLEVBQXRCLGNBQVEsRUFBUixJQUFzQixDQUFDO2dCQUF2QixJQUFJLElBQUksU0FBQTtnQkFDVixJQUFLLE1BQU0sR0FBc0IsSUFBSSxLQUF4QixLQUFLLEdBQWUsSUFBSSxLQUFqQixTQUFTLEdBQUksSUFBSSxHQUFBLENBQUM7Z0JBQ3RDLEVBQUUsQ0FBQSxDQUFDLE9BQU8sTUFBTSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUM7b0JBQzlCLE1BQU0sR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7Z0JBQzFDLENBQUM7Z0JBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ04sTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDM0IsQ0FBQztnQkFDRCxJQUFJLENBQUMsR0FBRyxDQUFDLHVCQUF1QixFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUUsSUFBQSxFQUFFLEVBQUUsUUFBQSxNQUFNLEVBQUUsT0FBQSxLQUFLLEVBQUUsV0FBQSxTQUFTLEVBQUMsQ0FBQyxDQUFDO2dCQUMxRSxFQUFFLEVBQUUsQ0FBQzthQUNOO1FBQ0gsQ0FBQztRQUNELE9BQU87UUFDUCxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUNmLElBQUksTUFBTSxHQUFHLFlBQUksRUFBRSxDQUFDO1lBQ3BCLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLEVBQUMsTUFBQSxJQUFJLEVBQUUsUUFBQSxNQUFNLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUUsa0JBQVUsRUFBQyxDQUFDLENBQUM7WUFDbEUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ1gsR0FBRyxDQUFBLENBQWMsVUFBVyxFQUFYLEtBQUEsSUFBSSxDQUFDLE1BQU0sRUFBeEIsY0FBUyxFQUFULElBQXdCLENBQUM7Z0JBQXpCLElBQUksS0FBSyxTQUFBO2dCQUNYLElBQUssTUFBTSxHQUFXLEtBQUssS0FBZCxLQUFLLEdBQUksS0FBSyxHQUFBLENBQUM7Z0JBQzVCLEVBQUUsQ0FBQSxDQUFDLE9BQU8sTUFBTSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUM7b0JBQzlCLE1BQU0sR0FBRyxPQUFPLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7Z0JBQzFDLENBQUM7Z0JBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ04sTUFBTSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDM0IsQ0FBQztnQkFDRCxJQUFJLENBQUMsR0FBRyxDQUFDLHVCQUF1QixFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUUsSUFBQSxFQUFFLEVBQUUsUUFBQSxNQUFNLEVBQUUsT0FBQSxLQUFLLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBQyxDQUFDLENBQUM7Z0JBQ3ZGLEVBQUUsRUFBRSxDQUFDO2FBQ047UUFDSCxDQUFDO1FBQ0QsT0FBTztRQUNQLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ2xCLElBQUksTUFBTSxHQUFHLFlBQUksRUFBRSxDQUFDO1lBQ3BCLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLEVBQUMsTUFBQSxJQUFJLEVBQUUsUUFBQSxNQUFNLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxFQUFFLEVBQUUsa0JBQVUsRUFBQyxDQUFDLENBQUM7WUFDbEUsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztnQkFDcEMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxzQkFBc0IsRUFBRSxFQUFDLFFBQUEsTUFBTSxFQUFFLFlBQVksRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLEVBQUMsQ0FBQyxDQUFDO1lBQ3hHLENBQUM7UUFDSCxDQUFDO1FBQ0QsWUFBWTtRQUNaLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDO1lBQ3RCLElBQUksTUFBTSxHQUFHLFlBQUksRUFBRSxDQUFDO1lBQ3BCLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLEVBQUMsTUFBQSxJQUFJLEVBQUUsUUFBQSxNQUFNLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxFQUFFLEVBQUUsa0JBQVUsRUFBQyxDQUFDLENBQUM7WUFDcEUsYUFBYSxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLGFBQWEsRUFBRSxPQUFPLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFDMUUsQ0FBQztRQUNELE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQ0QsOEJBQWMsR0FBZCxVQUFlLFNBQVMsRUFBRSxVQUFVO1FBQ2xDLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3ZDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxLQUFLLElBQUksVUFBVSxDQUFDLENBQUMsQ0FBQztZQUM3QixFQUFFLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sSUFBSSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUNuRCxNQUFNLElBQUksS0FBSyxDQUFDLFlBQVUsU0FBUyxnQ0FBMkIsS0FBSyxnQ0FBMkIsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFHLENBQUMsQ0FBQztZQUMzSCxDQUFDO1lBQ0QsSUFBSSxRQUFRLEdBQUcsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ2pDLEVBQUUsQ0FBQSxDQUFDLFFBQVEsQ0FBQyxXQUFXLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDbEMsSUFBSyxVQUFVLEdBQXFCLFFBQVEsS0FBM0IsZUFBZSxHQUFJLFFBQVEsR0FBQSxDQUFDO2dCQUM3QyxFQUFFLENBQUMsQ0FBQyxPQUFPLFVBQVUsS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDO29CQUNuQyxVQUFVLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztnQkFDeEMsQ0FBQztnQkFDRCxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDO2dCQUNsQyxFQUFFLENBQUMsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLEVBQUUsS0FBSyxVQUFVLENBQUMsQ0FBQyxDQUFDO29CQUNuQyxJQUFJLGVBQWUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7b0JBQ2xELEVBQUUsQ0FBQyxDQUFDLENBQUMsZUFBZSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUM7d0JBQUMsUUFBUSxDQUFDO29CQUM3QyxFQUFFLENBQUMsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUNoRCxNQUFNLElBQUksS0FBSyxDQUFDLFlBQVUsSUFBSSxDQUFDLEtBQUssZ0NBQTJCLGVBQWUsZ0NBQTJCLGVBQWUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBRyxDQUFDLENBQUM7b0JBQ2hKLENBQUM7Z0JBQ0gsQ0FBQztZQUNILENBQUM7UUFDSCxDQUFDO0lBQ0gsQ0FBQztJQUNELHNCQUFNLEdBQU4sVUFBTyxLQUFLLEVBQUUsSUFBSSxFQUFFLEVBQUc7UUFDckIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDbEIsRUFBRSxDQUFBLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNOLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDO1FBQ3RELENBQUM7UUFDRCxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDdkIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDeEIsSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDakMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLE9BQUEsS0FBSyxFQUFFLE1BQUEsSUFBSSxFQUFFLElBQUEsRUFBRSxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxFQUFDLENBQUMsQ0FBQztRQUN6RSxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUNELHdCQUFRLEdBQVIsVUFBUyxLQUFLLEVBQUUsSUFBSTtRQUNsQixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztRQUNsQixJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN4QixJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNqQyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUUsT0FBQSxLQUFLLEVBQUUsTUFBQSxJQUFJLEVBQUUsRUFBRSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLElBQUksRUFBQyxDQUFDLENBQUM7UUFDNUUsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUM7SUFDRCx5QkFBUyxHQUFULFVBQVUsUUFBUSxFQUFFLElBQUksRUFBRSxFQUFHO1FBQzNCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLEVBQUUsQ0FBQSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDTixJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE1BQU0sQ0FBQztRQUN0RCxDQUFDO1FBQ0QsRUFBRSxDQUFBLENBQUMsQ0FBQyxzQkFBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDcEMsSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBQ3pCLENBQUM7UUFDRCxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsTUFBQSxJQUFJLEVBQUUsSUFBQSxFQUFFLEVBQUUsRUFBRSxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQyxDQUFDO1FBQ2xFLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQ0QsdUJBQU8sR0FBUCxVQUFRLGFBQWE7UUFDbkIsSUFBSSxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUM7UUFDbkMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFDOUMsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUM7SUFDRCxxQkFBSyxHQUFMLFVBQU0sTUFBTTtRQUNWLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDO1FBQ2xCLEVBQUUsQ0FBQSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDaEQsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDdkIsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sRUFBRSxDQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDO2dCQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDO1lBQ2xDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQzNCLENBQUM7UUFDRCxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUNELG9CQUFJLEdBQUosVUFBSyxLQUFLO1FBQ1IsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDbEIsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQztZQUM5QyxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUNyQixDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixFQUFFLENBQUEsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7Z0JBQUMsSUFBSSxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUM7WUFDaEMsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDekIsQ0FBQztRQUNELE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQ0QscUJBQUssR0FBTCxVQUFNLFNBQWE7UUFDakIsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDbEIsRUFBRSxDQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztZQUNuQixJQUFJLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztRQUN0QixDQUFDO1FBQ0QsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ3pCLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLEdBQUcsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3ZDLENBQUM7UUFDRCxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUNELHlCQUFTLEdBQVQsVUFBVSxRQUFRLEVBQUUsSUFBSSxFQUFFLEVBQUc7UUFDM0IsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7UUFDbEIsRUFBRSxDQUFBLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNOLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDO1FBQ3RELENBQUM7UUFDRCxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDdkIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsRUFBQyxJQUFJLEVBQUUsUUFBUSxFQUFFLE1BQUEsSUFBSSxFQUFFLElBQUEsRUFBRSxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxFQUFDLENBQUMsQ0FBQztRQUN2RSxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUNELHVCQUFPLEdBQVA7UUFDRSxJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztRQUNsQixJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQztRQUN2QixJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDdkIsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUM7SUFDRCw0QkFBWSxHQUFaLFVBQWEsT0FBTztRQUNsQixHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsS0FBSyxJQUFJLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDekIsSUFBSSxRQUFRLEdBQUcsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzlCLEVBQUUsQ0FBQSxDQUFDLFFBQVEsQ0FBQyxXQUFXLEtBQUssS0FBSyxJQUFJLE9BQU8sUUFBUSxDQUFDLENBQUMsQ0FBQyxLQUFLLFFBQVEsQ0FBQztnQkFBQyxRQUFRLENBQUM7WUFDL0UsSUFBSSxTQUFTLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzVCLEVBQUUsQ0FBQSxDQUFDLFNBQVMsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO2dCQUMzQixRQUFRLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLGVBQWUsR0FBRyxDQUFDLENBQUM7WUFDekMsQ0FBQztZQUFDLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2hELFFBQVEsQ0FBQyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ3hDLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixNQUFNLElBQUksS0FBSyxDQUFDLHNCQUFzQixHQUFHLFNBQVMsQ0FBQyxDQUFDO1lBQ3RELENBQUM7UUFDSCxDQUFDO0lBQ0gsQ0FBQztJQUNELHFCQUFLLEdBQUw7UUFDRSxJQUFJLE1BQU0sR0FBRyxFQUFDLElBQUksRUFBRSxPQUFPO1lBQ2IsUUFBUSxFQUFFLEVBQUUsRUFBQyxDQUFDO1FBQzVCLElBQUksSUFBSSxHQUFHLE1BQU0sQ0FBQztRQUNsQixJQUFJLE9BQU8sR0FBRyxFQUFFLENBQUM7UUFDakIsa0VBQWtFO1FBQ2xFLElBQUksT0FBTyxHQUFHLENBQUMsYUFBYSxFQUFFLFlBQVksQ0FBQyxDQUFDO1FBRTVDLG9EQUFvRDtRQUNwRCxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksRUFBRSxhQUFhLEVBQUUsR0FBRyxFQUFFLGFBQWEsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztRQUMzRSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksRUFBRSxhQUFhLEVBQUUsR0FBRyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztRQUMxRSxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksRUFBRSxhQUFhLEVBQUUsR0FBRyxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztRQUV6RSw0RUFBNEU7UUFDNUUsdUJBQXVCO1FBQ3ZCLEdBQUcsQ0FBQSxDQUFhLFVBQVUsRUFBVixLQUFBLElBQUksQ0FBQyxLQUFLLEVBQXRCLGNBQVEsRUFBUixJQUFzQixDQUFDO1lBQXZCLElBQUksSUFBSSxTQUFBO1lBQ1YsSUFBSyxLQUFLLEdBQWlCLElBQUksUUFBbkIsRUFBRSxHQUFhLElBQUksS0FBZixPQUFPLEdBQUksSUFBSSxRQUFBLENBQUM7WUFDaEMsSUFBSSxHQUFHLEdBQUc7Z0JBQ1IsSUFBSSxFQUFFLFFBQVE7Z0JBQ2QsT0FBQSxLQUFLO2dCQUNMLE1BQU0sRUFBRSxFQUFFLEtBQUssQ0FBQztnQkFDaEIsSUFBQSxFQUFFO2dCQUNGLFNBQUEsT0FBTztnQkFDUCxRQUFRLEVBQUUsRUFBRTtnQkFDWixJQUFJLEVBQUUsS0FBSzthQUNaLENBQUM7WUFDRix1REFBdUQ7WUFDdkQsMENBQTBDO1lBQzFDLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7WUFDeEIsSUFBSSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUMzQixFQUFFLENBQUEsQ0FBQyxPQUFPLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDaEQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsRUFBQyxJQUFJLEVBQUUsYUFBYSxFQUFFLEdBQUcsRUFBRSxVQUFRLEVBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztnQkFDN0UsR0FBRyxDQUFDLElBQUksR0FBRyxPQUFPLENBQUM7WUFDckIsQ0FBQztZQUNELE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQzFCLEVBQUUsQ0FBQSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztnQkFDWixPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUMsSUFBSSxFQUFFLFFBQVEsRUFBRSxJQUFBLEVBQUUsRUFBQyxDQUFDLENBQUM7WUFDckMsQ0FBQztZQUVELE1BQU0sR0FBRyxHQUFHLENBQUM7U0FDZDtRQUNELGlGQUFpRjtRQUNqRixZQUFZO1FBQ1osR0FBRyxDQUFBLENBQWEsVUFBVSxFQUFWLEtBQUEsSUFBSSxDQUFDLEtBQUssRUFBdEIsY0FBUSxFQUFSLElBQXNCLENBQUM7WUFBdkIsSUFBSSxJQUFJLFNBQUE7WUFDVixJQUFLLElBQUksR0FBYyxJQUFJLE9BQWhCLE1BQUksR0FBUSxJQUFJLE9BQVYsRUFBRSxHQUFJLElBQUksR0FBQSxDQUFDO1lBQzVCLElBQUksUUFBUSxHQUFHLHNCQUFjLENBQUMsTUFBSSxDQUFDLENBQUM7WUFDcEMsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN4QixJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxFQUFDLElBQUksRUFBRSxxQkFBcUIsRUFBRSxJQUFBLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFDLENBQUMsQ0FBQztZQUN6RSxFQUFFLENBQUEsQ0FBQyxRQUFRLENBQUMsS0FBSyxJQUFJLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO2dCQUNyQyxJQUFJLElBQUksR0FBRyxFQUFDLElBQUksRUFBRSx5QkFBeUIsRUFBRSxJQUFBLEVBQUUsRUFBRSxNQUFBLElBQUksRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUMsQ0FBQztnQkFDckYsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzNCLE1BQU0sR0FBRyxJQUFJLENBQUM7WUFDaEIsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNOLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUMsSUFBSSxFQUFFLGNBQWMsRUFBRSxJQUFBLEVBQUUsRUFBRSxNQUFBLElBQUksRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUMsQ0FBQyxDQUFDO1lBQ3ZGLENBQUM7WUFDRCxFQUFFLENBQUEsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxRQUFRLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztnQkFDMUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksRUFBRSxVQUFVLEVBQUUsSUFBQSxFQUFFLEVBQUMsQ0FBQyxDQUFDO1lBQ3ZDLENBQUM7U0FDRjtRQUVELHlFQUF5RTtRQUN6RSxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsU0FBQSxPQUFPLEVBQUMsQ0FBQyxDQUFDO1FBRWhELGFBQWE7UUFDYixxRUFBcUU7UUFDckUsSUFBSSxLQUFLLEdBQUcsRUFBRSxDQUFDO1FBQ2YsSUFBSSxhQUFhLEdBQUcsRUFBRSxDQUFDO1FBQ3ZCLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ2YsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDL0IsR0FBRyxDQUFBLENBQWMsVUFBVyxFQUFYLEtBQUEsSUFBSSxDQUFDLE1BQU0sRUFBeEIsY0FBUyxFQUFULElBQXdCLENBQUM7Z0JBQXpCLElBQUksS0FBSyxTQUFBO2dCQUNYLElBQUssS0FBSyxHQUFXLEtBQUssS0FBZCxLQUFLLEdBQUksS0FBSyxHQUFBLENBQUM7Z0JBQzNCLEtBQUssQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ2xCLGFBQWEsQ0FBQyxDQUFHLEtBQUssU0FBSSxLQUFLLENBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQzthQUMzQztRQUNILENBQUM7UUFDRCxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztZQUNkLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzlCLEdBQUcsQ0FBQSxDQUFhLFVBQVUsRUFBVixLQUFBLElBQUksQ0FBQyxLQUFLLEVBQXRCLGNBQVEsRUFBUixJQUFzQixDQUFDO2dCQUF2QixJQUFJLElBQUksU0FBQTtnQkFDVixJQUFLLEtBQUssR0FBVyxJQUFJLEtBQWIsS0FBSyxHQUFJLElBQUksR0FBQSxDQUFDO2dCQUMxQixFQUFFLENBQUEsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFHLEtBQUssU0FBSSxLQUFLLENBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDdkMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDbkIsQ0FBQzthQUNGO1FBQ0gsQ0FBQztRQUNELElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUM7UUFDaEMsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDaEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBQyxJQUFJLEVBQUUsTUFBTSxFQUFFLE9BQUEsS0FBSyxFQUFFLE1BQUEsSUFBSSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUMsQ0FBQyxDQUFDO1FBQ2hFLENBQUM7UUFDRCw4RUFBOEU7UUFDOUUsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLElBQUksS0FBSyxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsU0FBUyxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQy9FLDZFQUE2RTtZQUM3RSx3RkFBd0Y7WUFDeEYsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsRUFBQyxJQUFJLEVBQUUsYUFBYSxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBQyxDQUFDLENBQUM7WUFDNUUsT0FBTyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUMxQixJQUFJLGlCQUFpQixHQUFHLEVBQUUsQ0FBQztZQUMzQixHQUFHLENBQUEsQ0FBYSxVQUFlLEVBQWYsS0FBQSxJQUFJLENBQUMsVUFBVSxFQUEzQixjQUFRLEVBQVIsSUFBMkIsQ0FBQztnQkFBNUIsSUFBSSxJQUFJLFNBQUE7Z0JBQ1YsSUFBSyxJQUFJLEdBQWMsSUFBSSxPQUFoQixNQUFJLEdBQVEsSUFBSSxPQUFWLEVBQUUsR0FBSSxJQUFJLEdBQUEsQ0FBQztnQkFDNUIsSUFBSSxRQUFRLEdBQUcsc0JBQWMsQ0FBQyxNQUFJLENBQUMsQ0FBQztnQkFDcEMsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDeEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsRUFBQyxJQUFJLEVBQUUscUJBQXFCLEVBQUUsSUFBQSxFQUFFLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBQyxDQUFDLENBQUM7Z0JBQ3pFLGlCQUFpQixDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksRUFBRSxjQUFjLEVBQUUsSUFBQSxFQUFFLEVBQUUsU0FBUyxFQUFFLE9BQU8sQ0FBQyxNQUFNLEVBQUUsTUFBQSxJQUFJLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUMsQ0FBQyxDQUFDO2dCQUNySSxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUMsSUFBSSxFQUFFLGFBQWEsRUFBQyxDQUFDLENBQUM7YUFDckM7WUFDRCxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsVUFBVSxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQzVCLGlCQUFpQixDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksRUFBRSxTQUFTLEVBQUMsQ0FBQyxDQUFDO2dCQUMxQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUMsSUFBSSxFQUFFLGFBQWEsRUFBQyxDQUFDLENBQUM7WUFDdEMsQ0FBQztZQUNELElBQUksU0FBUyxHQUFHLEVBQUMsSUFBSSxFQUFFLGdCQUFnQixFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsU0FBUyxFQUFFLE1BQUEsSUFBSSxFQUFFLFFBQVEsRUFBRSxpQkFBaUIsRUFBQyxDQUFDO1lBQ3hILElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQzlCLE1BQU0sR0FBRyxTQUFTLENBQUM7UUFDckIsQ0FBQztRQUdELEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDO1lBQ3RCLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQ3RDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEVBQUMsSUFBSSxFQUFFLGFBQWEsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDO1lBQzFFLEVBQUUsQ0FBQSxDQUFDLG1CQUFXLENBQUMsQ0FBQyxDQUFDO2dCQUNmLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUMsSUFBSSxFQUFFLFlBQVksRUFBQyxDQUFDLENBQUM7WUFDN0MsQ0FBQztZQUNELE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUMsSUFBSSxFQUFFLFlBQVksRUFBRSxhQUFhLEVBQUUsSUFBSSxDQUFDLGFBQWEsRUFBRSxXQUFXLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEVBQUMsQ0FBQyxDQUFDO1lBQ25ILE9BQU8sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDMUIsQ0FBQztRQUVELElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUMsSUFBSSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFDLENBQUMsQ0FBQztRQUNwRCxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUNELGtDQUFrQixHQUFsQixVQUFtQixRQUFRLEVBQUUsSUFBSSxFQUFFLFdBQW1CO1FBQW5CLDJCQUFtQixHQUFuQixtQkFBbUI7UUFDcEQsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ2QsSUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQztRQUM3QixFQUFFLENBQUEsQ0FBQyxXQUFXLENBQUM7WUFBQyxNQUFNLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN6QyxHQUFHLENBQUEsQ0FBYyxVQUFNLEVBQW5CLGtCQUFTLEVBQVQsSUFBbUIsQ0FBQztZQUFwQixJQUFJLEtBQUssR0FBSSxNQUFNLElBQVY7WUFDWCxJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDdEIsSUFBSSxPQUFPLFNBQUEsQ0FBQztZQUNaLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQztnQkFDN0IsSUFBSSxRQUFRLEdBQUcsRUFBRSxDQUFDO2dCQUNsQixFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUNWLFFBQVEsR0FBRyxPQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsT0FBSSxDQUFDO2dCQUM3QixDQUFDO2dCQUNELEVBQUUsQ0FBQSxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztvQkFDaEIsT0FBTyxHQUFHLFFBQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLFFBQVUsQ0FBQztnQkFDdEMsQ0FBQztnQkFBQyxJQUFJLENBQUMsQ0FBQztvQkFDTixPQUFPLEdBQUcsc0JBQW9CLEdBQUcsQ0FBQyxDQUFDLENBQUMsU0FBSSxRQUFVLENBQUM7Z0JBQ3JELENBQUM7WUFDSCxDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ04sT0FBTyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDaEMsQ0FBQztZQUNELElBQUksSUFBTyxPQUFPLE9BQUksQ0FBQztTQUN4QjtRQUNELE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsRUFBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQzNDLENBQUM7SUFDRCwwQkFBVSxHQUFWLFVBQVcsSUFBSTtRQUNiLElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUNkLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDckIsTUFBTSxDQUFBLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNaLEtBQUssT0FBTztnQkFDVixHQUFHLENBQUEsQ0FBYyxVQUFhLEVBQWIsS0FBQSxJQUFJLENBQUMsUUFBUSxFQUExQixjQUFTLEVBQVQsSUFBMEIsQ0FBQztvQkFBM0IsSUFBSSxLQUFLLFNBQUE7b0JBQ1gsSUFBSSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7aUJBQ2hDO2dCQUNELEtBQUssQ0FBQztZQUNSLEtBQUssYUFBYTtnQkFDaEIsSUFBSSxJQUFJLFNBQU8sSUFBSSxDQUFDLEdBQUcsV0FBTSxJQUFJLENBQUMsS0FBSyxRQUFLLENBQUM7Z0JBQzdDLEtBQUssQ0FBQztZQUNSLEtBQUsscUJBQXFCO2dCQUN4QixJQUFJLElBQUksYUFBVyxJQUFJLENBQUMsRUFBRSwyQkFBc0IsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLGVBQVksQ0FBQztnQkFDM0UsS0FBSyxDQUFDO1lBQ1IsS0FBSyxjQUFjO2dCQUNqQixJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDO2dCQUNqQixJQUFJLElBQUksR0FBRyxFQUFFLENBQUM7Z0JBQ2QsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7b0JBQ3BCLElBQUksR0FBRyxRQUFNLEVBQUksQ0FBQztvQkFDbEIsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQzt3QkFBQyxJQUFJLElBQUksR0FBRyxDQUFBO2dCQUM3QyxDQUFDO2dCQUNELElBQUksSUFBSSxZQUFVLEVBQUUsZUFBVSxFQUFFLFNBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxTQUFNLENBQUM7Z0JBQ2pILEtBQUssQ0FBQztZQUNSLEtBQUsseUJBQXlCO2dCQUM1QixJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDO2dCQUNqQixJQUFJLElBQUksYUFBVyxFQUFFLGVBQVUsRUFBRSxTQUFJLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBTSxDQUFDO2dCQUN6RixJQUFJLElBQUkseUJBQXVCLEVBQUUscUJBQWdCLEVBQUUsZUFBVSxFQUFFLDZCQUF3QixFQUFFLGtCQUFhLEVBQUUsc0JBQWlCLEVBQUUsWUFBUyxDQUFBO2dCQUNwSSxJQUFJLElBQUksWUFBVSxFQUFFLGVBQVUsRUFBRSxxQkFBZ0IsRUFBRSxTQUFNLENBQUM7Z0JBQ3pELEdBQUcsQ0FBQSxDQUFjLFVBQWEsRUFBYixLQUFBLElBQUksQ0FBQyxRQUFRLEVBQTFCLGNBQVMsRUFBVCxJQUEwQixDQUFDO29CQUEzQixJQUFJLEtBQUssU0FBQTtvQkFDWCxJQUFJLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztpQkFDaEM7Z0JBQ0QsSUFBSSxJQUFJLEtBQUssQ0FBQztnQkFDZCxLQUFLLENBQUM7WUFDUixLQUFLLFFBQVE7Z0JBQ1gsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQztnQkFDakIsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7b0JBQ2YsSUFBSSxJQUFJLGFBQVcsRUFBRSxtQkFBZ0IsQ0FBQztnQkFDeEMsQ0FBQztnQkFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7b0JBQ3BCLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7d0JBQ3pCLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7d0JBQzdCLEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQyxXQUFXLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQzs0QkFDakMsSUFBSyxPQUFPLEdBQVcsT0FBTyxLQUFoQixLQUFLLEdBQUksT0FBTyxHQUFBLENBQUM7NEJBQy9CLElBQUksSUFBSSxVQUFRLEVBQUUsVUFBSyxHQUFHLGdCQUFXLE9BQU8sVUFBSyxLQUFLLFVBQU8sQ0FBQzt3QkFDaEUsQ0FBQzt3QkFBQyxJQUFJLENBQUMsQ0FBQzs0QkFDTixJQUFJLElBQUksVUFBUSxFQUFFLFVBQUssR0FBRyxhQUFRLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFFBQUssQ0FBQzt3QkFDakUsQ0FBQztvQkFDSCxDQUFDO29CQUNELElBQUksSUFBSSxhQUFXLEVBQUUsd0NBQW1DLElBQUksQ0FBQyxLQUFLLGlCQUFZLEVBQUUsU0FBTSxDQUFDO2dCQUN6RixDQUFDO2dCQUFDLElBQUksQ0FBQyxDQUFDO29CQUNOLElBQUksSUFBSSxhQUFXLEVBQUUsdUJBQWtCLElBQUksQ0FBQyxLQUFLLGdCQUFhLENBQUM7Z0JBQ2pFLENBQUM7Z0JBQ0QsRUFBRSxDQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztvQkFDakIsSUFBSSxJQUFJLGtCQUFnQixFQUFFLHFCQUFnQixFQUFFLGVBQVUsRUFBRSxzQkFBaUIsRUFBRSxrQkFBYSxFQUFFLGVBQVUsRUFBRSxZQUFTLENBQUE7b0JBQy9HLElBQUksSUFBSSxZQUFVLEVBQUUsZUFBVSxFQUFFLGNBQVMsRUFBRSxTQUFNLENBQUM7Z0JBQ3BELENBQUM7Z0JBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ04sSUFBSSxJQUFJLGFBQVcsRUFBRSxpQkFBYyxDQUFBO2dCQUNyQyxDQUFDO2dCQUNELEdBQUcsQ0FBQSxDQUFjLFVBQWEsRUFBYixLQUFBLElBQUksQ0FBQyxRQUFRLEVBQTFCLGNBQVMsRUFBVCxJQUEwQixDQUFDO29CQUEzQixJQUFJLEtBQUssU0FBQTtvQkFDWCxJQUFJLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztpQkFDaEM7Z0JBQ0QsSUFBSSxJQUFJLEtBQUssQ0FBQztnQkFDZCxLQUFLLENBQUM7WUFDUixLQUFLLFFBQVE7Z0JBQ1gsSUFBSSxPQUFPLEdBQUcsRUFBRSxDQUFDO2dCQUNqQixHQUFHLENBQUEsQ0FBZSxVQUFZLEVBQVosS0FBQSxJQUFJLENBQUMsT0FBTyxFQUExQixjQUFVLEVBQVYsSUFBMEIsQ0FBQztvQkFBM0IsSUFBSSxNQUFNLFNBQUE7b0JBQ1osRUFBRSxDQUFBLENBQUMsTUFBTSxDQUFDLElBQUksS0FBSyxhQUFhLENBQUMsQ0FBQyxDQUFDO3dCQUNqQyxPQUFPLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO29CQUM1QixDQUFDO29CQUFDLElBQUksQ0FBQyxDQUFDO3dCQUNOLElBQUksSUFBRSxHQUFHLE1BQU0sQ0FBQyxFQUFFLENBQUM7d0JBQ25CLE9BQU8sQ0FBQyxJQUFJLENBQUMsUUFBTSxJQUFJLENBQUMsQ0FBQztvQkFDM0IsQ0FBQztpQkFDRjtnQkFDRCxJQUFJLElBQUksc0JBQW9CLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQU0sQ0FBQztnQkFDckQsS0FBSyxDQUFDO1lBQ1IsS0FBSyxNQUFNO2dCQUNULElBQUksSUFBSSw2QkFBNkIsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBQyxJQUFJLENBQUM7Z0JBQ2xFLEtBQUssQ0FBQztZQUNSLEtBQUssZ0JBQWdCO2dCQUNuQixJQUFJLFVBQVUsR0FBRyxFQUFFLENBQUM7Z0JBQ3BCLElBQUksY0FBYyxHQUFHLEVBQUUsQ0FBQztnQkFDeEIsSUFBSSxlQUFlLEdBQUcsRUFBRSxDQUFDO2dCQUN6QixJQUFJLGVBQWUsR0FBRyxFQUFFLENBQUM7Z0JBQ3pCLElBQUksV0FBVyxHQUFHLEVBQUUsQ0FBQztnQkFDckIsSUFBSSxPQUFPLEdBQWtCLEtBQUssQ0FBQztnQkFDbkMsSUFBSSxjQUFjLENBQUM7Z0JBQ25CLEdBQUcsQ0FBQSxDQUFZLFVBQWEsRUFBYixLQUFBLElBQUksQ0FBQyxRQUFRLEVBQXhCLGNBQU8sRUFBUCxJQUF3QixDQUFDO29CQUF6QixJQUFJLEdBQUcsU0FBQTtvQkFDVCxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsSUFBSSxLQUFLLGNBQWMsQ0FBQyxDQUFDLENBQUM7d0JBQy9CLFdBQVcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDO3dCQUMzQixJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO3dCQUNwQyxRQUFRLElBQUksd0JBQXNCLEdBQUcsQ0FBQyxTQUFTLGVBQVUsR0FBRyxDQUFDLEVBQUUsUUFBSyxDQUFDO3dCQUNyRSxjQUFjLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO3dCQUM5QixlQUFlLENBQUMsSUFBSSxDQUFDLFlBQVUsR0FBRyxDQUFDLEVBQUUsV0FBUSxDQUFDLENBQUM7d0JBQy9DLGVBQWUsQ0FBQyxJQUFJLENBQUMsUUFBTSxHQUFHLENBQUMsRUFBRSxXQUFRLENBQUMsQ0FBQztvQkFDN0MsQ0FBQztvQkFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLElBQUksS0FBSyxZQUFZLENBQUMsQ0FBQyxDQUFDO3dCQUNwQyxHQUFHLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQzt3QkFDOUIsVUFBVSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQ3BDLENBQUM7b0JBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQzt3QkFDakMsT0FBTyxHQUFHLHFCQUFrQixJQUFJLENBQUMsZUFBZSxHQUFHLENBQUMsd0JBQW9CLENBQUM7b0JBQzNFLENBQUM7b0JBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssWUFBWSxDQUFDLENBQUMsQ0FBQzt3QkFDcEMsY0FBYyxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQ3hDLENBQUM7aUJBQ0Y7Z0JBQ0QsSUFBSSxrQkFBa0IsR0FBRyxjQUFjLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUVqRCxJQUFJLG9CQUFvQixHQUFHLEVBQUUsQ0FBQztnQkFDOUIsSUFBSSxVQUFVLEdBQUcsT0FBTyxDQUFDO2dCQUN6QixFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztvQkFDZixHQUFHLENBQUEsQ0FBYyxVQUFXLEVBQVgsS0FBQSxJQUFJLENBQUMsTUFBTSxFQUF4QixjQUFTLEVBQVQsSUFBd0IsQ0FBQzt3QkFBekIsSUFBSSxLQUFLLFNBQUE7d0JBQ1gsSUFBSyxLQUFLLEdBQVcsS0FBSyxLQUFkLEtBQUssR0FBSSxLQUFLLEdBQUEsQ0FBQzt3QkFDM0Isb0JBQW9CLENBQUMsSUFBSSxDQUFDLDBCQUF3QixLQUFLLFdBQU0sS0FBSyxnQ0FBMkIsS0FBSyxXQUFNLEtBQUssT0FBSSxDQUFDLENBQUM7cUJBQ3BIO29CQUNELFVBQVUsR0FBRyxNQUFJLG9CQUFvQixDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBRyxDQUFDO2dCQUN4RCxDQUFDO2dCQUVELElBQUksWUFBWSxHQUFHLEVBQUUsQ0FBQztnQkFDdEIsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7b0JBQ3BDLElBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDO29CQUNwQyxJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQztvQkFDL0IsRUFBRSxDQUFBLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQzt3QkFDVixVQUFVLElBQUksTUFBTSxDQUFDO3dCQUNyQixVQUFVLEdBQUcsdUJBQXFCLE1BQU0sMkJBQ3BDLFVBQVUsb0JBQ1osQ0FBQztvQkFDTCxDQUFDO29CQUNELFlBQVksR0FBRyx3QkFBc0IsVUFBVSxhQUFVLENBQUM7Z0JBQzVELENBQUM7Z0JBQ0QsSUFBSSxlQUFlLEdBQUcsRUFBRSxDQUFDO2dCQUN6QixFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO29CQUNwRCxJQUFJLFVBQVUsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQztvQkFDckMsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUM7b0JBQy9CLEVBQUUsQ0FBQSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7d0JBQ1YsVUFBVSxJQUFJLE1BQU0sQ0FBQzt3QkFDckIsa0JBQWtCLEdBQUcseUJBQXVCLE1BQU0sMkJBQzlDLGtCQUFrQixvQkFDcEIsQ0FBQztvQkFDTCxDQUFDO29CQUNELGVBQWUsR0FBRywwQkFBd0IsVUFBVSwyRUFFcEMsSUFBSSxDQUFDLElBQUksZ0lBR0YsVUFBVSxrQ0FFL0IsQ0FBQztnQkFDTCxDQUFDO2dCQUNELElBQUksZUFBZSxHQUFHLEVBQUUsQ0FBQztnQkFDekIsSUFBSSxTQUFTLEdBQUcsRUFBRSxDQUFDO2dCQUNuQixFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztvQkFDZixTQUFTLEdBQUcsOEJBQThCLENBQUM7b0JBQzNDLElBQUksZUFBZSxHQUFNLFVBQVUsbUJBQWdCLENBQUE7b0JBQ25ELEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO3dCQUNuQyxlQUFlLEdBQUcsd0JBQXNCLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSwyQkFDckQsZUFBZSxvQkFDakIsQ0FBQzt3QkFDSCxTQUFTLEdBQUcseUJBQXVCLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSwyQkFDaEQsU0FBUyxvQkFDWCxDQUFDO29CQUNMLENBQUM7b0JBQ0QsZUFBZSxHQUFHLGlFQUVLLFVBQVUscUJBQy9CLGVBQWUsc0RBRWIsZUFBZSxzQkFDZixlQUFlLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxvREFFMUIsQ0FBQztnQkFDUCxDQUFDO2dCQUFDLElBQUksQ0FBQyxDQUFDO29CQUNOLGVBQWUsR0FBRyxrQkFBa0IsQ0FBQztvQkFDckMsU0FBUyxHQUFHLG9CQUFvQixDQUFBO2dCQUNsQyxDQUFDO2dCQUNELG9FQUFvRTtnQkFDcEUsNENBQTRDO2dCQUM1QyxFQUFFLENBQUEsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLElBQUksY0FBYyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUMvQyxJQUFJLEdBQUcsb0tBSUssWUFBWSwrQkFDWixPQUFPLElBQUksRUFBRSwrQkFDYixjQUFjLDhCQUNkLFVBQVUsMEhBR0osSUFBSSxDQUFDLElBQUksNkJBQ2YsQ0FBQztvQkFDYixLQUFLLENBQUM7Z0JBQ1IsQ0FBQztnQkFDRCxJQUFJLEdBQUcsZ01BS0csZUFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsK0RBRXhCLGtCQUFrQiw0QkFDbEIsU0FBUyw2QkFDVCxPQUFPLElBQUksRUFBRSw2QkFDYixjQUFjLG9DQUNOLElBQUksQ0FBQyxJQUFJLHlDQUNmLFVBQVUsdUZBR0YsSUFBSSxDQUFDLElBQUksNkJBQ25CLGVBQWUsNEJBQ2YsWUFBWSwwREFFWixDQUFDO2dCQUNiLEtBQUssQ0FBQztZQUNSLEtBQUssWUFBWTtnQkFDZixJQUFJLGFBQWEsR0FBRyxFQUFFLENBQUM7Z0JBQ3ZCLElBQUksYUFBYSxHQUFHLEVBQUUsQ0FBQztnQkFDdkIsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQztvQkFDdkMsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDM0MsSUFBSSxLQUFLLEdBQUcsRUFBRSxDQUFDO29CQUNmLEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQyxXQUFXLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQzt3QkFDakMsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7NEJBQzVCLEtBQUssR0FBRyxzQkFBb0IsT0FBTyxDQUFDLENBQUMsQ0FBQyxNQUFHLENBQUM7d0JBQzVDLENBQUM7d0JBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQzs0QkFDNUQsS0FBSyxHQUFHLFFBQU0sT0FBTyxDQUFDLENBQUMsQ0FBQyxVQUFLLE9BQU8sQ0FBQyxDQUFDLENBQUMsT0FBSSxDQUFDO3dCQUM5QyxDQUFDO3dCQUFDLElBQUksQ0FBQyxDQUFDOzRCQUNOLEtBQUssR0FBRyxzQkFBb0IsT0FBTyxDQUFDLENBQUMsQ0FBQyxXQUFNLE9BQU8sQ0FBQyxDQUFDLENBQUMsT0FBSSxDQUFDO3dCQUM3RCxDQUFDO29CQUNILENBQUM7b0JBQUMsSUFBSSxDQUFDLENBQUM7d0JBQ04sS0FBSyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUM7b0JBQ2xDLENBQUM7b0JBQ0QsYUFBYSxDQUFDLElBQUksQ0FBQyxnQkFBYyxRQUFRLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsYUFBUSxLQUFPLENBQUMsQ0FBQztvQkFDL0UsYUFBYSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDNUIsQ0FBQztnQkFDRCxJQUFJLElBQUksYUFBYSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxJQUFJLENBQUM7Z0JBQ3pDLElBQUksSUFBSSxzQkFBb0IsYUFBYSxDQUFDLElBQUksQ0FBQyxhQUFXLENBQUMsUUFBSyxDQUFDO2dCQUNqRSxJQUFJLElBQUksNEJBQTRCLENBQUM7Z0JBQ3JDLElBQUksSUFBSSxtQkFBbUIsQ0FBQztnQkFDNUIsS0FBSyxDQUFDO1lBQ1IsS0FBSyxZQUFZO2dCQUNmLElBQUksVUFBVSxHQUFHLDRCQUE0QixDQUFDO2dCQUM5QyxJQUFJLEdBQUcsR0FBRyxFQUFFLENBQUM7Z0JBQ2IsR0FBRyxDQUFBLENBQWEsVUFBVSxFQUFWLEtBQUEsSUFBSSxDQUFDLEtBQUssRUFBdEIsY0FBUSxFQUFSLElBQXNCLENBQUM7b0JBQXZCLElBQUksSUFBSSxTQUFBO29CQUNWLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUM7d0JBQUMsUUFBUSxDQUFDO29CQUMxQixVQUFVLElBQUksNkVBQTJFLElBQUksQ0FBQyxLQUFLLGdCQUFXLElBQUksQ0FBQyxFQUFFLGNBQVcsQ0FBQztvQkFDakksVUFBVSxJQUFJLCtGQUEwRixJQUFJLENBQUMsS0FBSywrQkFBdUIsSUFBSSxDQUFDLEVBQUUsVUFBTyxDQUFDO29CQUN4SixHQUFHLENBQUMsSUFBSSxDQUFDLFFBQU0sSUFBSSxDQUFDLEVBQUUsVUFBTyxDQUFDLENBQUM7aUJBQ2hDO2dCQUNELElBQUksR0FBRyx1QkFBcUIsR0FBRyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsbUJBQy9DLFVBQVksQ0FBQztnQkFDZixLQUFLLENBQUM7WUFDUixLQUFLLFFBQVE7Z0JBQ1gsSUFBSSxPQUFPLEdBQUcsRUFBRSxDQUFDO2dCQUNqQixHQUFHLENBQUEsQ0FBZSxVQUFTLEVBQVQsS0FBQSxJQUFJLENBQUMsSUFBSSxFQUF2QixjQUFVLEVBQVYsSUFBdUIsQ0FBQztvQkFBeEIsSUFBSSxNQUFNLFNBQUE7b0JBQ1osT0FBTyxDQUFDLElBQUksQ0FBSSxNQUFNLFVBQUssTUFBUSxDQUFDLENBQUM7aUJBQ3RDO2dCQUNELElBQUksSUFBSSxhQUFXLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQUksQ0FBQztnQkFDMUMsS0FBSyxDQUFDO1FBQ1YsQ0FBQztRQUNELE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQ0QsOEVBQThFO0lBQzlFLDJDQUEyQztJQUMzQywyQkFBVyxHQUFYLFVBQVksS0FBSztRQUNmLElBQUksT0FBTyxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN2QixJQUFJLGNBQWMsR0FBRyxFQUFFLENBQUM7UUFDeEIsK0NBQStDO1FBQy9DLEdBQUcsQ0FBQyxDQUFhLFVBQUssRUFBakIsaUJBQVEsRUFBUixJQUFpQixDQUFDO1lBQWxCLElBQUksSUFBSSxHQUFJLEtBQUssSUFBVDtZQUNYLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQzFCLElBQUksS0FBa0IsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBL0IsTUFBTSxVQUFFLEtBQUssUUFBa0IsQ0FBQztnQkFDckMsRUFBRSxDQUFDLENBQUMsTUFBTSxJQUFJLE9BQU8sQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO29CQUN6QixFQUFFLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQzVCLGNBQWMsQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUM7b0JBQzlCLENBQUM7b0JBQ0QsRUFBRSxDQUFBLENBQUMsQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7d0JBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxHQUFHLENBQUMsQ0FBQztnQkFDcEYsQ0FBQztZQUNILENBQUM7U0FDRjtRQUNELElBQUksT0FBTyxHQUFHLFVBQUMsS0FBSyxFQUFFLE1BQU07WUFDMUIsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDO1lBQ2QsRUFBRSxDQUFDLENBQUMsTUFBTSxJQUFJLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO2dCQUMzQixNQUFNLENBQUMsbUJBQW1CLENBQUM7WUFDN0IsQ0FBQztZQUNELElBQUksS0FBdUIsS0FBSyxDQUFDLE1BQU0sQ0FBQyxFQUFuQyxLQUFLLGFBQUUsRUFBRSxVQUFFLE9BQU8sYUFBaUIsQ0FBQztZQUN6QyxJQUFJLE9BQU8sR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDO1lBQ2pDLHFFQUFxRTtZQUNyRSxFQUFFLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUMsSUFBSSxNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7Z0JBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3hGLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxDQUFDLGNBQWMsQ0FBQztnQkFBQyxNQUFNLENBQUMsRUFBRSxDQUFDO1lBQ25DLElBQUksUUFBUSxHQUFHLEVBQUUsQ0FBQztZQUNsQixHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLGNBQWMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ25DLElBQUksS0FBb0IsY0FBYyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUExQyxRQUFRLFVBQUUsS0FBSyxRQUEyQixDQUFDO2dCQUNoRCxFQUFFLENBQUEsQ0FBQyxRQUFRLEtBQUssT0FBTyxDQUFDLEVBQUUsSUFBSSxjQUFjLENBQUMsUUFBUSxDQUFDLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztvQkFDckUsUUFBUSxDQUFDLElBQUksQ0FBQyxNQUFJLEdBQUcsY0FBUyxRQUFRLFVBQUssS0FBSyxPQUFJLENBQUMsQ0FBQztnQkFDeEQsQ0FBQztZQUNILENBQUM7WUFDRCxHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLE9BQU8sQ0FBQyxDQUFDLENBQUM7Z0JBQ3ZCLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDekIsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLFdBQVcsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDO29CQUMvQixRQUFRLENBQUMsSUFBSSxDQUFDLE1BQUksR0FBRyxXQUFNLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFHLENBQUMsQ0FBQztnQkFDdEQsQ0FBQztZQUNILENBQUM7WUFDRCxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBRWQsQ0FBQztZQUNELElBQUksSUFBSSwyQkFDUSxFQUFFLHFCQUFnQixLQUFLLFlBQU8sUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsdUNBQzNDLEVBQUUscUJBQWdCLEVBQUUsZUFBVSxFQUFFLHVCQUFrQixFQUFFLGtCQUFhLEVBQUUsZ0JBQVcsRUFBRSxzQ0FDbkYsRUFBRSxlQUFVLEVBQUUsZUFBVSxFQUFFLDRCQUNqQyxPQUFPLENBQUMsS0FBSyxFQUFFLE1BQU0sR0FBRyxDQUFDLENBQUMsa0NBRS9CLENBQUM7WUFDUixNQUFNLENBQUMsSUFBSSxDQUFDO1FBQ2QsQ0FBQyxDQUFBO1FBQ0QsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDNUIsQ0FBQztJQUNBLCtDQUErQixHQUEvQjtRQUNJLElBQUksSUFBSSxHQUFHLG9CQUFvQixDQUFDO1FBQ2hDLElBQUksUUFBUSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDNUMsSUFBSSxNQUFNLEdBQUcsRUFBRSxDQUFDO1FBQ2hCLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNYLEdBQUcsQ0FBQyxDQUFhLFVBQVEsRUFBcEIsb0JBQVEsRUFBUixJQUFvQixDQUFDO1lBQXJCLElBQUksSUFBSSxHQUFJLFFBQVEsSUFBWjtZQUNULHdDQUF3QztZQUN4QyxFQUFFLENBQUMsQ0FBQyxFQUFFLEtBQUssUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7Z0JBQUMsS0FBSyxDQUFDO1lBQ3RDLE1BQU0sQ0FBQyxJQUFJLENBQUMsMEJBQ0wsSUFBSSxDQUFDLEtBQUsseUJBQWtCLElBQUksQ0FBQyxLQUFLLG1EQUN2QixJQUFJLENBQUMsRUFBRSxxQkFBZSxJQUFJLENBQUMsS0FBSyxtREFDOUIsSUFBSSxDQUFDLEVBQUUsdUJBQWtCLElBQUksQ0FBQyxFQUFFLHFCQUFnQixJQUFJLENBQUMsRUFBRSx5QkFBb0IsSUFBSSxDQUFDLEVBQUUsb0JBQWUsSUFBSSxDQUFDLEVBQUUsa0JBQWEsSUFBSSxDQUFDLEVBQUUsMENBQ2pJLElBQUksQ0FBQyxFQUFFLHFCQUFnQixJQUFJLENBQUMsRUFBRSxpQkFBWSxJQUFJLENBQUMsRUFBRSxzQkFDdkUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLHlCQUV0QyxDQUFDLENBQUM7WUFDRyxFQUFFLEVBQUUsQ0FBQztTQUNSO1FBQ0QsSUFBSSxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDN0IsSUFBSSxJQUFJLEdBQUcsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3hCLElBQUksSUFBSSwwQkFDRyxJQUFJLENBQUMsS0FBSyx5QkFBa0IsSUFBSSxDQUFDLEtBQUssZ0VBQ1gsSUFBSSxDQUFDLEtBQUssd01BS3BDLENBQUM7UUFDYixNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFDRCxpQ0FBaUIsR0FBakIsVUFBa0IsT0FBTztRQUN2QixJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQ3JCLElBQUksZUFBZSxHQUFHLEVBQUUsQ0FBQztRQUN6QixJQUFJLGNBQWMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3RDLElBQUksT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNqQixJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLE9BQU8sQ0FBQztRQUMvQyxJQUFJLGVBQWUsR0FBRyxPQUFPLENBQUMseUJBQXlCLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFDL0QsSUFBSSxpQkFBaUIsR0FBRyxPQUFPLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFDNUQsSUFBSSxjQUFjLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLEtBQUssQ0FBQztRQUNoRCxJQUFJLGlCQUFpQixHQUFHLEVBQUUsQ0FBQztRQUMzQixJQUFJLE9BQU8sR0FBRyxFQUFFLENBQUE7UUFDaEIsR0FBRyxDQUFBLENBQWEsVUFBVSxFQUFWLEtBQUEsSUFBSSxDQUFDLEtBQUssRUFBdEIsY0FBUSxFQUFSLElBQXNCLENBQUM7WUFBdkIsSUFBSSxJQUFJLFNBQUE7WUFDVixJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ2pDLEVBQUUsQ0FBQSxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxNQUFNLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO2dCQUMzRCxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLElBQUksQ0FBQztnQkFDM0IsR0FBRyxDQUFBLENBQWUsVUFBYyxFQUFkLEtBQUEsTUFBTSxDQUFDLE9BQU8sRUFBNUIsY0FBVSxFQUFWLElBQTRCLENBQUM7b0JBQTdCLElBQUksTUFBTSxTQUFBO29CQUNaLElBQUksV0FBVyxHQUFHLGVBQWUsQ0FBQyxJQUFJLENBQUMsS0FBSyxHQUFHLEdBQUcsR0FBRyxNQUFNLENBQUMsSUFBSSxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7b0JBQ25GLEVBQUUsQ0FBQSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7d0JBQ2YsR0FBRyxDQUFBLENBQW1CLFVBQVcsRUFBN0IsdUJBQWMsRUFBZCxJQUE2QixDQUFDOzRCQUE5QixJQUFJLFVBQVUsR0FBSSxXQUFXLElBQWY7NEJBQ2hCLEVBQUUsQ0FBQSxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQ0FDeEMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxjQUFjLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQztnQ0FDM0MsSUFBSSxpQkFBaUIsR0FBRyxpQkFBaUIsQ0FBQyxVQUFVLENBQUMsY0FBYyxDQUFDLEdBQUcsR0FBRyxHQUFHLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQ0FDL0YsR0FBRyxDQUFBLENBQWdCLFVBQWlCLEVBQWhDLDZCQUFXLEVBQVgsSUFBZ0MsQ0FBQztvQ0FBakMsSUFBSSxPQUFPLEdBQUksaUJBQWlCLElBQXJCO29DQUNiLGlCQUFpQixDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztpQ0FDakM7NEJBQ0gsQ0FBQzs0QkFDRCxlQUFlLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO3lCQUNsQztvQkFDSCxDQUFDO2lCQUNGO1lBQ0gsQ0FBQztTQUNGO1FBQ0QsY0FBYyxDQUFDLFdBQVcsQ0FBQyxZQUFZLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztRQUM1RCxJQUFJLENBQUMsb0JBQW9CLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDMUMsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQztRQUMzQixHQUFHLENBQUEsQ0FBWSxVQUFlLEVBQTFCLDJCQUFPLEVBQVAsSUFBMEIsQ0FBQztZQUEzQixJQUFJLEdBQUcsR0FBSSxlQUFlLElBQW5CO1lBQ1QsSUFBSSxRQUFRLEdBQUcsY0FBYyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLEdBQUcsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDOUQsRUFBRSxDQUFBLENBQUMsQ0FBQyxRQUFRLElBQUksUUFBUSxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN0QyxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN4QixDQUFDO1NBQ0Y7UUFDRCxNQUFNLENBQUMsT0FBTyxDQUFDO0lBQ2pCLENBQUM7SUFDRCxnQ0FBZ0IsR0FBaEI7UUFDRSxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQztZQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDeEMsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDNUIsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDN0IsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQztZQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDaEMsR0FBRyxDQUFBLENBQWEsVUFBVSxFQUFWLEtBQUEsSUFBSSxDQUFDLEtBQUssRUFBdEIsY0FBUSxFQUFSLElBQXNCLENBQUM7WUFBdkIsSUFBSSxJQUFJLFNBQUE7WUFDVixFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDO2dCQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7U0FDL0I7UUFDRCxFQUFFLENBQUEsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDO1lBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztRQUNwQyxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUNELHVCQUFPLEdBQVA7UUFDRSxJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDdkIsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNoQyxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksUUFBUSxDQUFDLE1BQU0sRUFBRSxnQkFBZ0IsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3BGLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUMzQixJQUFJLENBQUMsb0JBQW9CLEdBQUcsSUFBSSxRQUFRLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQywrQkFBK0IsRUFBRSxDQUFDLENBQUM7UUFDOUYsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sSUFBSSxDQUFDLG9CQUFvQixHQUFHLFNBQVMsQ0FBQztRQUN4QyxDQUFDO1FBQ0QsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbkIsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUM7SUFDRCxvQkFBSSxHQUFKO1FBQ0UsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDZCxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDakIsQ0FBQztRQUNELElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDekIsSUFBSSxJQUFJLENBQUM7UUFDVCxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ1IsSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQy9DLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLElBQUksR0FBRyxFQUFFLENBQUM7UUFDWixDQUFDO1FBQ0QsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxzQkFBYyxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDbkUsQ0FBQztJQUNELCtCQUFlLEdBQWYsVUFBZ0IsT0FBTyxFQUFFLEtBQUs7UUFDNUIsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDZCxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDakIsQ0FBQztRQUNELEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUM7WUFDN0IsSUFBSSxhQUFhLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3ZELHFEQUFxRDtZQUNyRCw2REFBNkQ7WUFDN0QsU0FBUztZQUNULElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQztZQUNkLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDekIsSUFBSSxRQUFRLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDdEMsRUFBRSxDQUFBLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN2QixPQUFPLEVBQUUsR0FBRyxDQUFBLENBQVksVUFBYSxFQUF4Qix5QkFBTyxFQUFQLElBQXdCLENBQUM7b0JBQXpCLElBQUksR0FBRyxHQUFJLGFBQWEsSUFBakI7b0JBQ2xCLEdBQUcsQ0FBQSxDQUFZLFVBQVEsRUFBbkIsb0JBQU8sRUFBUCxJQUFtQixDQUFDO3dCQUFwQixJQUFJLEdBQUcsR0FBSSxRQUFRLElBQVo7d0JBQ1QsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFLLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7NEJBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQztxQkFDbEQ7b0JBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztpQkFDaEI7WUFDSCxDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ04sSUFBSSxHQUFHLGFBQWEsQ0FBQztZQUN2QixDQUFDO1lBQ0QsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLHNCQUFjLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztZQUN4RSxJQUFJLElBQUksR0FBRyxFQUFFLENBQUM7WUFDZCxJQUFJLFVBQVUsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDO1lBQ2hDLElBQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDdkMsSUFBSSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDdkQsSUFBSSxRQUFRLEdBQUcsa0JBQWtCLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO1lBQ3JFLEdBQUcsQ0FBQSxDQUFlLFVBQWEsRUFBYixLQUFBLFFBQVEsQ0FBQyxJQUFJLEVBQTNCLGNBQVUsRUFBVixJQUEyQixDQUFDO2dCQUE1QixJQUFJLE1BQU0sU0FBQTtnQkFDWixJQUFJLEVBQUUsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDO2dCQUNyQixFQUFFLENBQUEsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztvQkFDaEMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDcEIsQ0FBQzthQUNGO1lBQ0QsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUM1QixJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDL0MsSUFBSSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNyQyx3REFBd0Q7WUFDeEQsTUFBTSxDQUFDLEVBQUMsVUFBVSxFQUFFLE9BQU8sQ0FBQyxVQUFVLEVBQUUsTUFBQSxJQUFJLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxPQUFPLEVBQUMsQ0FBQztRQUMzRSxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDMUIsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDO1lBQ2QsSUFBSSxPQUFPLEdBQUcsRUFBRSxDQUFDO1lBQ2pCLElBQUksVUFBVSxHQUFHLEtBQUssQ0FBQyxRQUFRLENBQUM7WUFDaEMsSUFBSSxRQUFRLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUN2QyxJQUFJLFNBQVMsR0FBRyxFQUFFLENBQUM7WUFDbkIsR0FBRyxDQUFBLENBQWUsVUFBZSxFQUFmLEtBQUEsT0FBTyxDQUFDLE9BQU8sRUFBN0IsY0FBVSxFQUFWLElBQTZCLENBQUM7Z0JBQTlCLElBQUksTUFBTSxTQUFBO2dCQUNaLElBQUksRUFBRSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUM7Z0JBQ3JCLFNBQVMsQ0FBQyxFQUFFLENBQUMsR0FBRyxNQUFNLENBQUM7Z0JBQ3ZCLEVBQUUsQ0FBQSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO29CQUNoQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO2dCQUNwQixDQUFDO2FBQ0Y7WUFDRCxHQUFHLENBQUEsQ0FBYSxVQUFRLEVBQXBCLG9CQUFRLEVBQVIsSUFBb0IsQ0FBQztnQkFBckIsSUFBSSxJQUFJLEdBQUksUUFBUSxJQUFaO2dCQUNWLElBQUksS0FBSyxHQUFHLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDNUIsRUFBRSxDQUFBLENBQUMsS0FBSyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7b0JBQ3RCLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQ2xDLENBQUM7YUFDRjtZQUNELElBQUksUUFBUSxHQUFHLGtCQUFrQixDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztZQUNqRCxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1lBQzVCLElBQUksQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLEVBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUMsQ0FBQyxDQUFDO1lBQzlDLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUMvQyxJQUFJLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3JDLHlEQUF5RDtZQUN6RCxNQUFNLENBQUMsRUFBQyxVQUFVLEVBQUUsT0FBTyxDQUFDLFVBQVUsRUFBRSxJQUFJLEVBQUUsUUFBUSxDQUFDLElBQUksRUFBRSxPQUFPLEVBQUUsUUFBUSxDQUFDLE9BQU8sRUFBQyxDQUFDO1FBQzFGLENBQUM7SUFDSCxDQUFDO0lBQ0QscUJBQUssR0FBTDtRQUNFLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzNDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDckIsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQzFCLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDeEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUNyQixNQUFNLENBQUMsT0FBTyxDQUFDO0lBQ2pCLENBQUM7SUFDSCxZQUFDO0FBQUQsQ0E1M0JBLEFBNDNCQyxJQUFBO0FBNTNCWSxhQUFLLFFBNDNCakIsQ0FBQTtBQUVEO0lBVUUsZUFBWSxJQUFJLEVBQUUsSUFBZ0I7UUFBaEIsb0JBQWdCLEdBQWhCLGdCQUFnQjtRQUNoQyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUNqQixJQUFJLENBQUMsTUFBTSxHQUFHLEVBQUUsQ0FBQztRQUNqQixJQUFJLENBQUMsT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNsQixJQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQztRQUN4QixJQUFJLENBQUMsSUFBSSxHQUFHLEVBQUMsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFDLENBQUM7UUFDdEMsSUFBSSxDQUFDLEtBQUssR0FBRyxJQUFJLENBQUM7SUFDcEIsQ0FBQztJQUNELHlCQUFTLEdBQVQsVUFBVSxJQUFZO1FBQ3BCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUN2QixJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSxFQUFDLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUMsQ0FBQyxDQUFDO1FBQ25ELEdBQUcsQ0FBQSxDQUFlLFVBQVksRUFBWixLQUFBLElBQUksQ0FBQyxPQUFPLEVBQTFCLGNBQVUsRUFBVixJQUEwQixDQUFDO1lBQTNCLElBQUksTUFBTSxTQUFBO1lBQ1osRUFBRSxDQUFBLENBQUMsTUFBTSxDQUFDLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUN2QixJQUFJLE1BQU0sR0FBRyxZQUFJLEVBQUUsQ0FBQztnQkFDcEIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsRUFBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxRQUFBLE1BQU0sRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUMsQ0FBQyxDQUFDO2dCQUNyRSxJQUFJLENBQUMsR0FBRyxDQUFDLGVBQWUsRUFBRSxFQUFDLFFBQUEsTUFBTSxFQUFFLGFBQWEsRUFBRSxNQUFNLENBQUMsS0FBSyxFQUFDLENBQUMsQ0FBQztnQkFDakUsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLEtBQUssSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztvQkFDaEMsSUFBSSxNQUFNLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztvQkFDbkMsRUFBRSxDQUFBLENBQUMsTUFBTSxDQUFDLFdBQVcsS0FBSyxLQUFLLENBQUM7d0JBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxFQUFDLFFBQUEsTUFBTSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFFLE1BQU0sQ0FBQyxLQUFLLEVBQUUsVUFBVSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBQyxDQUFDLENBQUE7b0JBQ3BJLElBQUk7d0JBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyx5QkFBeUIsRUFBRSxFQUFDLFFBQUEsTUFBTSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBQyxDQUFDLENBQUM7Z0JBQ2pGLENBQUM7WUFFSCxDQUFDO1lBQUMsSUFBSTtnQkFBQyxNQUFNLElBQUksS0FBSyxDQUFDLDJCQUF5QixNQUFNLENBQUMsSUFBSSxNQUFHLENBQUMsQ0FBQztTQUNqRTtRQUNELE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQ0QsNEJBQVksR0FBWixVQUFhLE9BQU87UUFDbEIsRUFBRSxDQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUNoQixJQUFJLENBQUMsTUFBTSxHQUFHLGdCQUFnQixDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUN2RCxDQUFDO0lBQ0gsQ0FBQztJQUNELHFCQUFLLEdBQUwsVUFBTSxTQUFTLEVBQUUsT0FBTztRQUN0QixJQUFJLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQztRQUNsQixJQUFJLENBQUMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzNCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzVCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUMsSUFBSSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLFNBQUEsT0FBTyxFQUFDLENBQUMsQ0FBQztRQUMxRCxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUNELHFCQUFLLEdBQUw7UUFDRSxJQUFJLElBQUksR0FBRyxFQUFDLElBQUksRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBQyxDQUFDO1FBQ3pDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUMsSUFBSSxFQUFFLGFBQWEsRUFBRSxHQUFHLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDO1FBQ3ZFLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUMsSUFBSSxFQUFFLGFBQWEsRUFBRSxHQUFHLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDO1FBRTFFLElBQUksV0FBVyxHQUFHLElBQUksQ0FBQztRQUN2QixFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUNqQixXQUFXLEdBQUcsWUFBWSxDQUFDO1FBQy9CLENBQUM7UUFDRCxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksRUFBRSxhQUFhLEVBQUUsR0FBRyxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFDLENBQUMsQ0FBQztRQUU3RSxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7UUFDWCxHQUFHLENBQUEsQ0FBZSxVQUFZLEVBQVosS0FBQSxJQUFJLENBQUMsT0FBTyxFQUExQixjQUFVLEVBQVYsSUFBMEIsQ0FBQztZQUEzQixJQUFJLE1BQU0sU0FBQTtZQUNaLElBQUksTUFBTSxTQUFBLENBQUM7WUFDWCxFQUFFLENBQUEsQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ3ZCLE1BQU0sR0FBRyxFQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBQSxFQUFFLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBQyxJQUFJLEVBQUUsWUFBWSxFQUFFLFFBQUEsTUFBTSxFQUFFLElBQUEsRUFBRSxFQUFDLENBQUMsRUFBQyxDQUFDO1lBQzlFLENBQUM7WUFDRCxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQztnQkFDakIsSUFBSSxFQUFFLFFBQVE7Z0JBQ2QsSUFBQSxFQUFFO2dCQUNGLEtBQUssRUFBRSxNQUFNLENBQUMsS0FBSztnQkFDbkIsT0FBTyxFQUFFLE1BQU0sQ0FBQyxPQUFPO2dCQUN2QixRQUFRLEVBQUUsQ0FBQyxNQUFNLENBQUM7YUFDbkIsQ0FBQyxDQUFDO1lBQ0gsRUFBRSxFQUFFLENBQUM7U0FDTjtRQUNELElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUMsSUFBSSxFQUFFLGlCQUFpQixFQUFDLENBQUMsQ0FBQztRQUM5QyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUMsU0FBUyxFQUFFLFFBQVEsRUFBRSxZQUFZLENBQUMsRUFBQyxDQUFDLENBQUM7UUFDaEYsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUM7SUFDRCwwQkFBVSxHQUFWLFVBQVcsSUFBSTtRQUNiLElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUNkLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDckIsTUFBTSxDQUFBLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNaLEtBQUssT0FBTztnQkFDVixHQUFHLENBQUEsQ0FBYyxVQUFhLEVBQWIsS0FBQSxJQUFJLENBQUMsUUFBUSxFQUExQixjQUFTLEVBQVQsSUFBMEIsQ0FBQztvQkFBM0IsSUFBSSxLQUFLLFNBQUE7b0JBQ1gsSUFBSSxJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7aUJBQ2hDO2dCQUNELEtBQUssQ0FBQztZQUNSLEtBQUssYUFBYTtnQkFDaEIsSUFBSSxJQUFJLFNBQU8sSUFBSSxDQUFDLEdBQUcsV0FBTSxJQUFJLENBQUMsS0FBSyxRQUFLLENBQUM7Z0JBQzdDLEtBQUssQ0FBQztZQUNSLEtBQUssUUFBUTtnQkFDWCxJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDO2dCQUNqQixJQUFJLFlBQVksR0FBRyxFQUFFLENBQUM7Z0JBQ3RCLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7b0JBQzVCLElBQUksT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQ2hDLElBQUksS0FBSyxTQUFBLENBQUM7b0JBQ1YsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLFdBQVcsS0FBSyxLQUFLLElBQUksT0FBTyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUN6RCxJQUFLLEtBQUssR0FBSSxPQUFPLEdBQUEsQ0FBQzt3QkFDdEIsS0FBSyxHQUFHLGNBQVksRUFBRSxVQUFLLEtBQUssT0FBSSxDQUFDO29CQUN2QyxDQUFDO29CQUFDLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxPQUFPLENBQUMsV0FBVyxLQUFLLEtBQUssSUFBSSxPQUFPLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7d0JBQ2hFLElBQUssQ0FBQyxHQUFXLE9BQU8sS0FBaEIsS0FBSyxHQUFJLE9BQU8sR0FBQSxDQUFDO3dCQUN6QixLQUFLLEdBQUcsY0FBWSxFQUFFLFVBQUssS0FBSyxPQUFJLENBQUM7b0JBQ3ZDLENBQUM7b0JBQUMsSUFBSSxDQUFDLENBQUM7d0JBQ04sS0FBSyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUM7b0JBQ2xDLENBQUM7b0JBQ0QsWUFBWSxDQUFDLElBQUksQ0FBQyxNQUFJLEdBQUcsV0FBTSxLQUFPLENBQUMsQ0FBQTtnQkFDekMsQ0FBQztnQkFDRCxJQUFJLElBQUksbUJBQWlCLEVBQUUsb0JBQWUsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxVQUFPLENBQUM7Z0JBQ2pGLElBQUksSUFBSSxrQkFBZ0IsRUFBRSxxQkFBZ0IsRUFBRSxxQkFBZ0IsRUFBRSxzQkFBaUIsRUFBRSxrQkFBYSxFQUFFLGVBQVUsRUFBRSxZQUFTLENBQUE7Z0JBQ3JILElBQUksSUFBSSxrQkFBZ0IsRUFBRSxxQkFBZ0IsRUFBRSxjQUFTLEVBQUUsU0FBTSxDQUFDO2dCQUM5RCxJQUFJLElBQUksa0JBQWdCLEVBQUUsWUFBTyxZQUFZLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxTQUFNLENBQUE7Z0JBQzlELEdBQUcsQ0FBQSxDQUFjLFVBQWEsRUFBYixLQUFBLElBQUksQ0FBQyxRQUFRLEVBQTFCLGNBQVMsRUFBVCxJQUEwQixDQUFDO29CQUEzQixJQUFJLEtBQUssU0FBQTtvQkFDWCxJQUFJLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztpQkFDaEM7Z0JBQ0QsSUFBSSxJQUFJLEtBQUssQ0FBQztnQkFDZCxLQUFLLENBQUM7WUFDUixLQUFLLFFBQVE7Z0JBQ1gsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQztnQkFDakIsSUFBSSxJQUFJLGFBQVcsRUFBRSwyQkFBc0IsRUFBRSxTQUFNLENBQUM7Z0JBQ3BELElBQUksSUFBSSxjQUFZLEVBQUUsb0JBQWUsRUFBRSxRQUFLLENBQUM7Z0JBQzdDLElBQUksSUFBSSxnQkFBYyxFQUFFLHFCQUFnQixFQUFFLFFBQUssQ0FBQztnQkFDaEQsR0FBRyxDQUFBLENBQWMsVUFBYSxFQUFiLEtBQUEsSUFBSSxDQUFDLFFBQVEsRUFBMUIsY0FBUyxFQUFULElBQTBCLENBQUM7b0JBQTNCLElBQUksS0FBSyxTQUFBO29CQUNYLElBQUksSUFBSSxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO2lCQUNoQztnQkFDRCxLQUFLLENBQUM7WUFDUixLQUFLLGNBQWM7Z0JBQ2pCLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7Z0JBQ2pCLElBQUksSUFBSSw0QkFBMEIsRUFBRSxrQkFBZSxDQUFDO2dCQUNwRCxLQUFLLENBQUM7WUFDUixLQUFLLGlCQUFpQjtnQkFDcEIsSUFBSSxJQUFJLHVDQUF1QyxDQUFDO2dCQUNoRCxJQUFJLElBQUksK0ZBQStGLENBQUM7Z0JBQ3hHLElBQUksSUFBSSx1Q0FBdUMsQ0FBQTtnQkFDL0MsSUFBSSxJQUFJLG1DQUFtQyxDQUFDO2dCQUM1QyxJQUFJLElBQUkseUJBQXlCLENBQUM7Z0JBQ2xDLElBQUksSUFBSSw0QkFBNEIsQ0FBQztnQkFDckMsSUFBSSxJQUFJLHdCQUF3QixDQUFDO2dCQUNqQyxJQUFJLElBQUksS0FBSyxDQUFDO2dCQUNkLElBQUksSUFBSSxLQUFLLENBQUM7Z0JBQ2QsS0FBSyxDQUFDO1lBQ1IsS0FBSyxZQUFZO2dCQUNmLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO2dCQUMvQixJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDO2dCQUNqQixJQUFJLFVBQVUsR0FBRyw0QkFBNEIsQ0FBQztnQkFDOUMsVUFBVSxJQUFJLHVCQUFxQixJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLHNCQUFpQixFQUFFLHNDQUFpQyxNQUFNLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsc0JBQWlCLEVBQUUsY0FBVyxDQUFDO2dCQUMvSyxVQUFVLElBQUksOEJBQTRCLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMseUJBQW9CLEVBQUUsbURBQTJDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxxQ0FBNkIsRUFBRSxVQUFPLENBQUM7Z0JBQzNNLElBQUksR0FBRyx5QkFBc0IsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLHVCQUFpQixFQUFFLHdCQUN6RSxVQUFZLENBQUM7Z0JBQ2YsS0FBSyxDQUFDO1lBQ1IsS0FBSyxRQUFRO2dCQUNYLElBQUksSUFBSSxhQUFXLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFVBQUMsSUFBSSxJQUFLLE9BQUEsQ0FBRyxJQUFJLFVBQUssSUFBSSxDQUFFLEVBQWxCLENBQWtCLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQUksQ0FBQztnQkFDOUUsS0FBSyxDQUFDO1FBQ1YsQ0FBQztRQUNELE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQ0QsdUJBQU8sR0FBUDtRQUNFLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN2QixJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxRQUFRLENBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDaEUsSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFDbkIsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUM7SUFDRCxxQkFBSyxHQUFMO1FBQ0UsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQztRQUN6QyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2xCLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQ0Qsb0JBQUksR0FBSjtRQUNFLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ2QsSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ2pCLENBQUM7UUFDRCxJQUFJLE9BQU8sR0FBRyxFQUFFLENBQUE7UUFDaEIsR0FBRyxDQUFBLENBQWUsVUFBWSxFQUFaLEtBQUEsSUFBSSxDQUFDLE9BQU8sRUFBMUIsY0FBVSxFQUFWLElBQTBCLENBQUM7WUFBM0IsSUFBSSxNQUFNLFNBQUE7WUFDWixPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxLQUFLLENBQUM7U0FDN0Q7UUFDRCxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQztRQUM3RCxNQUFNLENBQUMsT0FBTyxDQUFDO0lBQ2pCLENBQUM7SUFDRCxpQ0FBaUIsR0FBakIsVUFBa0IsT0FBTztRQUN2QixJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBQ3JCLElBQUksZUFBZSxHQUFHLEVBQUUsQ0FBQztRQUN6QixJQUFJLGNBQWMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3RDLElBQUksT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNqQixJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLE9BQU8sQ0FBQztRQUMvQyxJQUFJLGVBQWUsR0FBRyxPQUFPLENBQUMseUJBQXlCLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFDL0QsSUFBSSxpQkFBaUIsR0FBRyxPQUFPLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxLQUFLLENBQUM7UUFDNUQsSUFBSSxjQUFjLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLEtBQUssQ0FBQztRQUNoRCxJQUFJLGlCQUFpQixHQUFHLEVBQUUsQ0FBQztRQUMzQixJQUFJLE9BQU8sR0FBRyxFQUFFLENBQUE7UUFDaEIsR0FBRyxDQUFBLENBQWUsVUFBWSxFQUFaLEtBQUEsSUFBSSxDQUFDLE9BQU8sRUFBMUIsY0FBVSxFQUFWLElBQTBCLENBQUM7WUFBM0IsSUFBSSxNQUFNLFNBQUE7WUFDWixJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ25DLEVBQUUsQ0FBQSxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxNQUFNLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO2dCQUM3RCxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLElBQUksQ0FBQztnQkFDN0IsR0FBRyxDQUFBLENBQWUsVUFBYyxFQUFkLEtBQUEsTUFBTSxDQUFDLE9BQU8sRUFBNUIsY0FBVSxFQUFWLElBQTRCLENBQUM7b0JBQTdCLElBQUksTUFBTSxTQUFBO29CQUNaLElBQUksV0FBVyxHQUFHLGVBQWUsQ0FBQyxNQUFNLENBQUMsS0FBSyxHQUFHLEdBQUcsR0FBRyxNQUFNLENBQUMsSUFBSSxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUE7b0JBQ3JGLEVBQUUsQ0FBQSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7d0JBQ2YsR0FBRyxDQUFBLENBQW1CLFVBQVcsRUFBN0IsdUJBQWMsRUFBZCxJQUE2QixDQUFDOzRCQUE5QixJQUFJLFVBQVUsR0FBSSxXQUFXLElBQWY7NEJBQ2hCLEVBQUUsQ0FBQSxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQ0FDeEMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxjQUFjLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQztnQ0FDM0MsSUFBSSxpQkFBaUIsR0FBRyxpQkFBaUIsQ0FBQyxVQUFVLENBQUMsY0FBYyxDQUFDLEdBQUcsR0FBRyxHQUFHLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQ0FDL0YsR0FBRyxDQUFBLENBQWdCLFVBQWlCLEVBQWhDLDZCQUFXLEVBQVgsSUFBZ0MsQ0FBQztvQ0FBakMsSUFBSSxPQUFPLEdBQUksaUJBQWlCLElBQXJCO29DQUNiLGlCQUFpQixDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztpQ0FDakM7NEJBQ0gsQ0FBQzs0QkFDRCxlQUFlLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO3lCQUNsQztvQkFDSCxDQUFDO2lCQUNGO1lBQ0gsQ0FBQztTQUNGO1FBQ0QsY0FBYyxDQUFDLFdBQVcsQ0FBQyxZQUFZLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztRQUM1RCxJQUFJLENBQUMsb0JBQW9CLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDMUMsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQztRQUMzQixHQUFHLENBQUEsQ0FBWSxVQUFlLEVBQTFCLDJCQUFPLEVBQVAsSUFBMEIsQ0FBQztZQUEzQixJQUFJLEdBQUcsR0FBSSxlQUFlLElBQW5CO1lBQ1QsSUFBSSxRQUFRLEdBQUcsY0FBYyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxHQUFHLEdBQUcsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDOUQsRUFBRSxDQUFBLENBQUMsQ0FBQyxRQUFRLElBQUksUUFBUSxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN0QyxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN4QixDQUFDO1lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2xDLElBQUksZ0JBQWdCLEdBQUcsRUFBRSxDQUFDO2dCQUMxQixvRUFBb0U7Z0JBQ3BFLHNFQUFzRTtnQkFDdEUsZ0VBQWdFO2dCQUNoRSxHQUFHLENBQUEsQ0FBZ0IsVUFBUSxFQUF2QixvQkFBVyxFQUFYLElBQXVCLENBQUM7b0JBQXhCLElBQUksT0FBTyxHQUFJLFFBQVEsSUFBWjtvQkFDYixzREFBc0Q7b0JBQ3RELEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7d0JBQUMsUUFBUSxDQUFDO29CQUNuQyxFQUFFLENBQUEsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxHQUFHLEdBQUcsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUN0RSxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7d0JBQy9CLFFBQVEsQ0FBQztvQkFDWCxDQUFDO29CQUNELHdDQUF3QztvQkFDeEMsSUFBSSxLQUFLLEdBQUcsY0FBYyxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLEdBQUcsR0FBRyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztvQkFDdEYsSUFBSSxNQUFNLEdBQUcsQ0FBQyxDQUFDO29CQUNmLG9FQUFvRTtvQkFDcEUsd0VBQXdFO29CQUN4RSx5RUFBeUU7b0JBQ3pFLGlFQUFpRTtvQkFDakUsT0FBTSxNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO3dCQUM1QixJQUFJLElBQUksR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7d0JBQ3pCLEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDOzRCQUN0QixNQUFNLEVBQUUsQ0FBQzs0QkFDVCxRQUFRLENBQUM7d0JBQ1gsQ0FBQzt3QkFDRCxJQUFJLFlBQVksR0FBRyxjQUFjLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLElBQUksR0FBRyxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO3dCQUMvRSxFQUFFLENBQUEsQ0FBQyxDQUFDLFlBQVksSUFBSSxZQUFZLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7NEJBQzlDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQzs0QkFDL0IsS0FBSyxDQUFDO3dCQUNSLENBQUM7d0JBQUMsSUFBSSxDQUFDLENBQUM7NEJBQ04sR0FBRyxDQUFBLENBQW9CLFVBQVksRUFBL0Isd0JBQWUsRUFBZixJQUErQixDQUFDO2dDQUFoQyxJQUFJLFdBQVcsR0FBSSxZQUFZLElBQWhCO2dDQUNqQixLQUFLLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDOzZCQUN6Qjs0QkFDRCxNQUFNLEVBQUUsQ0FBQzt3QkFDWCxDQUFDO29CQUNILENBQUM7aUJBQ0Y7Z0JBQ0QsRUFBRSxDQUFBLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztvQkFDM0IscUNBQXFDO29CQUNyQyxJQUFJLG1CQUFpQixHQUFHLEVBQUUsQ0FBQztvQkFDM0IsR0FBRyxDQUFBLENBQWdCLFVBQWdCLEVBQS9CLDRCQUFXLEVBQVgsSUFBK0IsQ0FBQzt3QkFBaEMsSUFBSSxPQUFPLEdBQUksZ0JBQWdCLElBQXBCO3dCQUNiLElBQUksaUJBQWlCLEdBQUcsaUJBQWlCLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7d0JBQ3pGLEdBQUcsQ0FBQSxDQUFnQixVQUFpQixFQUFoQyw2QkFBVyxFQUFYLElBQWdDLENBQUM7NEJBQWpDLElBQUksT0FBTyxHQUFJLGlCQUFpQixJQUFyQjs0QkFDYixtQkFBaUIsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7eUJBQ2pDO3FCQUNGO29CQUNELElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztvQkFDdkIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxZQUFZLEVBQUUsbUJBQWlCLENBQUMsQ0FBQztvQkFDbEQsSUFBSSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxDQUFDO29CQUNoQyx3RkFBd0Y7b0JBQ3hGLFFBQVE7b0JBQ1IsRUFBRSxDQUFBLENBQUMsQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsR0FBRyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxjQUFjLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEdBQUcsR0FBRyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFDbEgsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7b0JBQ3hCLENBQUM7Z0JBQ0gsQ0FBQztZQUNILENBQUM7U0FDRjtRQUNELE1BQU0sQ0FBQyxPQUFPLENBQUM7SUFDakIsQ0FBQztJQUNELCtCQUFlLEdBQWYsVUFBZ0IsT0FBTyxFQUFFLEtBQUs7UUFDNUIsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDZCxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDakIsQ0FBQztRQUVELElBQUksYUFBYSxHQUFHLEVBQUUsQ0FBQTtRQUN0QixHQUFHLENBQUEsQ0FBZSxVQUFZLEVBQVosS0FBQSxJQUFJLENBQUMsT0FBTyxFQUExQixjQUFVLEVBQVYsSUFBMEIsQ0FBQztZQUEzQixJQUFJLE1BQU0sU0FBQTtZQUNaLElBQUksS0FBSyxTQUFBLENBQUM7WUFDVixFQUFFLENBQUEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUMxQixLQUFLLEdBQUcsRUFBRSxDQUFDO1lBQ2IsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNOLEtBQUssR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FBQztZQUNyQyxDQUFDO1lBQ0QsYUFBYSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxLQUFLLENBQUM7U0FDckM7UUFDRCxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxhQUFhLENBQUMsQ0FBQztRQUNuRSxJQUFJLElBQUksR0FBRyxFQUFFLENBQUM7UUFDZCxJQUFJLFVBQVUsR0FBRyxLQUFLLENBQUMsUUFBUSxDQUFDO1FBQ2hDLElBQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDdkMsSUFBSSxnQkFBZ0IsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDdkQsSUFBSSxRQUFRLEdBQUcsa0JBQWtCLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ3JFLEdBQUcsQ0FBQSxDQUFlLFVBQWEsRUFBYixLQUFBLFFBQVEsQ0FBQyxJQUFJLEVBQTNCLGNBQVUsRUFBVixJQUEyQixDQUFDO1lBQTVCLElBQUksTUFBTSxTQUFBO1lBQ1osSUFBSSxFQUFFLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQztZQUNyQixFQUFFLENBQUEsQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztnQkFDaEMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNwQixDQUFDO1NBQ0Y7UUFDRCxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQzVCLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUMvQyxJQUFJLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3JDLE1BQU0sQ0FBQyxFQUFDLFVBQVUsRUFBRSxPQUFPLENBQUMsVUFBVSxFQUFFLE1BQUEsSUFBSSxFQUFFLE9BQU8sRUFBRSxRQUFRLENBQUMsT0FBTyxFQUFDLENBQUM7SUFDM0UsQ0FBQztJQUNILFlBQUM7QUFBRCxDQXJUQSxBQXFUQyxJQUFBO0FBclRZLGFBQUssUUFxVGpCLENBQUE7QUFFRCwyREFBMkQ7QUFDM0QscUJBQXFCO0FBQ3JCLDJEQUEyRDtBQUUzRCxPQUFPLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxFQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBQyxFQUFFLFVBQVMsSUFBSTtJQUN2RSxFQUFFLENBQUEsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ2YsSUFBSSxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUM7SUFDakIsQ0FBQztJQUNELElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUNiLE1BQU0sQ0FBQyxJQUFJLENBQUM7QUFDZCxDQUFDLENBQUMsQ0FBQztBQUVILE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLEVBQUMsU0FBUyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFDLEVBQUUsVUFBUyxJQUFJLEVBQUUsS0FBSztJQUMxRSxFQUFFLENBQUEsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ2IsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUM7SUFDZixDQUFDO0lBQ0QsSUFBSSxDQUFDLEdBQUcsSUFBSSxLQUFLLENBQUM7SUFDbEIsTUFBTSxDQUFDLElBQUksQ0FBQztBQUNkLENBQUMsQ0FBQyxDQUFDO0FBRUgsT0FBTyxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsRUFBQyxTQUFTLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUMsRUFBRSxVQUFTLElBQUksRUFBRSxLQUFLO0lBQ2xGLEVBQUUsQ0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDYixJQUFJLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQztRQUNiLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO0lBQ2pCLENBQUM7SUFDRCxJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDYixJQUFJLENBQUMsR0FBRyxJQUFJLEtBQUssQ0FBQztJQUNsQixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztJQUNyQyxNQUFNLENBQUMsSUFBSSxDQUFDO0FBQ2QsQ0FBQyxDQUFDLENBQUM7QUFFSCxPQUFPLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxFQUFDLE1BQU0sRUFBRSxXQUFXLEVBQUMsRUFBRSxVQUFTLElBQUk7SUFDOUQsRUFBRSxDQUFBLENBQUMsT0FBTyxJQUFJLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQztRQUM1QixNQUFNLENBQUMsRUFBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLFdBQVcsRUFBRSxFQUFDLENBQUM7SUFDdEMsQ0FBQztJQUNELE1BQU0sQ0FBQyxFQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUMsQ0FBQztBQUN4QixDQUFDLENBQUMsQ0FBQTtBQUVGLE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLEVBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFDLEVBQUUsVUFBUyxDQUFDLEVBQUUsQ0FBQztJQUM5RCxNQUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxPQUFPLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7QUFDbEQsQ0FBQyxDQUFDLENBQUM7QUFFSCxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxFQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBQyxFQUFFLFVBQVMsQ0FBQyxFQUFFLENBQUM7SUFDOUQsTUFBTSxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsT0FBTyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO0FBQ2xELENBQUMsQ0FBQyxDQUFDO0FBRUgsT0FBTyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsRUFBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUMsRUFBRSxVQUFTLENBQUMsRUFBRSxDQUFDO0lBQzlELE1BQU0sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLE9BQU8sQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztBQUNoRCxDQUFDLENBQUMsQ0FBQztBQUVILE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLEVBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFDLEVBQUUsVUFBUyxDQUFDLEVBQUUsQ0FBQztJQUM5RCxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxPQUFPLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUM7QUFDaEQsQ0FBQyxDQUFDLENBQUM7QUFFSCxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxFQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBQyxFQUFFLFVBQVMsQ0FBQyxFQUFFLENBQUM7SUFDOUQsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsT0FBTyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDO0FBQ2pELENBQUMsQ0FBQyxDQUFDO0FBRUgsT0FBTyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsRUFBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUMsRUFBRSxVQUFTLENBQUMsRUFBRSxDQUFDO0lBQzlELE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLE9BQU8sQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztBQUNqRCxDQUFDLENBQUMsQ0FBQztBQUVILE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLEVBQUMsTUFBTSxFQUFFLFFBQVEsRUFBQyxFQUFFLFVBQVMsQ0FBQyxFQUFFLENBQUM7SUFDbkQsTUFBTSxDQUFDLEVBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUMsQ0FBQztBQUN6QixDQUFDLENBQUMsQ0FBQztBQUVILE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLEVBQUMsTUFBTSxFQUFFLFFBQVEsRUFBQyxFQUFFLFVBQVMsQ0FBQyxFQUFFLENBQUM7SUFDbkQsTUFBTSxDQUFDLEVBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUMsQ0FBQztBQUN6QixDQUFDLENBQUMsQ0FBQztBQUVILE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLEVBQUMsTUFBTSxFQUFFLFFBQVEsRUFBQyxFQUFFLFVBQVMsQ0FBQyxFQUFFLENBQUM7SUFDbkQsTUFBTSxDQUFDLEVBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUMsQ0FBQztBQUN6QixDQUFDLENBQUMsQ0FBQztBQUVILE9BQU8sQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLEVBQUMsTUFBTSxFQUFFLFFBQVEsRUFBQyxFQUFFLFVBQVMsQ0FBQyxFQUFFLENBQUM7SUFDbkQsTUFBTSxDQUFDLEVBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUMsQ0FBQztBQUN6QixDQUFDLENBQUMsQ0FBQztBQUVILDJEQUEyRDtBQUMzRCxtQkFBbUI7QUFDbkIsMkRBQTJEO0FBRTNELHNDQUFzQztBQUN0Qyw2R0FBNkc7QUFDN0cscUNBQXFDO0FBQ3JDLG9EQUFvRDtBQUNwRCwrQ0FBK0M7QUFFL0MsOEJBQThCLEdBQUc7SUFFL0IsSUFBSSxnQkFBZ0IsR0FBRztRQUNyQixJQUFJLEVBQUUsVUFBQyxJQUFJO1lBQ1QsR0FBRyxDQUFBLENBQWEsVUFBaUIsRUFBakIsS0FBQSxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUE3QixjQUFRLEVBQVIsSUFBNkIsQ0FBQztnQkFBOUIsSUFBSSxJQUFJLFNBQUE7Z0JBQ1YsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyxPQUFPLENBQUM7b0JBQUMsUUFBUSxDQUFDO2dCQUNuQyxJQUFJLENBQUM7b0JBQ0gsSUFBSSxLQUFLLEdBQUcsT0FBTyxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ3JDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ3JCLENBQUU7Z0JBQUEsS0FBSyxDQUFBLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztvQkFDVixPQUFPLENBQUMsS0FBSyxDQUFDLHdCQUF3QixDQUFDLENBQUM7b0JBQ3hDLE9BQU8sQ0FBQyxLQUFLLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztvQkFDdkMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7b0JBQ3JCLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQ2hELENBQUM7YUFDRjtZQUNELE1BQU0sQ0FBQyxFQUFFLENBQUM7UUFDWixDQUFDO0tBQ0YsQ0FBQTtJQUVELEdBQUcsQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDdkMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQ3pELEdBQUcsQ0FBQyxRQUFRLENBQUMsZUFBZSxFQUFFLENBQUMsUUFBUSxFQUFFLGFBQWEsQ0FBQyxDQUFDLENBQUM7SUFDekQsR0FBRyxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLFFBQVEsRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUM7SUFDNUUsR0FBRyxDQUFDLFFBQVEsQ0FBQyx5QkFBeUIsRUFBRSxDQUFDLFFBQVEsRUFBRSxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztJQUNyRSxHQUFHLENBQUMsUUFBUSxDQUFDLHVCQUF1QixFQUFFLENBQUMsUUFBUSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUM7SUFDeEYsR0FBRyxDQUFDLFFBQVEsQ0FBQyxzQkFBc0IsRUFBRSxDQUFDLFFBQVEsRUFBRSxZQUFZLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztJQUV4RSxHQUFHLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsR0FBRyxnQkFBZ0IsQ0FBQztJQUMzRCxHQUFHLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsR0FBRyxnQkFBZ0IsQ0FBQztJQUM3RCxHQUFHLENBQUMsS0FBSyxDQUFDLGVBQWUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsR0FBRyxnQkFBZ0IsQ0FBQztJQUNwRSxHQUFHLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxHQUFHLGdCQUFnQixDQUFDO0lBQ3JFLEdBQUcsQ0FBQyxLQUFLLENBQUMseUJBQXlCLENBQUMsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLEdBQUcsZ0JBQWdCLENBQUM7SUFDOUUsR0FBRyxDQUFDLEtBQUssQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsR0FBRyxnQkFBZ0IsQ0FBQztJQUM1RSxHQUFHLENBQUMsS0FBSyxDQUFDLHNCQUFzQixDQUFDLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxHQUFHLGdCQUFnQixDQUFDO0lBRTNFLE1BQU0sQ0FBQyxHQUFHLENBQUM7QUFDYixDQUFDO0FBRUQsaUJBQXdCLElBQUksRUFBRSxNQUFNO0lBQ2xDLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLEVBQUMsSUFBSSxFQUFFLE1BQU0sRUFBQyxDQUFDLENBQUM7SUFDaEQsRUFBRSxDQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ1QsTUFBTSxJQUFJLEtBQUssQ0FBQyx1QkFBcUIsTUFBTSxNQUFHLENBQUMsQ0FBQztJQUNsRCxDQUFDO0lBQ0QsSUFBSSxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUN2QyxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxFQUFDLElBQUksRUFBRSxNQUFNLEVBQUMsQ0FBQyxDQUFDO0lBQ2xELEVBQUUsQ0FBQSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUNaLE1BQU0sSUFBSSxLQUFLLENBQUMsVUFBUSxNQUFNLHFCQUFrQixDQUFDLENBQUM7SUFDcEQsQ0FBQztJQUNELHFCQUFxQjtJQUNyQixPQUFPLENBQUMsSUFBSSxDQUFDLFVBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSyxPQUFBLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBWCxDQUFXLENBQUMsQ0FBQztJQUNwQyxHQUFHLENBQUEsQ0FBZSxVQUFPLEVBQXJCLG1CQUFVLEVBQVYsSUFBcUIsQ0FBQztRQUF0QixJQUFJLE1BQU0sR0FBSSxPQUFPLElBQVg7UUFDWixJQUFJLFVBQVUsR0FBRyxNQUFNLENBQUMsSUFBSSxDQUFDO1FBQzdCLEVBQUUsQ0FBQSxDQUFDLFVBQVUsS0FBSyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQzFCLElBQUksS0FBSyxHQUFHLEVBQUUsQ0FBQztZQUNmLEdBQUcsQ0FBQSxDQUFxQixVQUEwRCxFQUExRCxLQUFBLElBQUksQ0FBQyxJQUFJLENBQUMsc0JBQXNCLEVBQUUsRUFBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLE1BQU0sRUFBQyxDQUFDLEVBQTlFLGNBQWdCLEVBQWhCLElBQThFLENBQUM7Z0JBQS9FLElBQUksWUFBWSxTQUFBO2dCQUNsQixLQUFLLENBQUMsWUFBWSxDQUFDLFlBQVksQ0FBQyxDQUFDLEdBQUcsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2FBQzNEO1lBQ0QsUUFBUSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUN4QixDQUFDO1FBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLFVBQVUsS0FBSyxNQUFNLElBQUksVUFBVSxLQUFLLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDMUQsSUFBSSxNQUFNLEdBQUcsRUFBRSxDQUFDO1lBQ2hCLElBQUksUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLEVBQUUsRUFBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLE1BQU0sRUFBQyxDQUFDLENBQUM7WUFDM0UsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFDLENBQUMsRUFBRSxDQUFDLElBQUssT0FBQSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQVgsQ0FBVyxDQUFDLENBQUM7WUFDckMsR0FBRyxDQUFBLENBQWdCLFVBQVEsRUFBdkIsb0JBQVcsRUFBWCxJQUF1QixDQUFDO2dCQUF4QixJQUFJLE9BQU8sR0FBSSxRQUFRLElBQVo7Z0JBQ2IsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUMxRTtZQUNELEVBQUUsQ0FBQSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO2dCQUNqQixRQUFRLENBQUMsVUFBVSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDL0IsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNOLE1BQU0sSUFBSSxLQUFLLENBQUksVUFBVSwrQkFBMEIsTUFBTSxDQUFDLE1BQVEsQ0FBQyxDQUFBO1lBQ3pFLENBQUM7UUFDSCxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLGdCQUFnQixFQUFFLEVBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxNQUFNLEVBQUMsQ0FBQyxDQUFDO1lBQ3BFLElBQUksYUFBYSxHQUFHLEVBQUUsQ0FBQztZQUN2QixHQUFHLENBQUEsQ0FBZ0IsVUFBUSxFQUF2QixvQkFBVyxFQUFYLElBQXVCLENBQUM7Z0JBQXhCLElBQUksT0FBTyxHQUFJLFFBQVEsSUFBWjtnQkFDYixJQUFJLFFBQU0sR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7Z0JBQ2xDLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztnQkFDaEMsRUFBRSxDQUFBLENBQUMsVUFBVSxLQUFLLE9BQU8sSUFBSSxVQUFVLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztvQkFDdEQsYUFBYSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUN4QyxDQUFDO2dCQUFDLElBQUksQ0FBQyxDQUFDO29CQUNOLGFBQWEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7Z0JBQ2hELENBQUM7YUFDRjtZQUNELElBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMseUJBQXlCLEVBQUUsRUFBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLE1BQU0sRUFBQyxDQUFDLENBQUM7WUFDOUUsR0FBRyxDQUFBLENBQWlCLFVBQVMsRUFBekIscUJBQVksRUFBWixJQUF5QixDQUFDO2dCQUExQixJQUFJLFFBQVEsR0FBSSxTQUFTLElBQWI7Z0JBQ2QsYUFBYSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDO2FBQy9DO1lBQ0QsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLEVBQUUsRUFBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLE1BQU0sRUFBQyxDQUFDLENBQUM7WUFDcEUsRUFBRSxDQUFBLENBQUMsQ0FBQyxNQUFNLElBQUksVUFBVSxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3ZDLE1BQU0sSUFBSSxLQUFLLENBQUksVUFBVSxxQ0FBZ0MsTUFBTSxNQUFHLENBQUMsQ0FBQztZQUMxRSxDQUFDO1lBQ0QsRUFBRSxDQUFBLENBQUMsVUFBVSxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7Z0JBQzVCLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLEVBQUUsYUFBYSxFQUFFLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUM1RSxDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ04sUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQ3RDLENBQUM7UUFDSCxDQUFDO0tBQ0Y7SUFDRCxNQUFNLENBQUMsUUFBUSxDQUFDO0FBQ2xCLENBQUM7QUE1RGUsZUFBTyxVQTREdEIsQ0FBQTtBQUVELDJEQUEyRDtBQUMzRCxhQUFhO0FBQ2IsMkRBQTJEO0FBRTlDLGVBQU8sR0FBRyxDQUFDLEVBQUMsT0FBTyxFQUFFLElBQUksRUFBQyxDQUFDLENBQUM7QUFDNUIsWUFBSSxHQUFHLEVBQUUsQ0FBQztBQUV2QjtJQUNFLElBQUksSUFBSSxHQUFHLElBQUksT0FBTyxFQUFFLENBQUM7SUFDekIsa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDekIsb0JBQW9CLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDM0IsTUFBTSxDQUFDLElBQUksQ0FBQztBQUNkLENBQUM7QUFMZSxlQUFPLFVBS3RCLENBQUE7QUFFRCxFQUFFLENBQUEsQ0FBQyxXQUFHLEtBQUssU0FBUyxDQUFDO0lBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFHLE9BQU8sQ0FBQzs7O0FDdm9FbEQsSUFBWSxVQUFVLFdBQU0sWUFBWSxDQUFDLENBQUE7QUFDekMsc0JBQTBJLFNBQVMsQ0FBQyxDQUFBO0FBQ3BKLHdCQUEwQixXQUFXLENBQUMsQ0FBQTtBQUN0QywrQkFBMkIsa0JBQWtCLENBQUMsQ0FBQTtBQUU5QyxJQUFZLElBQUksV0FBTSxRQUFRLENBQUMsQ0FBQTtBQUMvQixvQkFBK0YsT0FBTyxDQUFDLENBQUE7QUFDdkcsdUJBQXVCLFVBQVUsQ0FBQyxDQUFBO0FBQ2xDLDhCQUEwRCxpQkFBaUIsQ0FBQyxDQUFBO0FBRzVFLFdBQVksSUFBSTtJQUFHLCtCQUFJLENBQUE7SUFBRSxtQ0FBTSxDQUFBO0lBQUUsbUNBQU0sQ0FBQTtBQUFDLENBQUMsRUFBN0IsWUFBSSxLQUFKLFlBQUksUUFBeUI7QUFBekMsSUFBWSxJQUFJLEdBQUosWUFBNkIsQ0FBQTtBQUFBLENBQUM7QUFDMUMsSUFBSyxLQUEwQjtBQUEvQixXQUFLLEtBQUs7SUFBRyxpQ0FBSSxDQUFBO0lBQUUsNkNBQVUsQ0FBQTtBQUFDLENBQUMsRUFBMUIsS0FBSyxLQUFMLEtBQUssUUFBcUI7QUFBQSxDQUFDO0FBRWhDLDZEQUE2RDtBQUM3RCxJQUFJLGFBQWEsR0FBRyxFQUFFLENBQUM7QUFFdkIsZ0ZBQWdGO0FBQ2hGLFFBQVE7QUFDUixnRkFBZ0Y7QUFDckUsZUFBTyxHQVNkO0lBQ0YsTUFBTSxFQUFFO1FBQ04sTUFBTSxFQUFFLEVBQUU7UUFDVixLQUFLLEVBQUUsRUFBRTtRQUNULFdBQVcsRUFBRSxFQUFFO1FBQ2YsVUFBVSxFQUFFLEVBQUU7S0FDZjtJQUNELElBQUksRUFBRSxFQUFFO0lBQ1IsTUFBTSxFQUFFLEVBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUM7Q0FDNUQsQ0FBQztBQUVGLDJEQUEyRDtBQUMzRCxRQUFRO0FBQ1IsMkRBQTJEO0FBRTNELHdCQUF3QixLQUFLO0lBQzNCLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztBQUN6QixDQUFDO0FBRUQsZ0JBQXVCLE1BQWEsRUFBRSxRQUFlLEVBQUUsT0FBZ0I7SUFDckUsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUN0QyxFQUFFLENBQUEsQ0FBQyxNQUFNLEtBQUssSUFBSSxDQUFDO1FBQUMsTUFBTSxDQUFDLENBQUMsOEJBQThCO0lBRTFELElBQUksR0FBRyxDQUFDO0lBQ1IsRUFBRSxDQUFBLENBQUMsUUFBUSxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUM7UUFBQyxHQUFHLEdBQUcsR0FBRyxDQUFDO0lBQ3BDLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxJQUFJLEtBQUssUUFBUSxDQUFDO1FBQUMsR0FBRyxHQUFHLGNBQVksZUFBTyxDQUFDLFFBQVEsQ0FBRyxDQUFDO0lBQ2pFLElBQUk7UUFBQyxHQUFHLEdBQUcsT0FBSyxlQUFPLENBQUMsSUFBSSxDQUFDLFNBQUksZUFBTyxDQUFDLFFBQVEsQ0FBRyxDQUFDO0lBQ3JELElBQUksS0FBSyxHQUFHLEVBQUMsUUFBQSxNQUFNLEVBQUUsVUFBQSxRQUFRLEVBQUMsQ0FBQztJQUMvQixNQUFNLENBQUMsUUFBUSxDQUFDLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUMxQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBRTdCLEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQztRQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDMUQsSUFBSTtRQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7QUFDbEQsQ0FBQztBQWRlLGNBQU0sU0FjckIsQ0FBQTtBQUVELDJEQUEyRDtBQUMzRCxhQUFhO0FBQ2IsMkRBQTJEO0FBQzNELFlBQVMsQ0FBQyxpQkFBaUIsRUFBRSxVQUFDLE9BQVksRUFBRSxFQUE2QztRQUE1QyxNQUFNLGNBQUUsS0FBSztJQUN4RCxJQUFJLEtBQUssR0FBRyxlQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxlQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFDLE9BQUEsS0FBSyxFQUFDLENBQUM7SUFDckYsS0FBSyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7QUFDdkIsQ0FBQyxDQUFDLENBQUM7QUFDSCxZQUFTLENBQUMsZUFBZSxFQUFFLFVBQUMsT0FBWSxFQUFFLEVBQThIO1FBQTdILE1BQU0sY0FBRSxLQUFLLGFBQUUsSUFBSSxZQUFFLENBQUMsU0FBRSxDQUFDLFNBQUUsUUFBUTtJQUM1RSxLQUFLLEdBQUcsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3JCLElBQUksUUFBUSxHQUFHLFNBQUcsQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLEVBQUMsSUFBSSxFQUFFLEtBQUssRUFBQyxDQUFDLENBQUM7SUFDdkQsRUFBRSxDQUFBLENBQUMsUUFBUSxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUM7UUFBQyxLQUFLLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztJQUNqRCxJQUFJLElBQUksQ0FBQztJQUNULEVBQUUsQ0FBQSxDQUFDLE1BQU0sS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ25CLGFBQWEsR0FBRyxFQUFFLENBQUM7SUFDckIsQ0FBQztJQUFDLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDcEIsSUFBSSxNQUFNLEdBQUcsU0FBRyxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsRUFBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBQyxDQUFDLENBQUM7UUFDekQsRUFBRSxDQUFBLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUNWLGFBQWEsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsMEJBQTBCO1FBQ2pFLENBQUM7SUFDSCxDQUFDO0lBRUQsRUFBRSxDQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ1QsSUFBSSxLQUFLLEdBQUcsZUFBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsZUFBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksRUFBQyxPQUFBLEtBQUssRUFBQyxDQUFDO1FBQ3JGLEtBQUssQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ3BCLEtBQUssQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDO1FBQ3RCLElBQUksR0FBRyxZQUFJLENBQUMsU0FBRyxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsRUFBQyxJQUFJLEVBQUUsTUFBTSxFQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3BELElBQUksQ0FBQyxJQUFJLEdBQUcsU0FBUyxDQUFDO1FBQ3RCLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO1FBQ3RCLE9BQU8sQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLEVBQUMsSUFBSSxFQUFFLE1BQU0sRUFBQyxDQUFDLENBQUM7UUFDMUMsSUFBSSxRQUFRLEdBQUcsU0FBRyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxFQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUMsQ0FBQyxDQUFDO1FBQzVELEdBQUcsQ0FBQSxDQUFxQixVQUFRLEVBQTVCLG9CQUFnQixFQUFoQixJQUE0QixDQUFDO1lBQTdCLElBQVUsS0FBSyxHQUFLLFFBQVEsU0FBWjtZQUNsQixPQUFPLENBQUMsTUFBTSxDQUFDLGtCQUFrQixFQUFFLEVBQUMsSUFBSSxFQUFFLEtBQUssRUFBQyxDQUFDLENBQUM7WUFDbEQsT0FBTyxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsRUFBQyxJQUFJLEVBQUUsS0FBSyxFQUFDLENBQUMsQ0FBQztTQUMxQztRQUNELE9BQU8sQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLEVBQUUsRUFBQyxNQUFNLEVBQUUsTUFBTSxFQUFDLENBQUMsQ0FBQztRQUNuRCxFQUFFLENBQUEsQ0FBQyxDQUFDLFFBQVEsQ0FBQztZQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDdEMsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ04sSUFBSSxNQUFNLEdBQUcsU0FBRyxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsRUFBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBQyxDQUFDLENBQUM7UUFDekQsSUFBSSxVQUFVLENBQUM7UUFDZixFQUFFLENBQUEsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDWCxVQUFVLEdBQUcsWUFBSSxFQUFFLENBQUM7UUFDdEIsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sVUFBVSxHQUFHLE1BQU0sQ0FBQyxJQUFJLENBQUM7WUFDekIsT0FBTyxDQUFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsRUFBQyxJQUFJLEVBQUUsVUFBVSxFQUFDLENBQUMsQ0FBQztRQUNoRCxDQUFDO1FBQ0QsSUFBSSxLQUFLLEdBQUcsZUFBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQUcsRUFBQyxPQUFBLEtBQUssRUFBQyxDQUFDO1FBQ3hELElBQUksR0FBRyxFQUFDLFFBQVEsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBQyxDQUFDO1FBQzlELEVBQUUsQ0FBQSxDQUFDLENBQUMsTUFBTSxJQUFJLE1BQU0sS0FBSyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQ3BDLEVBQUUsQ0FBQSxDQUFDLENBQUMsS0FBSyxTQUFTLElBQUksQ0FBQyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3RDLE9BQU8sQ0FBQyxNQUFNLENBQUMsa0JBQWtCLEVBQUUsRUFBQyxJQUFJLEVBQUUsVUFBVSxFQUFDLENBQUMsQ0FBQztnQkFDdkQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRSxFQUFDLElBQUksRUFBRSxVQUFVLEVBQUUsR0FBQSxDQUFDLEVBQUUsR0FBQSxDQUFDLEVBQUMsQ0FBQyxDQUFDO1lBQzVELENBQUM7WUFDRCxPQUFPLENBQUMsTUFBTSxDQUFDLGdCQUFnQixFQUFFLEVBQUMsTUFBTSxFQUFFLE1BQU0sRUFBQyxDQUFDLENBQUM7WUFDbkQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxFQUFDLElBQUksRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBQyxDQUFDLENBQUM7UUFDcEUsQ0FBQztRQUNELE1BQU0sR0FBRyxVQUFVLENBQUM7SUFDdEIsQ0FBQztJQUNELE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLElBQUksQ0FBQyxDQUFDO0FBQy9CLENBQUMsQ0FBQyxDQUFDO0FBRUgsWUFBUyxDQUFDLGNBQWMsRUFBRSxVQUFDLE9BQVksRUFBRSxFQUFLO0lBQzVDLElBQUksS0FBSyxHQUFHLFNBQUcsQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLEVBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUMsQ0FBQyxDQUFDO0lBQ3hELEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDVCxJQUFJLE1BQU0sR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDO1FBQ3hCLE9BQU8sQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLEVBQUMsSUFBSSxFQUFFLE1BQU0sRUFBQyxDQUFDLENBQUM7UUFDMUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxrQkFBa0IsRUFBRSxFQUFDLElBQUksRUFBRSxNQUFNLEVBQUMsQ0FBQyxDQUFDO0lBQ3JELENBQUM7SUFDRCxhQUFhLEdBQUcsRUFBRSxDQUFDO0FBQ3JCLENBQUMsQ0FBQyxDQUFDO0FBRUgsWUFBUyxDQUFDLHVCQUF1QixFQUFFLFVBQUMsT0FBWSxFQUFFLEVBQXdCO1FBQXZCLE1BQU07SUFDdkQsSUFBSSxLQUFLLEdBQUcsZUFBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsZUFBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksRUFBQyxLQUFLLEVBQUUsRUFBRSxFQUFDLENBQUM7SUFDekYsS0FBSyxDQUFDLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7QUFDM0IsQ0FBQyxDQUFDLENBQUM7QUFFSCxZQUFTLENBQUMsaUJBQWlCLEVBQUUsVUFBQyxPQUFZLEVBQUUsR0FBeUU7SUFDbkgsRUFBRSxDQUFBLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUNmLEdBQUcsQ0FBQyxNQUFNLEdBQUcsWUFBSSxFQUFFLENBQUM7SUFDdEIsQ0FBQztJQUNELE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0FBQ2xDLENBQUMsQ0FBQyxDQUFDO0FBRUgsWUFBUyxDQUFDLG9CQUFvQixFQUFFLFVBQUMsT0FBWSxFQUFFLEdBQWtDO0lBQzdFLE9BQU8sQ0FBQyxNQUFNLENBQUMsYUFBYSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0FBQ3ZDLENBQUMsQ0FBQyxDQUFDO0FBRUgsWUFBUyxDQUFDLGFBQWEsRUFBRSxVQUFDLE9BQVksRUFBRSxFQUFnRDtRQUEvQyxJQUFJLFlBQUUsT0FBTztJQUNwRCxPQUFPLENBQUMsTUFBTSxDQUFDLGNBQWMsRUFBRSxFQUFDLE1BQUEsSUFBSSxFQUFDLENBQUMsQ0FBQztJQUN2QyxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxFQUFDLE1BQUEsSUFBSSxFQUFFLFNBQUEsT0FBTyxFQUFDLENBQUMsQ0FBQztJQUM3QyxJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDN0IsSUFBSSxLQUFLLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUNsQyxJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxLQUFLLEtBQUssQ0FBQyxDQUFDLEdBQUcsS0FBSyxHQUFHLFNBQVMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3JFLElBQUssTUFBTSxHQUFJLFNBQUcsQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLEVBQUMsTUFBQSxJQUFJLEVBQUMsQ0FBQyxPQUFBLENBQUM7SUFDbEQsSUFBSSxNQUE4QixTQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxFQUFDLEVBQUUsRUFBRSxNQUFNLEVBQUMsQ0FBQyxJQUFJLEVBQUUsUUFBdkUsUUFBUSxtQkFBRyxTQUFTLEtBQW1ELENBQUM7SUFDbEYsRUFBRSxDQUFBLENBQUMsSUFBSSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDckIsT0FBTyxDQUFDLE1BQU0sQ0FBQyxjQUFjLEVBQUUsRUFBQyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUMsQ0FBQyxDQUFDO1FBQzdELE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLEVBQUMsRUFBRSxFQUFFLE1BQU0sRUFBRSxNQUFBLElBQUksRUFBQyxDQUFDLENBQUM7UUFDaEQsSUFBSSxLQUFLLEdBQUcsZ0JBQVcsRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNyQyxFQUFFLENBQUEsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQy9ELE1BQU0sQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxNQUFJLGVBQU8sQ0FBQyxJQUFJLENBQUMsU0FBSSxlQUFPLENBQUMsTUFBTSxDQUFHLENBQUMsQ0FBQztRQUNsRyxDQUFDO0lBQ0gsQ0FBQztBQUNILENBQUMsQ0FBQyxDQUFDO0FBQ0gsWUFBUyxDQUFDLGVBQWUsRUFBRSxVQUFDLE9BQVksRUFBRSxFQUFpQztRQUFoQyxNQUFNLGNBQUUsSUFBSSwwQkFBRSxJQUFJLG1CQUFHLFVBQVU7SUFDeEUsT0FBTztTQUNKLEdBQUcsQ0FBQyxhQUFhLEVBQUUsRUFBQyxRQUFBLE1BQU0sRUFBRSxNQUFBLElBQUksRUFBQyxDQUFDO1NBQ2xDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsRUFBQyxFQUFFLEVBQUUsTUFBTSxFQUFFLE1BQUEsSUFBSSxFQUFDLENBQUMsQ0FBQztBQUM3QyxDQUFDLENBQUMsQ0FBQztBQUNILFlBQVMsQ0FBQyxhQUFhLEVBQUUsVUFBQyxPQUFZLEVBQUUsRUFBNEQ7UUFBM0QsSUFBSSw2QkFBRSxPQUFPLG1CQUFHLFNBQVM7SUFDaEUsRUFBRSxDQUFBLENBQUMsT0FBTyxLQUFLLFNBQVMsQ0FBQztRQUFDLE9BQU8sR0FBRyx5REFBeUQsQ0FBQztJQUM5RixPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxFQUFDLE1BQUEsSUFBSSxFQUFFLFNBQUEsT0FBTyxFQUFDLENBQUMsQ0FBQztBQUMvQyxDQUFDLENBQUMsQ0FBQztBQUNILFlBQVMsQ0FBQyxjQUFjLEVBQUUsVUFBQyxPQUFZLEVBQUUsRUFBYTtRQUFaLEVBQUUsVUFBRSxPQUFPO0lBQ25ELElBQUksSUFBSSxHQUFHLFlBQUksRUFBRSxDQUFDO0lBQ2xCLE9BQU87U0FDSixHQUFHLENBQUMsY0FBYyxFQUFFLEVBQUMsTUFBQSxJQUFJLEVBQUUsT0FBTyxFQUFFLE1BQUksT0FBTyxXQUFRLEVBQUMsQ0FBQztTQUN6RCxHQUFHLENBQUMsYUFBYSxFQUFFLEVBQUMsSUFBQSxFQUFFLEVBQUUsTUFBQSxJQUFJLEVBQUMsQ0FBQztTQUM5QixHQUFHLENBQUMsY0FBYyxFQUFFLEVBQUMsSUFBQSxFQUFFLEVBQUUsU0FBQSxPQUFPLEVBQUMsQ0FBQztTQUNsQyxHQUFHLENBQUMsYUFBYSxFQUFFLEVBQUMsTUFBTSxFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxpQkFBUyxDQUFDLE9BQU8sQ0FBQyxFQUFDLENBQUM7U0FDOUUsR0FBRyxDQUFDLGFBQWEsRUFBRSxFQUFDLE1BQU0sRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFDLENBQUMsQ0FBQztJQUMxRSxJQUFJLFNBQVMsR0FBRyxpQkFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ2xDLEVBQUUsQ0FBQSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUM7UUFBQyxPQUFPLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUMzRCxHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsTUFBTSxJQUFJLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ2xDLE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLEVBQUMsTUFBTSxFQUFFLEVBQUUsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUMsQ0FBQyxDQUFDO1FBQy9FLElBQUksTUFBSSxHQUFHLFNBQVMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDbEQsRUFBRSxDQUFBLENBQUMsQ0FBQyxTQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxFQUFDLEVBQUUsRUFBRSxNQUFNLEVBQUMsQ0FBQyxJQUFJLE1BQUksQ0FBQztZQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLEVBQUMsRUFBRSxFQUFFLE1BQU0sRUFBRSxNQUFBLE1BQUksRUFBQyxDQUFDLENBQUM7UUFDdkcsT0FBTyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxTQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ3hELENBQUM7QUFDSCxDQUFDLENBQUMsQ0FBQztBQUVILFlBQVMsQ0FBQyxjQUFjLEVBQUUsVUFBQyxPQUFZLEVBQUUsRUFBTztRQUFOLEtBQUs7SUFDN0MsRUFBRSxDQUFBLENBQUMsU0FBRyxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsRUFBQyxPQUFBLEtBQUssRUFBQyxDQUFDLENBQUM7UUFBQyxNQUFNLENBQUM7SUFDL0MsS0FBSyxHQUFHLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNyQixJQUFJLE1BQU0sR0FBRyxxQkFBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzVCLEVBQUUsQ0FBQSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEtBQUssMEJBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQzNDLElBQUksU0FBUyxHQUFHLGlCQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1FBQ3JELEVBQUUsQ0FBQSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUM7WUFBQyxPQUFPLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMzRCxJQUFJLE1BQU0sQ0FBQztRQUNYLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxNQUFNLElBQUksU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDbEMsRUFBRSxDQUFBLENBQUMsQ0FBQyxNQUFNLENBQUM7Z0JBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztZQUM1QixJQUFJLE1BQUksR0FBRyxTQUFTLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQ2xELEVBQUUsQ0FBQSxDQUFDLENBQUMsU0FBRyxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsRUFBQyxFQUFFLEVBQUUsTUFBTSxFQUFDLENBQUMsSUFBSSxNQUFJLENBQUM7Z0JBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsRUFBQyxFQUFFLEVBQUUsTUFBTSxFQUFFLE1BQUEsTUFBSSxFQUFDLENBQUMsQ0FBQztZQUN2RyxPQUFPLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsU0FBUyxDQUFDLFNBQUcsQ0FBQyxDQUFDLENBQUM7UUFDeEQsQ0FBQztRQUNELE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLEVBQUMsT0FBQSxLQUFLLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBQyxDQUFDLENBQUE7SUFDakQsQ0FBQztBQUNILENBQUMsQ0FBQyxDQUFDO0FBRUgsaUdBQWlHO0FBQ2pHLFlBQVMsQ0FBQyxvQkFBb0IsRUFBRSxVQUFDLE9BQVksRUFBRSxFQUFPO1FBQU4sS0FBSztJQUNuRCxJQUFJLFNBQVMsR0FBRyxpQkFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2hDLEVBQUUsQ0FBQSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUM7UUFBQyxPQUFPLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUMzRCxHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsTUFBTSxJQUFJLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ2xDLElBQUksTUFBSSxHQUFHLFNBQVMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDbEQsRUFBRSxDQUFBLENBQUMsQ0FBQyxTQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxFQUFDLEVBQUUsRUFBRSxNQUFNLEVBQUMsQ0FBQyxJQUFJLE1BQUksQ0FBQztZQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLEVBQUMsRUFBRSxFQUFFLE1BQU0sRUFBRSxNQUFBLE1BQUksRUFBQyxDQUFDLENBQUM7UUFDdkcsT0FBTyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxTQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ3hELENBQUM7QUFDSCxDQUFDLENBQUMsQ0FBQTtBQUVGLFlBQVMsQ0FBQyx5QkFBeUIsRUFBRSxVQUFDLE9BQVksRUFBRSxFQUEwQjtRQUF6QixNQUFNLGNBQUUsU0FBUyxpQkFBRSxLQUFLO0lBQzNFLE9BQU8sQ0FBQyxNQUFNLENBQUMsYUFBYSxFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUUsV0FBQSxTQUFTLEVBQUUsT0FBQSxLQUFLLEVBQUMsQ0FBQyxDQUFDO0lBQzFELDJEQUEyRDtBQUM3RCxDQUFDLENBQUMsQ0FBQztBQUNILFlBQVMsQ0FBQyx5QkFBeUIsRUFBRSxVQUFDLE9BQVksRUFBRSxFQUFnQztRQUEvQixNQUFNLGNBQUUsU0FBUyxpQkFBRSxJQUFJLFlBQUUsS0FBSztJQUNqRixrQ0FBa0M7SUFDbEMsSUFBSSxNQUF3QixTQUFHLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxFQUFDLFFBQUEsTUFBTSxFQUFFLFdBQUEsU0FBUyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUMsQ0FBQyxJQUFJLEVBQUUsVUFBekYsTUFBTSxtQkFBRyxVQUFVLEtBQXNFLENBQUM7SUFDL0YsRUFBRSxDQUFBLENBQUMsSUFBSSxLQUFLLFNBQVMsQ0FBQztRQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsYUFBYSxFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUUsV0FBQSxTQUFTLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBQyxDQUFDLENBQUM7SUFDdkYsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsRUFBQyxRQUFBLE1BQU0sRUFBRSxXQUFBLFNBQVMsRUFBRSxPQUFBLEtBQUssRUFBRSxRQUFBLE1BQU0sRUFBQyxDQUFDLENBQUM7QUFDakUsQ0FBQyxDQUFDLENBQUM7QUFDSCxZQUFTLENBQUMseUJBQXlCLEVBQUUsVUFBQyxPQUFZLEVBQUUsRUFBZ0M7UUFBL0IsTUFBTSxjQUFFLFNBQVMsaUJBQUUsSUFBSSxZQUFFLEtBQUs7SUFDakYsa0NBQWtDO0lBQ2xDLElBQUksTUFBd0IsU0FBRyxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsRUFBQyxRQUFBLE1BQU0sRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLE9BQUEsS0FBSyxFQUFDLENBQUMsSUFBSSxFQUFFLFVBQXpGLE1BQU0sbUJBQUcsVUFBVSxLQUFzRSxDQUFDO0lBQy9GLEVBQUUsQ0FBQSxDQUFDLElBQUksS0FBSyxTQUFTLENBQUM7UUFBQyxPQUFPLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRSxFQUFDLFFBQUEsTUFBTSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsT0FBQSxLQUFLLEVBQUMsQ0FBQyxDQUFDO0lBQ3ZGLE9BQU8sQ0FBQyxHQUFHLENBQUMsYUFBYSxFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUUsV0FBQSxTQUFTLEVBQUUsT0FBQSxLQUFLLEVBQUUsUUFBQSxNQUFNLEVBQUMsQ0FBQyxDQUFDO0FBQ2pFLENBQUMsQ0FBQyxDQUFDO0FBQ0gsWUFBUyxDQUFDLFlBQVksRUFBRSxVQUFDLE9BQVksRUFBRSxFQUF1QjtRQUF0QixHQUFHLFdBQUUsS0FBSyxhQUFFLFNBQVM7SUFDM0QsSUFBSSxLQUFLLEdBQUcsZUFBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksRUFBQyxLQUFLLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUMsQ0FBQztJQUNsRixFQUFFLENBQUEsQ0FBQyxLQUFLLEtBQUssU0FBUyxDQUFDO1FBQUMsS0FBSyxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7SUFDNUMsRUFBRSxDQUFBLENBQUMsU0FBUyxLQUFLLFNBQVMsQ0FBQztRQUFDLEtBQUssQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO0lBQ3hELGVBQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEtBQUssQ0FBQztBQUNwQyxDQUFDLENBQUMsQ0FBQztBQUNILFlBQVMsQ0FBQyxpQkFBaUIsRUFBRSxVQUFDLE9BQVksRUFBRSxFQUEwQjtRQUF6QixNQUFNLDRCQUFFLElBQUksbUJBQUcsU0FBUztJQUNuRSxJQUFJLEtBQUssR0FBRyxlQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUMsUUFBUSxFQUFFLEtBQUssRUFBQyxDQUFDO0lBQ3RELEtBQUssQ0FBQyxRQUFRLEdBQUcsSUFBSSxLQUFLLFNBQVMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDO0lBQzdELGVBQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsS0FBSyxDQUFDO0FBQy9CLENBQUMsQ0FBQyxDQUFDO0FBQ0gsWUFBUyxDQUFDLGlCQUFpQixFQUFFLFVBQUMsT0FBWSxFQUFFLEVBQStCO1FBQTlCLFdBQVcsaUNBQUUsSUFBSSxtQkFBRyxTQUFTO0lBQ3hFLElBQUksS0FBSyxHQUFHLGVBQU8sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxJQUFJLEVBQUMsSUFBSSxFQUFFLEtBQUssRUFBQyxDQUFDO0lBQ3JFLEtBQUssQ0FBQyxJQUFJLEdBQUcsSUFBSSxLQUFLLFNBQVMsR0FBRyxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDO0lBQ3JELGVBQU8sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLFdBQVcsQ0FBQyxHQUFHLEtBQUssQ0FBQztBQUNsRCxDQUFDLENBQUMsQ0FBQztBQUNILFlBQVMsQ0FBQyxlQUFlLEVBQUUsVUFBQyxPQUFZLEVBQUUsRUFBMEQ7d0JBQXpELE1BQU0sbUJBQUcsU0FBUyx1QkFBRSxNQUFNLG1CQUFHLFNBQVMscUJBQUUsSUFBSSxtQkFBRyxTQUFTO0lBQ2pHLElBQUksS0FBSyxHQUFHLGVBQU8sQ0FBQyxNQUFNLENBQUM7SUFDM0IsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLE1BQU0sS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQzNCLEtBQUssQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3RCLEtBQUssQ0FBQyxJQUFJLEdBQUcsSUFBSSxLQUFLLFNBQVMsR0FBRyxJQUFJLEdBQUcsSUFBSSxDQUFDO1FBQzlDLEtBQUssQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO0lBQ3hCLENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNOLEtBQUssQ0FBQyxJQUFJLEtBQUssU0FBUyxHQUFHLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUM7SUFDaEQsQ0FBQztJQUNELGVBQU8sQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO0FBQ3pCLENBQUMsQ0FBQyxDQUFDO0FBQ0gsWUFBUyxDQUFDLGVBQWUsRUFBRSxVQUFDLE9BQVksRUFBRSxFQUFRO1FBQVAsTUFBTTtJQUMvQyxPQUFPLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRSxFQUFDLFFBQUEsTUFBTSxFQUFDLENBQUM7U0FDcEMsTUFBTSxDQUFDLGNBQWMsRUFBRSxFQUFDLEVBQUUsRUFBRSxNQUFNLEVBQUMsQ0FBQztTQUNwQyxNQUFNLENBQUMsYUFBYSxFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUMsQ0FBQztTQUMvQixNQUFNLENBQUMsYUFBYSxFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUMsQ0FBQyxDQUFDO0FBQ3JDLENBQUMsQ0FBQyxDQUFDO0FBRUgsMkRBQTJEO0FBQzNELGtCQUFrQjtBQUNsQiwyREFBMkQ7QUFDM0Q7SUFDRSxJQUFJLEtBQUssR0FBRyxFQUFFLENBQUM7SUFDZixHQUFHLENBQUEsQ0FBc0IsVUFBbUIsRUFBbkIsS0FBQSxTQUFHLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxFQUF4QyxjQUFpQixFQUFqQixJQUF3QyxDQUFDO1FBQXpDLElBQVUsTUFBTSxjQUFDO1FBQ25CLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7S0FDMUI7SUFDRCxFQUFFLENBQUEsQ0FBQyxlQUFPLENBQUMsTUFBTSxDQUFDLElBQUksSUFBSSxlQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sSUFBSSxDQUFDLGVBQU8sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUMxRSxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUMsQ0FBQyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRTtnQkFDcEQsZUFBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLEVBQUU7YUFDeEIsRUFBQyxDQUFDLENBQUM7SUFDTixDQUFDO0lBQ0QsTUFBTSxDQUFDLEVBQUMsQ0FBQyxFQUFFLFdBQVcsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLFdBQVcsRUFBQyxDQUFDO0FBQzNFLENBQUM7QUFYZSxZQUFJLE9BV25CLENBQUE7QUFFRCxnREFBZ0Q7QUFDaEQsSUFBSSxVQUFVLEdBQStIO0lBQzNJLEdBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFFLFVBQUMsTUFBTSxFQUFFLFFBQVEsSUFBSyxPQUFBLENBQUM7UUFDbEMsQ0FBQyxFQUFFLFlBQVk7UUFDZixNQUFNLEVBQUUsRUFBQyxDQUFDLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFO2dCQUM3QyxFQUFDLENBQUMsRUFBRSxlQUFlLEVBQUUsSUFBSSxFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUMsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUM7Z0JBQy9ELFdBQVcsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDO2dCQUM3QixFQUFDLENBQUMsRUFBRSxrQkFBa0IsRUFBRSxRQUFRLEVBQUU7d0JBQ2hDLEVBQUMsQ0FBQyxFQUFFLDRCQUE0QixFQUFFLEtBQUssRUFBRSxvQkFBb0IsRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLFFBQUEsTUFBTSxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUM7cUJBQ2hILEVBQUM7YUFDSCxFQUFDO0tBQ0gsQ0FBQyxFQVRpQyxDQVNqQztJQUNGLEdBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFFLFVBQUMsTUFBTSxFQUFFLFFBQVE7UUFDOUIsSUFBSSxNQUFNLEdBQUcsU0FBRyxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxFQUFDLElBQUksRUFBRSxNQUFNLEVBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3JFLE1BQU0sQ0FBQztZQUNMLENBQUMsRUFBRSxRQUFRO1lBQ1gsYUFBYSxFQUFFLElBQUk7WUFDbkIsTUFBTSxFQUFFLEVBQUMsQ0FBQyxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLFFBQVEsRUFBRTtvQkFDckMsRUFBQyxDQUFDLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxrQkFBa0IsRUFBRSxLQUFLLEVBQUUsY0FBYyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBQyxFQUFFLEVBQUM7aUJBQ3ZILEVBQUM7U0FDSCxDQUFDO0lBQ0osQ0FBQztJQUNELEdBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFFLFVBQUMsTUFBTSxFQUFFLFFBQVEsSUFBSyxPQUFBLENBQUM7UUFDcEMsQ0FBQyxFQUFFLFFBQVE7UUFDWCxNQUFNLEVBQUUsRUFBQyxDQUFDLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFO2dCQUM3QyxFQUFDLENBQUMsRUFBRSxpQkFBaUIsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFDO2dCQUN0QyxFQUFDLENBQUMsRUFBRSxtQkFBbUIsRUFBRSxRQUFRLEVBQUU7d0JBQ2pDLEVBQUMsQ0FBQyxFQUFFLG9CQUFvQixFQUFDO3dCQUN6QixFQUFDLENBQUMsRUFBRSxpQkFBaUIsRUFBQzt3QkFDdEIsRUFBQyxDQUFDLEVBQUUsaUJBQWlCLEVBQUM7cUJBQ3ZCLEVBQUM7YUFDSCxFQUFDO0tBQ0gsQ0FBQyxFQVZtQyxDQVVuQzs7Q0FDSCxDQUFDO0FBRUYsb0JBQW9CLEtBQUssRUFBRSxJQUFJO0lBQzdCLGNBQVEsQ0FBQyxlQUFlLEVBQUUsRUFBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUM3RixDQUFDO0FBQ0QscUJBQXFCLEtBQUssRUFBRSxJQUFJO0lBQzlCLEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxNQUFNLEtBQUssS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7UUFDeEMsY0FBUSxDQUFDLGVBQWUsRUFBRSxFQUFDLElBQUksRUFBRSxLQUFLLEVBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ3BELENBQUM7QUFDSCxDQUFDO0FBRUQsd0JBQXdCLEtBQUssRUFBRSxJQUFJO0lBQ2pDLGNBQVEsQ0FBQyxjQUFjLEVBQUUsRUFBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBQyxDQUFDO1NBQzlDLFFBQVEsQ0FBQyxlQUFlLEVBQUUsRUFBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLFFBQVEsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBQyxDQUFDO1NBQ3BFLE1BQU0sRUFBRSxDQUFDO0FBQ1osQ0FBQztBQUVELHFCQUFxQixLQUFLLEVBQUUsSUFBSTtJQUM5QixFQUFFLENBQUEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7UUFDM0IsSUFBSSxLQUFLLEdBQUcsY0FBUSxDQUFDLGNBQWMsRUFBRSxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsa0JBQWtCLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDMUUsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLFFBQU0sSUFBSSxlQUFPLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7WUFDNUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxzQkFBc0IsRUFBRSxFQUFDLFFBQUEsUUFBTSxFQUFDLENBQUMsQ0FBQztRQUNuRCxDQUFDO1FBQ0QsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ2pCLENBQUM7QUFDSCxDQUFDO0FBRUQsc0JBQXNCLEtBQVcsRUFBRSxJQUFJO0lBQ3JDLElBQUksTUFBTSxHQUFxQixLQUFLLENBQUMsTUFBTSxDQUFDO0lBQzVDLEVBQUUsQ0FBQSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUM7UUFBQyxNQUFNLENBQUM7SUFDaEMsRUFBRSxDQUFBLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1FBQUMsTUFBTSxJQUFJLEtBQUssQ0FBQyxvQ0FBb0MsQ0FBQyxDQUFDO0lBQ2xGLElBQUksSUFBSSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDM0IsSUFBSSxNQUFNLEdBQUcsSUFBSSxVQUFVLEVBQUUsQ0FBQztJQUM5QixNQUFNLENBQUMsTUFBTSxHQUFHLFVBQVMsS0FBUztRQUNoQyxJQUFJLFVBQVUsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQztRQUNyQyxTQUFHLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3JCLGNBQVEsQ0FBQyxlQUFlLEVBQUUsRUFBQyxNQUFNLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ3pFLENBQUMsQ0FBQztJQUNGLE1BQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDMUIsQ0FBQztBQUVEO0lBQ0UsTUFBTSxDQUFDLEVBQUMsQ0FBQyxFQUFFLDRCQUE0QixFQUFFLFFBQVEsRUFBRTtZQUNqRCxFQUFDLENBQUMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUU7b0JBQ3JDLEVBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsaUJBQWlCLEVBQUM7b0JBQ2xDLEVBQUMsQ0FBQyxFQUFFLFdBQVcsRUFBQztvQkFDaEIsRUFBQyxDQUFDLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFFLGlCQUFpQixFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUMsQ0FBQyxFQUFDO2lCQUN4RSxFQUFDO1lBQ0YsRUFBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSx3RkFBd0YsRUFBQztZQUMzRyxFQUFDLENBQUMsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFO29CQUN4QixFQUFDLENBQUMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLFlBQVksRUFBRSxJQUFJLEVBQUUsMkJBQTJCLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBQztvQkFDdEYsRUFBQyxDQUFDLEVBQUUsV0FBVyxFQUFDO29CQUNoQixFQUFDLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFDO2lCQUNsRCxFQUFDO1NBQ0gsRUFBQyxDQUFDO0FBQ0wsQ0FBQztBQUVEO0lBQ0UsWUFBWSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ3JCLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUM7QUFDM0IsQ0FBQztBQUdEO0lBQ0UsSUFBSSxVQUFVLEdBQUcsWUFBWSxDQUFDLHdCQUFrQixDQUFDLENBQUM7SUFDbEQsTUFBTSxDQUFDLEVBQUMsQ0FBQyxFQUFFLDBCQUEwQixFQUFFLFFBQVEsRUFBRTtZQUMvQyxFQUFDLENBQUMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUU7b0JBQ3JDLEVBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFDO29CQUMxQixFQUFDLENBQUMsRUFBRSxXQUFXLEVBQUM7b0JBQ2hCLEVBQUMsQ0FBQyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFDLENBQUMsRUFBRSxpQkFBaUIsRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFDLENBQUMsRUFBQztpQkFDeEUsRUFBQztZQUNGLEVBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsd0RBQXdELEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBQztTQUMxSSxFQUFDLENBQUM7QUFDTCxDQUFDO0FBRUQ7SUFDRSxJQUFJLFVBQVUsR0FBRyxZQUFZLENBQUMsd0JBQWtCLENBQUMsQ0FBQztJQUNsRCxNQUFNLENBQUMsRUFBQyxDQUFDLEVBQUUsMEJBQTBCLEVBQUUsUUFBUSxFQUFFO1lBQy9DLEVBQUMsQ0FBQyxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRTtvQkFDckMsRUFBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUM7b0JBQzFCLEVBQUMsQ0FBQyxFQUFFLFdBQVcsRUFBQztvQkFDaEIsRUFBQyxDQUFDLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFFLGlCQUFpQixFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUMsQ0FBQyxFQUFDO2lCQUN4RSxFQUFDO1lBQ0YsRUFBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLFFBQVEsRUFBRTtvQkFDakIsRUFBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxnR0FBZ0csRUFBQztvQkFDbkgsRUFBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUM7b0JBQ3ZFLEVBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFDO2lCQUM3QixFQUFDO1lBQ0YsRUFBQyxDQUFDLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLGdCQUFnQixFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUM7U0FDekUsRUFBQyxDQUFDO0FBQ0wsQ0FBQztBQUVEO0lBQ0UsTUFBTSxDQUFDLEVBQUMsQ0FBQyxFQUFFLDBCQUEwQixFQUFFLFFBQVEsRUFBRTtZQUMvQyxFQUFDLENBQUMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUU7b0JBQ3JDLEVBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFDO29CQUMxQixFQUFDLENBQUMsRUFBRSxXQUFXLEVBQUM7b0JBQ2hCLEVBQUMsQ0FBQyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFDLENBQUMsRUFBRSxpQkFBaUIsRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFDLENBQUMsRUFBQztpQkFDeEUsRUFBQztZQUNGLEVBQUMsSUFBSSxFQUFFLGtDQUFrQyxFQUFDO1NBQzNDLEVBQUMsQ0FBQztBQUNMLENBQUM7QUFFRCxjQUFxQixNQUFhO0lBQ2hDLCtCQUErQjtJQUMvQixJQUFJLEtBQTJDLFNBQUcsQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLEVBQUMsSUFBSSxFQUFFLE1BQU0sRUFBQyxDQUFDLElBQUksRUFBRSxvQkFBdEYsUUFBUSxtQkFBRyxTQUFTLHFCQUFFLElBQUksbUJBQUcsSUFBSSxDQUFDLElBQUksS0FBZ0QsQ0FBQztJQUM1RixJQUFJLFVBQVUsR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbEMsRUFBRSxDQUFBLENBQUMsQ0FBQyxVQUFVLENBQUM7UUFBQyxNQUFNLElBQUksS0FBSyxDQUFDLHlCQUF1QixJQUFJLFdBQU0sSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFHLENBQUMsQ0FBQztJQUNoRixJQUFJLEtBQTJDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLEVBQXBFLEtBQUssU0FBRSxNQUFNLGNBQUUsTUFBTSxjQUFFLGFBQWEsbUJBQWdDLENBQUM7SUFDNUUsSUFBSSxPQUFPLENBQUM7SUFDWixJQUFJLE9BQU8sR0FBRyxTQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxFQUFDLElBQUksRUFBRSxRQUFRLEVBQUMsQ0FBQyxJQUFJLFNBQUcsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLEVBQUMsRUFBRSxFQUFFLFFBQVEsRUFBQyxDQUFDLENBQUM7SUFFM0csSUFBSSxXQUFXLEdBQUcsUUFBUSxDQUFDO0lBQzNCLEVBQUUsQ0FBQSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN6QixPQUFPLEdBQUcsTUFBTSxDQUFDLGlCQUFTLENBQUMsTUFBTSxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBRXBELENBQUM7SUFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzdDLFdBQVcsR0FBRyxRQUFRLENBQUM7UUFDdkIsT0FBTyxHQUFHLE1BQU0sQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNsRSxDQUFDO0lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDbEIsSUFBSSxPQUFPLEdBQU8sRUFBRSxDQUFDO1FBQ3JCLE9BQU8sR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3RELENBQUM7SUFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsU0FBRyxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsRUFBQyxLQUFLLEVBQUUsUUFBUSxFQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDeEQsV0FBVyxHQUFHLFFBQVEsQ0FBQztRQUN2QixPQUFPLEdBQUcsTUFBTSxDQUFDLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUNyQyxDQUFDO0lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLFFBQVEsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzFCLE9BQU8sR0FBRyxFQUFDLENBQUMsRUFBRSxxQkFBcUIsRUFBRSxRQUFRLEVBQUU7Z0JBQzdDLEVBQUMsQ0FBQyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsY0FBWSxRQUFRLHVDQUFvQyxFQUFDO2dCQUMzRSxFQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxFQUFFLGtCQUFrQixFQUFFLElBQUksRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxRQUFBLE1BQU0sRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFO2FBQ2hHLEVBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxFQUFFLENBQUEsQ0FBQyxXQUFXLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQztRQUM1QixJQUFJLGNBQWMsR0FBRyxFQUFDLEVBQUUsRUFBRSx1QkFBdUIsRUFBRSxDQUFDLEVBQUUsb0NBQW9DLEVBQUUsUUFBUSxFQUFFO2dCQUNwRyxFQUFDLElBQUksRUFBRSxpQkFBaUIsRUFBQztnQkFDekIsRUFBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxrQkFBa0IsRUFBRSxJQUFJLEVBQUUsbUJBQW1CLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxRQUFBLE1BQU0sRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFDO2dCQUNyRyxFQUFDLElBQUksRUFBRSxpQkFBaUIsRUFBQzthQUMxQixFQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsSUFBSSxJQUFJLEdBQVcsRUFBQyxDQUFDLEVBQUUsZ0JBQWEsS0FBSyxJQUFJLEVBQUUsQ0FBRSxFQUFFLFFBQUEsTUFBTSxFQUFFLFFBQVEsRUFBRSxDQUFDLE1BQU0sRUFBRSxjQUFjLEVBQUUsT0FBTyxFQUFFLE1BQU0sQ0FBQyxFQUFDLENBQUM7SUFDaEgsSUFBSSxHQUFHLEdBQUcsU0FBRyxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsRUFBRSxFQUFDLElBQUksRUFBRSxNQUFNLEVBQUMsQ0FBQyxDQUFDO0lBQzFELEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDUCxJQUFJLENBQUMsS0FBSyxHQUFHLFlBQVMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLEdBQUcsSUFBSSxpQkFBVSxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxHQUFHLElBQUksT0FBRyxDQUFDO0lBQ25ILENBQUM7SUFDRCxFQUFFLENBQUEsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDO1FBQ2pCLElBQUksQ0FBQyxLQUFLLEdBQUcsY0FBYyxDQUFDO0lBQzlCLENBQUM7SUFFRCxFQUFFLENBQUEsQ0FBQyxlQUFPLENBQUMsTUFBTSxDQUFDLElBQUksSUFBSSxlQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sS0FBSyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQzNELElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUNoQixFQUFDLEtBQUssRUFBRSx3R0FBd0csRUFBRSxRQUFBLE1BQU0sRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFDLEVBQzdJLGVBQU8sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUM5QixDQUFDO0lBQ0osQ0FBQztJQUNELE1BQU0sQ0FBQyxJQUFJLENBQUM7QUFDZCxDQUFDO0FBckRlLFlBQUksT0FxRG5CLENBQUE7QUFDRCxvQkFBb0IsR0FBUyxFQUFFLElBQVk7SUFDekMsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3hCLElBQUksTUFBTSxHQUFHLFlBQUksRUFBRSxDQUFDO0lBQ3BCLElBQUksSUFBSSxHQUFHLFlBQUksRUFBRSxDQUFDO0lBQ2xCLGNBQVEsQ0FBQyxhQUFhLEVBQUUsRUFBQyxNQUFBLElBQUksRUFBRSxPQUFPLEVBQUUsT0FBSyxJQUFJLE9BQUksRUFBQyxDQUFDO1NBQ3BELFFBQVEsQ0FBQyxlQUFlLEVBQUUsRUFBQyxRQUFBLE1BQU0sRUFBRSxNQUFBLElBQUksRUFBRSxNQUFBLElBQUksRUFBQyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7QUFDOUQsQ0FBQztBQUVELHNCQUFzQixLQUFLLEVBQUUsSUFBSTtJQUMvQixJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUN6QyxjQUFRLENBQUMsZUFBZSxFQUFFLEVBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQzFELGNBQVEsQ0FBQyxlQUFlLEVBQUUsRUFBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUN6RSxDQUFDO0FBRUQsc0JBQXNCLE1BQWE7SUFDakMsSUFBSSxJQUFJLEdBQUcsU0FBRyxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsRUFBQyxJQUFJLEVBQUUsTUFBTSxFQUFDLENBQUMsQ0FBQztJQUNsRCxJQUFJLE1BQXVCLFNBQUcsQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLEVBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFDLENBQUMsSUFBSSxFQUFFLFVBQTFGLE1BQU0sbUJBQUcsU0FBUyxLQUF3RSxDQUFDO0lBQ2hHLElBQUksUUFBUSxHQUFHLENBQUMsQ0FBQyxDQUFDLE1BQU0sSUFBSSxTQUFHLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxFQUFDLFFBQUEsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLGlCQUFTLENBQUMsUUFBUSxDQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUM7SUFDakgsTUFBTSxDQUFDLEVBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRTtZQUN4QyxFQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBQztZQUM3RSxFQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBQztZQUM3RSxNQUFNLElBQUksQ0FBQyxRQUFRLEdBQUcsRUFBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLGFBQWEsRUFBRSxRQUFBLE1BQU0sRUFBRSxRQUFBLE1BQU0sRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFDLEdBQUcsU0FBUztZQUN0SCxFQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLFlBQVksRUFBRSxJQUFJLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxFQUFFLG9CQUFvQixFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUM7U0FDckcsRUFBQyxDQUFDO0FBQ0wsQ0FBQztBQUVELGdCQUF1QixNQUFhLEVBQUUsTUFBYTtJQUNqRCxJQUFJLEtBQTBCLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQTFDLFVBQVUsVUFBRSxTQUFTLFFBQXFCLENBQUM7SUFDaEQsSUFBSSxZQUFZLEdBQUcsYUFBYSxDQUFDLFVBQVUsRUFBRSxTQUFTLENBQUMsQ0FBQztJQUN4RCxJQUFJLEtBQTZCLFdBQVcsQ0FBQyxNQUFNLENBQUMsRUFBL0MsT0FBTyxlQUFFLE1BQU0sY0FBRSxPQUFPLGFBQXVCLENBQUM7SUFDckQsbUJBQVcsQ0FBQyxNQUFNLEVBQUUsWUFBWSxDQUFDLENBQUM7SUFDbEMsSUFBSSxHQUFHLEdBQUcsU0FBUyxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQUUsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzdELE1BQU0sQ0FBQyxFQUFDLENBQUMsRUFBRSxTQUFTLEVBQUUsQ0FBQyxFQUFFLGFBQWEsRUFBRSxRQUFRLEVBQUU7WUFDaEQsR0FBRztTQUNKLEVBQUMsQ0FBQztBQUNMLENBQUM7QUFUZSxjQUFNLFNBU3JCLENBQUE7QUFDRCxxQkFBcUIsSUFBZ0IsRUFBRSxJQUFZO0lBQ2pELDZHQUE2RztJQUM3RyxJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUM7SUFDZixPQUFNLEdBQUcsQ0FBQyxhQUFhO1FBQUUsR0FBRyxHQUFHLEdBQUcsQ0FBQyxhQUFhLENBQUM7SUFDakQsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLE9BQU8sS0FBSyxNQUFNLENBQUM7UUFBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUUxRCxJQUFJLEtBQVUsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ3ZCLElBQUksTUFBTSxHQUFHLEVBQUUsQ0FBQztJQUNoQixJQUFJLE9BQU8sR0FBdUIsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ25FLEdBQUcsQ0FBQSxDQUFlLFVBQU8sRUFBckIsbUJBQVUsRUFBVixJQUFxQixDQUFDO1FBQXRCLElBQUksTUFBTSxHQUFJLE9BQU8sSUFBWDtRQUNaLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQztRQUM1QixNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN2RCxFQUFFLENBQUEsQ0FBQyxNQUFNLENBQUMsV0FBVyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUMsV0FBVyxDQUFDO0tBQy9GO0lBQ0QsR0FBRyxDQUFBLENBQWUsVUFBTyxFQUFyQixtQkFBVSxFQUFWLElBQXFCLENBQUM7UUFBdEIsSUFBSSxNQUFNLEdBQUksT0FBTyxJQUFYO1FBQWEsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUFBO0lBRTVFLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEtBQUssTUFBTSxDQUFDO1FBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDNUQsQ0FBQztBQUVELDJEQUEyRDtBQUMzRCx3QkFBd0I7QUFDeEIsMkRBQTJEO0FBQzNELHFCQUFxQixTQUFnQjtJQUNuQyxJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUM7SUFDaEIsRUFBRSxDQUFBLENBQUMsQ0FBQyxTQUFTLENBQUM7UUFBQyxNQUFNLENBQUMsTUFBTSxDQUFDO0lBQzdCLEdBQUcsQ0FBQSxDQUFXLFVBQW9CLEVBQXBCLEtBQUEsU0FBUyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBOUIsY0FBTSxFQUFOLElBQThCLENBQUM7UUFBL0IsSUFBSSxFQUFFLFNBQUE7UUFDUixJQUFJLEtBQWUsRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBM0IsR0FBRyxVQUFFLEtBQUssUUFBaUIsQ0FBQztRQUNqQyxFQUFFLENBQUEsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUFDLFFBQVEsQ0FBQztRQUNqQyxFQUFFLENBQUEsQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsOEJBQThCLEdBQUcsR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDO1FBQ3hGLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUMsR0FBRyxtQkFBVyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0tBQ2hEO0lBQ0QsTUFBTSxDQUFDLE1BQU0sQ0FBQztBQUNoQixDQUFDO0FBQ0QseUJBQXlCLE1BQVM7SUFDaEMsSUFBSSxTQUFTLEdBQUcsRUFBRSxDQUFDO0lBQ25CLEVBQUUsQ0FBQSxDQUFDLENBQUMsTUFBTSxDQUFDO1FBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQztJQUM3QixHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLE1BQU0sQ0FBQztRQUFDLFNBQVMsSUFBSSxNQUFHLFNBQVMsQ0FBQyxNQUFNLEdBQUcsSUFBSSxHQUFHLEVBQUUsSUFBRyxHQUFHLFdBQU0sTUFBTSxDQUFDLEdBQUcsQ0FBRyxDQUFDO0lBQzdGLE1BQU0sQ0FBQyxTQUFTLENBQUM7QUFDbkIsQ0FBQztBQUVELGdCQUFnQixNQUFNLEVBQUUsS0FBSyxFQUFFLElBQUk7SUFDakMsSUFBSSxLQUE2QixXQUFXLENBQUMsS0FBSyxDQUFDLEVBQTlDLE1BQU0sY0FBRSxPQUFPLGVBQUUsT0FBTyxhQUFzQixDQUFDO0lBQ3BELE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksTUFBTSxDQUFDO0lBQzlDLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUM7SUFDdEIsTUFBTSxDQUFDLFVBQVUsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNuQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsY0FBYyxDQUFDO0lBQy9CLE1BQU0sQ0FBQyxFQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQUUsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDLEVBQUMsQ0FBQztBQUNyRixDQUFDO0FBRUQsZ0VBQWdFO0FBQ2hFLElBQUksUUFBUSxHQUFHLDJGQUEyRixDQUFDO0FBRTNHLHFCQUFxQixLQUFLO0lBQ3hCLElBQUksS0FBdUIsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBdEMsT0FBTyxVQUFFLFNBQVMsUUFBb0IsQ0FBQztJQUM1QyxJQUFJLFNBQVMsQ0FBQztJQUNkLGtEQUFrRDtJQUNsRCxJQUFJLE1BQU0sR0FBRyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDcEMsSUFBSSxPQUFPLENBQUM7SUFDWixFQUFFLENBQUEsQ0FBQyxTQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxFQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUMsQ0FBQyxJQUFJLFNBQUcsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLEVBQUMsSUFBSSxFQUFFLE9BQU8sRUFBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzlGLElBQUksRUFBRSxHQUFHLE9BQU8sQ0FBQztRQUNqQixJQUFJLE9BQU8sR0FBRyxTQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxFQUFDLElBQUksRUFBRSxPQUFPLEVBQUMsQ0FBQyxDQUFDO1FBQzNELEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDWCxFQUFFLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3JCLENBQUM7UUFDRCxPQUFPLEdBQUcsRUFBQyxXQUFXLEVBQUUsQ0FBQyxFQUFDLE1BQU0sRUFBRSxFQUFFLEVBQUMsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUMsTUFBTSxFQUFFLEVBQUUsRUFBQyxDQUFDLEVBQUMsQ0FBQztJQUNuRSxDQUFDO0lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2pDLE9BQU8sR0FBRyxFQUFDLFdBQVcsRUFBRSxDQUFDLEVBQUMsR0FBRyxFQUFFLE9BQU8sRUFBQyxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBQyxHQUFHLEVBQUUsT0FBTyxFQUFDLENBQUMsRUFBQyxDQUFDO0lBQ3ZFLENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNOLElBQUksT0FBTyxHQUFHLFNBQUcsQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLEVBQUMsS0FBSyxFQUFFLE9BQU8sRUFBQyxDQUFDLENBQUM7UUFDM0QsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNYLElBQUksWUFBWSxHQUFHLFNBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ3hDLElBQUksZ0JBQWdCLEdBQUcsU0FBRyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUMsV0FBVyxDQUFDO1lBQ3pELEVBQUUsQ0FBQSxDQUFDLENBQUMsWUFBWSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7Z0JBQ3hCLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxPQUFPLENBQUM7Z0JBQ3hCLE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxZQUFZLENBQUM7Z0JBQ2pDLE9BQU8sR0FBRyxFQUFFLENBQUM7WUFDZixDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ04sT0FBTyxHQUFHLEVBQUMsV0FBVyxFQUFFLGdCQUFnQixFQUFFLE9BQU8sRUFBRSxZQUFZLEVBQUMsQ0FBQztZQUNuRSxDQUFDO1FBQ0gsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLE9BQU8sQ0FBQztZQUN4QixNQUFNLENBQUMsU0FBUyxDQUFDLEdBQUcsZ0JBQWdCLENBQUM7WUFDckMsT0FBTyxHQUFHLEVBQUUsQ0FBQztRQUNmLENBQUM7SUFDSCxDQUFDO0lBQ0QsTUFBTSxDQUFDLEVBQUMsU0FBQSxPQUFPLEVBQUUsUUFBQSxNQUFNLEVBQUUsU0FBQSxPQUFPLEVBQUMsQ0FBQztBQUNwQyxDQUFDO0FBRUQsdUJBQXVCLE9BQU8sRUFBRSxTQUFTO0lBQ3ZDLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDekIsSUFBSSxPQUFPLEdBQUcsU0FBRyxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsRUFBQyxJQUFJLEVBQUUsT0FBTyxFQUFDLENBQUMsQ0FBQztJQUMzRCxJQUFJLE1BQU0sR0FBRyxXQUFXLENBQUMsU0FBUyxDQUFDLENBQUM7SUFDcEMsSUFBSSxjQUFjLEdBQUcsU0FBRyxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsRUFBQyxFQUFFLEVBQUUsT0FBTyxFQUFDLENBQUMsSUFBSSxTQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxFQUFDLElBQUksRUFBRSxPQUFPLEVBQUMsQ0FBQyxDQUFDO0lBQ2hILEVBQUUsQ0FBQSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUM7UUFDbEIsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxNQUFNLENBQUM7SUFDMUMsQ0FBQztJQUFDLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNqQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLGNBQWMsQ0FBQztJQUNsRCxDQUFDO0lBQUMsSUFBSSxDQUFDLENBQUM7UUFDTixFQUFFLENBQUEsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7WUFBQyxNQUFNLENBQUMsTUFBTSxDQUFDO1FBRWhDLElBQUksTUFBTSxHQUFHLHFCQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDOUIsSUFBSSxZQUFZLEdBQUcsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzdCLElBQUksT0FBTyxHQUFHLFlBQVksQ0FBQyxPQUFPLENBQUM7UUFDbkMsSUFBSSxjQUFjLEdBQUcsT0FBTyxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUM7UUFDaEQsSUFBSSxLQUFLLENBQUM7UUFDVixJQUFJLEdBQUcsQ0FBQztRQUNSLElBQUksVUFBVSxHQUFHLEVBQUUsQ0FBQztRQUNwQixHQUFHLENBQUEsQ0FBWSxVQUFZLEVBQVosS0FBQSxPQUFPLENBQUMsSUFBSSxFQUF2QixjQUFPLEVBQVAsSUFBdUIsQ0FBQztZQUF4QixJQUFJLEdBQUcsU0FBQTtZQUNULEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssNkJBQWEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO2dCQUN4QyxVQUFVLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3ZCLENBQUM7U0FDRjtRQUNELEVBQUUsQ0FBQSxDQUFDLFVBQVUsQ0FBQyxNQUFNLEtBQUssQ0FBQyxJQUFJLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNoRSxHQUFHLEdBQUcsS0FBSyxDQUFDO1lBQ1osS0FBSyxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDN0IsQ0FBQztRQUFDLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxDQUFDLGNBQWMsSUFBSSxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3ZELEdBQUcsR0FBRyxLQUFLLENBQUM7WUFDWixLQUFLLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDL0IsQ0FBQztRQUFDLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxDQUFDLGNBQWMsSUFBSSxPQUFPLENBQUMsVUFBVSxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzdELEdBQUcsR0FBRyxLQUFLLENBQUM7WUFDWixLQUFLLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUM7UUFDNUMsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLE9BQU8sQ0FBQztRQUMxQixDQUFDO1FBQ0QsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNQLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxHQUFHLENBQUM7WUFDcEIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEtBQUssQ0FBQztRQUMxQixDQUFDO0lBQ0gsQ0FBQztJQUNELE1BQU0sQ0FBQyxNQUFNLENBQUM7QUFDaEIsQ0FBQztBQUVELElBQUksV0FBVyxHQUFHLEVBQUUsQ0FBQztBQUNyQixvQkFBb0IsSUFBSSxFQUFFLElBQUk7SUFDNUIsNkJBQVksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDekIsV0FBVyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQztBQUM5QyxDQUFDO0FBRUQsc0JBQXNCLElBQUksRUFBRSxJQUFJO0lBQzlCLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRSxLQUFLLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1FBQzNDLFFBQVEsQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM5RCxDQUFDO0lBQ0QsSUFBSSxDQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztBQUNwQyxDQUFDO0FBRUQseUJBQXlCLElBQUksRUFBRSxJQUFJO0lBQ2pDLGlCQUFTLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3RCLEVBQUUsQ0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDbEIsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFDckIsK0JBQXVCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDaEMsQ0FBQztBQUNILENBQUM7QUFFRCwyREFBMkQ7QUFFM0Qsb0JBQW9CLFFBQVEsRUFBRSxNQUFNLEVBQUUsSUFBSTtJQUN4QyxJQUFJLElBQUksR0FBRyxXQUFXLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQztJQUN0QyxJQUFJLEtBQXNCLG9CQUFvQixDQUFDLFFBQVEsRUFBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQWpFLE9BQU8sZUFBRSxRQUFRLGNBQWdELENBQUM7SUFDdkUsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDO0lBQ3JCLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzVCLElBQUksR0FBRyxFQUFFLENBQUM7SUFDWixDQUFDO0lBQ0QsSUFBSSxPQUFPLEdBQUcsU0FBRyxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsRUFBQyxFQUFFLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztJQUN0RCxFQUFFLENBQUEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQ1gsSUFBSSxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUN6QixDQUFDO0lBQ0QsTUFBTSxDQUFDLEVBQUMsUUFBUSxFQUFFO1lBQ2hCLEVBQUMsQ0FBQyxFQUFFLGVBQWUsRUFBRSxRQUFRLEVBQUU7b0JBQzdCLEVBQUMsQ0FBQyxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFDO29CQUMzQixFQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFDLEVBQUUsRUFBRSxlQUFlLEVBQUUsSUFBSSxFQUFFLE1BQUEsSUFBSSxFQUFFLEtBQUssRUFBRSxjQUFjLEVBQUUsS0FBSyxFQUFFLGdCQUFnQixFQUFFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFBLElBQUksRUFBRSxVQUFBLFFBQVEsRUFBRSxRQUFBLE1BQU0sRUFBRSxVQUFVLEVBQUUsU0FBUyxHQUFHLGVBQWUsR0FBRyxTQUFTLEVBQUM7aUJBQ3ZNLEVBQUM7WUFDRixhQUFhLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxJQUFJLENBQUM7U0FDckMsRUFBQyxDQUFDO0FBQ0wsQ0FBQztBQUVELHVCQUF1QixPQUFPLEVBQUUsTUFBTSxFQUFFLElBQUk7SUFDMUMsSUFBSSxRQUFRLEdBQUcsRUFBRSxDQUFDO0lBQ2xCLEdBQUcsQ0FBQSxDQUFlLFVBQU8sRUFBckIsbUJBQVUsRUFBVixJQUFxQixDQUFDO1FBQXRCLElBQUksTUFBTSxHQUFJLE9BQU8sSUFBWDtRQUNaLElBQUksSUFBSSxHQUFHLEVBQUMsQ0FBQyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsTUFBTSxDQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQUEsSUFBSSxFQUFFLFFBQUEsTUFBTSxFQUFFLEtBQUssRUFBRSwwQkFBMEIsRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFDLENBQUM7UUFDL0osRUFBRSxDQUFBLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDbkIsSUFBSSxDQUFDLENBQUMsSUFBSSxXQUFXLENBQUM7UUFDeEIsQ0FBQztRQUNELFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7S0FDckI7SUFDRCxNQUFNLENBQUMsRUFBQyxDQUFDLEVBQUUsZUFBZSxFQUFFLEdBQUcsRUFBRSxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUMsUUFBUSxFQUFFLEVBQUUsTUFBQSxJQUFJLEVBQUUsV0FBVyxFQUFLLE1BQU0sU0FBSSxJQUFJLENBQUMsRUFBRSxlQUFZLEVBQUUsVUFBQSxRQUFRLEVBQUUsVUFBVSxFQUFFLHFCQUFxQixFQUFDLENBQUM7QUFDbkssQ0FBQztBQUVELG9CQUFvQixLQUFLLEVBQUUsSUFBSTtJQUM3QixFQUFFLENBQUEsQ0FBQyxLQUFLLENBQUMsT0FBTyxLQUFLLFlBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ2hDLDBCQUEwQixDQUFDLEtBQUssQ0FBQyxhQUFhLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDeEQsQ0FBQztBQUNILENBQUM7QUFFRCxvQ0FBb0MsS0FBSyxFQUFFLElBQUk7SUFDN0MsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLGdCQUFnQixDQUFDO1FBQUMsTUFBTSxDQUFDO0lBQ2xDLElBQUssTUFBTSxHQUFVLElBQUksU0FBWixJQUFJLEdBQUksSUFBSSxLQUFBLENBQUM7SUFDMUIsSUFBSSxNQUFNLEdBQUcsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2pDLElBQUksRUFBRSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUM7SUFDM0IsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDakMsSUFBSSxPQUFPLEdBQUcsbUJBQW1CLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFDMUQsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDekMsRUFBRSxDQUFBLENBQUMsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sS0FBSyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQzlDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBQ2xELENBQUM7SUFDSCxDQUFDO0FBQ0gsQ0FBQztBQUVELDhCQUE4QixRQUFRLEVBQUUsTUFBTSxFQUFFLElBQUk7SUFDbEQsSUFBSSxLQUFvQixJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsRUFBL0MsSUFBSSxVQUFFLFNBQVMsUUFBZ0MsQ0FBQztJQUNyRCxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM1QixNQUFNLENBQUMsRUFBQyxPQUFPLEVBQUUsRUFBRSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUMsQ0FBQztJQUNyQyxDQUFDO0lBQ0QsSUFBSSxNQUFNLEdBQUcsRUFBRSxDQUFDO0lBQ2hCLElBQUksQ0FBQztRQUNILE1BQU0sR0FBRyxhQUFhLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQzFDLENBQUU7SUFBQSxLQUFLLENBQUEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBR1osQ0FBQztJQUNELElBQUksT0FBTyxHQUFHLFNBQUcsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLEVBQUMsRUFBRSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUM7SUFDdEQsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUNYLElBQUksR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDekIsQ0FBQztJQUNELElBQUksUUFBUSxHQUFHLFNBQUcsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLEVBQUMsSUFBSSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUM7SUFDekQsSUFBSSxNQUFNLEdBQUcsRUFBRSxDQUFDO0lBQ2hCLEVBQUUsQ0FBQSxDQUFDLElBQUksS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ2YsSUFBSSxDQUFDO1lBQ0gsTUFBTSxHQUFHLHFCQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxtRUFBbUU7UUFDN0YsQ0FBRTtRQUFBLEtBQUssQ0FBQSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFFWixDQUFDO0lBQ0gsQ0FBQztJQUNELDRDQUE0QztJQUM1QyxJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxJQUFJLE9BQU8sQ0FBQztJQUNsQyxtREFBbUQ7SUFDbkQsNkRBQTZEO0lBQzdELDZCQUE2QjtJQUM3QixJQUFJLE9BQTJFLENBQUM7SUFDaEYsRUFBRSxDQUFBLENBQUMsS0FBSyxLQUFLLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDckIsT0FBTyxHQUFHLHdCQUF3QixDQUFDLFFBQVEsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztJQUMvRSxDQUFDO0lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLEtBQUssS0FBSyxXQUFXLENBQUMsQ0FBQyxDQUFDO1FBQ2hDLE9BQU8sR0FBRyw0QkFBNEIsQ0FBQyxRQUFRLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDbkYsQ0FBQztJQUFDLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxLQUFLLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQztRQUM3QixPQUFPLEdBQUcseUJBQXlCLENBQUMsUUFBUSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQ2hGLENBQUM7SUFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsS0FBSyxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDN0IsT0FBTyxHQUFHLHlCQUF5QixDQUFDLFFBQVEsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztJQUNoRixDQUFDO0lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLEtBQUssS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQzdCLE9BQU8sR0FBRyx5QkFBeUIsQ0FBQyxRQUFRLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDaEYsQ0FBQztJQUFDLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxLQUFLLEtBQUssVUFBVSxDQUFDLENBQUMsQ0FBQztRQUMvQixPQUFPLEdBQUcsMkJBQTJCLENBQUMsUUFBUSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0lBQ2xGLENBQUM7SUFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsS0FBSyxLQUFLLGVBQWUsQ0FBQyxDQUFDLENBQUM7UUFDcEMsT0FBTyxHQUFHLCtCQUErQixDQUFDLFFBQVEsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztJQUN0RixDQUFDO0lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLEtBQUssS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQzFCLE9BQU8sR0FBRyxzQkFBc0IsQ0FBQyxRQUFRLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsUUFBUSxDQUFDLENBQUM7SUFDN0UsQ0FBQztJQUNELE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLFVBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSyxPQUFBLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEtBQUssRUFBakIsQ0FBaUIsQ0FBQyxDQUFDO0lBQ3BELElBQUksUUFBUSxDQUFDO0lBQ2IsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDbEIsSUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFDLFFBQVEsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDO1FBQ2hELEVBQUUsQ0FBQSxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUM7WUFBQyxVQUFVLEdBQUcsT0FBTyxDQUFDLE1BQU0sR0FBRyxVQUFVLENBQUM7UUFDNUQsUUFBUSxHQUFHLE9BQU8sQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUMvQixRQUFRLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztJQUMzQixDQUFDO0lBQ0QsR0FBRyxDQUFBLENBQWUsVUFBTyxFQUFyQixtQkFBVSxFQUFWLElBQXFCLENBQUM7UUFBdEIsSUFBSSxNQUFNLEdBQUksT0FBTyxJQUFYO1FBQ1osTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQztRQUN0QixNQUFNLENBQUMsUUFBUSxDQUFDLEdBQUcsTUFBTSxDQUFDO0tBQzNCO0lBQ0QsTUFBTSxDQUFDLEVBQUMsU0FBQSxPQUFPLEVBQUUsVUFBQSxRQUFRLEVBQUMsQ0FBQztBQUM3QixDQUFDO0FBRUQsK0JBQStCLElBQUksRUFBRSxJQUFJO0lBQ3ZDLElBQUksV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7SUFDbkMsSUFBSSxTQUFTLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNyRCxJQUFJLEtBQWlCLFNBQVMsQ0FBQyxxQkFBcUIsRUFBRSxFQUFqRCxNQUFNLGNBQUUsSUFBSSxVQUFxQyxDQUFDO0lBQ3ZELFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2hDLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxHQUFHLE1BQU0sQ0FBQztJQUN4QixJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7QUFDekIsQ0FBQztBQUVELGtDQUFrQyxRQUFRLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsUUFBUTtJQUN4RSxJQUFJLFFBQVEsR0FBRyxTQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxFQUFDLEVBQUUsRUFBRSxRQUFRLEVBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ25FLElBQUksT0FBTyxHQUFvRSxFQUFFLENBQUM7SUFDbEYsSUFBSSxhQUFhLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxVQUFDLEtBQUssSUFBSyxPQUFBLEtBQUssQ0FBQyxLQUFLLEtBQUssMEJBQVUsQ0FBQyxRQUFRLEVBQW5DLENBQW1DLENBQUMsQ0FBQztJQUNoRixNQUFNLENBQUMsSUFBSSxDQUFDLFVBQUMsQ0FBQyxFQUFFLENBQUMsSUFBSyxPQUFBLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLEtBQUssRUFBakIsQ0FBaUIsQ0FBQyxDQUFDO0lBQ3pDLElBQUksU0FBUyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUMxQixJQUFJLE1BQU0sR0FBRyxHQUFHLENBQUM7SUFDakIsRUFBRSxDQUFBLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3JDLE1BQU0sR0FBRyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUVELElBQUksV0FBVyxHQUFHLEtBQUssQ0FBQztJQUN4QixFQUFFLENBQUEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBQ2IsSUFBSSxVQUFVLEdBQUcsQ0FBQyxDQUFDO1FBQ25CLElBQUssT0FBTyxHQUFJLFNBQVMsUUFBQSxDQUFDO1FBQzFCLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksT0FBTyxDQUFDLENBQUMsQ0FBQztZQUN4QixVQUFVLElBQUksT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQztRQUNyQyxDQUFDO1FBQ0QsSUFBSSxTQUFTLEdBQUcsVUFBVSxLQUFLLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsSUFBSSxPQUFPLENBQUMsV0FBVyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQztRQUN4RyxFQUFFLENBQUEsQ0FBQyxTQUFTLElBQUksT0FBTyxDQUFDLGVBQWUsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNyRCxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUMsS0FBSyxFQUFFLENBQUMsRUFBRyxNQUFNLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLFNBQU8sSUFBTSxFQUFDLENBQUMsQ0FBQztZQUN0RixXQUFXLEdBQUcsSUFBSSxDQUFDO1FBQ3JCLENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsU0FBUyxJQUFJLE9BQU8sQ0FBQyxVQUFVLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdkQsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFDLEtBQUssRUFBRSxHQUFHLEVBQUcsTUFBTSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxZQUFVLElBQU0sRUFBQyxDQUFDLENBQUM7UUFDN0YsQ0FBQztJQUNILENBQUM7SUFDRCxTQUFTO0lBQ1QsRUFBRSxDQUFBLENBQUMsQ0FBQyxRQUFRLElBQUksSUFBSSxLQUFLLEVBQUUsSUFBSSxJQUFJLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQztRQUMzQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUMsS0FBSyxFQUFFLENBQUMsRUFBRyxNQUFNLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLFlBQVUsTUFBTSxXQUFLLElBQUksWUFBUSxFQUFDLENBQUMsQ0FBQztJQUM1RyxDQUFDO0lBQ0Qsa0JBQWtCO0lBQ2xCLEVBQUUsQ0FBQSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNyQixPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsb0JBQW9CLEVBQUUsSUFBSSxFQUFFLGVBQWUsRUFBQyxDQUFDLENBQUM7SUFDaEYsQ0FBQztJQUNELEVBQUUsQ0FBQSxDQUFDLENBQUMsUUFBUSxJQUFJLGFBQWEsSUFBSSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQy9DLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBQyxLQUFLLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxRQUFBLE1BQU0sRUFBRSxJQUFJLEVBQUUsZ0JBQWMsTUFBTSxDQUFDLEtBQUssQ0FBRyxFQUFDLENBQUMsQ0FBQztJQUM3RyxDQUFDO0lBQ0QsZ0JBQWdCO0lBQ2hCLGtEQUFrRDtJQUNsRCxFQUFFLENBQUEsQ0FBQyxRQUFRLElBQUksYUFBYSxDQUFDLENBQUMsQ0FBQztRQUM3QixnRkFBZ0Y7UUFDaEYsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFDLEtBQUssRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxjQUFjLEVBQUMsQ0FBQyxDQUFDO0lBQzNGLENBQUM7SUFDRCxnQkFBZ0I7SUFDaEIsRUFBRSxDQUFBLENBQUMsSUFBSSxJQUFJLFNBQUcsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLEVBQUMsRUFBRSxFQUFFLFFBQVEsRUFBQyxDQUFDLENBQUMsSUFBSSxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDckUsRUFBRSxDQUFBLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ2hCLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxJQUFJLEVBQUUsMEJBQXdCLFFBQVUsRUFBQyxDQUFDLENBQUE7UUFDL0csQ0FBQztRQUNELEVBQUUsQ0FBQSxDQUFDLFFBQVEsQ0FBQyxDQUFFLENBQUM7WUFDYixJQUFJLFFBQVEsR0FBRyxHQUFHLENBQUM7WUFDbkIsRUFBRSxDQUFBLENBQUMsU0FBRyxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsRUFBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLEVBQUUsRUFBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN4RCxRQUFRLEdBQUcsQ0FBQyxDQUFDO1lBQ2YsQ0FBQztZQUNELE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxvQkFBb0IsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLFVBQUEsUUFBUSxFQUFFLEtBQUssRUFBRSxRQUFRLENBQUMsRUFBRSxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFLLFFBQVEsdUJBQWtCLElBQU0sRUFBQyxDQUFDLENBQUM7WUFDNUssT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFDLEtBQUssRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLG9CQUFvQixFQUFFLE9BQU8sRUFBRSxZQUFZLEVBQUUsVUFBQSxRQUFRLEVBQUUsS0FBSyxFQUFFLFFBQVEsQ0FBQyxFQUFFLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUssUUFBUSxZQUFPLE1BQU0sU0FBSSxJQUFNLEVBQUMsQ0FBQyxDQUFDO1FBQ2xMLENBQUM7SUFDSCxDQUFDO0lBRUQsZ0JBQWdCO0lBQ2hCLEVBQUUsQ0FBQSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3ZCLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBQyxLQUFLLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRyxZQUFZLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsaUJBQWlCLEVBQUMsQ0FBQyxDQUFDO0lBQ3pGLENBQUM7SUFDRCxNQUFNLENBQUMsT0FBTyxDQUFDO0FBQ2pCLENBQUM7QUFFRCw4QkFBOEIsSUFBSSxFQUFFLFFBQVEsRUFBRSxPQUFPO0lBQ25ELElBQUksS0FBd0MsSUFBSSxDQUFDLFFBQVEsRUFBcEQsUUFBUSxnQkFBRSxLQUFLLGFBQUUsU0FBUyxpQkFBRSxPQUFPLGFBQWlCLENBQUM7SUFDMUQsSUFBSSxLQUFLLEdBQUcsY0FBUSxDQUFDLGlCQUFpQixFQUFFLEVBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxXQUFBLFNBQVMsRUFBRSxPQUFBLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBSSxFQUFFLEVBQUMsQ0FBQyxDQUFDO0lBQzlGLEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDWCxLQUFLLENBQUMsUUFBUSxDQUFDLHlCQUF5QixFQUFFLEVBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLE9BQUEsS0FBSyxFQUFDLENBQUMsQ0FBQztJQUMzRixDQUFDO0lBQ0QsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ2YsT0FBTyxDQUFJLEtBQUssZUFBWSxDQUFDLENBQUM7QUFDaEMsQ0FBQztBQUVELHNCQUFzQixJQUFJLEVBQUUsS0FBSyxFQUFFLE9BQU87SUFDeEMsY0FBUSxDQUFDLGNBQWMsRUFBRSxFQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBQ3BGLENBQUM7QUFFRCxtQ0FBbUMsUUFBUSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFFBQVE7SUFDekUsSUFBSSxPQUFPLEdBQW9FLEVBQUUsQ0FBQztJQUNsRixJQUFJLFFBQVEsR0FBRyxTQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxFQUFDLEVBQUUsRUFBRSxRQUFRLEVBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ25FLElBQUksWUFBWSxHQUFHLFFBQVEsR0FBRyxTQUFHLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxFQUFDLFVBQVUsRUFBRSxRQUFRLENBQUMsRUFBRSxFQUFDLENBQUMsR0FBRyxLQUFLLENBQUM7SUFDM0YsSUFBSSxNQUFNLEdBQUcsR0FBRyxDQUFDO0lBQ2pCLEVBQUUsQ0FBQSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNyQyxNQUFNLEdBQUcsSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFDRCxJQUFJLFFBQVEsR0FBRyxHQUFHLENBQUM7SUFDbkIsRUFBRSxDQUFBLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztRQUNoQixRQUFRLEdBQUcsQ0FBQyxDQUFDO0lBQ2YsQ0FBQztJQUNELE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBQyxLQUFLLEVBQUUsR0FBRyxFQUFFLE1BQU0sRUFBRSxjQUFjLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxVQUFBLFFBQVEsRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBSyxRQUFRLHVCQUFrQixJQUFNLEVBQUMsQ0FBQyxDQUFDO0lBQ2xKLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBQyxLQUFLLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxjQUFjLEVBQUUsT0FBTyxFQUFFLFlBQVksRUFBRSxVQUFBLFFBQVEsRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBSyxRQUFRLFlBQU8sTUFBTSxTQUFJLElBQU0sRUFBQyxDQUFDLENBQUM7SUFDdEosTUFBTSxDQUFDLE9BQU8sQ0FBQztBQUNqQixDQUFDO0FBRUQsd0JBQXdCLElBQUksRUFBRSxLQUFLLEVBQUUsT0FBTztJQUMxQyx3Q0FBd0M7SUFDeEMsSUFBSSxNQUFNLEdBQUcsWUFBSSxFQUFFLENBQUM7SUFDcEIsSUFBSSxJQUFJLEdBQUcsWUFBSSxFQUFFLENBQUM7SUFDbEIsSUFBSSxLQUFpQyxJQUFJLENBQUMsUUFBUSxFQUE3QyxRQUFRLGdCQUFFLFNBQVMsaUJBQUUsT0FBTyxhQUFpQixDQUFDO0lBQ25ELElBQUksS0FBSyxHQUFHLGNBQVEsQ0FBQyxhQUFhLEVBQUUsRUFBQyxNQUFBLElBQUksRUFBRSxPQUFPLEVBQUUsTUFBSSxLQUFLLE9BQUksRUFBQyxDQUFDO1NBQ3RELFFBQVEsQ0FBQyxlQUFlLEVBQUUsRUFBQyxRQUFBLE1BQU0sRUFBRSxNQUFBLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFDLENBQUM7U0FDdEQsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEVBQUMsTUFBTSxFQUFFLFFBQVEsRUFBRSxXQUFBLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxZQUFJLEVBQUUsRUFBQyxDQUFDLENBQUM7SUFDdkcsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUNYLEtBQUssQ0FBQyxRQUFRLENBQUMseUJBQXlCLEVBQUUsRUFBQyxNQUFNLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBQyxDQUFDLENBQUM7SUFDbkcsQ0FBQztJQUNELEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNmLE9BQU8sQ0FBSSxLQUFLLGVBQVksQ0FBQyxDQUFDO0FBQ2hDLENBQUM7QUFFRCxzQ0FBc0MsUUFBUSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFFBQVE7SUFDNUUsSUFBSSxPQUFPLEdBQW9FLEVBQUUsQ0FBQztJQUNsRixJQUFJLFlBQVksR0FBRyxRQUFRLEdBQUcsU0FBRyxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsRUFBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLEVBQUUsRUFBQyxDQUFDLEdBQUcsS0FBSyxDQUFDO0lBQzNGLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBQyxLQUFLLEVBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsT0FBTyxFQUFFLFFBQUEsTUFBTSxFQUFDLENBQUMsQ0FBQztJQUNoRixvRkFBb0Y7SUFDcEYsRUFBRSxDQUFBLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUNaLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBQyxLQUFLLEVBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFFLFFBQUEsTUFBTSxFQUFDLENBQUMsQ0FBQztJQUNoRixDQUFDO0lBQ0QsRUFBRSxDQUFBLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztRQUNoQixPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUMsS0FBSyxFQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLE9BQU8sRUFBRSxRQUFBLE1BQU0sRUFBQyxDQUFDLENBQUM7UUFDL0UsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFDLEtBQUssRUFBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLGFBQWEsRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsUUFBQSxNQUFNLEVBQUMsQ0FBQyxDQUFDO0lBQzFGLENBQUM7SUFDRCxFQUFFLENBQUEsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1FBQ1osT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFDLEtBQUssRUFBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLHlCQUF5QixFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLFNBQVMsRUFBRSxRQUFBLE1BQU0sRUFBQyxDQUFDLENBQUM7SUFFcEcsQ0FBQztJQUNELE1BQU0sQ0FBQyxPQUFPLENBQUM7QUFDakIsQ0FBQztBQUVELGdDQUFnQyxRQUFRLEVBQUUsTUFBTSxFQUFFLEdBQVUsRUFBRSxNQUFNLEVBQUUsUUFBZTtJQUNuRixzREFBc0Q7SUFDdEQsZ0ZBQWdGO0lBQ2hGLElBQUksR0FBRyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUNuRSxJQUFJLE1BQU0sR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzVELElBQUksT0FBTyxHQUFHLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUN4RSxJQUFJLE9BQU8sR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsaUJBQWlCLEVBQUUsVUFBVSxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDNUksSUFBSSxPQUFPLEdBQW9FO1FBQzdFLEVBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLGNBQWMsRUFBRSxRQUFBLE1BQU0sRUFBQztRQUN4RSxFQUFDLEtBQUssRUFBRSxPQUFPLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLGVBQWUsRUFBRSxRQUFBLE1BQU0sRUFBQztRQUN6RixFQUFDLEtBQUssRUFBRSxPQUFPLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxFQUFFLGVBQWUsRUFBRSxRQUFBLE1BQU0sRUFBQztLQUN6RixDQUFDO0lBQ0YsTUFBTSxDQUFDLE9BQU8sQ0FBQztBQUNqQixDQUFDO0FBRUQsaUJBQWlCLElBQUksRUFBRSxLQUFLLEVBQUUsT0FBTztJQUNuQyxJQUFLLElBQUksR0FBSSxLQUFLLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxHQUFBLENBQUM7SUFDOUIsSUFBSSxNQUFNLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUM7SUFDbEMsSUFBSSxTQUFTLEdBQUcsU0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUssQ0FBQztJQUMzQyxHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsS0FBSyxJQUFJLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDeEIsRUFBRSxDQUFBLENBQUMsS0FBSyxLQUFLLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDbkIsU0FBUyxJQUFJLE9BQUssS0FBSyxTQUFJLE1BQU0sQ0FBQyxLQUFLLENBQUcsQ0FBQztRQUM3QyxDQUFDO0lBQ0gsQ0FBQztJQUNELE9BQU8sQ0FBSSxJQUFJLFNBQUksU0FBVyxDQUFDLENBQUM7QUFDbEMsQ0FBQztBQUVELHFDQUFxQyxRQUFRLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsUUFBUTtJQUMzRSxJQUFJLE9BQU8sR0FBcUUsRUFBRSxDQUFDO0lBQ25GLElBQUksUUFBUSxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN6QixJQUFJLE9BQU8sR0FBRyxRQUFRLElBQUksUUFBUSxDQUFDLEtBQUssS0FBSywwQkFBVSxDQUFDLFFBQVEsQ0FBQztJQUNqRSxJQUFJLE1BQU0sR0FBTyxFQUFDLEtBQUssRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLHNCQUFzQixFQUFFLFVBQUEsUUFBUSxFQUFFLFNBQUEsT0FBTyxFQUFDLENBQUM7SUFDL0UsTUFBTSxDQUFDLFFBQVEsR0FBRztRQUNoQixFQUFDLENBQUMsRUFBRSxnQkFBZ0IsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFDO1FBQ3ZDLEVBQUMsQ0FBQyxFQUFFLGFBQWEsRUFBRSxlQUFlLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsaUJBQVMsRUFBQztLQUN2RyxDQUFBO0lBQ0QsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNyQixNQUFNLENBQUMsT0FBTyxDQUFDO0FBQ2pCLENBQUM7QUFFRCxnQ0FBZ0MsSUFBSSxFQUFFLEtBQUssRUFBRSxPQUFPO0lBQ2xELElBQUssUUFBUSxHQUFJLElBQUksU0FBQSxDQUFDO0lBQ3RCLElBQUssUUFBUSxHQUEwQixRQUFRLFdBQWhDLE9BQU8sR0FBaUIsUUFBUSxVQUF2QixXQUFXLEdBQUksUUFBUSxZQUFBLENBQUM7SUFDaEQsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUNYLEtBQUssR0FBRyxPQUFLLEtBQU8sQ0FBQztJQUN2QixDQUFDO0lBQ0QsSUFBSSxPQUFPLEdBQUcseUJBQXlCLENBQUMsUUFBUSxFQUFFLFdBQVcsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUN0RSxJQUFJLFVBQVUsR0FBRyxTQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxFQUFDLEVBQUUsRUFBRSxRQUFRLEVBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUNsRSxPQUFPLENBQUksVUFBVSxXQUFNLFdBQVcsdUJBQWtCLFdBQWEsQ0FBQyxDQUFDO0FBQ3pFLENBQUM7QUFFRCxtQ0FBbUMsUUFBUSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFFBQVE7SUFDekUsSUFBSSxPQUFPLEdBQXFFLEVBQUUsQ0FBQztJQUNuRixJQUFJLFFBQVEsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDekIsSUFBSSxPQUFPLEdBQUcsUUFBUSxDQUFDLE9BQU8sQ0FBQztJQUMvQixJQUFJLFNBQVMsQ0FBQztJQUNkLEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzlCLFNBQVMsR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztJQUM5QyxDQUFDO0lBQUMsSUFBSSxDQUFDLENBQUM7UUFDTixTQUFTLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUM7SUFDaEQsQ0FBQztJQUNELElBQUksT0FBTyxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLElBQUksT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM1RCxJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsRUFBRSxDQUFDO0lBQ3hCLElBQUksTUFBTSxHQUFPLEVBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsY0FBYyxFQUFFLFdBQUEsU0FBUyxFQUFFLFFBQUEsTUFBTSxFQUFDLENBQUM7SUFDdkUsTUFBTSxDQUFDLFFBQVEsR0FBRztRQUNoQixFQUFDLENBQUMsRUFBRSxnQkFBZ0IsRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFDO1FBQ3RDLEVBQUMsQ0FBQyxFQUFFLGFBQWEsRUFBRSxlQUFlLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBQyxNQUFNLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsaUJBQVMsRUFBQztLQUN2RyxDQUFBO0lBQ0QsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNyQixNQUFNLENBQUMsT0FBTyxDQUFDO0FBQ2pCLENBQUM7QUFFRCx1QkFBdUIsSUFBSSxFQUFFLElBQUk7SUFDL0IsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLElBQUksSUFBSSxLQUFLLFFBQVEsQ0FBQyxhQUFhLENBQUMsQ0FBQSxDQUFDO1FBQzVELElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUNiLCtCQUF1QixDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ2hDLENBQUM7QUFDSCxDQUFDO0FBRUQsd0JBQXdCLEtBQUssRUFBRSxJQUFJO0lBQ2pDLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztJQUN2QixjQUFRLENBQUMsc0JBQXNCLEVBQUUsRUFBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBQzlGLENBQUM7QUFFRCxtQ0FBbUMsUUFBUSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFFBQVE7SUFDekUsSUFBSSxPQUFPLEdBQXFFLEVBQUUsQ0FBQztJQUNuRixJQUFJLFFBQVEsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDekIsSUFBSSxPQUFPLEdBQUcsUUFBUSxDQUFDLE9BQU8sQ0FBQztJQUMvQixJQUFJLFNBQVMsR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQztJQUNsRCxJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDNUQsSUFBSSxNQUFNLEdBQUcsT0FBTyxDQUFDLEVBQUUsQ0FBQztJQUN4QixJQUFJLElBQUksR0FBRyxTQUFHLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxFQUFDLFFBQUEsTUFBTSxFQUFFLFdBQUEsU0FBUyxFQUFDLENBQUMsQ0FBQztJQUN4RCxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDWCxJQUFJLFdBQVcsR0FBRyxFQUFFLENBQUM7SUFDckIsR0FBRyxDQUFBLENBQVksVUFBSSxFQUFmLGdCQUFPLEVBQVAsSUFBZSxDQUFDO1FBQWhCLElBQUksR0FBRyxHQUFJLElBQUksSUFBUjtRQUNULElBQUksUUFBTSxHQUFPLEVBQUMsS0FBSyxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsY0FBYyxFQUFFLEtBQUEsR0FBRyxFQUFFLFFBQUEsTUFBTSxFQUFDLENBQUM7UUFDakUsSUFBSSxTQUFTLEdBQUcsU0FBRyxDQUFDLE9BQU8sQ0FBQyxlQUFlLEVBQUUsRUFBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLE1BQU0sRUFBRSxTQUFTLEVBQUUsR0FBRyxDQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLEtBQUssRUFBQyxDQUFDLENBQUM7UUFDL0csSUFBSSxNQUFJLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQztRQUNyQixJQUFJLFVBQVUsU0FBQSxDQUFDO1FBQ2YsSUFBSSxPQUFPLEdBQUcsU0FBRyxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsRUFBQyxFQUFFLEVBQUUsTUFBSSxFQUFDLENBQUMsQ0FBQztRQUN0RCxFQUFFLENBQUEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ2IsVUFBVSxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUM7WUFDOUIsRUFBRSxDQUFBLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxDQUFDO2dCQUFDLFFBQVEsQ0FBQztZQUNyQyxXQUFXLENBQUMsVUFBVSxDQUFDLEdBQUcsSUFBSSxDQUFDO1lBQy9CLE1BQUksR0FBRyxPQUFLLFNBQUcsQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLEVBQUMsRUFBRSxFQUFFLFVBQVUsRUFBQyxDQUFDLENBQUMsS0FBTyxDQUFDO1lBQ2pFLFFBQU0sQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO1lBQy9CLFFBQU0sQ0FBQyxLQUFLLEdBQUcsTUFBSSxDQUFDO1FBQ3RCLENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNsQixNQUFJLEdBQUcsT0FBSyxPQUFPLENBQUMsSUFBTSxDQUFDO1FBQzdCLENBQUM7UUFDRCxRQUFNLENBQUMsUUFBUSxHQUFHO1lBQ2hCLEVBQUMsQ0FBQyxFQUFFLGdCQUFnQixFQUFFLElBQUksRUFBRSxTQUFTLEVBQUM7WUFDdEMsRUFBQyxDQUFDLEVBQUUsYUFBYSxFQUFFLGVBQWUsRUFBRSxJQUFJLEVBQUUsTUFBQSxNQUFJLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRSxLQUFLLEVBQUMsY0FBYyxFQUFFLFFBQVEsRUFBQyxRQUFNLEVBQUUsT0FBTyxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUUsYUFBYSxFQUFDO1NBQ3JKLENBQUE7UUFDRCxPQUFPLENBQUMsSUFBSSxDQUFDLFFBQU0sQ0FBQyxDQUFDO1FBQ3JCLEVBQUUsRUFBRSxDQUFDO0tBQ047SUFDRCxJQUFJLE1BQU0sR0FBTyxFQUFDLEtBQUssRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLGNBQWMsRUFBRSxXQUFBLFNBQVMsRUFBRSxRQUFBLE1BQU0sRUFBQyxDQUFDO0lBQ3ZFLE1BQU0sQ0FBQyxRQUFRLEdBQUc7UUFDaEIsRUFBQyxDQUFDLEVBQUUsZ0JBQWdCLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBQztRQUN0QyxFQUFDLENBQUMsRUFBRSxhQUFhLEVBQUUsZUFBZSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUMsTUFBTSxFQUFFLE9BQU8sRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLGFBQWEsRUFBQztLQUMzRyxDQUFBO0lBQ0QsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNyQixNQUFNLENBQUMsT0FBTyxDQUFDO0FBQ2pCLENBQUM7QUFFRCx3QkFBd0IsSUFBSSxFQUFFLElBQUksRUFBRSxPQUFPO0lBQ3pDLElBQUksS0FBZ0QsSUFBSSxDQUFDLFFBQVEsRUFBNUQsR0FBRyxXQUFFLFdBQVcsbUJBQUUsTUFBTSxjQUFFLFVBQVUsa0JBQUUsS0FBSyxXQUFpQixDQUFDO0lBQ2xFLElBQUksT0FBTyxHQUFHLGVBQWUsQ0FBQyxFQUFDLGFBQWEsRUFBRSxFQUFDLEtBQUssRUFBRSxXQUFXLEVBQUMsRUFBQyxFQUFFLEVBQUMsS0FBQSxHQUFHLEVBQUUsWUFBQSxVQUFVLEVBQUUsT0FBQSxLQUFLLEVBQUMsQ0FBQyxDQUFDO0lBQy9GLEVBQUUsQ0FBQSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUNaLE9BQU8sQ0FBQyxHQUFHLENBQUMseUJBQXlCLENBQUMsQ0FBQztJQUN6QyxDQUFDO0lBQ0Qsd0VBQXdFO0lBQ3hFLEVBQUUsQ0FBQSxDQUFDLFNBQUcsQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLEVBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNLEVBQUUsU0FBUyxFQUFFLEdBQUcsQ0FBQyxTQUFTLEVBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM5RSxPQUFPLENBQUksSUFBSSxTQUFJLGVBQWUsQ0FBQyxNQUFNLENBQUcsQ0FBQyxDQUFDO0lBQ2hELENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNOLHdEQUF3RDtRQUN4RCxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDZCxDQUFDO0FBQ0gsQ0FBQztBQUVELGlDQUFpQyxLQUFLO0lBQ3BDLElBQUksT0FBTyxHQUFHLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUMzQixFQUFFLENBQUEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztRQUN0QixVQUFVO1FBQ1YsT0FBTyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDdEMsSUFBSSxPQUFPLEdBQUcsU0FBRyxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsRUFBQyxJQUFJLEVBQUUsT0FBTyxFQUFDLENBQUMsSUFBSSxTQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxFQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUMsQ0FBQyxDQUFDO1FBQ3pHLEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDWCxNQUFNLENBQUMsRUFBQyxPQUFPLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsRUFBRSxFQUFDLENBQUM7UUFDNUMsQ0FBQztRQUNELElBQUksTUFBTSxHQUFHLHFCQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDOUIsTUFBTSxDQUFDLEVBQUMsT0FBTyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUMsQ0FBQztJQUN6RCxDQUFDO0lBQUMsSUFBSSxDQUFDLENBQUM7UUFDTixNQUFNLENBQUMsRUFBQyxPQUFPLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxtQkFBVyxDQUFDLE9BQU8sQ0FBQyxFQUFDLENBQUM7SUFDdEQsQ0FBQztBQUNILENBQUM7QUFFRCxtQ0FBbUMsTUFBTSxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsS0FBTTtJQUNsRSxFQUFFLENBQUEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDVixLQUFLLEdBQUcsY0FBUSxFQUFFLENBQUM7SUFDckIsQ0FBQztJQUNELElBQUksS0FBMEIsdUJBQXVCLENBQUMsTUFBTSxDQUFDLEVBQXhELE9BQU8sZUFBRSxLQUFLLGFBQUUsS0FBSyxXQUFtQyxDQUFDO0lBQzlELEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDWCxLQUFLLENBQUMsUUFBUSxDQUFDLGlCQUFpQixFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUUsV0FBQSxTQUFTLEVBQUUsT0FBQSxLQUFLLEVBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ3pFLENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNOLElBQUksU0FBUyxHQUFHLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUM3QixnQkFBZ0I7UUFDaEIsY0FBUSxDQUFDLGNBQWMsRUFBRSxFQUFDLEtBQUssRUFBRSxTQUFTLEVBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ3RELDBDQUEwQztRQUMxQyxJQUFJLFNBQVMsR0FBRyxTQUFHLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxFQUFDLEtBQUssRUFBRSxTQUFTLEVBQUMsQ0FBQyxDQUFDO1FBQy9ELEVBQUUsQ0FBQSxDQUFDLENBQUMsU0FBUyxDQUFDO1lBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztRQUM1QixJQUFJLEVBQUUsR0FBRyxTQUFTLENBQUMsRUFBRSxDQUFDO1FBQ3RCLElBQUksTUFBTSxHQUFHLGFBQWEsQ0FBQyxTQUFTLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDMUMsRUFBRSxDQUFBLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BCLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDZixDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixlQUFlO1lBQ2YsSUFBSSxVQUFVLEdBQUcsc0JBQW1CLE1BQU0sU0FBSSxTQUFTLFNBQUksRUFBRSxxQkFBYyxFQUFFLFlBQU0sTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLHNGQUN0RCxNQUFNLHdCQUFpQixTQUFTLGtDQUEyQixFQUFFLFNBQUssQ0FBQztZQUNqSSxLQUFLLENBQUMsUUFBUSxDQUFDLG9CQUFvQixFQUFFLEVBQUMsS0FBSyxFQUFFLFVBQVUsRUFBQyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDckUsQ0FBQztJQUNILENBQUM7SUFDRCxNQUFNLENBQUMsSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQUVELHdCQUF3QixJQUFJLEVBQUUsSUFBSSxFQUFFLE9BQU87SUFDekMsSUFBSyxRQUFRLEdBQUksSUFBSSxTQUFBLENBQUM7SUFDdEIsSUFBSyxNQUFNLEdBQTRCLFFBQVEsU0FBbEMsU0FBUyxHQUFpQixRQUFRLFlBQXZCLFdBQVcsR0FBSSxRQUFRLFlBQUEsQ0FBQztJQUNoRCxJQUFJLE9BQU8sR0FBRyx5QkFBeUIsQ0FBQyxNQUFNLEVBQUUsU0FBUyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBQ3hFLEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDWCxPQUFPLENBQUksSUFBSSx1QkFBa0IsU0FBVyxDQUFDLENBQUM7SUFDaEQsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ04sT0FBTyxDQUFDLEtBQUssQ0FBQyxrQ0FBa0MsR0FBRyxXQUFXLENBQUMsQ0FBQztRQUNoRSxPQUFPLENBQUksSUFBSSx5RUFBc0UsQ0FBQyxDQUFBO0lBQ3hGLENBQUM7QUFDSCxDQUFDO0FBRUQsb0JBQW9CLEtBQUssRUFBRSxJQUFJO0lBQzdCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDO0lBQzlCLEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxPQUFPLEtBQUssWUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7UUFDaEMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxXQUFXLEdBQUcsS0FBSyxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUM7UUFDNUQsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ3pCLENBQUM7SUFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLE9BQU8sS0FBSyxZQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNwQyxjQUFRLENBQUMsc0JBQXNCLEVBQUUsRUFBQyxNQUFBLElBQUksRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ25FLENBQUM7SUFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLE9BQU8sS0FBSyxZQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUN0QyxjQUFRLENBQUMsc0JBQXNCLEVBQUUsRUFBQyxNQUFBLElBQUksRUFBRSxTQUFTLEVBQUUsQ0FBQyxFQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNsRSxDQUFDO0lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxPQUFPLEtBQUssWUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDckMsY0FBUSxDQUFDLGtCQUFrQixDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDdEMsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ3hCLFdBQVcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN2RCxDQUFDO0lBQ0gsQ0FBQztBQUNILENBQUM7QUFFRCxnQkFBdUIsUUFBZSxFQUFFLE1BQWEsRUFBRSxJQUFVLEVBQUUsT0FBZ0I7SUFBaEIsdUJBQWdCLEdBQWhCLFlBQWdCO0lBQ2pGLElBQUksTUFBd0IsU0FBRyxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsRUFBQyxNQUFNLEVBQUUsUUFBUSxFQUFDLENBQUMsSUFBSSxFQUFFLFdBQXRFLE9BQU8sbUJBQUcsU0FBUyxLQUFtRCxDQUFDO0lBQzVFLEVBQUUsQ0FBQSxDQUFDLE9BQU8sS0FBSyxTQUFTLENBQUM7UUFBQyxNQUFNLENBQUMsRUFBQyxJQUFJLEVBQUUsbUNBQW1DLEVBQUMsQ0FBQztJQUM3RSxJQUFJLElBQUksR0FBRyxTQUFHLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxFQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2xFLElBQUssSUFBSSxHQUFJLFNBQUcsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLEVBQUMsRUFBRSxFQUFFLFFBQVEsRUFBQyxDQUFDLEtBQUEsQ0FBQztJQUN6RCxJQUFJLEtBQUssR0FBRyxRQUFRLENBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3RDLElBQUksSUFBSSxHQUFHO1FBQ1QsV0FBVyxFQUFFLFVBQUMsRUFBRSxJQUFLLE9BQUEsaUJBQWlCLENBQUMsRUFBRSxFQUFFLE1BQU0sQ0FBQyxFQUE3QixDQUE2QjtRQUNsRCxXQUFXLEVBQUUsVUFBQyxFQUFFLElBQUssT0FBQSxhQUFhLENBQUMsRUFBRSxFQUFFLE1BQU0sQ0FBQyxFQUF6QixDQUF5QjtRQUM5QyxHQUFHLEVBQUUsVUFBQyxFQUFFLElBQUssT0FBQSxpQkFBaUIsQ0FBQyxFQUFFLEVBQUUsTUFBTSxDQUFDLEVBQTdCLENBQTZCO0tBQzNDLENBQUM7SUFDRixFQUFFLENBQUEsQ0FBQyxJQUFJLEtBQUssSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDeEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHO1lBQ1osY0FBUSxDQUFDLGNBQWMsRUFBRSxFQUFFLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUN0QyxJQUFJLE1BQU0sR0FBRyxTQUFHLENBQUMsT0FBTyxDQUFDLGdCQUFnQixFQUFFLEVBQUMsSUFBSSxFQUFFLE1BQU0sRUFBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDckUsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN6QyxDQUFDLENBQUM7SUFDSixDQUFDO0lBQ0QsSUFBSSxZQUFZLEdBQUcsbUJBQVcsQ0FBQyxFQUFDLE1BQUEsSUFBSSxFQUFDLEVBQUUsT0FBTyxDQUFDLENBQUM7SUFDaEQsSUFBSSxTQUFTLEdBQUcsS0FBSyxDQUFDLEdBQUcsQ0FBQyxVQUFDLElBQUksRUFBRSxFQUFFO1FBQ2pDLElBQUksRUFBRSxDQUFDO1FBQ1AsSUFBSSxNQUFNLEdBQUcsV0FBVyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNsQyxFQUFFLENBQUEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ1YsRUFBRSxHQUFHLFVBQVUsQ0FBQyxRQUFRLEVBQUUsTUFBTSxFQUFFLE1BQU0sSUFBSSxJQUFJLENBQUMsQ0FBQztRQUNwRCxDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixFQUFFLEdBQUcsTUFBTSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ3hDLENBQUM7UUFDRCxFQUFFLENBQUMsRUFBRSxHQUFNLE1BQU0sU0FBSSxJQUFJLENBQUMsRUFBSSxDQUFDO1FBQy9CLEVBQUUsQ0FBQyxVQUFVLEdBQUcsWUFBWSxDQUFDO1FBQzdCLEVBQUUsQ0FBQyxhQUFhLENBQUMsR0FBTSxNQUFNLFNBQUksSUFBSSxDQUFDLEVBQUUsZUFBWSxDQUFDO1FBQ3JELEVBQUUsQ0FBQyxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUM7UUFDbEIsTUFBTSxDQUFDLEVBQUUsQ0FBQztJQUNaLENBQUMsQ0FBQyxDQUFDO0lBQ0gsSUFBSSxLQUFLLENBQUM7SUFDVixFQUFFLENBQUEsQ0FBQyxJQUFJLEtBQUssSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDeEIsNkZBQTZGO1FBQzdGLEtBQUssR0FBRyxZQUFZLENBQUMsUUFBUSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ3ZDLEtBQUssQ0FBQyxDQUFDLElBQUksa0JBQWtCLENBQUM7SUFDaEMsQ0FBQztJQUNELE1BQU0sQ0FBQyxFQUFDLEVBQUUsRUFBSyxNQUFNLFNBQUksUUFBUSxZQUFTLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUUsYUFBYSxFQUFFLFFBQVEsRUFBRTtZQUNwRjs7Ozs7O2VBTUc7WUFDSCxFQUFDLENBQUMsRUFBRSxhQUFhLEVBQUUsVUFBVSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxFQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUUsTUFBQSxJQUFJLEVBQUUsUUFBQSxNQUFNLEVBQUMsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxZQUFZLEVBQUUsT0FBQSxLQUFLLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBQztZQUMzSyxLQUFLO1NBQ04sRUFBQyxDQUFDO0FBQ0wsQ0FBQztBQWxEZSxjQUFNLFNBa0RyQixDQUFBO0FBRUQsMkJBQTJCLEVBQUUsRUFBRSxNQUFNO0lBQ25DLEVBQUUsQ0FBQSxDQUFDLENBQUMsRUFBRSxDQUFDLGlCQUFpQixFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzNCLElBQUksR0FBRyxHQUFHLEVBQUUsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDL0IsSUFBSSxLQUFLLEdBQUcsRUFBRSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNoQyxJQUFJLElBQUksQ0FBQztRQUNULEdBQUcsQ0FBQSxDQUFhLFVBQUssRUFBakIsaUJBQVEsRUFBUixJQUFpQixDQUFDO1lBQWxCLElBQUksSUFBSSxHQUFJLEtBQUssSUFBVDtZQUNWLElBQUssRUFBRSxHQUFJLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBQSxDQUFDO1lBQ3ZCLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDLEVBQUUsS0FBSyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFDakMsSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7Z0JBQ2pCLEtBQUssQ0FBQztZQUNSLENBQUM7U0FDRjtRQUNELEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDUixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNyQyxjQUFRLENBQUMsZUFBZSxFQUFFLEVBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsTUFBQSxJQUFJLEVBQUUsT0FBQSxLQUFLLEVBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQy9ELE1BQU0sQ0FBQztRQUNULENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLElBQUksS0FBSyxDQUFDLElBQUksR0FBRyxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3pDLE1BQU0sQ0FBQztRQUNULENBQUM7SUFDSCxDQUFDO0lBQ0QsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUM7QUFDekIsQ0FBQztBQUVELHVCQUF1QixFQUFFLEVBQUUsTUFBTTtJQUMvQixFQUFFLENBQUEsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUMzQixJQUFJLEdBQUcsR0FBRyxFQUFFLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQy9CLElBQUksS0FBSyxHQUFHLEVBQUUsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDaEMsSUFBSSxPQUFPLENBQUM7UUFDWixHQUFHLENBQUEsQ0FBYSxVQUFLLEVBQWpCLGlCQUFRLEVBQVIsSUFBaUIsQ0FBQztZQUFsQixJQUFJLElBQUksR0FBSSxLQUFLLElBQVQ7WUFDVixFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztnQkFDYixPQUFPLEdBQUcsSUFBSSxDQUFDO1lBQ2pCLENBQUM7U0FDRjtRQUNELEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDWCxnRUFBZ0U7WUFDaEUsZ0VBQWdFO1lBQ2hFLE1BQU07WUFDTixJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNyRCxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO2dCQUNSLElBQUksSUFBSSxHQUFHLGNBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNuQyxJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztnQkFDM0MsUUFBUSxDQUFDLEVBQUMsT0FBTyxFQUFFLE1BQU0sQ0FBQyxJQUFJLEVBQUUsT0FBTyxFQUFFLE1BQU0sQ0FBQyxHQUFHLEVBQUUsY0FBYyxFQUFFLGNBQUssQ0FBQyxFQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDdEYsQ0FBQztRQUNILENBQUM7SUFDSCxDQUFDO0FBQ0gsQ0FBQztBQUVELElBQUksV0FBVyxHQUFHLEVBQUUsQ0FBQztBQUVyQixZQUFTLENBQUMsa0JBQWtCLEVBQUUsVUFBQyxPQUFPLEVBQUUsSUFBSTtJQUMxQyxHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLFdBQVcsQ0FBQyxDQUFDLENBQUM7UUFDNUIsT0FBTyxDQUFDLFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztJQUMxRCxDQUFDO0FBQ0gsQ0FBQyxDQUFDLENBQUM7QUFFSCxZQUFTLENBQUMsZUFBZSxFQUFFLFVBQUMsT0FBTyxFQUFFLElBQUk7SUFDdkMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUN6QyxJQUFLLEVBQUUsR0FBSSxJQUFJLEdBQUEsQ0FBQztJQUNoQixJQUFJLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQztJQUNsQixXQUFXLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDO0FBQ3pCLENBQUMsQ0FBQyxDQUFDO0FBRUgsWUFBUyxDQUFDLGtCQUFrQixFQUFFLFVBQUMsT0FBTyxFQUFFLElBQUk7SUFDMUMsSUFBSyxFQUFFLEdBQUksSUFBSSxHQUFBLENBQUM7SUFDaEIsT0FBTyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUM7QUFDekIsQ0FBQyxDQUFDLENBQUM7QUFFSCxZQUFTLENBQUMsY0FBYyxFQUFFLFVBQUMsT0FBTyxFQUFFLElBQUk7SUFDdEMsSUFBSSxNQUFNLEdBQUcsV0FBVyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUNsQyxNQUFNLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQztJQUNwQixNQUFNLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUM7QUFDNUIsQ0FBQyxDQUFDLENBQUM7QUFFSCxZQUFTLENBQUMsa0JBQWtCLEVBQUUsVUFBQyxPQUFPLEVBQUUsSUFBSTtJQUMxQyxJQUFJLE1BQU0sR0FBRyxXQUFXLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2xDLE1BQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztJQUMxQixNQUFNLENBQUMsUUFBUSxHQUFHLENBQUMsQ0FBQztJQUNwQixNQUFNLENBQUMsS0FBSyxHQUFHLE9BQU8sQ0FBQztBQUN6QixDQUFDLENBQUMsQ0FBQztBQUVILFlBQVMsQ0FBQyxzQkFBc0IsRUFBRSxVQUFDLE9BQU8sRUFBRSxJQUFJO0lBQzlDLElBQUksTUFBTSxHQUFHLFdBQVcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ3ZDLElBQUssU0FBUyxHQUFXLElBQUksWUFBYixLQUFLLEdBQUksSUFBSSxNQUFBLENBQUM7SUFDOUIsRUFBRSxDQUFBLENBQUMsS0FBSyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDdkIsTUFBTSxDQUFDLFFBQVEsSUFBSSxTQUFTLENBQUM7SUFDL0IsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ04sTUFBTSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7SUFDMUIsQ0FBQztBQUNILENBQUMsQ0FBQyxDQUFDO0FBRUgsMEJBQTBCLEtBQUssRUFBRSxJQUFJO0lBQ25DLElBQUssSUFBSSxHQUFJLElBQUksS0FBQSxDQUFDO0lBQ2xCLGNBQVEsQ0FBQyxrQkFBa0IsRUFBRSxFQUFDLEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLE1BQUEsSUFBSSxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsYUFBYSxDQUFDLFdBQVcsRUFBQyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7QUFDckcsQ0FBQztBQUVELHNCQUFzQixLQUFLLEVBQUUsSUFBSTtJQUMvQixJQUFLLElBQUksR0FBSSxJQUFJLEtBQUEsQ0FBQztJQUNsQixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNyQyxjQUFRLENBQUMsZUFBZSxFQUFFLEVBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsTUFBQSxJQUFJLEVBQUUsT0FBQSxLQUFLLEVBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQy9ELEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztBQUN6QixDQUFDO0FBRUQsMkJBQTJCLEVBQUUsRUFBRSxNQUFNO0lBQ25DLElBQUksTUFBTSxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzdDLHdGQUF3RjtJQUN4RixFQUFFLENBQUMsU0FBUyxDQUFDO1FBQ1gsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNoQyxJQUFJLEVBQUUsR0FBRyxZQUFJLEVBQUUsQ0FBQztRQUNoQixFQUFFLENBQUMsWUFBWSxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQy9DLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssQ0FBQyxDQUFDO1lBQUMsTUFBTSxDQUFDO1FBQzNCLElBQUksRUFBRSxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQy9DLElBQUksTUFBTSxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbkMsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUMvQixJQUFJLElBQUksR0FBRyxFQUFDLElBQUEsRUFBRSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLElBQUksR0FBRyxNQUFNLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRSxFQUFFLFFBQUEsTUFBTSxFQUFDLENBQUM7UUFDNUYsY0FBUSxDQUFDLGVBQWUsRUFBRSxFQUFDLElBQUEsRUFBRSxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsTUFBQSxJQUFJLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBQyxDQUFDLENBQUM7SUFDdEUsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBRUQsNkJBQTZCLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLE1BQU07SUFDakQsTUFBTSxDQUFDLFVBQUMsS0FBSztRQUNYLElBQUksS0FBYSxJQUFJLENBQUMsSUFBSSxFQUFFLEVBQXZCLElBQUksWUFBRSxFQUFFLFFBQWUsQ0FBQztRQUM3QixFQUFFLENBQUEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNwQixLQUFLLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM3QixDQUFDO1FBQ0QsS0FBSyxHQUFHLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNyQixJQUFJLEtBQW9CLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQW5DLElBQUksVUFBRSxTQUFTLFFBQW9CLENBQUM7UUFDekMsSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUNuQix3REFBd0Q7UUFDeEQsSUFBSSxPQUFPLEdBQUcsU0FBRyxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsRUFBQyxJQUFJLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztRQUN4RCxFQUFFLENBQUEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ1gsSUFBSSxHQUFHLE9BQU8sQ0FBQyxFQUFFLENBQUM7UUFDcEIsQ0FBQztRQUNELElBQUksV0FBVyxHQUFHLE1BQUksSUFBSSxVQUFJLFNBQVMsSUFBSSxFQUFFLE9BQUcsQ0FBQztRQUNqRCxFQUFFLENBQUEsQ0FBQyxJQUFJLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztZQUNmLFdBQVcsR0FBRyxFQUFFLENBQUM7UUFDbkIsQ0FBQztRQUNELEVBQUUsQ0FBQSxDQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxLQUFLLFdBQVcsQ0FBQyxDQUFDLENBQUM7WUFDekMsRUFBRSxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUUsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3pDLENBQUM7UUFDRCxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3ZDLElBQUksS0FBSyxHQUFHLGNBQVEsQ0FBQyxrQkFBa0IsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUMvQyxFQUFFLENBQUEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ2YsS0FBSyxDQUFDLFFBQVEsQ0FBQyxjQUFjLEVBQUUsRUFBQyxLQUFLLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztRQUNoRCxDQUFDO1FBQ0QsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ2pCLENBQUMsQ0FBQTtBQUNILENBQUM7QUFFRCwwQkFBMEIsS0FBSyxFQUFFLElBQUk7SUFDbkMsSUFBSyxNQUFNLEdBQVUsSUFBSSxTQUFaLElBQUksR0FBSSxJQUFJLEtBQUEsQ0FBQztJQUMxQixJQUFJLE1BQU0sR0FBRyxLQUFLLENBQUMsYUFBYSxDQUFDO0lBQ2pDLElBQUksS0FBSyxHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUM7SUFDL0IsSUFBSSxNQUFNLEdBQUcsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2pDLElBQUksRUFBRSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUM7SUFDM0IsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDakMsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLE9BQU8sS0FBSyxZQUFJLENBQUMsU0FBUyxJQUFJLEtBQUssS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3BELElBQUksS0FBYSxJQUFJLENBQUMsSUFBSSxFQUFFLEVBQXZCLElBQUksWUFBRSxFQUFFLFFBQWUsQ0FBQztRQUM3QixFQUFFLENBQUMsWUFBWSxDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDOUIsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN2QyxjQUFRLENBQUMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDNUMsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ3pCLENBQUM7SUFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLE9BQU8sS0FBSyxZQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sS0FBSyxZQUFJLENBQUMsS0FBSyxJQUFJLEtBQUssQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDOUYsSUFBSSxLQUFhLElBQUksQ0FBQyxJQUFJLEVBQUUsRUFBdkIsSUFBSSxZQUFFLEVBQUUsUUFBZSxDQUFDO1FBQzdCLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ3BCLEVBQUUsQ0FBQyxZQUFZLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxFQUFFLENBQUMsQ0FBQztRQUNsQyxDQUFDO1FBQ0QsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFVBQVUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN2QyxjQUFRLENBQUMsa0JBQWtCLEVBQUUsSUFBSSxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDNUMsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ3pCLENBQUM7SUFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLE9BQU8sS0FBSyxZQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUN2QyxJQUFJLE9BQU8sR0FBRyxtQkFBbUIsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztRQUMxRCxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUN6QyxFQUFFLENBQUEsQ0FBQyxPQUFPLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxLQUFLLFVBQVUsQ0FBQyxDQUFDLENBQUM7Z0JBQzlDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDN0MsQ0FBQztRQUNILENBQUM7UUFDRCxLQUFLLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDekIsQ0FBQztJQUFDLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxLQUFLLENBQUMsT0FBTyxLQUFLLFlBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3BDLGNBQVEsQ0FBQyxzQkFBc0IsRUFBRSxFQUFDLE1BQUEsSUFBSSxFQUFFLFNBQVMsRUFBQyxDQUFDLENBQUMsRUFBQyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDaEUsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ3pCLENBQUM7SUFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLE9BQU8sS0FBSyxZQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUN0QyxjQUFRLENBQUMsc0JBQXNCLEVBQUUsRUFBQyxNQUFBLElBQUksRUFBRSxTQUFTLEVBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUMvRCxLQUFLLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDekIsQ0FBQztJQUNELEtBQUssQ0FBQyxlQUFlLEVBQUUsQ0FBQztBQUMxQixDQUFDO0FBRUQsb0JBQW9CLElBQUksRUFBRSxPQUFPO0lBQzdCLGNBQVEsQ0FBQyxhQUFhLEVBQUUsRUFBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxTQUFBLE9BQU8sRUFBQyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7QUFDakUsQ0FBQztBQUVELGtCQUFrQixLQUFLLEVBQUUsSUFBSTtJQUMzQixJQUFLLE1BQU0sR0FBSSxJQUFJLENBQUMsSUFBSSxPQUFBLENBQUM7SUFDekIsSUFBSSxJQUFJLEdBQU8sRUFBQyxRQUFBLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBQyxDQUFDO0lBQzNELEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQ2pCLElBQUksQ0FBQyxDQUFDLEdBQUcsbUJBQW1CLENBQUM7UUFDN0IsSUFBSSxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDO0lBQ3pCLENBQUM7SUFDRCxjQUFRLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ3pDLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztBQUN6QixDQUFDO0FBRUQsMkRBQTJEO0FBQzNELGVBQWU7QUFDZiwyREFBMkQ7QUFFM0Qsa0JBQWtCLE9BQWUsRUFBRSxNQUFNO0lBQ3ZDLElBQUksS0FBSyxHQUFHLEVBQUUsQ0FBQztJQUNmLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNYLElBQUksR0FBRyxHQUFHLEVBQUUsQ0FBQztJQUNiLEdBQUcsQ0FBQSxDQUFhLFVBQTRCLEVBQTVCLEtBQUEsT0FBTyxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsRUFBeEMsY0FBUSxFQUFSLElBQXdDLENBQUM7UUFBekMsSUFBSSxJQUFJLFNBQUE7UUFDVixFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNuQixJQUFJLEVBQUUsR0FBRyxJQUFJLENBQUM7WUFDZCxFQUFFLENBQUEsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ2QsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNoQixDQUFDO1lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUN6QixFQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNoQixHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUNkLENBQUM7WUFDRCxJQUFJLFdBQVcsR0FBRyxLQUFLLENBQUM7WUFDeEIsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDaEMsV0FBVyxHQUFHLElBQUksQ0FBQztZQUNyQixDQUFDO1lBQ0QsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFDLEtBQUssRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFBLEVBQUUsRUFBRSxhQUFBLFdBQVcsRUFBQyxDQUFDLENBQUM7UUFDeEgsQ0FBQztRQUNELEVBQUUsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDO0tBQ25CO0lBQ0QsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLE1BQU0sSUFBSSxXQUFXLENBQUMsQ0FBQyxDQUFDO1FBQzlCLElBQUksSUFBSSxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDcEMsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsTUFBTSxLQUFLLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDOUMsS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNuQixDQUFDO0lBQ0gsQ0FBQztJQUNELE1BQU0sQ0FBQyxLQUFLLENBQUM7QUFDZixDQUFDO0FBRUQsMkRBQTJEO0FBQzNELGFBQWE7QUFDYiwyREFBMkQ7QUFFM0QseUJBQXlCLENBQUMsRUFBRSxDQUFDO0lBQzNCLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDO0lBQzVCLElBQUksS0FBSyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDO0lBQzVCLEVBQUUsQ0FBQSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7UUFBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDNUIsRUFBRSxDQUFBLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztRQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7SUFDM0IsTUFBTSxDQUFDLENBQUMsQ0FBQztBQUNYLENBQUM7QUFFRCxzQkFBc0IsUUFBUSxFQUFFLE1BQU07SUFDcEMsSUFBSSxJQUFJLEdBQUcsU0FBRyxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsRUFBQyxNQUFNLEVBQUUsUUFBUSxFQUFDLENBQUMsQ0FBQztJQUN2RCxJQUFJLEtBQUssR0FBRyxFQUFFLENBQUM7SUFDZixHQUFHLENBQUEsQ0FBWSxVQUFJLEVBQWYsZ0JBQU8sRUFBUCxJQUFlLENBQUM7UUFBaEIsSUFBSSxHQUFHLEdBQUksSUFBSSxJQUFSO1FBQ1QsSUFBSyxRQUFNLEdBQXNCLEdBQUcsU0FBdkIsU0FBUyxHQUFXLEdBQUcsWUFBWixLQUFLLEdBQUksR0FBRyxNQUFBLENBQUM7UUFDckMsSUFBSSxLQUFLLEdBQUcsU0FBRyxDQUFDLE9BQU8sQ0FBQyxlQUFlLEVBQUUsRUFBQyxRQUFBLFFBQU0sRUFBRSxXQUFBLFNBQVMsRUFBRSxPQUFBLEtBQUssRUFBQyxDQUFDLENBQUM7UUFDckUsSUFBSSxJQUFJLEdBQU8sRUFBQyxLQUFBLEdBQUcsRUFBRSxRQUFRLEVBQUUsQ0FBQyxLQUFLLEVBQUMsQ0FBQztRQUN2QyxFQUFFLENBQUEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ1QsSUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDO1FBQ2pDLENBQUM7UUFDRCxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0tBQ2xCO0lBQ0QsS0FBSyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUM1QixJQUFJLEtBQUssR0FBRyxlQUFPLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDdEQsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ1gsSUFBSSxHQUFHLEdBQUcsS0FBSyxDQUFDLE1BQU0sQ0FBQztJQUN2QixJQUFJLGFBQWEsR0FBRyxFQUFFLENBQUM7SUFDdkIsT0FBTSxFQUFFLEdBQUcsR0FBRyxFQUFFLENBQUM7UUFDZixJQUFJLElBQUksR0FBRyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDckIsSUFBSSxLQUFLLEdBQUcsRUFBQyxRQUFRLEVBQUUsRUFBRSxFQUFDLENBQUM7UUFDM0IsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDO1FBQ25CLE9BQU0sRUFBRSxHQUFHLEdBQUcsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBQy9ELElBQUksS0FBSyxHQUFXLEVBQUMsQ0FBQyxFQUFFLE9BQU8sRUFBRSxHQUFHLEVBQUUsT0FBTyxDQUFDLEdBQUcsRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFDLENBQUM7WUFDakUsSUFBSSxPQUFPLEdBQVcsT0FBTyxDQUFDO1lBQzlCLElBQUksaUJBQWlCLEdBQUcsS0FBSyxDQUFDO1lBQzlCLE9BQU8sQ0FBQyxLQUFLLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUM7WUFDbEMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxHQUFHLGVBQWUsQ0FBQztZQUNwQyxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQztZQUM3QixFQUFFLENBQUEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO2dCQUNyQixLQUFLLENBQUMsQ0FBQyxJQUFJLFlBQVksQ0FBQztnQkFDeEIsaUJBQWlCLEdBQUcsS0FBSyxDQUFDLFVBQVUsS0FBSyxPQUFPLENBQUMsVUFBVSxDQUFDO2dCQUM1RCxPQUFPLENBQUMsSUFBSSxHQUFHLE9BQU8sQ0FBQyxLQUFLLENBQUM7Z0JBQzdCLEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxNQUFNLElBQUksS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEtBQUssT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO29CQUMxRCxJQUFJLEtBQUssR0FBRyxTQUFHLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxFQUFDLEVBQUUsRUFBRSxPQUFPLENBQUMsVUFBVSxFQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7b0JBQ3ZFLEtBQUssQ0FBQyxLQUFLLEdBQUcsa0JBQWtCLENBQUM7b0JBQ2pDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsT0FBTyxDQUFDO29CQUNwQixPQUFPLENBQUMsS0FBSyxHQUFHLElBQUksR0FBRyxLQUFLLENBQUM7b0JBQzdCLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDO29CQUNqQyxPQUFPLENBQUMsWUFBWSxDQUFDLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQztvQkFDM0MsT0FBTyxDQUFDLFVBQVUsR0FBRyxpQkFBUyxDQUFDO29CQUMvQixPQUFPLENBQUMsSUFBSSxHQUFHLFNBQVMsQ0FBQztvQkFDekIsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQy9CLENBQUM7Z0JBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQztvQkFDNUIsS0FBSyxDQUFDLEtBQUssR0FBRyxrQkFBa0IsQ0FBQztvQkFDakMsT0FBTyxDQUFDLElBQUksR0FBRyxtQkFBbUIsQ0FBQztnQkFDckMsQ0FBQztnQkFDRCxLQUFLLENBQUMsWUFBWSxDQUFDLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQztnQkFDekMsS0FBSyxDQUFDLEtBQUssR0FBRyxrQkFBa0IsQ0FBQztZQUNuQyxDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ04sT0FBTyxDQUFDLENBQUMsR0FBRyxPQUFPLENBQUM7WUFDdEIsQ0FBQztZQUNELElBQUksT0FBTyxHQUFHLFNBQUcsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLEVBQUMsRUFBRSxFQUFFLE9BQU8sQ0FBQyxLQUFLLEVBQUMsQ0FBQyxDQUFDO1lBQy9ELEVBQUUsQ0FBQSxDQUFDLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQztnQkFDakMsRUFBRSxDQUFBLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxJQUFJLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztvQkFDM0QsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksRUFBRSxFQUFDLFFBQUEsTUFBTSxFQUFDLEVBQUUsSUFBSSxFQUFFLE9BQU8sQ0FBQyxFQUFFLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztvQkFDcEgsS0FBSyxDQUFDLEtBQUssR0FBRyxrQkFBa0IsQ0FBQztvQkFDakMsT0FBTyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUM7Z0JBQ3BCLENBQUM7Z0JBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ04sT0FBTyxDQUFDLEtBQUssR0FBRyxPQUFLLE9BQU8sQ0FBQyxJQUFNLENBQUM7b0JBQ3BDLE9BQU8sQ0FBQyxVQUFVLEdBQUcsaUJBQVMsQ0FBQztvQkFDL0IsS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQy9CLENBQUM7WUFDSCxDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ04sS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDL0IsQ0FBQztZQUNELEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssT0FBTyxDQUFDLENBQUMsQ0FBQztnQkFDekIsT0FBTyxDQUFDLE9BQU8sR0FBRyxtQkFBbUIsQ0FBQztZQUN4QyxDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ04sS0FBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBQyxDQUFDLEVBQUUsaUJBQWlCLEVBQUMsQ0FBQyxDQUFDO1lBQzlDLENBQUM7WUFDRCxLQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFDLENBQUMsRUFBRSwwQkFBMEIsRUFBRSxHQUFHLEVBQUUsT0FBTyxDQUFDLEdBQUcsRUFBRSxVQUFVLEVBQUUsT0FBTyxDQUFDLFVBQVUsRUFBRSxLQUFLLEVBQUUsT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLEtBQUssRUFBRSxhQUFhLEVBQUMsQ0FBQyxDQUFDO1lBQ3RKLEtBQUssQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzNCLEVBQUUsRUFBRSxDQUFDO1lBQ0wsT0FBTyxHQUFHLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUN0QixDQUFDO1FBQ0QsYUFBYSxDQUFDLElBQUksQ0FBQyxFQUFDLEVBQUUsRUFBSyxRQUFRLFNBQUksTUFBTSxTQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBVyxFQUFFLENBQUMsRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFO2dCQUMvRixFQUFDLENBQUMsRUFBRSxnQkFBZ0IsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUM7Z0JBQy9DLEtBQUs7YUFDTixFQUFDLENBQUMsQ0FBQztJQUNOLENBQUM7SUFDRCxhQUFhLENBQUMsSUFBSSxDQUFDLEVBQUMsRUFBRSxFQUFLLFFBQVEsU0FBSSxNQUFNLFdBQVEsRUFBRSxDQUFDLEVBQUUsaUJBQWlCLEVBQUUsUUFBUSxFQUFFO1lBQ3JGLEVBQUMsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsc0JBQXNCLEVBQUUsV0FBVyxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsbUJBQW1CLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxnQkFBZ0IsRUFBRSxVQUFBLFFBQVEsRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLGNBQWMsRUFBQztZQUNwTSxFQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxVQUFBLFFBQVEsRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLFVBQVUsRUFBQztTQUMzSyxFQUFDLENBQUMsQ0FBQztJQUNKLE1BQU0sQ0FBQyxFQUFDLENBQUMsRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLGFBQWEsRUFBQyxDQUFDO0FBQ3BELENBQUM7QUFFRCx5Q0FBeUMsUUFBUSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLFFBQVE7SUFDL0UsSUFBSSxPQUFPLEdBQW9FLEVBQUUsQ0FBQztJQUNsRiw0REFBNEQ7SUFDNUQsc0RBQXNEO0lBQ3RELE1BQU0sQ0FBQyxPQUFPLENBQUM7QUFDakIsQ0FBQztBQUVELFlBQVMsQ0FBQyxvQkFBb0IsRUFBRSxVQUFDLE9BQWEsRUFBRSxFQUFpQjtRQUFoQixHQUFHLFdBQUUsVUFBVTtJQUM5RCxFQUFFLENBQUEsQ0FBQyxDQUFDLGVBQU8sQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDMUMsZUFBTyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUM3QyxDQUFDO0lBQ0QsSUFBSSxHQUFHLEdBQUcsZUFBTyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ2hELEdBQUcsQ0FBQyxNQUFNLEdBQUcsR0FBRyxDQUFDO0lBQ2pCLEdBQUcsQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO0FBQzlCLENBQUMsQ0FBQyxDQUFDO0FBRUgsWUFBUyxDQUFDLHNCQUFzQixFQUFFLFVBQUMsT0FBYSxFQUFFLEVBQVE7UUFBUCxNQUFNO0lBQ3ZELElBQUksR0FBRyxHQUFHLGVBQU8sQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzVDLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDUCxHQUFHLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztRQUNuQixHQUFHLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQztJQUN6QixDQUFDO0FBQ0gsQ0FBQyxDQUFDLENBQUE7QUFFRix1QkFBdUIsS0FBSyxFQUFFLElBQUk7SUFDaEMsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ3ZCLGVBQWUsQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDL0IsQ0FBQztBQUVELDRCQUE0QixLQUFLLEVBQUUsSUFBSTtJQUNyQyxFQUFFLENBQUEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7UUFDM0IsY0FBUSxDQUFDLG9CQUFvQixFQUFFLEVBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUUsVUFBVSxFQUFFLElBQUksQ0FBQyxVQUFVLEVBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ3RGLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztJQUN6QixDQUFDO0FBQ0gsQ0FBQztBQUVELDZCQUE2QixLQUFLLEVBQUUsSUFBSTtJQUN0QyxFQUFFLENBQUEsQ0FBQyxLQUFLLENBQUMsT0FBTyxLQUFLLFlBQUksQ0FBQyxLQUFLLElBQUksSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDL0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDM0IsQ0FBQztJQUFDLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxLQUFLLENBQUMsT0FBTyxLQUFLLFlBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3JDLGNBQVEsQ0FBQyxvQkFBb0IsRUFBRSxFQUFDLEdBQUcsRUFBRSxFQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBQyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQy9GLENBQUM7QUFDSCxDQUFDO0FBRUQsWUFBUyxDQUFDLG1CQUFtQixFQUFFLFVBQUMsT0FBWSxFQUFFLEVBQXdCO1FBQXZCLFFBQVEsZ0JBQUUsS0FBSyxhQUFFLEtBQUs7SUFDbkUsSUFBSSxHQUFHLEdBQUcsZUFBTyxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDOUMsRUFBRSxDQUFBLENBQUMsQ0FBQyxlQUFPLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDeEMsR0FBRyxHQUFHLGVBQU8sQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUNqRCxDQUFDO0lBQ0QsR0FBRyxDQUFDLEtBQUssQ0FBQyxHQUFHLEtBQUssQ0FBQztBQUNyQixDQUFDLENBQUMsQ0FBQztBQUVILGtCQUFrQixLQUFLLEVBQUUsSUFBSTtJQUMzQixJQUFJLEtBQUssR0FBRyxLQUFLLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQztJQUN0QyxjQUFRLENBQUMsbUJBQW1CLEVBQUUsRUFBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVEsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRSxPQUFBLEtBQUssRUFBQyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7QUFDOUYsQ0FBQztBQUVELHFCQUFxQixLQUFLLEVBQUUsSUFBSTtJQUM5QixJQUFLLFFBQVEsR0FBSSxJQUFJLFNBQUEsQ0FBQztJQUN0QixJQUFJLEtBQUssR0FBRyxlQUFPLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUNoRCxFQUFFLENBQUEsQ0FBQyxDQUFDLEtBQUssQ0FBQztRQUFDLE1BQU0sQ0FBQztJQUNsQixJQUFLLGNBQWMsR0FBZ0IsS0FBSyxpQkFBbkIsVUFBVSxHQUFJLEtBQUssV0FBQSxDQUFDO0lBQ3pDLElBQUksT0FBTyxHQUFHLEtBQUssQ0FBQztJQUNwQixFQUFFLENBQUEsQ0FBQyxjQUFjLElBQUksVUFBVSxDQUFDLENBQUMsQ0FBQztRQUNoQyxJQUFJLEtBQUssR0FBRyxjQUFRLENBQUMsbUJBQW1CLEVBQUUsRUFBQyxVQUFBLFFBQVEsRUFBRSxLQUFLLEVBQUUsZ0JBQWdCLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBQyxDQUFDO2FBQzVFLFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxFQUFDLFVBQUEsUUFBUSxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFLEVBQUUsRUFBQyxDQUFDLENBQUM7UUFDdkYsT0FBTyxHQUFHLHlCQUF5QixDQUFDLFFBQVEsRUFBRSxjQUFjLEVBQUUsVUFBVSxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQ25GLENBQUM7SUFDRCx3REFBd0Q7SUFDeEQsS0FBSyxDQUFDLGFBQWEsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ2xELE1BQU0sQ0FBQyxPQUFPLENBQUM7QUFDakIsQ0FBQztBQUVELFlBQVMsQ0FBQyxtQ0FBbUMsRUFBRSxVQUFDLE9BQVksRUFBRSxFQUFXO1FBQVYsR0FBRyxXQUFFLElBQUk7SUFDdEUsSUFBSSxPQUFPLEdBQU0sR0FBRyxDQUFDLE1BQU0sU0FBSSxHQUFHLENBQUMsU0FBUyxTQUFJLElBQU0sQ0FBQztJQUN2RCxTQUFHLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFBO0lBQ3ZCLE9BQU8sQ0FBQyxLQUFLLENBQUMsZUFBSyxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsU0FBRyxDQUFDLENBQUMsQ0FBQztJQUMxQyx3Q0FBd0M7SUFDeEMsR0FBRyxDQUFBLENBQWUsVUFBbUQsRUFBbkQsS0FBQSxTQUFHLENBQUMsSUFBSSxDQUFDLGVBQWUsRUFBRSxFQUFDLGFBQWEsRUFBRSxPQUFPLEVBQUMsQ0FBQyxFQUFqRSxjQUFVLEVBQVYsSUFBaUUsQ0FBQztRQUFsRSxJQUFJLE1BQU0sU0FBQTtRQUNaLElBQUksTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUM7UUFDM0IsT0FBTyxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsRUFBQyxRQUFBLE1BQU0sRUFBQyxDQUFDLENBQUM7UUFDbkMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRSxFQUFDLFFBQUEsTUFBTSxFQUFDLENBQUMsQ0FBQztRQUMzQyxPQUFPLENBQUMsTUFBTSxDQUFDLHlCQUF5QixFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUMsQ0FBQyxDQUFDO0tBQ3JEO0lBQ0QsT0FBTyxDQUFDLE1BQU0sQ0FBQyxlQUFlLEVBQUUsRUFBQyxNQUFNLEVBQUUsT0FBTyxFQUFDLENBQUMsQ0FBQztBQUNyRCxDQUFDLENBQUMsQ0FBQztBQUVILHlCQUF5QixLQUFLLEVBQUUsSUFBSTtJQUNsQyxJQUFLLEdBQUcsR0FBdUIsSUFBSSxNQUF6QixVQUFVLEdBQVcsSUFBSSxhQUFiLEtBQUssR0FBSSxJQUFJLE1BQUEsQ0FBQztJQUNwQyxJQUFJLEtBQUssR0FBRyxjQUFRLENBQUMsc0JBQXNCLEVBQUUsRUFBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLE1BQU0sRUFBQyxDQUFDLENBQUM7SUFDbkUsSUFBSSxLQUFLLEdBQUksS0FBSyxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUM7SUFDdkMsRUFBRSxDQUFBLENBQUMsS0FBSyxLQUFLLFNBQVMsSUFBSSxLQUFLLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQztRQUMxQyxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ3hCLENBQUM7SUFDRCxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsVUFBVSxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDakMsNEJBQTRCO1FBQzVCLEtBQUssQ0FBQyxRQUFRLENBQUMsbUNBQW1DLEVBQUUsRUFBQyxLQUFBLEdBQUcsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFDLENBQUMsQ0FBQztJQUMvRSxDQUFDO0lBQUMsSUFBSSxDQUFDLENBQUM7UUFDTix5QkFBeUI7UUFDekIsSUFBSSxJQUFJLEdBQUcsWUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3JCLElBQUksQ0FBQyxJQUFJLEdBQUcsU0FBUyxDQUFDO1FBQ3RCLEtBQUssQ0FBQyxRQUFRLENBQUMseUJBQXlCLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDbEQsQ0FBQztJQUNELEVBQUUsQ0FBQSxDQUFDLEtBQUssS0FBSyxTQUFTLElBQUksS0FBSyxLQUFLLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDdkMsTUFBTSxDQUFDLHlCQUF5QixDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDNUUsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ04sS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ2pCLENBQUM7QUFDSCxDQUFDO0FBRUQsMkRBQTJEO0FBQzNELGVBQWU7QUFDZiwyREFBMkQ7QUFDM0QscUJBQTRCLE1BQWEsRUFBRSxLQUFZO0lBQ3JELElBQUksT0FBTyxHQUFHLFNBQUcsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLEVBQUMsRUFBRSxFQUFFLEtBQUssRUFBQyxDQUFDLENBQUM7SUFDdkQsSUFBSSxJQUFJLEdBQUcsS0FBSyxDQUFDO0lBQ2pCLEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDWCxJQUFJLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQztJQUN0QixDQUFDO0lBQ0QsSUFBSSxLQUFLLEdBQUcsZUFBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksRUFBQyxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUMsQ0FBQztJQUMzRSxNQUFNLENBQUM7UUFDTCxDQUFDLEVBQUUsK0JBQStCO1FBQ2xDLFFBQVEsRUFBRTtZQUNSLGlCQUFpQixDQUFDO2dCQUNoQixDQUFDLEVBQUUsa0NBQStCLEtBQUssQ0FBQyxPQUFPLEdBQUcsVUFBVSxHQUFFLEVBQUUsQ0FBRTtnQkFDbEUsUUFBQSxNQUFNO2dCQUNOLEtBQUssRUFBRSxJQUFJO2dCQUNYLEtBQUssRUFBRSxXQUFXO2dCQUNsQixJQUFJLEVBQUUsU0FBUztnQkFDZix3QkFBd0I7Z0JBQ3hCLFNBQVMsRUFBRSxFQUFDLE9BQU8sRUFBRSxTQUFTLEVBQUM7YUFDaEMsQ0FBQztZQUNGLEVBQUMsQ0FBQyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUU7b0JBQ3hCLEVBQUMsQ0FBQyxFQUFFLG9CQUFpQixLQUFLLENBQUMsSUFBSSxHQUFHLElBQUksR0FBRyxNQUFNLFdBQU8sRUFBRSxLQUFLLEVBQUUsZ0JBQWdCLEVBQUUsUUFBQSxNQUFNLEVBQUM7b0JBQ3hGLCtGQUErRjtvQkFDL0YsZ0NBQWdDO29CQUNoQyxFQUFDLENBQUMsRUFBRSw0QkFBNEIsRUFBRSxRQUFBLE1BQU0sRUFBQztpQkFDMUMsRUFBQztTQUNIO0tBQ0YsQ0FBQztBQUNKLENBQUM7QUEzQmUsbUJBQVcsY0EyQjFCLENBQUE7QUFBQSxDQUFDO0FBRUYscUJBQXFCLEtBQUssRUFBRSxJQUFJO0lBQzlCLGNBQVEsQ0FBQyxpQkFBaUIsRUFBRSxJQUFJLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUM3QyxDQUFDO0FBQ0QsbUJBQW1CLEtBQUssRUFBRSxJQUFJO0lBQzVCLElBQUksS0FBSyxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUM7SUFDeEIsSUFBSSxJQUFJLEdBQUcsU0FBRyxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsRUFBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBQyxDQUFDLENBQUM7SUFDdkQsRUFBRSxDQUFBLENBQUMsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLFFBQVEsS0FBSyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUMxQyxjQUFRLENBQUMsY0FBYyxFQUFFLEVBQUMsS0FBSyxFQUFFLEtBQUssRUFBQyxDQUFDO2FBQ3JDLFFBQVEsQ0FBQyxlQUFlLEVBQUUsRUFBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLEtBQUssRUFBQyxDQUFDO2FBQ3BFLE1BQU0sRUFBRSxDQUFDO0lBQ2QsQ0FBQztBQUNILENBQUM7QUFDRCxzQkFBc0IsS0FBSyxFQUFFLElBQUk7SUFDL0IsY0FBUSxDQUFDLGtCQUFrQixFQUFFLElBQUksQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBQzlDLENBQUM7QUFDRCwwQkFBMEIsS0FBSyxFQUFFLElBQUk7SUFDbkMsY0FBUSxDQUFDLHVCQUF1QixFQUFFLElBQUksQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBQ25ELENBQUM7QUFZQSxDQUFDO0FBS0YsMkJBQWtDLElBQWM7SUFDOUMsSUFBSSxDQUFDLFVBQVUsR0FBRyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7SUFDeEQsTUFBTSxDQUFDLElBQUksQ0FBQztBQUNkLENBQUM7QUFIZSx5QkFBaUIsb0JBR2hDLENBQUE7QUFFRCxJQUFJLHlCQUF5QixHQUFHLEVBQUUsQ0FBQztBQUNuQyx1QkFBdUIsT0FBc0IsRUFBRSxJQUFjO0lBQzNELE1BQU0sQ0FBQyxVQUFDLEVBQW9CO1FBQzFCLElBQUksR0FBRyxHQUFpQixDQUFDLElBQUksV0FBVyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDckQsR0FBRyxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUM7UUFDaEIsR0FBRyxDQUFDLEtBQUssR0FBRyxFQUFFLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDbkMsT0FBTyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsQ0FBQztJQUNyQixDQUFDLENBQUE7QUFDSCxDQUFDO0FBQ0QsOEJBQThCLFVBQXlCO0lBQ3JELElBQUksR0FBRyxHQUFHLFVBQVUsR0FBRyxVQUFVLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDO0lBQ2xELEVBQUUsQ0FBQSxDQUFDLHlCQUF5QixDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQUMsTUFBTSxDQUFDLHlCQUF5QixDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3pFLE1BQU0sQ0FBQyx5QkFBeUIsQ0FBQyxHQUFHLENBQUMsR0FBRyxVQUFDLElBQVcsRUFBRSxJQUFjO1FBQ2xFLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7UUFDakIsRUFBRSxDQUFBLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ1AsSUFBSSxTQUFTLEdBQUcsRUFBRSxDQUFDO1lBQ25CLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO2dCQUNsQixHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUM7b0JBQ2pDLFNBQVMsQ0FBQyxRQUFRLENBQUMsR0FBRyxhQUFhLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUN4RSxDQUFDO1lBQ0QsRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLEdBQUcsVUFBVSxDQUFDLElBQUksRUFBRTtnQkFDOUIsWUFBWSxFQUFFLElBQUksQ0FBQyxZQUFZLEtBQUssS0FBSyxHQUFHLElBQUksR0FBRyxLQUFLO2dCQUN4RCxXQUFXLEVBQUUsSUFBSSxDQUFDLFdBQVc7Z0JBQzdCLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxJQUFJLE1BQU07Z0JBQ3pCLFdBQUEsU0FBUzthQUNWLENBQUMsQ0FBQztZQUNILEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7Z0JBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxRQUFRLEVBQUUsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNsRSxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO2dCQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDNUQsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQztnQkFBQyxFQUFFLENBQUMsRUFBRSxDQUFDLE9BQU8sRUFBRSxhQUFhLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQy9ELEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7Z0JBQUMsRUFBRSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ2hDLENBQUM7UUFFRCxFQUFFLENBQUEsQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFLEtBQUssSUFBSSxDQUFDLEtBQUssQ0FBQztZQUFDLEVBQUUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssSUFBSSxFQUFFLENBQUMsQ0FBQztRQUN4RSxFQUFFLENBQUEsQ0FBQyxVQUFVLENBQUM7WUFBQyxVQUFVLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO0lBQ3hDLENBQUMsQ0FBQTtBQUNILENBQUM7QUFFRCxnQ0FBZ0MsT0FBK0IsRUFBRSxFQUEwQjs4QkFBRixFQUFFLGVBQXpCLE1BQU0sbUJBQUcsQ0FBQyxRQUFRLENBQUM7SUFDbkYsSUFBSSxRQUFRLEdBQUcsRUFBRSxDQUFDO0lBQ2xCLEVBQUUsQ0FBQSxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQztRQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUM7SUFFcEMsR0FBRyxDQUFBLENBQWMsVUFBTSxFQUFuQixrQkFBUyxFQUFULElBQW1CLENBQUM7UUFBcEIsSUFBSSxLQUFLLEdBQUksTUFBTSxJQUFWO1FBQ1gsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLFNBQVMsQ0FBQztZQUFDLEtBQUssR0FBRyxpQkFBUyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzdELEdBQUcsQ0FBQSxDQUFhLFVBQU8sRUFBbkIsbUJBQVEsRUFBUixJQUFtQixDQUFDO1lBQXBCLElBQUksSUFBSSxHQUFJLE9BQU8sSUFBWDtZQUFhLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7U0FBQTtLQUNyRDtJQUNELE1BQU0sQ0FBQyxRQUFRLENBQUM7QUFDbEIsQ0FBQztBQUNELDRCQUE0QixPQUErQixFQUFFLEVBQXVCOzhCQUFGLEVBQUUsZUFBdEIsTUFBTSxtQkFBRyxDQUFDLEtBQUssQ0FBQztJQUM1RSxJQUFJLElBQUksR0FBRyxFQUFFLENBQUM7SUFDZCxFQUFFLENBQUEsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUM7UUFBQyxNQUFNLENBQUMsSUFBSSxDQUFDO0lBRWhDLEdBQUcsQ0FBQSxDQUFjLFVBQU0sRUFBbkIsa0JBQVMsRUFBVCxJQUFtQixDQUFDO1FBQXBCLElBQUksS0FBSyxHQUFJLE1BQU0sSUFBVjtRQUNYLEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxTQUFTLENBQUM7WUFBQyxLQUFLLEdBQUcsaUJBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM3RCxHQUFHLENBQUEsQ0FBYSxVQUFPLEVBQW5CLG1CQUFRLEVBQVIsSUFBbUIsQ0FBQztZQUFwQixJQUFJLElBQUksR0FBSSxPQUFPLElBQVg7WUFDVixFQUFFLENBQUEsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7U0FDdkQ7S0FDRjtJQUNELE1BQU0sQ0FBQyxJQUFJLENBQUM7QUFDZCxDQUFDO0FBRUQsdUJBQXVCLE9BQVksRUFBRSxNQUFzQjtJQUN6RCxJQUFJLElBQUksR0FBRyxFQUFFLENBQUM7SUFDZCxJQUFJLFFBQVEsR0FBRyxzQkFBc0IsQ0FBQyxPQUFPLEVBQUUsRUFBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLEtBQUssR0FBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsR0FBRyxTQUFTLEVBQUMsQ0FBQyxDQUFDO0lBQ3BHLElBQUksS0FBSyxHQUFHLEVBQUUsQ0FBQztJQUNmLEdBQUcsQ0FBQSxDQUFlLFVBQVEsRUFBdEIsb0JBQVUsRUFBVixJQUFzQixDQUFDO1FBQXZCLElBQUksUUFBTSxHQUFJLFFBQVEsSUFBWjtRQUNaLElBQUksTUFBSSxHQUFHLFlBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN4QixNQUFJLENBQUMsTUFBTSxHQUFHLFFBQU0sQ0FBQztRQUNyQixLQUFLLENBQUMsSUFBSSxDQUFDLE1BQUksQ0FBQyxDQUFDO0tBQ2xCO0lBQ0QsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUM7UUFBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3ZDLElBQUk7UUFBQyxNQUFNLENBQUMsS0FBSyxDQUFDO0FBQ3BCLENBQUM7QUFDRCxvQkFBb0IsT0FBWSxFQUFFLE1BQXNCO0lBQ3RELElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUNkLElBQUksSUFBSSxHQUFHLGtCQUFrQixDQUFDLE9BQU8sRUFBRSxFQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsS0FBSyxHQUFHLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLFNBQVMsRUFBQyxDQUFDLENBQUM7SUFDNUYsSUFBSSxLQUFLLEdBQUcsRUFBRSxDQUFDO0lBQ2YsR0FBRyxDQUFBLENBQVksVUFBSSxFQUFmLGdCQUFPLEVBQVAsSUFBZSxDQUFDO1FBQWhCLElBQUksR0FBRyxHQUFJLElBQUksSUFBUjtRQUNULElBQUksTUFBSSxHQUFHLFlBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN4QixNQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQztRQUNmLEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBSSxDQUFDLENBQUM7S0FDbEI7SUFDRCxFQUFFLENBQUEsQ0FBQyxLQUFLLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQztRQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDdkMsSUFBSTtRQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUM7QUFDcEIsQ0FBQztBQUVELElBQUksUUFBUSxHQUFtRjtJQUM3RixJQUFJLEVBQUUsYUFBYTtJQUNuQixJQUFJLEVBQUUsYUFBYTtJQUNuQixVQUFVLEVBQUUsYUFBYTtJQUN6QixPQUFPLEVBQUUsYUFBYTtJQUN0QixLQUFLLEVBQUUsYUFBYTtJQUNwQixJQUFJLEVBQUUsYUFBYTtJQUNuQixPQUFPLEVBQUUsYUFBYTtJQUV0QixLQUFLLFlBQUMsT0FBTyxFQUFFLE1BQStCO1FBQzVDLEVBQUUsQ0FBQSxDQUFDLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztZQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsbUZBQW1GLENBQUMsQ0FBQztRQUN2SCxJQUFJLEtBQUssR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDO1FBQ3pCLEVBQUUsQ0FBQSxDQUFDLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQztZQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7UUFFOUIsb0ZBQW9GO1FBQ3BGLEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO1lBQ25DLElBQUksWUFBWSxHQUFHLFNBQUcsQ0FBQyxJQUFJLENBQUMsY0FBYyxFQUFFLEVBQUMsSUFBSSxFQUFFLEtBQUssRUFBQyxDQUFDLENBQUM7WUFDM0QsSUFBSSxTQUFTLENBQUM7WUFDZCxHQUFHLENBQUEsQ0FBZ0IsVUFBWSxFQUEzQix3QkFBVyxFQUFYLElBQTJCLENBQUM7Z0JBQTVCLElBQUksT0FBTyxHQUFJLFlBQVksSUFBaEI7Z0JBQ2IsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO29CQUN4QyxFQUFFLENBQUEsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO3dCQUNiLFNBQVMsR0FBRyxTQUFTLENBQUM7d0JBQ3RCLEtBQUssQ0FBQztvQkFDUixDQUFDO29CQUNELFNBQVMsR0FBRyxPQUFPLENBQUMsRUFBRSxDQUFDO2dCQUN6QixDQUFDO2FBQ0Y7WUFDRCxFQUFFLENBQUEsQ0FBQyxDQUFDLFNBQVMsQ0FBQztnQkFBQyxNQUFNLElBQUksS0FBSyxDQUFDLDJDQUF5QyxLQUFLLDBCQUFxQixNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBRyxDQUFDLENBQUM7WUFDN0gsSUFBSTtnQkFBQyxLQUFLLEdBQUcsU0FBUyxDQUFDO1FBQ3pCLENBQUM7UUFFRCxJQUFJLEtBQUssR0FBRyxFQUFFLENBQUM7UUFDZixHQUFHLENBQUEsQ0FBWSxVQUFPLEVBQWxCLG1CQUFPLEVBQVAsSUFBa0IsQ0FBQztZQUFuQixJQUFJLEdBQUcsR0FBSSxPQUFPLElBQVg7WUFBYSxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUMsSUFBSSxFQUFFLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLElBQUksRUFBQyxDQUFDLENBQUM7U0FBQTtRQUMxRSxNQUFNLENBQUMsS0FBSyxDQUFDO0lBQ2YsQ0FBQztJQUNELEdBQUcsWUFBQyxPQUFPLEVBQUUsTUFBK0I7UUFDMUMsRUFBRSxDQUFBLENBQUMsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO1lBQUMsTUFBTSxJQUFJLEtBQUssQ0FBQyxtRkFBbUYsQ0FBQyxDQUFDO1FBQ3ZILElBQUksS0FBSyxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUM7UUFDekIsRUFBRSxDQUFBLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDO1lBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztRQUU5QixvRkFBb0Y7UUFDcEYsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7WUFDbkMsSUFBSSxZQUFZLEdBQUcsU0FBRyxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsRUFBQyxJQUFJLEVBQUUsS0FBSyxFQUFDLENBQUMsQ0FBQztZQUMzRCxJQUFJLFNBQVMsQ0FBQztZQUNkLEdBQUcsQ0FBQSxDQUFnQixVQUFZLEVBQTNCLHdCQUFXLEVBQVgsSUFBMkIsQ0FBQztnQkFBNUIsSUFBSSxPQUFPLEdBQUksWUFBWSxJQUFoQjtnQkFDYixFQUFFLENBQUEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7b0JBQ3hDLEVBQUUsQ0FBQSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7d0JBQ2IsU0FBUyxHQUFHLFNBQVMsQ0FBQzt3QkFDdEIsS0FBSyxDQUFDO29CQUNSLENBQUM7b0JBQ0QsU0FBUyxHQUFHLE9BQU8sQ0FBQyxFQUFFLENBQUM7Z0JBQ3pCLENBQUM7YUFDRjtZQUNELEVBQUUsQ0FBQSxDQUFDLENBQUMsU0FBUyxDQUFDO2dCQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsMkNBQXlDLEtBQUssMEJBQXFCLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFHLENBQUMsQ0FBQztZQUM3SCxJQUFJO2dCQUFDLEtBQUssR0FBRyxTQUFTLENBQUM7UUFDekIsQ0FBQztRQUVELElBQUksTUFBTSxHQUFHLEVBQUUsQ0FBQztRQUNoQixHQUFHLENBQUEsQ0FBWSxVQUFPLEVBQWxCLG1CQUFPLEVBQVAsSUFBa0IsQ0FBQztZQUFuQixJQUFJLEdBQUcsR0FBSSxPQUFPLElBQVg7WUFDVCxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1NBQ3pCO1FBQ0QsTUFBTSxDQUFDLEVBQUMsUUFBQSxNQUFNLEVBQUUsSUFBSSxFQUFFLE1BQU0sQ0FBQyxJQUFJLEVBQUMsQ0FBQztJQUNyQyxDQUFDO0lBQ0QsS0FBSyxZQUFDLE9BQU8sRUFBRSxNQUFNO1FBQ25CLE1BQU0sQ0FBQyxFQUFDLElBQUksRUFBRSxNQUFNLENBQUMsU0FBUyxDQUFDLEVBQUMsQ0FBQztJQUNuQyxDQUFDO0lBQ0QsS0FBSyxZQUFDLE9BQU8sRUFBRSxNQUFrQjtRQUMvQixNQUFNLENBQUMsRUFBQyxJQUFJLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLENBQUMsSUFBSSxFQUFDLENBQUM7SUFDNUMsQ0FBQztJQUNELFNBQVMsWUFBQyxPQUFPLEVBQUUsTUFBZ0M7UUFDakQsSUFBSSxRQUFRLEdBQUcsc0JBQXNCLENBQUMsT0FBTyxFQUFFLEVBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsU0FBUyxFQUFDLENBQUMsQ0FBQztRQUNwRyxFQUFFLENBQUEsQ0FBQyxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDekIsSUFBSSxVQUFVLEdBQUcsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzdCLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1lBQ3BCLEdBQUcsQ0FBQyxDQUFhLFVBQXlDLEVBQXpDLEtBQUEsU0FBRyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxFQUFDLFlBQUEsVUFBVSxFQUFDLENBQUMsRUFBckQsY0FBUSxFQUFSLElBQXFELENBQUM7Z0JBQXRELElBQUksSUFBSSxTQUFBO2dCQUErQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQzthQUFBO1FBQ3pGLENBQUM7UUFDRCxNQUFNLENBQUMsRUFBQyxVQUFBLFFBQVEsRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLElBQUksRUFBQyxDQUFDO0lBQ3ZDLENBQUM7SUFDRCxZQUFZLEVBQUUsVUFBVTtJQUN4QixhQUFhLEVBQUUsVUFBVTtJQUN6QixhQUFhLEVBQUUsVUFBVTtJQUV6QixZQUFZLFlBQUMsT0FBTyxFQUFFLE1BQU07UUFDMUIsSUFBSSxHQUFHLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQzdCLElBQUksU0FBUyxDQUFDO1FBQ2QsRUFBRSxDQUFBLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNqQixNQUFNLENBQUMsTUFBTSxDQUFDLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxJQUFJLE1BQU0sQ0FBQztZQUMxQyxTQUFTLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRSxNQUFNLENBQUMsQ0FBQztZQUMzQyxTQUFTLENBQUMsSUFBSSxHQUFHLFNBQVMsQ0FBQyxJQUFJLElBQUksTUFBTSxDQUFDO1FBQzVDLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLFNBQVMsR0FBRyxFQUFDLElBQUksRUFBRSxNQUFNLEVBQUMsQ0FBQztRQUM3QixDQUFDO1FBQ0QsTUFBTSxDQUFDLEVBQUMsV0FBQSxTQUFTLEVBQUUsS0FBQSxHQUFHLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFDLENBQUM7SUFDckUsQ0FBQztDQUNGLENBQUM7QUFFRixtQkFBbUIsTUFBYyxFQUFFLEdBQVUsRUFBRSxPQUFPLEVBQUUsTUFBUztJQUMvRCx5RUFBeUU7SUFDekUsRUFBRSxDQUFBLENBQUMsR0FBRyxJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDbkIsSUFBSSxjQUFjLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQU8sTUFBTSxDQUFDLENBQUM7UUFDakUsSUFBSSxPQUFPLEdBQUcsY0FBYyxJQUFJLGNBQWMsQ0FBQyxXQUFXLEtBQUssS0FBSyxDQUFDO1FBQ3JFLElBQUksQ0FBQztZQUNILEVBQUUsQ0FBQSxDQUFDLENBQUMsY0FBYyxJQUFJLE9BQU8sSUFBSSxjQUFjLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzdELE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUMsSUFBSSxFQUFLLE1BQU0sWUFBTyxHQUFLLEVBQUMsQ0FBQyxDQUFBO1lBQ2xELENBQUM7WUFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsY0FBYyxDQUFDLFdBQVcsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUMvQyxJQUFJLE9BQU8sR0FBRyxFQUFDLENBQUMsRUFBRSxhQUFhLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBQyxDQUFDO2dCQUMvQyxHQUFHLENBQUEsQ0FBb0IsVUFBYyxFQUFqQywwQkFBZSxFQUFmLElBQWlDLENBQUM7b0JBQWxDLElBQUksV0FBVyxHQUFJLGNBQWMsSUFBbEI7b0JBQ2pCLFdBQVcsQ0FBQyxNQUFNLENBQUMsR0FBRyxXQUFXLENBQUMsTUFBTSxDQUFDLElBQUksTUFBTSxDQUFDO29CQUNwRCxPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztpQkFDL0M7Z0JBQ0QsTUFBTSxDQUFDLE9BQU8sQ0FBQztZQUNqQixDQUFDO1lBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQ04sSUFBSSxXQUFXLEdBQUcsY0FBYyxDQUFDO2dCQUNqQyxXQUFXLENBQUMsTUFBTSxDQUFDLEdBQUcsV0FBVyxDQUFDLE1BQU0sQ0FBQyxJQUFJLE1BQU0sQ0FBQztnQkFDcEQsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUNoQyxDQUFDO1FBQ0gsQ0FBRTtRQUFBLEtBQUssQ0FBQSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7WUFDWixPQUFPLENBQUMsS0FBSyxDQUFDLHNCQUFzQixDQUFDLENBQUM7WUFDdEMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFDLFFBQUEsTUFBTSxFQUFFLEtBQUEsR0FBRyxFQUFFLFNBQUEsT0FBTyxFQUFFLFFBQUEsTUFBTSxFQUFDLENBQUMsQ0FBQztZQUM5QyxPQUFPLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ25CLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUMsSUFBSSxFQUFFLHlCQUFzQixNQUFNLENBQUMsVUFBVSxDQUFDLElBQUksR0FBRyxDQUFFLEVBQUMsQ0FBQyxDQUFBO1FBQzlFLENBQUM7SUFDSCxDQUFDO0FBQ0gsQ0FBQztBQUVELElBQUksWUFBWSxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDO0FBQ3hDLElBQUksVUFBVSxHQUFHLGdCQUFXLEVBQUUsQ0FBQztBQUMvQixNQUFNLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxFQUFFLFVBQVMsR0FBRztJQUM5QyxJQUFJLE1BQU0sR0FBRyxTQUFHLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxFQUFDLElBQUksRUFBRSxJQUFJLENBQUMsTUFBTSxFQUFDLENBQUMsQ0FBQztJQUN6RCxFQUFFLENBQUEsQ0FBQyxNQUFNLElBQUksYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDbEMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsWUFBWSxFQUFFLElBQUksRUFBRSxVQUFVLENBQUMsQ0FBQztRQUN6RCxJQUFJLFFBQU0sR0FBRyxhQUFhLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDakMsY0FBUSxDQUFDLGVBQWUsRUFBRSxFQUFDLE1BQU0sRUFBRSxNQUFNLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxRQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUNyRyxNQUFNLENBQUM7SUFDVCxDQUFDO0lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxLQUFLLElBQUksR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1FBQ3RDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDdEIsTUFBTSxDQUFDO0lBQ1QsQ0FBQztJQUVELFlBQVksR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDO0lBQ3pCLFVBQVUsR0FBRyxnQkFBVyxFQUFFLENBQUM7SUFFM0IsSUFBSSxLQUE2QyxHQUFHLENBQUMsS0FBSyxJQUFJLEVBQUUsa0JBQTNELE1BQU0sbUJBQUcsU0FBUyx5QkFBRSxRQUFRLG1CQUFHLFNBQVMsS0FBbUIsQ0FBQztJQUNqRSxFQUFFLENBQUEsQ0FBQyxNQUFNLEtBQUssU0FBUyxJQUFJLFFBQVEsS0FBSyxTQUFTLENBQUM7UUFBQyxNQUFNLENBQUM7SUFDMUQsY0FBUSxDQUFDLGVBQWUsRUFBRSxFQUFDLFFBQUEsTUFBTSxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBQyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7QUFDaEYsQ0FBQyxDQUFDLENBQUM7QUFFSCxvQ0FBb0M7QUFDcEMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLFNBQVMsRUFBRSxVQUFDLEtBQUs7SUFDdkMsSUFBSSxPQUFPLEdBQWdCLEtBQUssQ0FBQyxNQUFNLENBQUM7SUFDeEMsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLE9BQU8sS0FBSyxZQUFJLENBQUMsU0FBUyxJQUFJLE9BQU8sQ0FBQyxRQUFRLEtBQUssT0FBTyxJQUFJLE9BQU8sQ0FBQyxRQUFRLEtBQUssVUFBVSxJQUFJLE9BQU8sQ0FBQyxlQUFlLEtBQUssTUFBTSxDQUFDLENBQUMsQ0FBQztRQUM3SSxLQUFLLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDekIsQ0FBQztBQUNILENBQUMsQ0FBQyxDQUFBO0FBRUYsMElBQTBJO0FBQzFJLE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxJQUFJLENBQUM7Ozs7QUM5NUR6QixzQkFBeUMsU0FBUyxDQUFDLENBQUE7QUFFbkQsd0JBQTZCLFdBQVcsQ0FBQyxDQUFBO0FBRXpDLGlCQUFpQixLQUFLLEVBQUUsSUFBSTtJQUMxQixJQUFJLElBQUksR0FBRyxFQUFFLENBQUM7SUFDZCxHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsS0FBSyxJQUFJLElBQUksQ0FBQztRQUNwQixJQUFJLENBQUMsQ0FBRyxLQUFLLFVBQUssS0FBSyxDQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDM0MsTUFBTSxDQUFDLElBQUksQ0FBQztBQUNkLENBQUM7QUFDRCxrQkFBa0IsS0FBSyxFQUFFLElBQUk7SUFDM0IsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDO0lBQ2QsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUM7UUFDcEIsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUNwRCxNQUFNLENBQUMsSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQUVELHFCQUFxQixTQUFTLEVBQUUsS0FBSyxFQUFFLElBQUk7SUFDekMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztBQUNwRCxDQUFDO0FBQ0Qsd0JBQXdCLFNBQVMsRUFBRSxLQUFLLEVBQUUsSUFBSTtJQUM1QyxNQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO0FBQ3ZELENBQUM7QUFDRCx1QkFBdUIsSUFBWSxFQUFFLEtBQUssRUFBRSxLQUFLO0lBQy9DLElBQUksT0FBTyxHQUFHLEVBQUUsQ0FBQztJQUNqQixHQUFHLENBQUEsQ0FBYSxVQUF1QyxFQUF2QyxLQUFBLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUMsRUFBbkQsY0FBUSxFQUFSLElBQW1ELENBQUM7UUFBcEQsSUFBSSxJQUFJLFNBQUE7UUFBNkMsT0FBTyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7S0FBQTtJQUM3RixJQUFJLElBQUksR0FBRyxFQUFFLENBQUM7SUFDZCxHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsT0FBSyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUM7UUFBQyxJQUFJLENBQUMsT0FBSyxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFLLENBQUMsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDO0lBQzVFLE1BQU0sQ0FBQyxPQUFPLENBQUM7QUFDakIsQ0FBQztBQUVEO0lBa0NFLFlBQW1CLEVBQUU7UUFBRixPQUFFLEdBQUYsRUFBRSxDQUFBO1FBL0JYLGNBQVMsR0FBUSxFQUFFLENBQUM7UUFDcEIsZ0JBQVcsR0FBTSxFQUFFLENBQUM7UUFDcEIsWUFBTyxHQUFNLEVBQUUsQ0FBQztJQStCMUIsQ0FBQztJQTNCTSxTQUFNLEdBQWIsVUFBYyxRQUFlLEVBQUUsSUFBWTtRQUN6QyxJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDNUIsY0FBYyxDQUFDLFNBQVMsRUFBRSxhQUFhLEVBQUUsRUFBQyxVQUFBLFFBQVEsRUFBQyxDQUFDLENBQUM7UUFDckQsY0FBYyxDQUFDLFNBQVMsRUFBRSxxQkFBcUIsRUFBRSxFQUFDLFVBQUEsUUFBUSxFQUFDLENBQUMsQ0FBQztRQUM3RCxJQUFJLFFBQVEsR0FBRyxhQUFhLENBQUMsSUFBSSxFQUFFLHFCQUFxQixFQUFFLEVBQUMsVUFBQSxRQUFRLEVBQUMsQ0FBQyxDQUFDO1FBQ3RFLEdBQUcsQ0FBQSxDQUFnQixVQUFRLEVBQXZCLG9CQUFXLEVBQVgsSUFBdUIsQ0FBQztZQUF4QixJQUFJLE9BQU8sR0FBSSxRQUFRLElBQVo7WUFBYyxTQUFTLENBQUMsS0FBSyxDQUFDLGVBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO1NBQUE7UUFDbEYsY0FBYyxDQUFDLFNBQVMsRUFBRSxVQUFVLEVBQUUsRUFBQyxVQUFBLFFBQVEsRUFBQyxDQUFDLENBQUM7UUFDbEQsSUFBSSxNQUFNLEdBQUcsYUFBYSxDQUFDLElBQUksRUFBRSxVQUFVLEVBQUUsRUFBQyxVQUFBLFFBQVEsRUFBQyxDQUFDLENBQUM7UUFDekQsR0FBRyxDQUFBLENBQWMsVUFBTSxFQUFuQixrQkFBUyxFQUFULElBQW1CLENBQUM7WUFBcEIsSUFBSSxLQUFLLEdBQUksTUFBTSxJQUFWO1lBQ1gsY0FBYyxDQUFDLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRSxFQUFDLFVBQUEsUUFBUSxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSyxFQUFDLENBQUMsQ0FBQztZQUM1RSxjQUFjLENBQUMsU0FBUyxFQUFFLHdCQUF3QixFQUFFLEVBQUMsVUFBQSxRQUFRLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLLEVBQUMsQ0FBQyxDQUFDO1NBQ3JGO1FBQ0QsY0FBYyxDQUFDLFNBQVMsRUFBRSxjQUFjLEVBQUUsRUFBQyxVQUFBLFFBQVEsRUFBQyxDQUFDLENBQUM7UUFDdEQsY0FBYyxDQUFDLFNBQVMsRUFBRSxzQkFBc0IsRUFBRSxFQUFDLFVBQUEsUUFBUSxFQUFDLENBQUMsQ0FBQztRQUM5RCxjQUFjLENBQUMsU0FBUyxFQUFFLFVBQVUsRUFBRSxFQUFDLFVBQUEsUUFBUSxFQUFDLENBQUMsQ0FBQztRQUNsRCxJQUFJLE1BQU0sR0FBRyxhQUFhLENBQUMsSUFBSSxFQUFFLFVBQVUsRUFBRSxFQUFDLFVBQUEsUUFBUSxFQUFDLENBQUMsQ0FBQztRQUN6RCxHQUFHLENBQUEsQ0FBYyxVQUFNLEVBQW5CLGtCQUFTLEVBQVQsSUFBbUIsQ0FBQztZQUFwQixJQUFJLE9BQUssR0FBSSxNQUFNLElBQVY7WUFDWCxjQUFjLENBQUMsU0FBUyxFQUFFLGdCQUFnQixFQUFFLEVBQUMsVUFBQSxRQUFRLEVBQUUsS0FBSyxFQUFFLE9BQUssQ0FBQyxLQUFLLEVBQUMsQ0FBQyxDQUFDO1lBQzVFLGNBQWMsQ0FBQyxTQUFTLEVBQUUsd0JBQXdCLEVBQUUsRUFBQyxVQUFBLFFBQVEsRUFBRSxLQUFLLEVBQUUsT0FBSyxDQUFDLEtBQUssRUFBQyxDQUFDLENBQUM7U0FDckY7UUFFRCxHQUFHLENBQUEsQ0FBYyxVQUFzRCxFQUF0RCxLQUFBLGFBQWEsQ0FBQyxJQUFJLEVBQUUsYUFBYSxFQUFFLEVBQUMsTUFBTSxFQUFFLFFBQVEsRUFBQyxDQUFDLEVBQW5FLGNBQVMsRUFBVCxJQUFtRSxDQUFDO1lBQXBFLElBQUksS0FBSyxTQUFBO1lBQTRELFNBQVMsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7U0FBQTtRQUMxSCxNQUFNLENBQUMsU0FBUyxDQUFDO0lBQ25CLENBQUM7SUFLRCxpQkFBSSxHQUFKO1FBQ0UsSUFBSSxJQUFJLEdBQUcsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQzNCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQztRQUM5QixJQUFJLENBQUMsU0FBUyxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUM7UUFDaEMsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQ2hDLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztRQUNwQyxJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUM7UUFDNUIsSUFBSSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDO1FBQzVCLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQ0Qsc0JBQVMsR0FBVCxVQUFVLElBQVk7UUFDcEIsSUFBSSxTQUFTLEdBQUcsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBRTVCLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ25GLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDaEMsRUFBRSxDQUFBLENBQUMsRUFBRSxLQUFLLFNBQVMsQ0FBQztZQUFDLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7UUFDakYsRUFBRSxDQUFBLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQyxJQUFJLEVBQUUsS0FBSyxTQUFTLENBQUM7WUFBQyxFQUFFLEdBQUcsRUFBRSxDQUFDO1FBQzFDLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7WUFBQyxNQUFNLEdBQUcsRUFBRSxDQUFDO1FBRS9CLFdBQVcsQ0FBQyxTQUFTLEVBQUUsYUFBYSxFQUFFLEVBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsUUFBQSxNQUFNLEVBQUUsSUFBQSxFQUFFLEVBQUMsQ0FBQyxDQUFDO1FBQ3ZFLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDO1lBQ2pCLEVBQUUsQ0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEtBQUssU0FBUyxDQUFDO2dCQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxHQUFHLGdCQUFjLElBQUksQ0FBQyxFQUFJLENBQUM7WUFDekcsU0FBUyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQy9DLFdBQVcsQ0FBQyxTQUFTLEVBQUUscUJBQXFCLEVBQUUsRUFBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUMsQ0FBQyxDQUFDO1FBQ2xHLENBQUM7UUFDRCxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztZQUNsQixJQUFJLEtBQUssR0FBRyxZQUFJLEVBQUUsQ0FBQztZQUNuQixXQUFXLENBQUMsU0FBUyxFQUFFLFVBQVUsRUFBRSxFQUFDLE9BQUEsS0FBSyxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxPQUFPLElBQVMsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLElBQUEsRUFBRSxFQUFDLENBQUMsQ0FBQztZQUN6RyxHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO2dCQUM5QixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNsQyxFQUFFLENBQUEsQ0FBQyxLQUFLLFlBQVksS0FBSyxDQUFDO29CQUFDLFdBQVcsQ0FBQyxTQUFTLEVBQUUsd0JBQXdCLEVBQUUsRUFBQyxPQUFBLEtBQUssRUFBRSxLQUFBLEdBQUcsRUFBRSxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDO2dCQUM3SCxJQUFJO29CQUFDLFdBQVcsQ0FBQyxTQUFTLEVBQUUsZ0JBQWdCLEVBQUUsRUFBQyxPQUFBLEtBQUssRUFBRSxLQUFBLEdBQUcsRUFBRSxPQUFBLEtBQUssRUFBQyxDQUFDLENBQUM7WUFDckUsQ0FBQztRQUNILENBQUM7UUFFRCxHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsUUFBUSxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ3JDLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDdkMsRUFBRSxDQUFBLENBQUMsS0FBSyxZQUFZLEtBQUssQ0FBQztnQkFBQyxXQUFXLENBQUMsU0FBUyxFQUFFLHNCQUFzQixFQUFFLEVBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsVUFBQSxRQUFRLEVBQUUsTUFBTSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQztZQUM1SSxJQUFJO2dCQUFDLFdBQVcsQ0FBQyxTQUFTLEVBQUUsY0FBYyxFQUFFLEVBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsVUFBQSxRQUFRLEVBQUUsT0FBQSxLQUFLLEVBQUMsQ0FBQyxDQUFDO1FBQ3BGLENBQUM7UUFFRCxHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsT0FBSyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQzlCLFdBQVcsQ0FBQyxTQUFTLEVBQUUsVUFBVSxFQUFFLEVBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsT0FBQSxPQUFLLEVBQUMsQ0FBQyxDQUFDO1lBQy9ELElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBSyxDQUFDLENBQUM7WUFDaEMsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDO2dCQUNyQixJQUFJLEtBQUssR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ3ZCLEVBQUUsQ0FBQSxDQUFDLEtBQUssWUFBWSxLQUFLLENBQUM7b0JBQ3hCLFdBQVcsQ0FBQyxTQUFTLEVBQUUsd0JBQXdCLEVBQUUsRUFBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxPQUFBLE9BQUssRUFBRSxLQUFBLEdBQUcsRUFBRSxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUMsQ0FBQyxDQUFDO2dCQUN2SCxJQUFJO29CQUFDLFdBQVcsQ0FBQyxTQUFTLEVBQUUsZ0JBQWdCLEVBQUUsRUFBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxPQUFBLE9BQUssRUFBRSxLQUFBLEdBQUcsRUFBRSxPQUFBLEtBQUssRUFBQyxDQUFDLENBQUM7WUFDeEYsQ0FBQztRQUNILENBQUM7UUFFRCxHQUFHLENBQUEsQ0FBYyxVQUFjLEVBQWQsS0FBQSxJQUFJLENBQUMsU0FBUyxFQUEzQixjQUFTLEVBQVQsSUFBMkIsQ0FBQztZQUE1QixJQUFJLEtBQUssU0FBQTtZQUFvQixTQUFTLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztTQUFBO1FBRXhFLE1BQU0sQ0FBQyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUNELGlCQUFJLEdBQUosVUFBSyxRQUFlLEVBQUUsSUFBWSxFQUFFLE1BQVU7UUFDNUMsSUFBSSxJQUFJLEdBQUcsYUFBYSxDQUFDLElBQUksRUFBRSxhQUFhLEVBQUUsRUFBQyxVQUFBLFFBQVEsRUFBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDN0QsRUFBRSxDQUFBLENBQUMsQ0FBQyxJQUFJLENBQUM7WUFBQyxNQUFNLENBQUMsSUFBSSxDQUFDO1FBQ3RCLEVBQUUsQ0FBQSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDO1lBQUMsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLElBQUksSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3hFLElBQUksT0FBTyxHQUFHLGFBQWEsQ0FBQyxJQUFJLEVBQUUscUJBQXFCLEVBQUUsRUFBQyxVQUFBLFFBQVEsRUFBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDeEUsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDO1lBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksZUFBSyxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzFELElBQUksS0FBSyxHQUFHLGFBQWEsQ0FBQyxJQUFJLEVBQUUsVUFBVSxFQUFFLEVBQUMsVUFBQSxRQUFRLEVBQUUsTUFBTSxFQUFFLElBQUksQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLEdBQUcsRUFBRSxFQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN4RyxFQUFFLENBQUEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ1QsSUFBSSxLQUFLLEdBQUcsRUFBRSxDQUFDO1lBQ2YsR0FBRyxDQUFBLENBQWEsVUFBMkQsRUFBM0QsS0FBQSxhQUFhLENBQUMsSUFBSSxFQUFFLGdCQUFnQixFQUFFLEVBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLLEVBQUMsQ0FBQyxFQUF2RSxjQUFRLEVBQVIsSUFBdUUsQ0FBQztnQkFBeEUsSUFBSSxJQUFJLFNBQUE7Z0JBQWlFLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQzthQUFBO1lBQzFHLEdBQUcsQ0FBQSxDQUFhLFVBQW1FLEVBQW5FLEtBQUEsYUFBYSxDQUFDLElBQUksRUFBRSx3QkFBd0IsRUFBRSxFQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSyxFQUFDLENBQUMsRUFBL0UsY0FBUSxFQUFSLElBQStFLENBQUM7Z0JBQWhGLElBQUksSUFBSSxTQUFBO2dCQUF5RSxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7YUFBQTtZQUNqSSxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3BCLENBQUM7UUFFRCxHQUFHLENBQUEsQ0FBYSxVQUErQyxFQUEvQyxLQUFBLGFBQWEsQ0FBQyxJQUFJLEVBQUUsY0FBYyxFQUFFLEVBQUMsVUFBQSxRQUFRLEVBQUMsQ0FBQyxFQUEzRCxjQUFRLEVBQVIsSUFBMkQsQ0FBQztZQUE1RCxJQUFJLElBQUksU0FBQTtZQUFxRCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQUE7UUFDM0csR0FBRyxDQUFBLENBQWEsVUFBdUQsRUFBdkQsS0FBQSxhQUFhLENBQUMsSUFBSSxFQUFFLHNCQUFzQixFQUFFLEVBQUMsVUFBQSxRQUFRLEVBQUMsQ0FBQyxFQUFuRSxjQUFRLEVBQVIsSUFBbUUsQ0FBQztZQUFwRSxJQUFJLElBQUksU0FBQTtZQUE2RCxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1NBQUE7UUFFbEksR0FBRyxDQUFBLENBQWMsVUFBMkMsRUFBM0MsS0FBQSxhQUFhLENBQUMsSUFBSSxFQUFFLFVBQVUsRUFBRSxFQUFDLFVBQUEsUUFBUSxFQUFDLENBQUMsRUFBeEQsY0FBUyxFQUFULElBQXdELENBQUM7WUFBekQsSUFBSSxPQUFLLFNBQUE7WUFDWCxJQUFJLEtBQUssR0FBRyxFQUFFLENBQUM7WUFDZixHQUFHLENBQUEsQ0FBYSxVQUFxRSxFQUFyRSxLQUFBLGFBQWEsQ0FBQyxJQUFJLEVBQUUsZ0JBQWdCLEVBQUUsRUFBQyxVQUFBLFFBQVEsRUFBRSxLQUFLLEVBQUUsT0FBSyxDQUFDLEtBQUssRUFBQyxDQUFDLEVBQWpGLGNBQVEsRUFBUixJQUFpRixDQUFDO2dCQUFsRixJQUFJLElBQUksU0FBQTtnQkFBMkUsS0FBSyxDQUFDLE9BQUssQ0FBQyxHQUFHLENBQUMsR0FBRyxPQUFLLENBQUMsS0FBSyxDQUFDO2FBQUE7WUFDdEgsR0FBRyxDQUFBLENBQWEsVUFBNkUsRUFBN0UsS0FBQSxhQUFhLENBQUMsSUFBSSxFQUFFLHdCQUF3QixFQUFFLEVBQUMsVUFBQSxRQUFRLEVBQUUsS0FBSyxFQUFFLE9BQUssQ0FBQyxLQUFLLEVBQUMsQ0FBQyxFQUF6RixjQUFRLEVBQVIsSUFBeUYsQ0FBQztnQkFBMUYsSUFBSSxJQUFJLFNBQUE7Z0JBQW1GLEtBQUssQ0FBQyxPQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxPQUFLLENBQUMsTUFBTSxFQUFFLE9BQUssQ0FBQyxLQUFLLENBQUMsQ0FBQTthQUFBO1lBQzdJLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBSyxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsQ0FBQztTQUNoQztRQUVELEdBQUcsQ0FBQSxDQUFjLFVBQXNELEVBQXRELEtBQUEsYUFBYSxDQUFDLElBQUksRUFBRSxhQUFhLEVBQUUsRUFBQyxNQUFNLEVBQUUsUUFBUSxFQUFDLENBQUMsRUFBbkUsY0FBUyxFQUFULElBQW1FLENBQUM7WUFBcEUsSUFBSSxLQUFLLFNBQUE7WUFDWCxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7U0FBQTtRQUV4RSxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELHFCQUFRLEdBQVIsVUFBUyxJQUFVLEVBQUUsTUFBYztRQUFkLHNCQUFjLEdBQWQsY0FBYztRQUNqQyxFQUFFLENBQUEsQ0FBQyxDQUFDLElBQUksQ0FBQztZQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQ2hDLEVBQUUsQ0FBQSxDQUFDLENBQUMsTUFBTSxDQUFDO1lBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1FBQ3RDLEdBQUcsQ0FBQSxDQUFjLFVBQUksRUFBakIsZ0JBQVMsRUFBVCxJQUFpQixDQUFDO1lBQWxCLElBQUksS0FBSyxHQUFJLElBQUksSUFBUjtZQUNYLElBQUksTUFBTSxHQUFHLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUMxQixNQUFNLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztZQUN0QixJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztTQUM3QjtRQUNELE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO0lBQ3hCLENBQUM7SUFDRCxrQkFBSyxHQUFMLFVBQU0sS0FBUSxFQUFFLEVBQVcsRUFBRSxLQUFTO1FBQ3BDLEtBQUssR0FBRyxLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDckIsS0FBSyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDckIsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDO1lBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM3QixFQUFFLENBQUEsQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ25DLElBQUk7WUFBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3pDLE1BQU0sQ0FBQyxLQUFLLENBQUM7SUFDZixDQUFDO0lBQ0Qsd0JBQVcsR0FBWCxVQUFZLEVBQVU7UUFDcEIsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBRUQsdUJBQVUsR0FBVixVQUFXLFVBQWUsRUFBRSxLQUFhO1FBQWIscUJBQWEsR0FBYixhQUFhO1FBQ3ZDLEVBQUUsQ0FBQSxDQUFDLENBQUMsVUFBVSxDQUFDO1lBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7UUFDeEMsRUFBRSxDQUFBLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ1YsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsV0FBVyxDQUFDO2dCQUFDLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNsRSxDQUFDO1FBQ0QsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxVQUFVLENBQUM7WUFBQyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN0RSxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUNELHNCQUFTLEdBQVQsVUFBVSxRQUFnQixFQUFFLEtBQVc7UUFDckMsRUFBRSxDQUFBLENBQUMsS0FBSyxLQUFLLFNBQVMsQ0FBQztZQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzFELElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLEdBQUcsS0FBSyxDQUFDO1FBQ25DLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQ0QsNEJBQWUsR0FBZixVQUFnQixRQUFnQjtRQUM5QixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbEMsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxtQkFBTSxHQUFOLFVBQU8sTUFBVyxFQUFFLEtBQWE7UUFBYixxQkFBYSxHQUFiLGFBQWE7UUFDL0IsRUFBRSxDQUFBLENBQUMsQ0FBQyxNQUFNLENBQUM7WUFBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQztRQUNoQyxFQUFFLENBQUEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDVixHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsT0FBSyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUM7Z0JBQUMsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQUssQ0FBQyxDQUFDO1FBQzVELENBQUM7UUFDRCxHQUFHLENBQUEsQ0FBQyxHQUFHLENBQUMsT0FBSyxJQUFJLE1BQU0sQ0FBQztZQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBSyxDQUFDLEdBQUcsTUFBTSxDQUFDLE9BQUssQ0FBQyxDQUFDO1FBQzdELE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQ0Qsa0JBQUssR0FBTCxVQUFNLEtBQWEsRUFBRSxLQUFXO1FBQzlCLEVBQUUsQ0FBQSxDQUFDLEtBQUssS0FBSyxTQUFTLENBQUM7WUFBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNuRCxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxHQUFHLEtBQUssQ0FBQztRQUNoQyxNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUNELHdCQUFXLEdBQVgsVUFBWSxLQUFhO1FBQ3ZCLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMzQixNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELGtCQUFLLEdBQUwsVUFBTSxLQUFxQjtRQUFyQixxQkFBcUIsR0FBckIsVUFBcUI7UUFDekIsRUFBRSxDQUFBLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ1YsSUFBSSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7WUFDM0IsTUFBTSxDQUFDLElBQUksQ0FBQztRQUNkLENBQUM7UUFDRCxFQUFFLENBQUEsQ0FBQyxLQUFLLEtBQUssSUFBSSxDQUFDO1lBQUMsS0FBSyxHQUFHLEVBQUUsQ0FBQztRQUM5QixJQUFJLENBQUMsU0FBUyxHQUFHLEtBQUssQ0FBQztRQUN2QixNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELGlCQUFJLEdBQUosVUFBSyxPQUFhO1FBQ2hCLElBQUksQ0FBQyxRQUFRLEdBQUcsT0FBTyxDQUFDO1FBQ3hCLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBQ0gsU0FBQztBQUFELENBbk1BLEFBbU1DLElBQUE7QUFuTVksVUFBRSxLQW1NZCxDQUFBO0FBT0QsZ0NBQWdDO0FBQ2hDLDJDQUEyQztBQUMzQztJQUtFLG9CQUFtQixJQUFZO1FBQVosU0FBSSxHQUFKLElBQUksQ0FBUTtRQUp4QixhQUFRLEdBQUcsQ0FBQyxDQUFDO1FBQ1Ysa0JBQWEsR0FBMkMsRUFBRSxDQUFDO1FBQzNELGNBQVMsR0FBb0IsRUFBRSxDQUFDO0lBRVIsQ0FBQztJQUVuQyw0QkFBTyxHQUFQLFVBQVEsS0FBd0I7UUFDOUIsRUFBRSxDQUFBLENBQUMsYUFBSyxDQUFDLFFBQVEsQ0FBQztZQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDL0MsSUFBSSxhQUFhLEdBQWEsRUFBRSxDQUFDO1FBQ2pDLEdBQUcsQ0FBQSxDQUFhLFVBQUssRUFBakIsaUJBQVEsRUFBUixJQUFpQixDQUFDO1lBQWxCLElBQUksSUFBSSxHQUFJLEtBQUssSUFBVDtZQUNWLDJDQUEyQztZQUMzQyxFQUFFLENBQUEsQ0FBQyxPQUFPLElBQUksS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDO2dCQUM1QixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksRUFBRSxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQzdELGFBQWEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsRUFBRSxLQUFLLENBQUMsQ0FBQztnQkFDL0MsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLEVBQUMsdUJBQXVCLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztnQkFDN0UsRUFBRSxDQUFBLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQUMsUUFBUSxDQUFDO2dCQUNuQixJQUFJLFFBQU0sR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQztnQkFDekMsRUFBRSxDQUFBLENBQUMsUUFBTSxDQUFDLENBQUMsQ0FBQztvQkFDVixHQUFHLENBQUEsQ0FBYSxVQUFLLEVBQWpCLGlCQUFRLEVBQVIsSUFBaUIsQ0FBQzt3QkFBbEIsSUFBSSxJQUFJLEdBQUksS0FBSyxJQUFUO3dCQUFXLElBQUksQ0FBQyxNQUFNLEdBQUcsUUFBTSxDQUFDO3FCQUFBO2dCQUM5QyxDQUFDO1lBQ0gsQ0FBQztZQUNELElBQUksQ0FBQyxDQUFDO2dCQUNKLEVBQUUsQ0FBQSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztvQkFBQyxJQUFJLENBQUMsRUFBRSxHQUFHLGFBQWEsQ0FBQyxNQUFNLENBQUM7Z0JBQzVDLGFBQWEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDM0IsQ0FBQztTQUNGO1FBQ0QsRUFBRSxDQUFBLENBQUMsYUFBSyxDQUFDLFFBQVEsQ0FBQztZQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUN0QyxNQUFNLENBQUMsYUFBYSxDQUFDO0lBQ3ZCLENBQUM7SUFFUyxvQ0FBZSxHQUF6QixVQUEwQixRQUFlLEVBQUUsTUFBYyxFQUFFLFdBQW1CLEVBQUUsWUFBdUIsRUFBRSxLQUFnQjtRQUE5RCwyQkFBbUIsR0FBbkIsZ0JBQW1CO1FBQUUsNEJBQXVCLEdBQXZCLGlCQUF1QjtRQUFFLHFCQUFnQixHQUFoQixTQUFnQjtRQUN2SCxJQUFJLEtBQUssR0FBRyxFQUFFLENBQUM7UUFDZixJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxxQkFBcUIsRUFBRSxFQUFDLCtCQUErQixFQUFFLFFBQVEsRUFBQyxDQUFDLENBQUM7UUFDcEcsRUFBRSxDQUFBLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1lBQ1osSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLEVBQUUsWUFBWSxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQy9ELEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQztnQkFBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDO1FBQzNCLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLElBQUksVUFBVSxHQUFHLE9BQU8sQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO1lBQ3pELElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsVUFBVSxFQUFFLFdBQVcsQ0FBQyxDQUFDO1lBQ3hELElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztZQUNYLEdBQUcsQ0FBQSxDQUFhLFVBQUssRUFBakIsaUJBQVEsRUFBUixJQUFpQixDQUFDO2dCQUFsQixJQUFJLElBQUksR0FBSSxLQUFLLElBQVQ7Z0JBQ1YsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDeEIsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxRQUFRLEVBQUUsWUFBWSxFQUFFLEtBQUssQ0FBQyxDQUFDO2dCQUMvRCxZQUFZLENBQUMsR0FBRyxFQUFFLENBQUM7Z0JBQ25CLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQztvQkFBQyxLQUFLLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQzNCO1FBQ0gsQ0FBQztRQUNELEtBQUssQ0FBQyxJQUFJLENBQUMsVUFBQyxDQUFDLEVBQUUsQ0FBQyxJQUFLLE9BQUEsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFYLENBQVcsQ0FBQyxDQUFDO1FBQ2xDLElBQUksTUFBTSxHQUFHLFNBQVMsQ0FBQztRQUN2QixHQUFHLENBQUEsQ0FBYSxVQUFLLEVBQWpCLGlCQUFRLEVBQVIsSUFBaUIsQ0FBQztZQUFsQixJQUFJLElBQUksR0FBSSxLQUFLLElBQVQ7WUFDVixJQUFJLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsR0FBRyxNQUFNLEdBQUcsTUFBTSxDQUFDO1lBQzlDLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssTUFBTSxDQUFDO2dCQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUNqQyxNQUFNLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQztTQUNsQjtRQUNELE1BQU0sQ0FBQyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRVMsb0NBQWUsR0FBekIsVUFBMEIsUUFBZSxFQUFFLFlBQWtCLEVBQUUsS0FBWTtRQUN6RSxFQUFFLENBQUEsQ0FBQyxhQUFLLENBQUMsUUFBUSxDQUFDO1lBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFNLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxHQUFHLFdBQVcsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUM1RSxJQUFJLGlCQUFpQixHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsRUFBRSxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQztRQUNoRixJQUFJLGVBQWUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUM7UUFDeEUsSUFBSSxZQUFZLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDLENBQUM7UUFDaEYsSUFBSSxtQkFBbUIsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyx3QkFBd0IsRUFBRSxDQUFDLCtCQUErQixDQUFDLENBQUMsQ0FBQztRQUN2RyxJQUFJLGNBQWMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDLENBQUM7UUFDakYsSUFBSSxxQkFBcUIsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxzQkFBc0IsRUFBRSxDQUFDLGdDQUFnQyxDQUFDLENBQUMsQ0FBQztRQUN4RyxJQUFJLGVBQWUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLEVBQUUsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDLENBQUM7UUFDMUUsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2hCLElBQUksSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxFQUFDLHVCQUF1QixFQUFFLFFBQVEsRUFBQyxDQUFDLENBQUM7UUFDakYsRUFBRSxDQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ1QsT0FBTyxDQUFDLElBQUksQ0FBQyxpQkFBZSxRQUFRLCtCQUE0QixDQUFDLENBQUM7WUFDbEUsTUFBTSxDQUFDLFNBQVMsQ0FBQztRQUNuQixDQUFDO1FBRUQsSUFBSSxLQUFLLEdBQUcsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3JDLElBQUksVUFBVSxHQUFHLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ2pELElBQUksTUFBTSxHQUFHLGVBQWUsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUV2Qyx5QkFBeUI7UUFDekIsSUFBSSxJQUFJLEdBQVcsRUFBQyxTQUFTLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRSxJQUFJLENBQUMsaUJBQWlCLENBQUMsRUFBQyxDQUFDO1FBRXRFLDJCQUEyQjtRQUMzQixFQUFFLENBQUEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ1QsR0FBRyxDQUFBLENBQXFFLFVBQUssRUFBekUsaUJBQWdFLEVBQWhFLElBQXlFLENBQUM7Z0JBQTFFLFNBQW9FLEtBQUssTUFBMUMsSUFBSSxpQ0FBeUIsR0FBRyw0QkFBQztnQkFBVyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxDQUFDO2FBQUE7UUFDbEcsQ0FBQztRQUVELDBCQUEwQjtRQUMxQixFQUFFLENBQUEsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQ2QsK0JBQStCO1lBQy9CLEdBQUcsQ0FBQSxDQUErSCxVQUFVLEVBQXhJLHNCQUEwSCxFQUExSCxJQUF3SSxDQUFDO2dCQUF6SSxTQUE4SCxVQUFVLE1BQWpHLElBQUkseUNBQWtDLE1BQU0sdUNBQWlDLEtBQUssb0NBQUM7Z0JBQzVILElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsWUFBWSxDQUFDLENBQUM7YUFBQTtRQUNqRSxDQUFDO1FBRUQsd0JBQXdCO1FBQ3hCLEVBQUUsQ0FBQSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7WUFDVixHQUFHLENBQUEsQ0FBbUMsVUFBTSxFQUF4QyxrQkFBOEIsRUFBOUIsSUFBd0MsQ0FBQztnQkFBekMsSUFBd0IsT0FBSyxHQUFLLE1BQU0sdUJBQVY7Z0JBQVksSUFBSSxDQUFDLE9BQUssQ0FBQyxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLEVBQUUsT0FBSyxFQUFFLFlBQVksQ0FBQyxDQUFDO2FBQUE7UUFDbkgsQ0FBQztRQUVELG1CQUFtQjtRQUNuQixJQUFJLFFBQVEsR0FBRyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDakQsSUFBSSxNQUFNLEdBQUcsZUFBZSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUM3QyxFQUFFLENBQUEsQ0FBQyxRQUFRLENBQUMsTUFBTSxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ3BDLElBQUksQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFDO1lBQ25CLElBQUksT0FBTyxHQUFHLENBQUMsRUFBRSxPQUFPLEdBQUcsQ0FBQyxDQUFDO1lBQzdCLE9BQU0sT0FBTyxHQUFHLFFBQVEsQ0FBQyxNQUFNLElBQUksT0FBTyxHQUFHLE1BQU0sQ0FBQyxNQUFNLEVBQUUsQ0FBQztnQkFDM0QsSUFBSSxLQUFLLEdBQUcsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUM5QixJQUFJLEtBQUssR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JBQzVCLElBQUksR0FBRyxTQUFBLEVBQUUsV0FBVyxHQUFHLEVBQUUsRUFBRSxpQkFBaUIsR0FBRyxZQUFZLENBQUM7Z0JBQzVELEVBQUUsQ0FBQSxDQUFDLENBQUMsS0FBSyxJQUFJLEtBQUssSUFBSSxLQUFLLENBQUMsRUFBRSxJQUFJLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO29CQUMzQyxHQUFHLEdBQUcsUUFBUSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsdUJBQXVCLENBQUMsQ0FBQztvQkFDbkQseUNBQXlDO29CQUN6QyxXQUFXLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsQ0FBQztnQkFFakQsQ0FBQztnQkFBQyxJQUFJLENBQUMsQ0FBQztvQkFDTixHQUFHLEdBQUcsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsb0JBQW9CLENBQUMsQ0FBQztvQkFDOUMsR0FBRyxDQUFBLENBQWMsVUFBNEMsRUFBNUMsS0FBQSxZQUFZLENBQUMsS0FBSyxDQUFDLGlCQUFpQixDQUFDLENBQUMsSUFBSSxFQUFFLEVBQXpELGNBQVMsRUFBVCxJQUF5RCxDQUFDO3dCQUExRCxJQUFJLEtBQUssU0FBQTt3QkFDWCxXQUFXLENBQUMsS0FBSyxDQUFDLHFCQUFxQixDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsdUJBQXVCLENBQUMsQ0FBQztxQkFBQTtvQkFFN0UsR0FBRyxDQUFBLENBQWMsVUFBbUQsRUFBbkQsS0FBQSxtQkFBbUIsQ0FBQyxLQUFLLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBaEUsY0FBUyxFQUFULElBQWdFLENBQUM7d0JBQWpFLElBQUksS0FBSyxTQUFBO3dCQUNYLGdDQUFnQzt3QkFDaEMsSUFBb0MsR0FBRyxHQUFzRixLQUFLLGlDQUF2RCxNQUFNLEdBQTRDLEtBQUssb0NBQWQsS0FBSyxHQUFJLEtBQUssaUNBQUEsQ0FBQzt3QkFDbkksV0FBVyxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFLEtBQUssRUFBRSxZQUFZLENBQUMsQ0FBQztxQkFDcEU7b0JBQ0QsaUJBQWlCLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQztnQkFDcEMsQ0FBQztnQkFDRCxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsZUFBZSxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxXQUFXLEVBQUUsaUJBQWlCLEVBQUUsS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEksQ0FBQztRQUNILENBQUM7UUFFRCxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDOUIsSUFBSSxDQUFDO2dCQUNILElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ25DLENBQUU7WUFBQSxLQUFLLENBQUEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUNaLE9BQU8sQ0FBQyxJQUFJLENBQUMsa0NBQWdDLFFBQVEsa0JBQWEsR0FBRyx1QkFBa0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBRyxDQUFDLENBQUM7Z0JBQ2hILElBQUksQ0FBQyxDQUFDLEdBQUcsVUFBVSxDQUFDO1lBQ3RCLENBQUM7UUFDSCxDQUFDO1FBRUQsTUFBTSxDQUFDLElBQUksQ0FBQztJQUNkLENBQUM7SUFFUyxrQ0FBYSxHQUF2QixVQUF3QixLQUFLLEVBQUUsV0FBVztRQUN4QyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBQzVDLENBQUM7SUFDUyxrQ0FBYSxHQUF2QixVQUF3QixZQUFrQjtRQUN4QyxJQUFJLEtBQUssR0FBRyxFQUFFLENBQUM7UUFDZixHQUFHLENBQUEsQ0FBYSxVQUFZLEVBQXhCLHdCQUFRLEVBQVIsSUFBd0IsQ0FBQztZQUF6QixJQUFJLElBQUksR0FBSSxZQUFZLElBQWhCO1lBQ1YsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLEtBQUssSUFBSSxJQUFJLENBQUM7Z0JBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUNuRDtRQUNELE1BQU0sQ0FBQyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRUQsK0JBQStCO0lBQ3JCLGtDQUFhLEdBQXZCLFVBQXdCLE1BQWEsRUFBRSxLQUFZLEVBQUUsWUFBa0I7UUFDckUsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxZQUFZLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLENBQUM7WUFDcEQsSUFBSSxJQUFJLEdBQUcsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQzVCLEVBQUUsQ0FBQSxDQUFDLE1BQU0sSUFBSSxJQUFJLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdkQsQ0FBQztJQUNILENBQUM7SUFDUyx5Q0FBb0IsR0FBOUIsVUFBK0IsSUFBWSxFQUFFLEtBQVksRUFBRSxZQUFrQjtRQUMzRSxJQUFJLFFBQVEsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDakMsSUFBSSxPQUFPLEdBQU0sUUFBUSxVQUFLLEtBQU8sQ0FBQztRQUN0QyxJQUFJLE9BQU8sR0FBTSxLQUFLLFlBQVMsQ0FBQztRQUNoQyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLEVBQUUsS0FBSyxFQUFFLFlBQVksQ0FBQyxDQUFDO1FBQ2xFLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUM7WUFBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUUzRCxJQUFJLElBQUksR0FBRyxJQUFJLENBQUM7UUFDaEIsRUFBRSxDQUFBLENBQUMsS0FBSyxLQUFLLFFBQVEsSUFBSSxLQUFLLEtBQUssT0FBTyxDQUFDLENBQUMsQ0FBQztZQUMzQyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxHQUFHLFVBQUMsR0FBUyxFQUFFLElBQVk7Z0JBQ2hELElBQUksS0FBSyxHQUFPLEVBQUUsQ0FBQztnQkFDbkIsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxRQUFRLElBQUksSUFBSSxDQUFDLENBQUMsS0FBSyxPQUFPLElBQUksSUFBSSxDQUFDLENBQUMsS0FBSyxVQUFVLENBQUM7b0JBQUMsS0FBSyxDQUFDLEtBQUssR0FBd0MsR0FBRyxDQUFDLE1BQU8sQ0FBQyxLQUFLLENBQUM7Z0JBQzVJLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssVUFBVSxDQUFDO29CQUFDLEtBQUssQ0FBQyxLQUFLLEdBQXNCLEdBQUcsQ0FBQyxNQUFPLENBQUMsT0FBTyxDQUFDO2dCQUNsRixJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztZQUN0RCxDQUFDLENBQUM7UUFDSixDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxHQUFHLFVBQUMsR0FBUyxFQUFFLElBQVk7Z0JBQ2hELElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBQ25ELENBQUMsQ0FBQTtRQUNILENBQUM7UUFFRCxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBQ1MsZ0NBQVcsR0FBckIsVUFBc0IsUUFBZSxFQUFFLFNBQWdCLEVBQUUsS0FBVyxFQUFFLElBQVksRUFBRSxVQUFhO1FBQy9GLElBQUksT0FBTyxHQUFNLFNBQVMsWUFBUyxDQUFDO1FBQ3BDLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUMxQixJQUFJLE9BQU8sR0FBRyxPQUFTLFlBQ2pCLEVBQVMsc0VBRWtCLEVBQU8sNENBQ0gsRUFBUSxvQ0FDaEIsRUFBUywyQkFHckMscU5BUmEsYUFBSyxDQUFDLENBQUMsQ0FBQyxLQUNoQixTQUFTLEVBRWtCLElBQUksQ0FBQyxFQUFFLEVBQ0gsUUFBUSxFQUNoQixTQUFTLEVBR3JDLENBQUM7UUFDRixFQUFFLENBQUEsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BCLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO2dCQUMvQixPQUFPLElBQU8sSUFBSSxXQUFNLElBQUksVUFBSyxVQUFVLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLFFBQUssQ0FBQztRQUM3RSxDQUFDO1FBQ0QsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ3RCLEVBQUUsQ0FBQSxDQUFDLElBQUksS0FBSyxTQUFTLENBQUM7Z0JBQUMsUUFBUSxDQUFDO1lBQ2hDLE9BQU8sSUFBTyxJQUFJLFdBQU0sSUFBSSxVQUFLLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBSyxDQUFBO1FBQ25ELENBQUM7UUFFRCxJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2pDLElBQUksR0FBRyxHQUFHLFlBQUksRUFBRSxDQUFDO1FBQ2pCLElBQUksTUFBTSxHQUFNLFNBQVMsZUFBVSxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFHLENBQUM7UUFDcEQsU0FBUyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxFQUFDLFFBQUEsTUFBTSxFQUFFLFNBQUEsT0FBTyxFQUFDLENBQUMsQ0FBQztRQUNuRCxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMvQixPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDOztJQUN0QixDQUFDO0lBRVMsa0NBQWEsR0FBdkIsVUFBd0IsUUFBZSxFQUFFLEtBQVksRUFBRSxZQUFrQjtRQUN2RSxJQUFJLEtBQUssR0FBRyxFQUFFLENBQUM7UUFDZixJQUFJLFdBQVcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxFQUFDLDBCQUEwQixFQUFFLFFBQVEsRUFBRSx1QkFBdUIsRUFBRSxLQUFLLEVBQUMsQ0FBQyxDQUFDO1FBQzNILEdBQUcsQ0FBQSxDQUFtRSxVQUFXLEVBQTdFLHVCQUE4RCxFQUE5RCxJQUE2RSxDQUFDO1lBQTlFLFNBQWtFLFdBQVcsTUFBakQsR0FBRyw4QkFBMkIsR0FBRyw4QkFBQztZQUFpQixLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDO1NBQUE7UUFFcEcsSUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsd0JBQXdCLEVBQUUsRUFBQyxrQ0FBa0MsRUFBRSxRQUFRLEVBQUUsK0JBQStCLEVBQUUsS0FBSyxFQUFDLENBQUMsQ0FBQztRQUNsSixHQUFHLENBQUEsQ0FBK0gsVUFBVSxFQUF4SSxzQkFBMEgsRUFBMUgsSUFBd0ksQ0FBQztZQUF6SSxTQUE4SCxVQUFVLE1BQXBHLEdBQUcsc0NBQW9DLE1BQU0seUNBQW1DLEtBQUssc0NBQUM7WUFDNUgsRUFBRSxDQUFBLENBQUMsTUFBTSxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3hCLEtBQUssQ0FBQyxTQUFTLENBQUMsR0FBRyxLQUFLLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUMxQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDO1lBQ2hDLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixLQUFLLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLFlBQVksQ0FBQyxDQUFDO1lBQy9ELENBQUM7U0FDRjtRQUVELE1BQU0sQ0FBQyxLQUFLLENBQUM7SUFDZixDQUFDO0lBQ0gsaUJBQUM7QUFBRCxDQXBPQSxBQW9PQyxJQUFBO0FBcE9ZLGtCQUFVLGFBb090QixDQUFBO0FBR0QsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUFDLE1BQU0sQ0FBQyxZQUFZLENBQUMsR0FBRyxPQUFPLENBQUM7OztBQ2pkL0Msc0JBQTRFLFNBQVMsQ0FBQyxDQUFBO0FBRXRGLG9CQUE0QixPQUFPLENBQUMsQ0FBQTtBQUNwQyxtQkFBc0MsTUFBTSxDQUFDLENBQUE7QUFDN0Msd0JBQW1ELFdBQVcsQ0FBQyxDQUFBO0FBRS9ELGdGQUFnRjtBQUNoRixZQUFZO0FBQ1osZ0ZBQWdGO0FBQ2hGLHFCQUE0QixPQUFjO0lBQ3hDLElBQUksT0FBTyxHQUFHLFNBQUcsQ0FBQyxPQUFPLENBQUMsY0FBYyxFQUFFLEVBQUMsRUFBRSxFQUFFLE9BQU8sRUFBQyxDQUFDLENBQUM7SUFDekQsTUFBTSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUMsSUFBSSxHQUFHLE9BQU8sQ0FBQztBQUMxQyxDQUFDO0FBSGUsbUJBQVcsY0FHMUIsQ0FBQTtBQUNELG1CQUEwQixTQUFnQjtJQUN4QyxJQUFJLE9BQU8sR0FBRyxTQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsRUFBRSxFQUFDLElBQUksRUFBRSxTQUFTLEVBQUMsQ0FBQyxDQUFDO0lBQzdELE1BQU0sQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDLEVBQUUsR0FBRyxTQUFTLENBQUM7QUFDMUMsQ0FBQztBQUhlLGlCQUFTLFlBR3hCLENBQUE7QUFDRCxzQkFBNkIsVUFBaUI7SUFDNUMsRUFBRSxDQUFBLENBQUMsT0FBTyxVQUFVLEtBQUssUUFBUSxDQUFDO1FBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQztJQUNyRCxJQUFJLEdBQUcsR0FBRyxVQUFVLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDNUIsRUFBRSxDQUFBLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzFCLG1DQUFtQztRQUNuQyxJQUFJLE1BQU0sR0FBRyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3JDLE1BQU0sQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDM0IsQ0FBQztJQUNELE1BQU0sQ0FBQyxHQUFHLENBQUM7QUFDYixDQUFDO0FBVGUsb0JBQVksZUFTM0IsQ0FBQTtBQUNELGtCQUF5QixPQUFjO0lBQ3JDLE1BQU0sQ0FBQyxDQUFDLENBQUMsU0FBRyxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsRUFBQyxNQUFNLEVBQUUsT0FBTyxFQUFDLENBQUMsQ0FBQztBQUNwRCxDQUFDO0FBRmUsZ0JBQVEsV0FFdkIsQ0FBQTtBQUVELElBQUksWUFBWSxHQUFHLE9BQU8sQ0FBQztBQUMzQixJQUFNLFdBQVcsR0FBRyxFQUFDLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFDLENBQUM7QUFDdkQsMEJBQTBCLFdBQW9CO0lBQzVDLElBQUksUUFBUSxHQUFHLFdBQVcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUNuQyxJQUFJLFdBQVcsR0FBWSxFQUFFLENBQUM7SUFDOUIsSUFBSSxPQUFPLEdBQVksRUFBRSxDQUFDO0lBRTFCLDJDQUEyQztJQUMzQyw0QkFBNEI7SUFDNUIsSUFBSSxhQUFhLEdBQTZCLEVBQUUsQ0FBQztJQUNqRCxJQUFJLFVBQVUsR0FBNkIsRUFBRSxDQUFDO0lBQzlDLElBQUksV0FBVyxHQUFpQyxFQUFFLENBQUM7SUFDbkQsSUFBSSxNQUFNLEdBQTRCLEVBQUUsQ0FBQztJQUN6QyxHQUFHLENBQUEsQ0FBZSxVQUFRLEVBQXRCLG9CQUFVLEVBQVYsSUFBc0IsQ0FBQztRQUF2QixJQUFJLE1BQU0sR0FBSSxRQUFRLElBQVo7UUFDWixJQUFJLE1BQWlCLFNBQUcsQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUMsQ0FBQyxJQUFJLEVBQUUsV0FBckQsT0FBTyxtQkFBRyxFQUFFLEtBQXlDLENBQUM7UUFDM0QsYUFBYSxDQUFDLE1BQU0sQ0FBQyxHQUFHLFNBQUcsQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQUUsRUFBQyxRQUFBLE1BQU0sRUFBQyxDQUFDLENBQUMsTUFBTSxDQUFDO1FBQ3pFLFVBQVUsQ0FBQyxNQUFNLENBQUMsR0FBRyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDO1FBQ2pGLElBQUksTUFBeUIsU0FBRyxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsRUFBQyxVQUFVLEVBQUUsTUFBTSxFQUFDLENBQUMsSUFBSSxFQUFFLFNBQXZFLFVBQVUsbUJBQUcsQ0FBQyxLQUF5RCxDQUFDO1FBQ25GLFdBQVcsQ0FBQyxNQUFNLENBQUMsR0FBRyxVQUFVLENBQUM7UUFDakMsTUFBTSxDQUFDLE1BQU0sQ0FBQztZQUNaLGFBQWEsQ0FBQyxNQUFNLENBQUMsR0FBRyxXQUFXLENBQUMsS0FBSztnQkFDekMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxHQUFHLFdBQVcsQ0FBQyxLQUFLO2dCQUN0QyxXQUFXLENBQUMsTUFBTSxDQUFDLEdBQUcsV0FBVyxDQUFDLEtBQUssQ0FBQztLQUMzQztJQUVELDJCQUEyQjtJQUMzQixJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDWCxPQUFNLEVBQUUsR0FBRyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUM7UUFDM0IsRUFBRSxDQUFBLENBQUMsU0FBRyxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsRUFBRSxFQUFDLFVBQVUsRUFBRSxpQkFBUyxDQUFDLFFBQVEsQ0FBQyxFQUFFLE1BQU0sRUFBRSxRQUFRLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMzRixPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDMUMsQ0FBQztRQUFDLElBQUk7WUFBQyxFQUFFLEVBQUUsQ0FBQztJQUNkLENBQUM7SUFFRCxnREFBZ0Q7SUFDaEQsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNQLE9BQU0sRUFBRSxHQUFHLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUMzQixFQUFFLENBQUEsQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzdCLFdBQVcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM5QyxDQUFDO1FBQUMsSUFBSTtZQUFDLEVBQUUsRUFBRSxDQUFDO0lBQ2QsQ0FBQztJQUVELE1BQU0sQ0FBQyxFQUFDLFNBQUEsT0FBTyxFQUFFLGFBQUEsV0FBVyxFQUFFLFVBQUEsUUFBUSxFQUFFLFFBQUEsTUFBTSxFQUFFLGVBQUEsYUFBYSxFQUFFLFlBQUEsVUFBVSxFQUFFLGFBQUEsV0FBVyxFQUFDLENBQUM7QUFDMUYsQ0FBQztBQUdELGdGQUFnRjtBQUNoRixXQUFXO0FBQ1gsZ0ZBQWdGO0FBQ2hGLHdCQUF3QixLQUFLO0lBQzNCLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztBQUN6QixDQUFDO0FBQ0QscUNBQXFDLEtBQUs7SUFDeEMsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLE1BQU0sS0FBSyxRQUFRLENBQUMsYUFBYSxDQUFDO1FBQUMsS0FBSyxDQUFDLGNBQWMsRUFBRSxDQUFDO0FBQ3JFLENBQUM7QUFFRDtJQUNFLElBQUksTUFBTSxHQUFHLFNBQUcsQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLEVBQUMsSUFBSSxFQUFFLFNBQUksQ0FBQyxNQUFNLEVBQUMsQ0FBQyxDQUFDO0lBQ3pELEVBQUUsQ0FBQSxDQUFDLE1BQU0sQ0FBQztRQUFDLGNBQVEsQ0FBQyxjQUFjLEVBQUUsRUFBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLElBQUksRUFBQyxDQUFDLENBQUMsTUFBTSxFQUFFLENBQUM7QUFDdEUsQ0FBQztBQUVELGtCQUFrQixLQUFLLEVBQUUsSUFBSTtJQUMzQixJQUFLLE1BQU0sR0FBSSxJQUFJLENBQUMsSUFBSSxPQUFBLENBQUM7SUFDekIsSUFBSSxJQUFJLEdBQU8sRUFBQyxRQUFBLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBQyxDQUFDO0lBQzNELEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDO1FBQ2pCLElBQUksQ0FBQyxDQUFDLEdBQUcsbUJBQW1CLENBQUM7UUFDN0IsSUFBSSxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDO0lBQ3pCLENBQUM7SUFDRCxjQUFRLENBQUMsZUFBZSxFQUFFLElBQUksQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBQ3pDLEtBQUssQ0FBQyxjQUFjLEVBQUUsQ0FBQztBQUN6QixDQUFDO0FBRUQsd0JBQXdCLEtBQUssRUFBRSxJQUFJO0lBQ2pDLElBQUksTUFBTSxHQUFHLFNBQUcsQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLEVBQUMsSUFBSSxFQUFFLFNBQUksQ0FBQyxNQUFNLEVBQUMsQ0FBQyxDQUFDO0lBQ3pELElBQUksT0FBTyxHQUFHLE1BQU0sSUFBSSxNQUFNLENBQUMsUUFBUSxLQUFLLElBQUksQ0FBQyxJQUFJLENBQUM7SUFDdEQsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLE1BQU0sS0FBSyxRQUFRLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFBLENBQUM7SUFDOUMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLENBQUMsT0FBTyxDQUFDO1FBQUMsUUFBUSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztJQUN4QyxJQUFJLENBQUMsQ0FBQztRQUNKLFVBQVUsRUFBRSxDQUFDO1FBQ2IsS0FBSyxDQUFDLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztJQUN2QixDQUFDO0FBQ0gsQ0FBQztBQU1ELDJCQUEyQixLQUFpQixFQUFFLElBQWtCO0lBQzlELElBQUksS0FBSyxHQUFHLG1CQUFXLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQ3RDLElBQVMsT0FBTyxHQUFXLElBQUksTUFBYixLQUFLLEdBQUksSUFBSSxNQUFBLENBQUM7SUFDaEMsSUFBVyxTQUFTLEdBQVMsT0FBTyxRQUFkLEdBQUcsR0FBSSxPQUFPLElBQUEsQ0FBQztJQUNyQyxJQUFJLE1BQU0sR0FBRyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDakMsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzlCLElBQUksS0FBSyxHQUFHLGNBQVEsRUFBRSxDQUFDO0lBQ3ZCLEdBQUcsQ0FBQSxDQUFZLFVBQUksRUFBZixnQkFBTyxFQUFQLElBQWUsQ0FBQztRQUFoQixJQUFJLEtBQUcsR0FBSSxJQUFJLElBQVI7UUFDVCxFQUFFLENBQUEsQ0FBQyxLQUFLLEtBQUssT0FBTyxJQUFJLEtBQUcsQ0FBQyxLQUFLLEtBQUssS0FBSyxJQUFJLEtBQUcsQ0FBQyxTQUFTLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztZQUMzRSxLQUFLLENBQUMsUUFBUSxDQUFDLHlCQUF5QixFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUUsU0FBUyxFQUFFLEtBQUcsQ0FBQyxTQUFTLEVBQUUsSUFBSSxFQUFFLEtBQUcsQ0FBQyxLQUFLLEVBQUUsT0FBQSxLQUFLLEVBQUMsQ0FBQyxDQUFDO1FBQ3hHLENBQUM7UUFBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsS0FBSyxLQUFLLFdBQVcsSUFBSSxLQUFHLENBQUMsU0FBUyxLQUFLLEtBQUssSUFBSSxLQUFHLENBQUMsS0FBSyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7WUFDdEYsS0FBSyxDQUFDLFFBQVEsQ0FBQyx5QkFBeUIsRUFBRSxFQUFDLFFBQUEsTUFBTSxFQUFFLElBQUksRUFBRSxLQUFHLENBQUMsU0FBUyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEtBQUcsQ0FBQyxLQUFLLEVBQUMsQ0FBQyxDQUFDO1FBQy9HLENBQUM7S0FDRjtJQUNELEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUNqQixDQUFDO0FBQ0QsZ0NBQWdDLEtBQWlCLEVBQUUsSUFBd0I7SUFDekUsSUFBSSxLQUF5QixJQUFJLENBQUMsR0FBRyxFQUExQixTQUFTLGFBQUUsR0FBRyxTQUFZLENBQUM7SUFDdEMsSUFBSSxNQUFNLEdBQUcsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ2pDLEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQyxNQUFNLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQztRQUMxQixJQUFJLEtBQUssR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDbkMsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFDLEtBQUs7WUFDckMsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxTQUFTLENBQUM7UUFDcEMsQ0FBQyxDQUFDLENBQUM7UUFDSCxFQUFFLENBQUEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQ1QsY0FBUSxDQUFDLGlCQUFpQixFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUUsU0FBUyxFQUFFLEtBQUssQ0FBQyxTQUFTLEVBQUUsS0FBSyxFQUFFLFlBQVksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLEVBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQzdHLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDOUIsQ0FBQztJQUNILENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNOLGNBQVEsQ0FBQyx5QkFBeUIsRUFBRSxFQUFDLFFBQUEsTUFBTSxFQUFFLFNBQVMsRUFBRSxHQUFHLENBQUMsU0FBUyxFQUFFLEtBQUssRUFBRSxHQUFHLENBQUMsS0FBSyxFQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNyRyxDQUFDO0FBQ0gsQ0FBQztBQUNELG1CQUFtQixLQUFLLEVBQUUsSUFBbUI7SUFDM0MsSUFBSyxHQUFHLEdBQThDLElBQUksV0FBSixJQUFJLFFBQWhELEtBQUssbUJBQUcsU0FBUyxZQUEyQixJQUFJLFlBQTdCLFNBQVMsbUJBQUcsU0FBUyxLQUFRLENBQUM7SUFDM0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLFNBQVMsQ0FBQyxDQUFDO0lBQ25DLEVBQUUsQ0FBQSxDQUFDLEtBQUssS0FBSyxTQUFTLElBQUksU0FBUyxLQUFLLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDbEQsS0FBSyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDO1FBQzNCLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxDQUFDO0lBQzVCLENBQUM7SUFDRCxjQUFRLENBQUMsWUFBWSxFQUFFLEVBQUMsS0FBQSxHQUFHLEVBQUUsT0FBQSxLQUFLLEVBQUUsV0FBQSxTQUFTLEVBQUMsQ0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBQzNELENBQUM7QUFFRCxnRkFBZ0Y7QUFDaEYsdUNBQXVDO0FBQ3ZDLGdGQUFnRjtBQUNoRixJQUFJLElBQUksR0FBRyxJQUFJLENBQUM7QUFDaEIsc0JBQTZCLElBQUk7SUFDL0IsSUFBSSxRQUFRLEdBQUcsRUFBRSxDQUFDO0lBQ2xCLElBQUssU0FBUyxHQUFTLElBQUksWUFBWCxHQUFHLEdBQUksSUFBSSxJQUFBLENBQUM7SUFDNUIsRUFBRSxDQUFBLENBQUMsU0FBUyxDQUFDLFdBQVcsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ25DLEdBQUcsQ0FBQSxDQUFjLFVBQVMsRUFBdEIscUJBQVMsRUFBVCxJQUFzQixDQUFDO1lBQXZCLElBQUksS0FBSyxHQUFJLFNBQVMsSUFBYjtZQUNYLEtBQUssQ0FBQyxNQUFNLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksU0FBUyxDQUFDLE1BQU0sQ0FBQztZQUNsRCxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1NBQ2pDO0lBQ0gsQ0FBQztJQUFDLElBQUksQ0FBQyxDQUFDO1FBQ04sUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztJQUN0QyxDQUFDO0lBQ0QsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFDLENBQUMsRUFBRSx1QkFBdUIsRUFBRSxRQUFRLEVBQUU7WUFDbkQsRUFBQyxDQUFDLEVBQUUsc0JBQXNCLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUM7U0FDaEUsRUFBQyxDQUFDLENBQUM7SUFDSixNQUFNLENBQUMsRUFBQyxDQUFDLEVBQUUsMkJBQTJCLEVBQUUsVUFBQSxRQUFRLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUMsQ0FBQztBQUNyRSxDQUFDO0FBZmUsb0JBQVksZUFlM0IsQ0FBQTtBQUVELGdGQUFnRjtBQUNoRiw2QkFBNkI7QUFDN0IsZ0ZBQWdGO0FBRWhGLGVBQXNCLElBQUk7SUFDeEIsSUFBSSxDQUFDLENBQUMsR0FBRyxnQkFBYSxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBRSxDQUFDO0lBQ3JDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbEIsTUFBTSxDQUFDLElBQUksQ0FBQztBQUNkLENBQUM7QUFKZSxhQUFLLFFBSXBCLENBQUE7QUFPRCxjQUFxQixJQUFlO0lBQ2xDLElBQUssTUFBTSxHQUFJLElBQUksT0FBQSxDQUFDO0lBQ3BCLElBQUksTUFBa0IsU0FBRyxDQUFDLE9BQU8sQ0FBQyxjQUFjLEVBQUUsRUFBQyxFQUFFLEVBQUUsTUFBTSxFQUFDLENBQUMsSUFBSSxFQUFFLFFBQWhFLElBQUksbUJBQUcsTUFBTSxLQUFtRCxDQUFDO0lBQ3RFLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0lBQ2pCLElBQUksQ0FBQyxDQUFDLEdBQUcsYUFBVSxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBRSxDQUFDO0lBQ2xDLE1BQU0sQ0FBQyxJQUFJLENBQUM7QUFDZCxDQUFDO0FBTmUsWUFBSSxPQU1uQixDQUFBO0FBRUQsY0FBcUIsSUFBZTtJQUNsQyxJQUFLLE1BQU0sR0FBSSxJQUFJLE9BQUEsQ0FBQztJQUNwQixJQUFJLElBQUksR0FBRyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDL0IsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFHLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSx5QkFBcUIsQ0FBQztJQUM5QyxJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDO0lBQzlCLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLElBQUksTUFBTSxDQUFDO0lBQ3RDLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssSUFBSSxRQUFRLENBQUM7SUFDcEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxTQUFTLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLElBQUksQ0FBQztJQUNoRSxNQUFNLENBQUMsSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQVRlLFlBQUksT0FTbkIsQ0FBQTtBQUVELG9CQUEyQixJQUFlO0lBQ3hDLElBQUssTUFBTSxHQUFJLElBQUksT0FBQSxDQUFDO0lBQ3BCLElBQUksVUFBVSxHQUFHLEVBQUUsQ0FBQztJQUNwQixHQUFHLENBQUEsQ0FBWSxVQUFpQyxFQUFqQyxLQUFBLFNBQUcsQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUMsQ0FBQyxFQUE1QyxjQUFPLEVBQVAsSUFBNEMsQ0FBQztRQUE3QyxJQUFJLEdBQUcsU0FBQTtRQUF1QyxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUMsU0FBUyxFQUFFLEdBQUcsQ0FBQyxTQUFTLEVBQUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxLQUFLLEVBQUMsQ0FBQyxDQUFDO0tBQUE7SUFDaEgsVUFBVSxDQUFDLElBQUksQ0FBQyxVQUFDLENBQUMsRUFBRSxDQUFDO1FBQ2pCLEVBQUUsQ0FBQSxDQUFDLENBQUMsQ0FBQyxTQUFTLEtBQUssQ0FBQyxDQUFDLFNBQVMsQ0FBQztZQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDekMsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLENBQUMsQ0FBQyxTQUFTLEdBQUcsQ0FBQyxDQUFDLFNBQVMsQ0FBQztZQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM3QyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBQ2IsQ0FBQyxDQUFDLENBQUE7SUFDRixJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUMvQixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsVUFBVSxDQUFDO0lBQzFCLElBQUksQ0FBQyxVQUFVLENBQUMsR0FBRyxpQkFBaUIsQ0FBQztJQUNyQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsc0JBQXNCLENBQUM7SUFDekMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLElBQUksQ0FBQztJQUN4QixNQUFNLENBQUMsS0FBSyxDQUFNLElBQUksQ0FBQyxDQUFDO0FBQzFCLENBQUM7QUFmZSxrQkFBVSxhQWV6QixDQUFBO0FBRUQsaUJBQXdCLElBQWU7SUFDckMsSUFBSyxNQUFNLEdBQXNCLElBQUksY0FBSixJQUFJLE9BQXhCLElBQUksbUJBQUcsU0FBUyxLQUFRLENBQUM7SUFDdEMsSUFBSSxJQUFJLEdBQUcsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQy9CLElBQUksU0FBUyxHQUFHLEVBQUUsQ0FBQztJQUNuQixHQUFHLENBQUEsQ0FBYSxVQUF5QyxFQUF6QyxLQUFBLFNBQUcsQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQUUsRUFBQyxRQUFBLE1BQU0sRUFBQyxDQUFDLEVBQXJELGNBQVEsRUFBUixJQUFxRCxDQUFDO1FBQXRELElBQUksTUFBSSxTQUFBO1FBQStDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0tBQUE7SUFDckYsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxLQUFLLFNBQVMsR0FBRyxJQUFJLENBQUMsQ0FBQyxHQUFHLHdCQUF3QixDQUFDO0lBQ2xFLEVBQUUsQ0FBQSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQ3BCLElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxFQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFLLElBQUksdUJBQWtCLFNBQVMsQ0FBQyxNQUFNLFNBQUksU0FBUyxDQUFDLFVBQVUsRUFBRSxTQUFTLENBQUMsTUFBTSxDQUFDLE1BQUcsRUFBQyxDQUFDLENBQUM7UUFDM0gsR0FBRyxDQUFBLENBQVksVUFBUyxFQUFwQixxQkFBTyxFQUFQLElBQW9CLENBQUM7WUFBckIsSUFBSSxHQUFHLEdBQUksU0FBUyxJQUFiO1lBQWUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxNQUFBLElBQUksRUFBQyxDQUFDLENBQUMsQ0FBQztTQUFBO0lBRTFFLENBQUM7SUFBQyxJQUFJO1FBQUMsSUFBSSxDQUFDLElBQUksR0FBTSxJQUFJLDJDQUF3QyxDQUFDO0lBQ25FLE1BQU0sQ0FBQyxJQUFJLENBQUM7QUFDZCxDQUFDO0FBWmUsZUFBTyxVQVl0QixDQUFBO0FBRUQsZUFBc0IsSUFBZTtJQUNuQyxJQUFLLE1BQU0sR0FBSSxJQUFJLE9BQUEsQ0FBQztJQUNwQixJQUFJLElBQUksR0FBRyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDL0IsSUFBSSxLQUFLLEdBQUcsU0FBRyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxFQUFDLFVBQVUsRUFBRSxNQUFNLEVBQUMsQ0FBQyxDQUFDO0lBQzlELElBQUksSUFBSSxHQUFHLEVBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFDLENBQUM7SUFDbkMsR0FBRyxDQUFBLENBQWEsVUFBSyxFQUFqQixpQkFBUSxFQUFSLElBQWlCLENBQUM7UUFBbEIsSUFBSSxJQUFJLEdBQUksS0FBSyxJQUFUO1FBQVcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBQyxDQUFDLENBQUMsQ0FBQztLQUFBO0lBRWpHLElBQUksQ0FBQyxRQUFRLEdBQUc7UUFDZCxFQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFdBQVMsU0FBUyxDQUFDLEtBQUssRUFBRSxLQUFLLENBQUMsTUFBTSxDQUFDLFNBQUksS0FBSyxDQUFDLE1BQU0sU0FBSSxTQUFTLENBQUMsSUFBSSxFQUFFLEtBQUssQ0FBQyxNQUFNLENBQUMsTUFBRyxFQUFDO1FBQzVHLElBQUk7S0FDTCxDQUFDO0lBQ0YsTUFBTSxDQUFDLElBQUksQ0FBQztBQUNkLENBQUM7QUFaZSxhQUFLLFFBWXBCLENBQUE7QUFFRCxjQUFxQixJQUFlO0lBQ2xDLElBQUssTUFBTSxHQUFJLElBQUksT0FBQSxDQUFDO0lBQ3BCLElBQUksSUFBSSxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMvQiw2REFBNkQ7SUFFN0QsSUFBSSxJQUFJLEdBQUcsU0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUM1QixJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsSUFBSSxDQUFDO0lBQ3BCLE1BQU0sQ0FBQyxLQUFLLENBQU0sSUFBSSxDQUFDLENBQUM7QUFDMUIsQ0FBQztBQVJlLFlBQUksT0FRbkIsQ0FBQTtBQUVELGlCQUF3QixJQUFlO0lBQ3JDLElBQUssTUFBTSxHQUFzQixJQUFJLGNBQUosSUFBSSxPQUF4QixJQUFJLG1CQUFHLFNBQVMsS0FBUSxDQUFDO0lBQ3RDLElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBQyxRQUFBLE1BQU0sRUFBRSxNQUFBLElBQUksRUFBQyxDQUFDLENBQUMsQ0FBQztJQUN2QyxHQUFHLENBQUEsQ0FBWSxVQUF3RCxFQUF4RCxLQUFBLFNBQUcsQ0FBQyxJQUFJLENBQUMsYUFBYSxFQUFFLEVBQUMsUUFBQSxNQUFNLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBQyxDQUFDLEVBQW5FLGNBQU8sRUFBUCxJQUFtRSxDQUFDO1FBQXBFLElBQUksR0FBRyxTQUFBO1FBQ1QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQ2hCLElBQUksQ0FBQyxFQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEdBQUcsQ0FBQyxLQUFLLEVBQUUsTUFBQSxJQUFJLEVBQUMsQ0FBQyxFQUN4QyxJQUFJLENBQUMsRUFBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLEtBQUssRUFBRSxNQUFBLElBQUksRUFBQyxDQUFDLENBQ2hDLENBQUM7S0FDSDtJQUNELE1BQU0sQ0FBQyxJQUFJLENBQUM7QUFDZCxDQUFDO0FBVmUsZUFBTyxVQVV0QixDQUFBO0FBTUQsZUFBc0IsSUFBYztJQUNsQyxJQUFJLEtBQXFELElBQUksT0FBbkQsR0FBRyxtQkFBRyxFQUFFLFlBQXVDLElBQUksV0FBekMsUUFBUSxtQkFBRyxJQUFJLFlBQXNCLElBQUksV0FBeEIsUUFBUSxtQkFBRyxLQUFLLEtBQVEsQ0FBQztJQUM5RCxJQUFJLENBQUMsVUFBVSxDQUFDLEdBQUcsR0FBRyxDQUFDO0lBQ3ZCLElBQUksT0FBTyxDQUFDO0lBQ1osRUFBRSxDQUFBLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNqQixJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsR0FBRyxDQUFDO1FBQ3JCLElBQUksQ0FBQyxJQUFJLEdBQUcsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzdCLEVBQUUsQ0FBQSxDQUFDLFFBQVEsQ0FBQztZQUFDLElBQUksR0FBRyxJQUFJLENBQU0sSUFBSSxDQUFDLENBQUM7UUFDcEMsRUFBRSxDQUFBLENBQUMsUUFBUSxJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUM7WUFDeEIsSUFBSSxDQUFDLFNBQVMsR0FBRywyQkFBMkIsQ0FBQztZQUM3QyxJQUFJLENBQUMsS0FBSyxHQUFHLGNBQWMsQ0FBQztZQUM1QixPQUFPLEdBQUcsVUFBVSxDQUFDO1FBQ3ZCLENBQUM7SUFDSCxDQUFDO0lBQ0QsRUFBRSxDQUFBLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUNaLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxDQUFDLEtBQUssT0FBTyxDQUFDLENBQUMsQ0FBQztZQUN0QixJQUFJLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQztRQUM5QixDQUFDO1FBQ0Qsb0JBQW9CO1FBQ3BCLElBQUksQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDO1FBQzdCLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUksSUFBSSxFQUFFLENBQUM7UUFDN0IsSUFBSSxLQUFLLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztRQUN0QixJQUFJLENBQUMsSUFBSSxHQUFHLFVBQUMsS0FBZ0IsRUFBRSxJQUFZO1lBQ3pDLElBQUksSUFBSSxHQUFxQixLQUFLLENBQUMsTUFBTSxDQUFDO1lBQzFDLEVBQUUsQ0FBQSxDQUFDLEtBQUssQ0FBQztnQkFBQyxLQUFLLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQzdCLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssT0FBSyxJQUFJLENBQUMsS0FBTyxDQUFDO2dCQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztZQUM3RCxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsS0FBSyxLQUFLLEdBQUcsQ0FBQztnQkFBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNsRCxFQUFFLENBQUEsQ0FBQyxPQUFPLENBQUM7Z0JBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNuQyxDQUFDLENBQUM7UUFFRixJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQ3hCLElBQUksQ0FBQyxLQUFLLEdBQUcsVUFBQyxLQUFnQixFQUFFLElBQVk7WUFDMUMsSUFBSSxJQUFJLEdBQXFCLEtBQUssQ0FBQyxNQUFNLENBQUM7WUFDMUMsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSyxHQUFHLENBQUMsQ0FBQyxDQUFDO2dCQUN0QixJQUFJLENBQUMsS0FBSyxHQUFHLE9BQUssSUFBSSxDQUFDLEtBQU8sQ0FBQztnQkFDL0IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDaEMsQ0FBQztZQUNELEVBQUUsQ0FBQSxDQUFDLE1BQU0sQ0FBQztnQkFBQyxNQUFNLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ2pDLENBQUMsQ0FBQztJQUNKLENBQUM7SUFDRCxNQUFNLENBQUMsSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQXpDZSxhQUFLLFFBeUNwQixDQUFBO0FBR0QsYUFBb0IsSUFBWTtJQUM5QixJQUFLLE1BQU0sR0FBZ0MsSUFBSSxjQUFKLElBQUksV0FBbEMsUUFBUSxtQkFBRyxTQUFTLE9BQUUsSUFBSSxHQUFJLElBQUksS0FBQSxDQUFDO0lBQ2hELE1BQU0sQ0FBQyxFQUFDLENBQUMsRUFBRSxjQUFjLEVBQUUsUUFBUSxFQUFFLE1BQU0sQ0FBQyxHQUFHLENBQUMsVUFBQyxHQUFHLElBQUssT0FBQSxLQUFLLENBQUMsRUFBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLFVBQUEsUUFBUSxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsTUFBQSxJQUFJLEVBQUMsQ0FBQyxFQUE3QyxDQUE2QyxDQUFDLEVBQUMsQ0FBQztBQUMzRyxDQUFDO0FBSGUsV0FBRyxNQUdsQixDQUFBO0FBR0QsZUFBc0IsSUFBYztJQUNsQyxJQUFLLElBQUksR0FBbUgsSUFBSSxZQUFKLElBQUksZUFBckgsWUFBWSxtQkFBRyxDQUFDLE1BQU0sQ0FBQyxZQUEwRixJQUFJLFdBQTVGLFFBQVEsbUJBQUcsS0FBSyxZQUF3RSxJQUFJLGFBQTFFLFVBQVUsbUJBQUcsSUFBSSxZQUFxRCxJQUFJLE9BQXZELElBQUksbUJBQUcsU0FBUyxZQUFtQyxJQUFJLFdBQXJDLFFBQVEsbUJBQUcsS0FBSyxZQUFpQixJQUFJLFNBQW5CLE1BQU0sbUJBQUcsRUFBRSxLQUFRLENBQUM7SUFDakksRUFBRSxDQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUNoQixJQUFJLENBQUMsSUFBSSxHQUFHLGVBQWUsQ0FBQztRQUM1QixNQUFNLENBQUMsSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUNELEVBQUUsQ0FBQSxDQUFDLFFBQVEsSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUM7UUFBQyxNQUFNLElBQUksS0FBSyxDQUFDLHNEQUFzRCxDQUFDLENBQUM7SUFFbEcsSUFBSSxVQUFVLEdBQU8sWUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUN6RCxZQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsVUFBVSxDQUFDO0lBRTNDLElBQUksS0FBcUUsSUFBSSxXQUF4RSxRQUFRLG1CQUFHLFNBQVMsWUFBZ0QsSUFBSSxVQUFsRCxPQUFPLG1CQUFHLFNBQVMsWUFBMkIsSUFBSSxZQUE3QixTQUFTLG1CQUFHLFNBQVMsS0FBUSxDQUFDO0lBQzlFLEVBQUUsQ0FBQSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUM7UUFDWixJQUFJLFNBQVMsR0FBRyxRQUFRLENBQUM7UUFDekIsUUFBUSxHQUFHLFVBQVMsS0FBVyxFQUFFLElBQUk7WUFDbkMsSUFBSSxJQUFJLEdBQXFCLEtBQUssQ0FBQyxNQUFNLENBQUM7WUFDMUMsSUFBSSxHQUFHLENBQUM7WUFDUixFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMsUUFBUSxLQUFLLE9BQU8sQ0FBQyxDQUFDLENBQUM7Z0JBQzdCLEdBQUcsR0FBRyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ2pDLENBQUM7WUFBQyxJQUFJLENBQUMsQ0FBQztnQkFDTixHQUFHLEdBQUcsWUFBWSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUN2QyxDQUFDO1lBQ0QsRUFBRSxDQUFBLENBQUMsR0FBRyxLQUFLLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztnQkFBQyxNQUFNLENBQUM7WUFDcEMsSUFBSSxTQUFTLEdBQUcsSUFBSSxXQUFXLENBQUMsVUFBVSxFQUFFLEVBQUMsTUFBTSxFQUFFLEdBQUcsRUFBQyxDQUFDLENBQUM7WUFDM0QsU0FBUyxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsQ0FBQztRQUM3QixDQUFDLENBQUE7SUFDSCxDQUFDO0lBQ0QsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUNYLElBQUksTUFBTSxHQUFHLFVBQUMsR0FBRyxFQUFFLElBQUk7WUFDckIsSUFBSSxLQUFLLEdBQUcsSUFBSSxXQUFXLENBQUMsU0FBUyxFQUFFLEVBQUMsTUFBTSxFQUFFLEtBQUssRUFBQyxDQUFDLENBQUM7WUFDeEQsT0FBTyxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN2QixDQUFDLENBQUE7UUFDRCxJQUFJLFVBQVUsR0FBRyxVQUFDLEdBQUcsRUFBRSxJQUFJO1lBQ3pCLElBQUksSUFBSSxHQUFxQixHQUFHLENBQUMsTUFBTSxDQUFDO1lBQ3hDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDO1lBQ2hELGNBQVEsRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQ3RCLENBQUMsQ0FBQTtRQUNELElBQUksU0FBUyxHQUFHLFVBQUMsR0FBRyxFQUFFLElBQUksSUFBSyxPQUFBLE9BQU8sQ0FBQyxJQUFJLFdBQVcsQ0FBQyxTQUFTLEVBQUUsRUFBQyxNQUFNLEVBQUUsUUFBUSxFQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsRUFBN0QsQ0FBNkQsQ0FBQztJQUMvRixDQUFDO0lBQ0QsRUFBRSxDQUFBLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztRQUNiLHFHQUFxRztRQUNyRyxJQUFJLFFBQVEsR0FBRyxVQUFDLEdBQUcsRUFBRSxJQUFJLElBQUssT0FBQSxPQUFPLENBQUMsSUFBSSxXQUFXLENBQUMsV0FBVyxFQUFFLEVBQUMsTUFBTSxFQUFFLEtBQUssRUFBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEVBQTVELENBQTRELENBQUM7UUFDM0YsSUFBSSxXQUFXLEdBQUcsVUFBQyxHQUFHLEVBQUUsSUFBSSxJQUFLLE9BQUEsT0FBTyxDQUFDLElBQUksV0FBVyxDQUFDLFdBQVcsRUFBRSxFQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxFQUEvRCxDQUErRCxDQUFDO0lBQ25HLENBQUM7SUFFRCw2QkFBNkI7SUFDN0IsSUFBSSxNQUFNLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNsQyxJQUFJLE9BQU8sR0FBRyxDQUFDLENBQUM7SUFDaEIsT0FBTSxPQUFPLEdBQUcsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDO1FBQzlCLEVBQUUsQ0FBQSxDQUFDLFlBQVksSUFBSSxZQUFZLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1lBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDM0YsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLFVBQVUsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ3pGLElBQUk7WUFBQyxPQUFPLEVBQUUsQ0FBQztJQUNqQixDQUFDO0lBRUQsSUFBSSxNQUFNLEdBQUcsRUFBQyxDQUFDLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUMsQ0FBQztJQUN6QyxJQUFJLEtBQXlELFVBQVUsUUFBNUQsU0FBUyxtQkFBRyxTQUFTLE9BQVksYUFBYSxHQUFJLFVBQVUsVUFBQSxDQUFDO0lBQ3hFLGFBQWEsR0FBRyxhQUFhLElBQUksQ0FBQyxDQUFDO0lBQ25DLEdBQUcsQ0FBQSxDQUFjLFVBQU0sRUFBbkIsa0JBQVMsRUFBVCxJQUFtQixDQUFDO1FBQXBCLElBQUksS0FBSyxHQUFJLE1BQU0sSUFBVjtRQUNYLElBQUksUUFBUSxHQUFHLEtBQUssS0FBSyxTQUFTLENBQUM7UUFDbkMsSUFBSSxTQUFTLEdBQUcsQ0FBQyxLQUFLLEtBQUssU0FBUyxDQUFDLEdBQUcsYUFBYSxHQUFHLENBQUMsQ0FBQztRQUMxRCxNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFDLENBQUMsRUFBRSx1QkFBdUIsRUFBRSxRQUFRLEVBQUU7Z0JBQzFELEtBQUssQ0FBQyxFQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsTUFBQSxJQUFJLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBQyxDQUFDO2dCQUMzQyxFQUFDLENBQUMsRUFBRSxXQUFXLEVBQUM7Z0JBQ2hCLEVBQUMsQ0FBQyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUU7d0JBQ3hCLFFBQVEsR0FBRzs0QkFDVCxDQUFDLEVBQUUsa0JBQWUsUUFBUSxJQUFJLFNBQVMsR0FBRyxDQUFDLEdBQUcsZ0JBQWdCLEdBQUcsa0JBQWtCLFdBQUksUUFBUSxHQUFHLFFBQVEsR0FBRyxFQUFFLENBQUU7NEJBQ2pILEdBQUcsRUFBRSxJQUFJLENBQUMsR0FBRzs0QkFDYixPQUFBLEtBQUs7NEJBQ0wsU0FBUyxFQUFFLENBQUMsU0FBUzs0QkFDckIsS0FBSyxFQUFFLFNBQVM7eUJBQ2pCLEdBQUcsU0FBUztxQkFDZCxFQUFDO2FBQ0gsRUFBQyxDQUFDLENBQUM7S0FDTDtJQUVELEVBQUUsQ0FBQSxDQUFDLFFBQVEsSUFBSSxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBQ3pCLElBQUksSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLGFBQWEsQ0FBQztRQUM5QixJQUFJLEdBQUcsR0FBRyxhQUFhLENBQUM7UUFDeEIsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsSUFBSSxFQUFFLElBQUk7WUFDbEMsSUFBSSxDQUFDLEdBQUcsV0FBVyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxXQUFXLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDbkcsTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUM7Z0JBQ2xCLENBQUMsQ0FBQyxLQUFLLFNBQVMsQ0FBQyxHQUFHLEdBQUc7b0JBQ3ZCLENBQUMsQ0FBQyxLQUFLLFNBQVMsQ0FBQyxHQUFHLElBQUk7d0JBQ3hCLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsR0FBRyxJQUFJLENBQUM7UUFDekIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsNkNBQTZDO0lBQzdDLEVBQUUsQ0FBQSxDQUFDLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO1FBQUMsTUFBTSxJQUFJLEtBQUssQ0FBQywyQ0FBMkMsQ0FBQyxDQUFDO0lBQ25GLEVBQUUsQ0FBQSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1FBQ2pCLElBQUssT0FBTyxHQUFJLE1BQU0sR0FBQSxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBQyxDQUFDLEVBQUUsQ0FBQztZQUNiLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNwQixJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDcEIsRUFBRSxDQUFBLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQztnQkFBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO1lBQ3ZCLEVBQUUsQ0FBQSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUM7Z0JBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3RCLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDWCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxrREFBa0Q7SUFDbEQsSUFBSSxJQUFJLEdBQUcsRUFBQyxDQUFDLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUMsQ0FBQztJQUNyQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDWCxJQUFJLE9BQU8sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDO0lBQzFCLE9BQU0sRUFBRSxHQUFHLE9BQU8sRUFBRSxDQUFDO1FBQ25CLElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNuQixJQUFJLE9BQU8sR0FBRyxFQUFDLENBQUMsRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFBLEdBQUcsRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFDLENBQUM7UUFDL0QsR0FBRyxDQUFBLENBQWdCLFVBQU0sRUFBckIsa0JBQVcsRUFBWCxJQUFxQixDQUFDO1lBQXRCLElBQUksT0FBTyxHQUFJLE1BQU0sSUFBVjtZQUNiLElBQUksU0FBUyxHQUFHLEVBQUUsQ0FBQztZQUNuQixPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBQyxDQUFDLEVBQUUsY0FBYyxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUUsUUFBUSxFQUFFLFFBQVEsR0FBRyxJQUFJLEdBQUcsS0FBSyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsR0FBRyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxNQUFBLElBQUksRUFBRSxPQUFPLEVBQUUsY0FBYyxFQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3ROLElBQUksUUFBUSxHQUFHLEVBQUMsQ0FBQyxFQUFFLGtCQUFrQixFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBQSxHQUFHLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBQyxDQUFDO1lBQ3ZFLE9BQU8sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ2hDLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUN0QixPQUFNLEVBQUUsR0FBRyxPQUFPLElBQUksTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLEdBQUcsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO2dCQUN2RCxJQUFJLFVBQVUsR0FBRyxFQUFDLENBQUMsRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUMsQ0FBQztnQkFDeEUsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBQ25DLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ3ZCLEdBQUcsQ0FBQSxDQUFjLFVBQU0sRUFBbkIsa0JBQVMsRUFBVCxJQUFtQixDQUFDO29CQUFwQixJQUFJLEtBQUssR0FBSSxNQUFNLElBQVY7b0JBQ1gsRUFBRSxDQUFBLENBQUMsS0FBSyxLQUFLLE9BQU8sQ0FBQzt3QkFBQyxRQUFRLENBQUM7b0JBQy9CLFVBQVUsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxRQUFRLEVBQUUsUUFBUSxHQUFHLElBQUksR0FBRyxLQUFLLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQUUsVUFBVSxFQUFFLE9BQUEsS0FBSyxFQUFFLE1BQUEsSUFBSSxFQUFFLE9BQU8sRUFBRSxjQUFjLEVBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQzlLO2dCQUNELEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQztvQkFBQyxVQUFVLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFDLENBQUMsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBQyxDQUFDLEVBQUUsOEJBQThCLEVBQUUsR0FBRyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFDLENBQUMsRUFBQyxDQUFDLENBQUM7Z0JBQzFJLEVBQUUsRUFBRSxDQUFDO2dCQUNMLE1BQU0sR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDcEIsQ0FBQztTQUNGO1FBQ0QsRUFBRSxDQUFBLENBQUMsTUFBTSxDQUFDLE1BQU0sS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3JCLEdBQUcsQ0FBQSxDQUFjLFVBQU0sRUFBbkIsa0JBQVMsRUFBVCxJQUFtQixDQUFDO2dCQUFwQixJQUFJLEtBQUssR0FBSSxNQUFNLElBQVY7Z0JBQ1gsT0FBTyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUMsQ0FBQyxFQUFFLGNBQWMsRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLEtBQUssQ0FBQyxFQUFFLFFBQVEsRUFBRSxRQUFRLEdBQUcsSUFBSSxHQUFHLEtBQUssRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLEdBQUcsRUFBRSxPQUFPLEVBQUUsT0FBQSxLQUFLLEVBQUUsTUFBQSxJQUFJLEVBQUUsT0FBTyxFQUFFLGNBQWMsRUFBQyxDQUFDLENBQUMsQ0FBQzthQUM1SztZQUNELEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQztnQkFBQyxPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFDLENBQUMsRUFBRSxVQUFVLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBQyxDQUFDLEVBQUUsOEJBQThCLEVBQUUsR0FBRyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFDLENBQUMsRUFBQyxDQUFDLENBQUM7WUFDcEksRUFBRSxFQUFFLENBQUM7UUFDVCxDQUFDO1FBQ0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDOUIsQ0FBQztJQUNELEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDWCxFQUFFLENBQUEsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDeEIsVUFBVSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUMzQixDQUFDO1FBQ0QsSUFBSSxPQUFPLEdBQUcsRUFBQyxDQUFDLEVBQUUsbUJBQW1CLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUMsQ0FBQztRQUMzRSxHQUFHLENBQUEsQ0FBYyxVQUFNLEVBQW5CLGtCQUFTLEVBQVQsSUFBbUIsQ0FBQztZQUFwQixJQUFJLEtBQUssR0FBSSxNQUFNLElBQVY7WUFBWSxPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBQyxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxjQUFjLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsR0FBRyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsY0FBYyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsT0FBQSxLQUFLLEVBQUUsUUFBQSxNQUFNLEVBQUUsTUFBQSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxVQUFVLENBQUMsT0FBTyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxFQUFDLENBQUMsQ0FBQyxDQUFDO1NBQUE7UUFDOVIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDOUIsQ0FBQztJQUVELElBQUksQ0FBQyxDQUFDLEdBQUcsWUFBUyxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBRSxDQUFDO0lBQ2pDLElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDL0IsRUFBRSxDQUFBLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQztRQUNWLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDMUIsQ0FBQztJQUNELE1BQU0sQ0FBQyxJQUFJLENBQUM7QUFDZCxDQUFDO0FBdEplLGFBQUssUUFzSnBCLENBQUE7QUFFRCx3QkFBd0IsS0FBSyxFQUFFLElBQUk7SUFDakMsRUFBRSxDQUFBLENBQUMsS0FBSyxDQUFDLE9BQU8sS0FBSyxZQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztRQUNoQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQztRQUN2QixLQUFLLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDekIsQ0FBQztBQUNILENBQUM7QUFHRCxxQkFBNEIsSUFBb0I7SUFDOUMsSUFBSyxHQUFHLEdBQWdELElBQUksV0FBSixJQUFJLFNBQWxELE1BQU0sbUJBQUcsU0FBUyxZQUE0QixJQUFJLGFBQTlCLFVBQVUsbUJBQUcsU0FBUyxLQUFRLENBQUM7SUFDN0QsSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7SUFDbkIsRUFBRSxDQUFBLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztRQUNkLElBQUksS0FBSyxHQUFHLFlBQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFDLENBQUM7UUFDakYsSUFBSSxRQUFRLEdBQUcsRUFBRSxDQUFDO1FBQ2xCLEdBQUcsQ0FBQSxDQUFjLFVBQVUsRUFBdkIsc0JBQVMsRUFBVCxJQUF1QixDQUFDO1lBQXhCLElBQUksS0FBSyxHQUFJLFVBQVUsSUFBZDtZQUNYLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBQyxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxXQUFXLENBQUMsS0FBSyxDQUFDLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsS0FBSyxLQUFLLEtBQUssQ0FBQyxLQUFLLEVBQUMsQ0FBQyxDQUFDO1NBQ3ZHO1FBQ0QsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBQyxDQUFDLEVBQUUsV0FBVyxFQUFDLENBQUMsQ0FBQztRQUNyQyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFO2dCQUN2QyxFQUFDLElBQUksRUFBRSxTQUFTLEVBQUM7Z0JBQ2pCLEVBQUMsQ0FBQyxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUUsMEJBQTBCLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxLQUFBLEdBQUcsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFDO2dCQUM1RyxFQUFDLENBQUMsRUFBRSxzQkFBbUIsS0FBSyxDQUFDLFNBQVMsS0FBSyxDQUFDLENBQUMsR0FBRyxnQkFBZ0IsR0FBRyxrQkFBa0IsQ0FBRSxFQUFFLEtBQUEsR0FBRyxFQUFFLFNBQVMsRUFBRSxDQUFDLEtBQUssQ0FBQyxTQUFTLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUM7YUFDbEosRUFBQyxDQUFDLENBQUM7SUFDTixDQUFDO0lBQ0QsSUFBSSxDQUFDLENBQUMsR0FBRyxtQkFBZ0IsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUUsQ0FBQztJQUN4QyxNQUFNLENBQUMsSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQWxCZSxtQkFBVyxjQWtCMUIsQ0FBQTtBQUdELHNCQUE2QixJQUFZO0lBQ3ZDLElBQUksQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDO0lBQ2IsSUFBSSxDQUFDLENBQUMsR0FBRyxXQUFRLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFFLENBQUM7SUFDaEMsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDO0lBQ3JCLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDO0lBQ2xDLE1BQU0sQ0FBQyxJQUFJLENBQUM7QUFDZCxDQUFDO0FBTmUsb0JBQVksZUFNM0IsQ0FBQTtBQUVELHVCQUE4QixJQUFZO0lBQ3hDLElBQUksQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDO0lBQ2YsSUFBSSxDQUFDLENBQUMsR0FBRyxVQUFPLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFFLENBQUM7SUFDL0IsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDO0lBQ3BCLE1BQU0sQ0FBQyxJQUFJLENBQUM7QUFDZCxDQUFDO0FBTGUscUJBQWEsZ0JBSzVCLENBQUE7QUFFRCx1QkFBOEIsSUFBWTtJQUN4QyxJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3pFLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUN0RSxJQUFJLE1BQU0sR0FBRyxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO0lBQzdFLEVBQUUsQ0FBQSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUM7UUFDVixJQUFJLENBQUMsQ0FBQyxHQUFHLE9BQU8sQ0FBQztJQUNuQixDQUFDO0lBQUMsSUFBSSxDQUFDLENBQUM7UUFDTixJQUFJLENBQUMsQ0FBQyxHQUFHLFFBQVEsQ0FBQztJQUNwQixDQUFDO0lBQ0QsSUFBSSxDQUFDLENBQUMsR0FBRyxZQUFTLElBQUksQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFFLENBQUM7SUFDakMsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDO0lBQ3BCLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDO0lBQzVCLE1BQU0sQ0FBQyxJQUFJLENBQUM7QUFDZCxDQUFDO0FBYmUscUJBQWEsZ0JBYTVCLENBQUE7QUFNRCxxQkFBNEIsSUFBb0I7SUFDOUMsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLEdBQUcsS0FBSyxTQUFTLENBQUM7UUFBQyxNQUFNLElBQUksS0FBSyxDQUFDLGtEQUFrRCxDQUFDLENBQUM7SUFDL0YsSUFBSSxLQUFLLEdBQUcsWUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEtBQUssU0FBUyxHQUFHLElBQUksQ0FBQyxJQUFJLEdBQUcsSUFBSSxFQUFDLENBQUM7SUFDdEcsSUFBSSxPQUFPLEdBQUcsRUFBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVEsRUFBQyxDQUFDO0lBQ3hDLElBQUksTUFBTSxHQUFHLEVBQUMsQ0FBQyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFDLENBQUMsRUFBRSxrQkFBa0IsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFJLEdBQUcsZ0JBQWdCLEdBQUcsa0JBQWtCLENBQUMsRUFBRSxXQUFXLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsY0FBYyxFQUFDLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxFQUFDLENBQUM7SUFFcE0sSUFBSSxDQUFDLENBQUMsR0FBRyxrQkFBZSxJQUFJLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBRSxDQUFDO0lBQ3ZDLElBQUksQ0FBQyxRQUFRLEdBQUcsQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLElBQUksR0FBRyxPQUFPLEdBQUcsU0FBUyxDQUFDLENBQUM7SUFDM0QsTUFBTSxDQUFDLElBQUksQ0FBQztBQUNkLENBQUM7QUFUZSxtQkFBVyxjQVMxQixDQUFBO0FBRUQsd0JBQXdCLEdBQUcsRUFBRSxJQUFJO0lBQy9CLGNBQVEsQ0FBQyxpQkFBaUIsRUFBRSxFQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMsV0FBVyxFQUFFLElBQUksRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUMsQ0FBQyxDQUFDO0FBQ2pGLENBQUM7QUFFRCxJQUFJLG9CQUFvQixHQUFtQjtJQUN6QyxFQUFDLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxNQUFNLFlBQUMsSUFBSTtZQUM3QixJQUFJLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQTtZQUNyQixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FDaEIsRUFBQyxJQUFJLEVBQUUsTUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLE1BQUcsRUFBQyxDQUN2RSxDQUFDO1lBQ0YsTUFBTSxDQUFDLElBQUksQ0FBQztRQUNkLENBQUMsRUFBQztJQUNGLEVBQUMsSUFBSSxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsVUFBVSxFQUFFLE1BQU0sWUFBQyxJQUFJO1lBQ2xDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUNoQixFQUFDLElBQUksRUFBRSxNQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksTUFBRyxFQUFDLENBQ3ZFLENBQUM7WUFDRixNQUFNLENBQUMsSUFBSSxDQUFDO1FBQ2QsQ0FBQyxFQUFDO0lBQ0YsRUFBQyxJQUFJLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBQztDQUNuQyxDQUFDO0FBQ0YsSUFBSSxtQkFBbUIsR0FBRyxDQUFDLGNBQWMsRUFBRSxjQUFjLEVBQUUsY0FBYyxFQUFFLGNBQWMsRUFBRSxjQUFjLEVBQUUsY0FBYyxFQUFFLGNBQWMsQ0FBQyxDQUFDO0FBSTNJLG1CQUEwQixJQUFrQjtJQUMxQyxJQUFNLDRCQUE0QixHQUFHLEVBQUUsQ0FBQztJQUN4QyxJQUFjLFdBQVcsR0FBc0IsSUFBSSxnQkFBSixJQUFJLE9BQXhCLElBQUksbUJBQUcsU0FBUyxLQUFRLENBQUM7SUFDcEQsSUFBSSxLQUFtRixnQkFBZ0IsQ0FBQyxXQUFXLENBQUMsRUFBL0csT0FBTyxlQUFFLFdBQVcsbUJBQUUsUUFBUSxnQkFBRSxNQUFNLGNBQUUsYUFBYSxxQkFBRSxVQUFVLGtCQUFFLFdBQVcsaUJBQWlDLENBQUM7SUFDckgsSUFBSSxZQUFZLEdBQUcsb0JBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUN4QyxRQUFRLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQzVCLFdBQVcsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7SUFDL0IsT0FBTyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUUzQixpQkFBaUI7SUFDakIsNkZBQTZGO0lBQzdGLGtDQUFrQztJQUNsQyw0QkFBNEI7SUFDNUIsb0JBQW9CLE1BQU07UUFDeEIsSUFBSSxLQUFLLEdBQUcsRUFBQyxJQUFJLEVBQUMsRUFBRSxFQUFFLEtBQUssRUFBRSxhQUFhLENBQUMsTUFBTSxDQUFDLEVBQUUsS0FBSyxFQUFFLFdBQVcsQ0FBQyxNQUFNLENBQUMsRUFBRSxLQUFLLEVBQUUsVUFBVSxDQUFDLE1BQU0sQ0FBQyxFQUFDLENBQUM7UUFDM0csSUFBSSxlQUFlLEdBQUcsQ0FBQyxDQUFDO1FBQ3hCLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksS0FBSyxDQUFDLENBQUMsQ0FBQztZQUN0QixFQUFFLENBQUEsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFBQyxRQUFRLENBQUM7WUFDaEMsSUFBSSxZQUFZLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNuRCxFQUFFLENBQUEsQ0FBQyxZQUFZLEdBQUcsZUFBZSxDQUFDLENBQUMsQ0FBQztnQkFDbEMsZUFBZSxHQUFHLFlBQVksQ0FBQztnQkFDL0IsS0FBSyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7WUFDcEIsQ0FBQztRQUNILENBQUM7UUFDRCxNQUFNLENBQUMsRUFBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLE9BQUEsS0FBSyxFQUFFLFFBQVEsRUFBRTtnQkFDN0MsSUFBSSxDQUFDLEVBQUMsUUFBQSxNQUFNLEVBQUUsTUFBQSxJQUFJLEVBQUMsQ0FBQzthQUNyQixFQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQsd0JBQXdCLEdBQVUsRUFBRSxRQUFRLEVBQUUsWUFBNEI7UUFBNUIsNEJBQTRCLEdBQTVCLG9CQUE0QjtRQUN4RSxJQUFJLElBQUksR0FBRyxFQUFFLENBQUM7UUFDZCxHQUFHLENBQUEsQ0FBZSxVQUFRLEVBQXRCLG9CQUFVLEVBQVYsSUFBc0IsQ0FBQztZQUF2QixJQUFJLE1BQU0sR0FBSSxRQUFRLElBQVo7WUFDWixJQUFJLENBQUMsSUFBSSxDQUFDO2dCQUNSLElBQUksRUFBRSxNQUFNO2dCQUNaLEtBQUssRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDO2dCQUNyQixLQUFLLEVBQUUsVUFBVSxDQUFDLE1BQU0sQ0FBQztnQkFDekIsS0FBSyxFQUFFLGFBQWEsQ0FBQyxNQUFNLENBQUM7Z0JBQzVCLEtBQUssRUFBRSxXQUFXLENBQUMsTUFBTSxDQUFDO2FBQzNCLENBQUMsQ0FBQztZQUNILEVBQUUsQ0FBQSxDQUFDLFlBQVksQ0FBQztnQkFBQyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQztTQUNyRDtRQUNELE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBQyxDQUFDLEVBQUUsZUFBZSxFQUFFLEtBQUEsR0FBRyxFQUFFLE1BQUEsSUFBSSxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsTUFBQSxJQUFJLEVBQUMsQ0FBQyxDQUFDO0lBQ3RFLENBQUM7SUFFRCx3REFBd0Q7SUFDeEQsTUFBTSxDQUFDLEVBQUMsQ0FBQyxFQUFFLHVCQUF1QixFQUFFLFFBQVEsRUFBRTtZQUM1QyxFQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLGFBQWEsRUFBQztZQUM5QixlQUFPLENBQUMsRUFBQyxDQUFDLEVBQUUsbUJBQW1CLEVBQUUsT0FBTyxFQUFFLG9CQUFvQixFQUFFLE1BQU0sRUFBRSxtQkFBbUIsRUFBRSxRQUFRLEVBQUUsV0FBVyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsRUFBQyxDQUFDO1lBRXBJLEVBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFDO1lBQzNCLGVBQU8sQ0FBQyxFQUFDLENBQUMsRUFBRSxtQkFBbUIsRUFBRSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxFQUFFLG1CQUFtQixFQUFFLFFBQVEsRUFBRSxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSw0QkFBNEIsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsRUFBQyxDQUFDO1lBQ3hLLFdBQVcsQ0FBQztnQkFDVixHQUFHLEVBQUssSUFBSSxDQUFDLEdBQUcsb0NBQWlDO2dCQUNqRCxNQUFNLEVBQUUsRUFBQyxJQUFJLEVBQUUsc0JBQXNCLEVBQUM7Z0JBQ3RDLFFBQVEsRUFBRTtvQkFDUixpSEFBaUg7b0JBQ2pILGNBQWMsQ0FBSSxJQUFJLENBQUMsR0FBRyxpQ0FBOEIsRUFBRSxRQUFRLEVBQUUsSUFBSSxDQUFDO2lCQUMxRTtnQkFDRCxJQUFJLEVBQUUsS0FBSzthQUNaLENBQUM7WUFFRixFQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBQztZQUM1QixXQUFXLENBQUM7Z0JBQ1YsR0FBRyxFQUFLLElBQUksQ0FBQyxHQUFHLG1DQUFnQztnQkFDaEQsTUFBTSxFQUFFLEVBQUMsSUFBSSxFQUFFLCtCQUErQixFQUFDO2dCQUMvQyxRQUFRLEVBQUUsQ0FBQyxjQUFjLENBQUksSUFBSSxDQUFDLEdBQUcsZ0NBQTZCLEVBQUUsT0FBTyxDQUFDLENBQUM7Z0JBQzdFLElBQUksRUFBRSxLQUFLO2FBQ1osQ0FBQztTQUNILEVBQUMsQ0FBQztBQUNMLENBQUM7QUFyRWUsaUJBQVMsWUFxRXhCLENBQUE7QUFFVSxlQUFPLEdBQUcsaUJBQVUsQ0FBQzs7O0FDanBCaEMscUJBQTBCLGdCQUFnQixDQUFDLENBQUE7QUFDaEMsWUFBSSxHQUFHLFNBQUssQ0FBQztBQUViLFdBQUcsR0FBRyxTQUFTLENBQUM7QUFDM0IsSUFBSSxDQUFDO0lBQ0gsTUFBTSxDQUFBO0lBQ04sTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLE9BQU8sQ0FBQztBQUM1QixDQUFFO0FBQUEsS0FBSyxDQUFBLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztJQUNaLFdBQUcsR0FBRyxNQUFNLENBQUM7QUFDZixDQUFDO0FBRVUsYUFBSyxHQUFPLEVBRXRCLENBQUM7QUFFRixFQUFFLENBQUEsQ0FBQyxXQUFHLEtBQUssU0FBUyxDQUFDO0lBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLGFBQUssQ0FBQztBQUU5QyxtQkFBMEIsSUFBVztJQUNuQyxNQUFNLENBQUMsbUJBQWlCLElBQUkscUNBQWtDLENBQUM7QUFDakUsQ0FBQztBQUZlLGlCQUFTLFlBRXhCLENBQUE7QUFPVSxhQUFLLEdBQWMsVUFBUyxNQUFNO0lBQzNDLEVBQUUsQ0FBQSxDQUFDLGFBQUssQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFBQyxNQUFNLENBQUMsYUFBSyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNqRCxNQUFNLENBQUMsYUFBSyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxVQUFTLE9BQU87UUFBRSxnQkFBUzthQUFULFdBQVMsQ0FBVCxzQkFBUyxDQUFULElBQVM7WUFBVCwrQkFBUzs7UUFDckQsRUFBRSxDQUFBLENBQUMsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDO1lBQUMsTUFBTSxDQUFDO1FBQzNCLElBQUksR0FBRyxHQUFHLEVBQUUsQ0FBQztRQUNiLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztRQUNYLEdBQUcsQ0FBQSxDQUFZLFVBQU8sRUFBbEIsbUJBQU8sRUFBUCxJQUFrQixDQUFDO1lBQW5CLElBQUksR0FBRyxHQUFJLE9BQU8sSUFBWDtZQUFhLEdBQUcsSUFBSSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLEVBQUUsR0FBRyxNQUFNLENBQUMsRUFBRSxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztTQUFBO1FBRTlFLEVBQUUsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxJQUFJLENBQUM7WUFBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN2QyxJQUFJLE1BQU0sR0FBRyxDQUFDLENBQUM7UUFDZixPQUFNLElBQUksRUFBRSxDQUFDO1lBQ1gsR0FBRyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxDQUFDO1lBQ3hELE1BQU0sR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDdkMsRUFBRSxDQUFBLENBQUMsQ0FBQyxNQUFNLENBQUM7Z0JBQUMsS0FBSyxDQUFDO1FBQ3BCLENBQUM7UUFDSCxNQUFNLENBQUMsR0FBRyxDQUFDO0lBQ1gsQ0FBQyxDQUFBO0FBQ0gsQ0FBQyxDQUFDO0FBQ0YsYUFBSyxDQUFDLElBQUksR0FBRyxFQUFFLENBQUM7QUFFaEIsZ0JBQXVCLEdBQVUsRUFBRSxNQUFhO0lBQzlDLElBQUksR0FBRyxHQUFHLE1BQU0sR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDO0lBQzlCLElBQUksR0FBRyxHQUFHLEVBQUUsQ0FBQztJQUNiLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxFQUFFLEVBQUUsR0FBRyxHQUFHLEVBQUUsRUFBRSxFQUFFO1FBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQztJQUM1QyxNQUFNLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxHQUFHLEdBQUcsQ0FBQztBQUM1RCxDQUFDO0FBTGUsY0FBTSxTQUtyQixDQUFBO0FBQ0QsbUJBQTBCLE9BQU8sRUFBRSxNQUFNO0lBQ3ZDLE1BQU0sQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLE9BQU8sQ0FBQyxHQUFHLEdBQUcsR0FBRyxNQUFNLENBQUMsR0FBRyxFQUFFLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztBQUM5RCxDQUFDO0FBRmUsaUJBQVMsWUFFeEIsQ0FBQTtBQUVELG9CQUEyQixJQUFXO0lBQ3BDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQTtBQUM5QyxDQUFDO0FBRmUsa0JBQVUsYUFFekIsQ0FBQTtBQUVELG1CQUEwQixJQUFXO0lBQ25DLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDbkQsQ0FBQztBQUZlLGlCQUFTLFlBRXhCLENBQUE7QUFFRCxJQUFJLG9CQUFvQixHQUFHO0lBQ3pCLEdBQUcsRUFBRSxNQUFNO0lBQ1gsR0FBRyxFQUFFLE9BQU87SUFDWixHQUFHLEVBQUUsUUFBUTtJQUNiLEdBQUcsRUFBRSxLQUFLO0lBQ1YsR0FBRyxFQUFFLE1BQU07SUFDWCxHQUFHLEVBQUUsT0FBTztJQUNaLEdBQUcsRUFBRSxPQUFPO0lBQ1osR0FBRyxFQUFFLE9BQU87SUFDWixHQUFHLEVBQUUsV0FBVztJQUNoQixHQUFHLEVBQUUsUUFBUTtJQUNiLEdBQUcsRUFBRSxVQUFVO0lBQ2YsR0FBRyxFQUFFLElBQUk7SUFDVCxHQUFHLEVBQUUsSUFBSTtJQUNULEdBQUcsRUFBRSxJQUFJO0lBQ1QsR0FBRyxFQUFFLE1BQU07SUFDWCxHQUFHLEVBQUUsU0FBUztJQUNkLEdBQUcsRUFBRSxXQUFXO0lBQ2hCLEdBQUcsRUFBRSxZQUFZO0lBQ2pCLEdBQUcsRUFBRSxNQUFNO0lBQ1gsSUFBSSxFQUFFLE9BQU87SUFDYixHQUFHLEVBQUUsT0FBTztJQUNaLEdBQUcsRUFBRSxPQUFPO0lBQ1osR0FBRyxFQUFFLGFBQWE7SUFDbEIsR0FBRyxFQUFFLGNBQWM7SUFDbkIsR0FBRyxFQUFFLE9BQU87Q0FDYixDQUFDO0FBQ0YsSUFBSSxzQkFBc0IsR0FBRyxFQUFFLENBQUM7QUFDaEMsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxvQkFBb0IsQ0FBQyxDQUFDLENBQUM7SUFDckMsc0JBQXNCLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxJQUFJLENBQUM7QUFDNUQsQ0FBQztBQUVELHFFQUFxRTtBQUNyRSxpQkFBd0IsSUFBVztJQUNqQyxJQUFJLEdBQUcsR0FBRyxFQUFFLENBQUM7SUFDYixHQUFHLENBQUEsQ0FBYSxVQUFJLEVBQWhCLGdCQUFRLEVBQVIsSUFBZ0IsQ0FBQztRQUFqQixJQUFJLElBQUksR0FBSSxJQUFJLElBQVI7UUFDVixJQUFJLFdBQVcsR0FBRyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM3QyxFQUFFLENBQUEsQ0FBQyxJQUFJLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQztZQUNoQixHQUFHLElBQUksR0FBRyxDQUFDO1FBRWIsQ0FBQztRQUFDLElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ3RCLEdBQUcsSUFBSSxPQUFLLFdBQVcsTUFBRyxDQUFDO1FBRTdCLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLEdBQUcsSUFBSSxJQUFJLENBQUM7UUFDZCxDQUFDO0tBQ0Y7SUFDRCxNQUFNLENBQUMsa0JBQWtCLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDakMsQ0FBQztBQWZlLGVBQU8sVUFldEIsQ0FBQTtBQUVELG1CQUEwQixHQUFVO0lBQ2xDLElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUNkLEdBQUcsQ0FBQSxDQUFhLFVBQWMsRUFBZCxLQUFBLEdBQUcsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQTFCLGNBQVEsRUFBUixJQUEwQixDQUFDO1FBQTNCLElBQUksSUFBSSxTQUFBO1FBQ1YsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDNUIsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNoQixRQUFRLENBQUM7UUFDWCxDQUFDO1FBRUQsSUFBSSxRQUFRLEdBQUcsRUFBRSxDQUFDO1FBQ2xCLElBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDN0IsUUFBUSxJQUFJLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUMzQixJQUFJLE1BQUksR0FBRyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDeEIsR0FBRyxDQUFBLENBQWMsVUFBTSxFQUFuQixrQkFBUyxFQUFULElBQW1CLENBQUM7WUFBcEIsSUFBSSxLQUFLLEdBQUksTUFBTSxJQUFWO1lBQ1gsSUFBSSxXQUFXLEdBQUcsc0JBQXNCLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3pELEVBQUUsQ0FBQSxDQUFDLFdBQVcsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQzNDLFFBQVEsSUFBSSxXQUFXLENBQUM7WUFDMUIsQ0FBQztZQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNOLFFBQVEsSUFBSSxLQUFLLENBQUM7WUFDcEIsQ0FBQztTQUNGO1FBQ0QsUUFBUSxJQUFJLE1BQUksQ0FBQztRQUNqQixJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0tBQ3JCO0lBRUQsTUFBTSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztBQUM1QyxDQUFDO0FBekJlLGlCQUFTLFlBeUJ4QixDQUFBO0FBRVUsY0FBTSxHQUFHO0lBQ2xCLE9BQUEsYUFBSztJQUNMLFFBQUEsTUFBTTtJQUNOLFdBQUEsU0FBUztJQUNULFlBQUEsVUFBVTtJQUNWLFdBQUEsU0FBUztJQUNULFNBQUEsT0FBTztJQUNQLFdBQUEsU0FBUztDQUNWLENBQUM7QUFFRixjQUFxQixHQUFHO0lBQ3RCLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztBQUM3QixDQUFDO0FBRmUsWUFBSSxPQUVuQixDQUFBO0FBRVUsYUFBSyxHQUFHO0lBQ2pCLE1BQUEsSUFBSTtDQUNMLENBQUM7QUFFRixxQkFBNEIsS0FBSztJQUMvQiwyQ0FBMkM7SUFDM0MsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssQ0FBQztJQUNsQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxLQUFLLE1BQU0sQ0FBQztRQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDdkMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEtBQUssS0FBSyxPQUFPLENBQUM7UUFBQyxNQUFNLENBQUMsS0FBSyxDQUFDO0lBQ3pDLE1BQU0sQ0FBQyxLQUFLLENBQUM7QUFDZixDQUFDO0FBTmUsbUJBQVcsY0FNMUIsQ0FBQTtBQUVELGlDQUFpQztBQUNqQyxjQUFxQixHQUFHO0lBQ3RCLEVBQUUsQ0FBQSxDQUFDLENBQUMsR0FBRyxJQUFJLE9BQU8sR0FBRyxLQUFLLFFBQVEsQ0FBQztRQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUM7SUFDL0MsRUFBRSxDQUFBLENBQUMsR0FBRyxZQUFZLEtBQUssQ0FBQztRQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDNUMsSUFBSSxHQUFHLEdBQUcsRUFBRSxDQUFDO0lBQ2IsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxHQUFHLENBQUM7UUFBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3hDLE1BQU0sQ0FBQyxHQUFHLENBQUM7QUFDYixDQUFDO0FBTmUsWUFBSSxPQU1uQixDQUFBO0FBRUQscUJBQTRCLElBQUksRUFBRSxHQUFHO0lBQ25DLEdBQUcsQ0FBQSxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUksR0FBRyxDQUFDLENBQUMsQ0FBQztRQUNuQixJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3ZCLENBQUM7SUFDRCxNQUFNLENBQUMsSUFBSSxDQUFDO0FBQ2QsQ0FBQztBQUxlLG1CQUFXLGNBSzFCLENBQUE7QUFFRCxtQkFBMEIsSUFBSSxFQUFFLElBQUk7SUFDbEMsRUFBRSxDQUFBLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUNqQixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQztRQUNwQixJQUFJLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDZixDQUFDO0FBQ0gsQ0FBQztBQUxlLGlCQUFTLFlBS3hCLENBQUE7QUFFVSxZQUFJLEdBQUc7SUFDaEIsR0FBRyxFQUFFLEVBQUU7SUFDUCxLQUFLLEVBQUUsRUFBRTtJQUNULEVBQUUsRUFBRSxFQUFFO0lBQ04sSUFBSSxFQUFFLEVBQUU7SUFDUixTQUFTLEVBQUUsQ0FBQztJQUNaLEdBQUcsRUFBRSxHQUFHO0NBQ1QsQ0FBQTtBQUVELHVIQUF1SDtBQUN2SCxpQ0FBd0Msc0JBQXNCO0lBQzVELElBQUksS0FBSyxFQUFDLFNBQVMsQ0FBQztJQUNwQixFQUFFLENBQUEsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQ3hCLENBQUM7UUFDQyxLQUFLLEdBQUcsUUFBUSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUEsZ0VBQWdFO1FBQy9GLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUEsMERBQTBEO1FBQzNHLEtBQUssQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQSx3RkFBd0Y7UUFDOUcsU0FBUyxHQUFHLE1BQU0sQ0FBQyxZQUFZLEVBQUUsQ0FBQyxDQUFBLDJEQUEyRDtRQUM3RixTQUFTLENBQUMsZUFBZSxFQUFFLENBQUMsQ0FBQSxvQ0FBb0M7UUFDaEUsU0FBUyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFBLDREQUE0RDtJQUN4RixDQUFDO0FBQ0gsQ0FBQztBQVhlLCtCQUF1QiwwQkFXdEMsQ0FBQTtBQUVELDREQUE0RDtBQUM1RCxlQUFzQixDQUFDO0lBQ3JCLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsR0FBRyxRQUFRLEVBQUUsQ0FBQyxHQUFHLFFBQVEsQ0FBQztJQUNwRCxNQUFNLENBQUMsY0FBTSxPQUFBLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBdkIsQ0FBdUIsQ0FBQztBQUN2QyxDQUFDO0FBSGUsYUFBSyxRQUdwQixDQUFBO0FBQ0QsMkRBQTJEO0FBQzNELGlCQUF3QixDQUFPLEVBQUUsSUFBa0I7SUFBbEIsb0JBQWtCLEdBQWxCLE9BQU8sSUFBSSxDQUFDLE1BQU07SUFDakQsR0FBRyxDQUFBLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDO1FBQUMsQ0FBQztJQUM5RixNQUFNLENBQUMsQ0FBQyxDQUFDO0FBQ1gsQ0FBQztBQUhlLGVBQU8sVUFHdEIsQ0FBQTtBQUVELHFCQUE0QixLQUFLO0lBQy9CLE1BQU0sQ0FBQyxVQUFDLENBQUMsRUFBRSxDQUFDO2VBQ1YsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEdBQUcsQ0FBQztZQUMzQixDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQzFCLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUM7b0JBQ3pCLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxLQUFLLFNBQVMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7SUFIakMsQ0FHaUMsQ0FBQztBQUN0QyxDQUFDO0FBTmUsbUJBQVcsY0FNMUIsQ0FBQTtBQUNELHNCQUE2QixNQUFTO0lBQ3BDLE1BQU0sQ0FBQyxVQUFDLENBQUMsRUFBRSxDQUFDO2VBQ1YsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEtBQUssTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQztZQUM3QixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQzVCLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUM7b0JBQzNCLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLFNBQVMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7SUFIbEMsQ0FHa0MsQ0FBQztBQUN2QyxDQUFDO0FBTmUsb0JBQVksZUFNM0IsQ0FBQTtBQUVEO0lBQ0UsTUFBTSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN2QyxDQUFDO0FBRmUsZ0JBQVEsV0FFdkIsQ0FBQTs7O0FDalBELFlBQVksQ0FBQTtBQUVaLElBQVksR0FBRyxXQUFNLE9BQU8sQ0FBQyxDQUFBO0FBQzdCLElBQVksU0FBUyxXQUFNLGFBQWEsQ0FBQyxDQUFBO0FBQ3pDLElBQVksRUFBRSxXQUFNLE1BQU0sQ0FBQyxDQUFBO0FBQzNCLHNCQUFpRCxTQUFTLENBQUMsQ0FBQTtBQUczRCxHQUFHLENBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUM7QUFFbEMsb0ZBQW9GO0FBQ3BGLFdBQVc7QUFDWCxJQUFJLElBQUksR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDO0FBRTFCLHNCQUFzQixHQUFHO0lBQ3ZCLEdBQUcsQ0FBQSxDQUFhLFVBQW1CLEVBQW5CLEtBQUEsR0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsRUFBL0IsY0FBUSxFQUFSLElBQStCLENBQUM7UUFBaEMsSUFBSSxJQUFJLFNBQUE7UUFDVixFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxFQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsUUFBUSxFQUFDLENBQUMsQ0FBQztZQUFDLFFBQVEsQ0FBQztLQUM3RDtBQUNILENBQUM7QUFFRCxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRTtJQUNmLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLElBQUksT0FBTyxDQUFDLENBQUM7SUFDOUQsR0FBRyxDQUFDLGNBQWMsR0FBRyxFQUFFLENBQUM7SUFDeEIsWUFBWSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUV0QixNQUFNLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxFQUFDLElBQUksRUFBRSxJQUFJLEVBQUMsRUFBRSxJQUFJLEVBQUUsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN0RSxJQUFJLFFBQVEsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsRUFBQyxJQUFJLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztJQUN4RCxJQUFJLElBQUksR0FBRyxnQkFBVyxFQUFFLENBQUM7SUFDekIsSUFBSSxLQUFzQixJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxFQUFwQyxDQUFDLFVBQUUsSUFBSSxzQkFBRSxHQUFHLG1CQUFHLEVBQUUsS0FBbUIsQ0FBQztJQUMxQyxJQUFJLE9BQU8sR0FBRyxpQkFBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzdCLElBQUksR0FBRyxHQUFHLEdBQUcsQ0FBQyxRQUFRLENBQUMsZUFBZSxFQUFFLEVBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBQyxDQUFDLENBQUM7SUFDakYsRUFBRSxDQUFBLENBQUMsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLEVBQUMsS0FBSyxFQUFFLE9BQU8sRUFBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2hFLEdBQUcsQ0FBQyxRQUFRLENBQUMsY0FBYyxFQUFFLEVBQUMsS0FBSyxFQUFFLE9BQU8sRUFBQyxDQUFDLENBQUM7SUFDakQsQ0FBQztJQUNELEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQztBQUNmLENBQUMsQ0FBQyxDQUFDO0FBRUgsTUFBTSxDQUFDLGdCQUFnQixDQUFDLFlBQVksRUFBRTtJQUNwQyxJQUFJLFFBQVEsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsRUFBQyxJQUFJLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztJQUN4RCxJQUFJLElBQUksR0FBRyxnQkFBVyxFQUFFLENBQUM7SUFDekIsSUFBSSxLQUFzQixJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxFQUFwQyxDQUFDLFVBQUUsSUFBSSxzQkFBRSxHQUFHLG1CQUFHLEVBQUUsS0FBbUIsQ0FBQztJQUMxQyxJQUFJLE9BQU8sR0FBRyxpQkFBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQzdCLElBQUksUUFBUSxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxFQUFDLElBQUksRUFBRSxPQUFPLEVBQUMsQ0FBQyxDQUFDO0lBQzdELEVBQUUsQ0FBQSxDQUFDLFFBQVEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDO1FBQUMsT0FBTyxHQUFHLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFFbkQsRUFBRSxDQUFBLENBQUMsUUFBUSxDQUFDLFFBQVEsS0FBSyxPQUFPLENBQUM7UUFBQyxNQUFNLENBQUM7SUFFekMsSUFBSSxHQUFHLEdBQUcsR0FBRyxDQUFDLFFBQVEsQ0FBQyxlQUFlLEVBQUUsRUFBQyxNQUFNLEVBQUUsUUFBUSxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFDLENBQUMsQ0FBQztJQUNqRixFQUFFLENBQUEsQ0FBQyxPQUFPLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsRUFBQyxLQUFLLEVBQUUsT0FBTyxFQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDaEUsR0FBRyxDQUFDLFFBQVEsQ0FBQyxjQUFjLEVBQUUsRUFBQyxLQUFLLEVBQUUsT0FBTyxFQUFDLENBQUMsQ0FBQztJQUNqRCxDQUFDO0lBQ0QsR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBQ2YsQ0FBQyxDQUFDLENBQUM7OztBQ3BESCxJQUFZLEdBQUcsV0FBTSxZQUFZLENBQUMsQ0FBQTtBQUNsQyxJQUFZLE9BQU8sV0FBTSxnQkFBZ0IsQ0FBQyxDQUFBO0FBQzFDLFFBQU8sYUFBYSxDQUFDLENBQUE7QUFFckIsSUFBSSxHQUFHLEdBQUcsT0FBTyxDQUFDLGtCQUFrQixDQUFDLElBQUksT0FBTyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7QUFDNUQsTUFBTSxDQUFDLEtBQUssQ0FBQyxHQUFHLEdBQUcsQ0FBQztBQUVwQixHQUFHLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRTtJQUN4QixHQUFHLENBQUMsV0FBVyxHQUFHLEVBQUUsQ0FBQztJQUNyQixJQUFJLFFBQVEsR0FBRyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDMUIsUUFBUSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQyxDQUFDO0lBQ2xDLFFBQVEsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLENBQUMsQ0FBQztJQUNsQyxRQUFRLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxDQUFDLENBQUM7SUFDbEMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQyxDQUFDO0lBQ2xDLFFBQVEsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLENBQUMsQ0FBQztJQUNsQyxRQUFRLENBQUMsTUFBTSxDQUFDLFdBQVcsRUFBRSxFQUFDLFFBQVEsRUFBRSxXQUFXLEVBQUMsQ0FBQyxDQUFDO0lBQ3RELEdBQUcsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUM7SUFHeEIsSUFBSSxNQUFNLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQUM7U0FDbEMsTUFBTSxDQUFDLEtBQUssRUFBRSxFQUFFLEVBQUUsS0FBSyxDQUFDO1NBQ3hCLE1BQU0sQ0FBQyxLQUFLLEVBQUUsRUFBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLEVBQUMsRUFBRSxLQUFLLENBQUM7U0FDdkMsT0FBTyxDQUFDLEVBQUMsQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFLEdBQUcsQ0FBQyxFQUFDLENBQUMsQ0FBQztJQUNoQyxJQUFJLEdBQUcsR0FBRyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDckIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUVwQixJQUFJLE1BQU0sR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQztTQUMvQixNQUFNLENBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRSxLQUFLLENBQUM7U0FDeEIsTUFBTSxDQUFDLEtBQUssRUFBRSxFQUFDLENBQUMsRUFBRSxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsRUFBQyxFQUFFLEtBQUssQ0FBQztTQUN2QyxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxHQUFHLENBQUMsQ0FBQyxDQUFDO1NBQ3JCLFNBQVMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxFQUFFLE9BQU8sQ0FBQztTQUMvQixPQUFPLENBQUMsRUFBQyxDQUFDLEVBQUUsQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxFQUFDLENBQUMsQ0FBQztJQUMzRCxJQUFJLElBQUksR0FBRyxNQUFNLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDdkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUVyQixJQUFJLFVBQVUsR0FBRyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDNUIsVUFBVSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ2pELFVBQVUsQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUNsRCxVQUFVLENBQUMsT0FBTyxDQUFDLGVBQWUsRUFBRSxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDakQsVUFBVSxDQUFDLE9BQU8sQ0FBQyxZQUFZLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQy9DLEdBQUcsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUM7SUFFMUIsYUFBYSxPQUFPLEVBQUUsR0FBRztRQUN4QixJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUM7UUFDaEIsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQzFDLEdBQUcsQ0FBQSxDQUFnQixVQUFtQixFQUFuQixLQUFBLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLEVBQWxDLGNBQVcsRUFBWCxJQUFrQyxDQUFDO2dCQUFuQyxJQUFJLE9BQU8sU0FBQTtnQkFDZCxJQUFJLEtBQUssR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxFQUFDLENBQUMsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUMsQ0FBQyxDQUFDO2dCQUMvQyxHQUFHLENBQUEsQ0FBYSxVQUFLLEVBQWpCLGlCQUFRLEVBQVIsSUFBaUIsQ0FBQztvQkFBbEIsSUFBSSxJQUFJLEdBQUksS0FBSyxJQUFUO29CQUNYLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7aUJBQ2xCO2FBQ0Q7UUFDRixDQUFDO1FBQ0QsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQzFDLEdBQUcsQ0FBQSxDQUFlLFVBQW1CLEVBQW5CLEtBQUEsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksRUFBakMsY0FBVSxFQUFWLElBQWlDLENBQUM7Z0JBQWxDLElBQUksTUFBTSxTQUFBO2dCQUNiLE1BQU0sQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDcEI7UUFDRixDQUFDO1FBQ0QsTUFBTSxDQUFDLE1BQU0sQ0FBQTtJQUNkLENBQUM7SUFFRSxJQUFJLElBQUksR0FBRyxNQUFNLENBQUMsb0JBQW9CLENBQUM7SUFDMUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUVsQixPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3RCLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUMsS0FBSyxFQUFFLEVBQUMsSUFBSSxFQUFFLENBQUMsRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBQyxDQUFDLEVBQUMsQ0FBQyxFQUFDLEVBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbEQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBQyxLQUFLLEVBQUUsRUFBQyxJQUFJLEVBQUUsQ0FBQyxFQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLENBQUMsRUFBQyxDQUFDLEVBQUMsRUFBQyxDQUFDLENBQUMsQ0FBQztJQUNsRCxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFDLEtBQUssRUFBRSxFQUFDLElBQUksRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxFQUFFLEtBQUssRUFBRSxFQUFDLElBQUksRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxFQUFDLENBQUMsQ0FBQyxDQUFDO0lBRTdFLEdBQUcsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDbkIsR0FBRyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUVuQixJQUFJLFVBQVUsR0FBRyxFQUFDLEtBQUssRUFBRSxFQUFDLElBQUksRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxFQUFFLEtBQUssRUFBRSxFQUFDLElBQUksRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQyxFQUFDLENBQUMsRUFBQyxFQUFDLENBQUM7SUFDOUUsSUFBSSxPQUFPLEdBQUcsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3pCLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxFQUFFLEVBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFDLENBQUMsQ0FBQztJQUNwQyx1Q0FBdUM7SUFDdkMsdUNBQXVDO0lBQ3ZDLEdBQUcsQ0FBQyxvQkFBb0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUVsQyxpQ0FBaUM7SUFDakMsZ0ZBQWdGO0lBQ2hGLDRCQUE0QjtJQUM3QixpRkFBaUY7SUFDaEYsNkJBQTZCO0lBRWhDLElBQUksY0FBYyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsaUJBQWlCLENBQUM7U0FDMUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxFQUFFLEVBQUUsUUFBUSxDQUFDO1NBQzlCLE1BQU0sQ0FBQyxVQUFVLEVBQUUsRUFBQyxRQUFRLEVBQUUsQ0FBQyxRQUFRLEVBQUUsT0FBTyxDQUFDLEVBQUMsRUFBRSxVQUFVLENBQUM7U0FDL0QsT0FBTyxDQUFDLEVBQUMsUUFBUSxFQUFFLENBQUMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLFVBQVUsRUFBRSxPQUFPLENBQUMsRUFBQyxDQUFDLENBQUM7SUFDNUUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQztJQUU5QixJQUFJLGFBQWEsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQztTQUNoQyxLQUFLLENBQUMsUUFBUSxFQUFFLEVBQUMsUUFBUSxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsT0FBTyxDQUFDLEVBQUMsQ0FBQztTQUN6RCxLQUFLLENBQUMsaUJBQWlCLEVBQUUsRUFBQyxRQUFRLEVBQUUsQ0FBQyxVQUFVLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxPQUFPLENBQUMsRUFBQyxDQUFDLENBQUM7SUFDM0UsR0FBRyxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUM3QixJQUFJLE9BQU8sR0FBRyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDekIsT0FBTyxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxFQUFDLE1BQU0sRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBQyxFQUFFLEVBQUMsTUFBTSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2xGLEdBQUcsQ0FBQyxvQkFBb0IsQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUVuQyxDQUFDLENBQUMsQ0FBQzs7O0FDbEdIOztBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvLyBDb2RlTWlycm9yLCBjb3B5cmlnaHQgKGMpIGJ5IE1hcmlqbiBIYXZlcmJla2UgYW5kIG90aGVyc1xuLy8gRGlzdHJpYnV0ZWQgdW5kZXIgYW4gTUlUIGxpY2Vuc2U6IGh0dHA6Ly9jb2RlbWlycm9yLm5ldC9MSUNFTlNFXG5cbi8vIFV0aWxpdHkgZnVuY3Rpb24gdGhhdCBhbGxvd3MgbW9kZXMgdG8gYmUgY29tYmluZWQuIFRoZSBtb2RlIGdpdmVuXG4vLyBhcyB0aGUgYmFzZSBhcmd1bWVudCB0YWtlcyBjYXJlIG9mIG1vc3Qgb2YgdGhlIG5vcm1hbCBtb2RlXG4vLyBmdW5jdGlvbmFsaXR5LCBidXQgYSBzZWNvbmQgKHR5cGljYWxseSBzaW1wbGUpIG1vZGUgaXMgdXNlZCwgd2hpY2hcbi8vIGNhbiBvdmVycmlkZSB0aGUgc3R5bGUgb2YgdGV4dC4gQm90aCBtb2RlcyBnZXQgdG8gcGFyc2UgYWxsIG9mIHRoZVxuLy8gdGV4dCwgYnV0IHdoZW4gYm90aCBhc3NpZ24gYSBub24tbnVsbCBzdHlsZSB0byBhIHBpZWNlIG9mIGNvZGUsIHRoZVxuLy8gb3ZlcmxheSB3aW5zLCB1bmxlc3MgdGhlIGNvbWJpbmUgYXJndW1lbnQgd2FzIHRydWUgYW5kIG5vdCBvdmVycmlkZGVuLFxuLy8gb3Igc3RhdGUub3ZlcmxheS5jb21iaW5lVG9rZW5zIHdhcyB0cnVlLCBpbiB3aGljaCBjYXNlIHRoZSBzdHlsZXMgYXJlXG4vLyBjb21iaW5lZC5cblxuKGZ1bmN0aW9uKG1vZCkge1xuICBpZiAodHlwZW9mIGV4cG9ydHMgPT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgbW9kdWxlID09IFwib2JqZWN0XCIpIC8vIENvbW1vbkpTXG4gICAgbW9kKHJlcXVpcmUoXCIuLi8uLi9saWIvY29kZW1pcnJvclwiKSk7XG4gIGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQpIC8vIEFNRFxuICAgIGRlZmluZShbXCIuLi8uLi9saWIvY29kZW1pcnJvclwiXSwgbW9kKTtcbiAgZWxzZSAvLyBQbGFpbiBicm93c2VyIGVudlxuICAgIG1vZChDb2RlTWlycm9yKTtcbn0pKGZ1bmN0aW9uKENvZGVNaXJyb3IpIHtcblwidXNlIHN0cmljdFwiO1xuXG5Db2RlTWlycm9yLm92ZXJsYXlNb2RlID0gZnVuY3Rpb24oYmFzZSwgb3ZlcmxheSwgY29tYmluZSkge1xuICByZXR1cm4ge1xuICAgIHN0YXJ0U3RhdGU6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYmFzZTogQ29kZU1pcnJvci5zdGFydFN0YXRlKGJhc2UpLFxuICAgICAgICBvdmVybGF5OiBDb2RlTWlycm9yLnN0YXJ0U3RhdGUob3ZlcmxheSksXG4gICAgICAgIGJhc2VQb3M6IDAsIGJhc2VDdXI6IG51bGwsXG4gICAgICAgIG92ZXJsYXlQb3M6IDAsIG92ZXJsYXlDdXI6IG51bGwsXG4gICAgICAgIHN0cmVhbVNlZW46IG51bGxcbiAgICAgIH07XG4gICAgfSxcbiAgICBjb3B5U3RhdGU6IGZ1bmN0aW9uKHN0YXRlKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBiYXNlOiBDb2RlTWlycm9yLmNvcHlTdGF0ZShiYXNlLCBzdGF0ZS5iYXNlKSxcbiAgICAgICAgb3ZlcmxheTogQ29kZU1pcnJvci5jb3B5U3RhdGUob3ZlcmxheSwgc3RhdGUub3ZlcmxheSksXG4gICAgICAgIGJhc2VQb3M6IHN0YXRlLmJhc2VQb3MsIGJhc2VDdXI6IG51bGwsXG4gICAgICAgIG92ZXJsYXlQb3M6IHN0YXRlLm92ZXJsYXlQb3MsIG92ZXJsYXlDdXI6IG51bGxcbiAgICAgIH07XG4gICAgfSxcblxuICAgIHRva2VuOiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7XG4gICAgICBpZiAoc3RyZWFtICE9IHN0YXRlLnN0cmVhbVNlZW4gfHxcbiAgICAgICAgICBNYXRoLm1pbihzdGF0ZS5iYXNlUG9zLCBzdGF0ZS5vdmVybGF5UG9zKSA8IHN0cmVhbS5zdGFydCkge1xuICAgICAgICBzdGF0ZS5zdHJlYW1TZWVuID0gc3RyZWFtO1xuICAgICAgICBzdGF0ZS5iYXNlUG9zID0gc3RhdGUub3ZlcmxheVBvcyA9IHN0cmVhbS5zdGFydDtcbiAgICAgIH1cblxuICAgICAgaWYgKHN0cmVhbS5zdGFydCA9PSBzdGF0ZS5iYXNlUG9zKSB7XG4gICAgICAgIHN0YXRlLmJhc2VDdXIgPSBiYXNlLnRva2VuKHN0cmVhbSwgc3RhdGUuYmFzZSk7XG4gICAgICAgIHN0YXRlLmJhc2VQb3MgPSBzdHJlYW0ucG9zO1xuICAgICAgfVxuICAgICAgaWYgKHN0cmVhbS5zdGFydCA9PSBzdGF0ZS5vdmVybGF5UG9zKSB7XG4gICAgICAgIHN0cmVhbS5wb3MgPSBzdHJlYW0uc3RhcnQ7XG4gICAgICAgIHN0YXRlLm92ZXJsYXlDdXIgPSBvdmVybGF5LnRva2VuKHN0cmVhbSwgc3RhdGUub3ZlcmxheSk7XG4gICAgICAgIHN0YXRlLm92ZXJsYXlQb3MgPSBzdHJlYW0ucG9zO1xuICAgICAgfVxuICAgICAgc3RyZWFtLnBvcyA9IE1hdGgubWluKHN0YXRlLmJhc2VQb3MsIHN0YXRlLm92ZXJsYXlQb3MpO1xuXG4gICAgICAvLyBzdGF0ZS5vdmVybGF5LmNvbWJpbmVUb2tlbnMgYWx3YXlzIHRha2VzIHByZWNlZGVuY2Ugb3ZlciBjb21iaW5lLFxuICAgICAgLy8gdW5sZXNzIHNldCB0byBudWxsXG4gICAgICBpZiAoc3RhdGUub3ZlcmxheUN1ciA9PSBudWxsKSByZXR1cm4gc3RhdGUuYmFzZUN1cjtcbiAgICAgIGVsc2UgaWYgKHN0YXRlLmJhc2VDdXIgIT0gbnVsbCAmJlxuICAgICAgICAgICAgICAgc3RhdGUub3ZlcmxheS5jb21iaW5lVG9rZW5zIHx8XG4gICAgICAgICAgICAgICBjb21iaW5lICYmIHN0YXRlLm92ZXJsYXkuY29tYmluZVRva2VucyA9PSBudWxsKVxuICAgICAgICByZXR1cm4gc3RhdGUuYmFzZUN1ciArIFwiIFwiICsgc3RhdGUub3ZlcmxheUN1cjtcbiAgICAgIGVsc2UgcmV0dXJuIHN0YXRlLm92ZXJsYXlDdXI7XG4gICAgfSxcblxuICAgIGluZGVudDogYmFzZS5pbmRlbnQgJiYgZnVuY3Rpb24oc3RhdGUsIHRleHRBZnRlcikge1xuICAgICAgcmV0dXJuIGJhc2UuaW5kZW50KHN0YXRlLmJhc2UsIHRleHRBZnRlcik7XG4gICAgfSxcbiAgICBlbGVjdHJpY0NoYXJzOiBiYXNlLmVsZWN0cmljQ2hhcnMsXG5cbiAgICBpbm5lck1vZGU6IGZ1bmN0aW9uKHN0YXRlKSB7IHJldHVybiB7c3RhdGU6IHN0YXRlLmJhc2UsIG1vZGU6IGJhc2V9OyB9LFxuXG4gICAgYmxhbmtMaW5lOiBmdW5jdGlvbihzdGF0ZSkge1xuICAgICAgaWYgKGJhc2UuYmxhbmtMaW5lKSBiYXNlLmJsYW5rTGluZShzdGF0ZS5iYXNlKTtcbiAgICAgIGlmIChvdmVybGF5LmJsYW5rTGluZSkgb3ZlcmxheS5ibGFua0xpbmUoc3RhdGUub3ZlcmxheSk7XG4gICAgfVxuICB9O1xufTtcblxufSk7XG4iLCIvLyBDb2RlTWlycm9yLCBjb3B5cmlnaHQgKGMpIGJ5IE1hcmlqbiBIYXZlcmJla2UgYW5kIG90aGVyc1xuLy8gRGlzdHJpYnV0ZWQgdW5kZXIgYW4gTUlUIGxpY2Vuc2U6IGh0dHA6Ly9jb2RlbWlycm9yLm5ldC9MSUNFTlNFXG5cbi8vIFRoaXMgaXMgQ29kZU1pcnJvciAoaHR0cDovL2NvZGVtaXJyb3IubmV0KSwgYSBjb2RlIGVkaXRvclxuLy8gaW1wbGVtZW50ZWQgaW4gSmF2YVNjcmlwdCBvbiB0b3Agb2YgdGhlIGJyb3dzZXIncyBET00uXG4vL1xuLy8gWW91IGNhbiBmaW5kIHNvbWUgdGVjaG5pY2FsIGJhY2tncm91bmQgZm9yIHNvbWUgb2YgdGhlIGNvZGUgYmVsb3dcbi8vIGF0IGh0dHA6Ly9tYXJpam5oYXZlcmJla2UubmwvYmxvZy8jY20taW50ZXJuYWxzIC5cblxuKGZ1bmN0aW9uKG1vZCkge1xuICBpZiAodHlwZW9mIGV4cG9ydHMgPT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgbW9kdWxlID09IFwib2JqZWN0XCIpIC8vIENvbW1vbkpTXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBtb2QoKTtcbiAgZWxzZSBpZiAodHlwZW9mIGRlZmluZSA9PSBcImZ1bmN0aW9uXCIgJiYgZGVmaW5lLmFtZCkgLy8gQU1EXG4gICAgcmV0dXJuIGRlZmluZShbXSwgbW9kKTtcbiAgZWxzZSAvLyBQbGFpbiBicm93c2VyIGVudlxuICAgIHRoaXMuQ29kZU1pcnJvciA9IG1vZCgpO1xufSkoZnVuY3Rpb24oKSB7XG4gIFwidXNlIHN0cmljdFwiO1xuXG4gIC8vIEJST1dTRVIgU05JRkZJTkdcblxuICAvLyBLbHVkZ2VzIGZvciBidWdzIGFuZCBiZWhhdmlvciBkaWZmZXJlbmNlcyB0aGF0IGNhbid0IGJlIGZlYXR1cmVcbiAgLy8gZGV0ZWN0ZWQgYXJlIGVuYWJsZWQgYmFzZWQgb24gdXNlckFnZW50IGV0YyBzbmlmZmluZy5cbiAgdmFyIHVzZXJBZ2VudCA9IG5hdmlnYXRvci51c2VyQWdlbnQ7XG4gIHZhciBwbGF0Zm9ybSA9IG5hdmlnYXRvci5wbGF0Zm9ybTtcblxuICB2YXIgZ2Vja28gPSAvZ2Vja29cXC9cXGQvaS50ZXN0KHVzZXJBZ2VudCk7XG4gIHZhciBpZV91cHRvMTAgPSAvTVNJRSBcXGQvLnRlc3QodXNlckFnZW50KTtcbiAgdmFyIGllXzExdXAgPSAvVHJpZGVudFxcLyg/Ols3LTldfFxcZHsyLH0pXFwuLipydjooXFxkKykvLmV4ZWModXNlckFnZW50KTtcbiAgdmFyIGllID0gaWVfdXB0bzEwIHx8IGllXzExdXA7XG4gIHZhciBpZV92ZXJzaW9uID0gaWUgJiYgKGllX3VwdG8xMCA/IGRvY3VtZW50LmRvY3VtZW50TW9kZSB8fCA2IDogaWVfMTF1cFsxXSk7XG4gIHZhciB3ZWJraXQgPSAvV2ViS2l0XFwvLy50ZXN0KHVzZXJBZ2VudCk7XG4gIHZhciBxdHdlYmtpdCA9IHdlYmtpdCAmJiAvUXRcXC9cXGQrXFwuXFxkKy8udGVzdCh1c2VyQWdlbnQpO1xuICB2YXIgY2hyb21lID0gL0Nocm9tZVxcLy8udGVzdCh1c2VyQWdlbnQpO1xuICB2YXIgcHJlc3RvID0gL09wZXJhXFwvLy50ZXN0KHVzZXJBZ2VudCk7XG4gIHZhciBzYWZhcmkgPSAvQXBwbGUgQ29tcHV0ZXIvLnRlc3QobmF2aWdhdG9yLnZlbmRvcik7XG4gIHZhciBtYWNfZ2VNb3VudGFpbkxpb24gPSAvTWFjIE9TIFggMVxcZFxcRChbOC05XXxcXGRcXGQpXFxELy50ZXN0KHVzZXJBZ2VudCk7XG4gIHZhciBwaGFudG9tID0gL1BoYW50b21KUy8udGVzdCh1c2VyQWdlbnQpO1xuXG4gIHZhciBpb3MgPSAvQXBwbGVXZWJLaXQvLnRlc3QodXNlckFnZW50KSAmJiAvTW9iaWxlXFwvXFx3Ky8udGVzdCh1c2VyQWdlbnQpO1xuICAvLyBUaGlzIGlzIHdvZWZ1bGx5IGluY29tcGxldGUuIFN1Z2dlc3Rpb25zIGZvciBhbHRlcm5hdGl2ZSBtZXRob2RzIHdlbGNvbWUuXG4gIHZhciBtb2JpbGUgPSBpb3MgfHwgL0FuZHJvaWR8d2ViT1N8QmxhY2tCZXJyeXxPcGVyYSBNaW5pfE9wZXJhIE1vYml8SUVNb2JpbGUvaS50ZXN0KHVzZXJBZ2VudCk7XG4gIHZhciBtYWMgPSBpb3MgfHwgL01hYy8udGVzdChwbGF0Zm9ybSk7XG4gIHZhciB3aW5kb3dzID0gL3dpbi9pLnRlc3QocGxhdGZvcm0pO1xuXG4gIHZhciBwcmVzdG9fdmVyc2lvbiA9IHByZXN0byAmJiB1c2VyQWdlbnQubWF0Y2goL1ZlcnNpb25cXC8oXFxkKlxcLlxcZCopLyk7XG4gIGlmIChwcmVzdG9fdmVyc2lvbikgcHJlc3RvX3ZlcnNpb24gPSBOdW1iZXIocHJlc3RvX3ZlcnNpb25bMV0pO1xuICBpZiAocHJlc3RvX3ZlcnNpb24gJiYgcHJlc3RvX3ZlcnNpb24gPj0gMTUpIHsgcHJlc3RvID0gZmFsc2U7IHdlYmtpdCA9IHRydWU7IH1cbiAgLy8gU29tZSBicm93c2VycyB1c2UgdGhlIHdyb25nIGV2ZW50IHByb3BlcnRpZXMgdG8gc2lnbmFsIGNtZC9jdHJsIG9uIE9TIFhcbiAgdmFyIGZsaXBDdHJsQ21kID0gbWFjICYmIChxdHdlYmtpdCB8fCBwcmVzdG8gJiYgKHByZXN0b192ZXJzaW9uID09IG51bGwgfHwgcHJlc3RvX3ZlcnNpb24gPCAxMi4xMSkpO1xuICB2YXIgY2FwdHVyZVJpZ2h0Q2xpY2sgPSBnZWNrbyB8fCAoaWUgJiYgaWVfdmVyc2lvbiA+PSA5KTtcblxuICAvLyBPcHRpbWl6ZSBzb21lIGNvZGUgd2hlbiB0aGVzZSBmZWF0dXJlcyBhcmUgbm90IHVzZWQuXG4gIHZhciBzYXdSZWFkT25seVNwYW5zID0gZmFsc2UsIHNhd0NvbGxhcHNlZFNwYW5zID0gZmFsc2U7XG5cbiAgLy8gRURJVE9SIENPTlNUUlVDVE9SXG5cbiAgLy8gQSBDb2RlTWlycm9yIGluc3RhbmNlIHJlcHJlc2VudHMgYW4gZWRpdG9yLiBUaGlzIGlzIHRoZSBvYmplY3RcbiAgLy8gdGhhdCB1c2VyIGNvZGUgaXMgdXN1YWxseSBkZWFsaW5nIHdpdGguXG5cbiAgZnVuY3Rpb24gQ29kZU1pcnJvcihwbGFjZSwgb3B0aW9ucykge1xuICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBDb2RlTWlycm9yKSkgcmV0dXJuIG5ldyBDb2RlTWlycm9yKHBsYWNlLCBvcHRpb25zKTtcblxuICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnMgPSBvcHRpb25zID8gY29weU9iaihvcHRpb25zKSA6IHt9O1xuICAgIC8vIERldGVybWluZSBlZmZlY3RpdmUgb3B0aW9ucyBiYXNlZCBvbiBnaXZlbiB2YWx1ZXMgYW5kIGRlZmF1bHRzLlxuICAgIGNvcHlPYmooZGVmYXVsdHMsIG9wdGlvbnMsIGZhbHNlKTtcbiAgICBzZXRHdXR0ZXJzRm9yTGluZU51bWJlcnMob3B0aW9ucyk7XG5cbiAgICB2YXIgZG9jID0gb3B0aW9ucy52YWx1ZTtcbiAgICBpZiAodHlwZW9mIGRvYyA9PSBcInN0cmluZ1wiKSBkb2MgPSBuZXcgRG9jKGRvYywgb3B0aW9ucy5tb2RlLCBudWxsLCBvcHRpb25zLmxpbmVTZXBhcmF0b3IpO1xuICAgIHRoaXMuZG9jID0gZG9jO1xuXG4gICAgdmFyIGlucHV0ID0gbmV3IENvZGVNaXJyb3IuaW5wdXRTdHlsZXNbb3B0aW9ucy5pbnB1dFN0eWxlXSh0aGlzKTtcbiAgICB2YXIgZGlzcGxheSA9IHRoaXMuZGlzcGxheSA9IG5ldyBEaXNwbGF5KHBsYWNlLCBkb2MsIGlucHV0KTtcbiAgICBkaXNwbGF5LndyYXBwZXIuQ29kZU1pcnJvciA9IHRoaXM7XG4gICAgdXBkYXRlR3V0dGVycyh0aGlzKTtcbiAgICB0aGVtZUNoYW5nZWQodGhpcyk7XG4gICAgaWYgKG9wdGlvbnMubGluZVdyYXBwaW5nKVxuICAgICAgdGhpcy5kaXNwbGF5LndyYXBwZXIuY2xhc3NOYW1lICs9IFwiIENvZGVNaXJyb3Itd3JhcFwiO1xuICAgIGlmIChvcHRpb25zLmF1dG9mb2N1cyAmJiAhbW9iaWxlKSBkaXNwbGF5LmlucHV0LmZvY3VzKCk7XG4gICAgaW5pdFNjcm9sbGJhcnModGhpcyk7XG5cbiAgICB0aGlzLnN0YXRlID0ge1xuICAgICAga2V5TWFwczogW10sICAvLyBzdG9yZXMgbWFwcyBhZGRlZCBieSBhZGRLZXlNYXBcbiAgICAgIG92ZXJsYXlzOiBbXSwgLy8gaGlnaGxpZ2h0aW5nIG92ZXJsYXlzLCBhcyBhZGRlZCBieSBhZGRPdmVybGF5XG4gICAgICBtb2RlR2VuOiAwLCAgIC8vIGJ1bXBlZCB3aGVuIG1vZGUvb3ZlcmxheSBjaGFuZ2VzLCB1c2VkIHRvIGludmFsaWRhdGUgaGlnaGxpZ2h0aW5nIGluZm9cbiAgICAgIG92ZXJ3cml0ZTogZmFsc2UsXG4gICAgICBkZWxheWluZ0JsdXJFdmVudDogZmFsc2UsXG4gICAgICBmb2N1c2VkOiBmYWxzZSxcbiAgICAgIHN1cHByZXNzRWRpdHM6IGZhbHNlLCAvLyB1c2VkIHRvIGRpc2FibGUgZWRpdGluZyBkdXJpbmcga2V5IGhhbmRsZXJzIHdoZW4gaW4gcmVhZE9ubHkgbW9kZVxuICAgICAgcGFzdGVJbmNvbWluZzogZmFsc2UsIGN1dEluY29taW5nOiBmYWxzZSwgLy8gaGVscCByZWNvZ25pemUgcGFzdGUvY3V0IGVkaXRzIGluIGlucHV0LnBvbGxcbiAgICAgIHNlbGVjdGluZ1RleHQ6IGZhbHNlLFxuICAgICAgZHJhZ2dpbmdUZXh0OiBmYWxzZSxcbiAgICAgIGhpZ2hsaWdodDogbmV3IERlbGF5ZWQoKSwgLy8gc3RvcmVzIGhpZ2hsaWdodCB3b3JrZXIgdGltZW91dFxuICAgICAga2V5U2VxOiBudWxsLCAgLy8gVW5maW5pc2hlZCBrZXkgc2VxdWVuY2VcbiAgICAgIHNwZWNpYWxDaGFyczogbnVsbFxuICAgIH07XG5cbiAgICB2YXIgY20gPSB0aGlzO1xuXG4gICAgLy8gT3ZlcnJpZGUgbWFnaWMgdGV4dGFyZWEgY29udGVudCByZXN0b3JlIHRoYXQgSUUgc29tZXRpbWVzIGRvZXNcbiAgICAvLyBvbiBvdXIgaGlkZGVuIHRleHRhcmVhIG9uIHJlbG9hZFxuICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uIDwgMTEpIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IGNtLmRpc3BsYXkuaW5wdXQucmVzZXQodHJ1ZSk7IH0sIDIwKTtcblxuICAgIHJlZ2lzdGVyRXZlbnRIYW5kbGVycyh0aGlzKTtcbiAgICBlbnN1cmVHbG9iYWxIYW5kbGVycygpO1xuXG4gICAgc3RhcnRPcGVyYXRpb24odGhpcyk7XG4gICAgdGhpcy5jdXJPcC5mb3JjZVVwZGF0ZSA9IHRydWU7XG4gICAgYXR0YWNoRG9jKHRoaXMsIGRvYyk7XG5cbiAgICBpZiAoKG9wdGlvbnMuYXV0b2ZvY3VzICYmICFtb2JpbGUpIHx8IGNtLmhhc0ZvY3VzKCkpXG4gICAgICBzZXRUaW1lb3V0KGJpbmQob25Gb2N1cywgdGhpcyksIDIwKTtcbiAgICBlbHNlXG4gICAgICBvbkJsdXIodGhpcyk7XG5cbiAgICBmb3IgKHZhciBvcHQgaW4gb3B0aW9uSGFuZGxlcnMpIGlmIChvcHRpb25IYW5kbGVycy5oYXNPd25Qcm9wZXJ0eShvcHQpKVxuICAgICAgb3B0aW9uSGFuZGxlcnNbb3B0XSh0aGlzLCBvcHRpb25zW29wdF0sIEluaXQpO1xuICAgIG1heWJlVXBkYXRlTGluZU51bWJlcldpZHRoKHRoaXMpO1xuICAgIGlmIChvcHRpb25zLmZpbmlzaEluaXQpIG9wdGlvbnMuZmluaXNoSW5pdCh0aGlzKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGluaXRIb29rcy5sZW5ndGg7ICsraSkgaW5pdEhvb2tzW2ldKHRoaXMpO1xuICAgIGVuZE9wZXJhdGlvbih0aGlzKTtcbiAgICAvLyBTdXBwcmVzcyBvcHRpbWl6ZWxlZ2liaWxpdHkgaW4gV2Via2l0LCBzaW5jZSBpdCBicmVha3MgdGV4dFxuICAgIC8vIG1lYXN1cmluZyBvbiBsaW5lIHdyYXBwaW5nIGJvdW5kYXJpZXMuXG4gICAgaWYgKHdlYmtpdCAmJiBvcHRpb25zLmxpbmVXcmFwcGluZyAmJlxuICAgICAgICBnZXRDb21wdXRlZFN0eWxlKGRpc3BsYXkubGluZURpdikudGV4dFJlbmRlcmluZyA9PSBcIm9wdGltaXplbGVnaWJpbGl0eVwiKVxuICAgICAgZGlzcGxheS5saW5lRGl2LnN0eWxlLnRleHRSZW5kZXJpbmcgPSBcImF1dG9cIjtcbiAgfVxuXG4gIC8vIERJU1BMQVkgQ09OU1RSVUNUT1JcblxuICAvLyBUaGUgZGlzcGxheSBoYW5kbGVzIHRoZSBET00gaW50ZWdyYXRpb24sIGJvdGggZm9yIGlucHV0IHJlYWRpbmdcbiAgLy8gYW5kIGNvbnRlbnQgZHJhd2luZy4gSXQgaG9sZHMgcmVmZXJlbmNlcyB0byBET00gbm9kZXMgYW5kXG4gIC8vIGRpc3BsYXktcmVsYXRlZCBzdGF0ZS5cblxuICBmdW5jdGlvbiBEaXNwbGF5KHBsYWNlLCBkb2MsIGlucHV0KSB7XG4gICAgdmFyIGQgPSB0aGlzO1xuICAgIHRoaXMuaW5wdXQgPSBpbnB1dDtcblxuICAgIC8vIENvdmVycyBib3R0b20tcmlnaHQgc3F1YXJlIHdoZW4gYm90aCBzY3JvbGxiYXJzIGFyZSBwcmVzZW50LlxuICAgIGQuc2Nyb2xsYmFyRmlsbGVyID0gZWx0KFwiZGl2XCIsIG51bGwsIFwiQ29kZU1pcnJvci1zY3JvbGxiYXItZmlsbGVyXCIpO1xuICAgIGQuc2Nyb2xsYmFyRmlsbGVyLnNldEF0dHJpYnV0ZShcImNtLW5vdC1jb250ZW50XCIsIFwidHJ1ZVwiKTtcbiAgICAvLyBDb3ZlcnMgYm90dG9tIG9mIGd1dHRlciB3aGVuIGNvdmVyR3V0dGVyTmV4dFRvU2Nyb2xsYmFyIGlzIG9uXG4gICAgLy8gYW5kIGggc2Nyb2xsYmFyIGlzIHByZXNlbnQuXG4gICAgZC5ndXR0ZXJGaWxsZXIgPSBlbHQoXCJkaXZcIiwgbnVsbCwgXCJDb2RlTWlycm9yLWd1dHRlci1maWxsZXJcIik7XG4gICAgZC5ndXR0ZXJGaWxsZXIuc2V0QXR0cmlidXRlKFwiY20tbm90LWNvbnRlbnRcIiwgXCJ0cnVlXCIpO1xuICAgIC8vIFdpbGwgY29udGFpbiB0aGUgYWN0dWFsIGNvZGUsIHBvc2l0aW9uZWQgdG8gY292ZXIgdGhlIHZpZXdwb3J0LlxuICAgIGQubGluZURpdiA9IGVsdChcImRpdlwiLCBudWxsLCBcIkNvZGVNaXJyb3ItY29kZVwiKTtcbiAgICAvLyBFbGVtZW50cyBhcmUgYWRkZWQgdG8gdGhlc2UgdG8gcmVwcmVzZW50IHNlbGVjdGlvbiBhbmQgY3Vyc29ycy5cbiAgICBkLnNlbGVjdGlvbkRpdiA9IGVsdChcImRpdlwiLCBudWxsLCBudWxsLCBcInBvc2l0aW9uOiByZWxhdGl2ZTsgei1pbmRleDogMVwiKTtcbiAgICBkLmN1cnNvckRpdiA9IGVsdChcImRpdlwiLCBudWxsLCBcIkNvZGVNaXJyb3ItY3Vyc29yc1wiKTtcbiAgICAvLyBBIHZpc2liaWxpdHk6IGhpZGRlbiBlbGVtZW50IHVzZWQgdG8gZmluZCB0aGUgc2l6ZSBvZiB0aGluZ3MuXG4gICAgZC5tZWFzdXJlID0gZWx0KFwiZGl2XCIsIG51bGwsIFwiQ29kZU1pcnJvci1tZWFzdXJlXCIpO1xuICAgIC8vIFdoZW4gbGluZXMgb3V0c2lkZSBvZiB0aGUgdmlld3BvcnQgYXJlIG1lYXN1cmVkLCB0aGV5IGFyZSBkcmF3biBpbiB0aGlzLlxuICAgIGQubGluZU1lYXN1cmUgPSBlbHQoXCJkaXZcIiwgbnVsbCwgXCJDb2RlTWlycm9yLW1lYXN1cmVcIik7XG4gICAgLy8gV3JhcHMgZXZlcnl0aGluZyB0aGF0IG5lZWRzIHRvIGV4aXN0IGluc2lkZSB0aGUgdmVydGljYWxseS1wYWRkZWQgY29vcmRpbmF0ZSBzeXN0ZW1cbiAgICBkLmxpbmVTcGFjZSA9IGVsdChcImRpdlwiLCBbZC5tZWFzdXJlLCBkLmxpbmVNZWFzdXJlLCBkLnNlbGVjdGlvbkRpdiwgZC5jdXJzb3JEaXYsIGQubGluZURpdl0sXG4gICAgICAgICAgICAgICAgICAgICAgbnVsbCwgXCJwb3NpdGlvbjogcmVsYXRpdmU7IG91dGxpbmU6IG5vbmVcIik7XG4gICAgLy8gTW92ZWQgYXJvdW5kIGl0cyBwYXJlbnQgdG8gY292ZXIgdmlzaWJsZSB2aWV3LlxuICAgIGQubW92ZXIgPSBlbHQoXCJkaXZcIiwgW2VsdChcImRpdlwiLCBbZC5saW5lU3BhY2VdLCBcIkNvZGVNaXJyb3ItbGluZXNcIildLCBudWxsLCBcInBvc2l0aW9uOiByZWxhdGl2ZVwiKTtcbiAgICAvLyBTZXQgdG8gdGhlIGhlaWdodCBvZiB0aGUgZG9jdW1lbnQsIGFsbG93aW5nIHNjcm9sbGluZy5cbiAgICBkLnNpemVyID0gZWx0KFwiZGl2XCIsIFtkLm1vdmVyXSwgXCJDb2RlTWlycm9yLXNpemVyXCIpO1xuICAgIGQuc2l6ZXJXaWR0aCA9IG51bGw7XG4gICAgLy8gQmVoYXZpb3Igb2YgZWx0cyB3aXRoIG92ZXJmbG93OiBhdXRvIGFuZCBwYWRkaW5nIGlzXG4gICAgLy8gaW5jb25zaXN0ZW50IGFjcm9zcyBicm93c2Vycy4gVGhpcyBpcyB1c2VkIHRvIGVuc3VyZSB0aGVcbiAgICAvLyBzY3JvbGxhYmxlIGFyZWEgaXMgYmlnIGVub3VnaC5cbiAgICBkLmhlaWdodEZvcmNlciA9IGVsdChcImRpdlwiLCBudWxsLCBudWxsLCBcInBvc2l0aW9uOiBhYnNvbHV0ZTsgaGVpZ2h0OiBcIiArIHNjcm9sbGVyR2FwICsgXCJweDsgd2lkdGg6IDFweDtcIik7XG4gICAgLy8gV2lsbCBjb250YWluIHRoZSBndXR0ZXJzLCBpZiBhbnkuXG4gICAgZC5ndXR0ZXJzID0gZWx0KFwiZGl2XCIsIG51bGwsIFwiQ29kZU1pcnJvci1ndXR0ZXJzXCIpO1xuICAgIGQubGluZUd1dHRlciA9IG51bGw7XG4gICAgLy8gQWN0dWFsIHNjcm9sbGFibGUgZWxlbWVudC5cbiAgICBkLnNjcm9sbGVyID0gZWx0KFwiZGl2XCIsIFtkLnNpemVyLCBkLmhlaWdodEZvcmNlciwgZC5ndXR0ZXJzXSwgXCJDb2RlTWlycm9yLXNjcm9sbFwiKTtcbiAgICBkLnNjcm9sbGVyLnNldEF0dHJpYnV0ZShcInRhYkluZGV4XCIsIFwiLTFcIik7XG4gICAgLy8gVGhlIGVsZW1lbnQgaW4gd2hpY2ggdGhlIGVkaXRvciBsaXZlcy5cbiAgICBkLndyYXBwZXIgPSBlbHQoXCJkaXZcIiwgW2Quc2Nyb2xsYmFyRmlsbGVyLCBkLmd1dHRlckZpbGxlciwgZC5zY3JvbGxlcl0sIFwiQ29kZU1pcnJvclwiKTtcblxuICAgIC8vIFdvcmsgYXJvdW5kIElFNyB6LWluZGV4IGJ1ZyAobm90IHBlcmZlY3QsIGhlbmNlIElFNyBub3QgcmVhbGx5IGJlaW5nIHN1cHBvcnRlZClcbiAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDgpIHsgZC5ndXR0ZXJzLnN0eWxlLnpJbmRleCA9IC0xOyBkLnNjcm9sbGVyLnN0eWxlLnBhZGRpbmdSaWdodCA9IDA7IH1cbiAgICBpZiAoIXdlYmtpdCAmJiAhKGdlY2tvICYmIG1vYmlsZSkpIGQuc2Nyb2xsZXIuZHJhZ2dhYmxlID0gdHJ1ZTtcblxuICAgIGlmIChwbGFjZSkge1xuICAgICAgaWYgKHBsYWNlLmFwcGVuZENoaWxkKSBwbGFjZS5hcHBlbmRDaGlsZChkLndyYXBwZXIpO1xuICAgICAgZWxzZSBwbGFjZShkLndyYXBwZXIpO1xuICAgIH1cblxuICAgIC8vIEN1cnJlbnQgcmVuZGVyZWQgcmFuZ2UgKG1heSBiZSBiaWdnZXIgdGhhbiB0aGUgdmlldyB3aW5kb3cpLlxuICAgIGQudmlld0Zyb20gPSBkLnZpZXdUbyA9IGRvYy5maXJzdDtcbiAgICBkLnJlcG9ydGVkVmlld0Zyb20gPSBkLnJlcG9ydGVkVmlld1RvID0gZG9jLmZpcnN0O1xuICAgIC8vIEluZm9ybWF0aW9uIGFib3V0IHRoZSByZW5kZXJlZCBsaW5lcy5cbiAgICBkLnZpZXcgPSBbXTtcbiAgICBkLnJlbmRlcmVkVmlldyA9IG51bGw7XG4gICAgLy8gSG9sZHMgaW5mbyBhYm91dCBhIHNpbmdsZSByZW5kZXJlZCBsaW5lIHdoZW4gaXQgd2FzIHJlbmRlcmVkXG4gICAgLy8gZm9yIG1lYXN1cmVtZW50LCB3aGlsZSBub3QgaW4gdmlldy5cbiAgICBkLmV4dGVybmFsTWVhc3VyZWQgPSBudWxsO1xuICAgIC8vIEVtcHR5IHNwYWNlIChpbiBwaXhlbHMpIGFib3ZlIHRoZSB2aWV3XG4gICAgZC52aWV3T2Zmc2V0ID0gMDtcbiAgICBkLmxhc3RXcmFwSGVpZ2h0ID0gZC5sYXN0V3JhcFdpZHRoID0gMDtcbiAgICBkLnVwZGF0ZUxpbmVOdW1iZXJzID0gbnVsbDtcblxuICAgIGQubmF0aXZlQmFyV2lkdGggPSBkLmJhckhlaWdodCA9IGQuYmFyV2lkdGggPSAwO1xuICAgIGQuc2Nyb2xsYmFyc0NsaXBwZWQgPSBmYWxzZTtcblxuICAgIC8vIFVzZWQgdG8gb25seSByZXNpemUgdGhlIGxpbmUgbnVtYmVyIGd1dHRlciB3aGVuIG5lY2Vzc2FyeSAod2hlblxuICAgIC8vIHRoZSBhbW91bnQgb2YgbGluZXMgY3Jvc3NlcyBhIGJvdW5kYXJ5IHRoYXQgbWFrZXMgaXRzIHdpZHRoIGNoYW5nZSlcbiAgICBkLmxpbmVOdW1XaWR0aCA9IGQubGluZU51bUlubmVyV2lkdGggPSBkLmxpbmVOdW1DaGFycyA9IG51bGw7XG4gICAgLy8gU2V0IHRvIHRydWUgd2hlbiBhIG5vbi1ob3Jpem9udGFsLXNjcm9sbGluZyBsaW5lIHdpZGdldCBpc1xuICAgIC8vIGFkZGVkLiBBcyBhbiBvcHRpbWl6YXRpb24sIGxpbmUgd2lkZ2V0IGFsaWduaW5nIGlzIHNraXBwZWQgd2hlblxuICAgIC8vIHRoaXMgaXMgZmFsc2UuXG4gICAgZC5hbGlnbldpZGdldHMgPSBmYWxzZTtcblxuICAgIGQuY2FjaGVkQ2hhcldpZHRoID0gZC5jYWNoZWRUZXh0SGVpZ2h0ID0gZC5jYWNoZWRQYWRkaW5nSCA9IG51bGw7XG5cbiAgICAvLyBUcmFja3MgdGhlIG1heGltdW0gbGluZSBsZW5ndGggc28gdGhhdCB0aGUgaG9yaXpvbnRhbCBzY3JvbGxiYXJcbiAgICAvLyBjYW4gYmUga2VwdCBzdGF0aWMgd2hlbiBzY3JvbGxpbmcuXG4gICAgZC5tYXhMaW5lID0gbnVsbDtcbiAgICBkLm1heExpbmVMZW5ndGggPSAwO1xuICAgIGQubWF4TGluZUNoYW5nZWQgPSBmYWxzZTtcblxuICAgIC8vIFVzZWQgZm9yIG1lYXN1cmluZyB3aGVlbCBzY3JvbGxpbmcgZ3JhbnVsYXJpdHlcbiAgICBkLndoZWVsRFggPSBkLndoZWVsRFkgPSBkLndoZWVsU3RhcnRYID0gZC53aGVlbFN0YXJ0WSA9IG51bGw7XG5cbiAgICAvLyBUcnVlIHdoZW4gc2hpZnQgaXMgaGVsZCBkb3duLlxuICAgIGQuc2hpZnQgPSBmYWxzZTtcblxuICAgIC8vIFVzZWQgdG8gdHJhY2sgd2hldGhlciBhbnl0aGluZyBoYXBwZW5lZCBzaW5jZSB0aGUgY29udGV4dCBtZW51XG4gICAgLy8gd2FzIG9wZW5lZC5cbiAgICBkLnNlbEZvckNvbnRleHRNZW51ID0gbnVsbDtcblxuICAgIGQuYWN0aXZlVG91Y2ggPSBudWxsO1xuXG4gICAgaW5wdXQuaW5pdChkKTtcbiAgfVxuXG4gIC8vIFNUQVRFIFVQREFURVNcblxuICAvLyBVc2VkIHRvIGdldCB0aGUgZWRpdG9yIGludG8gYSBjb25zaXN0ZW50IHN0YXRlIGFnYWluIHdoZW4gb3B0aW9ucyBjaGFuZ2UuXG5cbiAgZnVuY3Rpb24gbG9hZE1vZGUoY20pIHtcbiAgICBjbS5kb2MubW9kZSA9IENvZGVNaXJyb3IuZ2V0TW9kZShjbS5vcHRpb25zLCBjbS5kb2MubW9kZU9wdGlvbik7XG4gICAgcmVzZXRNb2RlU3RhdGUoY20pO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVzZXRNb2RlU3RhdGUoY20pIHtcbiAgICBjbS5kb2MuaXRlcihmdW5jdGlvbihsaW5lKSB7XG4gICAgICBpZiAobGluZS5zdGF0ZUFmdGVyKSBsaW5lLnN0YXRlQWZ0ZXIgPSBudWxsO1xuICAgICAgaWYgKGxpbmUuc3R5bGVzKSBsaW5lLnN0eWxlcyA9IG51bGw7XG4gICAgfSk7XG4gICAgY20uZG9jLmZyb250aWVyID0gY20uZG9jLmZpcnN0O1xuICAgIHN0YXJ0V29ya2VyKGNtLCAxMDApO1xuICAgIGNtLnN0YXRlLm1vZGVHZW4rKztcbiAgICBpZiAoY20uY3VyT3ApIHJlZ0NoYW5nZShjbSk7XG4gIH1cblxuICBmdW5jdGlvbiB3cmFwcGluZ0NoYW5nZWQoY20pIHtcbiAgICBpZiAoY20ub3B0aW9ucy5saW5lV3JhcHBpbmcpIHtcbiAgICAgIGFkZENsYXNzKGNtLmRpc3BsYXkud3JhcHBlciwgXCJDb2RlTWlycm9yLXdyYXBcIik7XG4gICAgICBjbS5kaXNwbGF5LnNpemVyLnN0eWxlLm1pbldpZHRoID0gXCJcIjtcbiAgICAgIGNtLmRpc3BsYXkuc2l6ZXJXaWR0aCA9IG51bGw7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJtQ2xhc3MoY20uZGlzcGxheS53cmFwcGVyLCBcIkNvZGVNaXJyb3Itd3JhcFwiKTtcbiAgICAgIGZpbmRNYXhMaW5lKGNtKTtcbiAgICB9XG4gICAgZXN0aW1hdGVMaW5lSGVpZ2h0cyhjbSk7XG4gICAgcmVnQ2hhbmdlKGNtKTtcbiAgICBjbGVhckNhY2hlcyhjbSk7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpe3VwZGF0ZVNjcm9sbGJhcnMoY20pO30sIDEwMCk7XG4gIH1cblxuICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCBlc3RpbWF0ZXMgdGhlIGhlaWdodCBvZiBhIGxpbmUsIHRvIHVzZSBhc1xuICAvLyBmaXJzdCBhcHByb3hpbWF0aW9uIHVudGlsIHRoZSBsaW5lIGJlY29tZXMgdmlzaWJsZSAoYW5kIGlzIHRodXNcbiAgLy8gcHJvcGVybHkgbWVhc3VyYWJsZSkuXG4gIGZ1bmN0aW9uIGVzdGltYXRlSGVpZ2h0KGNtKSB7XG4gICAgdmFyIHRoID0gdGV4dEhlaWdodChjbS5kaXNwbGF5KSwgd3JhcHBpbmcgPSBjbS5vcHRpb25zLmxpbmVXcmFwcGluZztcbiAgICB2YXIgcGVyTGluZSA9IHdyYXBwaW5nICYmIE1hdGgubWF4KDUsIGNtLmRpc3BsYXkuc2Nyb2xsZXIuY2xpZW50V2lkdGggLyBjaGFyV2lkdGgoY20uZGlzcGxheSkgLSAzKTtcbiAgICByZXR1cm4gZnVuY3Rpb24obGluZSkge1xuICAgICAgaWYgKGxpbmVJc0hpZGRlbihjbS5kb2MsIGxpbmUpKSByZXR1cm4gMDtcblxuICAgICAgdmFyIHdpZGdldHNIZWlnaHQgPSAwO1xuICAgICAgaWYgKGxpbmUud2lkZ2V0cykgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lLndpZGdldHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGxpbmUud2lkZ2V0c1tpXS5oZWlnaHQpIHdpZGdldHNIZWlnaHQgKz0gbGluZS53aWRnZXRzW2ldLmhlaWdodDtcbiAgICAgIH1cblxuICAgICAgaWYgKHdyYXBwaW5nKVxuICAgICAgICByZXR1cm4gd2lkZ2V0c0hlaWdodCArIChNYXRoLmNlaWwobGluZS50ZXh0Lmxlbmd0aCAvIHBlckxpbmUpIHx8IDEpICogdGg7XG4gICAgICBlbHNlXG4gICAgICAgIHJldHVybiB3aWRnZXRzSGVpZ2h0ICsgdGg7XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGVzdGltYXRlTGluZUhlaWdodHMoY20pIHtcbiAgICB2YXIgZG9jID0gY20uZG9jLCBlc3QgPSBlc3RpbWF0ZUhlaWdodChjbSk7XG4gICAgZG9jLml0ZXIoZnVuY3Rpb24obGluZSkge1xuICAgICAgdmFyIGVzdEhlaWdodCA9IGVzdChsaW5lKTtcbiAgICAgIGlmIChlc3RIZWlnaHQgIT0gbGluZS5oZWlnaHQpIHVwZGF0ZUxpbmVIZWlnaHQobGluZSwgZXN0SGVpZ2h0KTtcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHRoZW1lQ2hhbmdlZChjbSkge1xuICAgIGNtLmRpc3BsYXkud3JhcHBlci5jbGFzc05hbWUgPSBjbS5kaXNwbGF5LndyYXBwZXIuY2xhc3NOYW1lLnJlcGxhY2UoL1xccypjbS1zLVxcUysvZywgXCJcIikgK1xuICAgICAgY20ub3B0aW9ucy50aGVtZS5yZXBsYWNlKC8oXnxcXHMpXFxzKi9nLCBcIiBjbS1zLVwiKTtcbiAgICBjbGVhckNhY2hlcyhjbSk7XG4gIH1cblxuICBmdW5jdGlvbiBndXR0ZXJzQ2hhbmdlZChjbSkge1xuICAgIHVwZGF0ZUd1dHRlcnMoY20pO1xuICAgIHJlZ0NoYW5nZShjbSk7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpe2FsaWduSG9yaXpvbnRhbGx5KGNtKTt9LCAyMCk7XG4gIH1cblxuICAvLyBSZWJ1aWxkIHRoZSBndXR0ZXIgZWxlbWVudHMsIGVuc3VyZSB0aGUgbWFyZ2luIHRvIHRoZSBsZWZ0IG9mIHRoZVxuICAvLyBjb2RlIG1hdGNoZXMgdGhlaXIgd2lkdGguXG4gIGZ1bmN0aW9uIHVwZGF0ZUd1dHRlcnMoY20pIHtcbiAgICB2YXIgZ3V0dGVycyA9IGNtLmRpc3BsYXkuZ3V0dGVycywgc3BlY3MgPSBjbS5vcHRpb25zLmd1dHRlcnM7XG4gICAgcmVtb3ZlQ2hpbGRyZW4oZ3V0dGVycyk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGVjcy5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIGd1dHRlckNsYXNzID0gc3BlY3NbaV07XG4gICAgICB2YXIgZ0VsdCA9IGd1dHRlcnMuYXBwZW5kQ2hpbGQoZWx0KFwiZGl2XCIsIG51bGwsIFwiQ29kZU1pcnJvci1ndXR0ZXIgXCIgKyBndXR0ZXJDbGFzcykpO1xuICAgICAgaWYgKGd1dHRlckNsYXNzID09IFwiQ29kZU1pcnJvci1saW5lbnVtYmVyc1wiKSB7XG4gICAgICAgIGNtLmRpc3BsYXkubGluZUd1dHRlciA9IGdFbHQ7XG4gICAgICAgIGdFbHQuc3R5bGUud2lkdGggPSAoY20uZGlzcGxheS5saW5lTnVtV2lkdGggfHwgMSkgKyBcInB4XCI7XG4gICAgICB9XG4gICAgfVxuICAgIGd1dHRlcnMuc3R5bGUuZGlzcGxheSA9IGkgPyBcIlwiIDogXCJub25lXCI7XG4gICAgdXBkYXRlR3V0dGVyU3BhY2UoY20pO1xuICB9XG5cbiAgZnVuY3Rpb24gdXBkYXRlR3V0dGVyU3BhY2UoY20pIHtcbiAgICB2YXIgd2lkdGggPSBjbS5kaXNwbGF5Lmd1dHRlcnMub2Zmc2V0V2lkdGg7XG4gICAgY20uZGlzcGxheS5zaXplci5zdHlsZS5tYXJnaW5MZWZ0ID0gd2lkdGggKyBcInB4XCI7XG4gIH1cblxuICAvLyBDb21wdXRlIHRoZSBjaGFyYWN0ZXIgbGVuZ3RoIG9mIGEgbGluZSwgdGFraW5nIGludG8gYWNjb3VudFxuICAvLyBjb2xsYXBzZWQgcmFuZ2VzIChzZWUgbWFya1RleHQpIHRoYXQgbWlnaHQgaGlkZSBwYXJ0cywgYW5kIGpvaW5cbiAgLy8gb3RoZXIgbGluZXMgb250byBpdC5cbiAgZnVuY3Rpb24gbGluZUxlbmd0aChsaW5lKSB7XG4gICAgaWYgKGxpbmUuaGVpZ2h0ID09IDApIHJldHVybiAwO1xuICAgIHZhciBsZW4gPSBsaW5lLnRleHQubGVuZ3RoLCBtZXJnZWQsIGN1ciA9IGxpbmU7XG4gICAgd2hpbGUgKG1lcmdlZCA9IGNvbGxhcHNlZFNwYW5BdFN0YXJ0KGN1cikpIHtcbiAgICAgIHZhciBmb3VuZCA9IG1lcmdlZC5maW5kKDAsIHRydWUpO1xuICAgICAgY3VyID0gZm91bmQuZnJvbS5saW5lO1xuICAgICAgbGVuICs9IGZvdW5kLmZyb20uY2ggLSBmb3VuZC50by5jaDtcbiAgICB9XG4gICAgY3VyID0gbGluZTtcbiAgICB3aGlsZSAobWVyZ2VkID0gY29sbGFwc2VkU3BhbkF0RW5kKGN1cikpIHtcbiAgICAgIHZhciBmb3VuZCA9IG1lcmdlZC5maW5kKDAsIHRydWUpO1xuICAgICAgbGVuIC09IGN1ci50ZXh0Lmxlbmd0aCAtIGZvdW5kLmZyb20uY2g7XG4gICAgICBjdXIgPSBmb3VuZC50by5saW5lO1xuICAgICAgbGVuICs9IGN1ci50ZXh0Lmxlbmd0aCAtIGZvdW5kLnRvLmNoO1xuICAgIH1cbiAgICByZXR1cm4gbGVuO1xuICB9XG5cbiAgLy8gRmluZCB0aGUgbG9uZ2VzdCBsaW5lIGluIHRoZSBkb2N1bWVudC5cbiAgZnVuY3Rpb24gZmluZE1heExpbmUoY20pIHtcbiAgICB2YXIgZCA9IGNtLmRpc3BsYXksIGRvYyA9IGNtLmRvYztcbiAgICBkLm1heExpbmUgPSBnZXRMaW5lKGRvYywgZG9jLmZpcnN0KTtcbiAgICBkLm1heExpbmVMZW5ndGggPSBsaW5lTGVuZ3RoKGQubWF4TGluZSk7XG4gICAgZC5tYXhMaW5lQ2hhbmdlZCA9IHRydWU7XG4gICAgZG9jLml0ZXIoZnVuY3Rpb24obGluZSkge1xuICAgICAgdmFyIGxlbiA9IGxpbmVMZW5ndGgobGluZSk7XG4gICAgICBpZiAobGVuID4gZC5tYXhMaW5lTGVuZ3RoKSB7XG4gICAgICAgIGQubWF4TGluZUxlbmd0aCA9IGxlbjtcbiAgICAgICAgZC5tYXhMaW5lID0gbGluZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8vIE1ha2Ugc3VyZSB0aGUgZ3V0dGVycyBvcHRpb25zIGNvbnRhaW5zIHRoZSBlbGVtZW50XG4gIC8vIFwiQ29kZU1pcnJvci1saW5lbnVtYmVyc1wiIHdoZW4gdGhlIGxpbmVOdW1iZXJzIG9wdGlvbiBpcyB0cnVlLlxuICBmdW5jdGlvbiBzZXRHdXR0ZXJzRm9yTGluZU51bWJlcnMob3B0aW9ucykge1xuICAgIHZhciBmb3VuZCA9IGluZGV4T2Yob3B0aW9ucy5ndXR0ZXJzLCBcIkNvZGVNaXJyb3ItbGluZW51bWJlcnNcIik7XG4gICAgaWYgKGZvdW5kID09IC0xICYmIG9wdGlvbnMubGluZU51bWJlcnMpIHtcbiAgICAgIG9wdGlvbnMuZ3V0dGVycyA9IG9wdGlvbnMuZ3V0dGVycy5jb25jYXQoW1wiQ29kZU1pcnJvci1saW5lbnVtYmVyc1wiXSk7XG4gICAgfSBlbHNlIGlmIChmb3VuZCA+IC0xICYmICFvcHRpb25zLmxpbmVOdW1iZXJzKSB7XG4gICAgICBvcHRpb25zLmd1dHRlcnMgPSBvcHRpb25zLmd1dHRlcnMuc2xpY2UoMCk7XG4gICAgICBvcHRpb25zLmd1dHRlcnMuc3BsaWNlKGZvdW5kLCAxKTtcbiAgICB9XG4gIH1cblxuICAvLyBTQ1JPTExCQVJTXG5cbiAgLy8gUHJlcGFyZSBET00gcmVhZHMgbmVlZGVkIHRvIHVwZGF0ZSB0aGUgc2Nyb2xsYmFycy4gRG9uZSBpbiBvbmVcbiAgLy8gc2hvdCB0byBtaW5pbWl6ZSB1cGRhdGUvbWVhc3VyZSByb3VuZHRyaXBzLlxuICBmdW5jdGlvbiBtZWFzdXJlRm9yU2Nyb2xsYmFycyhjbSkge1xuICAgIHZhciBkID0gY20uZGlzcGxheSwgZ3V0dGVyVyA9IGQuZ3V0dGVycy5vZmZzZXRXaWR0aDtcbiAgICB2YXIgZG9jSCA9IE1hdGgucm91bmQoY20uZG9jLmhlaWdodCArIHBhZGRpbmdWZXJ0KGNtLmRpc3BsYXkpKTtcbiAgICByZXR1cm4ge1xuICAgICAgY2xpZW50SGVpZ2h0OiBkLnNjcm9sbGVyLmNsaWVudEhlaWdodCxcbiAgICAgIHZpZXdIZWlnaHQ6IGQud3JhcHBlci5jbGllbnRIZWlnaHQsXG4gICAgICBzY3JvbGxXaWR0aDogZC5zY3JvbGxlci5zY3JvbGxXaWR0aCwgY2xpZW50V2lkdGg6IGQuc2Nyb2xsZXIuY2xpZW50V2lkdGgsXG4gICAgICB2aWV3V2lkdGg6IGQud3JhcHBlci5jbGllbnRXaWR0aCxcbiAgICAgIGJhckxlZnQ6IGNtLm9wdGlvbnMuZml4ZWRHdXR0ZXIgPyBndXR0ZXJXIDogMCxcbiAgICAgIGRvY0hlaWdodDogZG9jSCxcbiAgICAgIHNjcm9sbEhlaWdodDogZG9jSCArIHNjcm9sbEdhcChjbSkgKyBkLmJhckhlaWdodCxcbiAgICAgIG5hdGl2ZUJhcldpZHRoOiBkLm5hdGl2ZUJhcldpZHRoLFxuICAgICAgZ3V0dGVyV2lkdGg6IGd1dHRlcldcbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gTmF0aXZlU2Nyb2xsYmFycyhwbGFjZSwgc2Nyb2xsLCBjbSkge1xuICAgIHRoaXMuY20gPSBjbTtcbiAgICB2YXIgdmVydCA9IHRoaXMudmVydCA9IGVsdChcImRpdlwiLCBbZWx0KFwiZGl2XCIsIG51bGwsIG51bGwsIFwibWluLXdpZHRoOiAxcHhcIildLCBcIkNvZGVNaXJyb3ItdnNjcm9sbGJhclwiKTtcbiAgICB2YXIgaG9yaXogPSB0aGlzLmhvcml6ID0gZWx0KFwiZGl2XCIsIFtlbHQoXCJkaXZcIiwgbnVsbCwgbnVsbCwgXCJoZWlnaHQ6IDEwMCU7IG1pbi1oZWlnaHQ6IDFweFwiKV0sIFwiQ29kZU1pcnJvci1oc2Nyb2xsYmFyXCIpO1xuICAgIHBsYWNlKHZlcnQpOyBwbGFjZShob3Jpeik7XG5cbiAgICBvbih2ZXJ0LCBcInNjcm9sbFwiLCBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh2ZXJ0LmNsaWVudEhlaWdodCkgc2Nyb2xsKHZlcnQuc2Nyb2xsVG9wLCBcInZlcnRpY2FsXCIpO1xuICAgIH0pO1xuICAgIG9uKGhvcml6LCBcInNjcm9sbFwiLCBmdW5jdGlvbigpIHtcbiAgICAgIGlmIChob3Jpei5jbGllbnRXaWR0aCkgc2Nyb2xsKGhvcml6LnNjcm9sbExlZnQsIFwiaG9yaXpvbnRhbFwiKTtcbiAgICB9KTtcblxuICAgIHRoaXMuY2hlY2tlZE92ZXJsYXkgPSBmYWxzZTtcbiAgICAvLyBOZWVkIHRvIHNldCBhIG1pbmltdW0gd2lkdGggdG8gc2VlIHRoZSBzY3JvbGxiYXIgb24gSUU3IChidXQgbXVzdCBub3Qgc2V0IGl0IG9uIElFOCkuXG4gICAgaWYgKGllICYmIGllX3ZlcnNpb24gPCA4KSB0aGlzLmhvcml6LnN0eWxlLm1pbkhlaWdodCA9IHRoaXMudmVydC5zdHlsZS5taW5XaWR0aCA9IFwiMThweFwiO1xuICB9XG5cbiAgTmF0aXZlU2Nyb2xsYmFycy5wcm90b3R5cGUgPSBjb3B5T2JqKHtcbiAgICB1cGRhdGU6IGZ1bmN0aW9uKG1lYXN1cmUpIHtcbiAgICAgIHZhciBuZWVkc0ggPSBtZWFzdXJlLnNjcm9sbFdpZHRoID4gbWVhc3VyZS5jbGllbnRXaWR0aCArIDE7XG4gICAgICB2YXIgbmVlZHNWID0gbWVhc3VyZS5zY3JvbGxIZWlnaHQgPiBtZWFzdXJlLmNsaWVudEhlaWdodCArIDE7XG4gICAgICB2YXIgc1dpZHRoID0gbWVhc3VyZS5uYXRpdmVCYXJXaWR0aDtcblxuICAgICAgaWYgKG5lZWRzVikge1xuICAgICAgICB0aGlzLnZlcnQuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgICAgdGhpcy52ZXJ0LnN0eWxlLmJvdHRvbSA9IG5lZWRzSCA/IHNXaWR0aCArIFwicHhcIiA6IFwiMFwiO1xuICAgICAgICB2YXIgdG90YWxIZWlnaHQgPSBtZWFzdXJlLnZpZXdIZWlnaHQgLSAobmVlZHNIID8gc1dpZHRoIDogMCk7XG4gICAgICAgIC8vIEEgYnVnIGluIElFOCBjYW4gY2F1c2UgdGhpcyB2YWx1ZSB0byBiZSBuZWdhdGl2ZSwgc28gZ3VhcmQgaXQuXG4gICAgICAgIHRoaXMudmVydC5maXJzdENoaWxkLnN0eWxlLmhlaWdodCA9XG4gICAgICAgICAgTWF0aC5tYXgoMCwgbWVhc3VyZS5zY3JvbGxIZWlnaHQgLSBtZWFzdXJlLmNsaWVudEhlaWdodCArIHRvdGFsSGVpZ2h0KSArIFwicHhcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMudmVydC5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcbiAgICAgICAgdGhpcy52ZXJ0LmZpcnN0Q2hpbGQuc3R5bGUuaGVpZ2h0ID0gXCIwXCI7XG4gICAgICB9XG5cbiAgICAgIGlmIChuZWVkc0gpIHtcbiAgICAgICAgdGhpcy5ob3Jpei5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgICB0aGlzLmhvcml6LnN0eWxlLnJpZ2h0ID0gbmVlZHNWID8gc1dpZHRoICsgXCJweFwiIDogXCIwXCI7XG4gICAgICAgIHRoaXMuaG9yaXouc3R5bGUubGVmdCA9IG1lYXN1cmUuYmFyTGVmdCArIFwicHhcIjtcbiAgICAgICAgdmFyIHRvdGFsV2lkdGggPSBtZWFzdXJlLnZpZXdXaWR0aCAtIG1lYXN1cmUuYmFyTGVmdCAtIChuZWVkc1YgPyBzV2lkdGggOiAwKTtcbiAgICAgICAgdGhpcy5ob3Jpei5maXJzdENoaWxkLnN0eWxlLndpZHRoID1cbiAgICAgICAgICAobWVhc3VyZS5zY3JvbGxXaWR0aCAtIG1lYXN1cmUuY2xpZW50V2lkdGggKyB0b3RhbFdpZHRoKSArIFwicHhcIjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuaG9yaXouc3R5bGUuZGlzcGxheSA9IFwiXCI7XG4gICAgICAgIHRoaXMuaG9yaXouZmlyc3RDaGlsZC5zdHlsZS53aWR0aCA9IFwiMFwiO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXRoaXMuY2hlY2tlZE92ZXJsYXkgJiYgbWVhc3VyZS5jbGllbnRIZWlnaHQgPiAwKSB7XG4gICAgICAgIGlmIChzV2lkdGggPT0gMCkgdGhpcy5vdmVybGF5SGFjaygpO1xuICAgICAgICB0aGlzLmNoZWNrZWRPdmVybGF5ID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtyaWdodDogbmVlZHNWID8gc1dpZHRoIDogMCwgYm90dG9tOiBuZWVkc0ggPyBzV2lkdGggOiAwfTtcbiAgICB9LFxuICAgIHNldFNjcm9sbExlZnQ6IGZ1bmN0aW9uKHBvcykge1xuICAgICAgaWYgKHRoaXMuaG9yaXouc2Nyb2xsTGVmdCAhPSBwb3MpIHRoaXMuaG9yaXouc2Nyb2xsTGVmdCA9IHBvcztcbiAgICB9LFxuICAgIHNldFNjcm9sbFRvcDogZnVuY3Rpb24ocG9zKSB7XG4gICAgICBpZiAodGhpcy52ZXJ0LnNjcm9sbFRvcCAhPSBwb3MpIHRoaXMudmVydC5zY3JvbGxUb3AgPSBwb3M7XG4gICAgfSxcbiAgICBvdmVybGF5SGFjazogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgdyA9IG1hYyAmJiAhbWFjX2dlTW91bnRhaW5MaW9uID8gXCIxMnB4XCIgOiBcIjE4cHhcIjtcbiAgICAgIHRoaXMuaG9yaXouc3R5bGUubWluSGVpZ2h0ID0gdGhpcy52ZXJ0LnN0eWxlLm1pbldpZHRoID0gdztcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIHZhciBiYXJNb3VzZURvd24gPSBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmIChlX3RhcmdldChlKSAhPSBzZWxmLnZlcnQgJiYgZV90YXJnZXQoZSkgIT0gc2VsZi5ob3JpeilcbiAgICAgICAgICBvcGVyYXRpb24oc2VsZi5jbSwgb25Nb3VzZURvd24pKGUpO1xuICAgICAgfTtcbiAgICAgIG9uKHRoaXMudmVydCwgXCJtb3VzZWRvd25cIiwgYmFyTW91c2VEb3duKTtcbiAgICAgIG9uKHRoaXMuaG9yaXosIFwibW91c2Vkb3duXCIsIGJhck1vdXNlRG93bik7XG4gICAgfSxcbiAgICBjbGVhcjogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgcGFyZW50ID0gdGhpcy5ob3Jpei5wYXJlbnROb2RlO1xuICAgICAgcGFyZW50LnJlbW92ZUNoaWxkKHRoaXMuaG9yaXopO1xuICAgICAgcGFyZW50LnJlbW92ZUNoaWxkKHRoaXMudmVydCk7XG4gICAgfVxuICB9LCBOYXRpdmVTY3JvbGxiYXJzLnByb3RvdHlwZSk7XG5cbiAgZnVuY3Rpb24gTnVsbFNjcm9sbGJhcnMoKSB7fVxuXG4gIE51bGxTY3JvbGxiYXJzLnByb3RvdHlwZSA9IGNvcHlPYmooe1xuICAgIHVwZGF0ZTogZnVuY3Rpb24oKSB7IHJldHVybiB7Ym90dG9tOiAwLCByaWdodDogMH07IH0sXG4gICAgc2V0U2Nyb2xsTGVmdDogZnVuY3Rpb24oKSB7fSxcbiAgICBzZXRTY3JvbGxUb3A6IGZ1bmN0aW9uKCkge30sXG4gICAgY2xlYXI6IGZ1bmN0aW9uKCkge31cbiAgfSwgTnVsbFNjcm9sbGJhcnMucHJvdG90eXBlKTtcblxuICBDb2RlTWlycm9yLnNjcm9sbGJhck1vZGVsID0ge1wibmF0aXZlXCI6IE5hdGl2ZVNjcm9sbGJhcnMsIFwibnVsbFwiOiBOdWxsU2Nyb2xsYmFyc307XG5cbiAgZnVuY3Rpb24gaW5pdFNjcm9sbGJhcnMoY20pIHtcbiAgICBpZiAoY20uZGlzcGxheS5zY3JvbGxiYXJzKSB7XG4gICAgICBjbS5kaXNwbGF5LnNjcm9sbGJhcnMuY2xlYXIoKTtcbiAgICAgIGlmIChjbS5kaXNwbGF5LnNjcm9sbGJhcnMuYWRkQ2xhc3MpXG4gICAgICAgIHJtQ2xhc3MoY20uZGlzcGxheS53cmFwcGVyLCBjbS5kaXNwbGF5LnNjcm9sbGJhcnMuYWRkQ2xhc3MpO1xuICAgIH1cblxuICAgIGNtLmRpc3BsYXkuc2Nyb2xsYmFycyA9IG5ldyBDb2RlTWlycm9yLnNjcm9sbGJhck1vZGVsW2NtLm9wdGlvbnMuc2Nyb2xsYmFyU3R5bGVdKGZ1bmN0aW9uKG5vZGUpIHtcbiAgICAgIGNtLmRpc3BsYXkud3JhcHBlci5pbnNlcnRCZWZvcmUobm9kZSwgY20uZGlzcGxheS5zY3JvbGxiYXJGaWxsZXIpO1xuICAgICAgLy8gUHJldmVudCBjbGlja3MgaW4gdGhlIHNjcm9sbGJhcnMgZnJvbSBraWxsaW5nIGZvY3VzXG4gICAgICBvbihub2RlLCBcIm1vdXNlZG93blwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKGNtLnN0YXRlLmZvY3VzZWQpIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IGNtLmRpc3BsYXkuaW5wdXQuZm9jdXMoKTsgfSwgMCk7XG4gICAgICB9KTtcbiAgICAgIG5vZGUuc2V0QXR0cmlidXRlKFwiY20tbm90LWNvbnRlbnRcIiwgXCJ0cnVlXCIpO1xuICAgIH0sIGZ1bmN0aW9uKHBvcywgYXhpcykge1xuICAgICAgaWYgKGF4aXMgPT0gXCJob3Jpem9udGFsXCIpIHNldFNjcm9sbExlZnQoY20sIHBvcyk7XG4gICAgICBlbHNlIHNldFNjcm9sbFRvcChjbSwgcG9zKTtcbiAgICB9LCBjbSk7XG4gICAgaWYgKGNtLmRpc3BsYXkuc2Nyb2xsYmFycy5hZGRDbGFzcylcbiAgICAgIGFkZENsYXNzKGNtLmRpc3BsYXkud3JhcHBlciwgY20uZGlzcGxheS5zY3JvbGxiYXJzLmFkZENsYXNzKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHVwZGF0ZVNjcm9sbGJhcnMoY20sIG1lYXN1cmUpIHtcbiAgICBpZiAoIW1lYXN1cmUpIG1lYXN1cmUgPSBtZWFzdXJlRm9yU2Nyb2xsYmFycyhjbSk7XG4gICAgdmFyIHN0YXJ0V2lkdGggPSBjbS5kaXNwbGF5LmJhcldpZHRoLCBzdGFydEhlaWdodCA9IGNtLmRpc3BsYXkuYmFySGVpZ2h0O1xuICAgIHVwZGF0ZVNjcm9sbGJhcnNJbm5lcihjbSwgbWVhc3VyZSk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCA0ICYmIHN0YXJ0V2lkdGggIT0gY20uZGlzcGxheS5iYXJXaWR0aCB8fCBzdGFydEhlaWdodCAhPSBjbS5kaXNwbGF5LmJhckhlaWdodDsgaSsrKSB7XG4gICAgICBpZiAoc3RhcnRXaWR0aCAhPSBjbS5kaXNwbGF5LmJhcldpZHRoICYmIGNtLm9wdGlvbnMubGluZVdyYXBwaW5nKVxuICAgICAgICB1cGRhdGVIZWlnaHRzSW5WaWV3cG9ydChjbSk7XG4gICAgICB1cGRhdGVTY3JvbGxiYXJzSW5uZXIoY20sIG1lYXN1cmVGb3JTY3JvbGxiYXJzKGNtKSk7XG4gICAgICBzdGFydFdpZHRoID0gY20uZGlzcGxheS5iYXJXaWR0aDsgc3RhcnRIZWlnaHQgPSBjbS5kaXNwbGF5LmJhckhlaWdodDtcbiAgICB9XG4gIH1cblxuICAvLyBSZS1zeW5jaHJvbml6ZSB0aGUgZmFrZSBzY3JvbGxiYXJzIHdpdGggdGhlIGFjdHVhbCBzaXplIG9mIHRoZVxuICAvLyBjb250ZW50LlxuICBmdW5jdGlvbiB1cGRhdGVTY3JvbGxiYXJzSW5uZXIoY20sIG1lYXN1cmUpIHtcbiAgICB2YXIgZCA9IGNtLmRpc3BsYXk7XG4gICAgdmFyIHNpemVzID0gZC5zY3JvbGxiYXJzLnVwZGF0ZShtZWFzdXJlKTtcblxuICAgIGQuc2l6ZXIuc3R5bGUucGFkZGluZ1JpZ2h0ID0gKGQuYmFyV2lkdGggPSBzaXplcy5yaWdodCkgKyBcInB4XCI7XG4gICAgZC5zaXplci5zdHlsZS5wYWRkaW5nQm90dG9tID0gKGQuYmFySGVpZ2h0ID0gc2l6ZXMuYm90dG9tKSArIFwicHhcIjtcblxuICAgIGlmIChzaXplcy5yaWdodCAmJiBzaXplcy5ib3R0b20pIHtcbiAgICAgIGQuc2Nyb2xsYmFyRmlsbGVyLnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgICBkLnNjcm9sbGJhckZpbGxlci5zdHlsZS5oZWlnaHQgPSBzaXplcy5ib3R0b20gKyBcInB4XCI7XG4gICAgICBkLnNjcm9sbGJhckZpbGxlci5zdHlsZS53aWR0aCA9IHNpemVzLnJpZ2h0ICsgXCJweFwiO1xuICAgIH0gZWxzZSBkLnNjcm9sbGJhckZpbGxlci5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcbiAgICBpZiAoc2l6ZXMuYm90dG9tICYmIGNtLm9wdGlvbnMuY292ZXJHdXR0ZXJOZXh0VG9TY3JvbGxiYXIgJiYgY20ub3B0aW9ucy5maXhlZEd1dHRlcikge1xuICAgICAgZC5ndXR0ZXJGaWxsZXIuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgIGQuZ3V0dGVyRmlsbGVyLnN0eWxlLmhlaWdodCA9IHNpemVzLmJvdHRvbSArIFwicHhcIjtcbiAgICAgIGQuZ3V0dGVyRmlsbGVyLnN0eWxlLndpZHRoID0gbWVhc3VyZS5ndXR0ZXJXaWR0aCArIFwicHhcIjtcbiAgICB9IGVsc2UgZC5ndXR0ZXJGaWxsZXIuc3R5bGUuZGlzcGxheSA9IFwiXCI7XG4gIH1cblxuICAvLyBDb21wdXRlIHRoZSBsaW5lcyB0aGF0IGFyZSB2aXNpYmxlIGluIGEgZ2l2ZW4gdmlld3BvcnQgKGRlZmF1bHRzXG4gIC8vIHRoZSB0aGUgY3VycmVudCBzY3JvbGwgcG9zaXRpb24pLiB2aWV3cG9ydCBtYXkgY29udGFpbiB0b3AsXG4gIC8vIGhlaWdodCwgYW5kIGVuc3VyZSAoc2VlIG9wLnNjcm9sbFRvUG9zKSBwcm9wZXJ0aWVzLlxuICBmdW5jdGlvbiB2aXNpYmxlTGluZXMoZGlzcGxheSwgZG9jLCB2aWV3cG9ydCkge1xuICAgIHZhciB0b3AgPSB2aWV3cG9ydCAmJiB2aWV3cG9ydC50b3AgIT0gbnVsbCA/IE1hdGgubWF4KDAsIHZpZXdwb3J0LnRvcCkgOiBkaXNwbGF5LnNjcm9sbGVyLnNjcm9sbFRvcDtcbiAgICB0b3AgPSBNYXRoLmZsb29yKHRvcCAtIHBhZGRpbmdUb3AoZGlzcGxheSkpO1xuICAgIHZhciBib3R0b20gPSB2aWV3cG9ydCAmJiB2aWV3cG9ydC5ib3R0b20gIT0gbnVsbCA/IHZpZXdwb3J0LmJvdHRvbSA6IHRvcCArIGRpc3BsYXkud3JhcHBlci5jbGllbnRIZWlnaHQ7XG5cbiAgICB2YXIgZnJvbSA9IGxpbmVBdEhlaWdodChkb2MsIHRvcCksIHRvID0gbGluZUF0SGVpZ2h0KGRvYywgYm90dG9tKTtcbiAgICAvLyBFbnN1cmUgaXMgYSB7ZnJvbToge2xpbmUsIGNofSwgdG86IHtsaW5lLCBjaH19IG9iamVjdCwgYW5kXG4gICAgLy8gZm9yY2VzIHRob3NlIGxpbmVzIGludG8gdGhlIHZpZXdwb3J0IChpZiBwb3NzaWJsZSkuXG4gICAgaWYgKHZpZXdwb3J0ICYmIHZpZXdwb3J0LmVuc3VyZSkge1xuICAgICAgdmFyIGVuc3VyZUZyb20gPSB2aWV3cG9ydC5lbnN1cmUuZnJvbS5saW5lLCBlbnN1cmVUbyA9IHZpZXdwb3J0LmVuc3VyZS50by5saW5lO1xuICAgICAgaWYgKGVuc3VyZUZyb20gPCBmcm9tKSB7XG4gICAgICAgIGZyb20gPSBlbnN1cmVGcm9tO1xuICAgICAgICB0byA9IGxpbmVBdEhlaWdodChkb2MsIGhlaWdodEF0TGluZShnZXRMaW5lKGRvYywgZW5zdXJlRnJvbSkpICsgZGlzcGxheS53cmFwcGVyLmNsaWVudEhlaWdodCk7XG4gICAgICB9IGVsc2UgaWYgKE1hdGgubWluKGVuc3VyZVRvLCBkb2MubGFzdExpbmUoKSkgPj0gdG8pIHtcbiAgICAgICAgZnJvbSA9IGxpbmVBdEhlaWdodChkb2MsIGhlaWdodEF0TGluZShnZXRMaW5lKGRvYywgZW5zdXJlVG8pKSAtIGRpc3BsYXkud3JhcHBlci5jbGllbnRIZWlnaHQpO1xuICAgICAgICB0byA9IGVuc3VyZVRvO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4ge2Zyb206IGZyb20sIHRvOiBNYXRoLm1heCh0bywgZnJvbSArIDEpfTtcbiAgfVxuXG4gIC8vIExJTkUgTlVNQkVSU1xuXG4gIC8vIFJlLWFsaWduIGxpbmUgbnVtYmVycyBhbmQgZ3V0dGVyIG1hcmtzIHRvIGNvbXBlbnNhdGUgZm9yXG4gIC8vIGhvcml6b250YWwgc2Nyb2xsaW5nLlxuICBmdW5jdGlvbiBhbGlnbkhvcml6b250YWxseShjbSkge1xuICAgIHZhciBkaXNwbGF5ID0gY20uZGlzcGxheSwgdmlldyA9IGRpc3BsYXkudmlldztcbiAgICBpZiAoIWRpc3BsYXkuYWxpZ25XaWRnZXRzICYmICghZGlzcGxheS5ndXR0ZXJzLmZpcnN0Q2hpbGQgfHwgIWNtLm9wdGlvbnMuZml4ZWRHdXR0ZXIpKSByZXR1cm47XG4gICAgdmFyIGNvbXAgPSBjb21wZW5zYXRlRm9ySFNjcm9sbChkaXNwbGF5KSAtIGRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsTGVmdCArIGNtLmRvYy5zY3JvbGxMZWZ0O1xuICAgIHZhciBndXR0ZXJXID0gZGlzcGxheS5ndXR0ZXJzLm9mZnNldFdpZHRoLCBsZWZ0ID0gY29tcCArIFwicHhcIjtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZpZXcubGVuZ3RoOyBpKyspIGlmICghdmlld1tpXS5oaWRkZW4pIHtcbiAgICAgIGlmIChjbS5vcHRpb25zLmZpeGVkR3V0dGVyICYmIHZpZXdbaV0uZ3V0dGVyKVxuICAgICAgICB2aWV3W2ldLmd1dHRlci5zdHlsZS5sZWZ0ID0gbGVmdDtcbiAgICAgIHZhciBhbGlnbiA9IHZpZXdbaV0uYWxpZ25hYmxlO1xuICAgICAgaWYgKGFsaWduKSBmb3IgKHZhciBqID0gMDsgaiA8IGFsaWduLmxlbmd0aDsgaisrKVxuICAgICAgICBhbGlnbltqXS5zdHlsZS5sZWZ0ID0gbGVmdDtcbiAgICB9XG4gICAgaWYgKGNtLm9wdGlvbnMuZml4ZWRHdXR0ZXIpXG4gICAgICBkaXNwbGF5Lmd1dHRlcnMuc3R5bGUubGVmdCA9IChjb21wICsgZ3V0dGVyVykgKyBcInB4XCI7XG4gIH1cblxuICAvLyBVc2VkIHRvIGVuc3VyZSB0aGF0IHRoZSBsaW5lIG51bWJlciBndXR0ZXIgaXMgc3RpbGwgdGhlIHJpZ2h0XG4gIC8vIHNpemUgZm9yIHRoZSBjdXJyZW50IGRvY3VtZW50IHNpemUuIFJldHVybnMgdHJ1ZSB3aGVuIGFuIHVwZGF0ZVxuICAvLyBpcyBuZWVkZWQuXG4gIGZ1bmN0aW9uIG1heWJlVXBkYXRlTGluZU51bWJlcldpZHRoKGNtKSB7XG4gICAgaWYgKCFjbS5vcHRpb25zLmxpbmVOdW1iZXJzKSByZXR1cm4gZmFsc2U7XG4gICAgdmFyIGRvYyA9IGNtLmRvYywgbGFzdCA9IGxpbmVOdW1iZXJGb3IoY20ub3B0aW9ucywgZG9jLmZpcnN0ICsgZG9jLnNpemUgLSAxKSwgZGlzcGxheSA9IGNtLmRpc3BsYXk7XG4gICAgaWYgKGxhc3QubGVuZ3RoICE9IGRpc3BsYXkubGluZU51bUNoYXJzKSB7XG4gICAgICB2YXIgdGVzdCA9IGRpc3BsYXkubWVhc3VyZS5hcHBlbmRDaGlsZChlbHQoXCJkaXZcIiwgW2VsdChcImRpdlwiLCBsYXN0KV0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJDb2RlTWlycm9yLWxpbmVudW1iZXIgQ29kZU1pcnJvci1ndXR0ZXItZWx0XCIpKTtcbiAgICAgIHZhciBpbm5lclcgPSB0ZXN0LmZpcnN0Q2hpbGQub2Zmc2V0V2lkdGgsIHBhZGRpbmcgPSB0ZXN0Lm9mZnNldFdpZHRoIC0gaW5uZXJXO1xuICAgICAgZGlzcGxheS5saW5lR3V0dGVyLnN0eWxlLndpZHRoID0gXCJcIjtcbiAgICAgIGRpc3BsYXkubGluZU51bUlubmVyV2lkdGggPSBNYXRoLm1heChpbm5lclcsIGRpc3BsYXkubGluZUd1dHRlci5vZmZzZXRXaWR0aCAtIHBhZGRpbmcpICsgMTtcbiAgICAgIGRpc3BsYXkubGluZU51bVdpZHRoID0gZGlzcGxheS5saW5lTnVtSW5uZXJXaWR0aCArIHBhZGRpbmc7XG4gICAgICBkaXNwbGF5LmxpbmVOdW1DaGFycyA9IGRpc3BsYXkubGluZU51bUlubmVyV2lkdGggPyBsYXN0Lmxlbmd0aCA6IC0xO1xuICAgICAgZGlzcGxheS5saW5lR3V0dGVyLnN0eWxlLndpZHRoID0gZGlzcGxheS5saW5lTnVtV2lkdGggKyBcInB4XCI7XG4gICAgICB1cGRhdGVHdXR0ZXJTcGFjZShjbSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgZnVuY3Rpb24gbGluZU51bWJlckZvcihvcHRpb25zLCBpKSB7XG4gICAgcmV0dXJuIFN0cmluZyhvcHRpb25zLmxpbmVOdW1iZXJGb3JtYXR0ZXIoaSArIG9wdGlvbnMuZmlyc3RMaW5lTnVtYmVyKSk7XG4gIH1cblxuICAvLyBDb21wdXRlcyBkaXNwbGF5LnNjcm9sbGVyLnNjcm9sbExlZnQgKyBkaXNwbGF5Lmd1dHRlcnMub2Zmc2V0V2lkdGgsXG4gIC8vIGJ1dCB1c2luZyBnZXRCb3VuZGluZ0NsaWVudFJlY3QgdG8gZ2V0IGEgc3ViLXBpeGVsLWFjY3VyYXRlXG4gIC8vIHJlc3VsdC5cbiAgZnVuY3Rpb24gY29tcGVuc2F0ZUZvckhTY3JvbGwoZGlzcGxheSkge1xuICAgIHJldHVybiBkaXNwbGF5LnNjcm9sbGVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQgLSBkaXNwbGF5LnNpemVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmxlZnQ7XG4gIH1cblxuICAvLyBESVNQTEFZIERSQVdJTkdcblxuICBmdW5jdGlvbiBEaXNwbGF5VXBkYXRlKGNtLCB2aWV3cG9ydCwgZm9yY2UpIHtcbiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXk7XG5cbiAgICB0aGlzLnZpZXdwb3J0ID0gdmlld3BvcnQ7XG4gICAgLy8gU3RvcmUgc29tZSB2YWx1ZXMgdGhhdCB3ZSdsbCBuZWVkIGxhdGVyIChidXQgZG9uJ3Qgd2FudCB0byBmb3JjZSBhIHJlbGF5b3V0IGZvcilcbiAgICB0aGlzLnZpc2libGUgPSB2aXNpYmxlTGluZXMoZGlzcGxheSwgY20uZG9jLCB2aWV3cG9ydCk7XG4gICAgdGhpcy5lZGl0b3JJc0hpZGRlbiA9ICFkaXNwbGF5LndyYXBwZXIub2Zmc2V0V2lkdGg7XG4gICAgdGhpcy53cmFwcGVySGVpZ2h0ID0gZGlzcGxheS53cmFwcGVyLmNsaWVudEhlaWdodDtcbiAgICB0aGlzLndyYXBwZXJXaWR0aCA9IGRpc3BsYXkud3JhcHBlci5jbGllbnRXaWR0aDtcbiAgICB0aGlzLm9sZERpc3BsYXlXaWR0aCA9IGRpc3BsYXlXaWR0aChjbSk7XG4gICAgdGhpcy5mb3JjZSA9IGZvcmNlO1xuICAgIHRoaXMuZGltcyA9IGdldERpbWVuc2lvbnMoY20pO1xuICAgIHRoaXMuZXZlbnRzID0gW107XG4gIH1cblxuICBEaXNwbGF5VXBkYXRlLnByb3RvdHlwZS5zaWduYWwgPSBmdW5jdGlvbihlbWl0dGVyLCB0eXBlKSB7XG4gICAgaWYgKGhhc0hhbmRsZXIoZW1pdHRlciwgdHlwZSkpXG4gICAgICB0aGlzLmV2ZW50cy5wdXNoKGFyZ3VtZW50cyk7XG4gIH07XG4gIERpc3BsYXlVcGRhdGUucHJvdG90eXBlLmZpbmlzaCA9IGZ1bmN0aW9uKCkge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5ldmVudHMubGVuZ3RoOyBpKyspXG4gICAgICBzaWduYWwuYXBwbHkobnVsbCwgdGhpcy5ldmVudHNbaV0pO1xuICB9O1xuXG4gIGZ1bmN0aW9uIG1heWJlQ2xpcFNjcm9sbGJhcnMoY20pIHtcbiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXk7XG4gICAgaWYgKCFkaXNwbGF5LnNjcm9sbGJhcnNDbGlwcGVkICYmIGRpc3BsYXkuc2Nyb2xsZXIub2Zmc2V0V2lkdGgpIHtcbiAgICAgIGRpc3BsYXkubmF0aXZlQmFyV2lkdGggPSBkaXNwbGF5LnNjcm9sbGVyLm9mZnNldFdpZHRoIC0gZGlzcGxheS5zY3JvbGxlci5jbGllbnRXaWR0aDtcbiAgICAgIGRpc3BsYXkuaGVpZ2h0Rm9yY2VyLnN0eWxlLmhlaWdodCA9IHNjcm9sbEdhcChjbSkgKyBcInB4XCI7XG4gICAgICBkaXNwbGF5LnNpemVyLnN0eWxlLm1hcmdpbkJvdHRvbSA9IC1kaXNwbGF5Lm5hdGl2ZUJhcldpZHRoICsgXCJweFwiO1xuICAgICAgZGlzcGxheS5zaXplci5zdHlsZS5ib3JkZXJSaWdodFdpZHRoID0gc2Nyb2xsR2FwKGNtKSArIFwicHhcIjtcbiAgICAgIGRpc3BsYXkuc2Nyb2xsYmFyc0NsaXBwZWQgPSB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIC8vIERvZXMgdGhlIGFjdHVhbCB1cGRhdGluZyBvZiB0aGUgbGluZSBkaXNwbGF5LiBCYWlscyBvdXRcbiAgLy8gKHJldHVybmluZyBmYWxzZSkgd2hlbiB0aGVyZSBpcyBub3RoaW5nIHRvIGJlIGRvbmUgYW5kIGZvcmNlZCBpc1xuICAvLyBmYWxzZS5cbiAgZnVuY3Rpb24gdXBkYXRlRGlzcGxheUlmTmVlZGVkKGNtLCB1cGRhdGUpIHtcbiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXksIGRvYyA9IGNtLmRvYztcblxuICAgIGlmICh1cGRhdGUuZWRpdG9ySXNIaWRkZW4pIHtcbiAgICAgIHJlc2V0VmlldyhjbSk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gQmFpbCBvdXQgaWYgdGhlIHZpc2libGUgYXJlYSBpcyBhbHJlYWR5IHJlbmRlcmVkIGFuZCBub3RoaW5nIGNoYW5nZWQuXG4gICAgaWYgKCF1cGRhdGUuZm9yY2UgJiZcbiAgICAgICAgdXBkYXRlLnZpc2libGUuZnJvbSA+PSBkaXNwbGF5LnZpZXdGcm9tICYmIHVwZGF0ZS52aXNpYmxlLnRvIDw9IGRpc3BsYXkudmlld1RvICYmXG4gICAgICAgIChkaXNwbGF5LnVwZGF0ZUxpbmVOdW1iZXJzID09IG51bGwgfHwgZGlzcGxheS51cGRhdGVMaW5lTnVtYmVycyA+PSBkaXNwbGF5LnZpZXdUbykgJiZcbiAgICAgICAgZGlzcGxheS5yZW5kZXJlZFZpZXcgPT0gZGlzcGxheS52aWV3ICYmIGNvdW50RGlydHlWaWV3KGNtKSA9PSAwKVxuICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgaWYgKG1heWJlVXBkYXRlTGluZU51bWJlcldpZHRoKGNtKSkge1xuICAgICAgcmVzZXRWaWV3KGNtKTtcbiAgICAgIHVwZGF0ZS5kaW1zID0gZ2V0RGltZW5zaW9ucyhjbSk7XG4gICAgfVxuXG4gICAgLy8gQ29tcHV0ZSBhIHN1aXRhYmxlIG5ldyB2aWV3cG9ydCAoZnJvbSAmIHRvKVxuICAgIHZhciBlbmQgPSBkb2MuZmlyc3QgKyBkb2Muc2l6ZTtcbiAgICB2YXIgZnJvbSA9IE1hdGgubWF4KHVwZGF0ZS52aXNpYmxlLmZyb20gLSBjbS5vcHRpb25zLnZpZXdwb3J0TWFyZ2luLCBkb2MuZmlyc3QpO1xuICAgIHZhciB0byA9IE1hdGgubWluKGVuZCwgdXBkYXRlLnZpc2libGUudG8gKyBjbS5vcHRpb25zLnZpZXdwb3J0TWFyZ2luKTtcbiAgICBpZiAoZGlzcGxheS52aWV3RnJvbSA8IGZyb20gJiYgZnJvbSAtIGRpc3BsYXkudmlld0Zyb20gPCAyMCkgZnJvbSA9IE1hdGgubWF4KGRvYy5maXJzdCwgZGlzcGxheS52aWV3RnJvbSk7XG4gICAgaWYgKGRpc3BsYXkudmlld1RvID4gdG8gJiYgZGlzcGxheS52aWV3VG8gLSB0byA8IDIwKSB0byA9IE1hdGgubWluKGVuZCwgZGlzcGxheS52aWV3VG8pO1xuICAgIGlmIChzYXdDb2xsYXBzZWRTcGFucykge1xuICAgICAgZnJvbSA9IHZpc3VhbExpbmVObyhjbS5kb2MsIGZyb20pO1xuICAgICAgdG8gPSB2aXN1YWxMaW5lRW5kTm8oY20uZG9jLCB0byk7XG4gICAgfVxuXG4gICAgdmFyIGRpZmZlcmVudCA9IGZyb20gIT0gZGlzcGxheS52aWV3RnJvbSB8fCB0byAhPSBkaXNwbGF5LnZpZXdUbyB8fFxuICAgICAgZGlzcGxheS5sYXN0V3JhcEhlaWdodCAhPSB1cGRhdGUud3JhcHBlckhlaWdodCB8fCBkaXNwbGF5Lmxhc3RXcmFwV2lkdGggIT0gdXBkYXRlLndyYXBwZXJXaWR0aDtcbiAgICBhZGp1c3RWaWV3KGNtLCBmcm9tLCB0byk7XG5cbiAgICBkaXNwbGF5LnZpZXdPZmZzZXQgPSBoZWlnaHRBdExpbmUoZ2V0TGluZShjbS5kb2MsIGRpc3BsYXkudmlld0Zyb20pKTtcbiAgICAvLyBQb3NpdGlvbiB0aGUgbW92ZXIgZGl2IHRvIGFsaWduIHdpdGggdGhlIGN1cnJlbnQgc2Nyb2xsIHBvc2l0aW9uXG4gICAgY20uZGlzcGxheS5tb3Zlci5zdHlsZS50b3AgPSBkaXNwbGF5LnZpZXdPZmZzZXQgKyBcInB4XCI7XG5cbiAgICB2YXIgdG9VcGRhdGUgPSBjb3VudERpcnR5VmlldyhjbSk7XG4gICAgaWYgKCFkaWZmZXJlbnQgJiYgdG9VcGRhdGUgPT0gMCAmJiAhdXBkYXRlLmZvcmNlICYmIGRpc3BsYXkucmVuZGVyZWRWaWV3ID09IGRpc3BsYXkudmlldyAmJlxuICAgICAgICAoZGlzcGxheS51cGRhdGVMaW5lTnVtYmVycyA9PSBudWxsIHx8IGRpc3BsYXkudXBkYXRlTGluZU51bWJlcnMgPj0gZGlzcGxheS52aWV3VG8pKVxuICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgLy8gRm9yIGJpZyBjaGFuZ2VzLCB3ZSBoaWRlIHRoZSBlbmNsb3NpbmcgZWxlbWVudCBkdXJpbmcgdGhlXG4gICAgLy8gdXBkYXRlLCBzaW5jZSB0aGF0IHNwZWVkcyB1cCB0aGUgb3BlcmF0aW9ucyBvbiBtb3N0IGJyb3dzZXJzLlxuICAgIHZhciBmb2N1c2VkID0gYWN0aXZlRWx0KCk7XG4gICAgaWYgKHRvVXBkYXRlID4gNCkgZGlzcGxheS5saW5lRGl2LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICBwYXRjaERpc3BsYXkoY20sIGRpc3BsYXkudXBkYXRlTGluZU51bWJlcnMsIHVwZGF0ZS5kaW1zKTtcbiAgICBpZiAodG9VcGRhdGUgPiA0KSBkaXNwbGF5LmxpbmVEaXYuc3R5bGUuZGlzcGxheSA9IFwiXCI7XG4gICAgZGlzcGxheS5yZW5kZXJlZFZpZXcgPSBkaXNwbGF5LnZpZXc7XG4gICAgLy8gVGhlcmUgbWlnaHQgaGF2ZSBiZWVuIGEgd2lkZ2V0IHdpdGggYSBmb2N1c2VkIGVsZW1lbnQgdGhhdCBnb3RcbiAgICAvLyBoaWRkZW4gb3IgdXBkYXRlZCwgaWYgc28gcmUtZm9jdXMgaXQuXG4gICAgaWYgKGZvY3VzZWQgJiYgYWN0aXZlRWx0KCkgIT0gZm9jdXNlZCAmJiBmb2N1c2VkLm9mZnNldEhlaWdodCkgZm9jdXNlZC5mb2N1cygpO1xuXG4gICAgLy8gUHJldmVudCBzZWxlY3Rpb24gYW5kIGN1cnNvcnMgZnJvbSBpbnRlcmZlcmluZyB3aXRoIHRoZSBzY3JvbGxcbiAgICAvLyB3aWR0aCBhbmQgaGVpZ2h0LlxuICAgIHJlbW92ZUNoaWxkcmVuKGRpc3BsYXkuY3Vyc29yRGl2KTtcbiAgICByZW1vdmVDaGlsZHJlbihkaXNwbGF5LnNlbGVjdGlvbkRpdik7XG4gICAgZGlzcGxheS5ndXR0ZXJzLnN0eWxlLmhlaWdodCA9IGRpc3BsYXkuc2l6ZXIuc3R5bGUubWluSGVpZ2h0ID0gMDtcblxuICAgIGlmIChkaWZmZXJlbnQpIHtcbiAgICAgIGRpc3BsYXkubGFzdFdyYXBIZWlnaHQgPSB1cGRhdGUud3JhcHBlckhlaWdodDtcbiAgICAgIGRpc3BsYXkubGFzdFdyYXBXaWR0aCA9IHVwZGF0ZS53cmFwcGVyV2lkdGg7XG4gICAgICBzdGFydFdvcmtlcihjbSwgNDAwKTtcbiAgICB9XG5cbiAgICBkaXNwbGF5LnVwZGF0ZUxpbmVOdW1iZXJzID0gbnVsbDtcblxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgZnVuY3Rpb24gcG9zdFVwZGF0ZURpc3BsYXkoY20sIHVwZGF0ZSkge1xuICAgIHZhciB2aWV3cG9ydCA9IHVwZGF0ZS52aWV3cG9ydDtcbiAgICBmb3IgKHZhciBmaXJzdCA9IHRydWU7OyBmaXJzdCA9IGZhbHNlKSB7XG4gICAgICBpZiAoIWZpcnN0IHx8ICFjbS5vcHRpb25zLmxpbmVXcmFwcGluZyB8fCB1cGRhdGUub2xkRGlzcGxheVdpZHRoID09IGRpc3BsYXlXaWR0aChjbSkpIHtcbiAgICAgICAgLy8gQ2xpcCBmb3JjZWQgdmlld3BvcnQgdG8gYWN0dWFsIHNjcm9sbGFibGUgYXJlYS5cbiAgICAgICAgaWYgKHZpZXdwb3J0ICYmIHZpZXdwb3J0LnRvcCAhPSBudWxsKVxuICAgICAgICAgIHZpZXdwb3J0ID0ge3RvcDogTWF0aC5taW4oY20uZG9jLmhlaWdodCArIHBhZGRpbmdWZXJ0KGNtLmRpc3BsYXkpIC0gZGlzcGxheUhlaWdodChjbSksIHZpZXdwb3J0LnRvcCl9O1xuICAgICAgICAvLyBVcGRhdGVkIGxpbmUgaGVpZ2h0cyBtaWdodCByZXN1bHQgaW4gdGhlIGRyYXduIGFyZWEgbm90XG4gICAgICAgIC8vIGFjdHVhbGx5IGNvdmVyaW5nIHRoZSB2aWV3cG9ydC4gS2VlcCBsb29waW5nIHVudGlsIGl0IGRvZXMuXG4gICAgICAgIHVwZGF0ZS52aXNpYmxlID0gdmlzaWJsZUxpbmVzKGNtLmRpc3BsYXksIGNtLmRvYywgdmlld3BvcnQpO1xuICAgICAgICBpZiAodXBkYXRlLnZpc2libGUuZnJvbSA+PSBjbS5kaXNwbGF5LnZpZXdGcm9tICYmIHVwZGF0ZS52aXNpYmxlLnRvIDw9IGNtLmRpc3BsYXkudmlld1RvKVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgaWYgKCF1cGRhdGVEaXNwbGF5SWZOZWVkZWQoY20sIHVwZGF0ZSkpIGJyZWFrO1xuICAgICAgdXBkYXRlSGVpZ2h0c0luVmlld3BvcnQoY20pO1xuICAgICAgdmFyIGJhck1lYXN1cmUgPSBtZWFzdXJlRm9yU2Nyb2xsYmFycyhjbSk7XG4gICAgICB1cGRhdGVTZWxlY3Rpb24oY20pO1xuICAgICAgc2V0RG9jdW1lbnRIZWlnaHQoY20sIGJhck1lYXN1cmUpO1xuICAgICAgdXBkYXRlU2Nyb2xsYmFycyhjbSwgYmFyTWVhc3VyZSk7XG4gICAgfVxuXG4gICAgdXBkYXRlLnNpZ25hbChjbSwgXCJ1cGRhdGVcIiwgY20pO1xuICAgIGlmIChjbS5kaXNwbGF5LnZpZXdGcm9tICE9IGNtLmRpc3BsYXkucmVwb3J0ZWRWaWV3RnJvbSB8fCBjbS5kaXNwbGF5LnZpZXdUbyAhPSBjbS5kaXNwbGF5LnJlcG9ydGVkVmlld1RvKSB7XG4gICAgICB1cGRhdGUuc2lnbmFsKGNtLCBcInZpZXdwb3J0Q2hhbmdlXCIsIGNtLCBjbS5kaXNwbGF5LnZpZXdGcm9tLCBjbS5kaXNwbGF5LnZpZXdUbyk7XG4gICAgICBjbS5kaXNwbGF5LnJlcG9ydGVkVmlld0Zyb20gPSBjbS5kaXNwbGF5LnZpZXdGcm9tOyBjbS5kaXNwbGF5LnJlcG9ydGVkVmlld1RvID0gY20uZGlzcGxheS52aWV3VG87XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gdXBkYXRlRGlzcGxheVNpbXBsZShjbSwgdmlld3BvcnQpIHtcbiAgICB2YXIgdXBkYXRlID0gbmV3IERpc3BsYXlVcGRhdGUoY20sIHZpZXdwb3J0KTtcbiAgICBpZiAodXBkYXRlRGlzcGxheUlmTmVlZGVkKGNtLCB1cGRhdGUpKSB7XG4gICAgICB1cGRhdGVIZWlnaHRzSW5WaWV3cG9ydChjbSk7XG4gICAgICBwb3N0VXBkYXRlRGlzcGxheShjbSwgdXBkYXRlKTtcbiAgICAgIHZhciBiYXJNZWFzdXJlID0gbWVhc3VyZUZvclNjcm9sbGJhcnMoY20pO1xuICAgICAgdXBkYXRlU2VsZWN0aW9uKGNtKTtcbiAgICAgIHNldERvY3VtZW50SGVpZ2h0KGNtLCBiYXJNZWFzdXJlKTtcbiAgICAgIHVwZGF0ZVNjcm9sbGJhcnMoY20sIGJhck1lYXN1cmUpO1xuICAgICAgdXBkYXRlLmZpbmlzaCgpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHNldERvY3VtZW50SGVpZ2h0KGNtLCBtZWFzdXJlKSB7XG4gICAgY20uZGlzcGxheS5zaXplci5zdHlsZS5taW5IZWlnaHQgPSBtZWFzdXJlLmRvY0hlaWdodCArIFwicHhcIjtcbiAgICB2YXIgdG90YWwgPSBtZWFzdXJlLmRvY0hlaWdodCArIGNtLmRpc3BsYXkuYmFySGVpZ2h0O1xuICAgIGNtLmRpc3BsYXkuaGVpZ2h0Rm9yY2VyLnN0eWxlLnRvcCA9IHRvdGFsICsgXCJweFwiO1xuICAgIGNtLmRpc3BsYXkuZ3V0dGVycy5zdHlsZS5oZWlnaHQgPSBNYXRoLm1heCh0b3RhbCArIHNjcm9sbEdhcChjbSksIG1lYXN1cmUuY2xpZW50SGVpZ2h0KSArIFwicHhcIjtcbiAgfVxuXG4gIC8vIFJlYWQgdGhlIGFjdHVhbCBoZWlnaHRzIG9mIHRoZSByZW5kZXJlZCBsaW5lcywgYW5kIHVwZGF0ZSB0aGVpclxuICAvLyBzdG9yZWQgaGVpZ2h0cyB0byBtYXRjaC5cbiAgZnVuY3Rpb24gdXBkYXRlSGVpZ2h0c0luVmlld3BvcnQoY20pIHtcbiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXk7XG4gICAgdmFyIHByZXZCb3R0b20gPSBkaXNwbGF5LmxpbmVEaXYub2Zmc2V0VG9wO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGlzcGxheS52aWV3Lmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgY3VyID0gZGlzcGxheS52aWV3W2ldLCBoZWlnaHQ7XG4gICAgICBpZiAoY3VyLmhpZGRlbikgY29udGludWU7XG4gICAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDgpIHtcbiAgICAgICAgdmFyIGJvdCA9IGN1ci5ub2RlLm9mZnNldFRvcCArIGN1ci5ub2RlLm9mZnNldEhlaWdodDtcbiAgICAgICAgaGVpZ2h0ID0gYm90IC0gcHJldkJvdHRvbTtcbiAgICAgICAgcHJldkJvdHRvbSA9IGJvdDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBib3ggPSBjdXIubm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgaGVpZ2h0ID0gYm94LmJvdHRvbSAtIGJveC50b3A7XG4gICAgICB9XG4gICAgICB2YXIgZGlmZiA9IGN1ci5saW5lLmhlaWdodCAtIGhlaWdodDtcbiAgICAgIGlmIChoZWlnaHQgPCAyKSBoZWlnaHQgPSB0ZXh0SGVpZ2h0KGRpc3BsYXkpO1xuICAgICAgaWYgKGRpZmYgPiAuMDAxIHx8IGRpZmYgPCAtLjAwMSkge1xuICAgICAgICB1cGRhdGVMaW5lSGVpZ2h0KGN1ci5saW5lLCBoZWlnaHQpO1xuICAgICAgICB1cGRhdGVXaWRnZXRIZWlnaHQoY3VyLmxpbmUpO1xuICAgICAgICBpZiAoY3VyLnJlc3QpIGZvciAodmFyIGogPSAwOyBqIDwgY3VyLnJlc3QubGVuZ3RoOyBqKyspXG4gICAgICAgICAgdXBkYXRlV2lkZ2V0SGVpZ2h0KGN1ci5yZXN0W2pdKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBSZWFkIGFuZCBzdG9yZSB0aGUgaGVpZ2h0IG9mIGxpbmUgd2lkZ2V0cyBhc3NvY2lhdGVkIHdpdGggdGhlXG4gIC8vIGdpdmVuIGxpbmUuXG4gIGZ1bmN0aW9uIHVwZGF0ZVdpZGdldEhlaWdodChsaW5lKSB7XG4gICAgaWYgKGxpbmUud2lkZ2V0cykgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lLndpZGdldHMubGVuZ3RoOyArK2kpXG4gICAgICBsaW5lLndpZGdldHNbaV0uaGVpZ2h0ID0gbGluZS53aWRnZXRzW2ldLm5vZGUub2Zmc2V0SGVpZ2h0O1xuICB9XG5cbiAgLy8gRG8gYSBidWxrLXJlYWQgb2YgdGhlIERPTSBwb3NpdGlvbnMgYW5kIHNpemVzIG5lZWRlZCB0byBkcmF3IHRoZVxuICAvLyB2aWV3LCBzbyB0aGF0IHdlIGRvbid0IGludGVybGVhdmUgcmVhZGluZyBhbmQgd3JpdGluZyB0byB0aGUgRE9NLlxuICBmdW5jdGlvbiBnZXREaW1lbnNpb25zKGNtKSB7XG4gICAgdmFyIGQgPSBjbS5kaXNwbGF5LCBsZWZ0ID0ge30sIHdpZHRoID0ge307XG4gICAgdmFyIGd1dHRlckxlZnQgPSBkLmd1dHRlcnMuY2xpZW50TGVmdDtcbiAgICBmb3IgKHZhciBuID0gZC5ndXR0ZXJzLmZpcnN0Q2hpbGQsIGkgPSAwOyBuOyBuID0gbi5uZXh0U2libGluZywgKytpKSB7XG4gICAgICBsZWZ0W2NtLm9wdGlvbnMuZ3V0dGVyc1tpXV0gPSBuLm9mZnNldExlZnQgKyBuLmNsaWVudExlZnQgKyBndXR0ZXJMZWZ0O1xuICAgICAgd2lkdGhbY20ub3B0aW9ucy5ndXR0ZXJzW2ldXSA9IG4uY2xpZW50V2lkdGg7XG4gICAgfVxuICAgIHJldHVybiB7Zml4ZWRQb3M6IGNvbXBlbnNhdGVGb3JIU2Nyb2xsKGQpLFxuICAgICAgICAgICAgZ3V0dGVyVG90YWxXaWR0aDogZC5ndXR0ZXJzLm9mZnNldFdpZHRoLFxuICAgICAgICAgICAgZ3V0dGVyTGVmdDogbGVmdCxcbiAgICAgICAgICAgIGd1dHRlcldpZHRoOiB3aWR0aCxcbiAgICAgICAgICAgIHdyYXBwZXJXaWR0aDogZC53cmFwcGVyLmNsaWVudFdpZHRofTtcbiAgfVxuXG4gIC8vIFN5bmMgdGhlIGFjdHVhbCBkaXNwbGF5IERPTSBzdHJ1Y3R1cmUgd2l0aCBkaXNwbGF5LnZpZXcsIHJlbW92aW5nXG4gIC8vIG5vZGVzIGZvciBsaW5lcyB0aGF0IGFyZSBubyBsb25nZXIgaW4gdmlldywgYW5kIGNyZWF0aW5nIHRoZSBvbmVzXG4gIC8vIHRoYXQgYXJlIG5vdCB0aGVyZSB5ZXQsIGFuZCB1cGRhdGluZyB0aGUgb25lcyB0aGF0IGFyZSBvdXQgb2ZcbiAgLy8gZGF0ZS5cbiAgZnVuY3Rpb24gcGF0Y2hEaXNwbGF5KGNtLCB1cGRhdGVOdW1iZXJzRnJvbSwgZGltcykge1xuICAgIHZhciBkaXNwbGF5ID0gY20uZGlzcGxheSwgbGluZU51bWJlcnMgPSBjbS5vcHRpb25zLmxpbmVOdW1iZXJzO1xuICAgIHZhciBjb250YWluZXIgPSBkaXNwbGF5LmxpbmVEaXYsIGN1ciA9IGNvbnRhaW5lci5maXJzdENoaWxkO1xuXG4gICAgZnVuY3Rpb24gcm0obm9kZSkge1xuICAgICAgdmFyIG5leHQgPSBub2RlLm5leHRTaWJsaW5nO1xuICAgICAgLy8gV29ya3MgYXJvdW5kIGEgdGhyb3ctc2Nyb2xsIGJ1ZyBpbiBPUyBYIFdlYmtpdFxuICAgICAgaWYgKHdlYmtpdCAmJiBtYWMgJiYgY20uZGlzcGxheS5jdXJyZW50V2hlZWxUYXJnZXQgPT0gbm9kZSlcbiAgICAgICAgbm9kZS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICBlbHNlXG4gICAgICAgIG5vZGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChub2RlKTtcbiAgICAgIHJldHVybiBuZXh0O1xuICAgIH1cblxuICAgIHZhciB2aWV3ID0gZGlzcGxheS52aWV3LCBsaW5lTiA9IGRpc3BsYXkudmlld0Zyb207XG4gICAgLy8gTG9vcCBvdmVyIHRoZSBlbGVtZW50cyBpbiB0aGUgdmlldywgc3luY2luZyBjdXIgKHRoZSBET00gbm9kZXNcbiAgICAvLyBpbiBkaXNwbGF5LmxpbmVEaXYpIHdpdGggdGhlIHZpZXcgYXMgd2UgZ28uXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2aWV3Lmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgbGluZVZpZXcgPSB2aWV3W2ldO1xuICAgICAgaWYgKGxpbmVWaWV3LmhpZGRlbikge1xuICAgICAgfSBlbHNlIGlmICghbGluZVZpZXcubm9kZSB8fCBsaW5lVmlldy5ub2RlLnBhcmVudE5vZGUgIT0gY29udGFpbmVyKSB7IC8vIE5vdCBkcmF3biB5ZXRcbiAgICAgICAgdmFyIG5vZGUgPSBidWlsZExpbmVFbGVtZW50KGNtLCBsaW5lVmlldywgbGluZU4sIGRpbXMpO1xuICAgICAgICBjb250YWluZXIuaW5zZXJ0QmVmb3JlKG5vZGUsIGN1cik7XG4gICAgICB9IGVsc2UgeyAvLyBBbHJlYWR5IGRyYXduXG4gICAgICAgIHdoaWxlIChjdXIgIT0gbGluZVZpZXcubm9kZSkgY3VyID0gcm0oY3VyKTtcbiAgICAgICAgdmFyIHVwZGF0ZU51bWJlciA9IGxpbmVOdW1iZXJzICYmIHVwZGF0ZU51bWJlcnNGcm9tICE9IG51bGwgJiZcbiAgICAgICAgICB1cGRhdGVOdW1iZXJzRnJvbSA8PSBsaW5lTiAmJiBsaW5lVmlldy5saW5lTnVtYmVyO1xuICAgICAgICBpZiAobGluZVZpZXcuY2hhbmdlcykge1xuICAgICAgICAgIGlmIChpbmRleE9mKGxpbmVWaWV3LmNoYW5nZXMsIFwiZ3V0dGVyXCIpID4gLTEpIHVwZGF0ZU51bWJlciA9IGZhbHNlO1xuICAgICAgICAgIHVwZGF0ZUxpbmVGb3JDaGFuZ2VzKGNtLCBsaW5lVmlldywgbGluZU4sIGRpbXMpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh1cGRhdGVOdW1iZXIpIHtcbiAgICAgICAgICByZW1vdmVDaGlsZHJlbihsaW5lVmlldy5saW5lTnVtYmVyKTtcbiAgICAgICAgICBsaW5lVmlldy5saW5lTnVtYmVyLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGxpbmVOdW1iZXJGb3IoY20ub3B0aW9ucywgbGluZU4pKSk7XG4gICAgICAgIH1cbiAgICAgICAgY3VyID0gbGluZVZpZXcubm9kZS5uZXh0U2libGluZztcbiAgICAgIH1cbiAgICAgIGxpbmVOICs9IGxpbmVWaWV3LnNpemU7XG4gICAgfVxuICAgIHdoaWxlIChjdXIpIGN1ciA9IHJtKGN1cik7XG4gIH1cblxuICAvLyBXaGVuIGFuIGFzcGVjdCBvZiBhIGxpbmUgY2hhbmdlcywgYSBzdHJpbmcgaXMgYWRkZWQgdG9cbiAgLy8gbGluZVZpZXcuY2hhbmdlcy4gVGhpcyB1cGRhdGVzIHRoZSByZWxldmFudCBwYXJ0IG9mIHRoZSBsaW5lJ3NcbiAgLy8gRE9NIHN0cnVjdHVyZS5cbiAgZnVuY3Rpb24gdXBkYXRlTGluZUZvckNoYW5nZXMoY20sIGxpbmVWaWV3LCBsaW5lTiwgZGltcykge1xuICAgIGZvciAodmFyIGogPSAwOyBqIDwgbGluZVZpZXcuY2hhbmdlcy5sZW5ndGg7IGorKykge1xuICAgICAgdmFyIHR5cGUgPSBsaW5lVmlldy5jaGFuZ2VzW2pdO1xuICAgICAgaWYgKHR5cGUgPT0gXCJ0ZXh0XCIpIHVwZGF0ZUxpbmVUZXh0KGNtLCBsaW5lVmlldyk7XG4gICAgICBlbHNlIGlmICh0eXBlID09IFwiZ3V0dGVyXCIpIHVwZGF0ZUxpbmVHdXR0ZXIoY20sIGxpbmVWaWV3LCBsaW5lTiwgZGltcyk7XG4gICAgICBlbHNlIGlmICh0eXBlID09IFwiY2xhc3NcIikgdXBkYXRlTGluZUNsYXNzZXMobGluZVZpZXcpO1xuICAgICAgZWxzZSBpZiAodHlwZSA9PSBcIndpZGdldFwiKSB1cGRhdGVMaW5lV2lkZ2V0cyhjbSwgbGluZVZpZXcsIGRpbXMpO1xuICAgIH1cbiAgICBsaW5lVmlldy5jaGFuZ2VzID0gbnVsbDtcbiAgfVxuXG4gIC8vIExpbmVzIHdpdGggZ3V0dGVyIGVsZW1lbnRzLCB3aWRnZXRzIG9yIGEgYmFja2dyb3VuZCBjbGFzcyBuZWVkIHRvXG4gIC8vIGJlIHdyYXBwZWQsIGFuZCBoYXZlIHRoZSBleHRyYSBlbGVtZW50cyBhZGRlZCB0byB0aGUgd3JhcHBlciBkaXZcbiAgZnVuY3Rpb24gZW5zdXJlTGluZVdyYXBwZWQobGluZVZpZXcpIHtcbiAgICBpZiAobGluZVZpZXcubm9kZSA9PSBsaW5lVmlldy50ZXh0KSB7XG4gICAgICBsaW5lVmlldy5ub2RlID0gZWx0KFwiZGl2XCIsIG51bGwsIG51bGwsIFwicG9zaXRpb246IHJlbGF0aXZlXCIpO1xuICAgICAgaWYgKGxpbmVWaWV3LnRleHQucGFyZW50Tm9kZSlcbiAgICAgICAgbGluZVZpZXcudGV4dC5wYXJlbnROb2RlLnJlcGxhY2VDaGlsZChsaW5lVmlldy5ub2RlLCBsaW5lVmlldy50ZXh0KTtcbiAgICAgIGxpbmVWaWV3Lm5vZGUuYXBwZW5kQ2hpbGQobGluZVZpZXcudGV4dCk7XG4gICAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDgpIGxpbmVWaWV3Lm5vZGUuc3R5bGUuekluZGV4ID0gMjtcbiAgICB9XG4gICAgcmV0dXJuIGxpbmVWaWV3Lm5vZGU7XG4gIH1cblxuICBmdW5jdGlvbiB1cGRhdGVMaW5lQmFja2dyb3VuZChsaW5lVmlldykge1xuICAgIHZhciBjbHMgPSBsaW5lVmlldy5iZ0NsYXNzID8gbGluZVZpZXcuYmdDbGFzcyArIFwiIFwiICsgKGxpbmVWaWV3LmxpbmUuYmdDbGFzcyB8fCBcIlwiKSA6IGxpbmVWaWV3LmxpbmUuYmdDbGFzcztcbiAgICBpZiAoY2xzKSBjbHMgKz0gXCIgQ29kZU1pcnJvci1saW5lYmFja2dyb3VuZFwiO1xuICAgIGlmIChsaW5lVmlldy5iYWNrZ3JvdW5kKSB7XG4gICAgICBpZiAoY2xzKSBsaW5lVmlldy5iYWNrZ3JvdW5kLmNsYXNzTmFtZSA9IGNscztcbiAgICAgIGVsc2UgeyBsaW5lVmlldy5iYWNrZ3JvdW5kLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobGluZVZpZXcuYmFja2dyb3VuZCk7IGxpbmVWaWV3LmJhY2tncm91bmQgPSBudWxsOyB9XG4gICAgfSBlbHNlIGlmIChjbHMpIHtcbiAgICAgIHZhciB3cmFwID0gZW5zdXJlTGluZVdyYXBwZWQobGluZVZpZXcpO1xuICAgICAgbGluZVZpZXcuYmFja2dyb3VuZCA9IHdyYXAuaW5zZXJ0QmVmb3JlKGVsdChcImRpdlwiLCBudWxsLCBjbHMpLCB3cmFwLmZpcnN0Q2hpbGQpO1xuICAgIH1cbiAgfVxuXG4gIC8vIFdyYXBwZXIgYXJvdW5kIGJ1aWxkTGluZUNvbnRlbnQgd2hpY2ggd2lsbCByZXVzZSB0aGUgc3RydWN0dXJlXG4gIC8vIGluIGRpc3BsYXkuZXh0ZXJuYWxNZWFzdXJlZCB3aGVuIHBvc3NpYmxlLlxuICBmdW5jdGlvbiBnZXRMaW5lQ29udGVudChjbSwgbGluZVZpZXcpIHtcbiAgICB2YXIgZXh0ID0gY20uZGlzcGxheS5leHRlcm5hbE1lYXN1cmVkO1xuICAgIGlmIChleHQgJiYgZXh0LmxpbmUgPT0gbGluZVZpZXcubGluZSkge1xuICAgICAgY20uZGlzcGxheS5leHRlcm5hbE1lYXN1cmVkID0gbnVsbDtcbiAgICAgIGxpbmVWaWV3Lm1lYXN1cmUgPSBleHQubWVhc3VyZTtcbiAgICAgIHJldHVybiBleHQuYnVpbHQ7XG4gICAgfVxuICAgIHJldHVybiBidWlsZExpbmVDb250ZW50KGNtLCBsaW5lVmlldyk7XG4gIH1cblxuICAvLyBSZWRyYXcgdGhlIGxpbmUncyB0ZXh0LiBJbnRlcmFjdHMgd2l0aCB0aGUgYmFja2dyb3VuZCBhbmQgdGV4dFxuICAvLyBjbGFzc2VzIGJlY2F1c2UgdGhlIG1vZGUgbWF5IG91dHB1dCB0b2tlbnMgdGhhdCBpbmZsdWVuY2UgdGhlc2VcbiAgLy8gY2xhc3Nlcy5cbiAgZnVuY3Rpb24gdXBkYXRlTGluZVRleHQoY20sIGxpbmVWaWV3KSB7XG4gICAgdmFyIGNscyA9IGxpbmVWaWV3LnRleHQuY2xhc3NOYW1lO1xuICAgIHZhciBidWlsdCA9IGdldExpbmVDb250ZW50KGNtLCBsaW5lVmlldyk7XG4gICAgaWYgKGxpbmVWaWV3LnRleHQgPT0gbGluZVZpZXcubm9kZSkgbGluZVZpZXcubm9kZSA9IGJ1aWx0LnByZTtcbiAgICBsaW5lVmlldy50ZXh0LnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGJ1aWx0LnByZSwgbGluZVZpZXcudGV4dCk7XG4gICAgbGluZVZpZXcudGV4dCA9IGJ1aWx0LnByZTtcbiAgICBpZiAoYnVpbHQuYmdDbGFzcyAhPSBsaW5lVmlldy5iZ0NsYXNzIHx8IGJ1aWx0LnRleHRDbGFzcyAhPSBsaW5lVmlldy50ZXh0Q2xhc3MpIHtcbiAgICAgIGxpbmVWaWV3LmJnQ2xhc3MgPSBidWlsdC5iZ0NsYXNzO1xuICAgICAgbGluZVZpZXcudGV4dENsYXNzID0gYnVpbHQudGV4dENsYXNzO1xuICAgICAgdXBkYXRlTGluZUNsYXNzZXMobGluZVZpZXcpO1xuICAgIH0gZWxzZSBpZiAoY2xzKSB7XG4gICAgICBsaW5lVmlldy50ZXh0LmNsYXNzTmFtZSA9IGNscztcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiB1cGRhdGVMaW5lQ2xhc3NlcyhsaW5lVmlldykge1xuICAgIHVwZGF0ZUxpbmVCYWNrZ3JvdW5kKGxpbmVWaWV3KTtcbiAgICBpZiAobGluZVZpZXcubGluZS53cmFwQ2xhc3MpXG4gICAgICBlbnN1cmVMaW5lV3JhcHBlZChsaW5lVmlldykuY2xhc3NOYW1lID0gbGluZVZpZXcubGluZS53cmFwQ2xhc3M7XG4gICAgZWxzZSBpZiAobGluZVZpZXcubm9kZSAhPSBsaW5lVmlldy50ZXh0KVxuICAgICAgbGluZVZpZXcubm9kZS5jbGFzc05hbWUgPSBcIlwiO1xuICAgIHZhciB0ZXh0Q2xhc3MgPSBsaW5lVmlldy50ZXh0Q2xhc3MgPyBsaW5lVmlldy50ZXh0Q2xhc3MgKyBcIiBcIiArIChsaW5lVmlldy5saW5lLnRleHRDbGFzcyB8fCBcIlwiKSA6IGxpbmVWaWV3LmxpbmUudGV4dENsYXNzO1xuICAgIGxpbmVWaWV3LnRleHQuY2xhc3NOYW1lID0gdGV4dENsYXNzIHx8IFwiXCI7XG4gIH1cblxuICBmdW5jdGlvbiB1cGRhdGVMaW5lR3V0dGVyKGNtLCBsaW5lVmlldywgbGluZU4sIGRpbXMpIHtcbiAgICBpZiAobGluZVZpZXcuZ3V0dGVyKSB7XG4gICAgICBsaW5lVmlldy5ub2RlLnJlbW92ZUNoaWxkKGxpbmVWaWV3Lmd1dHRlcik7XG4gICAgICBsaW5lVmlldy5ndXR0ZXIgPSBudWxsO1xuICAgIH1cbiAgICBpZiAobGluZVZpZXcuZ3V0dGVyQmFja2dyb3VuZCkge1xuICAgICAgbGluZVZpZXcubm9kZS5yZW1vdmVDaGlsZChsaW5lVmlldy5ndXR0ZXJCYWNrZ3JvdW5kKTtcbiAgICAgIGxpbmVWaWV3Lmd1dHRlckJhY2tncm91bmQgPSBudWxsO1xuICAgIH1cbiAgICBpZiAobGluZVZpZXcubGluZS5ndXR0ZXJDbGFzcykge1xuICAgICAgdmFyIHdyYXAgPSBlbnN1cmVMaW5lV3JhcHBlZChsaW5lVmlldyk7XG4gICAgICBsaW5lVmlldy5ndXR0ZXJCYWNrZ3JvdW5kID0gZWx0KFwiZGl2XCIsIG51bGwsIFwiQ29kZU1pcnJvci1ndXR0ZXItYmFja2dyb3VuZCBcIiArIGxpbmVWaWV3LmxpbmUuZ3V0dGVyQ2xhc3MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwibGVmdDogXCIgKyAoY20ub3B0aW9ucy5maXhlZEd1dHRlciA/IGRpbXMuZml4ZWRQb3MgOiAtZGltcy5ndXR0ZXJUb3RhbFdpZHRoKSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwicHg7IHdpZHRoOiBcIiArIGRpbXMuZ3V0dGVyVG90YWxXaWR0aCArIFwicHhcIik7XG4gICAgICB3cmFwLmluc2VydEJlZm9yZShsaW5lVmlldy5ndXR0ZXJCYWNrZ3JvdW5kLCBsaW5lVmlldy50ZXh0KTtcbiAgICB9XG4gICAgdmFyIG1hcmtlcnMgPSBsaW5lVmlldy5saW5lLmd1dHRlck1hcmtlcnM7XG4gICAgaWYgKGNtLm9wdGlvbnMubGluZU51bWJlcnMgfHwgbWFya2Vycykge1xuICAgICAgdmFyIHdyYXAgPSBlbnN1cmVMaW5lV3JhcHBlZChsaW5lVmlldyk7XG4gICAgICB2YXIgZ3V0dGVyV3JhcCA9IGxpbmVWaWV3Lmd1dHRlciA9IGVsdChcImRpdlwiLCBudWxsLCBcIkNvZGVNaXJyb3ItZ3V0dGVyLXdyYXBwZXJcIiwgXCJsZWZ0OiBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoY20ub3B0aW9ucy5maXhlZEd1dHRlciA/IGRpbXMuZml4ZWRQb3MgOiAtZGltcy5ndXR0ZXJUb3RhbFdpZHRoKSArIFwicHhcIik7XG4gICAgICBjbS5kaXNwbGF5LmlucHV0LnNldFVuZWRpdGFibGUoZ3V0dGVyV3JhcCk7XG4gICAgICB3cmFwLmluc2VydEJlZm9yZShndXR0ZXJXcmFwLCBsaW5lVmlldy50ZXh0KTtcbiAgICAgIGlmIChsaW5lVmlldy5saW5lLmd1dHRlckNsYXNzKVxuICAgICAgICBndXR0ZXJXcmFwLmNsYXNzTmFtZSArPSBcIiBcIiArIGxpbmVWaWV3LmxpbmUuZ3V0dGVyQ2xhc3M7XG4gICAgICBpZiAoY20ub3B0aW9ucy5saW5lTnVtYmVycyAmJiAoIW1hcmtlcnMgfHwgIW1hcmtlcnNbXCJDb2RlTWlycm9yLWxpbmVudW1iZXJzXCJdKSlcbiAgICAgICAgbGluZVZpZXcubGluZU51bWJlciA9IGd1dHRlcldyYXAuYXBwZW5kQ2hpbGQoXG4gICAgICAgICAgZWx0KFwiZGl2XCIsIGxpbmVOdW1iZXJGb3IoY20ub3B0aW9ucywgbGluZU4pLFxuICAgICAgICAgICAgICBcIkNvZGVNaXJyb3ItbGluZW51bWJlciBDb2RlTWlycm9yLWd1dHRlci1lbHRcIixcbiAgICAgICAgICAgICAgXCJsZWZ0OiBcIiArIGRpbXMuZ3V0dGVyTGVmdFtcIkNvZGVNaXJyb3ItbGluZW51bWJlcnNcIl0gKyBcInB4OyB3aWR0aDogXCJcbiAgICAgICAgICAgICAgKyBjbS5kaXNwbGF5LmxpbmVOdW1Jbm5lcldpZHRoICsgXCJweFwiKSk7XG4gICAgICBpZiAobWFya2VycykgZm9yICh2YXIgayA9IDA7IGsgPCBjbS5vcHRpb25zLmd1dHRlcnMubGVuZ3RoOyArK2spIHtcbiAgICAgICAgdmFyIGlkID0gY20ub3B0aW9ucy5ndXR0ZXJzW2tdLCBmb3VuZCA9IG1hcmtlcnMuaGFzT3duUHJvcGVydHkoaWQpICYmIG1hcmtlcnNbaWRdO1xuICAgICAgICBpZiAoZm91bmQpXG4gICAgICAgICAgZ3V0dGVyV3JhcC5hcHBlbmRDaGlsZChlbHQoXCJkaXZcIiwgW2ZvdW5kXSwgXCJDb2RlTWlycm9yLWd1dHRlci1lbHRcIiwgXCJsZWZ0OiBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGltcy5ndXR0ZXJMZWZ0W2lkXSArIFwicHg7IHdpZHRoOiBcIiArIGRpbXMuZ3V0dGVyV2lkdGhbaWRdICsgXCJweFwiKSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gdXBkYXRlTGluZVdpZGdldHMoY20sIGxpbmVWaWV3LCBkaW1zKSB7XG4gICAgaWYgKGxpbmVWaWV3LmFsaWduYWJsZSkgbGluZVZpZXcuYWxpZ25hYmxlID0gbnVsbDtcbiAgICBmb3IgKHZhciBub2RlID0gbGluZVZpZXcubm9kZS5maXJzdENoaWxkLCBuZXh0OyBub2RlOyBub2RlID0gbmV4dCkge1xuICAgICAgdmFyIG5leHQgPSBub2RlLm5leHRTaWJsaW5nO1xuICAgICAgaWYgKG5vZGUuY2xhc3NOYW1lID09IFwiQ29kZU1pcnJvci1saW5ld2lkZ2V0XCIpXG4gICAgICAgIGxpbmVWaWV3Lm5vZGUucmVtb3ZlQ2hpbGQobm9kZSk7XG4gICAgfVxuICAgIGluc2VydExpbmVXaWRnZXRzKGNtLCBsaW5lVmlldywgZGltcyk7XG4gIH1cblxuICAvLyBCdWlsZCBhIGxpbmUncyBET00gcmVwcmVzZW50YXRpb24gZnJvbSBzY3JhdGNoXG4gIGZ1bmN0aW9uIGJ1aWxkTGluZUVsZW1lbnQoY20sIGxpbmVWaWV3LCBsaW5lTiwgZGltcykge1xuICAgIHZhciBidWlsdCA9IGdldExpbmVDb250ZW50KGNtLCBsaW5lVmlldyk7XG4gICAgbGluZVZpZXcudGV4dCA9IGxpbmVWaWV3Lm5vZGUgPSBidWlsdC5wcmU7XG4gICAgaWYgKGJ1aWx0LmJnQ2xhc3MpIGxpbmVWaWV3LmJnQ2xhc3MgPSBidWlsdC5iZ0NsYXNzO1xuICAgIGlmIChidWlsdC50ZXh0Q2xhc3MpIGxpbmVWaWV3LnRleHRDbGFzcyA9IGJ1aWx0LnRleHRDbGFzcztcblxuICAgIHVwZGF0ZUxpbmVDbGFzc2VzKGxpbmVWaWV3KTtcbiAgICB1cGRhdGVMaW5lR3V0dGVyKGNtLCBsaW5lVmlldywgbGluZU4sIGRpbXMpO1xuICAgIGluc2VydExpbmVXaWRnZXRzKGNtLCBsaW5lVmlldywgZGltcyk7XG4gICAgcmV0dXJuIGxpbmVWaWV3Lm5vZGU7XG4gIH1cblxuICAvLyBBIGxpbmVWaWV3IG1heSBjb250YWluIG11bHRpcGxlIGxvZ2ljYWwgbGluZXMgKHdoZW4gbWVyZ2VkIGJ5XG4gIC8vIGNvbGxhcHNlZCBzcGFucykuIFRoZSB3aWRnZXRzIGZvciBhbGwgb2YgdGhlbSBuZWVkIHRvIGJlIGRyYXduLlxuICBmdW5jdGlvbiBpbnNlcnRMaW5lV2lkZ2V0cyhjbSwgbGluZVZpZXcsIGRpbXMpIHtcbiAgICBpbnNlcnRMaW5lV2lkZ2V0c0ZvcihjbSwgbGluZVZpZXcubGluZSwgbGluZVZpZXcsIGRpbXMsIHRydWUpO1xuICAgIGlmIChsaW5lVmlldy5yZXN0KSBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmVWaWV3LnJlc3QubGVuZ3RoOyBpKyspXG4gICAgICBpbnNlcnRMaW5lV2lkZ2V0c0ZvcihjbSwgbGluZVZpZXcucmVzdFtpXSwgbGluZVZpZXcsIGRpbXMsIGZhbHNlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGluc2VydExpbmVXaWRnZXRzRm9yKGNtLCBsaW5lLCBsaW5lVmlldywgZGltcywgYWxsb3dBYm92ZSkge1xuICAgIGlmICghbGluZS53aWRnZXRzKSByZXR1cm47XG4gICAgdmFyIHdyYXAgPSBlbnN1cmVMaW5lV3JhcHBlZChsaW5lVmlldyk7XG4gICAgZm9yICh2YXIgaSA9IDAsIHdzID0gbGluZS53aWRnZXRzOyBpIDwgd3MubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciB3aWRnZXQgPSB3c1tpXSwgbm9kZSA9IGVsdChcImRpdlwiLCBbd2lkZ2V0Lm5vZGVdLCBcIkNvZGVNaXJyb3ItbGluZXdpZGdldFwiKTtcbiAgICAgIGlmICghd2lkZ2V0LmhhbmRsZU1vdXNlRXZlbnRzKSBub2RlLnNldEF0dHJpYnV0ZShcImNtLWlnbm9yZS1ldmVudHNcIiwgXCJ0cnVlXCIpO1xuICAgICAgcG9zaXRpb25MaW5lV2lkZ2V0KHdpZGdldCwgbm9kZSwgbGluZVZpZXcsIGRpbXMpO1xuICAgICAgY20uZGlzcGxheS5pbnB1dC5zZXRVbmVkaXRhYmxlKG5vZGUpO1xuICAgICAgaWYgKGFsbG93QWJvdmUgJiYgd2lkZ2V0LmFib3ZlKVxuICAgICAgICB3cmFwLmluc2VydEJlZm9yZShub2RlLCBsaW5lVmlldy5ndXR0ZXIgfHwgbGluZVZpZXcudGV4dCk7XG4gICAgICBlbHNlXG4gICAgICAgIHdyYXAuYXBwZW5kQ2hpbGQobm9kZSk7XG4gICAgICBzaWduYWxMYXRlcih3aWRnZXQsIFwicmVkcmF3XCIpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHBvc2l0aW9uTGluZVdpZGdldCh3aWRnZXQsIG5vZGUsIGxpbmVWaWV3LCBkaW1zKSB7XG4gICAgaWYgKHdpZGdldC5ub0hTY3JvbGwpIHtcbiAgICAgIChsaW5lVmlldy5hbGlnbmFibGUgfHwgKGxpbmVWaWV3LmFsaWduYWJsZSA9IFtdKSkucHVzaChub2RlKTtcbiAgICAgIHZhciB3aWR0aCA9IGRpbXMud3JhcHBlcldpZHRoO1xuICAgICAgbm9kZS5zdHlsZS5sZWZ0ID0gZGltcy5maXhlZFBvcyArIFwicHhcIjtcbiAgICAgIGlmICghd2lkZ2V0LmNvdmVyR3V0dGVyKSB7XG4gICAgICAgIHdpZHRoIC09IGRpbXMuZ3V0dGVyVG90YWxXaWR0aDtcbiAgICAgICAgbm9kZS5zdHlsZS5wYWRkaW5nTGVmdCA9IGRpbXMuZ3V0dGVyVG90YWxXaWR0aCArIFwicHhcIjtcbiAgICAgIH1cbiAgICAgIG5vZGUuc3R5bGUud2lkdGggPSB3aWR0aCArIFwicHhcIjtcbiAgICB9XG4gICAgaWYgKHdpZGdldC5jb3Zlckd1dHRlcikge1xuICAgICAgbm9kZS5zdHlsZS56SW5kZXggPSA1O1xuICAgICAgbm9kZS5zdHlsZS5wb3NpdGlvbiA9IFwicmVsYXRpdmVcIjtcbiAgICAgIGlmICghd2lkZ2V0Lm5vSFNjcm9sbCkgbm9kZS5zdHlsZS5tYXJnaW5MZWZ0ID0gLWRpbXMuZ3V0dGVyVG90YWxXaWR0aCArIFwicHhcIjtcbiAgICB9XG4gIH1cblxuICAvLyBQT1NJVElPTiBPQkpFQ1RcblxuICAvLyBBIFBvcyBpbnN0YW5jZSByZXByZXNlbnRzIGEgcG9zaXRpb24gd2l0aGluIHRoZSB0ZXh0LlxuICB2YXIgUG9zID0gQ29kZU1pcnJvci5Qb3MgPSBmdW5jdGlvbihsaW5lLCBjaCkge1xuICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBQb3MpKSByZXR1cm4gbmV3IFBvcyhsaW5lLCBjaCk7XG4gICAgdGhpcy5saW5lID0gbGluZTsgdGhpcy5jaCA9IGNoO1xuICB9O1xuXG4gIC8vIENvbXBhcmUgdHdvIHBvc2l0aW9ucywgcmV0dXJuIDAgaWYgdGhleSBhcmUgdGhlIHNhbWUsIGEgbmVnYXRpdmVcbiAgLy8gbnVtYmVyIHdoZW4gYSBpcyBsZXNzLCBhbmQgYSBwb3NpdGl2ZSBudW1iZXIgb3RoZXJ3aXNlLlxuICB2YXIgY21wID0gQ29kZU1pcnJvci5jbXBQb3MgPSBmdW5jdGlvbihhLCBiKSB7IHJldHVybiBhLmxpbmUgLSBiLmxpbmUgfHwgYS5jaCAtIGIuY2g7IH07XG5cbiAgZnVuY3Rpb24gY29weVBvcyh4KSB7cmV0dXJuIFBvcyh4LmxpbmUsIHguY2gpO31cbiAgZnVuY3Rpb24gbWF4UG9zKGEsIGIpIHsgcmV0dXJuIGNtcChhLCBiKSA8IDAgPyBiIDogYTsgfVxuICBmdW5jdGlvbiBtaW5Qb3MoYSwgYikgeyByZXR1cm4gY21wKGEsIGIpIDwgMCA/IGEgOiBiOyB9XG5cbiAgLy8gSU5QVVQgSEFORExJTkdcblxuICBmdW5jdGlvbiBlbnN1cmVGb2N1cyhjbSkge1xuICAgIGlmICghY20uc3RhdGUuZm9jdXNlZCkgeyBjbS5kaXNwbGF5LmlucHV0LmZvY3VzKCk7IG9uRm9jdXMoY20pOyB9XG4gIH1cblxuICBmdW5jdGlvbiBpc1JlYWRPbmx5KGNtKSB7XG4gICAgcmV0dXJuIGNtLm9wdGlvbnMucmVhZE9ubHkgfHwgY20uZG9jLmNhbnRFZGl0O1xuICB9XG5cbiAgLy8gVGhpcyB3aWxsIGJlIHNldCB0byBhbiBhcnJheSBvZiBzdHJpbmdzIHdoZW4gY29weWluZywgc28gdGhhdCxcbiAgLy8gd2hlbiBwYXN0aW5nLCB3ZSBrbm93IHdoYXQga2luZCBvZiBzZWxlY3Rpb25zIHRoZSBjb3BpZWQgdGV4dFxuICAvLyB3YXMgbWFkZSBvdXQgb2YuXG4gIHZhciBsYXN0Q29waWVkID0gbnVsbDtcblxuICBmdW5jdGlvbiBhcHBseVRleHRJbnB1dChjbSwgaW5zZXJ0ZWQsIGRlbGV0ZWQsIHNlbCwgb3JpZ2luKSB7XG4gICAgdmFyIGRvYyA9IGNtLmRvYztcbiAgICBjbS5kaXNwbGF5LnNoaWZ0ID0gZmFsc2U7XG4gICAgaWYgKCFzZWwpIHNlbCA9IGRvYy5zZWw7XG5cbiAgICB2YXIgcGFzdGUgPSBjbS5zdGF0ZS5wYXN0ZUluY29taW5nIHx8IG9yaWdpbiA9PSBcInBhc3RlXCI7XG4gICAgdmFyIHRleHRMaW5lcyA9IGRvYy5zcGxpdExpbmVzKGluc2VydGVkKSwgbXVsdGlQYXN0ZSA9IG51bGw7XG4gICAgLy8gV2hlbiBwYXNpbmcgTiBsaW5lcyBpbnRvIE4gc2VsZWN0aW9ucywgaW5zZXJ0IG9uZSBsaW5lIHBlciBzZWxlY3Rpb25cbiAgICBpZiAocGFzdGUgJiYgc2VsLnJhbmdlcy5sZW5ndGggPiAxKSB7XG4gICAgICBpZiAobGFzdENvcGllZCAmJiBsYXN0Q29waWVkLmpvaW4oXCJcXG5cIikgPT0gaW5zZXJ0ZWQpIHtcbiAgICAgICAgaWYgKHNlbC5yYW5nZXMubGVuZ3RoICUgbGFzdENvcGllZC5sZW5ndGggPT0gMCkge1xuICAgICAgICAgIG11bHRpUGFzdGUgPSBbXTtcbiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxhc3RDb3BpZWQubGVuZ3RoOyBpKyspXG4gICAgICAgICAgICBtdWx0aVBhc3RlLnB1c2goZG9jLnNwbGl0TGluZXMobGFzdENvcGllZFtpXSkpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHRleHRMaW5lcy5sZW5ndGggPT0gc2VsLnJhbmdlcy5sZW5ndGgpIHtcbiAgICAgICAgbXVsdGlQYXN0ZSA9IG1hcCh0ZXh0TGluZXMsIGZ1bmN0aW9uKGwpIHsgcmV0dXJuIFtsXTsgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gTm9ybWFsIGJlaGF2aW9yIGlzIHRvIGluc2VydCB0aGUgbmV3IHRleHQgaW50byBldmVyeSBzZWxlY3Rpb25cbiAgICBmb3IgKHZhciBpID0gc2VsLnJhbmdlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgdmFyIHJhbmdlID0gc2VsLnJhbmdlc1tpXTtcbiAgICAgIHZhciBmcm9tID0gcmFuZ2UuZnJvbSgpLCB0byA9IHJhbmdlLnRvKCk7XG4gICAgICBpZiAocmFuZ2UuZW1wdHkoKSkge1xuICAgICAgICBpZiAoZGVsZXRlZCAmJiBkZWxldGVkID4gMCkgLy8gSGFuZGxlIGRlbGV0aW9uXG4gICAgICAgICAgZnJvbSA9IFBvcyhmcm9tLmxpbmUsIGZyb20uY2ggLSBkZWxldGVkKTtcbiAgICAgICAgZWxzZSBpZiAoY20uc3RhdGUub3ZlcndyaXRlICYmICFwYXN0ZSkgLy8gSGFuZGxlIG92ZXJ3cml0ZVxuICAgICAgICAgIHRvID0gUG9zKHRvLmxpbmUsIE1hdGgubWluKGdldExpbmUoZG9jLCB0by5saW5lKS50ZXh0Lmxlbmd0aCwgdG8uY2ggKyBsc3QodGV4dExpbmVzKS5sZW5ndGgpKTtcbiAgICAgIH1cbiAgICAgIHZhciB1cGRhdGVJbnB1dCA9IGNtLmN1ck9wLnVwZGF0ZUlucHV0O1xuICAgICAgdmFyIGNoYW5nZUV2ZW50ID0ge2Zyb206IGZyb20sIHRvOiB0bywgdGV4dDogbXVsdGlQYXN0ZSA/IG11bHRpUGFzdGVbaSAlIG11bHRpUGFzdGUubGVuZ3RoXSA6IHRleHRMaW5lcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW46IG9yaWdpbiB8fCAocGFzdGUgPyBcInBhc3RlXCIgOiBjbS5zdGF0ZS5jdXRJbmNvbWluZyA/IFwiY3V0XCIgOiBcIitpbnB1dFwiKX07XG4gICAgICBtYWtlQ2hhbmdlKGNtLmRvYywgY2hhbmdlRXZlbnQpO1xuICAgICAgc2lnbmFsTGF0ZXIoY20sIFwiaW5wdXRSZWFkXCIsIGNtLCBjaGFuZ2VFdmVudCk7XG4gICAgfVxuICAgIGlmIChpbnNlcnRlZCAmJiAhcGFzdGUpXG4gICAgICB0cmlnZ2VyRWxlY3RyaWMoY20sIGluc2VydGVkKTtcblxuICAgIGVuc3VyZUN1cnNvclZpc2libGUoY20pO1xuICAgIGNtLmN1ck9wLnVwZGF0ZUlucHV0ID0gdXBkYXRlSW5wdXQ7XG4gICAgY20uY3VyT3AudHlwaW5nID0gdHJ1ZTtcbiAgICBjbS5zdGF0ZS5wYXN0ZUluY29taW5nID0gY20uc3RhdGUuY3V0SW5jb21pbmcgPSBmYWxzZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGhhbmRsZVBhc3RlKGUsIGNtKSB7XG4gICAgdmFyIHBhc3RlZCA9IGUuY2xpcGJvYXJkRGF0YSAmJiBlLmNsaXBib2FyZERhdGEuZ2V0RGF0YShcInRleHQvcGxhaW5cIik7XG4gICAgaWYgKHBhc3RlZCkge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgaWYgKCFpc1JlYWRPbmx5KGNtKSAmJiAhY20ub3B0aW9ucy5kaXNhYmxlSW5wdXQpXG4gICAgICAgIHJ1bkluT3AoY20sIGZ1bmN0aW9uKCkgeyBhcHBseVRleHRJbnB1dChjbSwgcGFzdGVkLCAwLCBudWxsLCBcInBhc3RlXCIpOyB9KTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHRyaWdnZXJFbGVjdHJpYyhjbSwgaW5zZXJ0ZWQpIHtcbiAgICAvLyBXaGVuIGFuICdlbGVjdHJpYycgY2hhcmFjdGVyIGlzIGluc2VydGVkLCBpbW1lZGlhdGVseSB0cmlnZ2VyIGEgcmVpbmRlbnRcbiAgICBpZiAoIWNtLm9wdGlvbnMuZWxlY3RyaWNDaGFycyB8fCAhY20ub3B0aW9ucy5zbWFydEluZGVudCkgcmV0dXJuO1xuICAgIHZhciBzZWwgPSBjbS5kb2Muc2VsO1xuXG4gICAgZm9yICh2YXIgaSA9IHNlbC5yYW5nZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIHZhciByYW5nZSA9IHNlbC5yYW5nZXNbaV07XG4gICAgICBpZiAocmFuZ2UuaGVhZC5jaCA+IDEwMCB8fCAoaSAmJiBzZWwucmFuZ2VzW2kgLSAxXS5oZWFkLmxpbmUgPT0gcmFuZ2UuaGVhZC5saW5lKSkgY29udGludWU7XG4gICAgICB2YXIgbW9kZSA9IGNtLmdldE1vZGVBdChyYW5nZS5oZWFkKTtcbiAgICAgIHZhciBpbmRlbnRlZCA9IGZhbHNlO1xuICAgICAgaWYgKG1vZGUuZWxlY3RyaWNDaGFycykge1xuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG1vZGUuZWxlY3RyaWNDaGFycy5sZW5ndGg7IGorKylcbiAgICAgICAgICBpZiAoaW5zZXJ0ZWQuaW5kZXhPZihtb2RlLmVsZWN0cmljQ2hhcnMuY2hhckF0KGopKSA+IC0xKSB7XG4gICAgICAgICAgICBpbmRlbnRlZCA9IGluZGVudExpbmUoY20sIHJhbmdlLmhlYWQubGluZSwgXCJzbWFydFwiKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAobW9kZS5lbGVjdHJpY0lucHV0KSB7XG4gICAgICAgIGlmIChtb2RlLmVsZWN0cmljSW5wdXQudGVzdChnZXRMaW5lKGNtLmRvYywgcmFuZ2UuaGVhZC5saW5lKS50ZXh0LnNsaWNlKDAsIHJhbmdlLmhlYWQuY2gpKSlcbiAgICAgICAgICBpbmRlbnRlZCA9IGluZGVudExpbmUoY20sIHJhbmdlLmhlYWQubGluZSwgXCJzbWFydFwiKTtcbiAgICAgIH1cbiAgICAgIGlmIChpbmRlbnRlZCkgc2lnbmFsTGF0ZXIoY20sIFwiZWxlY3RyaWNJbnB1dFwiLCBjbSwgcmFuZ2UuaGVhZC5saW5lKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBjb3B5YWJsZVJhbmdlcyhjbSkge1xuICAgIHZhciB0ZXh0ID0gW10sIHJhbmdlcyA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY20uZG9jLnNlbC5yYW5nZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBsaW5lID0gY20uZG9jLnNlbC5yYW5nZXNbaV0uaGVhZC5saW5lO1xuICAgICAgdmFyIGxpbmVSYW5nZSA9IHthbmNob3I6IFBvcyhsaW5lLCAwKSwgaGVhZDogUG9zKGxpbmUgKyAxLCAwKX07XG4gICAgICByYW5nZXMucHVzaChsaW5lUmFuZ2UpO1xuICAgICAgdGV4dC5wdXNoKGNtLmdldFJhbmdlKGxpbmVSYW5nZS5hbmNob3IsIGxpbmVSYW5nZS5oZWFkKSk7XG4gICAgfVxuICAgIHJldHVybiB7dGV4dDogdGV4dCwgcmFuZ2VzOiByYW5nZXN9O1xuICB9XG5cbiAgZnVuY3Rpb24gZGlzYWJsZUJyb3dzZXJNYWdpYyhmaWVsZCkge1xuICAgIGZpZWxkLnNldEF0dHJpYnV0ZShcImF1dG9jb3JyZWN0XCIsIFwib2ZmXCIpO1xuICAgIGZpZWxkLnNldEF0dHJpYnV0ZShcImF1dG9jYXBpdGFsaXplXCIsIFwib2ZmXCIpO1xuICAgIGZpZWxkLnNldEF0dHJpYnV0ZShcInNwZWxsY2hlY2tcIiwgXCJmYWxzZVwiKTtcbiAgfVxuXG4gIC8vIFRFWFRBUkVBIElOUFVUIFNUWUxFXG5cbiAgZnVuY3Rpb24gVGV4dGFyZWFJbnB1dChjbSkge1xuICAgIHRoaXMuY20gPSBjbTtcbiAgICAvLyBTZWUgaW5wdXQucG9sbCBhbmQgaW5wdXQucmVzZXRcbiAgICB0aGlzLnByZXZJbnB1dCA9IFwiXCI7XG5cbiAgICAvLyBGbGFnIHRoYXQgaW5kaWNhdGVzIHdoZXRoZXIgd2UgZXhwZWN0IGlucHV0IHRvIGFwcGVhciByZWFsIHNvb25cbiAgICAvLyBub3cgKGFmdGVyIHNvbWUgZXZlbnQgbGlrZSAna2V5cHJlc3MnIG9yICdpbnB1dCcpIGFuZCBhcmVcbiAgICAvLyBwb2xsaW5nIGludGVuc2l2ZWx5LlxuICAgIHRoaXMucG9sbGluZ0Zhc3QgPSBmYWxzZTtcbiAgICAvLyBTZWxmLXJlc2V0dGluZyB0aW1lb3V0IGZvciB0aGUgcG9sbGVyXG4gICAgdGhpcy5wb2xsaW5nID0gbmV3IERlbGF5ZWQoKTtcbiAgICAvLyBUcmFja3Mgd2hlbiBpbnB1dC5yZXNldCBoYXMgcHVudGVkIHRvIGp1c3QgcHV0dGluZyBhIHNob3J0XG4gICAgLy8gc3RyaW5nIGludG8gdGhlIHRleHRhcmVhIGluc3RlYWQgb2YgdGhlIGZ1bGwgc2VsZWN0aW9uLlxuICAgIHRoaXMuaW5hY2N1cmF0ZVNlbGVjdGlvbiA9IGZhbHNlO1xuICAgIC8vIFVzZWQgdG8gd29yayBhcm91bmQgSUUgaXNzdWUgd2l0aCBzZWxlY3Rpb24gYmVpbmcgZm9yZ290dGVuIHdoZW4gZm9jdXMgbW92ZXMgYXdheSBmcm9tIHRleHRhcmVhXG4gICAgdGhpcy5oYXNTZWxlY3Rpb24gPSBmYWxzZTtcbiAgICB0aGlzLmNvbXBvc2luZyA9IG51bGw7XG4gIH07XG5cbiAgZnVuY3Rpb24gaGlkZGVuVGV4dGFyZWEoKSB7XG4gICAgdmFyIHRlID0gZWx0KFwidGV4dGFyZWFcIiwgbnVsbCwgbnVsbCwgXCJwb3NpdGlvbjogYWJzb2x1dGU7IHBhZGRpbmc6IDA7IHdpZHRoOiAxcHg7IGhlaWdodDogMWVtOyBvdXRsaW5lOiBub25lXCIpO1xuICAgIHZhciBkaXYgPSBlbHQoXCJkaXZcIiwgW3RlXSwgbnVsbCwgXCJvdmVyZmxvdzogaGlkZGVuOyBwb3NpdGlvbjogcmVsYXRpdmU7IHdpZHRoOiAzcHg7IGhlaWdodDogMHB4O1wiKTtcbiAgICAvLyBUaGUgdGV4dGFyZWEgaXMga2VwdCBwb3NpdGlvbmVkIG5lYXIgdGhlIGN1cnNvciB0byBwcmV2ZW50IHRoZVxuICAgIC8vIGZhY3QgdGhhdCBpdCdsbCBiZSBzY3JvbGxlZCBpbnRvIHZpZXcgb24gaW5wdXQgZnJvbSBzY3JvbGxpbmdcbiAgICAvLyBvdXIgZmFrZSBjdXJzb3Igb3V0IG9mIHZpZXcuIE9uIHdlYmtpdCwgd2hlbiB3cmFwPW9mZiwgcGFzdGUgaXNcbiAgICAvLyB2ZXJ5IHNsb3cuIFNvIG1ha2UgdGhlIGFyZWEgd2lkZSBpbnN0ZWFkLlxuICAgIGlmICh3ZWJraXQpIHRlLnN0eWxlLndpZHRoID0gXCIxMDAwcHhcIjtcbiAgICBlbHNlIHRlLnNldEF0dHJpYnV0ZShcIndyYXBcIiwgXCJvZmZcIik7XG4gICAgLy8gSWYgYm9yZGVyOiAwOyAtLSBpT1MgZmFpbHMgdG8gb3BlbiBrZXlib2FyZCAoaXNzdWUgIzEyODcpXG4gICAgaWYgKGlvcykgdGUuc3R5bGUuYm9yZGVyID0gXCIxcHggc29saWQgYmxhY2tcIjtcbiAgICBkaXNhYmxlQnJvd3Nlck1hZ2ljKHRlKTtcbiAgICByZXR1cm4gZGl2O1xuICB9XG5cbiAgVGV4dGFyZWFJbnB1dC5wcm90b3R5cGUgPSBjb3B5T2JqKHtcbiAgICBpbml0OiBmdW5jdGlvbihkaXNwbGF5KSB7XG4gICAgICB2YXIgaW5wdXQgPSB0aGlzLCBjbSA9IHRoaXMuY207XG5cbiAgICAgIC8vIFdyYXBzIGFuZCBoaWRlcyBpbnB1dCB0ZXh0YXJlYVxuICAgICAgdmFyIGRpdiA9IHRoaXMud3JhcHBlciA9IGhpZGRlblRleHRhcmVhKCk7XG4gICAgICAvLyBUaGUgc2VtaWhpZGRlbiB0ZXh0YXJlYSB0aGF0IGlzIGZvY3VzZWQgd2hlbiB0aGUgZWRpdG9yIGlzXG4gICAgICAvLyBmb2N1c2VkLCBhbmQgcmVjZWl2ZXMgaW5wdXQuXG4gICAgICB2YXIgdGUgPSB0aGlzLnRleHRhcmVhID0gZGl2LmZpcnN0Q2hpbGQ7XG4gICAgICBkaXNwbGF5LndyYXBwZXIuaW5zZXJ0QmVmb3JlKGRpdiwgZGlzcGxheS53cmFwcGVyLmZpcnN0Q2hpbGQpO1xuXG4gICAgICAvLyBOZWVkZWQgdG8gaGlkZSBiaWcgYmx1ZSBibGlua2luZyBjdXJzb3Igb24gTW9iaWxlIFNhZmFyaSAoZG9lc24ndCBzZWVtIHRvIHdvcmsgaW4gaU9TIDggYW55bW9yZSlcbiAgICAgIGlmIChpb3MpIHRlLnN0eWxlLndpZHRoID0gXCIwcHhcIjtcblxuICAgICAgb24odGUsIFwiaW5wdXRcIiwgZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uID49IDkgJiYgaW5wdXQuaGFzU2VsZWN0aW9uKSBpbnB1dC5oYXNTZWxlY3Rpb24gPSBudWxsO1xuICAgICAgICBpbnB1dC5wb2xsKCk7XG4gICAgICB9KTtcblxuICAgICAgb24odGUsIFwicGFzdGVcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiAoaGFuZGxlUGFzdGUoZSwgY20pKSByZXR1cm4gdHJ1ZTtcblxuICAgICAgICBjbS5zdGF0ZS5wYXN0ZUluY29taW5nID0gdHJ1ZTtcbiAgICAgICAgaW5wdXQuZmFzdFBvbGwoKTtcbiAgICAgIH0pO1xuXG4gICAgICBmdW5jdGlvbiBwcmVwYXJlQ29weUN1dChlKSB7XG4gICAgICAgIGlmIChjbS5zb21ldGhpbmdTZWxlY3RlZCgpKSB7XG4gICAgICAgICAgbGFzdENvcGllZCA9IGNtLmdldFNlbGVjdGlvbnMoKTtcbiAgICAgICAgICBpZiAoaW5wdXQuaW5hY2N1cmF0ZVNlbGVjdGlvbikge1xuICAgICAgICAgICAgaW5wdXQucHJldklucHV0ID0gXCJcIjtcbiAgICAgICAgICAgIGlucHV0LmluYWNjdXJhdGVTZWxlY3Rpb24gPSBmYWxzZTtcbiAgICAgICAgICAgIHRlLnZhbHVlID0gbGFzdENvcGllZC5qb2luKFwiXFxuXCIpO1xuICAgICAgICAgICAgc2VsZWN0SW5wdXQodGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIGlmICghY20ub3B0aW9ucy5saW5lV2lzZUNvcHlDdXQpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIHJhbmdlcyA9IGNvcHlhYmxlUmFuZ2VzKGNtKTtcbiAgICAgICAgICBsYXN0Q29waWVkID0gcmFuZ2VzLnRleHQ7XG4gICAgICAgICAgaWYgKGUudHlwZSA9PSBcImN1dFwiKSB7XG4gICAgICAgICAgICBjbS5zZXRTZWxlY3Rpb25zKHJhbmdlcy5yYW5nZXMsIG51bGwsIHNlbF9kb250U2Nyb2xsKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaW5wdXQucHJldklucHV0ID0gXCJcIjtcbiAgICAgICAgICAgIHRlLnZhbHVlID0gcmFuZ2VzLnRleHQuam9pbihcIlxcblwiKTtcbiAgICAgICAgICAgIHNlbGVjdElucHV0KHRlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGUudHlwZSA9PSBcImN1dFwiKSBjbS5zdGF0ZS5jdXRJbmNvbWluZyA9IHRydWU7XG4gICAgICB9XG4gICAgICBvbih0ZSwgXCJjdXRcIiwgcHJlcGFyZUNvcHlDdXQpO1xuICAgICAgb24odGUsIFwiY29weVwiLCBwcmVwYXJlQ29weUN1dCk7XG5cbiAgICAgIG9uKGRpc3BsYXkuc2Nyb2xsZXIsIFwicGFzdGVcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICBpZiAoZXZlbnRJbldpZGdldChkaXNwbGF5LCBlKSkgcmV0dXJuO1xuICAgICAgICBjbS5zdGF0ZS5wYXN0ZUluY29taW5nID0gdHJ1ZTtcbiAgICAgICAgaW5wdXQuZm9jdXMoKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBQcmV2ZW50IG5vcm1hbCBzZWxlY3Rpb24gaW4gdGhlIGVkaXRvciAod2UgaGFuZGxlIG91ciBvd24pXG4gICAgICBvbihkaXNwbGF5LmxpbmVTcGFjZSwgXCJzZWxlY3RzdGFydFwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmICghZXZlbnRJbldpZGdldChkaXNwbGF5LCBlKSkgZV9wcmV2ZW50RGVmYXVsdChlKTtcbiAgICAgIH0pO1xuXG4gICAgICBvbih0ZSwgXCJjb21wb3NpdGlvbnN0YXJ0XCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgc3RhcnQgPSBjbS5nZXRDdXJzb3IoXCJmcm9tXCIpO1xuICAgICAgICBpZiAoaW5wdXQuY29tcG9zaW5nKSBpbnB1dC5jb21wb3NpbmcucmFuZ2UuY2xlYXIoKVxuICAgICAgICBpbnB1dC5jb21wb3NpbmcgPSB7XG4gICAgICAgICAgc3RhcnQ6IHN0YXJ0LFxuICAgICAgICAgIHJhbmdlOiBjbS5tYXJrVGV4dChzdGFydCwgY20uZ2V0Q3Vyc29yKFwidG9cIiksIHtjbGFzc05hbWU6IFwiQ29kZU1pcnJvci1jb21wb3NpbmdcIn0pXG4gICAgICAgIH07XG4gICAgICB9KTtcbiAgICAgIG9uKHRlLCBcImNvbXBvc2l0aW9uZW5kXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoaW5wdXQuY29tcG9zaW5nKSB7XG4gICAgICAgICAgaW5wdXQucG9sbCgpO1xuICAgICAgICAgIGlucHV0LmNvbXBvc2luZy5yYW5nZS5jbGVhcigpO1xuICAgICAgICAgIGlucHV0LmNvbXBvc2luZyA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBwcmVwYXJlU2VsZWN0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgIC8vIFJlZHJhdyB0aGUgc2VsZWN0aW9uIGFuZC9vciBjdXJzb3JcbiAgICAgIHZhciBjbSA9IHRoaXMuY20sIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCBkb2MgPSBjbS5kb2M7XG4gICAgICB2YXIgcmVzdWx0ID0gcHJlcGFyZVNlbGVjdGlvbihjbSk7XG5cbiAgICAgIC8vIE1vdmUgdGhlIGhpZGRlbiB0ZXh0YXJlYSBuZWFyIHRoZSBjdXJzb3IgdG8gcHJldmVudCBzY3JvbGxpbmcgYXJ0aWZhY3RzXG4gICAgICBpZiAoY20ub3B0aW9ucy5tb3ZlSW5wdXRXaXRoQ3Vyc29yKSB7XG4gICAgICAgIHZhciBoZWFkUG9zID0gY3Vyc29yQ29vcmRzKGNtLCBkb2Muc2VsLnByaW1hcnkoKS5oZWFkLCBcImRpdlwiKTtcbiAgICAgICAgdmFyIHdyYXBPZmYgPSBkaXNwbGF5LndyYXBwZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksIGxpbmVPZmYgPSBkaXNwbGF5LmxpbmVEaXYuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgIHJlc3VsdC50ZVRvcCA9IE1hdGgubWF4KDAsIE1hdGgubWluKGRpc3BsYXkud3JhcHBlci5jbGllbnRIZWlnaHQgLSAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZFBvcy50b3AgKyBsaW5lT2ZmLnRvcCAtIHdyYXBPZmYudG9wKSk7XG4gICAgICAgIHJlc3VsdC50ZUxlZnQgPSBNYXRoLm1heCgwLCBNYXRoLm1pbihkaXNwbGF5LndyYXBwZXIuY2xpZW50V2lkdGggLSAxMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRQb3MubGVmdCArIGxpbmVPZmYubGVmdCAtIHdyYXBPZmYubGVmdCkpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sXG5cbiAgICBzaG93U2VsZWN0aW9uOiBmdW5jdGlvbihkcmF3bikge1xuICAgICAgdmFyIGNtID0gdGhpcy5jbSwgZGlzcGxheSA9IGNtLmRpc3BsYXk7XG4gICAgICByZW1vdmVDaGlsZHJlbkFuZEFkZChkaXNwbGF5LmN1cnNvckRpdiwgZHJhd24uY3Vyc29ycyk7XG4gICAgICByZW1vdmVDaGlsZHJlbkFuZEFkZChkaXNwbGF5LnNlbGVjdGlvbkRpdiwgZHJhd24uc2VsZWN0aW9uKTtcbiAgICAgIGlmIChkcmF3bi50ZVRvcCAhPSBudWxsKSB7XG4gICAgICAgIHRoaXMud3JhcHBlci5zdHlsZS50b3AgPSBkcmF3bi50ZVRvcCArIFwicHhcIjtcbiAgICAgICAgdGhpcy53cmFwcGVyLnN0eWxlLmxlZnQgPSBkcmF3bi50ZUxlZnQgKyBcInB4XCI7XG4gICAgICB9XG4gICAgfSxcblxuICAgIC8vIFJlc2V0IHRoZSBpbnB1dCB0byBjb3JyZXNwb25kIHRvIHRoZSBzZWxlY3Rpb24gKG9yIHRvIGJlIGVtcHR5LFxuICAgIC8vIHdoZW4gbm90IHR5cGluZyBhbmQgbm90aGluZyBpcyBzZWxlY3RlZClcbiAgICByZXNldDogZnVuY3Rpb24odHlwaW5nKSB7XG4gICAgICBpZiAodGhpcy5jb250ZXh0TWVudVBlbmRpbmcpIHJldHVybjtcbiAgICAgIHZhciBtaW5pbWFsLCBzZWxlY3RlZCwgY20gPSB0aGlzLmNtLCBkb2MgPSBjbS5kb2M7XG4gICAgICBpZiAoY20uc29tZXRoaW5nU2VsZWN0ZWQoKSkge1xuICAgICAgICB0aGlzLnByZXZJbnB1dCA9IFwiXCI7XG4gICAgICAgIHZhciByYW5nZSA9IGRvYy5zZWwucHJpbWFyeSgpO1xuICAgICAgICBtaW5pbWFsID0gaGFzQ29weUV2ZW50ICYmXG4gICAgICAgICAgKHJhbmdlLnRvKCkubGluZSAtIHJhbmdlLmZyb20oKS5saW5lID4gMTAwIHx8IChzZWxlY3RlZCA9IGNtLmdldFNlbGVjdGlvbigpKS5sZW5ndGggPiAxMDAwKTtcbiAgICAgICAgdmFyIGNvbnRlbnQgPSBtaW5pbWFsID8gXCItXCIgOiBzZWxlY3RlZCB8fCBjbS5nZXRTZWxlY3Rpb24oKTtcbiAgICAgICAgdGhpcy50ZXh0YXJlYS52YWx1ZSA9IGNvbnRlbnQ7XG4gICAgICAgIGlmIChjbS5zdGF0ZS5mb2N1c2VkKSBzZWxlY3RJbnB1dCh0aGlzLnRleHRhcmVhKTtcbiAgICAgICAgaWYgKGllICYmIGllX3ZlcnNpb24gPj0gOSkgdGhpcy5oYXNTZWxlY3Rpb24gPSBjb250ZW50O1xuICAgICAgfSBlbHNlIGlmICghdHlwaW5nKSB7XG4gICAgICAgIHRoaXMucHJldklucHV0ID0gdGhpcy50ZXh0YXJlYS52YWx1ZSA9IFwiXCI7XG4gICAgICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uID49IDkpIHRoaXMuaGFzU2VsZWN0aW9uID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIHRoaXMuaW5hY2N1cmF0ZVNlbGVjdGlvbiA9IG1pbmltYWw7XG4gICAgfSxcblxuICAgIGdldEZpZWxkOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMudGV4dGFyZWE7IH0sXG5cbiAgICBzdXBwb3J0c1RvdWNoOiBmdW5jdGlvbigpIHsgcmV0dXJuIGZhbHNlOyB9LFxuXG4gICAgZm9jdXM6IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKHRoaXMuY20ub3B0aW9ucy5yZWFkT25seSAhPSBcIm5vY3Vyc29yXCIgJiYgKCFtb2JpbGUgfHwgYWN0aXZlRWx0KCkgIT0gdGhpcy50ZXh0YXJlYSkpIHtcbiAgICAgICAgdHJ5IHsgdGhpcy50ZXh0YXJlYS5mb2N1cygpOyB9XG4gICAgICAgIGNhdGNoIChlKSB7fSAvLyBJRTggd2lsbCB0aHJvdyBpZiB0aGUgdGV4dGFyZWEgaXMgZGlzcGxheTogbm9uZSBvciBub3QgaW4gRE9NXG4gICAgICB9XG4gICAgfSxcblxuICAgIGJsdXI6IGZ1bmN0aW9uKCkgeyB0aGlzLnRleHRhcmVhLmJsdXIoKTsgfSxcblxuICAgIHJlc2V0UG9zaXRpb246IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy53cmFwcGVyLnN0eWxlLnRvcCA9IHRoaXMud3JhcHBlci5zdHlsZS5sZWZ0ID0gMDtcbiAgICB9LFxuXG4gICAgcmVjZWl2ZWRGb2N1czogZnVuY3Rpb24oKSB7IHRoaXMuc2xvd1BvbGwoKTsgfSxcblxuICAgIC8vIFBvbGwgZm9yIGlucHV0IGNoYW5nZXMsIHVzaW5nIHRoZSBub3JtYWwgcmF0ZSBvZiBwb2xsaW5nLiBUaGlzXG4gICAgLy8gcnVucyBhcyBsb25nIGFzIHRoZSBlZGl0b3IgaXMgZm9jdXNlZC5cbiAgICBzbG93UG9sbDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgaW5wdXQgPSB0aGlzO1xuICAgICAgaWYgKGlucHV0LnBvbGxpbmdGYXN0KSByZXR1cm47XG4gICAgICBpbnB1dC5wb2xsaW5nLnNldCh0aGlzLmNtLm9wdGlvbnMucG9sbEludGVydmFsLCBmdW5jdGlvbigpIHtcbiAgICAgICAgaW5wdXQucG9sbCgpO1xuICAgICAgICBpZiAoaW5wdXQuY20uc3RhdGUuZm9jdXNlZCkgaW5wdXQuc2xvd1BvbGwoKTtcbiAgICAgIH0pO1xuICAgIH0sXG5cbiAgICAvLyBXaGVuIGFuIGV2ZW50IGhhcyBqdXN0IGNvbWUgaW4gdGhhdCBpcyBsaWtlbHkgdG8gYWRkIG9yIGNoYW5nZVxuICAgIC8vIHNvbWV0aGluZyBpbiB0aGUgaW5wdXQgdGV4dGFyZWEsIHdlIHBvbGwgZmFzdGVyLCB0byBlbnN1cmUgdGhhdFxuICAgIC8vIHRoZSBjaGFuZ2UgYXBwZWFycyBvbiB0aGUgc2NyZWVuIHF1aWNrbHkuXG4gICAgZmFzdFBvbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIG1pc3NlZCA9IGZhbHNlLCBpbnB1dCA9IHRoaXM7XG4gICAgICBpbnB1dC5wb2xsaW5nRmFzdCA9IHRydWU7XG4gICAgICBmdW5jdGlvbiBwKCkge1xuICAgICAgICB2YXIgY2hhbmdlZCA9IGlucHV0LnBvbGwoKTtcbiAgICAgICAgaWYgKCFjaGFuZ2VkICYmICFtaXNzZWQpIHttaXNzZWQgPSB0cnVlOyBpbnB1dC5wb2xsaW5nLnNldCg2MCwgcCk7fVxuICAgICAgICBlbHNlIHtpbnB1dC5wb2xsaW5nRmFzdCA9IGZhbHNlOyBpbnB1dC5zbG93UG9sbCgpO31cbiAgICAgIH1cbiAgICAgIGlucHV0LnBvbGxpbmcuc2V0KDIwLCBwKTtcbiAgICB9LFxuXG4gICAgLy8gUmVhZCBpbnB1dCBmcm9tIHRoZSB0ZXh0YXJlYSwgYW5kIHVwZGF0ZSB0aGUgZG9jdW1lbnQgdG8gbWF0Y2guXG4gICAgLy8gV2hlbiBzb21ldGhpbmcgaXMgc2VsZWN0ZWQsIGl0IGlzIHByZXNlbnQgaW4gdGhlIHRleHRhcmVhLCBhbmRcbiAgICAvLyBzZWxlY3RlZCAodW5sZXNzIGl0IGlzIGh1Z2UsIGluIHdoaWNoIGNhc2UgYSBwbGFjZWhvbGRlciBpc1xuICAgIC8vIHVzZWQpLiBXaGVuIG5vdGhpbmcgaXMgc2VsZWN0ZWQsIHRoZSBjdXJzb3Igc2l0cyBhZnRlciBwcmV2aW91c2x5XG4gICAgLy8gc2VlbiB0ZXh0IChjYW4gYmUgZW1wdHkpLCB3aGljaCBpcyBzdG9yZWQgaW4gcHJldklucHV0ICh3ZSBtdXN0XG4gICAgLy8gbm90IHJlc2V0IHRoZSB0ZXh0YXJlYSB3aGVuIHR5cGluZywgYmVjYXVzZSB0aGF0IGJyZWFrcyBJTUUpLlxuICAgIHBvbGw6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGNtID0gdGhpcy5jbSwgaW5wdXQgPSB0aGlzLnRleHRhcmVhLCBwcmV2SW5wdXQgPSB0aGlzLnByZXZJbnB1dDtcbiAgICAgIC8vIFNpbmNlIHRoaXMgaXMgY2FsbGVkIGEgKmxvdCosIHRyeSB0byBiYWlsIG91dCBhcyBjaGVhcGx5IGFzXG4gICAgICAvLyBwb3NzaWJsZSB3aGVuIGl0IGlzIGNsZWFyIHRoYXQgbm90aGluZyBoYXBwZW5lZC4gaGFzU2VsZWN0aW9uXG4gICAgICAvLyB3aWxsIGJlIHRoZSBjYXNlIHdoZW4gdGhlcmUgaXMgYSBsb3Qgb2YgdGV4dCBpbiB0aGUgdGV4dGFyZWEsXG4gICAgICAvLyBpbiB3aGljaCBjYXNlIHJlYWRpbmcgaXRzIHZhbHVlIHdvdWxkIGJlIGV4cGVuc2l2ZS5cbiAgICAgIGlmICh0aGlzLmNvbnRleHRNZW51UGVuZGluZyB8fCAhY20uc3RhdGUuZm9jdXNlZCB8fFxuICAgICAgICAgIChoYXNTZWxlY3Rpb24oaW5wdXQpICYmICFwcmV2SW5wdXQgJiYgIXRoaXMuY29tcG9zaW5nKSB8fFxuICAgICAgICAgIGlzUmVhZE9ubHkoY20pIHx8IGNtLm9wdGlvbnMuZGlzYWJsZUlucHV0IHx8IGNtLnN0YXRlLmtleVNlcSlcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuXG4gICAgICB2YXIgdGV4dCA9IGlucHV0LnZhbHVlO1xuICAgICAgLy8gSWYgbm90aGluZyBjaGFuZ2VkLCBiYWlsLlxuICAgICAgaWYgKHRleHQgPT0gcHJldklucHV0ICYmICFjbS5zb21ldGhpbmdTZWxlY3RlZCgpKSByZXR1cm4gZmFsc2U7XG4gICAgICAvLyBXb3JrIGFyb3VuZCBub25zZW5zaWNhbCBzZWxlY3Rpb24gcmVzZXR0aW5nIGluIElFOS8xMCwgYW5kXG4gICAgICAvLyBpbmV4cGxpY2FibGUgYXBwZWFyYW5jZSBvZiBwcml2YXRlIGFyZWEgdW5pY29kZSBjaGFyYWN0ZXJzIG9uXG4gICAgICAvLyBzb21lIGtleSBjb21ib3MgaW4gTWFjICgjMjY4OSkuXG4gICAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA+PSA5ICYmIHRoaXMuaGFzU2VsZWN0aW9uID09PSB0ZXh0IHx8XG4gICAgICAgICAgbWFjICYmIC9bXFx1ZjcwMC1cXHVmN2ZmXS8udGVzdCh0ZXh0KSkge1xuICAgICAgICBjbS5kaXNwbGF5LmlucHV0LnJlc2V0KCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgaWYgKGNtLmRvYy5zZWwgPT0gY20uZGlzcGxheS5zZWxGb3JDb250ZXh0TWVudSkge1xuICAgICAgICB2YXIgZmlyc3QgPSB0ZXh0LmNoYXJDb2RlQXQoMCk7XG4gICAgICAgIGlmIChmaXJzdCA9PSAweDIwMGIgJiYgIXByZXZJbnB1dCkgcHJldklucHV0ID0gXCJcXHUyMDBiXCI7XG4gICAgICAgIGlmIChmaXJzdCA9PSAweDIxZGEpIHsgdGhpcy5yZXNldCgpOyByZXR1cm4gdGhpcy5jbS5leGVjQ29tbWFuZChcInVuZG9cIik7IH1cbiAgICAgIH1cbiAgICAgIC8vIEZpbmQgdGhlIHBhcnQgb2YgdGhlIGlucHV0IHRoYXQgaXMgYWN0dWFsbHkgbmV3XG4gICAgICB2YXIgc2FtZSA9IDAsIGwgPSBNYXRoLm1pbihwcmV2SW5wdXQubGVuZ3RoLCB0ZXh0Lmxlbmd0aCk7XG4gICAgICB3aGlsZSAoc2FtZSA8IGwgJiYgcHJldklucHV0LmNoYXJDb2RlQXQoc2FtZSkgPT0gdGV4dC5jaGFyQ29kZUF0KHNhbWUpKSArK3NhbWU7XG5cbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIHJ1bkluT3AoY20sIGZ1bmN0aW9uKCkge1xuICAgICAgICBhcHBseVRleHRJbnB1dChjbSwgdGV4dC5zbGljZShzYW1lKSwgcHJldklucHV0Lmxlbmd0aCAtIHNhbWUsXG4gICAgICAgICAgICAgICAgICAgICAgIG51bGwsIHNlbGYuY29tcG9zaW5nID8gXCIqY29tcG9zZVwiIDogbnVsbCk7XG5cbiAgICAgICAgLy8gRG9uJ3QgbGVhdmUgbG9uZyB0ZXh0IGluIHRoZSB0ZXh0YXJlYSwgc2luY2UgaXQgbWFrZXMgZnVydGhlciBwb2xsaW5nIHNsb3dcbiAgICAgICAgaWYgKHRleHQubGVuZ3RoID4gMTAwMCB8fCB0ZXh0LmluZGV4T2YoXCJcXG5cIikgPiAtMSkgaW5wdXQudmFsdWUgPSBzZWxmLnByZXZJbnB1dCA9IFwiXCI7XG4gICAgICAgIGVsc2Ugc2VsZi5wcmV2SW5wdXQgPSB0ZXh0O1xuXG4gICAgICAgIGlmIChzZWxmLmNvbXBvc2luZykge1xuICAgICAgICAgIHNlbGYuY29tcG9zaW5nLnJhbmdlLmNsZWFyKCk7XG4gICAgICAgICAgc2VsZi5jb21wb3NpbmcucmFuZ2UgPSBjbS5tYXJrVGV4dChzZWxmLmNvbXBvc2luZy5zdGFydCwgY20uZ2V0Q3Vyc29yKFwidG9cIiksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7Y2xhc3NOYW1lOiBcIkNvZGVNaXJyb3ItY29tcG9zaW5nXCJ9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9LFxuXG4gICAgZW5zdXJlUG9sbGVkOiBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLnBvbGxpbmdGYXN0ICYmIHRoaXMucG9sbCgpKSB0aGlzLnBvbGxpbmdGYXN0ID0gZmFsc2U7XG4gICAgfSxcblxuICAgIG9uS2V5UHJlc3M6IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKGllICYmIGllX3ZlcnNpb24gPj0gOSkgdGhpcy5oYXNTZWxlY3Rpb24gPSBudWxsO1xuICAgICAgdGhpcy5mYXN0UG9sbCgpO1xuICAgIH0sXG5cbiAgICBvbkNvbnRleHRNZW51OiBmdW5jdGlvbihlKSB7XG4gICAgICB2YXIgaW5wdXQgPSB0aGlzLCBjbSA9IGlucHV0LmNtLCBkaXNwbGF5ID0gY20uZGlzcGxheSwgdGUgPSBpbnB1dC50ZXh0YXJlYTtcbiAgICAgIHZhciBwb3MgPSBwb3NGcm9tTW91c2UoY20sIGUpLCBzY3JvbGxQb3MgPSBkaXNwbGF5LnNjcm9sbGVyLnNjcm9sbFRvcDtcbiAgICAgIGlmICghcG9zIHx8IHByZXN0bykgcmV0dXJuOyAvLyBPcGVyYSBpcyBkaWZmaWN1bHQuXG5cbiAgICAgIC8vIFJlc2V0IHRoZSBjdXJyZW50IHRleHQgc2VsZWN0aW9uIG9ubHkgaWYgdGhlIGNsaWNrIGlzIGRvbmUgb3V0c2lkZSBvZiB0aGUgc2VsZWN0aW9uXG4gICAgICAvLyBhbmQgJ3Jlc2V0U2VsZWN0aW9uT25Db250ZXh0TWVudScgb3B0aW9uIGlzIHRydWUuXG4gICAgICB2YXIgcmVzZXQgPSBjbS5vcHRpb25zLnJlc2V0U2VsZWN0aW9uT25Db250ZXh0TWVudTtcbiAgICAgIGlmIChyZXNldCAmJiBjbS5kb2Muc2VsLmNvbnRhaW5zKHBvcykgPT0gLTEpXG4gICAgICAgIG9wZXJhdGlvbihjbSwgc2V0U2VsZWN0aW9uKShjbS5kb2MsIHNpbXBsZVNlbGVjdGlvbihwb3MpLCBzZWxfZG9udFNjcm9sbCk7XG5cbiAgICAgIHZhciBvbGRDU1MgPSB0ZS5zdHlsZS5jc3NUZXh0O1xuICAgICAgaW5wdXQud3JhcHBlci5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICAgIHRlLnN0eWxlLmNzc1RleHQgPSBcInBvc2l0aW9uOiBmaXhlZDsgd2lkdGg6IDMwcHg7IGhlaWdodDogMzBweDsgdG9wOiBcIiArIChlLmNsaWVudFkgLSA1KSArXG4gICAgICAgIFwicHg7IGxlZnQ6IFwiICsgKGUuY2xpZW50WCAtIDUpICsgXCJweDsgei1pbmRleDogMTAwMDsgYmFja2dyb3VuZDogXCIgK1xuICAgICAgICAoaWUgPyBcInJnYmEoMjU1LCAyNTUsIDI1NSwgLjA1KVwiIDogXCJ0cmFuc3BhcmVudFwiKSArXG4gICAgICAgIFwiOyBvdXRsaW5lOiBub25lOyBib3JkZXItd2lkdGg6IDA7IG91dGxpbmU6IG5vbmU7IG92ZXJmbG93OiBoaWRkZW47IG9wYWNpdHk6IC4wNTsgZmlsdGVyOiBhbHBoYShvcGFjaXR5PTUpO1wiO1xuICAgICAgaWYgKHdlYmtpdCkgdmFyIG9sZFNjcm9sbFkgPSB3aW5kb3cuc2Nyb2xsWTsgLy8gV29yayBhcm91bmQgQ2hyb21lIGlzc3VlICgjMjcxMilcbiAgICAgIGRpc3BsYXkuaW5wdXQuZm9jdXMoKTtcbiAgICAgIGlmICh3ZWJraXQpIHdpbmRvdy5zY3JvbGxUbyhudWxsLCBvbGRTY3JvbGxZKTtcbiAgICAgIGRpc3BsYXkuaW5wdXQucmVzZXQoKTtcbiAgICAgIC8vIEFkZHMgXCJTZWxlY3QgYWxsXCIgdG8gY29udGV4dCBtZW51IGluIEZGXG4gICAgICBpZiAoIWNtLnNvbWV0aGluZ1NlbGVjdGVkKCkpIHRlLnZhbHVlID0gaW5wdXQucHJldklucHV0ID0gXCIgXCI7XG4gICAgICBpbnB1dC5jb250ZXh0TWVudVBlbmRpbmcgPSB0cnVlO1xuICAgICAgZGlzcGxheS5zZWxGb3JDb250ZXh0TWVudSA9IGNtLmRvYy5zZWw7XG4gICAgICBjbGVhclRpbWVvdXQoZGlzcGxheS5kZXRlY3RpbmdTZWxlY3RBbGwpO1xuXG4gICAgICAvLyBTZWxlY3QtYWxsIHdpbGwgYmUgZ3JleWVkIG91dCBpZiB0aGVyZSdzIG5vdGhpbmcgdG8gc2VsZWN0LCBzb1xuICAgICAgLy8gdGhpcyBhZGRzIGEgemVyby13aWR0aCBzcGFjZSBzbyB0aGF0IHdlIGNhbiBsYXRlciBjaGVjayB3aGV0aGVyXG4gICAgICAvLyBpdCBnb3Qgc2VsZWN0ZWQuXG4gICAgICBmdW5jdGlvbiBwcmVwYXJlU2VsZWN0QWxsSGFjaygpIHtcbiAgICAgICAgaWYgKHRlLnNlbGVjdGlvblN0YXJ0ICE9IG51bGwpIHtcbiAgICAgICAgICB2YXIgc2VsZWN0ZWQgPSBjbS5zb21ldGhpbmdTZWxlY3RlZCgpO1xuICAgICAgICAgIHZhciBleHR2YWwgPSBcIlxcdTIwMGJcIiArIChzZWxlY3RlZCA/IHRlLnZhbHVlIDogXCJcIik7XG4gICAgICAgICAgdGUudmFsdWUgPSBcIlxcdTIxZGFcIjsgLy8gVXNlZCB0byBjYXRjaCBjb250ZXh0LW1lbnUgdW5kb1xuICAgICAgICAgIHRlLnZhbHVlID0gZXh0dmFsO1xuICAgICAgICAgIGlucHV0LnByZXZJbnB1dCA9IHNlbGVjdGVkID8gXCJcIiA6IFwiXFx1MjAwYlwiO1xuICAgICAgICAgIHRlLnNlbGVjdGlvblN0YXJ0ID0gMTsgdGUuc2VsZWN0aW9uRW5kID0gZXh0dmFsLmxlbmd0aDtcbiAgICAgICAgICAvLyBSZS1zZXQgdGhpcywgaW4gY2FzZSBzb21lIG90aGVyIGhhbmRsZXIgdG91Y2hlZCB0aGVcbiAgICAgICAgICAvLyBzZWxlY3Rpb24gaW4gdGhlIG1lYW50aW1lLlxuICAgICAgICAgIGRpc3BsYXkuc2VsRm9yQ29udGV4dE1lbnUgPSBjbS5kb2Muc2VsO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmdW5jdGlvbiByZWhpZGUoKSB7XG4gICAgICAgIGlucHV0LmNvbnRleHRNZW51UGVuZGluZyA9IGZhbHNlO1xuICAgICAgICBpbnB1dC53cmFwcGVyLnN0eWxlLnBvc2l0aW9uID0gXCJyZWxhdGl2ZVwiO1xuICAgICAgICB0ZS5zdHlsZS5jc3NUZXh0ID0gb2xkQ1NTO1xuICAgICAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDkpIGRpc3BsYXkuc2Nyb2xsYmFycy5zZXRTY3JvbGxUb3AoZGlzcGxheS5zY3JvbGxlci5zY3JvbGxUb3AgPSBzY3JvbGxQb3MpO1xuXG4gICAgICAgIC8vIFRyeSB0byBkZXRlY3QgdGhlIHVzZXIgY2hvb3Npbmcgc2VsZWN0LWFsbFxuICAgICAgICBpZiAodGUuc2VsZWN0aW9uU3RhcnQgIT0gbnVsbCkge1xuICAgICAgICAgIGlmICghaWUgfHwgKGllICYmIGllX3ZlcnNpb24gPCA5KSkgcHJlcGFyZVNlbGVjdEFsbEhhY2soKTtcbiAgICAgICAgICB2YXIgaSA9IDAsIHBvbGwgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmIChkaXNwbGF5LnNlbEZvckNvbnRleHRNZW51ID09IGNtLmRvYy5zZWwgJiYgdGUuc2VsZWN0aW9uU3RhcnQgPT0gMCAmJlxuICAgICAgICAgICAgICAgIHRlLnNlbGVjdGlvbkVuZCA+IDAgJiYgaW5wdXQucHJldklucHV0ID09IFwiXFx1MjAwYlwiKVxuICAgICAgICAgICAgICBvcGVyYXRpb24oY20sIGNvbW1hbmRzLnNlbGVjdEFsbCkoY20pO1xuICAgICAgICAgICAgZWxzZSBpZiAoaSsrIDwgMTApIGRpc3BsYXkuZGV0ZWN0aW5nU2VsZWN0QWxsID0gc2V0VGltZW91dChwb2xsLCA1MDApO1xuICAgICAgICAgICAgZWxzZSBkaXNwbGF5LmlucHV0LnJlc2V0KCk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICBkaXNwbGF5LmRldGVjdGluZ1NlbGVjdEFsbCA9IHNldFRpbWVvdXQocG9sbCwgMjAwKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA+PSA5KSBwcmVwYXJlU2VsZWN0QWxsSGFjaygpO1xuICAgICAgaWYgKGNhcHR1cmVSaWdodENsaWNrKSB7XG4gICAgICAgIGVfc3RvcChlKTtcbiAgICAgICAgdmFyIG1vdXNldXAgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICBvZmYod2luZG93LCBcIm1vdXNldXBcIiwgbW91c2V1cCk7XG4gICAgICAgICAgc2V0VGltZW91dChyZWhpZGUsIDIwKTtcbiAgICAgICAgfTtcbiAgICAgICAgb24od2luZG93LCBcIm1vdXNldXBcIiwgbW91c2V1cCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZXRUaW1lb3V0KHJlaGlkZSwgNTApO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICByZWFkT25seUNoYW5nZWQ6IGZ1bmN0aW9uKHZhbCkge1xuICAgICAgaWYgKCF2YWwpIHRoaXMucmVzZXQoKTtcbiAgICB9LFxuXG4gICAgc2V0VW5lZGl0YWJsZTogbm90aGluZyxcblxuICAgIG5lZWRzQ29udGVudEF0dHJpYnV0ZTogZmFsc2VcbiAgfSwgVGV4dGFyZWFJbnB1dC5wcm90b3R5cGUpO1xuXG4gIC8vIENPTlRFTlRFRElUQUJMRSBJTlBVVCBTVFlMRVxuXG4gIGZ1bmN0aW9uIENvbnRlbnRFZGl0YWJsZUlucHV0KGNtKSB7XG4gICAgdGhpcy5jbSA9IGNtO1xuICAgIHRoaXMubGFzdEFuY2hvck5vZGUgPSB0aGlzLmxhc3RBbmNob3JPZmZzZXQgPSB0aGlzLmxhc3RGb2N1c05vZGUgPSB0aGlzLmxhc3RGb2N1c09mZnNldCA9IG51bGw7XG4gICAgdGhpcy5wb2xsaW5nID0gbmV3IERlbGF5ZWQoKTtcbiAgICB0aGlzLmdyYWNlUGVyaW9kID0gZmFsc2U7XG4gIH1cblxuICBDb250ZW50RWRpdGFibGVJbnB1dC5wcm90b3R5cGUgPSBjb3B5T2JqKHtcbiAgICBpbml0OiBmdW5jdGlvbihkaXNwbGF5KSB7XG4gICAgICB2YXIgaW5wdXQgPSB0aGlzLCBjbSA9IGlucHV0LmNtO1xuICAgICAgdmFyIGRpdiA9IGlucHV0LmRpdiA9IGRpc3BsYXkubGluZURpdjtcbiAgICAgIGRpc2FibGVCcm93c2VyTWFnaWMoZGl2KTtcblxuICAgICAgb24oZGl2LCBcInBhc3RlXCIsIGZ1bmN0aW9uKGUpIHsgaGFuZGxlUGFzdGUoZSwgY20pOyB9KVxuXG4gICAgICBvbihkaXYsIFwiY29tcG9zaXRpb25zdGFydFwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIHZhciBkYXRhID0gZS5kYXRhO1xuICAgICAgICBpbnB1dC5jb21wb3NpbmcgPSB7c2VsOiBjbS5kb2Muc2VsLCBkYXRhOiBkYXRhLCBzdGFydERhdGE6IGRhdGF9O1xuICAgICAgICBpZiAoIWRhdGEpIHJldHVybjtcbiAgICAgICAgdmFyIHByaW0gPSBjbS5kb2Muc2VsLnByaW1hcnkoKTtcbiAgICAgICAgdmFyIGxpbmUgPSBjbS5nZXRMaW5lKHByaW0uaGVhZC5saW5lKTtcbiAgICAgICAgdmFyIGZvdW5kID0gbGluZS5pbmRleE9mKGRhdGEsIE1hdGgubWF4KDAsIHByaW0uaGVhZC5jaCAtIGRhdGEubGVuZ3RoKSk7XG4gICAgICAgIGlmIChmb3VuZCA+IC0xICYmIGZvdW5kIDw9IHByaW0uaGVhZC5jaClcbiAgICAgICAgICBpbnB1dC5jb21wb3Npbmcuc2VsID0gc2ltcGxlU2VsZWN0aW9uKFBvcyhwcmltLmhlYWQubGluZSwgZm91bmQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zKHByaW0uaGVhZC5saW5lLCBmb3VuZCArIGRhdGEubGVuZ3RoKSk7XG4gICAgICB9KTtcbiAgICAgIG9uKGRpdiwgXCJjb21wb3NpdGlvbnVwZGF0ZVwiLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlucHV0LmNvbXBvc2luZy5kYXRhID0gZS5kYXRhO1xuICAgICAgfSk7XG4gICAgICBvbihkaXYsIFwiY29tcG9zaXRpb25lbmRcIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICB2YXIgb3VycyA9IGlucHV0LmNvbXBvc2luZztcbiAgICAgICAgaWYgKCFvdXJzKSByZXR1cm47XG4gICAgICAgIGlmIChlLmRhdGEgIT0gb3Vycy5zdGFydERhdGEgJiYgIS9cXHUyMDBiLy50ZXN0KGUuZGF0YSkpXG4gICAgICAgICAgb3Vycy5kYXRhID0gZS5kYXRhO1xuICAgICAgICAvLyBOZWVkIGEgc21hbGwgZGVsYXkgdG8gcHJldmVudCBvdGhlciBjb2RlIChpbnB1dCBldmVudCxcbiAgICAgICAgLy8gc2VsZWN0aW9uIHBvbGxpbmcpIGZyb20gZG9pbmcgZGFtYWdlIHdoZW4gZmlyZWQgcmlnaHQgYWZ0ZXJcbiAgICAgICAgLy8gY29tcG9zaXRpb25lbmQuXG4gICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgaWYgKCFvdXJzLmhhbmRsZWQpXG4gICAgICAgICAgICBpbnB1dC5hcHBseUNvbXBvc2l0aW9uKG91cnMpO1xuICAgICAgICAgIGlmIChpbnB1dC5jb21wb3NpbmcgPT0gb3VycylcbiAgICAgICAgICAgIGlucHV0LmNvbXBvc2luZyA9IG51bGw7XG4gICAgICAgIH0sIDUwKTtcbiAgICAgIH0pO1xuXG4gICAgICBvbihkaXYsIFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgaW5wdXQuZm9yY2VDb21wb3NpdGlvbkVuZCgpO1xuICAgICAgfSk7XG5cbiAgICAgIG9uKGRpdiwgXCJpbnB1dFwiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKGlucHV0LmNvbXBvc2luZykgcmV0dXJuO1xuICAgICAgICBpZiAoaXNSZWFkT25seShjbSkgfHwgIWlucHV0LnBvbGxDb250ZW50KCkpXG4gICAgICAgICAgcnVuSW5PcChpbnB1dC5jbSwgZnVuY3Rpb24oKSB7cmVnQ2hhbmdlKGNtKTt9KTtcbiAgICAgIH0pO1xuXG4gICAgICBmdW5jdGlvbiBvbkNvcHlDdXQoZSkge1xuICAgICAgICBpZiAoY20uc29tZXRoaW5nU2VsZWN0ZWQoKSkge1xuICAgICAgICAgIGxhc3RDb3BpZWQgPSBjbS5nZXRTZWxlY3Rpb25zKCk7XG4gICAgICAgICAgaWYgKGUudHlwZSA9PSBcImN1dFwiKSBjbS5yZXBsYWNlU2VsZWN0aW9uKFwiXCIsIG51bGwsIFwiY3V0XCIpO1xuICAgICAgICB9IGVsc2UgaWYgKCFjbS5vcHRpb25zLmxpbmVXaXNlQ29weUN1dCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgcmFuZ2VzID0gY29weWFibGVSYW5nZXMoY20pO1xuICAgICAgICAgIGxhc3RDb3BpZWQgPSByYW5nZXMudGV4dDtcbiAgICAgICAgICBpZiAoZS50eXBlID09IFwiY3V0XCIpIHtcbiAgICAgICAgICAgIGNtLm9wZXJhdGlvbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgY20uc2V0U2VsZWN0aW9ucyhyYW5nZXMucmFuZ2VzLCAwLCBzZWxfZG9udFNjcm9sbCk7XG4gICAgICAgICAgICAgIGNtLnJlcGxhY2VTZWxlY3Rpb24oXCJcIiwgbnVsbCwgXCJjdXRcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gaU9TIGV4cG9zZXMgdGhlIGNsaXBib2FyZCBBUEksIGJ1dCBzZWVtcyB0byBkaXNjYXJkIGNvbnRlbnQgaW5zZXJ0ZWQgaW50byBpdFxuICAgICAgICBpZiAoZS5jbGlwYm9hcmREYXRhICYmICFpb3MpIHtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgZS5jbGlwYm9hcmREYXRhLmNsZWFyRGF0YSgpO1xuICAgICAgICAgIGUuY2xpcGJvYXJkRGF0YS5zZXREYXRhKFwidGV4dC9wbGFpblwiLCBsYXN0Q29waWVkLmpvaW4oXCJcXG5cIikpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIE9sZC1mYXNoaW9uZWQgYnJpZWZseS1mb2N1cy1hLXRleHRhcmVhIGhhY2tcbiAgICAgICAgICB2YXIga2x1ZGdlID0gaGlkZGVuVGV4dGFyZWEoKSwgdGUgPSBrbHVkZ2UuZmlyc3RDaGlsZDtcbiAgICAgICAgICBjbS5kaXNwbGF5LmxpbmVTcGFjZS5pbnNlcnRCZWZvcmUoa2x1ZGdlLCBjbS5kaXNwbGF5LmxpbmVTcGFjZS5maXJzdENoaWxkKTtcbiAgICAgICAgICB0ZS52YWx1ZSA9IGxhc3RDb3BpZWQuam9pbihcIlxcblwiKTtcbiAgICAgICAgICB2YXIgaGFkRm9jdXMgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50O1xuICAgICAgICAgIHNlbGVjdElucHV0KHRlKTtcbiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY20uZGlzcGxheS5saW5lU3BhY2UucmVtb3ZlQ2hpbGQoa2x1ZGdlKTtcbiAgICAgICAgICAgIGhhZEZvY3VzLmZvY3VzKCk7XG4gICAgICAgICAgfSwgNTApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBvbihkaXYsIFwiY29weVwiLCBvbkNvcHlDdXQpO1xuICAgICAgb24oZGl2LCBcImN1dFwiLCBvbkNvcHlDdXQpO1xuICAgIH0sXG5cbiAgICBwcmVwYXJlU2VsZWN0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciByZXN1bHQgPSBwcmVwYXJlU2VsZWN0aW9uKHRoaXMuY20sIGZhbHNlKTtcbiAgICAgIHJlc3VsdC5mb2N1cyA9IHRoaXMuY20uc3RhdGUuZm9jdXNlZDtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSxcblxuICAgIHNob3dTZWxlY3Rpb246IGZ1bmN0aW9uKGluZm8pIHtcbiAgICAgIGlmICghaW5mbyB8fCAhdGhpcy5jbS5kaXNwbGF5LnZpZXcubGVuZ3RoKSByZXR1cm47XG4gICAgICBpZiAoaW5mby5mb2N1cykgdGhpcy5zaG93UHJpbWFyeVNlbGVjdGlvbigpO1xuICAgICAgdGhpcy5zaG93TXVsdGlwbGVTZWxlY3Rpb25zKGluZm8pO1xuICAgIH0sXG5cbiAgICBzaG93UHJpbWFyeVNlbGVjdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VsID0gd2luZG93LmdldFNlbGVjdGlvbigpLCBwcmltID0gdGhpcy5jbS5kb2Muc2VsLnByaW1hcnkoKTtcbiAgICAgIHZhciBjdXJBbmNob3IgPSBkb21Ub1Bvcyh0aGlzLmNtLCBzZWwuYW5jaG9yTm9kZSwgc2VsLmFuY2hvck9mZnNldCk7XG4gICAgICB2YXIgY3VyRm9jdXMgPSBkb21Ub1Bvcyh0aGlzLmNtLCBzZWwuZm9jdXNOb2RlLCBzZWwuZm9jdXNPZmZzZXQpO1xuICAgICAgaWYgKGN1ckFuY2hvciAmJiAhY3VyQW5jaG9yLmJhZCAmJiBjdXJGb2N1cyAmJiAhY3VyRm9jdXMuYmFkICYmXG4gICAgICAgICAgY21wKG1pblBvcyhjdXJBbmNob3IsIGN1ckZvY3VzKSwgcHJpbS5mcm9tKCkpID09IDAgJiZcbiAgICAgICAgICBjbXAobWF4UG9zKGN1ckFuY2hvciwgY3VyRm9jdXMpLCBwcmltLnRvKCkpID09IDApXG4gICAgICAgIHJldHVybjtcblxuICAgICAgdmFyIHN0YXJ0ID0gcG9zVG9ET00odGhpcy5jbSwgcHJpbS5mcm9tKCkpO1xuICAgICAgdmFyIGVuZCA9IHBvc1RvRE9NKHRoaXMuY20sIHByaW0udG8oKSk7XG4gICAgICBpZiAoIXN0YXJ0ICYmICFlbmQpIHJldHVybjtcblxuICAgICAgdmFyIHZpZXcgPSB0aGlzLmNtLmRpc3BsYXkudmlldztcbiAgICAgIHZhciBvbGQgPSBzZWwucmFuZ2VDb3VudCAmJiBzZWwuZ2V0UmFuZ2VBdCgwKTtcbiAgICAgIGlmICghc3RhcnQpIHtcbiAgICAgICAgc3RhcnQgPSB7bm9kZTogdmlld1swXS5tZWFzdXJlLm1hcFsyXSwgb2Zmc2V0OiAwfTtcbiAgICAgIH0gZWxzZSBpZiAoIWVuZCkgeyAvLyBGSVhNRSBkYW5nZXJvdXNseSBoYWNreVxuICAgICAgICB2YXIgbWVhc3VyZSA9IHZpZXdbdmlldy5sZW5ndGggLSAxXS5tZWFzdXJlO1xuICAgICAgICB2YXIgbWFwID0gbWVhc3VyZS5tYXBzID8gbWVhc3VyZS5tYXBzW21lYXN1cmUubWFwcy5sZW5ndGggLSAxXSA6IG1lYXN1cmUubWFwO1xuICAgICAgICBlbmQgPSB7bm9kZTogbWFwW21hcC5sZW5ndGggLSAxXSwgb2Zmc2V0OiBtYXBbbWFwLmxlbmd0aCAtIDJdIC0gbWFwW21hcC5sZW5ndGggLSAzXX07XG4gICAgICB9XG5cbiAgICAgIHRyeSB7IHZhciBybmcgPSByYW5nZShzdGFydC5ub2RlLCBzdGFydC5vZmZzZXQsIGVuZC5vZmZzZXQsIGVuZC5ub2RlKTsgfVxuICAgICAgY2F0Y2goZSkge30gLy8gT3VyIG1vZGVsIG9mIHRoZSBET00gbWlnaHQgYmUgb3V0ZGF0ZWQsIGluIHdoaWNoIGNhc2UgdGhlIHJhbmdlIHdlIHRyeSB0byBzZXQgY2FuIGJlIGltcG9zc2libGVcbiAgICAgIGlmIChybmcpIHtcbiAgICAgICAgc2VsLnJlbW92ZUFsbFJhbmdlcygpO1xuICAgICAgICBzZWwuYWRkUmFuZ2Uocm5nKTtcbiAgICAgICAgaWYgKG9sZCAmJiBzZWwuYW5jaG9yTm9kZSA9PSBudWxsKSBzZWwuYWRkUmFuZ2Uob2xkKTtcbiAgICAgICAgZWxzZSBpZiAoZ2Vja28pIHRoaXMuc3RhcnRHcmFjZVBlcmlvZCgpO1xuICAgICAgfVxuICAgICAgdGhpcy5yZW1lbWJlclNlbGVjdGlvbigpO1xuICAgIH0sXG5cbiAgICBzdGFydEdyYWNlUGVyaW9kOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBpbnB1dCA9IHRoaXM7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy5ncmFjZVBlcmlvZCk7XG4gICAgICB0aGlzLmdyYWNlUGVyaW9kID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgaW5wdXQuZ3JhY2VQZXJpb2QgPSBmYWxzZTtcbiAgICAgICAgaWYgKGlucHV0LnNlbGVjdGlvbkNoYW5nZWQoKSlcbiAgICAgICAgICBpbnB1dC5jbS5vcGVyYXRpb24oZnVuY3Rpb24oKSB7IGlucHV0LmNtLmN1ck9wLnNlbGVjdGlvbkNoYW5nZWQgPSB0cnVlOyB9KTtcbiAgICAgIH0sIDIwKTtcbiAgICB9LFxuXG4gICAgc2hvd011bHRpcGxlU2VsZWN0aW9uczogZnVuY3Rpb24oaW5mbykge1xuICAgICAgcmVtb3ZlQ2hpbGRyZW5BbmRBZGQodGhpcy5jbS5kaXNwbGF5LmN1cnNvckRpdiwgaW5mby5jdXJzb3JzKTtcbiAgICAgIHJlbW92ZUNoaWxkcmVuQW5kQWRkKHRoaXMuY20uZGlzcGxheS5zZWxlY3Rpb25EaXYsIGluZm8uc2VsZWN0aW9uKTtcbiAgICB9LFxuXG4gICAgcmVtZW1iZXJTZWxlY3Rpb246IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTtcbiAgICAgIHRoaXMubGFzdEFuY2hvck5vZGUgPSBzZWwuYW5jaG9yTm9kZTsgdGhpcy5sYXN0QW5jaG9yT2Zmc2V0ID0gc2VsLmFuY2hvck9mZnNldDtcbiAgICAgIHRoaXMubGFzdEZvY3VzTm9kZSA9IHNlbC5mb2N1c05vZGU7IHRoaXMubGFzdEZvY3VzT2Zmc2V0ID0gc2VsLmZvY3VzT2Zmc2V0O1xuICAgIH0sXG5cbiAgICBzZWxlY3Rpb25JbkVkaXRvcjogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VsID0gd2luZG93LmdldFNlbGVjdGlvbigpO1xuICAgICAgaWYgKCFzZWwucmFuZ2VDb3VudCkgcmV0dXJuIGZhbHNlO1xuICAgICAgdmFyIG5vZGUgPSBzZWwuZ2V0UmFuZ2VBdCgwKS5jb21tb25BbmNlc3RvckNvbnRhaW5lcjtcbiAgICAgIHJldHVybiBjb250YWlucyh0aGlzLmRpdiwgbm9kZSk7XG4gICAgfSxcblxuICAgIGZvY3VzOiBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLmNtLm9wdGlvbnMucmVhZE9ubHkgIT0gXCJub2N1cnNvclwiKSB0aGlzLmRpdi5mb2N1cygpO1xuICAgIH0sXG4gICAgYmx1cjogZnVuY3Rpb24oKSB7IHRoaXMuZGl2LmJsdXIoKTsgfSxcbiAgICBnZXRGaWVsZDogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLmRpdjsgfSxcblxuICAgIHN1cHBvcnRzVG91Y2g6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdHJ1ZTsgfSxcblxuICAgIHJlY2VpdmVkRm9jdXM6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGlucHV0ID0gdGhpcztcbiAgICAgIGlmICh0aGlzLnNlbGVjdGlvbkluRWRpdG9yKCkpXG4gICAgICAgIHRoaXMucG9sbFNlbGVjdGlvbigpO1xuICAgICAgZWxzZVxuICAgICAgICBydW5Jbk9wKHRoaXMuY20sIGZ1bmN0aW9uKCkgeyBpbnB1dC5jbS5jdXJPcC5zZWxlY3Rpb25DaGFuZ2VkID0gdHJ1ZTsgfSk7XG5cbiAgICAgIGZ1bmN0aW9uIHBvbGwoKSB7XG4gICAgICAgIGlmIChpbnB1dC5jbS5zdGF0ZS5mb2N1c2VkKSB7XG4gICAgICAgICAgaW5wdXQucG9sbFNlbGVjdGlvbigpO1xuICAgICAgICAgIGlucHV0LnBvbGxpbmcuc2V0KGlucHV0LmNtLm9wdGlvbnMucG9sbEludGVydmFsLCBwb2xsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5wb2xsaW5nLnNldCh0aGlzLmNtLm9wdGlvbnMucG9sbEludGVydmFsLCBwb2xsKTtcbiAgICB9LFxuXG4gICAgc2VsZWN0aW9uQ2hhbmdlZDogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VsID0gd2luZG93LmdldFNlbGVjdGlvbigpO1xuICAgICAgcmV0dXJuIHNlbC5hbmNob3JOb2RlICE9IHRoaXMubGFzdEFuY2hvck5vZGUgfHwgc2VsLmFuY2hvck9mZnNldCAhPSB0aGlzLmxhc3RBbmNob3JPZmZzZXQgfHxcbiAgICAgICAgc2VsLmZvY3VzTm9kZSAhPSB0aGlzLmxhc3RGb2N1c05vZGUgfHwgc2VsLmZvY3VzT2Zmc2V0ICE9IHRoaXMubGFzdEZvY3VzT2Zmc2V0O1xuICAgIH0sXG5cbiAgICBwb2xsU2VsZWN0aW9uOiBmdW5jdGlvbigpIHtcbiAgICAgIGlmICghdGhpcy5jb21wb3NpbmcgJiYgIXRoaXMuZ3JhY2VQZXJpb2QgJiYgdGhpcy5zZWxlY3Rpb25DaGFuZ2VkKCkpIHtcbiAgICAgICAgdmFyIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKSwgY20gPSB0aGlzLmNtO1xuICAgICAgICB0aGlzLnJlbWVtYmVyU2VsZWN0aW9uKCk7XG4gICAgICAgIHZhciBhbmNob3IgPSBkb21Ub1BvcyhjbSwgc2VsLmFuY2hvck5vZGUsIHNlbC5hbmNob3JPZmZzZXQpO1xuICAgICAgICB2YXIgaGVhZCA9IGRvbVRvUG9zKGNtLCBzZWwuZm9jdXNOb2RlLCBzZWwuZm9jdXNPZmZzZXQpO1xuICAgICAgICBpZiAoYW5jaG9yICYmIGhlYWQpIHJ1bkluT3AoY20sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHNldFNlbGVjdGlvbihjbS5kb2MsIHNpbXBsZVNlbGVjdGlvbihhbmNob3IsIGhlYWQpLCBzZWxfZG9udFNjcm9sbCk7XG4gICAgICAgICAgaWYgKGFuY2hvci5iYWQgfHwgaGVhZC5iYWQpIGNtLmN1ck9wLnNlbGVjdGlvbkNoYW5nZWQgPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9LFxuXG4gICAgcG9sbENvbnRlbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGNtID0gdGhpcy5jbSwgZGlzcGxheSA9IGNtLmRpc3BsYXksIHNlbCA9IGNtLmRvYy5zZWwucHJpbWFyeSgpO1xuICAgICAgdmFyIGZyb20gPSBzZWwuZnJvbSgpLCB0byA9IHNlbC50bygpO1xuICAgICAgaWYgKGZyb20ubGluZSA8IGRpc3BsYXkudmlld0Zyb20gfHwgdG8ubGluZSA+IGRpc3BsYXkudmlld1RvIC0gMSkgcmV0dXJuIGZhbHNlO1xuXG4gICAgICB2YXIgZnJvbUluZGV4O1xuICAgICAgaWYgKGZyb20ubGluZSA9PSBkaXNwbGF5LnZpZXdGcm9tIHx8IChmcm9tSW5kZXggPSBmaW5kVmlld0luZGV4KGNtLCBmcm9tLmxpbmUpKSA9PSAwKSB7XG4gICAgICAgIHZhciBmcm9tTGluZSA9IGxpbmVObyhkaXNwbGF5LnZpZXdbMF0ubGluZSk7XG4gICAgICAgIHZhciBmcm9tTm9kZSA9IGRpc3BsYXkudmlld1swXS5ub2RlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGZyb21MaW5lID0gbGluZU5vKGRpc3BsYXkudmlld1tmcm9tSW5kZXhdLmxpbmUpO1xuICAgICAgICB2YXIgZnJvbU5vZGUgPSBkaXNwbGF5LnZpZXdbZnJvbUluZGV4IC0gMV0ubm9kZS5uZXh0U2libGluZztcbiAgICAgIH1cbiAgICAgIHZhciB0b0luZGV4ID0gZmluZFZpZXdJbmRleChjbSwgdG8ubGluZSk7XG4gICAgICBpZiAodG9JbmRleCA9PSBkaXNwbGF5LnZpZXcubGVuZ3RoIC0gMSkge1xuICAgICAgICB2YXIgdG9MaW5lID0gZGlzcGxheS52aWV3VG8gLSAxO1xuICAgICAgICB2YXIgdG9Ob2RlID0gZGlzcGxheS5saW5lRGl2Lmxhc3RDaGlsZDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciB0b0xpbmUgPSBsaW5lTm8oZGlzcGxheS52aWV3W3RvSW5kZXggKyAxXS5saW5lKSAtIDE7XG4gICAgICAgIHZhciB0b05vZGUgPSBkaXNwbGF5LnZpZXdbdG9JbmRleCArIDFdLm5vZGUucHJldmlvdXNTaWJsaW5nO1xuICAgICAgfVxuXG4gICAgICB2YXIgbmV3VGV4dCA9IGNtLmRvYy5zcGxpdExpbmVzKGRvbVRleHRCZXR3ZWVuKGNtLCBmcm9tTm9kZSwgdG9Ob2RlLCBmcm9tTGluZSwgdG9MaW5lKSk7XG4gICAgICB2YXIgb2xkVGV4dCA9IGdldEJldHdlZW4oY20uZG9jLCBQb3MoZnJvbUxpbmUsIDApLCBQb3ModG9MaW5lLCBnZXRMaW5lKGNtLmRvYywgdG9MaW5lKS50ZXh0Lmxlbmd0aCkpO1xuICAgICAgd2hpbGUgKG5ld1RleHQubGVuZ3RoID4gMSAmJiBvbGRUZXh0Lmxlbmd0aCA+IDEpIHtcbiAgICAgICAgaWYgKGxzdChuZXdUZXh0KSA9PSBsc3Qob2xkVGV4dCkpIHsgbmV3VGV4dC5wb3AoKTsgb2xkVGV4dC5wb3AoKTsgdG9MaW5lLS07IH1cbiAgICAgICAgZWxzZSBpZiAobmV3VGV4dFswXSA9PSBvbGRUZXh0WzBdKSB7IG5ld1RleHQuc2hpZnQoKTsgb2xkVGV4dC5zaGlmdCgpOyBmcm9tTGluZSsrOyB9XG4gICAgICAgIGVsc2UgYnJlYWs7XG4gICAgICB9XG5cbiAgICAgIHZhciBjdXRGcm9udCA9IDAsIGN1dEVuZCA9IDA7XG4gICAgICB2YXIgbmV3VG9wID0gbmV3VGV4dFswXSwgb2xkVG9wID0gb2xkVGV4dFswXSwgbWF4Q3V0RnJvbnQgPSBNYXRoLm1pbihuZXdUb3AubGVuZ3RoLCBvbGRUb3AubGVuZ3RoKTtcbiAgICAgIHdoaWxlIChjdXRGcm9udCA8IG1heEN1dEZyb250ICYmIG5ld1RvcC5jaGFyQ29kZUF0KGN1dEZyb250KSA9PSBvbGRUb3AuY2hhckNvZGVBdChjdXRGcm9udCkpXG4gICAgICAgICsrY3V0RnJvbnQ7XG4gICAgICB2YXIgbmV3Qm90ID0gbHN0KG5ld1RleHQpLCBvbGRCb3QgPSBsc3Qob2xkVGV4dCk7XG4gICAgICB2YXIgbWF4Q3V0RW5kID0gTWF0aC5taW4obmV3Qm90Lmxlbmd0aCAtIChuZXdUZXh0Lmxlbmd0aCA9PSAxID8gY3V0RnJvbnQgOiAwKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRCb3QubGVuZ3RoIC0gKG9sZFRleHQubGVuZ3RoID09IDEgPyBjdXRGcm9udCA6IDApKTtcbiAgICAgIHdoaWxlIChjdXRFbmQgPCBtYXhDdXRFbmQgJiZcbiAgICAgICAgICAgICBuZXdCb3QuY2hhckNvZGVBdChuZXdCb3QubGVuZ3RoIC0gY3V0RW5kIC0gMSkgPT0gb2xkQm90LmNoYXJDb2RlQXQob2xkQm90Lmxlbmd0aCAtIGN1dEVuZCAtIDEpKVxuICAgICAgICArK2N1dEVuZDtcblxuICAgICAgbmV3VGV4dFtuZXdUZXh0Lmxlbmd0aCAtIDFdID0gbmV3Qm90LnNsaWNlKDAsIG5ld0JvdC5sZW5ndGggLSBjdXRFbmQpO1xuICAgICAgbmV3VGV4dFswXSA9IG5ld1RleHRbMF0uc2xpY2UoY3V0RnJvbnQpO1xuXG4gICAgICB2YXIgY2hGcm9tID0gUG9zKGZyb21MaW5lLCBjdXRGcm9udCk7XG4gICAgICB2YXIgY2hUbyA9IFBvcyh0b0xpbmUsIG9sZFRleHQubGVuZ3RoID8gbHN0KG9sZFRleHQpLmxlbmd0aCAtIGN1dEVuZCA6IDApO1xuICAgICAgaWYgKG5ld1RleHQubGVuZ3RoID4gMSB8fCBuZXdUZXh0WzBdIHx8IGNtcChjaEZyb20sIGNoVG8pKSB7XG4gICAgICAgIHJlcGxhY2VSYW5nZShjbS5kb2MsIG5ld1RleHQsIGNoRnJvbSwgY2hUbywgXCIraW5wdXRcIik7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH0sXG5cbiAgICBlbnN1cmVQb2xsZWQ6IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5mb3JjZUNvbXBvc2l0aW9uRW5kKCk7XG4gICAgfSxcbiAgICByZXNldDogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmZvcmNlQ29tcG9zaXRpb25FbmQoKTtcbiAgICB9LFxuICAgIGZvcmNlQ29tcG9zaXRpb25FbmQ6IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKCF0aGlzLmNvbXBvc2luZyB8fCB0aGlzLmNvbXBvc2luZy5oYW5kbGVkKSByZXR1cm47XG4gICAgICB0aGlzLmFwcGx5Q29tcG9zaXRpb24odGhpcy5jb21wb3NpbmcpO1xuICAgICAgdGhpcy5jb21wb3NpbmcuaGFuZGxlZCA9IHRydWU7XG4gICAgICB0aGlzLmRpdi5ibHVyKCk7XG4gICAgICB0aGlzLmRpdi5mb2N1cygpO1xuICAgIH0sXG4gICAgYXBwbHlDb21wb3NpdGlvbjogZnVuY3Rpb24oY29tcG9zaW5nKSB7XG4gICAgICBpZiAoaXNSZWFkT25seSh0aGlzLmNtKSlcbiAgICAgICAgb3BlcmF0aW9uKHRoaXMuY20sIHJlZ0NoYW5nZSkodGhpcy5jbSlcbiAgICAgIGVsc2UgaWYgKGNvbXBvc2luZy5kYXRhICYmIGNvbXBvc2luZy5kYXRhICE9IGNvbXBvc2luZy5zdGFydERhdGEpXG4gICAgICAgIG9wZXJhdGlvbih0aGlzLmNtLCBhcHBseVRleHRJbnB1dCkodGhpcy5jbSwgY29tcG9zaW5nLmRhdGEsIDAsIGNvbXBvc2luZy5zZWwpO1xuICAgIH0sXG5cbiAgICBzZXRVbmVkaXRhYmxlOiBmdW5jdGlvbihub2RlKSB7XG4gICAgICBub2RlLmNvbnRlbnRFZGl0YWJsZSA9IFwiZmFsc2VcIlxuICAgIH0sXG5cbiAgICBvbktleVByZXNzOiBmdW5jdGlvbihlKSB7XG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICBpZiAoIWlzUmVhZE9ubHkodGhpcy5jbSkpXG4gICAgICAgIG9wZXJhdGlvbih0aGlzLmNtLCBhcHBseVRleHRJbnB1dCkodGhpcy5jbSwgU3RyaW5nLmZyb21DaGFyQ29kZShlLmNoYXJDb2RlID09IG51bGwgPyBlLmtleUNvZGUgOiBlLmNoYXJDb2RlKSwgMCk7XG4gICAgfSxcblxuICAgIHJlYWRPbmx5Q2hhbmdlZDogZnVuY3Rpb24odmFsKSB7XG4gICAgICB0aGlzLmRpdi5jb250ZW50RWRpdGFibGUgPSBTdHJpbmcodmFsICE9IFwibm9jdXJzb3JcIilcbiAgICB9LFxuXG4gICAgb25Db250ZXh0TWVudTogbm90aGluZyxcbiAgICByZXNldFBvc2l0aW9uOiBub3RoaW5nLFxuXG4gICAgbmVlZHNDb250ZW50QXR0cmlidXRlOiB0cnVlXG4gIH0sIENvbnRlbnRFZGl0YWJsZUlucHV0LnByb3RvdHlwZSk7XG5cbiAgZnVuY3Rpb24gcG9zVG9ET00oY20sIHBvcykge1xuICAgIHZhciB2aWV3ID0gZmluZFZpZXdGb3JMaW5lKGNtLCBwb3MubGluZSk7XG4gICAgaWYgKCF2aWV3IHx8IHZpZXcuaGlkZGVuKSByZXR1cm4gbnVsbDtcbiAgICB2YXIgbGluZSA9IGdldExpbmUoY20uZG9jLCBwb3MubGluZSk7XG4gICAgdmFyIGluZm8gPSBtYXBGcm9tTGluZVZpZXcodmlldywgbGluZSwgcG9zLmxpbmUpO1xuXG4gICAgdmFyIG9yZGVyID0gZ2V0T3JkZXIobGluZSksIHNpZGUgPSBcImxlZnRcIjtcbiAgICBpZiAob3JkZXIpIHtcbiAgICAgIHZhciBwYXJ0UG9zID0gZ2V0QmlkaVBhcnRBdChvcmRlciwgcG9zLmNoKTtcbiAgICAgIHNpZGUgPSBwYXJ0UG9zICUgMiA/IFwicmlnaHRcIiA6IFwibGVmdFwiO1xuICAgIH1cbiAgICB2YXIgcmVzdWx0ID0gbm9kZUFuZE9mZnNldEluTGluZU1hcChpbmZvLm1hcCwgcG9zLmNoLCBzaWRlKTtcbiAgICByZXN1bHQub2Zmc2V0ID0gcmVzdWx0LmNvbGxhcHNlID09IFwicmlnaHRcIiA/IHJlc3VsdC5lbmQgOiByZXN1bHQuc3RhcnQ7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGJhZFBvcyhwb3MsIGJhZCkgeyBpZiAoYmFkKSBwb3MuYmFkID0gdHJ1ZTsgcmV0dXJuIHBvczsgfVxuXG4gIGZ1bmN0aW9uIGRvbVRvUG9zKGNtLCBub2RlLCBvZmZzZXQpIHtcbiAgICB2YXIgbGluZU5vZGU7XG4gICAgaWYgKG5vZGUgPT0gY20uZGlzcGxheS5saW5lRGl2KSB7XG4gICAgICBsaW5lTm9kZSA9IGNtLmRpc3BsYXkubGluZURpdi5jaGlsZE5vZGVzW29mZnNldF07XG4gICAgICBpZiAoIWxpbmVOb2RlKSByZXR1cm4gYmFkUG9zKGNtLmNsaXBQb3MoUG9zKGNtLmRpc3BsYXkudmlld1RvIC0gMSkpLCB0cnVlKTtcbiAgICAgIG5vZGUgPSBudWxsOyBvZmZzZXQgPSAwO1xuICAgIH0gZWxzZSB7XG4gICAgICBmb3IgKGxpbmVOb2RlID0gbm9kZTs7IGxpbmVOb2RlID0gbGluZU5vZGUucGFyZW50Tm9kZSkge1xuICAgICAgICBpZiAoIWxpbmVOb2RlIHx8IGxpbmVOb2RlID09IGNtLmRpc3BsYXkubGluZURpdikgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmIChsaW5lTm9kZS5wYXJlbnROb2RlICYmIGxpbmVOb2RlLnBhcmVudE5vZGUgPT0gY20uZGlzcGxheS5saW5lRGl2KSBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjbS5kaXNwbGF5LnZpZXcubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBsaW5lVmlldyA9IGNtLmRpc3BsYXkudmlld1tpXTtcbiAgICAgIGlmIChsaW5lVmlldy5ub2RlID09IGxpbmVOb2RlKVxuICAgICAgICByZXR1cm4gbG9jYXRlTm9kZUluTGluZVZpZXcobGluZVZpZXcsIG5vZGUsIG9mZnNldCk7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gbG9jYXRlTm9kZUluTGluZVZpZXcobGluZVZpZXcsIG5vZGUsIG9mZnNldCkge1xuICAgIHZhciB3cmFwcGVyID0gbGluZVZpZXcudGV4dC5maXJzdENoaWxkLCBiYWQgPSBmYWxzZTtcbiAgICBpZiAoIW5vZGUgfHwgIWNvbnRhaW5zKHdyYXBwZXIsIG5vZGUpKSByZXR1cm4gYmFkUG9zKFBvcyhsaW5lTm8obGluZVZpZXcubGluZSksIDApLCB0cnVlKTtcbiAgICBpZiAobm9kZSA9PSB3cmFwcGVyKSB7XG4gICAgICBiYWQgPSB0cnVlO1xuICAgICAgbm9kZSA9IHdyYXBwZXIuY2hpbGROb2Rlc1tvZmZzZXRdO1xuICAgICAgb2Zmc2V0ID0gMDtcbiAgICAgIGlmICghbm9kZSkge1xuICAgICAgICB2YXIgbGluZSA9IGxpbmVWaWV3LnJlc3QgPyBsc3QobGluZVZpZXcucmVzdCkgOiBsaW5lVmlldy5saW5lO1xuICAgICAgICByZXR1cm4gYmFkUG9zKFBvcyhsaW5lTm8obGluZSksIGxpbmUudGV4dC5sZW5ndGgpLCBiYWQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciB0ZXh0Tm9kZSA9IG5vZGUubm9kZVR5cGUgPT0gMyA/IG5vZGUgOiBudWxsLCB0b3BOb2RlID0gbm9kZTtcbiAgICBpZiAoIXRleHROb2RlICYmIG5vZGUuY2hpbGROb2Rlcy5sZW5ndGggPT0gMSAmJiBub2RlLmZpcnN0Q2hpbGQubm9kZVR5cGUgPT0gMykge1xuICAgICAgdGV4dE5vZGUgPSBub2RlLmZpcnN0Q2hpbGQ7XG4gICAgICBpZiAob2Zmc2V0KSBvZmZzZXQgPSB0ZXh0Tm9kZS5ub2RlVmFsdWUubGVuZ3RoO1xuICAgIH1cbiAgICB3aGlsZSAodG9wTm9kZS5wYXJlbnROb2RlICE9IHdyYXBwZXIpIHRvcE5vZGUgPSB0b3BOb2RlLnBhcmVudE5vZGU7XG4gICAgdmFyIG1lYXN1cmUgPSBsaW5lVmlldy5tZWFzdXJlLCBtYXBzID0gbWVhc3VyZS5tYXBzO1xuXG4gICAgZnVuY3Rpb24gZmluZCh0ZXh0Tm9kZSwgdG9wTm9kZSwgb2Zmc2V0KSB7XG4gICAgICBmb3IgKHZhciBpID0gLTE7IGkgPCAobWFwcyA/IG1hcHMubGVuZ3RoIDogMCk7IGkrKykge1xuICAgICAgICB2YXIgbWFwID0gaSA8IDAgPyBtZWFzdXJlLm1hcCA6IG1hcHNbaV07XG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbWFwLmxlbmd0aDsgaiArPSAzKSB7XG4gICAgICAgICAgdmFyIGN1ck5vZGUgPSBtYXBbaiArIDJdO1xuICAgICAgICAgIGlmIChjdXJOb2RlID09IHRleHROb2RlIHx8IGN1ck5vZGUgPT0gdG9wTm9kZSkge1xuICAgICAgICAgICAgdmFyIGxpbmUgPSBsaW5lTm8oaSA8IDAgPyBsaW5lVmlldy5saW5lIDogbGluZVZpZXcucmVzdFtpXSk7XG4gICAgICAgICAgICB2YXIgY2ggPSBtYXBbal0gKyBvZmZzZXQ7XG4gICAgICAgICAgICBpZiAob2Zmc2V0IDwgMCB8fCBjdXJOb2RlICE9IHRleHROb2RlKSBjaCA9IG1hcFtqICsgKG9mZnNldCA/IDEgOiAwKV07XG4gICAgICAgICAgICByZXR1cm4gUG9zKGxpbmUsIGNoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIGZvdW5kID0gZmluZCh0ZXh0Tm9kZSwgdG9wTm9kZSwgb2Zmc2V0KTtcbiAgICBpZiAoZm91bmQpIHJldHVybiBiYWRQb3MoZm91bmQsIGJhZCk7XG5cbiAgICAvLyBGSVhNRSB0aGlzIGlzIGFsbCByZWFsbHkgc2hha3kuIG1pZ2h0IGhhbmRsZSB0aGUgZmV3IGNhc2VzIGl0IG5lZWRzIHRvIGhhbmRsZSwgYnV0IGxpa2VseSB0byBjYXVzZSBwcm9ibGVtc1xuICAgIGZvciAodmFyIGFmdGVyID0gdG9wTm9kZS5uZXh0U2libGluZywgZGlzdCA9IHRleHROb2RlID8gdGV4dE5vZGUubm9kZVZhbHVlLmxlbmd0aCAtIG9mZnNldCA6IDA7IGFmdGVyOyBhZnRlciA9IGFmdGVyLm5leHRTaWJsaW5nKSB7XG4gICAgICBmb3VuZCA9IGZpbmQoYWZ0ZXIsIGFmdGVyLmZpcnN0Q2hpbGQsIDApO1xuICAgICAgaWYgKGZvdW5kKVxuICAgICAgICByZXR1cm4gYmFkUG9zKFBvcyhmb3VuZC5saW5lLCBmb3VuZC5jaCAtIGRpc3QpLCBiYWQpO1xuICAgICAgZWxzZVxuICAgICAgICBkaXN0ICs9IGFmdGVyLnRleHRDb250ZW50Lmxlbmd0aDtcbiAgICB9XG4gICAgZm9yICh2YXIgYmVmb3JlID0gdG9wTm9kZS5wcmV2aW91c1NpYmxpbmcsIGRpc3QgPSBvZmZzZXQ7IGJlZm9yZTsgYmVmb3JlID0gYmVmb3JlLnByZXZpb3VzU2libGluZykge1xuICAgICAgZm91bmQgPSBmaW5kKGJlZm9yZSwgYmVmb3JlLmZpcnN0Q2hpbGQsIC0xKTtcbiAgICAgIGlmIChmb3VuZClcbiAgICAgICAgcmV0dXJuIGJhZFBvcyhQb3MoZm91bmQubGluZSwgZm91bmQuY2ggKyBkaXN0KSwgYmFkKTtcbiAgICAgIGVsc2VcbiAgICAgICAgZGlzdCArPSBhZnRlci50ZXh0Q29udGVudC5sZW5ndGg7XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gZG9tVGV4dEJldHdlZW4oY20sIGZyb20sIHRvLCBmcm9tTGluZSwgdG9MaW5lKSB7XG4gICAgdmFyIHRleHQgPSBcIlwiLCBjbG9zaW5nID0gZmFsc2UsIGxpbmVTZXAgPSBjbS5kb2MubGluZVNlcGFyYXRvcigpO1xuICAgIGZ1bmN0aW9uIHJlY29nbml6ZU1hcmtlcihpZCkgeyByZXR1cm4gZnVuY3Rpb24obWFya2VyKSB7IHJldHVybiBtYXJrZXIuaWQgPT0gaWQ7IH07IH1cbiAgICBmdW5jdGlvbiB3YWxrKG5vZGUpIHtcbiAgICAgIGlmIChub2RlLm5vZGVUeXBlID09IDEpIHtcbiAgICAgICAgdmFyIGNtVGV4dCA9IG5vZGUuZ2V0QXR0cmlidXRlKFwiY20tdGV4dFwiKTtcbiAgICAgICAgaWYgKGNtVGV4dCAhPSBudWxsKSB7XG4gICAgICAgICAgaWYgKGNtVGV4dCA9PSBcIlwiKSBjbVRleHQgPSBub2RlLnRleHRDb250ZW50LnJlcGxhY2UoL1xcdTIwMGIvZywgXCJcIik7XG4gICAgICAgICAgdGV4dCArPSBjbVRleHQ7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBtYXJrZXJJRCA9IG5vZGUuZ2V0QXR0cmlidXRlKFwiY20tbWFya2VyXCIpLCByYW5nZTtcbiAgICAgICAgaWYgKG1hcmtlcklEKSB7XG4gICAgICAgICAgdmFyIGZvdW5kID0gY20uZmluZE1hcmtzKFBvcyhmcm9tTGluZSwgMCksIFBvcyh0b0xpbmUgKyAxLCAwKSwgcmVjb2duaXplTWFya2VyKCttYXJrZXJJRCkpO1xuICAgICAgICAgIGlmIChmb3VuZC5sZW5ndGggJiYgKHJhbmdlID0gZm91bmRbMF0uZmluZCgpKSlcbiAgICAgICAgICAgIHRleHQgKz0gZ2V0QmV0d2VlbihjbS5kb2MsIHJhbmdlLmZyb20sIHJhbmdlLnRvKS5qb2luKGxpbmVTZXApO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAobm9kZS5nZXRBdHRyaWJ1dGUoXCJjb250ZW50ZWRpdGFibGVcIikgPT0gXCJmYWxzZVwiKSByZXR1cm47XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbm9kZS5jaGlsZE5vZGVzLmxlbmd0aDsgaSsrKVxuICAgICAgICAgIHdhbGsobm9kZS5jaGlsZE5vZGVzW2ldKTtcbiAgICAgICAgaWYgKC9eKHByZXxkaXZ8cCkkL2kudGVzdChub2RlLm5vZGVOYW1lKSlcbiAgICAgICAgICBjbG9zaW5nID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSBpZiAobm9kZS5ub2RlVHlwZSA9PSAzKSB7XG4gICAgICAgIHZhciB2YWwgPSBub2RlLm5vZGVWYWx1ZTtcbiAgICAgICAgaWYgKCF2YWwpIHJldHVybjtcbiAgICAgICAgaWYgKGNsb3NpbmcpIHtcbiAgICAgICAgICB0ZXh0ICs9IGxpbmVTZXA7XG4gICAgICAgICAgY2xvc2luZyA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHRleHQgKz0gdmFsO1xuICAgICAgfVxuICAgIH1cbiAgICBmb3IgKDs7KSB7XG4gICAgICB3YWxrKGZyb20pO1xuICAgICAgaWYgKGZyb20gPT0gdG8pIGJyZWFrO1xuICAgICAgZnJvbSA9IGZyb20ubmV4dFNpYmxpbmc7XG4gICAgfVxuICAgIHJldHVybiB0ZXh0O1xuICB9XG5cbiAgQ29kZU1pcnJvci5pbnB1dFN0eWxlcyA9IHtcInRleHRhcmVhXCI6IFRleHRhcmVhSW5wdXQsIFwiY29udGVudGVkaXRhYmxlXCI6IENvbnRlbnRFZGl0YWJsZUlucHV0fTtcblxuICAvLyBTRUxFQ1RJT04gLyBDVVJTT1JcblxuICAvLyBTZWxlY3Rpb24gb2JqZWN0cyBhcmUgaW1tdXRhYmxlLiBBIG5ldyBvbmUgaXMgY3JlYXRlZCBldmVyeSB0aW1lXG4gIC8vIHRoZSBzZWxlY3Rpb24gY2hhbmdlcy4gQSBzZWxlY3Rpb24gaXMgb25lIG9yIG1vcmUgbm9uLW92ZXJsYXBwaW5nXG4gIC8vIChhbmQgbm9uLXRvdWNoaW5nKSByYW5nZXMsIHNvcnRlZCwgYW5kIGFuIGludGVnZXIgdGhhdCBpbmRpY2F0ZXNcbiAgLy8gd2hpY2ggb25lIGlzIHRoZSBwcmltYXJ5IHNlbGVjdGlvbiAodGhlIG9uZSB0aGF0J3Mgc2Nyb2xsZWQgaW50b1xuICAvLyB2aWV3LCB0aGF0IGdldEN1cnNvciByZXR1cm5zLCBldGMpLlxuICBmdW5jdGlvbiBTZWxlY3Rpb24ocmFuZ2VzLCBwcmltSW5kZXgpIHtcbiAgICB0aGlzLnJhbmdlcyA9IHJhbmdlcztcbiAgICB0aGlzLnByaW1JbmRleCA9IHByaW1JbmRleDtcbiAgfVxuXG4gIFNlbGVjdGlvbi5wcm90b3R5cGUgPSB7XG4gICAgcHJpbWFyeTogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnJhbmdlc1t0aGlzLnByaW1JbmRleF07IH0sXG4gICAgZXF1YWxzOiBmdW5jdGlvbihvdGhlcikge1xuICAgICAgaWYgKG90aGVyID09IHRoaXMpIHJldHVybiB0cnVlO1xuICAgICAgaWYgKG90aGVyLnByaW1JbmRleCAhPSB0aGlzLnByaW1JbmRleCB8fCBvdGhlci5yYW5nZXMubGVuZ3RoICE9IHRoaXMucmFuZ2VzLmxlbmd0aCkgcmV0dXJuIGZhbHNlO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnJhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgaGVyZSA9IHRoaXMucmFuZ2VzW2ldLCB0aGVyZSA9IG90aGVyLnJhbmdlc1tpXTtcbiAgICAgICAgaWYgKGNtcChoZXJlLmFuY2hvciwgdGhlcmUuYW5jaG9yKSAhPSAwIHx8IGNtcChoZXJlLmhlYWQsIHRoZXJlLmhlYWQpICE9IDApIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0sXG4gICAgZGVlcENvcHk6IGZ1bmN0aW9uKCkge1xuICAgICAgZm9yICh2YXIgb3V0ID0gW10sIGkgPSAwOyBpIDwgdGhpcy5yYW5nZXMubGVuZ3RoOyBpKyspXG4gICAgICAgIG91dFtpXSA9IG5ldyBSYW5nZShjb3B5UG9zKHRoaXMucmFuZ2VzW2ldLmFuY2hvciksIGNvcHlQb3ModGhpcy5yYW5nZXNbaV0uaGVhZCkpO1xuICAgICAgcmV0dXJuIG5ldyBTZWxlY3Rpb24ob3V0LCB0aGlzLnByaW1JbmRleCk7XG4gICAgfSxcbiAgICBzb21ldGhpbmdTZWxlY3RlZDogZnVuY3Rpb24oKSB7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucmFuZ2VzLmxlbmd0aDsgaSsrKVxuICAgICAgICBpZiAoIXRoaXMucmFuZ2VzW2ldLmVtcHR5KCkpIHJldHVybiB0cnVlO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0sXG4gICAgY29udGFpbnM6IGZ1bmN0aW9uKHBvcywgZW5kKSB7XG4gICAgICBpZiAoIWVuZCkgZW5kID0gcG9zO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnJhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgcmFuZ2UgPSB0aGlzLnJhbmdlc1tpXTtcbiAgICAgICAgaWYgKGNtcChlbmQsIHJhbmdlLmZyb20oKSkgPj0gMCAmJiBjbXAocG9zLCByYW5nZS50bygpKSA8PSAwKVxuICAgICAgICAgIHJldHVybiBpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgfTtcblxuICBmdW5jdGlvbiBSYW5nZShhbmNob3IsIGhlYWQpIHtcbiAgICB0aGlzLmFuY2hvciA9IGFuY2hvcjsgdGhpcy5oZWFkID0gaGVhZDtcbiAgfVxuXG4gIFJhbmdlLnByb3RvdHlwZSA9IHtcbiAgICBmcm9tOiBmdW5jdGlvbigpIHsgcmV0dXJuIG1pblBvcyh0aGlzLmFuY2hvciwgdGhpcy5oZWFkKTsgfSxcbiAgICB0bzogZnVuY3Rpb24oKSB7IHJldHVybiBtYXhQb3ModGhpcy5hbmNob3IsIHRoaXMuaGVhZCk7IH0sXG4gICAgZW1wdHk6IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuaGVhZC5saW5lID09IHRoaXMuYW5jaG9yLmxpbmUgJiYgdGhpcy5oZWFkLmNoID09IHRoaXMuYW5jaG9yLmNoO1xuICAgIH1cbiAgfTtcblxuICAvLyBUYWtlIGFuIHVuc29ydGVkLCBwb3RlbnRpYWxseSBvdmVybGFwcGluZyBzZXQgb2YgcmFuZ2VzLCBhbmRcbiAgLy8gYnVpbGQgYSBzZWxlY3Rpb24gb3V0IG9mIGl0LiAnQ29uc3VtZXMnIHJhbmdlcyBhcnJheSAobW9kaWZ5aW5nXG4gIC8vIGl0KS5cbiAgZnVuY3Rpb24gbm9ybWFsaXplU2VsZWN0aW9uKHJhbmdlcywgcHJpbUluZGV4KSB7XG4gICAgdmFyIHByaW0gPSByYW5nZXNbcHJpbUluZGV4XTtcbiAgICByYW5nZXMuc29ydChmdW5jdGlvbihhLCBiKSB7IHJldHVybiBjbXAoYS5mcm9tKCksIGIuZnJvbSgpKTsgfSk7XG4gICAgcHJpbUluZGV4ID0gaW5kZXhPZihyYW5nZXMsIHByaW0pO1xuICAgIGZvciAodmFyIGkgPSAxOyBpIDwgcmFuZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgY3VyID0gcmFuZ2VzW2ldLCBwcmV2ID0gcmFuZ2VzW2kgLSAxXTtcbiAgICAgIGlmIChjbXAocHJldi50bygpLCBjdXIuZnJvbSgpKSA+PSAwKSB7XG4gICAgICAgIHZhciBmcm9tID0gbWluUG9zKHByZXYuZnJvbSgpLCBjdXIuZnJvbSgpKSwgdG8gPSBtYXhQb3MocHJldi50bygpLCBjdXIudG8oKSk7XG4gICAgICAgIHZhciBpbnYgPSBwcmV2LmVtcHR5KCkgPyBjdXIuZnJvbSgpID09IGN1ci5oZWFkIDogcHJldi5mcm9tKCkgPT0gcHJldi5oZWFkO1xuICAgICAgICBpZiAoaSA8PSBwcmltSW5kZXgpIC0tcHJpbUluZGV4O1xuICAgICAgICByYW5nZXMuc3BsaWNlKC0taSwgMiwgbmV3IFJhbmdlKGludiA/IHRvIDogZnJvbSwgaW52ID8gZnJvbSA6IHRvKSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXcgU2VsZWN0aW9uKHJhbmdlcywgcHJpbUluZGV4KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNpbXBsZVNlbGVjdGlvbihhbmNob3IsIGhlYWQpIHtcbiAgICByZXR1cm4gbmV3IFNlbGVjdGlvbihbbmV3IFJhbmdlKGFuY2hvciwgaGVhZCB8fCBhbmNob3IpXSwgMCk7XG4gIH1cblxuICAvLyBNb3N0IG9mIHRoZSBleHRlcm5hbCBBUEkgY2xpcHMgZ2l2ZW4gcG9zaXRpb25zIHRvIG1ha2Ugc3VyZSB0aGV5XG4gIC8vIGFjdHVhbGx5IGV4aXN0IHdpdGhpbiB0aGUgZG9jdW1lbnQuXG4gIGZ1bmN0aW9uIGNsaXBMaW5lKGRvYywgbikge3JldHVybiBNYXRoLm1heChkb2MuZmlyc3QsIE1hdGgubWluKG4sIGRvYy5maXJzdCArIGRvYy5zaXplIC0gMSkpO31cbiAgZnVuY3Rpb24gY2xpcFBvcyhkb2MsIHBvcykge1xuICAgIGlmIChwb3MubGluZSA8IGRvYy5maXJzdCkgcmV0dXJuIFBvcyhkb2MuZmlyc3QsIDApO1xuICAgIHZhciBsYXN0ID0gZG9jLmZpcnN0ICsgZG9jLnNpemUgLSAxO1xuICAgIGlmIChwb3MubGluZSA+IGxhc3QpIHJldHVybiBQb3MobGFzdCwgZ2V0TGluZShkb2MsIGxhc3QpLnRleHQubGVuZ3RoKTtcbiAgICByZXR1cm4gY2xpcFRvTGVuKHBvcywgZ2V0TGluZShkb2MsIHBvcy5saW5lKS50ZXh0Lmxlbmd0aCk7XG4gIH1cbiAgZnVuY3Rpb24gY2xpcFRvTGVuKHBvcywgbGluZWxlbikge1xuICAgIHZhciBjaCA9IHBvcy5jaDtcbiAgICBpZiAoY2ggPT0gbnVsbCB8fCBjaCA+IGxpbmVsZW4pIHJldHVybiBQb3MocG9zLmxpbmUsIGxpbmVsZW4pO1xuICAgIGVsc2UgaWYgKGNoIDwgMCkgcmV0dXJuIFBvcyhwb3MubGluZSwgMCk7XG4gICAgZWxzZSByZXR1cm4gcG9zO1xuICB9XG4gIGZ1bmN0aW9uIGlzTGluZShkb2MsIGwpIHtyZXR1cm4gbCA+PSBkb2MuZmlyc3QgJiYgbCA8IGRvYy5maXJzdCArIGRvYy5zaXplO31cbiAgZnVuY3Rpb24gY2xpcFBvc0FycmF5KGRvYywgYXJyYXkpIHtcbiAgICBmb3IgKHZhciBvdXQgPSBbXSwgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykgb3V0W2ldID0gY2xpcFBvcyhkb2MsIGFycmF5W2ldKTtcbiAgICByZXR1cm4gb3V0O1xuICB9XG5cbiAgLy8gU0VMRUNUSU9OIFVQREFURVNcblxuICAvLyBUaGUgJ3Njcm9sbCcgcGFyYW1ldGVyIGdpdmVuIHRvIG1hbnkgb2YgdGhlc2UgaW5kaWNhdGVkIHdoZXRoZXJcbiAgLy8gdGhlIG5ldyBjdXJzb3IgcG9zaXRpb24gc2hvdWxkIGJlIHNjcm9sbGVkIGludG8gdmlldyBhZnRlclxuICAvLyBtb2RpZnlpbmcgdGhlIHNlbGVjdGlvbi5cblxuICAvLyBJZiBzaGlmdCBpcyBoZWxkIG9yIHRoZSBleHRlbmQgZmxhZyBpcyBzZXQsIGV4dGVuZHMgYSByYW5nZSB0b1xuICAvLyBpbmNsdWRlIGEgZ2l2ZW4gcG9zaXRpb24gKGFuZCBvcHRpb25hbGx5IGEgc2Vjb25kIHBvc2l0aW9uKS5cbiAgLy8gT3RoZXJ3aXNlLCBzaW1wbHkgcmV0dXJucyB0aGUgcmFuZ2UgYmV0d2VlbiB0aGUgZ2l2ZW4gcG9zaXRpb25zLlxuICAvLyBVc2VkIGZvciBjdXJzb3IgbW90aW9uIGFuZCBzdWNoLlxuICBmdW5jdGlvbiBleHRlbmRSYW5nZShkb2MsIHJhbmdlLCBoZWFkLCBvdGhlcikge1xuICAgIGlmIChkb2MuY20gJiYgZG9jLmNtLmRpc3BsYXkuc2hpZnQgfHwgZG9jLmV4dGVuZCkge1xuICAgICAgdmFyIGFuY2hvciA9IHJhbmdlLmFuY2hvcjtcbiAgICAgIGlmIChvdGhlcikge1xuICAgICAgICB2YXIgcG9zQmVmb3JlID0gY21wKGhlYWQsIGFuY2hvcikgPCAwO1xuICAgICAgICBpZiAocG9zQmVmb3JlICE9IChjbXAob3RoZXIsIGFuY2hvcikgPCAwKSkge1xuICAgICAgICAgIGFuY2hvciA9IGhlYWQ7XG4gICAgICAgICAgaGVhZCA9IG90aGVyO1xuICAgICAgICB9IGVsc2UgaWYgKHBvc0JlZm9yZSAhPSAoY21wKGhlYWQsIG90aGVyKSA8IDApKSB7XG4gICAgICAgICAgaGVhZCA9IG90aGVyO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gbmV3IFJhbmdlKGFuY2hvciwgaGVhZCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBuZXcgUmFuZ2Uob3RoZXIgfHwgaGVhZCwgaGVhZCk7XG4gICAgfVxuICB9XG5cbiAgLy8gRXh0ZW5kIHRoZSBwcmltYXJ5IHNlbGVjdGlvbiByYW5nZSwgZGlzY2FyZCB0aGUgcmVzdC5cbiAgZnVuY3Rpb24gZXh0ZW5kU2VsZWN0aW9uKGRvYywgaGVhZCwgb3RoZXIsIG9wdGlvbnMpIHtcbiAgICBzZXRTZWxlY3Rpb24oZG9jLCBuZXcgU2VsZWN0aW9uKFtleHRlbmRSYW5nZShkb2MsIGRvYy5zZWwucHJpbWFyeSgpLCBoZWFkLCBvdGhlcildLCAwKSwgb3B0aW9ucyk7XG4gIH1cblxuICAvLyBFeHRlbmQgYWxsIHNlbGVjdGlvbnMgKHBvcyBpcyBhbiBhcnJheSBvZiBzZWxlY3Rpb25zIHdpdGggbGVuZ3RoXG4gIC8vIGVxdWFsIHRoZSBudW1iZXIgb2Ygc2VsZWN0aW9ucylcbiAgZnVuY3Rpb24gZXh0ZW5kU2VsZWN0aW9ucyhkb2MsIGhlYWRzLCBvcHRpb25zKSB7XG4gICAgZm9yICh2YXIgb3V0ID0gW10sIGkgPSAwOyBpIDwgZG9jLnNlbC5yYW5nZXMubGVuZ3RoOyBpKyspXG4gICAgICBvdXRbaV0gPSBleHRlbmRSYW5nZShkb2MsIGRvYy5zZWwucmFuZ2VzW2ldLCBoZWFkc1tpXSwgbnVsbCk7XG4gICAgdmFyIG5ld1NlbCA9IG5vcm1hbGl6ZVNlbGVjdGlvbihvdXQsIGRvYy5zZWwucHJpbUluZGV4KTtcbiAgICBzZXRTZWxlY3Rpb24oZG9jLCBuZXdTZWwsIG9wdGlvbnMpO1xuICB9XG5cbiAgLy8gVXBkYXRlcyBhIHNpbmdsZSByYW5nZSBpbiB0aGUgc2VsZWN0aW9uLlxuICBmdW5jdGlvbiByZXBsYWNlT25lU2VsZWN0aW9uKGRvYywgaSwgcmFuZ2UsIG9wdGlvbnMpIHtcbiAgICB2YXIgcmFuZ2VzID0gZG9jLnNlbC5yYW5nZXMuc2xpY2UoMCk7XG4gICAgcmFuZ2VzW2ldID0gcmFuZ2U7XG4gICAgc2V0U2VsZWN0aW9uKGRvYywgbm9ybWFsaXplU2VsZWN0aW9uKHJhbmdlcywgZG9jLnNlbC5wcmltSW5kZXgpLCBvcHRpb25zKTtcbiAgfVxuXG4gIC8vIFJlc2V0IHRoZSBzZWxlY3Rpb24gdG8gYSBzaW5nbGUgcmFuZ2UuXG4gIGZ1bmN0aW9uIHNldFNpbXBsZVNlbGVjdGlvbihkb2MsIGFuY2hvciwgaGVhZCwgb3B0aW9ucykge1xuICAgIHNldFNlbGVjdGlvbihkb2MsIHNpbXBsZVNlbGVjdGlvbihhbmNob3IsIGhlYWQpLCBvcHRpb25zKTtcbiAgfVxuXG4gIC8vIEdpdmUgYmVmb3JlU2VsZWN0aW9uQ2hhbmdlIGhhbmRsZXJzIGEgY2hhbmdlIHRvIGluZmx1ZW5jZSBhXG4gIC8vIHNlbGVjdGlvbiB1cGRhdGUuXG4gIGZ1bmN0aW9uIGZpbHRlclNlbGVjdGlvbkNoYW5nZShkb2MsIHNlbCkge1xuICAgIHZhciBvYmogPSB7XG4gICAgICByYW5nZXM6IHNlbC5yYW5nZXMsXG4gICAgICB1cGRhdGU6IGZ1bmN0aW9uKHJhbmdlcykge1xuICAgICAgICB0aGlzLnJhbmdlcyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhbmdlcy5sZW5ndGg7IGkrKylcbiAgICAgICAgICB0aGlzLnJhbmdlc1tpXSA9IG5ldyBSYW5nZShjbGlwUG9zKGRvYywgcmFuZ2VzW2ldLmFuY2hvciksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpcFBvcyhkb2MsIHJhbmdlc1tpXS5oZWFkKSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBzaWduYWwoZG9jLCBcImJlZm9yZVNlbGVjdGlvbkNoYW5nZVwiLCBkb2MsIG9iaik7XG4gICAgaWYgKGRvYy5jbSkgc2lnbmFsKGRvYy5jbSwgXCJiZWZvcmVTZWxlY3Rpb25DaGFuZ2VcIiwgZG9jLmNtLCBvYmopO1xuICAgIGlmIChvYmoucmFuZ2VzICE9IHNlbC5yYW5nZXMpIHJldHVybiBub3JtYWxpemVTZWxlY3Rpb24ob2JqLnJhbmdlcywgb2JqLnJhbmdlcy5sZW5ndGggLSAxKTtcbiAgICBlbHNlIHJldHVybiBzZWw7XG4gIH1cblxuICBmdW5jdGlvbiBzZXRTZWxlY3Rpb25SZXBsYWNlSGlzdG9yeShkb2MsIHNlbCwgb3B0aW9ucykge1xuICAgIHZhciBkb25lID0gZG9jLmhpc3RvcnkuZG9uZSwgbGFzdCA9IGxzdChkb25lKTtcbiAgICBpZiAobGFzdCAmJiBsYXN0LnJhbmdlcykge1xuICAgICAgZG9uZVtkb25lLmxlbmd0aCAtIDFdID0gc2VsO1xuICAgICAgc2V0U2VsZWN0aW9uTm9VbmRvKGRvYywgc2VsLCBvcHRpb25zKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2V0U2VsZWN0aW9uKGRvYywgc2VsLCBvcHRpb25zKTtcbiAgICB9XG4gIH1cblxuICAvLyBTZXQgYSBuZXcgc2VsZWN0aW9uLlxuICBmdW5jdGlvbiBzZXRTZWxlY3Rpb24oZG9jLCBzZWwsIG9wdGlvbnMpIHtcbiAgICBzZXRTZWxlY3Rpb25Ob1VuZG8oZG9jLCBzZWwsIG9wdGlvbnMpO1xuICAgIGFkZFNlbGVjdGlvblRvSGlzdG9yeShkb2MsIGRvYy5zZWwsIGRvYy5jbSA/IGRvYy5jbS5jdXJPcC5pZCA6IE5hTiwgb3B0aW9ucyk7XG4gIH1cblxuICBmdW5jdGlvbiBzZXRTZWxlY3Rpb25Ob1VuZG8oZG9jLCBzZWwsIG9wdGlvbnMpIHtcbiAgICBpZiAoaGFzSGFuZGxlcihkb2MsIFwiYmVmb3JlU2VsZWN0aW9uQ2hhbmdlXCIpIHx8IGRvYy5jbSAmJiBoYXNIYW5kbGVyKGRvYy5jbSwgXCJiZWZvcmVTZWxlY3Rpb25DaGFuZ2VcIikpXG4gICAgICBzZWwgPSBmaWx0ZXJTZWxlY3Rpb25DaGFuZ2UoZG9jLCBzZWwpO1xuXG4gICAgdmFyIGJpYXMgPSBvcHRpb25zICYmIG9wdGlvbnMuYmlhcyB8fFxuICAgICAgKGNtcChzZWwucHJpbWFyeSgpLmhlYWQsIGRvYy5zZWwucHJpbWFyeSgpLmhlYWQpIDwgMCA/IC0xIDogMSk7XG4gICAgc2V0U2VsZWN0aW9uSW5uZXIoZG9jLCBza2lwQXRvbWljSW5TZWxlY3Rpb24oZG9jLCBzZWwsIGJpYXMsIHRydWUpKTtcblxuICAgIGlmICghKG9wdGlvbnMgJiYgb3B0aW9ucy5zY3JvbGwgPT09IGZhbHNlKSAmJiBkb2MuY20pXG4gICAgICBlbnN1cmVDdXJzb3JWaXNpYmxlKGRvYy5jbSk7XG4gIH1cblxuICBmdW5jdGlvbiBzZXRTZWxlY3Rpb25Jbm5lcihkb2MsIHNlbCkge1xuICAgIGlmIChzZWwuZXF1YWxzKGRvYy5zZWwpKSByZXR1cm47XG5cbiAgICBkb2Muc2VsID0gc2VsO1xuXG4gICAgaWYgKGRvYy5jbSkge1xuICAgICAgZG9jLmNtLmN1ck9wLnVwZGF0ZUlucHV0ID0gZG9jLmNtLmN1ck9wLnNlbGVjdGlvbkNoYW5nZWQgPSB0cnVlO1xuICAgICAgc2lnbmFsQ3Vyc29yQWN0aXZpdHkoZG9jLmNtKTtcbiAgICB9XG4gICAgc2lnbmFsTGF0ZXIoZG9jLCBcImN1cnNvckFjdGl2aXR5XCIsIGRvYyk7XG4gIH1cblxuICAvLyBWZXJpZnkgdGhhdCB0aGUgc2VsZWN0aW9uIGRvZXMgbm90IHBhcnRpYWxseSBzZWxlY3QgYW55IGF0b21pY1xuICAvLyBtYXJrZWQgcmFuZ2VzLlxuICBmdW5jdGlvbiByZUNoZWNrU2VsZWN0aW9uKGRvYykge1xuICAgIHNldFNlbGVjdGlvbklubmVyKGRvYywgc2tpcEF0b21pY0luU2VsZWN0aW9uKGRvYywgZG9jLnNlbCwgbnVsbCwgZmFsc2UpLCBzZWxfZG9udFNjcm9sbCk7XG4gIH1cblxuICAvLyBSZXR1cm4gYSBzZWxlY3Rpb24gdGhhdCBkb2VzIG5vdCBwYXJ0aWFsbHkgc2VsZWN0IGFueSBhdG9taWNcbiAgLy8gcmFuZ2VzLlxuICBmdW5jdGlvbiBza2lwQXRvbWljSW5TZWxlY3Rpb24oZG9jLCBzZWwsIGJpYXMsIG1heUNsZWFyKSB7XG4gICAgdmFyIG91dDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbC5yYW5nZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciByYW5nZSA9IHNlbC5yYW5nZXNbaV07XG4gICAgICB2YXIgbmV3QW5jaG9yID0gc2tpcEF0b21pYyhkb2MsIHJhbmdlLmFuY2hvciwgYmlhcywgbWF5Q2xlYXIpO1xuICAgICAgdmFyIG5ld0hlYWQgPSBza2lwQXRvbWljKGRvYywgcmFuZ2UuaGVhZCwgYmlhcywgbWF5Q2xlYXIpO1xuICAgICAgaWYgKG91dCB8fCBuZXdBbmNob3IgIT0gcmFuZ2UuYW5jaG9yIHx8IG5ld0hlYWQgIT0gcmFuZ2UuaGVhZCkge1xuICAgICAgICBpZiAoIW91dCkgb3V0ID0gc2VsLnJhbmdlcy5zbGljZSgwLCBpKTtcbiAgICAgICAgb3V0W2ldID0gbmV3IFJhbmdlKG5ld0FuY2hvciwgbmV3SGVhZCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBvdXQgPyBub3JtYWxpemVTZWxlY3Rpb24ob3V0LCBzZWwucHJpbUluZGV4KSA6IHNlbDtcbiAgfVxuXG4gIC8vIEVuc3VyZSBhIGdpdmVuIHBvc2l0aW9uIGlzIG5vdCBpbnNpZGUgYW4gYXRvbWljIHJhbmdlLlxuICBmdW5jdGlvbiBza2lwQXRvbWljKGRvYywgcG9zLCBiaWFzLCBtYXlDbGVhcikge1xuICAgIHZhciBmbGlwcGVkID0gZmFsc2UsIGN1clBvcyA9IHBvcztcbiAgICB2YXIgZGlyID0gYmlhcyB8fCAxO1xuICAgIGRvYy5jYW50RWRpdCA9IGZhbHNlO1xuICAgIHNlYXJjaDogZm9yICg7Oykge1xuICAgICAgdmFyIGxpbmUgPSBnZXRMaW5lKGRvYywgY3VyUG9zLmxpbmUpO1xuICAgICAgaWYgKGxpbmUubWFya2VkU3BhbnMpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lLm1hcmtlZFNwYW5zLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgdmFyIHNwID0gbGluZS5tYXJrZWRTcGFuc1tpXSwgbSA9IHNwLm1hcmtlcjtcbiAgICAgICAgICBpZiAoKHNwLmZyb20gPT0gbnVsbCB8fCAobS5pbmNsdXNpdmVMZWZ0ID8gc3AuZnJvbSA8PSBjdXJQb3MuY2ggOiBzcC5mcm9tIDwgY3VyUG9zLmNoKSkgJiZcbiAgICAgICAgICAgICAgKHNwLnRvID09IG51bGwgfHwgKG0uaW5jbHVzaXZlUmlnaHQgPyBzcC50byA+PSBjdXJQb3MuY2ggOiBzcC50byA+IGN1clBvcy5jaCkpKSB7XG4gICAgICAgICAgICBpZiAobWF5Q2xlYXIpIHtcbiAgICAgICAgICAgICAgc2lnbmFsKG0sIFwiYmVmb3JlQ3Vyc29yRW50ZXJcIik7XG4gICAgICAgICAgICAgIGlmIChtLmV4cGxpY2l0bHlDbGVhcmVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFsaW5lLm1hcmtlZFNwYW5zKSBicmVhaztcbiAgICAgICAgICAgICAgICBlbHNlIHstLWk7IGNvbnRpbnVlO31cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFtLmF0b21pYykgY29udGludWU7XG4gICAgICAgICAgICB2YXIgbmV3UG9zID0gbS5maW5kKGRpciA8IDAgPyAtMSA6IDEpO1xuICAgICAgICAgICAgaWYgKGNtcChuZXdQb3MsIGN1clBvcykgPT0gMCkge1xuICAgICAgICAgICAgICBuZXdQb3MuY2ggKz0gZGlyO1xuICAgICAgICAgICAgICBpZiAobmV3UG9zLmNoIDwgMCkge1xuICAgICAgICAgICAgICAgIGlmIChuZXdQb3MubGluZSA+IGRvYy5maXJzdCkgbmV3UG9zID0gY2xpcFBvcyhkb2MsIFBvcyhuZXdQb3MubGluZSAtIDEpKTtcbiAgICAgICAgICAgICAgICBlbHNlIG5ld1BvcyA9IG51bGw7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZiAobmV3UG9zLmNoID4gbGluZS50ZXh0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGlmIChuZXdQb3MubGluZSA8IGRvYy5maXJzdCArIGRvYy5zaXplIC0gMSkgbmV3UG9zID0gUG9zKG5ld1Bvcy5saW5lICsgMSwgMCk7XG4gICAgICAgICAgICAgICAgZWxzZSBuZXdQb3MgPSBudWxsO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmICghbmV3UG9zKSB7XG4gICAgICAgICAgICAgICAgaWYgKGZsaXBwZWQpIHtcbiAgICAgICAgICAgICAgICAgIC8vIERyaXZlbiBpbiBhIGNvcm5lciAtLSBubyB2YWxpZCBjdXJzb3IgcG9zaXRpb24gZm91bmQgYXQgYWxsXG4gICAgICAgICAgICAgICAgICAvLyAtLSB0cnkgYWdhaW4gKndpdGgqIGNsZWFyaW5nLCBpZiB3ZSBkaWRuJ3QgYWxyZWFkeVxuICAgICAgICAgICAgICAgICAgaWYgKCFtYXlDbGVhcikgcmV0dXJuIHNraXBBdG9taWMoZG9jLCBwb3MsIGJpYXMsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlLCB0dXJuIG9mZiBlZGl0aW5nIHVudGlsIGZ1cnRoZXIgbm90aWNlLCBhbmQgcmV0dXJuIHRoZSBzdGFydCBvZiB0aGUgZG9jXG4gICAgICAgICAgICAgICAgICBkb2MuY2FudEVkaXQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIFBvcyhkb2MuZmlyc3QsIDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmbGlwcGVkID0gdHJ1ZTsgbmV3UG9zID0gcG9zOyBkaXIgPSAtZGlyO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjdXJQb3MgPSBuZXdQb3M7XG4gICAgICAgICAgICBjb250aW51ZSBzZWFyY2g7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gY3VyUG9zO1xuICAgIH1cbiAgfVxuXG4gIC8vIFNFTEVDVElPTiBEUkFXSU5HXG5cbiAgZnVuY3Rpb24gdXBkYXRlU2VsZWN0aW9uKGNtKSB7XG4gICAgY20uZGlzcGxheS5pbnB1dC5zaG93U2VsZWN0aW9uKGNtLmRpc3BsYXkuaW5wdXQucHJlcGFyZVNlbGVjdGlvbigpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHByZXBhcmVTZWxlY3Rpb24oY20sIHByaW1hcnkpIHtcbiAgICB2YXIgZG9jID0gY20uZG9jLCByZXN1bHQgPSB7fTtcbiAgICB2YXIgY3VyRnJhZ21lbnQgPSByZXN1bHQuY3Vyc29ycyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICB2YXIgc2VsRnJhZ21lbnQgPSByZXN1bHQuc2VsZWN0aW9uID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkb2Muc2VsLnJhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgaWYgKHByaW1hcnkgPT09IGZhbHNlICYmIGkgPT0gZG9jLnNlbC5wcmltSW5kZXgpIGNvbnRpbnVlO1xuICAgICAgdmFyIHJhbmdlID0gZG9jLnNlbC5yYW5nZXNbaV07XG4gICAgICB2YXIgY29sbGFwc2VkID0gcmFuZ2UuZW1wdHkoKTtcbiAgICAgIGlmIChjb2xsYXBzZWQgfHwgY20ub3B0aW9ucy5zaG93Q3Vyc29yV2hlblNlbGVjdGluZylcbiAgICAgICAgZHJhd1NlbGVjdGlvbkN1cnNvcihjbSwgcmFuZ2UuaGVhZCwgY3VyRnJhZ21lbnQpO1xuICAgICAgaWYgKCFjb2xsYXBzZWQpXG4gICAgICAgIGRyYXdTZWxlY3Rpb25SYW5nZShjbSwgcmFuZ2UsIHNlbEZyYWdtZW50KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8vIERyYXdzIGEgY3Vyc29yIGZvciB0aGUgZ2l2ZW4gcmFuZ2VcbiAgZnVuY3Rpb24gZHJhd1NlbGVjdGlvbkN1cnNvcihjbSwgaGVhZCwgb3V0cHV0KSB7XG4gICAgdmFyIHBvcyA9IGN1cnNvckNvb3JkcyhjbSwgaGVhZCwgXCJkaXZcIiwgbnVsbCwgbnVsbCwgIWNtLm9wdGlvbnMuc2luZ2xlQ3Vyc29ySGVpZ2h0UGVyTGluZSk7XG5cbiAgICB2YXIgY3Vyc29yID0gb3V0cHV0LmFwcGVuZENoaWxkKGVsdChcImRpdlwiLCBcIlxcdTAwYTBcIiwgXCJDb2RlTWlycm9yLWN1cnNvclwiKSk7XG4gICAgY3Vyc29yLnN0eWxlLmxlZnQgPSBwb3MubGVmdCArIFwicHhcIjtcbiAgICBjdXJzb3Iuc3R5bGUudG9wID0gcG9zLnRvcCArIFwicHhcIjtcbiAgICBjdXJzb3Iuc3R5bGUuaGVpZ2h0ID0gTWF0aC5tYXgoMCwgcG9zLmJvdHRvbSAtIHBvcy50b3ApICogY20ub3B0aW9ucy5jdXJzb3JIZWlnaHQgKyBcInB4XCI7XG5cbiAgICBpZiAocG9zLm90aGVyKSB7XG4gICAgICAvLyBTZWNvbmRhcnkgY3Vyc29yLCBzaG93biB3aGVuIG9uIGEgJ2p1bXAnIGluIGJpLWRpcmVjdGlvbmFsIHRleHRcbiAgICAgIHZhciBvdGhlckN1cnNvciA9IG91dHB1dC5hcHBlbmRDaGlsZChlbHQoXCJkaXZcIiwgXCJcXHUwMGEwXCIsIFwiQ29kZU1pcnJvci1jdXJzb3IgQ29kZU1pcnJvci1zZWNvbmRhcnljdXJzb3JcIikpO1xuICAgICAgb3RoZXJDdXJzb3Iuc3R5bGUuZGlzcGxheSA9IFwiXCI7XG4gICAgICBvdGhlckN1cnNvci5zdHlsZS5sZWZ0ID0gcG9zLm90aGVyLmxlZnQgKyBcInB4XCI7XG4gICAgICBvdGhlckN1cnNvci5zdHlsZS50b3AgPSBwb3Mub3RoZXIudG9wICsgXCJweFwiO1xuICAgICAgb3RoZXJDdXJzb3Iuc3R5bGUuaGVpZ2h0ID0gKHBvcy5vdGhlci5ib3R0b20gLSBwb3Mub3RoZXIudG9wKSAqIC44NSArIFwicHhcIjtcbiAgICB9XG4gIH1cblxuICAvLyBEcmF3cyB0aGUgZ2l2ZW4gcmFuZ2UgYXMgYSBoaWdobGlnaHRlZCBzZWxlY3Rpb25cbiAgZnVuY3Rpb24gZHJhd1NlbGVjdGlvblJhbmdlKGNtLCByYW5nZSwgb3V0cHV0KSB7XG4gICAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCBkb2MgPSBjbS5kb2M7XG4gICAgdmFyIGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpO1xuICAgIHZhciBwYWRkaW5nID0gcGFkZGluZ0goY20uZGlzcGxheSksIGxlZnRTaWRlID0gcGFkZGluZy5sZWZ0O1xuICAgIHZhciByaWdodFNpZGUgPSBNYXRoLm1heChkaXNwbGF5LnNpemVyV2lkdGgsIGRpc3BsYXlXaWR0aChjbSkgLSBkaXNwbGF5LnNpemVyLm9mZnNldExlZnQpIC0gcGFkZGluZy5yaWdodDtcblxuICAgIGZ1bmN0aW9uIGFkZChsZWZ0LCB0b3AsIHdpZHRoLCBib3R0b20pIHtcbiAgICAgIGlmICh0b3AgPCAwKSB0b3AgPSAwO1xuICAgICAgdG9wID0gTWF0aC5yb3VuZCh0b3ApO1xuICAgICAgYm90dG9tID0gTWF0aC5yb3VuZChib3R0b20pO1xuICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoZWx0KFwiZGl2XCIsIG51bGwsIFwiQ29kZU1pcnJvci1zZWxlY3RlZFwiLCBcInBvc2l0aW9uOiBhYnNvbHV0ZTsgbGVmdDogXCIgKyBsZWZ0ICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInB4OyB0b3A6IFwiICsgdG9wICsgXCJweDsgd2lkdGg6IFwiICsgKHdpZHRoID09IG51bGwgPyByaWdodFNpZGUgLSBsZWZ0IDogd2lkdGgpICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInB4OyBoZWlnaHQ6IFwiICsgKGJvdHRvbSAtIHRvcCkgKyBcInB4XCIpKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBkcmF3Rm9yTGluZShsaW5lLCBmcm9tQXJnLCB0b0FyZykge1xuICAgICAgdmFyIGxpbmVPYmogPSBnZXRMaW5lKGRvYywgbGluZSk7XG4gICAgICB2YXIgbGluZUxlbiA9IGxpbmVPYmoudGV4dC5sZW5ndGg7XG4gICAgICB2YXIgc3RhcnQsIGVuZDtcbiAgICAgIGZ1bmN0aW9uIGNvb3JkcyhjaCwgYmlhcykge1xuICAgICAgICByZXR1cm4gY2hhckNvb3JkcyhjbSwgUG9zKGxpbmUsIGNoKSwgXCJkaXZcIiwgbGluZU9iaiwgYmlhcyk7XG4gICAgICB9XG5cbiAgICAgIGl0ZXJhdGVCaWRpU2VjdGlvbnMoZ2V0T3JkZXIobGluZU9iaiksIGZyb21BcmcgfHwgMCwgdG9BcmcgPT0gbnVsbCA/IGxpbmVMZW4gOiB0b0FyZywgZnVuY3Rpb24oZnJvbSwgdG8sIGRpcikge1xuICAgICAgICB2YXIgbGVmdFBvcyA9IGNvb3Jkcyhmcm9tLCBcImxlZnRcIiksIHJpZ2h0UG9zLCBsZWZ0LCByaWdodDtcbiAgICAgICAgaWYgKGZyb20gPT0gdG8pIHtcbiAgICAgICAgICByaWdodFBvcyA9IGxlZnRQb3M7XG4gICAgICAgICAgbGVmdCA9IHJpZ2h0ID0gbGVmdFBvcy5sZWZ0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJpZ2h0UG9zID0gY29vcmRzKHRvIC0gMSwgXCJyaWdodFwiKTtcbiAgICAgICAgICBpZiAoZGlyID09IFwicnRsXCIpIHsgdmFyIHRtcCA9IGxlZnRQb3M7IGxlZnRQb3MgPSByaWdodFBvczsgcmlnaHRQb3MgPSB0bXA7IH1cbiAgICAgICAgICBsZWZ0ID0gbGVmdFBvcy5sZWZ0O1xuICAgICAgICAgIHJpZ2h0ID0gcmlnaHRQb3MucmlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZyb21BcmcgPT0gbnVsbCAmJiBmcm9tID09IDApIGxlZnQgPSBsZWZ0U2lkZTtcbiAgICAgICAgaWYgKHJpZ2h0UG9zLnRvcCAtIGxlZnRQb3MudG9wID4gMykgeyAvLyBEaWZmZXJlbnQgbGluZXMsIGRyYXcgdG9wIHBhcnRcbiAgICAgICAgICBhZGQobGVmdCwgbGVmdFBvcy50b3AsIG51bGwsIGxlZnRQb3MuYm90dG9tKTtcbiAgICAgICAgICBsZWZ0ID0gbGVmdFNpZGU7XG4gICAgICAgICAgaWYgKGxlZnRQb3MuYm90dG9tIDwgcmlnaHRQb3MudG9wKSBhZGQobGVmdCwgbGVmdFBvcy5ib3R0b20sIG51bGwsIHJpZ2h0UG9zLnRvcCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRvQXJnID09IG51bGwgJiYgdG8gPT0gbGluZUxlbikgcmlnaHQgPSByaWdodFNpZGU7XG4gICAgICAgIGlmICghc3RhcnQgfHwgbGVmdFBvcy50b3AgPCBzdGFydC50b3AgfHwgbGVmdFBvcy50b3AgPT0gc3RhcnQudG9wICYmIGxlZnRQb3MubGVmdCA8IHN0YXJ0LmxlZnQpXG4gICAgICAgICAgc3RhcnQgPSBsZWZ0UG9zO1xuICAgICAgICBpZiAoIWVuZCB8fCByaWdodFBvcy5ib3R0b20gPiBlbmQuYm90dG9tIHx8IHJpZ2h0UG9zLmJvdHRvbSA9PSBlbmQuYm90dG9tICYmIHJpZ2h0UG9zLnJpZ2h0ID4gZW5kLnJpZ2h0KVxuICAgICAgICAgIGVuZCA9IHJpZ2h0UG9zO1xuICAgICAgICBpZiAobGVmdCA8IGxlZnRTaWRlICsgMSkgbGVmdCA9IGxlZnRTaWRlO1xuICAgICAgICBhZGQobGVmdCwgcmlnaHRQb3MudG9wLCByaWdodCAtIGxlZnQsIHJpZ2h0UG9zLmJvdHRvbSk7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiB7c3RhcnQ6IHN0YXJ0LCBlbmQ6IGVuZH07XG4gICAgfVxuXG4gICAgdmFyIHNGcm9tID0gcmFuZ2UuZnJvbSgpLCBzVG8gPSByYW5nZS50bygpO1xuICAgIGlmIChzRnJvbS5saW5lID09IHNUby5saW5lKSB7XG4gICAgICBkcmF3Rm9yTGluZShzRnJvbS5saW5lLCBzRnJvbS5jaCwgc1RvLmNoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGZyb21MaW5lID0gZ2V0TGluZShkb2MsIHNGcm9tLmxpbmUpLCB0b0xpbmUgPSBnZXRMaW5lKGRvYywgc1RvLmxpbmUpO1xuICAgICAgdmFyIHNpbmdsZVZMaW5lID0gdmlzdWFsTGluZShmcm9tTGluZSkgPT0gdmlzdWFsTGluZSh0b0xpbmUpO1xuICAgICAgdmFyIGxlZnRFbmQgPSBkcmF3Rm9yTGluZShzRnJvbS5saW5lLCBzRnJvbS5jaCwgc2luZ2xlVkxpbmUgPyBmcm9tTGluZS50ZXh0Lmxlbmd0aCArIDEgOiBudWxsKS5lbmQ7XG4gICAgICB2YXIgcmlnaHRTdGFydCA9IGRyYXdGb3JMaW5lKHNUby5saW5lLCBzaW5nbGVWTGluZSA/IDAgOiBudWxsLCBzVG8uY2gpLnN0YXJ0O1xuICAgICAgaWYgKHNpbmdsZVZMaW5lKSB7XG4gICAgICAgIGlmIChsZWZ0RW5kLnRvcCA8IHJpZ2h0U3RhcnQudG9wIC0gMikge1xuICAgICAgICAgIGFkZChsZWZ0RW5kLnJpZ2h0LCBsZWZ0RW5kLnRvcCwgbnVsbCwgbGVmdEVuZC5ib3R0b20pO1xuICAgICAgICAgIGFkZChsZWZ0U2lkZSwgcmlnaHRTdGFydC50b3AsIHJpZ2h0U3RhcnQubGVmdCwgcmlnaHRTdGFydC5ib3R0b20pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFkZChsZWZ0RW5kLnJpZ2h0LCBsZWZ0RW5kLnRvcCwgcmlnaHRTdGFydC5sZWZ0IC0gbGVmdEVuZC5yaWdodCwgbGVmdEVuZC5ib3R0b20pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAobGVmdEVuZC5ib3R0b20gPCByaWdodFN0YXJ0LnRvcClcbiAgICAgICAgYWRkKGxlZnRTaWRlLCBsZWZ0RW5kLmJvdHRvbSwgbnVsbCwgcmlnaHRTdGFydC50b3ApO1xuICAgIH1cblxuICAgIG91dHB1dC5hcHBlbmRDaGlsZChmcmFnbWVudCk7XG4gIH1cblxuICAvLyBDdXJzb3ItYmxpbmtpbmdcbiAgZnVuY3Rpb24gcmVzdGFydEJsaW5rKGNtKSB7XG4gICAgaWYgKCFjbS5zdGF0ZS5mb2N1c2VkKSByZXR1cm47XG4gICAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5O1xuICAgIGNsZWFySW50ZXJ2YWwoZGlzcGxheS5ibGlua2VyKTtcbiAgICB2YXIgb24gPSB0cnVlO1xuICAgIGRpc3BsYXkuY3Vyc29yRGl2LnN0eWxlLnZpc2liaWxpdHkgPSBcIlwiO1xuICAgIGlmIChjbS5vcHRpb25zLmN1cnNvckJsaW5rUmF0ZSA+IDApXG4gICAgICBkaXNwbGF5LmJsaW5rZXIgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgZGlzcGxheS5jdXJzb3JEaXYuc3R5bGUudmlzaWJpbGl0eSA9IChvbiA9ICFvbikgPyBcIlwiIDogXCJoaWRkZW5cIjtcbiAgICAgIH0sIGNtLm9wdGlvbnMuY3Vyc29yQmxpbmtSYXRlKTtcbiAgICBlbHNlIGlmIChjbS5vcHRpb25zLmN1cnNvckJsaW5rUmF0ZSA8IDApXG4gICAgICBkaXNwbGF5LmN1cnNvckRpdi5zdHlsZS52aXNpYmlsaXR5ID0gXCJoaWRkZW5cIjtcbiAgfVxuXG4gIC8vIEhJR0hMSUdIVCBXT1JLRVJcblxuICBmdW5jdGlvbiBzdGFydFdvcmtlcihjbSwgdGltZSkge1xuICAgIGlmIChjbS5kb2MubW9kZS5zdGFydFN0YXRlICYmIGNtLmRvYy5mcm9udGllciA8IGNtLmRpc3BsYXkudmlld1RvKVxuICAgICAgY20uc3RhdGUuaGlnaGxpZ2h0LnNldCh0aW1lLCBiaW5kKGhpZ2hsaWdodFdvcmtlciwgY20pKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGhpZ2hsaWdodFdvcmtlcihjbSkge1xuICAgIHZhciBkb2MgPSBjbS5kb2M7XG4gICAgaWYgKGRvYy5mcm9udGllciA8IGRvYy5maXJzdCkgZG9jLmZyb250aWVyID0gZG9jLmZpcnN0O1xuICAgIGlmIChkb2MuZnJvbnRpZXIgPj0gY20uZGlzcGxheS52aWV3VG8pIHJldHVybjtcbiAgICB2YXIgZW5kID0gK25ldyBEYXRlICsgY20ub3B0aW9ucy53b3JrVGltZTtcbiAgICB2YXIgc3RhdGUgPSBjb3B5U3RhdGUoZG9jLm1vZGUsIGdldFN0YXRlQmVmb3JlKGNtLCBkb2MuZnJvbnRpZXIpKTtcbiAgICB2YXIgY2hhbmdlZExpbmVzID0gW107XG5cbiAgICBkb2MuaXRlcihkb2MuZnJvbnRpZXIsIE1hdGgubWluKGRvYy5maXJzdCArIGRvYy5zaXplLCBjbS5kaXNwbGF5LnZpZXdUbyArIDUwMCksIGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgIGlmIChkb2MuZnJvbnRpZXIgPj0gY20uZGlzcGxheS52aWV3RnJvbSkgeyAvLyBWaXNpYmxlXG4gICAgICAgIHZhciBvbGRTdHlsZXMgPSBsaW5lLnN0eWxlcywgdG9vTG9uZyA9IGxpbmUudGV4dC5sZW5ndGggPiBjbS5vcHRpb25zLm1heEhpZ2hsaWdodExlbmd0aDtcbiAgICAgICAgdmFyIGhpZ2hsaWdodGVkID0gaGlnaGxpZ2h0TGluZShjbSwgbGluZSwgdG9vTG9uZyA/IGNvcHlTdGF0ZShkb2MubW9kZSwgc3RhdGUpIDogc3RhdGUsIHRydWUpO1xuICAgICAgICBsaW5lLnN0eWxlcyA9IGhpZ2hsaWdodGVkLnN0eWxlcztcbiAgICAgICAgdmFyIG9sZENscyA9IGxpbmUuc3R5bGVDbGFzc2VzLCBuZXdDbHMgPSBoaWdobGlnaHRlZC5jbGFzc2VzO1xuICAgICAgICBpZiAobmV3Q2xzKSBsaW5lLnN0eWxlQ2xhc3NlcyA9IG5ld0NscztcbiAgICAgICAgZWxzZSBpZiAob2xkQ2xzKSBsaW5lLnN0eWxlQ2xhc3NlcyA9IG51bGw7XG4gICAgICAgIHZhciBpc2NoYW5nZSA9ICFvbGRTdHlsZXMgfHwgb2xkU3R5bGVzLmxlbmd0aCAhPSBsaW5lLnN0eWxlcy5sZW5ndGggfHxcbiAgICAgICAgICBvbGRDbHMgIT0gbmV3Q2xzICYmICghb2xkQ2xzIHx8ICFuZXdDbHMgfHwgb2xkQ2xzLmJnQ2xhc3MgIT0gbmV3Q2xzLmJnQ2xhc3MgfHwgb2xkQ2xzLnRleHRDbGFzcyAhPSBuZXdDbHMudGV4dENsYXNzKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7ICFpc2NoYW5nZSAmJiBpIDwgb2xkU3R5bGVzLmxlbmd0aDsgKytpKSBpc2NoYW5nZSA9IG9sZFN0eWxlc1tpXSAhPSBsaW5lLnN0eWxlc1tpXTtcbiAgICAgICAgaWYgKGlzY2hhbmdlKSBjaGFuZ2VkTGluZXMucHVzaChkb2MuZnJvbnRpZXIpO1xuICAgICAgICBsaW5lLnN0YXRlQWZ0ZXIgPSB0b29Mb25nID8gc3RhdGUgOiBjb3B5U3RhdGUoZG9jLm1vZGUsIHN0YXRlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChsaW5lLnRleHQubGVuZ3RoIDw9IGNtLm9wdGlvbnMubWF4SGlnaGxpZ2h0TGVuZ3RoKVxuICAgICAgICAgIHByb2Nlc3NMaW5lKGNtLCBsaW5lLnRleHQsIHN0YXRlKTtcbiAgICAgICAgbGluZS5zdGF0ZUFmdGVyID0gZG9jLmZyb250aWVyICUgNSA9PSAwID8gY29weVN0YXRlKGRvYy5tb2RlLCBzdGF0ZSkgOiBudWxsO1xuICAgICAgfVxuICAgICAgKytkb2MuZnJvbnRpZXI7XG4gICAgICBpZiAoK25ldyBEYXRlID4gZW5kKSB7XG4gICAgICAgIHN0YXJ0V29ya2VyKGNtLCBjbS5vcHRpb25zLndvcmtEZWxheSk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuICAgIGlmIChjaGFuZ2VkTGluZXMubGVuZ3RoKSBydW5Jbk9wKGNtLCBmdW5jdGlvbigpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhbmdlZExpbmVzLmxlbmd0aDsgaSsrKVxuICAgICAgICByZWdMaW5lQ2hhbmdlKGNtLCBjaGFuZ2VkTGluZXNbaV0sIFwidGV4dFwiKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIEZpbmRzIHRoZSBsaW5lIHRvIHN0YXJ0IHdpdGggd2hlbiBzdGFydGluZyBhIHBhcnNlLiBUcmllcyB0b1xuICAvLyBmaW5kIGEgbGluZSB3aXRoIGEgc3RhdGVBZnRlciwgc28gdGhhdCBpdCBjYW4gc3RhcnQgd2l0aCBhXG4gIC8vIHZhbGlkIHN0YXRlLiBJZiB0aGF0IGZhaWxzLCBpdCByZXR1cm5zIHRoZSBsaW5lIHdpdGggdGhlXG4gIC8vIHNtYWxsZXN0IGluZGVudGF0aW9uLCB3aGljaCB0ZW5kcyB0byBuZWVkIHRoZSBsZWFzdCBjb250ZXh0IHRvXG4gIC8vIHBhcnNlIGNvcnJlY3RseS5cbiAgZnVuY3Rpb24gZmluZFN0YXJ0TGluZShjbSwgbiwgcHJlY2lzZSkge1xuICAgIHZhciBtaW5pbmRlbnQsIG1pbmxpbmUsIGRvYyA9IGNtLmRvYztcbiAgICB2YXIgbGltID0gcHJlY2lzZSA/IC0xIDogbiAtIChjbS5kb2MubW9kZS5pbm5lck1vZGUgPyAxMDAwIDogMTAwKTtcbiAgICBmb3IgKHZhciBzZWFyY2ggPSBuOyBzZWFyY2ggPiBsaW07IC0tc2VhcmNoKSB7XG4gICAgICBpZiAoc2VhcmNoIDw9IGRvYy5maXJzdCkgcmV0dXJuIGRvYy5maXJzdDtcbiAgICAgIHZhciBsaW5lID0gZ2V0TGluZShkb2MsIHNlYXJjaCAtIDEpO1xuICAgICAgaWYgKGxpbmUuc3RhdGVBZnRlciAmJiAoIXByZWNpc2UgfHwgc2VhcmNoIDw9IGRvYy5mcm9udGllcikpIHJldHVybiBzZWFyY2g7XG4gICAgICB2YXIgaW5kZW50ZWQgPSBjb3VudENvbHVtbihsaW5lLnRleHQsIG51bGwsIGNtLm9wdGlvbnMudGFiU2l6ZSk7XG4gICAgICBpZiAobWlubGluZSA9PSBudWxsIHx8IG1pbmluZGVudCA+IGluZGVudGVkKSB7XG4gICAgICAgIG1pbmxpbmUgPSBzZWFyY2ggLSAxO1xuICAgICAgICBtaW5pbmRlbnQgPSBpbmRlbnRlZDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG1pbmxpbmU7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRTdGF0ZUJlZm9yZShjbSwgbiwgcHJlY2lzZSkge1xuICAgIHZhciBkb2MgPSBjbS5kb2MsIGRpc3BsYXkgPSBjbS5kaXNwbGF5O1xuICAgIGlmICghZG9jLm1vZGUuc3RhcnRTdGF0ZSkgcmV0dXJuIHRydWU7XG4gICAgdmFyIHBvcyA9IGZpbmRTdGFydExpbmUoY20sIG4sIHByZWNpc2UpLCBzdGF0ZSA9IHBvcyA+IGRvYy5maXJzdCAmJiBnZXRMaW5lKGRvYywgcG9zLTEpLnN0YXRlQWZ0ZXI7XG4gICAgaWYgKCFzdGF0ZSkgc3RhdGUgPSBzdGFydFN0YXRlKGRvYy5tb2RlKTtcbiAgICBlbHNlIHN0YXRlID0gY29weVN0YXRlKGRvYy5tb2RlLCBzdGF0ZSk7XG4gICAgZG9jLml0ZXIocG9zLCBuLCBmdW5jdGlvbihsaW5lKSB7XG4gICAgICBwcm9jZXNzTGluZShjbSwgbGluZS50ZXh0LCBzdGF0ZSk7XG4gICAgICB2YXIgc2F2ZSA9IHBvcyA9PSBuIC0gMSB8fCBwb3MgJSA1ID09IDAgfHwgcG9zID49IGRpc3BsYXkudmlld0Zyb20gJiYgcG9zIDwgZGlzcGxheS52aWV3VG87XG4gICAgICBsaW5lLnN0YXRlQWZ0ZXIgPSBzYXZlID8gY29weVN0YXRlKGRvYy5tb2RlLCBzdGF0ZSkgOiBudWxsO1xuICAgICAgKytwb3M7XG4gICAgfSk7XG4gICAgaWYgKHByZWNpc2UpIGRvYy5mcm9udGllciA9IHBvcztcbiAgICByZXR1cm4gc3RhdGU7XG4gIH1cblxuICAvLyBQT1NJVElPTiBNRUFTVVJFTUVOVFxuXG4gIGZ1bmN0aW9uIHBhZGRpbmdUb3AoZGlzcGxheSkge3JldHVybiBkaXNwbGF5LmxpbmVTcGFjZS5vZmZzZXRUb3A7fVxuICBmdW5jdGlvbiBwYWRkaW5nVmVydChkaXNwbGF5KSB7cmV0dXJuIGRpc3BsYXkubW92ZXIub2Zmc2V0SGVpZ2h0IC0gZGlzcGxheS5saW5lU3BhY2Uub2Zmc2V0SGVpZ2h0O31cbiAgZnVuY3Rpb24gcGFkZGluZ0goZGlzcGxheSkge1xuICAgIGlmIChkaXNwbGF5LmNhY2hlZFBhZGRpbmdIKSByZXR1cm4gZGlzcGxheS5jYWNoZWRQYWRkaW5nSDtcbiAgICB2YXIgZSA9IHJlbW92ZUNoaWxkcmVuQW5kQWRkKGRpc3BsYXkubWVhc3VyZSwgZWx0KFwicHJlXCIsIFwieFwiKSk7XG4gICAgdmFyIHN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUgPyB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlKSA6IGUuY3VycmVudFN0eWxlO1xuICAgIHZhciBkYXRhID0ge2xlZnQ6IHBhcnNlSW50KHN0eWxlLnBhZGRpbmdMZWZ0KSwgcmlnaHQ6IHBhcnNlSW50KHN0eWxlLnBhZGRpbmdSaWdodCl9O1xuICAgIGlmICghaXNOYU4oZGF0YS5sZWZ0KSAmJiAhaXNOYU4oZGF0YS5yaWdodCkpIGRpc3BsYXkuY2FjaGVkUGFkZGluZ0ggPSBkYXRhO1xuICAgIHJldHVybiBkYXRhO1xuICB9XG5cbiAgZnVuY3Rpb24gc2Nyb2xsR2FwKGNtKSB7IHJldHVybiBzY3JvbGxlckdhcCAtIGNtLmRpc3BsYXkubmF0aXZlQmFyV2lkdGg7IH1cbiAgZnVuY3Rpb24gZGlzcGxheVdpZHRoKGNtKSB7XG4gICAgcmV0dXJuIGNtLmRpc3BsYXkuc2Nyb2xsZXIuY2xpZW50V2lkdGggLSBzY3JvbGxHYXAoY20pIC0gY20uZGlzcGxheS5iYXJXaWR0aDtcbiAgfVxuICBmdW5jdGlvbiBkaXNwbGF5SGVpZ2h0KGNtKSB7XG4gICAgcmV0dXJuIGNtLmRpc3BsYXkuc2Nyb2xsZXIuY2xpZW50SGVpZ2h0IC0gc2Nyb2xsR2FwKGNtKSAtIGNtLmRpc3BsYXkuYmFySGVpZ2h0O1xuICB9XG5cbiAgLy8gRW5zdXJlIHRoZSBsaW5lVmlldy53cmFwcGluZy5oZWlnaHRzIGFycmF5IGlzIHBvcHVsYXRlZC4gVGhpcyBpc1xuICAvLyBhbiBhcnJheSBvZiBib3R0b20gb2Zmc2V0cyBmb3IgdGhlIGxpbmVzIHRoYXQgbWFrZSB1cCBhIGRyYXduXG4gIC8vIGxpbmUuIFdoZW4gbGluZVdyYXBwaW5nIGlzIG9uLCB0aGVyZSBtaWdodCBiZSBtb3JlIHRoYW4gb25lXG4gIC8vIGhlaWdodC5cbiAgZnVuY3Rpb24gZW5zdXJlTGluZUhlaWdodHMoY20sIGxpbmVWaWV3LCByZWN0KSB7XG4gICAgdmFyIHdyYXBwaW5nID0gY20ub3B0aW9ucy5saW5lV3JhcHBpbmc7XG4gICAgdmFyIGN1cldpZHRoID0gd3JhcHBpbmcgJiYgZGlzcGxheVdpZHRoKGNtKTtcbiAgICBpZiAoIWxpbmVWaWV3Lm1lYXN1cmUuaGVpZ2h0cyB8fCB3cmFwcGluZyAmJiBsaW5lVmlldy5tZWFzdXJlLndpZHRoICE9IGN1cldpZHRoKSB7XG4gICAgICB2YXIgaGVpZ2h0cyA9IGxpbmVWaWV3Lm1lYXN1cmUuaGVpZ2h0cyA9IFtdO1xuICAgICAgaWYgKHdyYXBwaW5nKSB7XG4gICAgICAgIGxpbmVWaWV3Lm1lYXN1cmUud2lkdGggPSBjdXJXaWR0aDtcbiAgICAgICAgdmFyIHJlY3RzID0gbGluZVZpZXcudGV4dC5maXJzdENoaWxkLmdldENsaWVudFJlY3RzKCk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVjdHMubGVuZ3RoIC0gMTsgaSsrKSB7XG4gICAgICAgICAgdmFyIGN1ciA9IHJlY3RzW2ldLCBuZXh0ID0gcmVjdHNbaSArIDFdO1xuICAgICAgICAgIGlmIChNYXRoLmFicyhjdXIuYm90dG9tIC0gbmV4dC5ib3R0b20pID4gMilcbiAgICAgICAgICAgIGhlaWdodHMucHVzaCgoY3VyLmJvdHRvbSArIG5leHQudG9wKSAvIDIgLSByZWN0LnRvcCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGhlaWdodHMucHVzaChyZWN0LmJvdHRvbSAtIHJlY3QudG9wKTtcbiAgICB9XG4gIH1cblxuICAvLyBGaW5kIGEgbGluZSBtYXAgKG1hcHBpbmcgY2hhcmFjdGVyIG9mZnNldHMgdG8gdGV4dCBub2RlcykgYW5kIGFcbiAgLy8gbWVhc3VyZW1lbnQgY2FjaGUgZm9yIHRoZSBnaXZlbiBsaW5lIG51bWJlci4gKEEgbGluZSB2aWV3IG1pZ2h0XG4gIC8vIGNvbnRhaW4gbXVsdGlwbGUgbGluZXMgd2hlbiBjb2xsYXBzZWQgcmFuZ2VzIGFyZSBwcmVzZW50LilcbiAgZnVuY3Rpb24gbWFwRnJvbUxpbmVWaWV3KGxpbmVWaWV3LCBsaW5lLCBsaW5lTikge1xuICAgIGlmIChsaW5lVmlldy5saW5lID09IGxpbmUpXG4gICAgICByZXR1cm4ge21hcDogbGluZVZpZXcubWVhc3VyZS5tYXAsIGNhY2hlOiBsaW5lVmlldy5tZWFzdXJlLmNhY2hlfTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmVWaWV3LnJlc3QubGVuZ3RoOyBpKyspXG4gICAgICBpZiAobGluZVZpZXcucmVzdFtpXSA9PSBsaW5lKVxuICAgICAgICByZXR1cm4ge21hcDogbGluZVZpZXcubWVhc3VyZS5tYXBzW2ldLCBjYWNoZTogbGluZVZpZXcubWVhc3VyZS5jYWNoZXNbaV19O1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZVZpZXcucmVzdC5sZW5ndGg7IGkrKylcbiAgICAgIGlmIChsaW5lTm8obGluZVZpZXcucmVzdFtpXSkgPiBsaW5lTilcbiAgICAgICAgcmV0dXJuIHttYXA6IGxpbmVWaWV3Lm1lYXN1cmUubWFwc1tpXSwgY2FjaGU6IGxpbmVWaWV3Lm1lYXN1cmUuY2FjaGVzW2ldLCBiZWZvcmU6IHRydWV9O1xuICB9XG5cbiAgLy8gUmVuZGVyIGEgbGluZSBpbnRvIHRoZSBoaWRkZW4gbm9kZSBkaXNwbGF5LmV4dGVybmFsTWVhc3VyZWQuIFVzZWRcbiAgLy8gd2hlbiBtZWFzdXJlbWVudCBpcyBuZWVkZWQgZm9yIGEgbGluZSB0aGF0J3Mgbm90IGluIHRoZSB2aWV3cG9ydC5cbiAgZnVuY3Rpb24gdXBkYXRlRXh0ZXJuYWxNZWFzdXJlbWVudChjbSwgbGluZSkge1xuICAgIGxpbmUgPSB2aXN1YWxMaW5lKGxpbmUpO1xuICAgIHZhciBsaW5lTiA9IGxpbmVObyhsaW5lKTtcbiAgICB2YXIgdmlldyA9IGNtLmRpc3BsYXkuZXh0ZXJuYWxNZWFzdXJlZCA9IG5ldyBMaW5lVmlldyhjbS5kb2MsIGxpbmUsIGxpbmVOKTtcbiAgICB2aWV3LmxpbmVOID0gbGluZU47XG4gICAgdmFyIGJ1aWx0ID0gdmlldy5idWlsdCA9IGJ1aWxkTGluZUNvbnRlbnQoY20sIHZpZXcpO1xuICAgIHZpZXcudGV4dCA9IGJ1aWx0LnByZTtcbiAgICByZW1vdmVDaGlsZHJlbkFuZEFkZChjbS5kaXNwbGF5LmxpbmVNZWFzdXJlLCBidWlsdC5wcmUpO1xuICAgIHJldHVybiB2aWV3O1xuICB9XG5cbiAgLy8gR2V0IGEge3RvcCwgYm90dG9tLCBsZWZ0LCByaWdodH0gYm94IChpbiBsaW5lLWxvY2FsIGNvb3JkaW5hdGVzKVxuICAvLyBmb3IgYSBnaXZlbiBjaGFyYWN0ZXIuXG4gIGZ1bmN0aW9uIG1lYXN1cmVDaGFyKGNtLCBsaW5lLCBjaCwgYmlhcykge1xuICAgIHJldHVybiBtZWFzdXJlQ2hhclByZXBhcmVkKGNtLCBwcmVwYXJlTWVhc3VyZUZvckxpbmUoY20sIGxpbmUpLCBjaCwgYmlhcyk7XG4gIH1cblxuICAvLyBGaW5kIGEgbGluZSB2aWV3IHRoYXQgY29ycmVzcG9uZHMgdG8gdGhlIGdpdmVuIGxpbmUgbnVtYmVyLlxuICBmdW5jdGlvbiBmaW5kVmlld0ZvckxpbmUoY20sIGxpbmVOKSB7XG4gICAgaWYgKGxpbmVOID49IGNtLmRpc3BsYXkudmlld0Zyb20gJiYgbGluZU4gPCBjbS5kaXNwbGF5LnZpZXdUbylcbiAgICAgIHJldHVybiBjbS5kaXNwbGF5LnZpZXdbZmluZFZpZXdJbmRleChjbSwgbGluZU4pXTtcbiAgICB2YXIgZXh0ID0gY20uZGlzcGxheS5leHRlcm5hbE1lYXN1cmVkO1xuICAgIGlmIChleHQgJiYgbGluZU4gPj0gZXh0LmxpbmVOICYmIGxpbmVOIDwgZXh0LmxpbmVOICsgZXh0LnNpemUpXG4gICAgICByZXR1cm4gZXh0O1xuICB9XG5cbiAgLy8gTWVhc3VyZW1lbnQgY2FuIGJlIHNwbGl0IGluIHR3byBzdGVwcywgdGhlIHNldC11cCB3b3JrIHRoYXRcbiAgLy8gYXBwbGllcyB0byB0aGUgd2hvbGUgbGluZSwgYW5kIHRoZSBtZWFzdXJlbWVudCBvZiB0aGUgYWN0dWFsXG4gIC8vIGNoYXJhY3Rlci4gRnVuY3Rpb25zIGxpa2UgY29vcmRzQ2hhciwgdGhhdCBuZWVkIHRvIGRvIGEgbG90IG9mXG4gIC8vIG1lYXN1cmVtZW50cyBpbiBhIHJvdywgY2FuIHRodXMgZW5zdXJlIHRoYXQgdGhlIHNldC11cCB3b3JrIGlzXG4gIC8vIG9ubHkgZG9uZSBvbmNlLlxuICBmdW5jdGlvbiBwcmVwYXJlTWVhc3VyZUZvckxpbmUoY20sIGxpbmUpIHtcbiAgICB2YXIgbGluZU4gPSBsaW5lTm8obGluZSk7XG4gICAgdmFyIHZpZXcgPSBmaW5kVmlld0ZvckxpbmUoY20sIGxpbmVOKTtcbiAgICBpZiAodmlldyAmJiAhdmlldy50ZXh0KSB7XG4gICAgICB2aWV3ID0gbnVsbDtcbiAgICB9IGVsc2UgaWYgKHZpZXcgJiYgdmlldy5jaGFuZ2VzKSB7XG4gICAgICB1cGRhdGVMaW5lRm9yQ2hhbmdlcyhjbSwgdmlldywgbGluZU4sIGdldERpbWVuc2lvbnMoY20pKTtcbiAgICAgIGNtLmN1ck9wLmZvcmNlVXBkYXRlID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKCF2aWV3KVxuICAgICAgdmlldyA9IHVwZGF0ZUV4dGVybmFsTWVhc3VyZW1lbnQoY20sIGxpbmUpO1xuXG4gICAgdmFyIGluZm8gPSBtYXBGcm9tTGluZVZpZXcodmlldywgbGluZSwgbGluZU4pO1xuICAgIHJldHVybiB7XG4gICAgICBsaW5lOiBsaW5lLCB2aWV3OiB2aWV3LCByZWN0OiBudWxsLFxuICAgICAgbWFwOiBpbmZvLm1hcCwgY2FjaGU6IGluZm8uY2FjaGUsIGJlZm9yZTogaW5mby5iZWZvcmUsXG4gICAgICBoYXNIZWlnaHRzOiBmYWxzZVxuICAgIH07XG4gIH1cblxuICAvLyBHaXZlbiBhIHByZXBhcmVkIG1lYXN1cmVtZW50IG9iamVjdCwgbWVhc3VyZXMgdGhlIHBvc2l0aW9uIG9mIGFuXG4gIC8vIGFjdHVhbCBjaGFyYWN0ZXIgKG9yIGZldGNoZXMgaXQgZnJvbSB0aGUgY2FjaGUpLlxuICBmdW5jdGlvbiBtZWFzdXJlQ2hhclByZXBhcmVkKGNtLCBwcmVwYXJlZCwgY2gsIGJpYXMsIHZhckhlaWdodCkge1xuICAgIGlmIChwcmVwYXJlZC5iZWZvcmUpIGNoID0gLTE7XG4gICAgdmFyIGtleSA9IGNoICsgKGJpYXMgfHwgXCJcIiksIGZvdW5kO1xuICAgIGlmIChwcmVwYXJlZC5jYWNoZS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICBmb3VuZCA9IHByZXBhcmVkLmNhY2hlW2tleV07XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghcHJlcGFyZWQucmVjdClcbiAgICAgICAgcHJlcGFyZWQucmVjdCA9IHByZXBhcmVkLnZpZXcudGV4dC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIGlmICghcHJlcGFyZWQuaGFzSGVpZ2h0cykge1xuICAgICAgICBlbnN1cmVMaW5lSGVpZ2h0cyhjbSwgcHJlcGFyZWQudmlldywgcHJlcGFyZWQucmVjdCk7XG4gICAgICAgIHByZXBhcmVkLmhhc0hlaWdodHMgPSB0cnVlO1xuICAgICAgfVxuICAgICAgZm91bmQgPSBtZWFzdXJlQ2hhcklubmVyKGNtLCBwcmVwYXJlZCwgY2gsIGJpYXMpO1xuICAgICAgaWYgKCFmb3VuZC5ib2d1cykgcHJlcGFyZWQuY2FjaGVba2V5XSA9IGZvdW5kO1xuICAgIH1cbiAgICByZXR1cm4ge2xlZnQ6IGZvdW5kLmxlZnQsIHJpZ2h0OiBmb3VuZC5yaWdodCxcbiAgICAgICAgICAgIHRvcDogdmFySGVpZ2h0ID8gZm91bmQucnRvcCA6IGZvdW5kLnRvcCxcbiAgICAgICAgICAgIGJvdHRvbTogdmFySGVpZ2h0ID8gZm91bmQucmJvdHRvbSA6IGZvdW5kLmJvdHRvbX07XG4gIH1cblxuICB2YXIgbnVsbFJlY3QgPSB7bGVmdDogMCwgcmlnaHQ6IDAsIHRvcDogMCwgYm90dG9tOiAwfTtcblxuICBmdW5jdGlvbiBub2RlQW5kT2Zmc2V0SW5MaW5lTWFwKG1hcCwgY2gsIGJpYXMpIHtcbiAgICB2YXIgbm9kZSwgc3RhcnQsIGVuZCwgY29sbGFwc2U7XG4gICAgLy8gRmlyc3QsIHNlYXJjaCB0aGUgbGluZSBtYXAgZm9yIHRoZSB0ZXh0IG5vZGUgY29ycmVzcG9uZGluZyB0byxcbiAgICAvLyBvciBjbG9zZXN0IHRvLCB0aGUgdGFyZ2V0IGNoYXJhY3Rlci5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1hcC5sZW5ndGg7IGkgKz0gMykge1xuICAgICAgdmFyIG1TdGFydCA9IG1hcFtpXSwgbUVuZCA9IG1hcFtpICsgMV07XG4gICAgICBpZiAoY2ggPCBtU3RhcnQpIHtcbiAgICAgICAgc3RhcnQgPSAwOyBlbmQgPSAxO1xuICAgICAgICBjb2xsYXBzZSA9IFwibGVmdFwiO1xuICAgICAgfSBlbHNlIGlmIChjaCA8IG1FbmQpIHtcbiAgICAgICAgc3RhcnQgPSBjaCAtIG1TdGFydDtcbiAgICAgICAgZW5kID0gc3RhcnQgKyAxO1xuICAgICAgfSBlbHNlIGlmIChpID09IG1hcC5sZW5ndGggLSAzIHx8IGNoID09IG1FbmQgJiYgbWFwW2kgKyAzXSA+IGNoKSB7XG4gICAgICAgIGVuZCA9IG1FbmQgLSBtU3RhcnQ7XG4gICAgICAgIHN0YXJ0ID0gZW5kIC0gMTtcbiAgICAgICAgaWYgKGNoID49IG1FbmQpIGNvbGxhcHNlID0gXCJyaWdodFwiO1xuICAgICAgfVxuICAgICAgaWYgKHN0YXJ0ICE9IG51bGwpIHtcbiAgICAgICAgbm9kZSA9IG1hcFtpICsgMl07XG4gICAgICAgIGlmIChtU3RhcnQgPT0gbUVuZCAmJiBiaWFzID09IChub2RlLmluc2VydExlZnQgPyBcImxlZnRcIiA6IFwicmlnaHRcIikpXG4gICAgICAgICAgY29sbGFwc2UgPSBiaWFzO1xuICAgICAgICBpZiAoYmlhcyA9PSBcImxlZnRcIiAmJiBzdGFydCA9PSAwKVxuICAgICAgICAgIHdoaWxlIChpICYmIG1hcFtpIC0gMl0gPT0gbWFwW2kgLSAzXSAmJiBtYXBbaSAtIDFdLmluc2VydExlZnQpIHtcbiAgICAgICAgICAgIG5vZGUgPSBtYXBbKGkgLT0gMykgKyAyXTtcbiAgICAgICAgICAgIGNvbGxhcHNlID0gXCJsZWZ0XCI7XG4gICAgICAgICAgfVxuICAgICAgICBpZiAoYmlhcyA9PSBcInJpZ2h0XCIgJiYgc3RhcnQgPT0gbUVuZCAtIG1TdGFydClcbiAgICAgICAgICB3aGlsZSAoaSA8IG1hcC5sZW5ndGggLSAzICYmIG1hcFtpICsgM10gPT0gbWFwW2kgKyA0XSAmJiAhbWFwW2kgKyA1XS5pbnNlcnRMZWZ0KSB7XG4gICAgICAgICAgICBub2RlID0gbWFwWyhpICs9IDMpICsgMl07XG4gICAgICAgICAgICBjb2xsYXBzZSA9IFwicmlnaHRcIjtcbiAgICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4ge25vZGU6IG5vZGUsIHN0YXJ0OiBzdGFydCwgZW5kOiBlbmQsIGNvbGxhcHNlOiBjb2xsYXBzZSwgY292ZXJTdGFydDogbVN0YXJ0LCBjb3ZlckVuZDogbUVuZH07XG4gIH1cblxuICBmdW5jdGlvbiBtZWFzdXJlQ2hhcklubmVyKGNtLCBwcmVwYXJlZCwgY2gsIGJpYXMpIHtcbiAgICB2YXIgcGxhY2UgPSBub2RlQW5kT2Zmc2V0SW5MaW5lTWFwKHByZXBhcmVkLm1hcCwgY2gsIGJpYXMpO1xuICAgIHZhciBub2RlID0gcGxhY2Uubm9kZSwgc3RhcnQgPSBwbGFjZS5zdGFydCwgZW5kID0gcGxhY2UuZW5kLCBjb2xsYXBzZSA9IHBsYWNlLmNvbGxhcHNlO1xuXG4gICAgdmFyIHJlY3Q7XG4gICAgaWYgKG5vZGUubm9kZVR5cGUgPT0gMykgeyAvLyBJZiBpdCBpcyBhIHRleHQgbm9kZSwgdXNlIGEgcmFuZ2UgdG8gcmV0cmlldmUgdGhlIGNvb3JkaW5hdGVzLlxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCA0OyBpKyspIHsgLy8gUmV0cnkgYSBtYXhpbXVtIG9mIDQgdGltZXMgd2hlbiBub25zZW5zZSByZWN0YW5nbGVzIGFyZSByZXR1cm5lZFxuICAgICAgICB3aGlsZSAoc3RhcnQgJiYgaXNFeHRlbmRpbmdDaGFyKHByZXBhcmVkLmxpbmUudGV4dC5jaGFyQXQocGxhY2UuY292ZXJTdGFydCArIHN0YXJ0KSkpIC0tc3RhcnQ7XG4gICAgICAgIHdoaWxlIChwbGFjZS5jb3ZlclN0YXJ0ICsgZW5kIDwgcGxhY2UuY292ZXJFbmQgJiYgaXNFeHRlbmRpbmdDaGFyKHByZXBhcmVkLmxpbmUudGV4dC5jaGFyQXQocGxhY2UuY292ZXJTdGFydCArIGVuZCkpKSArK2VuZDtcbiAgICAgICAgaWYgKGllICYmIGllX3ZlcnNpb24gPCA5ICYmIHN0YXJ0ID09IDAgJiYgZW5kID09IHBsYWNlLmNvdmVyRW5kIC0gcGxhY2UuY292ZXJTdGFydCkge1xuICAgICAgICAgIHJlY3QgPSBub2RlLnBhcmVudE5vZGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgIH0gZWxzZSBpZiAoaWUgJiYgY20ub3B0aW9ucy5saW5lV3JhcHBpbmcpIHtcbiAgICAgICAgICB2YXIgcmVjdHMgPSByYW5nZShub2RlLCBzdGFydCwgZW5kKS5nZXRDbGllbnRSZWN0cygpO1xuICAgICAgICAgIGlmIChyZWN0cy5sZW5ndGgpXG4gICAgICAgICAgICByZWN0ID0gcmVjdHNbYmlhcyA9PSBcInJpZ2h0XCIgPyByZWN0cy5sZW5ndGggLSAxIDogMF07XG4gICAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmVjdCA9IG51bGxSZWN0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlY3QgPSByYW5nZShub2RlLCBzdGFydCwgZW5kKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSB8fCBudWxsUmVjdDtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVjdC5sZWZ0IHx8IHJlY3QucmlnaHQgfHwgc3RhcnQgPT0gMCkgYnJlYWs7XG4gICAgICAgIGVuZCA9IHN0YXJ0O1xuICAgICAgICBzdGFydCA9IHN0YXJ0IC0gMTtcbiAgICAgICAgY29sbGFwc2UgPSBcInJpZ2h0XCI7XG4gICAgICB9XG4gICAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDExKSByZWN0ID0gbWF5YmVVcGRhdGVSZWN0Rm9yWm9vbWluZyhjbS5kaXNwbGF5Lm1lYXN1cmUsIHJlY3QpO1xuICAgIH0gZWxzZSB7IC8vIElmIGl0IGlzIGEgd2lkZ2V0LCBzaW1wbHkgZ2V0IHRoZSBib3ggZm9yIHRoZSB3aG9sZSB3aWRnZXQuXG4gICAgICBpZiAoc3RhcnQgPiAwKSBjb2xsYXBzZSA9IGJpYXMgPSBcInJpZ2h0XCI7XG4gICAgICB2YXIgcmVjdHM7XG4gICAgICBpZiAoY20ub3B0aW9ucy5saW5lV3JhcHBpbmcgJiYgKHJlY3RzID0gbm9kZS5nZXRDbGllbnRSZWN0cygpKS5sZW5ndGggPiAxKVxuICAgICAgICByZWN0ID0gcmVjdHNbYmlhcyA9PSBcInJpZ2h0XCIgPyByZWN0cy5sZW5ndGggLSAxIDogMF07XG4gICAgICBlbHNlXG4gICAgICAgIHJlY3QgPSBub2RlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIH1cbiAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDkgJiYgIXN0YXJ0ICYmICghcmVjdCB8fCAhcmVjdC5sZWZ0ICYmICFyZWN0LnJpZ2h0KSkge1xuICAgICAgdmFyIHJTcGFuID0gbm9kZS5wYXJlbnROb2RlLmdldENsaWVudFJlY3RzKClbMF07XG4gICAgICBpZiAoclNwYW4pXG4gICAgICAgIHJlY3QgPSB7bGVmdDogclNwYW4ubGVmdCwgcmlnaHQ6IHJTcGFuLmxlZnQgKyBjaGFyV2lkdGgoY20uZGlzcGxheSksIHRvcDogclNwYW4udG9wLCBib3R0b206IHJTcGFuLmJvdHRvbX07XG4gICAgICBlbHNlXG4gICAgICAgIHJlY3QgPSBudWxsUmVjdDtcbiAgICB9XG5cbiAgICB2YXIgcnRvcCA9IHJlY3QudG9wIC0gcHJlcGFyZWQucmVjdC50b3AsIHJib3QgPSByZWN0LmJvdHRvbSAtIHByZXBhcmVkLnJlY3QudG9wO1xuICAgIHZhciBtaWQgPSAocnRvcCArIHJib3QpIC8gMjtcbiAgICB2YXIgaGVpZ2h0cyA9IHByZXBhcmVkLnZpZXcubWVhc3VyZS5oZWlnaHRzO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGVpZ2h0cy5sZW5ndGggLSAxOyBpKyspXG4gICAgICBpZiAobWlkIDwgaGVpZ2h0c1tpXSkgYnJlYWs7XG4gICAgdmFyIHRvcCA9IGkgPyBoZWlnaHRzW2kgLSAxXSA6IDAsIGJvdCA9IGhlaWdodHNbaV07XG4gICAgdmFyIHJlc3VsdCA9IHtsZWZ0OiAoY29sbGFwc2UgPT0gXCJyaWdodFwiID8gcmVjdC5yaWdodCA6IHJlY3QubGVmdCkgLSBwcmVwYXJlZC5yZWN0LmxlZnQsXG4gICAgICAgICAgICAgICAgICByaWdodDogKGNvbGxhcHNlID09IFwibGVmdFwiID8gcmVjdC5sZWZ0IDogcmVjdC5yaWdodCkgLSBwcmVwYXJlZC5yZWN0LmxlZnQsXG4gICAgICAgICAgICAgICAgICB0b3A6IHRvcCwgYm90dG9tOiBib3R9O1xuICAgIGlmICghcmVjdC5sZWZ0ICYmICFyZWN0LnJpZ2h0KSByZXN1bHQuYm9ndXMgPSB0cnVlO1xuICAgIGlmICghY20ub3B0aW9ucy5zaW5nbGVDdXJzb3JIZWlnaHRQZXJMaW5lKSB7IHJlc3VsdC5ydG9wID0gcnRvcDsgcmVzdWx0LnJib3R0b20gPSByYm90OyB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLy8gV29yayBhcm91bmQgcHJvYmxlbSB3aXRoIGJvdW5kaW5nIGNsaWVudCByZWN0cyBvbiByYW5nZXMgYmVpbmdcbiAgLy8gcmV0dXJuZWQgaW5jb3JyZWN0bHkgd2hlbiB6b29tZWQgb24gSUUxMCBhbmQgYmVsb3cuXG4gIGZ1bmN0aW9uIG1heWJlVXBkYXRlUmVjdEZvclpvb21pbmcobWVhc3VyZSwgcmVjdCkge1xuICAgIGlmICghd2luZG93LnNjcmVlbiB8fCBzY3JlZW4ubG9naWNhbFhEUEkgPT0gbnVsbCB8fFxuICAgICAgICBzY3JlZW4ubG9naWNhbFhEUEkgPT0gc2NyZWVuLmRldmljZVhEUEkgfHwgIWhhc0JhZFpvb21lZFJlY3RzKG1lYXN1cmUpKVxuICAgICAgcmV0dXJuIHJlY3Q7XG4gICAgdmFyIHNjYWxlWCA9IHNjcmVlbi5sb2dpY2FsWERQSSAvIHNjcmVlbi5kZXZpY2VYRFBJO1xuICAgIHZhciBzY2FsZVkgPSBzY3JlZW4ubG9naWNhbFlEUEkgLyBzY3JlZW4uZGV2aWNlWURQSTtcbiAgICByZXR1cm4ge2xlZnQ6IHJlY3QubGVmdCAqIHNjYWxlWCwgcmlnaHQ6IHJlY3QucmlnaHQgKiBzY2FsZVgsXG4gICAgICAgICAgICB0b3A6IHJlY3QudG9wICogc2NhbGVZLCBib3R0b206IHJlY3QuYm90dG9tICogc2NhbGVZfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsZWFyTGluZU1lYXN1cmVtZW50Q2FjaGVGb3IobGluZVZpZXcpIHtcbiAgICBpZiAobGluZVZpZXcubWVhc3VyZSkge1xuICAgICAgbGluZVZpZXcubWVhc3VyZS5jYWNoZSA9IHt9O1xuICAgICAgbGluZVZpZXcubWVhc3VyZS5oZWlnaHRzID0gbnVsbDtcbiAgICAgIGlmIChsaW5lVmlldy5yZXN0KSBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmVWaWV3LnJlc3QubGVuZ3RoOyBpKyspXG4gICAgICAgIGxpbmVWaWV3Lm1lYXN1cmUuY2FjaGVzW2ldID0ge307XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gY2xlYXJMaW5lTWVhc3VyZW1lbnRDYWNoZShjbSkge1xuICAgIGNtLmRpc3BsYXkuZXh0ZXJuYWxNZWFzdXJlID0gbnVsbDtcbiAgICByZW1vdmVDaGlsZHJlbihjbS5kaXNwbGF5LmxpbmVNZWFzdXJlKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNtLmRpc3BsYXkudmlldy5sZW5ndGg7IGkrKylcbiAgICAgIGNsZWFyTGluZU1lYXN1cmVtZW50Q2FjaGVGb3IoY20uZGlzcGxheS52aWV3W2ldKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsZWFyQ2FjaGVzKGNtKSB7XG4gICAgY2xlYXJMaW5lTWVhc3VyZW1lbnRDYWNoZShjbSk7XG4gICAgY20uZGlzcGxheS5jYWNoZWRDaGFyV2lkdGggPSBjbS5kaXNwbGF5LmNhY2hlZFRleHRIZWlnaHQgPSBjbS5kaXNwbGF5LmNhY2hlZFBhZGRpbmdIID0gbnVsbDtcbiAgICBpZiAoIWNtLm9wdGlvbnMubGluZVdyYXBwaW5nKSBjbS5kaXNwbGF5Lm1heExpbmVDaGFuZ2VkID0gdHJ1ZTtcbiAgICBjbS5kaXNwbGF5LmxpbmVOdW1DaGFycyA9IG51bGw7XG4gIH1cblxuICBmdW5jdGlvbiBwYWdlU2Nyb2xsWCgpIHsgcmV0dXJuIHdpbmRvdy5wYWdlWE9mZnNldCB8fCAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50IHx8IGRvY3VtZW50LmJvZHkpLnNjcm9sbExlZnQ7IH1cbiAgZnVuY3Rpb24gcGFnZVNjcm9sbFkoKSB7IHJldHVybiB3aW5kb3cucGFnZVlPZmZzZXQgfHwgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCB8fCBkb2N1bWVudC5ib2R5KS5zY3JvbGxUb3A7IH1cblxuICAvLyBDb252ZXJ0cyBhIHt0b3AsIGJvdHRvbSwgbGVmdCwgcmlnaHR9IGJveCBmcm9tIGxpbmUtbG9jYWxcbiAgLy8gY29vcmRpbmF0ZXMgaW50byBhbm90aGVyIGNvb3JkaW5hdGUgc3lzdGVtLiBDb250ZXh0IG1heSBiZSBvbmUgb2ZcbiAgLy8gXCJsaW5lXCIsIFwiZGl2XCIgKGRpc3BsYXkubGluZURpdiksIFwibG9jYWxcIi9udWxsIChlZGl0b3IpLCBcIndpbmRvd1wiLFxuICAvLyBvciBcInBhZ2VcIi5cbiAgZnVuY3Rpb24gaW50b0Nvb3JkU3lzdGVtKGNtLCBsaW5lT2JqLCByZWN0LCBjb250ZXh0KSB7XG4gICAgaWYgKGxpbmVPYmoud2lkZ2V0cykgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lT2JqLndpZGdldHMubGVuZ3RoOyArK2kpIGlmIChsaW5lT2JqLndpZGdldHNbaV0uYWJvdmUpIHtcbiAgICAgIHZhciBzaXplID0gd2lkZ2V0SGVpZ2h0KGxpbmVPYmoud2lkZ2V0c1tpXSk7XG4gICAgICByZWN0LnRvcCArPSBzaXplOyByZWN0LmJvdHRvbSArPSBzaXplO1xuICAgIH1cbiAgICBpZiAoY29udGV4dCA9PSBcImxpbmVcIikgcmV0dXJuIHJlY3Q7XG4gICAgaWYgKCFjb250ZXh0KSBjb250ZXh0ID0gXCJsb2NhbFwiO1xuICAgIHZhciB5T2ZmID0gaGVpZ2h0QXRMaW5lKGxpbmVPYmopO1xuICAgIGlmIChjb250ZXh0ID09IFwibG9jYWxcIikgeU9mZiArPSBwYWRkaW5nVG9wKGNtLmRpc3BsYXkpO1xuICAgIGVsc2UgeU9mZiAtPSBjbS5kaXNwbGF5LnZpZXdPZmZzZXQ7XG4gICAgaWYgKGNvbnRleHQgPT0gXCJwYWdlXCIgfHwgY29udGV4dCA9PSBcIndpbmRvd1wiKSB7XG4gICAgICB2YXIgbE9mZiA9IGNtLmRpc3BsYXkubGluZVNwYWNlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgeU9mZiArPSBsT2ZmLnRvcCArIChjb250ZXh0ID09IFwid2luZG93XCIgPyAwIDogcGFnZVNjcm9sbFkoKSk7XG4gICAgICB2YXIgeE9mZiA9IGxPZmYubGVmdCArIChjb250ZXh0ID09IFwid2luZG93XCIgPyAwIDogcGFnZVNjcm9sbFgoKSk7XG4gICAgICByZWN0LmxlZnQgKz0geE9mZjsgcmVjdC5yaWdodCArPSB4T2ZmO1xuICAgIH1cbiAgICByZWN0LnRvcCArPSB5T2ZmOyByZWN0LmJvdHRvbSArPSB5T2ZmO1xuICAgIHJldHVybiByZWN0O1xuICB9XG5cbiAgLy8gQ292ZXJ0cyBhIGJveCBmcm9tIFwiZGl2XCIgY29vcmRzIHRvIGFub3RoZXIgY29vcmRpbmF0ZSBzeXN0ZW0uXG4gIC8vIENvbnRleHQgbWF5IGJlIFwid2luZG93XCIsIFwicGFnZVwiLCBcImRpdlwiLCBvciBcImxvY2FsXCIvbnVsbC5cbiAgZnVuY3Rpb24gZnJvbUNvb3JkU3lzdGVtKGNtLCBjb29yZHMsIGNvbnRleHQpIHtcbiAgICBpZiAoY29udGV4dCA9PSBcImRpdlwiKSByZXR1cm4gY29vcmRzO1xuICAgIHZhciBsZWZ0ID0gY29vcmRzLmxlZnQsIHRvcCA9IGNvb3Jkcy50b3A7XG4gICAgLy8gRmlyc3QgbW92ZSBpbnRvIFwicGFnZVwiIGNvb3JkaW5hdGUgc3lzdGVtXG4gICAgaWYgKGNvbnRleHQgPT0gXCJwYWdlXCIpIHtcbiAgICAgIGxlZnQgLT0gcGFnZVNjcm9sbFgoKTtcbiAgICAgIHRvcCAtPSBwYWdlU2Nyb2xsWSgpO1xuICAgIH0gZWxzZSBpZiAoY29udGV4dCA9PSBcImxvY2FsXCIgfHwgIWNvbnRleHQpIHtcbiAgICAgIHZhciBsb2NhbEJveCA9IGNtLmRpc3BsYXkuc2l6ZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICBsZWZ0ICs9IGxvY2FsQm94LmxlZnQ7XG4gICAgICB0b3AgKz0gbG9jYWxCb3gudG9wO1xuICAgIH1cblxuICAgIHZhciBsaW5lU3BhY2VCb3ggPSBjbS5kaXNwbGF5LmxpbmVTcGFjZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICByZXR1cm4ge2xlZnQ6IGxlZnQgLSBsaW5lU3BhY2VCb3gubGVmdCwgdG9wOiB0b3AgLSBsaW5lU3BhY2VCb3gudG9wfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNoYXJDb29yZHMoY20sIHBvcywgY29udGV4dCwgbGluZU9iaiwgYmlhcykge1xuICAgIGlmICghbGluZU9iaikgbGluZU9iaiA9IGdldExpbmUoY20uZG9jLCBwb3MubGluZSk7XG4gICAgcmV0dXJuIGludG9Db29yZFN5c3RlbShjbSwgbGluZU9iaiwgbWVhc3VyZUNoYXIoY20sIGxpbmVPYmosIHBvcy5jaCwgYmlhcyksIGNvbnRleHQpO1xuICB9XG5cbiAgLy8gUmV0dXJucyBhIGJveCBmb3IgYSBnaXZlbiBjdXJzb3IgcG9zaXRpb24sIHdoaWNoIG1heSBoYXZlIGFuXG4gIC8vICdvdGhlcicgcHJvcGVydHkgY29udGFpbmluZyB0aGUgcG9zaXRpb24gb2YgdGhlIHNlY29uZGFyeSBjdXJzb3JcbiAgLy8gb24gYSBiaWRpIGJvdW5kYXJ5LlxuICBmdW5jdGlvbiBjdXJzb3JDb29yZHMoY20sIHBvcywgY29udGV4dCwgbGluZU9iaiwgcHJlcGFyZWRNZWFzdXJlLCB2YXJIZWlnaHQpIHtcbiAgICBsaW5lT2JqID0gbGluZU9iaiB8fCBnZXRMaW5lKGNtLmRvYywgcG9zLmxpbmUpO1xuICAgIGlmICghcHJlcGFyZWRNZWFzdXJlKSBwcmVwYXJlZE1lYXN1cmUgPSBwcmVwYXJlTWVhc3VyZUZvckxpbmUoY20sIGxpbmVPYmopO1xuICAgIGZ1bmN0aW9uIGdldChjaCwgcmlnaHQpIHtcbiAgICAgIHZhciBtID0gbWVhc3VyZUNoYXJQcmVwYXJlZChjbSwgcHJlcGFyZWRNZWFzdXJlLCBjaCwgcmlnaHQgPyBcInJpZ2h0XCIgOiBcImxlZnRcIiwgdmFySGVpZ2h0KTtcbiAgICAgIGlmIChyaWdodCkgbS5sZWZ0ID0gbS5yaWdodDsgZWxzZSBtLnJpZ2h0ID0gbS5sZWZ0O1xuICAgICAgcmV0dXJuIGludG9Db29yZFN5c3RlbShjbSwgbGluZU9iaiwgbSwgY29udGV4dCk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGdldEJpZGkoY2gsIHBhcnRQb3MpIHtcbiAgICAgIHZhciBwYXJ0ID0gb3JkZXJbcGFydFBvc10sIHJpZ2h0ID0gcGFydC5sZXZlbCAlIDI7XG4gICAgICBpZiAoY2ggPT0gYmlkaUxlZnQocGFydCkgJiYgcGFydFBvcyAmJiBwYXJ0LmxldmVsIDwgb3JkZXJbcGFydFBvcyAtIDFdLmxldmVsKSB7XG4gICAgICAgIHBhcnQgPSBvcmRlclstLXBhcnRQb3NdO1xuICAgICAgICBjaCA9IGJpZGlSaWdodChwYXJ0KSAtIChwYXJ0LmxldmVsICUgMiA/IDAgOiAxKTtcbiAgICAgICAgcmlnaHQgPSB0cnVlO1xuICAgICAgfSBlbHNlIGlmIChjaCA9PSBiaWRpUmlnaHQocGFydCkgJiYgcGFydFBvcyA8IG9yZGVyLmxlbmd0aCAtIDEgJiYgcGFydC5sZXZlbCA8IG9yZGVyW3BhcnRQb3MgKyAxXS5sZXZlbCkge1xuICAgICAgICBwYXJ0ID0gb3JkZXJbKytwYXJ0UG9zXTtcbiAgICAgICAgY2ggPSBiaWRpTGVmdChwYXJ0KSAtIHBhcnQubGV2ZWwgJSAyO1xuICAgICAgICByaWdodCA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgaWYgKHJpZ2h0ICYmIGNoID09IHBhcnQudG8gJiYgY2ggPiBwYXJ0LmZyb20pIHJldHVybiBnZXQoY2ggLSAxKTtcbiAgICAgIHJldHVybiBnZXQoY2gsIHJpZ2h0KTtcbiAgICB9XG4gICAgdmFyIG9yZGVyID0gZ2V0T3JkZXIobGluZU9iaiksIGNoID0gcG9zLmNoO1xuICAgIGlmICghb3JkZXIpIHJldHVybiBnZXQoY2gpO1xuICAgIHZhciBwYXJ0UG9zID0gZ2V0QmlkaVBhcnRBdChvcmRlciwgY2gpO1xuICAgIHZhciB2YWwgPSBnZXRCaWRpKGNoLCBwYXJ0UG9zKTtcbiAgICBpZiAoYmlkaU90aGVyICE9IG51bGwpIHZhbC5vdGhlciA9IGdldEJpZGkoY2gsIGJpZGlPdGhlcik7XG4gICAgcmV0dXJuIHZhbDtcbiAgfVxuXG4gIC8vIFVzZWQgdG8gY2hlYXBseSBlc3RpbWF0ZSB0aGUgY29vcmRpbmF0ZXMgZm9yIGEgcG9zaXRpb24uIFVzZWQgZm9yXG4gIC8vIGludGVybWVkaWF0ZSBzY3JvbGwgdXBkYXRlcy5cbiAgZnVuY3Rpb24gZXN0aW1hdGVDb29yZHMoY20sIHBvcykge1xuICAgIHZhciBsZWZ0ID0gMCwgcG9zID0gY2xpcFBvcyhjbS5kb2MsIHBvcyk7XG4gICAgaWYgKCFjbS5vcHRpb25zLmxpbmVXcmFwcGluZykgbGVmdCA9IGNoYXJXaWR0aChjbS5kaXNwbGF5KSAqIHBvcy5jaDtcbiAgICB2YXIgbGluZU9iaiA9IGdldExpbmUoY20uZG9jLCBwb3MubGluZSk7XG4gICAgdmFyIHRvcCA9IGhlaWdodEF0TGluZShsaW5lT2JqKSArIHBhZGRpbmdUb3AoY20uZGlzcGxheSk7XG4gICAgcmV0dXJuIHtsZWZ0OiBsZWZ0LCByaWdodDogbGVmdCwgdG9wOiB0b3AsIGJvdHRvbTogdG9wICsgbGluZU9iai5oZWlnaHR9O1xuICB9XG5cbiAgLy8gUG9zaXRpb25zIHJldHVybmVkIGJ5IGNvb3Jkc0NoYXIgY29udGFpbiBzb21lIGV4dHJhIGluZm9ybWF0aW9uLlxuICAvLyB4UmVsIGlzIHRoZSByZWxhdGl2ZSB4IHBvc2l0aW9uIG9mIHRoZSBpbnB1dCBjb29yZGluYXRlcyBjb21wYXJlZFxuICAvLyB0byB0aGUgZm91bmQgcG9zaXRpb24gKHNvIHhSZWwgPiAwIG1lYW5zIHRoZSBjb29yZGluYXRlcyBhcmUgdG9cbiAgLy8gdGhlIHJpZ2h0IG9mIHRoZSBjaGFyYWN0ZXIgcG9zaXRpb24sIGZvciBleGFtcGxlKS4gV2hlbiBvdXRzaWRlXG4gIC8vIGlzIHRydWUsIHRoYXQgbWVhbnMgdGhlIGNvb3JkaW5hdGVzIGxpZSBvdXRzaWRlIHRoZSBsaW5lJ3NcbiAgLy8gdmVydGljYWwgcmFuZ2UuXG4gIGZ1bmN0aW9uIFBvc1dpdGhJbmZvKGxpbmUsIGNoLCBvdXRzaWRlLCB4UmVsKSB7XG4gICAgdmFyIHBvcyA9IFBvcyhsaW5lLCBjaCk7XG4gICAgcG9zLnhSZWwgPSB4UmVsO1xuICAgIGlmIChvdXRzaWRlKSBwb3Mub3V0c2lkZSA9IHRydWU7XG4gICAgcmV0dXJuIHBvcztcbiAgfVxuXG4gIC8vIENvbXB1dGUgdGhlIGNoYXJhY3RlciBwb3NpdGlvbiBjbG9zZXN0IHRvIHRoZSBnaXZlbiBjb29yZGluYXRlcy5cbiAgLy8gSW5wdXQgbXVzdCBiZSBsaW5lU3BhY2UtbG9jYWwgKFwiZGl2XCIgY29vcmRpbmF0ZSBzeXN0ZW0pLlxuICBmdW5jdGlvbiBjb29yZHNDaGFyKGNtLCB4LCB5KSB7XG4gICAgdmFyIGRvYyA9IGNtLmRvYztcbiAgICB5ICs9IGNtLmRpc3BsYXkudmlld09mZnNldDtcbiAgICBpZiAoeSA8IDApIHJldHVybiBQb3NXaXRoSW5mbyhkb2MuZmlyc3QsIDAsIHRydWUsIC0xKTtcbiAgICB2YXIgbGluZU4gPSBsaW5lQXRIZWlnaHQoZG9jLCB5KSwgbGFzdCA9IGRvYy5maXJzdCArIGRvYy5zaXplIC0gMTtcbiAgICBpZiAobGluZU4gPiBsYXN0KVxuICAgICAgcmV0dXJuIFBvc1dpdGhJbmZvKGRvYy5maXJzdCArIGRvYy5zaXplIC0gMSwgZ2V0TGluZShkb2MsIGxhc3QpLnRleHQubGVuZ3RoLCB0cnVlLCAxKTtcbiAgICBpZiAoeCA8IDApIHggPSAwO1xuXG4gICAgdmFyIGxpbmVPYmogPSBnZXRMaW5lKGRvYywgbGluZU4pO1xuICAgIGZvciAoOzspIHtcbiAgICAgIHZhciBmb3VuZCA9IGNvb3Jkc0NoYXJJbm5lcihjbSwgbGluZU9iaiwgbGluZU4sIHgsIHkpO1xuICAgICAgdmFyIG1lcmdlZCA9IGNvbGxhcHNlZFNwYW5BdEVuZChsaW5lT2JqKTtcbiAgICAgIHZhciBtZXJnZWRQb3MgPSBtZXJnZWQgJiYgbWVyZ2VkLmZpbmQoMCwgdHJ1ZSk7XG4gICAgICBpZiAobWVyZ2VkICYmIChmb3VuZC5jaCA+IG1lcmdlZFBvcy5mcm9tLmNoIHx8IGZvdW5kLmNoID09IG1lcmdlZFBvcy5mcm9tLmNoICYmIGZvdW5kLnhSZWwgPiAwKSlcbiAgICAgICAgbGluZU4gPSBsaW5lTm8obGluZU9iaiA9IG1lcmdlZFBvcy50by5saW5lKTtcbiAgICAgIGVsc2VcbiAgICAgICAgcmV0dXJuIGZvdW5kO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGNvb3Jkc0NoYXJJbm5lcihjbSwgbGluZU9iaiwgbGluZU5vLCB4LCB5KSB7XG4gICAgdmFyIGlubmVyT2ZmID0geSAtIGhlaWdodEF0TGluZShsaW5lT2JqKTtcbiAgICB2YXIgd3JvbmdMaW5lID0gZmFsc2UsIGFkanVzdCA9IDIgKiBjbS5kaXNwbGF5LndyYXBwZXIuY2xpZW50V2lkdGg7XG4gICAgdmFyIHByZXBhcmVkTWVhc3VyZSA9IHByZXBhcmVNZWFzdXJlRm9yTGluZShjbSwgbGluZU9iaik7XG5cbiAgICBmdW5jdGlvbiBnZXRYKGNoKSB7XG4gICAgICB2YXIgc3AgPSBjdXJzb3JDb29yZHMoY20sIFBvcyhsaW5lTm8sIGNoKSwgXCJsaW5lXCIsIGxpbmVPYmosIHByZXBhcmVkTWVhc3VyZSk7XG4gICAgICB3cm9uZ0xpbmUgPSB0cnVlO1xuICAgICAgaWYgKGlubmVyT2ZmID4gc3AuYm90dG9tKSByZXR1cm4gc3AubGVmdCAtIGFkanVzdDtcbiAgICAgIGVsc2UgaWYgKGlubmVyT2ZmIDwgc3AudG9wKSByZXR1cm4gc3AubGVmdCArIGFkanVzdDtcbiAgICAgIGVsc2Ugd3JvbmdMaW5lID0gZmFsc2U7XG4gICAgICByZXR1cm4gc3AubGVmdDtcbiAgICB9XG5cbiAgICB2YXIgYmlkaSA9IGdldE9yZGVyKGxpbmVPYmopLCBkaXN0ID0gbGluZU9iai50ZXh0Lmxlbmd0aDtcbiAgICB2YXIgZnJvbSA9IGxpbmVMZWZ0KGxpbmVPYmopLCB0byA9IGxpbmVSaWdodChsaW5lT2JqKTtcbiAgICB2YXIgZnJvbVggPSBnZXRYKGZyb20pLCBmcm9tT3V0c2lkZSA9IHdyb25nTGluZSwgdG9YID0gZ2V0WCh0byksIHRvT3V0c2lkZSA9IHdyb25nTGluZTtcblxuICAgIGlmICh4ID4gdG9YKSByZXR1cm4gUG9zV2l0aEluZm8obGluZU5vLCB0bywgdG9PdXRzaWRlLCAxKTtcbiAgICAvLyBEbyBhIGJpbmFyeSBzZWFyY2ggYmV0d2VlbiB0aGVzZSBib3VuZHMuXG4gICAgZm9yICg7Oykge1xuICAgICAgaWYgKGJpZGkgPyB0byA9PSBmcm9tIHx8IHRvID09IG1vdmVWaXN1YWxseShsaW5lT2JqLCBmcm9tLCAxKSA6IHRvIC0gZnJvbSA8PSAxKSB7XG4gICAgICAgIHZhciBjaCA9IHggPCBmcm9tWCB8fCB4IC0gZnJvbVggPD0gdG9YIC0geCA/IGZyb20gOiB0bztcbiAgICAgICAgdmFyIHhEaWZmID0geCAtIChjaCA9PSBmcm9tID8gZnJvbVggOiB0b1gpO1xuICAgICAgICB3aGlsZSAoaXNFeHRlbmRpbmdDaGFyKGxpbmVPYmoudGV4dC5jaGFyQXQoY2gpKSkgKytjaDtcbiAgICAgICAgdmFyIHBvcyA9IFBvc1dpdGhJbmZvKGxpbmVObywgY2gsIGNoID09IGZyb20gPyBmcm9tT3V0c2lkZSA6IHRvT3V0c2lkZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHhEaWZmIDwgLTEgPyAtMSA6IHhEaWZmID4gMSA/IDEgOiAwKTtcbiAgICAgICAgcmV0dXJuIHBvcztcbiAgICAgIH1cbiAgICAgIHZhciBzdGVwID0gTWF0aC5jZWlsKGRpc3QgLyAyKSwgbWlkZGxlID0gZnJvbSArIHN0ZXA7XG4gICAgICBpZiAoYmlkaSkge1xuICAgICAgICBtaWRkbGUgPSBmcm9tO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0ZXA7ICsraSkgbWlkZGxlID0gbW92ZVZpc3VhbGx5KGxpbmVPYmosIG1pZGRsZSwgMSk7XG4gICAgICB9XG4gICAgICB2YXIgbWlkZGxlWCA9IGdldFgobWlkZGxlKTtcbiAgICAgIGlmIChtaWRkbGVYID4geCkge3RvID0gbWlkZGxlOyB0b1ggPSBtaWRkbGVYOyBpZiAodG9PdXRzaWRlID0gd3JvbmdMaW5lKSB0b1ggKz0gMTAwMDsgZGlzdCA9IHN0ZXA7fVxuICAgICAgZWxzZSB7ZnJvbSA9IG1pZGRsZTsgZnJvbVggPSBtaWRkbGVYOyBmcm9tT3V0c2lkZSA9IHdyb25nTGluZTsgZGlzdCAtPSBzdGVwO31cbiAgICB9XG4gIH1cblxuICB2YXIgbWVhc3VyZVRleHQ7XG4gIC8vIENvbXB1dGUgdGhlIGRlZmF1bHQgdGV4dCBoZWlnaHQuXG4gIGZ1bmN0aW9uIHRleHRIZWlnaHQoZGlzcGxheSkge1xuICAgIGlmIChkaXNwbGF5LmNhY2hlZFRleHRIZWlnaHQgIT0gbnVsbCkgcmV0dXJuIGRpc3BsYXkuY2FjaGVkVGV4dEhlaWdodDtcbiAgICBpZiAobWVhc3VyZVRleHQgPT0gbnVsbCkge1xuICAgICAgbWVhc3VyZVRleHQgPSBlbHQoXCJwcmVcIik7XG4gICAgICAvLyBNZWFzdXJlIGEgYnVuY2ggb2YgbGluZXMsIGZvciBicm93c2VycyB0aGF0IGNvbXB1dGVcbiAgICAgIC8vIGZyYWN0aW9uYWwgaGVpZ2h0cy5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNDk7ICsraSkge1xuICAgICAgICBtZWFzdXJlVGV4dC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShcInhcIikpO1xuICAgICAgICBtZWFzdXJlVGV4dC5hcHBlbmRDaGlsZChlbHQoXCJiclwiKSk7XG4gICAgICB9XG4gICAgICBtZWFzdXJlVGV4dC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShcInhcIikpO1xuICAgIH1cbiAgICByZW1vdmVDaGlsZHJlbkFuZEFkZChkaXNwbGF5Lm1lYXN1cmUsIG1lYXN1cmVUZXh0KTtcbiAgICB2YXIgaGVpZ2h0ID0gbWVhc3VyZVRleHQub2Zmc2V0SGVpZ2h0IC8gNTA7XG4gICAgaWYgKGhlaWdodCA+IDMpIGRpc3BsYXkuY2FjaGVkVGV4dEhlaWdodCA9IGhlaWdodDtcbiAgICByZW1vdmVDaGlsZHJlbihkaXNwbGF5Lm1lYXN1cmUpO1xuICAgIHJldHVybiBoZWlnaHQgfHwgMTtcbiAgfVxuXG4gIC8vIENvbXB1dGUgdGhlIGRlZmF1bHQgY2hhcmFjdGVyIHdpZHRoLlxuICBmdW5jdGlvbiBjaGFyV2lkdGgoZGlzcGxheSkge1xuICAgIGlmIChkaXNwbGF5LmNhY2hlZENoYXJXaWR0aCAhPSBudWxsKSByZXR1cm4gZGlzcGxheS5jYWNoZWRDaGFyV2lkdGg7XG4gICAgdmFyIGFuY2hvciA9IGVsdChcInNwYW5cIiwgXCJ4eHh4eHh4eHh4XCIpO1xuICAgIHZhciBwcmUgPSBlbHQoXCJwcmVcIiwgW2FuY2hvcl0pO1xuICAgIHJlbW92ZUNoaWxkcmVuQW5kQWRkKGRpc3BsYXkubWVhc3VyZSwgcHJlKTtcbiAgICB2YXIgcmVjdCA9IGFuY2hvci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwgd2lkdGggPSAocmVjdC5yaWdodCAtIHJlY3QubGVmdCkgLyAxMDtcbiAgICBpZiAod2lkdGggPiAyKSBkaXNwbGF5LmNhY2hlZENoYXJXaWR0aCA9IHdpZHRoO1xuICAgIHJldHVybiB3aWR0aCB8fCAxMDtcbiAgfVxuXG4gIC8vIE9QRVJBVElPTlNcblxuICAvLyBPcGVyYXRpb25zIGFyZSB1c2VkIHRvIHdyYXAgYSBzZXJpZXMgb2YgY2hhbmdlcyB0byB0aGUgZWRpdG9yXG4gIC8vIHN0YXRlIGluIHN1Y2ggYSB3YXkgdGhhdCBlYWNoIGNoYW5nZSB3b24ndCBoYXZlIHRvIHVwZGF0ZSB0aGVcbiAgLy8gY3Vyc29yIGFuZCBkaXNwbGF5ICh3aGljaCB3b3VsZCBiZSBhd2t3YXJkLCBzbG93LCBhbmRcbiAgLy8gZXJyb3ItcHJvbmUpLiBJbnN0ZWFkLCBkaXNwbGF5IHVwZGF0ZXMgYXJlIGJhdGNoZWQgYW5kIHRoZW4gYWxsXG4gIC8vIGNvbWJpbmVkIGFuZCBleGVjdXRlZCBhdCBvbmNlLlxuXG4gIHZhciBvcGVyYXRpb25Hcm91cCA9IG51bGw7XG5cbiAgdmFyIG5leHRPcElkID0gMDtcbiAgLy8gU3RhcnQgYSBuZXcgb3BlcmF0aW9uLlxuICBmdW5jdGlvbiBzdGFydE9wZXJhdGlvbihjbSkge1xuICAgIGNtLmN1ck9wID0ge1xuICAgICAgY206IGNtLFxuICAgICAgdmlld0NoYW5nZWQ6IGZhbHNlLCAgICAgIC8vIEZsYWcgdGhhdCBpbmRpY2F0ZXMgdGhhdCBsaW5lcyBtaWdodCBuZWVkIHRvIGJlIHJlZHJhd25cbiAgICAgIHN0YXJ0SGVpZ2h0OiBjbS5kb2MuaGVpZ2h0LCAvLyBVc2VkIHRvIGRldGVjdCBuZWVkIHRvIHVwZGF0ZSBzY3JvbGxiYXJcbiAgICAgIGZvcmNlVXBkYXRlOiBmYWxzZSwgICAgICAvLyBVc2VkIHRvIGZvcmNlIGEgcmVkcmF3XG4gICAgICB1cGRhdGVJbnB1dDogbnVsbCwgICAgICAgLy8gV2hldGhlciB0byByZXNldCB0aGUgaW5wdXQgdGV4dGFyZWFcbiAgICAgIHR5cGluZzogZmFsc2UsICAgICAgICAgICAvLyBXaGV0aGVyIHRoaXMgcmVzZXQgc2hvdWxkIGJlIGNhcmVmdWwgdG8gbGVhdmUgZXhpc3RpbmcgdGV4dCAoZm9yIGNvbXBvc2l0aW5nKVxuICAgICAgY2hhbmdlT2JqczogbnVsbCwgICAgICAgIC8vIEFjY3VtdWxhdGVkIGNoYW5nZXMsIGZvciBmaXJpbmcgY2hhbmdlIGV2ZW50c1xuICAgICAgY3Vyc29yQWN0aXZpdHlIYW5kbGVyczogbnVsbCwgLy8gU2V0IG9mIGhhbmRsZXJzIHRvIGZpcmUgY3Vyc29yQWN0aXZpdHkgb25cbiAgICAgIGN1cnNvckFjdGl2aXR5Q2FsbGVkOiAwLCAvLyBUcmFja3Mgd2hpY2ggY3Vyc29yQWN0aXZpdHkgaGFuZGxlcnMgaGF2ZSBiZWVuIGNhbGxlZCBhbHJlYWR5XG4gICAgICBzZWxlY3Rpb25DaGFuZ2VkOiBmYWxzZSwgLy8gV2hldGhlciB0aGUgc2VsZWN0aW9uIG5lZWRzIHRvIGJlIHJlZHJhd25cbiAgICAgIHVwZGF0ZU1heExpbmU6IGZhbHNlLCAgICAvLyBTZXQgd2hlbiB0aGUgd2lkZXN0IGxpbmUgbmVlZHMgdG8gYmUgZGV0ZXJtaW5lZCBhbmV3XG4gICAgICBzY3JvbGxMZWZ0OiBudWxsLCBzY3JvbGxUb3A6IG51bGwsIC8vIEludGVybWVkaWF0ZSBzY3JvbGwgcG9zaXRpb24sIG5vdCBwdXNoZWQgdG8gRE9NIHlldFxuICAgICAgc2Nyb2xsVG9Qb3M6IG51bGwsICAgICAgIC8vIFVzZWQgdG8gc2Nyb2xsIHRvIGEgc3BlY2lmaWMgcG9zaXRpb25cbiAgICAgIGZvY3VzOiBmYWxzZSxcbiAgICAgIGlkOiArK25leHRPcElkICAgICAgICAgICAvLyBVbmlxdWUgSURcbiAgICB9O1xuICAgIGlmIChvcGVyYXRpb25Hcm91cCkge1xuICAgICAgb3BlcmF0aW9uR3JvdXAub3BzLnB1c2goY20uY3VyT3ApO1xuICAgIH0gZWxzZSB7XG4gICAgICBjbS5jdXJPcC5vd25zR3JvdXAgPSBvcGVyYXRpb25Hcm91cCA9IHtcbiAgICAgICAgb3BzOiBbY20uY3VyT3BdLFxuICAgICAgICBkZWxheWVkQ2FsbGJhY2tzOiBbXVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBmaXJlQ2FsbGJhY2tzRm9yT3BzKGdyb3VwKSB7XG4gICAgLy8gQ2FsbHMgZGVsYXllZCBjYWxsYmFja3MgYW5kIGN1cnNvckFjdGl2aXR5IGhhbmRsZXJzIHVudGlsIG5vXG4gICAgLy8gbmV3IG9uZXMgYXBwZWFyXG4gICAgdmFyIGNhbGxiYWNrcyA9IGdyb3VwLmRlbGF5ZWRDYWxsYmFja3MsIGkgPSAwO1xuICAgIGRvIHtcbiAgICAgIGZvciAoOyBpIDwgY2FsbGJhY2tzLmxlbmd0aDsgaSsrKVxuICAgICAgICBjYWxsYmFja3NbaV0uY2FsbChudWxsKTtcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgZ3JvdXAub3BzLmxlbmd0aDsgaisrKSB7XG4gICAgICAgIHZhciBvcCA9IGdyb3VwLm9wc1tqXTtcbiAgICAgICAgaWYgKG9wLmN1cnNvckFjdGl2aXR5SGFuZGxlcnMpXG4gICAgICAgICAgd2hpbGUgKG9wLmN1cnNvckFjdGl2aXR5Q2FsbGVkIDwgb3AuY3Vyc29yQWN0aXZpdHlIYW5kbGVycy5sZW5ndGgpXG4gICAgICAgICAgICBvcC5jdXJzb3JBY3Rpdml0eUhhbmRsZXJzW29wLmN1cnNvckFjdGl2aXR5Q2FsbGVkKytdLmNhbGwobnVsbCwgb3AuY20pO1xuICAgICAgfVxuICAgIH0gd2hpbGUgKGkgPCBjYWxsYmFja3MubGVuZ3RoKTtcbiAgfVxuXG4gIC8vIEZpbmlzaCBhbiBvcGVyYXRpb24sIHVwZGF0aW5nIHRoZSBkaXNwbGF5IGFuZCBzaWduYWxsaW5nIGRlbGF5ZWQgZXZlbnRzXG4gIGZ1bmN0aW9uIGVuZE9wZXJhdGlvbihjbSkge1xuICAgIHZhciBvcCA9IGNtLmN1ck9wLCBncm91cCA9IG9wLm93bnNHcm91cDtcbiAgICBpZiAoIWdyb3VwKSByZXR1cm47XG5cbiAgICB0cnkgeyBmaXJlQ2FsbGJhY2tzRm9yT3BzKGdyb3VwKTsgfVxuICAgIGZpbmFsbHkge1xuICAgICAgb3BlcmF0aW9uR3JvdXAgPSBudWxsO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBncm91cC5vcHMubGVuZ3RoOyBpKyspXG4gICAgICAgIGdyb3VwLm9wc1tpXS5jbS5jdXJPcCA9IG51bGw7XG4gICAgICBlbmRPcGVyYXRpb25zKGdyb3VwKTtcbiAgICB9XG4gIH1cblxuICAvLyBUaGUgRE9NIHVwZGF0ZXMgZG9uZSB3aGVuIGFuIG9wZXJhdGlvbiBmaW5pc2hlcyBhcmUgYmF0Y2hlZCBzb1xuICAvLyB0aGF0IHRoZSBtaW5pbXVtIG51bWJlciBvZiByZWxheW91dHMgYXJlIHJlcXVpcmVkLlxuICBmdW5jdGlvbiBlbmRPcGVyYXRpb25zKGdyb3VwKSB7XG4gICAgdmFyIG9wcyA9IGdyb3VwLm9wcztcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9wcy5sZW5ndGg7IGkrKykgLy8gUmVhZCBET01cbiAgICAgIGVuZE9wZXJhdGlvbl9SMShvcHNbaV0pO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3BzLmxlbmd0aDsgaSsrKSAvLyBXcml0ZSBET00gKG1heWJlKVxuICAgICAgZW5kT3BlcmF0aW9uX1cxKG9wc1tpXSk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvcHMubGVuZ3RoOyBpKyspIC8vIFJlYWQgRE9NXG4gICAgICBlbmRPcGVyYXRpb25fUjIob3BzW2ldKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9wcy5sZW5ndGg7IGkrKykgLy8gV3JpdGUgRE9NIChtYXliZSlcbiAgICAgIGVuZE9wZXJhdGlvbl9XMihvcHNbaV0pO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3BzLmxlbmd0aDsgaSsrKSAvLyBSZWFkIERPTVxuICAgICAgZW5kT3BlcmF0aW9uX2ZpbmlzaChvcHNbaV0pO1xuICB9XG5cbiAgZnVuY3Rpb24gZW5kT3BlcmF0aW9uX1IxKG9wKSB7XG4gICAgdmFyIGNtID0gb3AuY20sIGRpc3BsYXkgPSBjbS5kaXNwbGF5O1xuICAgIG1heWJlQ2xpcFNjcm9sbGJhcnMoY20pO1xuICAgIGlmIChvcC51cGRhdGVNYXhMaW5lKSBmaW5kTWF4TGluZShjbSk7XG5cbiAgICBvcC5tdXN0VXBkYXRlID0gb3Audmlld0NoYW5nZWQgfHwgb3AuZm9yY2VVcGRhdGUgfHwgb3Auc2Nyb2xsVG9wICE9IG51bGwgfHxcbiAgICAgIG9wLnNjcm9sbFRvUG9zICYmIChvcC5zY3JvbGxUb1Bvcy5mcm9tLmxpbmUgPCBkaXNwbGF5LnZpZXdGcm9tIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgb3Auc2Nyb2xsVG9Qb3MudG8ubGluZSA+PSBkaXNwbGF5LnZpZXdUbykgfHxcbiAgICAgIGRpc3BsYXkubWF4TGluZUNoYW5nZWQgJiYgY20ub3B0aW9ucy5saW5lV3JhcHBpbmc7XG4gICAgb3AudXBkYXRlID0gb3AubXVzdFVwZGF0ZSAmJlxuICAgICAgbmV3IERpc3BsYXlVcGRhdGUoY20sIG9wLm11c3RVcGRhdGUgJiYge3RvcDogb3Auc2Nyb2xsVG9wLCBlbnN1cmU6IG9wLnNjcm9sbFRvUG9zfSwgb3AuZm9yY2VVcGRhdGUpO1xuICB9XG5cbiAgZnVuY3Rpb24gZW5kT3BlcmF0aW9uX1cxKG9wKSB7XG4gICAgb3AudXBkYXRlZERpc3BsYXkgPSBvcC5tdXN0VXBkYXRlICYmIHVwZGF0ZURpc3BsYXlJZk5lZWRlZChvcC5jbSwgb3AudXBkYXRlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGVuZE9wZXJhdGlvbl9SMihvcCkge1xuICAgIHZhciBjbSA9IG9wLmNtLCBkaXNwbGF5ID0gY20uZGlzcGxheTtcbiAgICBpZiAob3AudXBkYXRlZERpc3BsYXkpIHVwZGF0ZUhlaWdodHNJblZpZXdwb3J0KGNtKTtcblxuICAgIG9wLmJhck1lYXN1cmUgPSBtZWFzdXJlRm9yU2Nyb2xsYmFycyhjbSk7XG5cbiAgICAvLyBJZiB0aGUgbWF4IGxpbmUgY2hhbmdlZCBzaW5jZSBpdCB3YXMgbGFzdCBtZWFzdXJlZCwgbWVhc3VyZSBpdCxcbiAgICAvLyBhbmQgZW5zdXJlIHRoZSBkb2N1bWVudCdzIHdpZHRoIG1hdGNoZXMgaXQuXG4gICAgLy8gdXBkYXRlRGlzcGxheV9XMiB3aWxsIHVzZSB0aGVzZSBwcm9wZXJ0aWVzIHRvIGRvIHRoZSBhY3R1YWwgcmVzaXppbmdcbiAgICBpZiAoZGlzcGxheS5tYXhMaW5lQ2hhbmdlZCAmJiAhY20ub3B0aW9ucy5saW5lV3JhcHBpbmcpIHtcbiAgICAgIG9wLmFkanVzdFdpZHRoVG8gPSBtZWFzdXJlQ2hhcihjbSwgZGlzcGxheS5tYXhMaW5lLCBkaXNwbGF5Lm1heExpbmUudGV4dC5sZW5ndGgpLmxlZnQgKyAzO1xuICAgICAgY20uZGlzcGxheS5zaXplcldpZHRoID0gb3AuYWRqdXN0V2lkdGhUbztcbiAgICAgIG9wLmJhck1lYXN1cmUuc2Nyb2xsV2lkdGggPVxuICAgICAgICBNYXRoLm1heChkaXNwbGF5LnNjcm9sbGVyLmNsaWVudFdpZHRoLCBkaXNwbGF5LnNpemVyLm9mZnNldExlZnQgKyBvcC5hZGp1c3RXaWR0aFRvICsgc2Nyb2xsR2FwKGNtKSArIGNtLmRpc3BsYXkuYmFyV2lkdGgpO1xuICAgICAgb3AubWF4U2Nyb2xsTGVmdCA9IE1hdGgubWF4KDAsIGRpc3BsYXkuc2l6ZXIub2Zmc2V0TGVmdCArIG9wLmFkanVzdFdpZHRoVG8gLSBkaXNwbGF5V2lkdGgoY20pKTtcbiAgICB9XG5cbiAgICBpZiAob3AudXBkYXRlZERpc3BsYXkgfHwgb3Auc2VsZWN0aW9uQ2hhbmdlZClcbiAgICAgIG9wLnByZXBhcmVkU2VsZWN0aW9uID0gZGlzcGxheS5pbnB1dC5wcmVwYXJlU2VsZWN0aW9uKCk7XG4gIH1cblxuICBmdW5jdGlvbiBlbmRPcGVyYXRpb25fVzIob3ApIHtcbiAgICB2YXIgY20gPSBvcC5jbTtcblxuICAgIGlmIChvcC5hZGp1c3RXaWR0aFRvICE9IG51bGwpIHtcbiAgICAgIGNtLmRpc3BsYXkuc2l6ZXIuc3R5bGUubWluV2lkdGggPSBvcC5hZGp1c3RXaWR0aFRvICsgXCJweFwiO1xuICAgICAgaWYgKG9wLm1heFNjcm9sbExlZnQgPCBjbS5kb2Muc2Nyb2xsTGVmdClcbiAgICAgICAgc2V0U2Nyb2xsTGVmdChjbSwgTWF0aC5taW4oY20uZGlzcGxheS5zY3JvbGxlci5zY3JvbGxMZWZ0LCBvcC5tYXhTY3JvbGxMZWZ0KSwgdHJ1ZSk7XG4gICAgICBjbS5kaXNwbGF5Lm1heExpbmVDaGFuZ2VkID0gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKG9wLnByZXBhcmVkU2VsZWN0aW9uKVxuICAgICAgY20uZGlzcGxheS5pbnB1dC5zaG93U2VsZWN0aW9uKG9wLnByZXBhcmVkU2VsZWN0aW9uKTtcbiAgICBpZiAob3AudXBkYXRlZERpc3BsYXkpXG4gICAgICBzZXREb2N1bWVudEhlaWdodChjbSwgb3AuYmFyTWVhc3VyZSk7XG4gICAgaWYgKG9wLnVwZGF0ZWREaXNwbGF5IHx8IG9wLnN0YXJ0SGVpZ2h0ICE9IGNtLmRvYy5oZWlnaHQpXG4gICAgICB1cGRhdGVTY3JvbGxiYXJzKGNtLCBvcC5iYXJNZWFzdXJlKTtcblxuICAgIGlmIChvcC5zZWxlY3Rpb25DaGFuZ2VkKSByZXN0YXJ0QmxpbmsoY20pO1xuXG4gICAgaWYgKGNtLnN0YXRlLmZvY3VzZWQgJiYgb3AudXBkYXRlSW5wdXQpXG4gICAgICBjbS5kaXNwbGF5LmlucHV0LnJlc2V0KG9wLnR5cGluZyk7XG4gICAgaWYgKG9wLmZvY3VzICYmIG9wLmZvY3VzID09IGFjdGl2ZUVsdCgpKSBlbnN1cmVGb2N1cyhvcC5jbSk7XG4gIH1cblxuICBmdW5jdGlvbiBlbmRPcGVyYXRpb25fZmluaXNoKG9wKSB7XG4gICAgdmFyIGNtID0gb3AuY20sIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCBkb2MgPSBjbS5kb2M7XG5cbiAgICBpZiAob3AudXBkYXRlZERpc3BsYXkpIHBvc3RVcGRhdGVEaXNwbGF5KGNtLCBvcC51cGRhdGUpO1xuXG4gICAgLy8gQWJvcnQgbW91c2Ugd2hlZWwgZGVsdGEgbWVhc3VyZW1lbnQsIHdoZW4gc2Nyb2xsaW5nIGV4cGxpY2l0bHlcbiAgICBpZiAoZGlzcGxheS53aGVlbFN0YXJ0WCAhPSBudWxsICYmIChvcC5zY3JvbGxUb3AgIT0gbnVsbCB8fCBvcC5zY3JvbGxMZWZ0ICE9IG51bGwgfHwgb3Auc2Nyb2xsVG9Qb3MpKVxuICAgICAgZGlzcGxheS53aGVlbFN0YXJ0WCA9IGRpc3BsYXkud2hlZWxTdGFydFkgPSBudWxsO1xuXG4gICAgLy8gUHJvcGFnYXRlIHRoZSBzY3JvbGwgcG9zaXRpb24gdG8gdGhlIGFjdHVhbCBET00gc2Nyb2xsZXJcbiAgICBpZiAob3Auc2Nyb2xsVG9wICE9IG51bGwgJiYgKGRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsVG9wICE9IG9wLnNjcm9sbFRvcCB8fCBvcC5mb3JjZVNjcm9sbCkpIHtcbiAgICAgIGRvYy5zY3JvbGxUb3AgPSBNYXRoLm1heCgwLCBNYXRoLm1pbihkaXNwbGF5LnNjcm9sbGVyLnNjcm9sbEhlaWdodCAtIGRpc3BsYXkuc2Nyb2xsZXIuY2xpZW50SGVpZ2h0LCBvcC5zY3JvbGxUb3ApKTtcbiAgICAgIGRpc3BsYXkuc2Nyb2xsYmFycy5zZXRTY3JvbGxUb3AoZG9jLnNjcm9sbFRvcCk7XG4gICAgICBkaXNwbGF5LnNjcm9sbGVyLnNjcm9sbFRvcCA9IGRvYy5zY3JvbGxUb3A7XG4gICAgfVxuICAgIGlmIChvcC5zY3JvbGxMZWZ0ICE9IG51bGwgJiYgKGRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsTGVmdCAhPSBvcC5zY3JvbGxMZWZ0IHx8IG9wLmZvcmNlU2Nyb2xsKSkge1xuICAgICAgZG9jLnNjcm9sbExlZnQgPSBNYXRoLm1heCgwLCBNYXRoLm1pbihkaXNwbGF5LnNjcm9sbGVyLnNjcm9sbFdpZHRoIC0gZGlzcGxheVdpZHRoKGNtKSwgb3Auc2Nyb2xsTGVmdCkpO1xuICAgICAgZGlzcGxheS5zY3JvbGxiYXJzLnNldFNjcm9sbExlZnQoZG9jLnNjcm9sbExlZnQpO1xuICAgICAgZGlzcGxheS5zY3JvbGxlci5zY3JvbGxMZWZ0ID0gZG9jLnNjcm9sbExlZnQ7XG4gICAgICBhbGlnbkhvcml6b250YWxseShjbSk7XG4gICAgfVxuICAgIC8vIElmIHdlIG5lZWQgdG8gc2Nyb2xsIGEgc3BlY2lmaWMgcG9zaXRpb24gaW50byB2aWV3LCBkbyBzby5cbiAgICBpZiAob3Auc2Nyb2xsVG9Qb3MpIHtcbiAgICAgIHZhciBjb29yZHMgPSBzY3JvbGxQb3NJbnRvVmlldyhjbSwgY2xpcFBvcyhkb2MsIG9wLnNjcm9sbFRvUG9zLmZyb20pLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaXBQb3MoZG9jLCBvcC5zY3JvbGxUb1Bvcy50byksIG9wLnNjcm9sbFRvUG9zLm1hcmdpbik7XG4gICAgICBpZiAob3Auc2Nyb2xsVG9Qb3MuaXNDdXJzb3IgJiYgY20uc3RhdGUuZm9jdXNlZCkgbWF5YmVTY3JvbGxXaW5kb3coY20sIGNvb3Jkcyk7XG4gICAgfVxuXG4gICAgLy8gRmlyZSBldmVudHMgZm9yIG1hcmtlcnMgdGhhdCBhcmUgaGlkZGVuL3VuaWRkZW4gYnkgZWRpdGluZyBvclxuICAgIC8vIHVuZG9pbmdcbiAgICB2YXIgaGlkZGVuID0gb3AubWF5YmVIaWRkZW5NYXJrZXJzLCB1bmhpZGRlbiA9IG9wLm1heWJlVW5oaWRkZW5NYXJrZXJzO1xuICAgIGlmIChoaWRkZW4pIGZvciAodmFyIGkgPSAwOyBpIDwgaGlkZGVuLmxlbmd0aDsgKytpKVxuICAgICAgaWYgKCFoaWRkZW5baV0ubGluZXMubGVuZ3RoKSBzaWduYWwoaGlkZGVuW2ldLCBcImhpZGVcIik7XG4gICAgaWYgKHVuaGlkZGVuKSBmb3IgKHZhciBpID0gMDsgaSA8IHVuaGlkZGVuLmxlbmd0aDsgKytpKVxuICAgICAgaWYgKHVuaGlkZGVuW2ldLmxpbmVzLmxlbmd0aCkgc2lnbmFsKHVuaGlkZGVuW2ldLCBcInVuaGlkZVwiKTtcblxuICAgIGlmIChkaXNwbGF5LndyYXBwZXIub2Zmc2V0SGVpZ2h0KVxuICAgICAgZG9jLnNjcm9sbFRvcCA9IGNtLmRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsVG9wO1xuXG4gICAgLy8gRmlyZSBjaGFuZ2UgZXZlbnRzLCBhbmQgZGVsYXllZCBldmVudCBoYW5kbGVyc1xuICAgIGlmIChvcC5jaGFuZ2VPYmpzKVxuICAgICAgc2lnbmFsKGNtLCBcImNoYW5nZXNcIiwgY20sIG9wLmNoYW5nZU9ianMpO1xuICAgIGlmIChvcC51cGRhdGUpXG4gICAgICBvcC51cGRhdGUuZmluaXNoKCk7XG4gIH1cblxuICAvLyBSdW4gdGhlIGdpdmVuIGZ1bmN0aW9uIGluIGFuIG9wZXJhdGlvblxuICBmdW5jdGlvbiBydW5Jbk9wKGNtLCBmKSB7XG4gICAgaWYgKGNtLmN1ck9wKSByZXR1cm4gZigpO1xuICAgIHN0YXJ0T3BlcmF0aW9uKGNtKTtcbiAgICB0cnkgeyByZXR1cm4gZigpOyB9XG4gICAgZmluYWxseSB7IGVuZE9wZXJhdGlvbihjbSk7IH1cbiAgfVxuICAvLyBXcmFwcyBhIGZ1bmN0aW9uIGluIGFuIG9wZXJhdGlvbi4gUmV0dXJucyB0aGUgd3JhcHBlZCBmdW5jdGlvbi5cbiAgZnVuY3Rpb24gb3BlcmF0aW9uKGNtLCBmKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKGNtLmN1ck9wKSByZXR1cm4gZi5hcHBseShjbSwgYXJndW1lbnRzKTtcbiAgICAgIHN0YXJ0T3BlcmF0aW9uKGNtKTtcbiAgICAgIHRyeSB7IHJldHVybiBmLmFwcGx5KGNtLCBhcmd1bWVudHMpOyB9XG4gICAgICBmaW5hbGx5IHsgZW5kT3BlcmF0aW9uKGNtKTsgfVxuICAgIH07XG4gIH1cbiAgLy8gVXNlZCB0byBhZGQgbWV0aG9kcyB0byBlZGl0b3IgYW5kIGRvYyBpbnN0YW5jZXMsIHdyYXBwaW5nIHRoZW0gaW5cbiAgLy8gb3BlcmF0aW9ucy5cbiAgZnVuY3Rpb24gbWV0aG9kT3AoZikge1xuICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLmN1ck9wKSByZXR1cm4gZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgc3RhcnRPcGVyYXRpb24odGhpcyk7XG4gICAgICB0cnkgeyByZXR1cm4gZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9XG4gICAgICBmaW5hbGx5IHsgZW5kT3BlcmF0aW9uKHRoaXMpOyB9XG4gICAgfTtcbiAgfVxuICBmdW5jdGlvbiBkb2NNZXRob2RPcChmKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGNtID0gdGhpcy5jbTtcbiAgICAgIGlmICghY20gfHwgY20uY3VyT3ApIHJldHVybiBmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICBzdGFydE9wZXJhdGlvbihjbSk7XG4gICAgICB0cnkgeyByZXR1cm4gZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpOyB9XG4gICAgICBmaW5hbGx5IHsgZW5kT3BlcmF0aW9uKGNtKTsgfVxuICAgIH07XG4gIH1cblxuICAvLyBWSUVXIFRSQUNLSU5HXG5cbiAgLy8gVGhlc2Ugb2JqZWN0cyBhcmUgdXNlZCB0byByZXByZXNlbnQgdGhlIHZpc2libGUgKGN1cnJlbnRseSBkcmF3bilcbiAgLy8gcGFydCBvZiB0aGUgZG9jdW1lbnQuIEEgTGluZVZpZXcgbWF5IGNvcnJlc3BvbmQgdG8gbXVsdGlwbGVcbiAgLy8gbG9naWNhbCBsaW5lcywgaWYgdGhvc2UgYXJlIGNvbm5lY3RlZCBieSBjb2xsYXBzZWQgcmFuZ2VzLlxuICBmdW5jdGlvbiBMaW5lVmlldyhkb2MsIGxpbmUsIGxpbmVOKSB7XG4gICAgLy8gVGhlIHN0YXJ0aW5nIGxpbmVcbiAgICB0aGlzLmxpbmUgPSBsaW5lO1xuICAgIC8vIENvbnRpbnVpbmcgbGluZXMsIGlmIGFueVxuICAgIHRoaXMucmVzdCA9IHZpc3VhbExpbmVDb250aW51ZWQobGluZSk7XG4gICAgLy8gTnVtYmVyIG9mIGxvZ2ljYWwgbGluZXMgaW4gdGhpcyB2aXN1YWwgbGluZVxuICAgIHRoaXMuc2l6ZSA9IHRoaXMucmVzdCA/IGxpbmVObyhsc3QodGhpcy5yZXN0KSkgLSBsaW5lTiArIDEgOiAxO1xuICAgIHRoaXMubm9kZSA9IHRoaXMudGV4dCA9IG51bGw7XG4gICAgdGhpcy5oaWRkZW4gPSBsaW5lSXNIaWRkZW4oZG9jLCBsaW5lKTtcbiAgfVxuXG4gIC8vIENyZWF0ZSBhIHJhbmdlIG9mIExpbmVWaWV3IG9iamVjdHMgZm9yIHRoZSBnaXZlbiBsaW5lcy5cbiAgZnVuY3Rpb24gYnVpbGRWaWV3QXJyYXkoY20sIGZyb20sIHRvKSB7XG4gICAgdmFyIGFycmF5ID0gW10sIG5leHRQb3M7XG4gICAgZm9yICh2YXIgcG9zID0gZnJvbTsgcG9zIDwgdG87IHBvcyA9IG5leHRQb3MpIHtcbiAgICAgIHZhciB2aWV3ID0gbmV3IExpbmVWaWV3KGNtLmRvYywgZ2V0TGluZShjbS5kb2MsIHBvcyksIHBvcyk7XG4gICAgICBuZXh0UG9zID0gcG9zICsgdmlldy5zaXplO1xuICAgICAgYXJyYXkucHVzaCh2aWV3KTtcbiAgICB9XG4gICAgcmV0dXJuIGFycmF5O1xuICB9XG5cbiAgLy8gVXBkYXRlcyB0aGUgZGlzcGxheS52aWV3IGRhdGEgc3RydWN0dXJlIGZvciBhIGdpdmVuIGNoYW5nZSB0byB0aGVcbiAgLy8gZG9jdW1lbnQuIEZyb20gYW5kIHRvIGFyZSBpbiBwcmUtY2hhbmdlIGNvb3JkaW5hdGVzLiBMZW5kaWZmIGlzXG4gIC8vIHRoZSBhbW91bnQgb2YgbGluZXMgYWRkZWQgb3Igc3VidHJhY3RlZCBieSB0aGUgY2hhbmdlLiBUaGlzIGlzXG4gIC8vIHVzZWQgZm9yIGNoYW5nZXMgdGhhdCBzcGFuIG11bHRpcGxlIGxpbmVzLCBvciBjaGFuZ2UgdGhlIHdheVxuICAvLyBsaW5lcyBhcmUgZGl2aWRlZCBpbnRvIHZpc3VhbCBsaW5lcy4gcmVnTGluZUNoYW5nZSAoYmVsb3cpXG4gIC8vIHJlZ2lzdGVycyBzaW5nbGUtbGluZSBjaGFuZ2VzLlxuICBmdW5jdGlvbiByZWdDaGFuZ2UoY20sIGZyb20sIHRvLCBsZW5kaWZmKSB7XG4gICAgaWYgKGZyb20gPT0gbnVsbCkgZnJvbSA9IGNtLmRvYy5maXJzdDtcbiAgICBpZiAodG8gPT0gbnVsbCkgdG8gPSBjbS5kb2MuZmlyc3QgKyBjbS5kb2Muc2l6ZTtcbiAgICBpZiAoIWxlbmRpZmYpIGxlbmRpZmYgPSAwO1xuXG4gICAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5O1xuICAgIGlmIChsZW5kaWZmICYmIHRvIDwgZGlzcGxheS52aWV3VG8gJiZcbiAgICAgICAgKGRpc3BsYXkudXBkYXRlTGluZU51bWJlcnMgPT0gbnVsbCB8fCBkaXNwbGF5LnVwZGF0ZUxpbmVOdW1iZXJzID4gZnJvbSkpXG4gICAgICBkaXNwbGF5LnVwZGF0ZUxpbmVOdW1iZXJzID0gZnJvbTtcblxuICAgIGNtLmN1ck9wLnZpZXdDaGFuZ2VkID0gdHJ1ZTtcblxuICAgIGlmIChmcm9tID49IGRpc3BsYXkudmlld1RvKSB7IC8vIENoYW5nZSBhZnRlclxuICAgICAgaWYgKHNhd0NvbGxhcHNlZFNwYW5zICYmIHZpc3VhbExpbmVObyhjbS5kb2MsIGZyb20pIDwgZGlzcGxheS52aWV3VG8pXG4gICAgICAgIHJlc2V0VmlldyhjbSk7XG4gICAgfSBlbHNlIGlmICh0byA8PSBkaXNwbGF5LnZpZXdGcm9tKSB7IC8vIENoYW5nZSBiZWZvcmVcbiAgICAgIGlmIChzYXdDb2xsYXBzZWRTcGFucyAmJiB2aXN1YWxMaW5lRW5kTm8oY20uZG9jLCB0byArIGxlbmRpZmYpID4gZGlzcGxheS52aWV3RnJvbSkge1xuICAgICAgICByZXNldFZpZXcoY20pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGlzcGxheS52aWV3RnJvbSArPSBsZW5kaWZmO1xuICAgICAgICBkaXNwbGF5LnZpZXdUbyArPSBsZW5kaWZmO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZnJvbSA8PSBkaXNwbGF5LnZpZXdGcm9tICYmIHRvID49IGRpc3BsYXkudmlld1RvKSB7IC8vIEZ1bGwgb3ZlcmxhcFxuICAgICAgcmVzZXRWaWV3KGNtKTtcbiAgICB9IGVsc2UgaWYgKGZyb20gPD0gZGlzcGxheS52aWV3RnJvbSkgeyAvLyBUb3Agb3ZlcmxhcFxuICAgICAgdmFyIGN1dCA9IHZpZXdDdXR0aW5nUG9pbnQoY20sIHRvLCB0byArIGxlbmRpZmYsIDEpO1xuICAgICAgaWYgKGN1dCkge1xuICAgICAgICBkaXNwbGF5LnZpZXcgPSBkaXNwbGF5LnZpZXcuc2xpY2UoY3V0LmluZGV4KTtcbiAgICAgICAgZGlzcGxheS52aWV3RnJvbSA9IGN1dC5saW5lTjtcbiAgICAgICAgZGlzcGxheS52aWV3VG8gKz0gbGVuZGlmZjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJlc2V0VmlldyhjbSk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0byA+PSBkaXNwbGF5LnZpZXdUbykgeyAvLyBCb3R0b20gb3ZlcmxhcFxuICAgICAgdmFyIGN1dCA9IHZpZXdDdXR0aW5nUG9pbnQoY20sIGZyb20sIGZyb20sIC0xKTtcbiAgICAgIGlmIChjdXQpIHtcbiAgICAgICAgZGlzcGxheS52aWV3ID0gZGlzcGxheS52aWV3LnNsaWNlKDAsIGN1dC5pbmRleCk7XG4gICAgICAgIGRpc3BsYXkudmlld1RvID0gY3V0LmxpbmVOO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzZXRWaWV3KGNtKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgeyAvLyBHYXAgaW4gdGhlIG1pZGRsZVxuICAgICAgdmFyIGN1dFRvcCA9IHZpZXdDdXR0aW5nUG9pbnQoY20sIGZyb20sIGZyb20sIC0xKTtcbiAgICAgIHZhciBjdXRCb3QgPSB2aWV3Q3V0dGluZ1BvaW50KGNtLCB0bywgdG8gKyBsZW5kaWZmLCAxKTtcbiAgICAgIGlmIChjdXRUb3AgJiYgY3V0Qm90KSB7XG4gICAgICAgIGRpc3BsYXkudmlldyA9IGRpc3BsYXkudmlldy5zbGljZSgwLCBjdXRUb3AuaW5kZXgpXG4gICAgICAgICAgLmNvbmNhdChidWlsZFZpZXdBcnJheShjbSwgY3V0VG9wLmxpbmVOLCBjdXRCb3QubGluZU4pKVxuICAgICAgICAgIC5jb25jYXQoZGlzcGxheS52aWV3LnNsaWNlKGN1dEJvdC5pbmRleCkpO1xuICAgICAgICBkaXNwbGF5LnZpZXdUbyArPSBsZW5kaWZmO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzZXRWaWV3KGNtKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgZXh0ID0gZGlzcGxheS5leHRlcm5hbE1lYXN1cmVkO1xuICAgIGlmIChleHQpIHtcbiAgICAgIGlmICh0byA8IGV4dC5saW5lTilcbiAgICAgICAgZXh0LmxpbmVOICs9IGxlbmRpZmY7XG4gICAgICBlbHNlIGlmIChmcm9tIDwgZXh0LmxpbmVOICsgZXh0LnNpemUpXG4gICAgICAgIGRpc3BsYXkuZXh0ZXJuYWxNZWFzdXJlZCA9IG51bGw7XG4gICAgfVxuICB9XG5cbiAgLy8gUmVnaXN0ZXIgYSBjaGFuZ2UgdG8gYSBzaW5nbGUgbGluZS4gVHlwZSBtdXN0IGJlIG9uZSBvZiBcInRleHRcIixcbiAgLy8gXCJndXR0ZXJcIiwgXCJjbGFzc1wiLCBcIndpZGdldFwiXG4gIGZ1bmN0aW9uIHJlZ0xpbmVDaGFuZ2UoY20sIGxpbmUsIHR5cGUpIHtcbiAgICBjbS5jdXJPcC52aWV3Q2hhbmdlZCA9IHRydWU7XG4gICAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCBleHQgPSBjbS5kaXNwbGF5LmV4dGVybmFsTWVhc3VyZWQ7XG4gICAgaWYgKGV4dCAmJiBsaW5lID49IGV4dC5saW5lTiAmJiBsaW5lIDwgZXh0LmxpbmVOICsgZXh0LnNpemUpXG4gICAgICBkaXNwbGF5LmV4dGVybmFsTWVhc3VyZWQgPSBudWxsO1xuXG4gICAgaWYgKGxpbmUgPCBkaXNwbGF5LnZpZXdGcm9tIHx8IGxpbmUgPj0gZGlzcGxheS52aWV3VG8pIHJldHVybjtcbiAgICB2YXIgbGluZVZpZXcgPSBkaXNwbGF5LnZpZXdbZmluZFZpZXdJbmRleChjbSwgbGluZSldO1xuICAgIGlmIChsaW5lVmlldy5ub2RlID09IG51bGwpIHJldHVybjtcbiAgICB2YXIgYXJyID0gbGluZVZpZXcuY2hhbmdlcyB8fCAobGluZVZpZXcuY2hhbmdlcyA9IFtdKTtcbiAgICBpZiAoaW5kZXhPZihhcnIsIHR5cGUpID09IC0xKSBhcnIucHVzaCh0eXBlKTtcbiAgfVxuXG4gIC8vIENsZWFyIHRoZSB2aWV3LlxuICBmdW5jdGlvbiByZXNldFZpZXcoY20pIHtcbiAgICBjbS5kaXNwbGF5LnZpZXdGcm9tID0gY20uZGlzcGxheS52aWV3VG8gPSBjbS5kb2MuZmlyc3Q7XG4gICAgY20uZGlzcGxheS52aWV3ID0gW107XG4gICAgY20uZGlzcGxheS52aWV3T2Zmc2V0ID0gMDtcbiAgfVxuXG4gIC8vIEZpbmQgdGhlIHZpZXcgZWxlbWVudCBjb3JyZXNwb25kaW5nIHRvIGEgZ2l2ZW4gbGluZS4gUmV0dXJuIG51bGxcbiAgLy8gd2hlbiB0aGUgbGluZSBpc24ndCB2aXNpYmxlLlxuICBmdW5jdGlvbiBmaW5kVmlld0luZGV4KGNtLCBuKSB7XG4gICAgaWYgKG4gPj0gY20uZGlzcGxheS52aWV3VG8pIHJldHVybiBudWxsO1xuICAgIG4gLT0gY20uZGlzcGxheS52aWV3RnJvbTtcbiAgICBpZiAobiA8IDApIHJldHVybiBudWxsO1xuICAgIHZhciB2aWV3ID0gY20uZGlzcGxheS52aWV3O1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmlldy5sZW5ndGg7IGkrKykge1xuICAgICAgbiAtPSB2aWV3W2ldLnNpemU7XG4gICAgICBpZiAobiA8IDApIHJldHVybiBpO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIHZpZXdDdXR0aW5nUG9pbnQoY20sIG9sZE4sIG5ld04sIGRpcikge1xuICAgIHZhciBpbmRleCA9IGZpbmRWaWV3SW5kZXgoY20sIG9sZE4pLCBkaWZmLCB2aWV3ID0gY20uZGlzcGxheS52aWV3O1xuICAgIGlmICghc2F3Q29sbGFwc2VkU3BhbnMgfHwgbmV3TiA9PSBjbS5kb2MuZmlyc3QgKyBjbS5kb2Muc2l6ZSlcbiAgICAgIHJldHVybiB7aW5kZXg6IGluZGV4LCBsaW5lTjogbmV3Tn07XG4gICAgZm9yICh2YXIgaSA9IDAsIG4gPSBjbS5kaXNwbGF5LnZpZXdGcm9tOyBpIDwgaW5kZXg7IGkrKylcbiAgICAgIG4gKz0gdmlld1tpXS5zaXplO1xuICAgIGlmIChuICE9IG9sZE4pIHtcbiAgICAgIGlmIChkaXIgPiAwKSB7XG4gICAgICAgIGlmIChpbmRleCA9PSB2aWV3Lmxlbmd0aCAtIDEpIHJldHVybiBudWxsO1xuICAgICAgICBkaWZmID0gKG4gKyB2aWV3W2luZGV4XS5zaXplKSAtIG9sZE47XG4gICAgICAgIGluZGV4Kys7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkaWZmID0gbiAtIG9sZE47XG4gICAgICB9XG4gICAgICBvbGROICs9IGRpZmY7IG5ld04gKz0gZGlmZjtcbiAgICB9XG4gICAgd2hpbGUgKHZpc3VhbExpbmVObyhjbS5kb2MsIG5ld04pICE9IG5ld04pIHtcbiAgICAgIGlmIChpbmRleCA9PSAoZGlyIDwgMCA/IDAgOiB2aWV3Lmxlbmd0aCAtIDEpKSByZXR1cm4gbnVsbDtcbiAgICAgIG5ld04gKz0gZGlyICogdmlld1tpbmRleCAtIChkaXIgPCAwID8gMSA6IDApXS5zaXplO1xuICAgICAgaW5kZXggKz0gZGlyO1xuICAgIH1cbiAgICByZXR1cm4ge2luZGV4OiBpbmRleCwgbGluZU46IG5ld059O1xuICB9XG5cbiAgLy8gRm9yY2UgdGhlIHZpZXcgdG8gY292ZXIgYSBnaXZlbiByYW5nZSwgYWRkaW5nIGVtcHR5IHZpZXcgZWxlbWVudFxuICAvLyBvciBjbGlwcGluZyBvZmYgZXhpc3Rpbmcgb25lcyBhcyBuZWVkZWQuXG4gIGZ1bmN0aW9uIGFkanVzdFZpZXcoY20sIGZyb20sIHRvKSB7XG4gICAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCB2aWV3ID0gZGlzcGxheS52aWV3O1xuICAgIGlmICh2aWV3Lmxlbmd0aCA9PSAwIHx8IGZyb20gPj0gZGlzcGxheS52aWV3VG8gfHwgdG8gPD0gZGlzcGxheS52aWV3RnJvbSkge1xuICAgICAgZGlzcGxheS52aWV3ID0gYnVpbGRWaWV3QXJyYXkoY20sIGZyb20sIHRvKTtcbiAgICAgIGRpc3BsYXkudmlld0Zyb20gPSBmcm9tO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoZGlzcGxheS52aWV3RnJvbSA+IGZyb20pXG4gICAgICAgIGRpc3BsYXkudmlldyA9IGJ1aWxkVmlld0FycmF5KGNtLCBmcm9tLCBkaXNwbGF5LnZpZXdGcm9tKS5jb25jYXQoZGlzcGxheS52aWV3KTtcbiAgICAgIGVsc2UgaWYgKGRpc3BsYXkudmlld0Zyb20gPCBmcm9tKVxuICAgICAgICBkaXNwbGF5LnZpZXcgPSBkaXNwbGF5LnZpZXcuc2xpY2UoZmluZFZpZXdJbmRleChjbSwgZnJvbSkpO1xuICAgICAgZGlzcGxheS52aWV3RnJvbSA9IGZyb207XG4gICAgICBpZiAoZGlzcGxheS52aWV3VG8gPCB0bylcbiAgICAgICAgZGlzcGxheS52aWV3ID0gZGlzcGxheS52aWV3LmNvbmNhdChidWlsZFZpZXdBcnJheShjbSwgZGlzcGxheS52aWV3VG8sIHRvKSk7XG4gICAgICBlbHNlIGlmIChkaXNwbGF5LnZpZXdUbyA+IHRvKVxuICAgICAgICBkaXNwbGF5LnZpZXcgPSBkaXNwbGF5LnZpZXcuc2xpY2UoMCwgZmluZFZpZXdJbmRleChjbSwgdG8pKTtcbiAgICB9XG4gICAgZGlzcGxheS52aWV3VG8gPSB0bztcbiAgfVxuXG4gIC8vIENvdW50IHRoZSBudW1iZXIgb2YgbGluZXMgaW4gdGhlIHZpZXcgd2hvc2UgRE9NIHJlcHJlc2VudGF0aW9uIGlzXG4gIC8vIG91dCBvZiBkYXRlIChvciBub25leGlzdGVudCkuXG4gIGZ1bmN0aW9uIGNvdW50RGlydHlWaWV3KGNtKSB7XG4gICAgdmFyIHZpZXcgPSBjbS5kaXNwbGF5LnZpZXcsIGRpcnR5ID0gMDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZpZXcubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBsaW5lVmlldyA9IHZpZXdbaV07XG4gICAgICBpZiAoIWxpbmVWaWV3LmhpZGRlbiAmJiAoIWxpbmVWaWV3Lm5vZGUgfHwgbGluZVZpZXcuY2hhbmdlcykpICsrZGlydHk7XG4gICAgfVxuICAgIHJldHVybiBkaXJ0eTtcbiAgfVxuXG4gIC8vIEVWRU5UIEhBTkRMRVJTXG5cbiAgLy8gQXR0YWNoIHRoZSBuZWNlc3NhcnkgZXZlbnQgaGFuZGxlcnMgd2hlbiBpbml0aWFsaXppbmcgdGhlIGVkaXRvclxuICBmdW5jdGlvbiByZWdpc3RlckV2ZW50SGFuZGxlcnMoY20pIHtcbiAgICB2YXIgZCA9IGNtLmRpc3BsYXk7XG4gICAgb24oZC5zY3JvbGxlciwgXCJtb3VzZWRvd25cIiwgb3BlcmF0aW9uKGNtLCBvbk1vdXNlRG93bikpO1xuICAgIC8vIE9sZGVyIElFJ3Mgd2lsbCBub3QgZmlyZSBhIHNlY29uZCBtb3VzZWRvd24gZm9yIGEgZG91YmxlIGNsaWNrXG4gICAgaWYgKGllICYmIGllX3ZlcnNpb24gPCAxMSlcbiAgICAgIG9uKGQuc2Nyb2xsZXIsIFwiZGJsY2xpY2tcIiwgb3BlcmF0aW9uKGNtLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmIChzaWduYWxET01FdmVudChjbSwgZSkpIHJldHVybjtcbiAgICAgICAgdmFyIHBvcyA9IHBvc0Zyb21Nb3VzZShjbSwgZSk7XG4gICAgICAgIGlmICghcG9zIHx8IGNsaWNrSW5HdXR0ZXIoY20sIGUpIHx8IGV2ZW50SW5XaWRnZXQoY20uZGlzcGxheSwgZSkpIHJldHVybjtcbiAgICAgICAgZV9wcmV2ZW50RGVmYXVsdChlKTtcbiAgICAgICAgdmFyIHdvcmQgPSBjbS5maW5kV29yZEF0KHBvcyk7XG4gICAgICAgIGV4dGVuZFNlbGVjdGlvbihjbS5kb2MsIHdvcmQuYW5jaG9yLCB3b3JkLmhlYWQpO1xuICAgICAgfSkpO1xuICAgIGVsc2VcbiAgICAgIG9uKGQuc2Nyb2xsZXIsIFwiZGJsY2xpY2tcIiwgZnVuY3Rpb24oZSkgeyBzaWduYWxET01FdmVudChjbSwgZSkgfHwgZV9wcmV2ZW50RGVmYXVsdChlKTsgfSk7XG4gICAgLy8gU29tZSBicm93c2VycyBmaXJlIGNvbnRleHRtZW51ICphZnRlciogb3BlbmluZyB0aGUgbWVudSwgYXRcbiAgICAvLyB3aGljaCBwb2ludCB3ZSBjYW4ndCBtZXNzIHdpdGggaXQgYW55bW9yZS4gQ29udGV4dCBtZW51IGlzXG4gICAgLy8gaGFuZGxlZCBpbiBvbk1vdXNlRG93biBmb3IgdGhlc2UgYnJvd3NlcnMuXG4gICAgaWYgKCFjYXB0dXJlUmlnaHRDbGljaykgb24oZC5zY3JvbGxlciwgXCJjb250ZXh0bWVudVwiLCBmdW5jdGlvbihlKSB7b25Db250ZXh0TWVudShjbSwgZSk7fSk7XG5cbiAgICAvLyBVc2VkIHRvIHN1cHByZXNzIG1vdXNlIGV2ZW50IGhhbmRsaW5nIHdoZW4gYSB0b3VjaCBoYXBwZW5zXG4gICAgdmFyIHRvdWNoRmluaXNoZWQsIHByZXZUb3VjaCA9IHtlbmQ6IDB9O1xuICAgIGZ1bmN0aW9uIGZpbmlzaFRvdWNoKCkge1xuICAgICAgaWYgKGQuYWN0aXZlVG91Y2gpIHtcbiAgICAgICAgdG91Y2hGaW5pc2hlZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7ZC5hY3RpdmVUb3VjaCA9IG51bGw7fSwgMTAwMCk7XG4gICAgICAgIHByZXZUb3VjaCA9IGQuYWN0aXZlVG91Y2g7XG4gICAgICAgIHByZXZUb3VjaC5lbmQgPSArbmV3IERhdGU7XG4gICAgICB9XG4gICAgfTtcbiAgICBmdW5jdGlvbiBpc01vdXNlTGlrZVRvdWNoRXZlbnQoZSkge1xuICAgICAgaWYgKGUudG91Y2hlcy5sZW5ndGggIT0gMSkgcmV0dXJuIGZhbHNlO1xuICAgICAgdmFyIHRvdWNoID0gZS50b3VjaGVzWzBdO1xuICAgICAgcmV0dXJuIHRvdWNoLnJhZGl1c1ggPD0gMSAmJiB0b3VjaC5yYWRpdXNZIDw9IDE7XG4gICAgfVxuICAgIGZ1bmN0aW9uIGZhckF3YXkodG91Y2gsIG90aGVyKSB7XG4gICAgICBpZiAob3RoZXIubGVmdCA9PSBudWxsKSByZXR1cm4gdHJ1ZTtcbiAgICAgIHZhciBkeCA9IG90aGVyLmxlZnQgLSB0b3VjaC5sZWZ0LCBkeSA9IG90aGVyLnRvcCAtIHRvdWNoLnRvcDtcbiAgICAgIHJldHVybiBkeCAqIGR4ICsgZHkgKiBkeSA+IDIwICogMjA7XG4gICAgfVxuICAgIG9uKGQuc2Nyb2xsZXIsIFwidG91Y2hzdGFydFwiLCBmdW5jdGlvbihlKSB7XG4gICAgICBpZiAoIWlzTW91c2VMaWtlVG91Y2hFdmVudChlKSkge1xuICAgICAgICBjbGVhclRpbWVvdXQodG91Y2hGaW5pc2hlZCk7XG4gICAgICAgIHZhciBub3cgPSArbmV3IERhdGU7XG4gICAgICAgIGQuYWN0aXZlVG91Y2ggPSB7c3RhcnQ6IG5vdywgbW92ZWQ6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgIHByZXY6IG5vdyAtIHByZXZUb3VjaC5lbmQgPD0gMzAwID8gcHJldlRvdWNoIDogbnVsbH07XG4gICAgICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoID09IDEpIHtcbiAgICAgICAgICBkLmFjdGl2ZVRvdWNoLmxlZnQgPSBlLnRvdWNoZXNbMF0ucGFnZVg7XG4gICAgICAgICAgZC5hY3RpdmVUb3VjaC50b3AgPSBlLnRvdWNoZXNbMF0ucGFnZVk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgICBvbihkLnNjcm9sbGVyLCBcInRvdWNobW92ZVwiLCBmdW5jdGlvbigpIHtcbiAgICAgIGlmIChkLmFjdGl2ZVRvdWNoKSBkLmFjdGl2ZVRvdWNoLm1vdmVkID0gdHJ1ZTtcbiAgICB9KTtcbiAgICBvbihkLnNjcm9sbGVyLCBcInRvdWNoZW5kXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgIHZhciB0b3VjaCA9IGQuYWN0aXZlVG91Y2g7XG4gICAgICBpZiAodG91Y2ggJiYgIWV2ZW50SW5XaWRnZXQoZCwgZSkgJiYgdG91Y2gubGVmdCAhPSBudWxsICYmXG4gICAgICAgICAgIXRvdWNoLm1vdmVkICYmIG5ldyBEYXRlIC0gdG91Y2guc3RhcnQgPCAzMDApIHtcbiAgICAgICAgdmFyIHBvcyA9IGNtLmNvb3Jkc0NoYXIoZC5hY3RpdmVUb3VjaCwgXCJwYWdlXCIpLCByYW5nZTtcbiAgICAgICAgaWYgKCF0b3VjaC5wcmV2IHx8IGZhckF3YXkodG91Y2gsIHRvdWNoLnByZXYpKSAvLyBTaW5nbGUgdGFwXG4gICAgICAgICAgcmFuZ2UgPSBuZXcgUmFuZ2UocG9zLCBwb3MpO1xuICAgICAgICBlbHNlIGlmICghdG91Y2gucHJldi5wcmV2IHx8IGZhckF3YXkodG91Y2gsIHRvdWNoLnByZXYucHJldikpIC8vIERvdWJsZSB0YXBcbiAgICAgICAgICByYW5nZSA9IGNtLmZpbmRXb3JkQXQocG9zKTtcbiAgICAgICAgZWxzZSAvLyBUcmlwbGUgdGFwXG4gICAgICAgICAgcmFuZ2UgPSBuZXcgUmFuZ2UoUG9zKHBvcy5saW5lLCAwKSwgY2xpcFBvcyhjbS5kb2MsIFBvcyhwb3MubGluZSArIDEsIDApKSk7XG4gICAgICAgIGNtLnNldFNlbGVjdGlvbihyYW5nZS5hbmNob3IsIHJhbmdlLmhlYWQpO1xuICAgICAgICBjbS5mb2N1cygpO1xuICAgICAgICBlX3ByZXZlbnREZWZhdWx0KGUpO1xuICAgICAgfVxuICAgICAgZmluaXNoVG91Y2goKTtcbiAgICB9KTtcbiAgICBvbihkLnNjcm9sbGVyLCBcInRvdWNoY2FuY2VsXCIsIGZpbmlzaFRvdWNoKTtcblxuICAgIC8vIFN5bmMgc2Nyb2xsaW5nIGJldHdlZW4gZmFrZSBzY3JvbGxiYXJzIGFuZCByZWFsIHNjcm9sbGFibGVcbiAgICAvLyBhcmVhLCBlbnN1cmUgdmlld3BvcnQgaXMgdXBkYXRlZCB3aGVuIHNjcm9sbGluZy5cbiAgICBvbihkLnNjcm9sbGVyLCBcInNjcm9sbFwiLCBmdW5jdGlvbigpIHtcbiAgICAgIGlmIChkLnNjcm9sbGVyLmNsaWVudEhlaWdodCkge1xuICAgICAgICBzZXRTY3JvbGxUb3AoY20sIGQuc2Nyb2xsZXIuc2Nyb2xsVG9wKTtcbiAgICAgICAgc2V0U2Nyb2xsTGVmdChjbSwgZC5zY3JvbGxlci5zY3JvbGxMZWZ0LCB0cnVlKTtcbiAgICAgICAgc2lnbmFsKGNtLCBcInNjcm9sbFwiLCBjbSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBMaXN0ZW4gdG8gd2hlZWwgZXZlbnRzIGluIG9yZGVyIHRvIHRyeSBhbmQgdXBkYXRlIHRoZSB2aWV3cG9ydCBvbiB0aW1lLlxuICAgIG9uKGQuc2Nyb2xsZXIsIFwibW91c2V3aGVlbFwiLCBmdW5jdGlvbihlKXtvblNjcm9sbFdoZWVsKGNtLCBlKTt9KTtcbiAgICBvbihkLnNjcm9sbGVyLCBcIkRPTU1vdXNlU2Nyb2xsXCIsIGZ1bmN0aW9uKGUpe29uU2Nyb2xsV2hlZWwoY20sIGUpO30pO1xuXG4gICAgLy8gUHJldmVudCB3cmFwcGVyIGZyb20gZXZlciBzY3JvbGxpbmdcbiAgICBvbihkLndyYXBwZXIsIFwic2Nyb2xsXCIsIGZ1bmN0aW9uKCkgeyBkLndyYXBwZXIuc2Nyb2xsVG9wID0gZC53cmFwcGVyLnNjcm9sbExlZnQgPSAwOyB9KTtcblxuICAgIGQuZHJhZ0Z1bmN0aW9ucyA9IHtcbiAgICAgIGVudGVyOiBmdW5jdGlvbihlKSB7aWYgKCFzaWduYWxET01FdmVudChjbSwgZSkpIGVfc3RvcChlKTt9LFxuICAgICAgb3ZlcjogZnVuY3Rpb24oZSkge2lmICghc2lnbmFsRE9NRXZlbnQoY20sIGUpKSB7IG9uRHJhZ092ZXIoY20sIGUpOyBlX3N0b3AoZSk7IH19LFxuICAgICAgc3RhcnQ6IGZ1bmN0aW9uKGUpe29uRHJhZ1N0YXJ0KGNtLCBlKTt9LFxuICAgICAgZHJvcDogb3BlcmF0aW9uKGNtLCBvbkRyb3ApLFxuICAgICAgbGVhdmU6IGZ1bmN0aW9uKCkge2NsZWFyRHJhZ0N1cnNvcihjbSk7fVxuICAgIH07XG5cbiAgICB2YXIgaW5wID0gZC5pbnB1dC5nZXRGaWVsZCgpO1xuICAgIG9uKGlucCwgXCJrZXl1cFwiLCBmdW5jdGlvbihlKSB7IG9uS2V5VXAuY2FsbChjbSwgZSk7IH0pO1xuICAgIG9uKGlucCwgXCJrZXlkb3duXCIsIG9wZXJhdGlvbihjbSwgb25LZXlEb3duKSk7XG4gICAgb24oaW5wLCBcImtleXByZXNzXCIsIG9wZXJhdGlvbihjbSwgb25LZXlQcmVzcykpO1xuICAgIG9uKGlucCwgXCJmb2N1c1wiLCBiaW5kKG9uRm9jdXMsIGNtKSk7XG4gICAgb24oaW5wLCBcImJsdXJcIiwgYmluZChvbkJsdXIsIGNtKSk7XG4gIH1cblxuICBmdW5jdGlvbiBkcmFnRHJvcENoYW5nZWQoY20sIHZhbHVlLCBvbGQpIHtcbiAgICB2YXIgd2FzT24gPSBvbGQgJiYgb2xkICE9IENvZGVNaXJyb3IuSW5pdDtcbiAgICBpZiAoIXZhbHVlICE9ICF3YXNPbikge1xuICAgICAgdmFyIGZ1bmNzID0gY20uZGlzcGxheS5kcmFnRnVuY3Rpb25zO1xuICAgICAgdmFyIHRvZ2dsZSA9IHZhbHVlID8gb24gOiBvZmY7XG4gICAgICB0b2dnbGUoY20uZGlzcGxheS5zY3JvbGxlciwgXCJkcmFnc3RhcnRcIiwgZnVuY3Muc3RhcnQpO1xuICAgICAgdG9nZ2xlKGNtLmRpc3BsYXkuc2Nyb2xsZXIsIFwiZHJhZ2VudGVyXCIsIGZ1bmNzLmVudGVyKTtcbiAgICAgIHRvZ2dsZShjbS5kaXNwbGF5LnNjcm9sbGVyLCBcImRyYWdvdmVyXCIsIGZ1bmNzLm92ZXIpO1xuICAgICAgdG9nZ2xlKGNtLmRpc3BsYXkuc2Nyb2xsZXIsIFwiZHJhZ2xlYXZlXCIsIGZ1bmNzLmxlYXZlKTtcbiAgICAgIHRvZ2dsZShjbS5kaXNwbGF5LnNjcm9sbGVyLCBcImRyb3BcIiwgZnVuY3MuZHJvcCk7XG4gICAgfVxuICB9XG5cbiAgLy8gQ2FsbGVkIHdoZW4gdGhlIHdpbmRvdyByZXNpemVzXG4gIGZ1bmN0aW9uIG9uUmVzaXplKGNtKSB7XG4gICAgdmFyIGQgPSBjbS5kaXNwbGF5O1xuICAgIGlmIChkLmxhc3RXcmFwSGVpZ2h0ID09IGQud3JhcHBlci5jbGllbnRIZWlnaHQgJiYgZC5sYXN0V3JhcFdpZHRoID09IGQud3JhcHBlci5jbGllbnRXaWR0aClcbiAgICAgIHJldHVybjtcbiAgICAvLyBNaWdodCBiZSBhIHRleHQgc2NhbGluZyBvcGVyYXRpb24sIGNsZWFyIHNpemUgY2FjaGVzLlxuICAgIGQuY2FjaGVkQ2hhcldpZHRoID0gZC5jYWNoZWRUZXh0SGVpZ2h0ID0gZC5jYWNoZWRQYWRkaW5nSCA9IG51bGw7XG4gICAgZC5zY3JvbGxiYXJzQ2xpcHBlZCA9IGZhbHNlO1xuICAgIGNtLnNldFNpemUoKTtcbiAgfVxuXG4gIC8vIE1PVVNFIEVWRU5UU1xuXG4gIC8vIFJldHVybiB0cnVlIHdoZW4gdGhlIGdpdmVuIG1vdXNlIGV2ZW50IGhhcHBlbmVkIGluIGEgd2lkZ2V0XG4gIGZ1bmN0aW9uIGV2ZW50SW5XaWRnZXQoZGlzcGxheSwgZSkge1xuICAgIGZvciAodmFyIG4gPSBlX3RhcmdldChlKTsgbiAhPSBkaXNwbGF5LndyYXBwZXI7IG4gPSBuLnBhcmVudE5vZGUpIHtcbiAgICAgIGlmICghbiB8fCAobi5ub2RlVHlwZSA9PSAxICYmIG4uZ2V0QXR0cmlidXRlKFwiY20taWdub3JlLWV2ZW50c1wiKSA9PSBcInRydWVcIikgfHxcbiAgICAgICAgICAobi5wYXJlbnROb2RlID09IGRpc3BsYXkuc2l6ZXIgJiYgbiAhPSBkaXNwbGF5Lm1vdmVyKSlcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgLy8gR2l2ZW4gYSBtb3VzZSBldmVudCwgZmluZCB0aGUgY29ycmVzcG9uZGluZyBwb3NpdGlvbi4gSWYgbGliZXJhbFxuICAvLyBpcyBmYWxzZSwgaXQgY2hlY2tzIHdoZXRoZXIgYSBndXR0ZXIgb3Igc2Nyb2xsYmFyIHdhcyBjbGlja2VkLFxuICAvLyBhbmQgcmV0dXJucyBudWxsIGlmIGl0IHdhcy4gZm9yUmVjdCBpcyB1c2VkIGJ5IHJlY3Rhbmd1bGFyXG4gIC8vIHNlbGVjdGlvbnMsIGFuZCB0cmllcyB0byBlc3RpbWF0ZSBhIGNoYXJhY3RlciBwb3NpdGlvbiBldmVuIGZvclxuICAvLyBjb29yZGluYXRlcyBiZXlvbmQgdGhlIHJpZ2h0IG9mIHRoZSB0ZXh0LlxuICBmdW5jdGlvbiBwb3NGcm9tTW91c2UoY20sIGUsIGxpYmVyYWwsIGZvclJlY3QpIHtcbiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXk7XG4gICAgaWYgKCFsaWJlcmFsICYmIGVfdGFyZ2V0KGUpLmdldEF0dHJpYnV0ZShcImNtLW5vdC1jb250ZW50XCIpID09IFwidHJ1ZVwiKSByZXR1cm4gbnVsbDtcblxuICAgIHZhciB4LCB5LCBzcGFjZSA9IGRpc3BsYXkubGluZVNwYWNlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIC8vIEZhaWxzIHVucHJlZGljdGFibHkgb24gSUVbNjddIHdoZW4gbW91c2UgaXMgZHJhZ2dlZCBhcm91bmQgcXVpY2tseS5cbiAgICB0cnkgeyB4ID0gZS5jbGllbnRYIC0gc3BhY2UubGVmdDsgeSA9IGUuY2xpZW50WSAtIHNwYWNlLnRvcDsgfVxuICAgIGNhdGNoIChlKSB7IHJldHVybiBudWxsOyB9XG4gICAgdmFyIGNvb3JkcyA9IGNvb3Jkc0NoYXIoY20sIHgsIHkpLCBsaW5lO1xuICAgIGlmIChmb3JSZWN0ICYmIGNvb3Jkcy54UmVsID09IDEgJiYgKGxpbmUgPSBnZXRMaW5lKGNtLmRvYywgY29vcmRzLmxpbmUpLnRleHQpLmxlbmd0aCA9PSBjb29yZHMuY2gpIHtcbiAgICAgIHZhciBjb2xEaWZmID0gY291bnRDb2x1bW4obGluZSwgbGluZS5sZW5ndGgsIGNtLm9wdGlvbnMudGFiU2l6ZSkgLSBsaW5lLmxlbmd0aDtcbiAgICAgIGNvb3JkcyA9IFBvcyhjb29yZHMubGluZSwgTWF0aC5tYXgoMCwgTWF0aC5yb3VuZCgoeCAtIHBhZGRpbmdIKGNtLmRpc3BsYXkpLmxlZnQpIC8gY2hhcldpZHRoKGNtLmRpc3BsYXkpKSAtIGNvbERpZmYpKTtcbiAgICB9XG4gICAgcmV0dXJuIGNvb3JkcztcbiAgfVxuXG4gIC8vIEEgbW91c2UgZG93biBjYW4gYmUgYSBzaW5nbGUgY2xpY2ssIGRvdWJsZSBjbGljaywgdHJpcGxlIGNsaWNrLFxuICAvLyBzdGFydCBvZiBzZWxlY3Rpb24gZHJhZywgc3RhcnQgb2YgdGV4dCBkcmFnLCBuZXcgY3Vyc29yXG4gIC8vIChjdHJsLWNsaWNrKSwgcmVjdGFuZ2xlIGRyYWcgKGFsdC1kcmFnKSwgb3IgeHdpblxuICAvLyBtaWRkbGUtY2xpY2stcGFzdGUuIE9yIGl0IG1pZ2h0IGJlIGEgY2xpY2sgb24gc29tZXRoaW5nIHdlIHNob3VsZFxuICAvLyBub3QgaW50ZXJmZXJlIHdpdGgsIHN1Y2ggYXMgYSBzY3JvbGxiYXIgb3Igd2lkZ2V0LlxuICBmdW5jdGlvbiBvbk1vdXNlRG93bihlKSB7XG4gICAgdmFyIGNtID0gdGhpcywgZGlzcGxheSA9IGNtLmRpc3BsYXk7XG4gICAgaWYgKGRpc3BsYXkuYWN0aXZlVG91Y2ggJiYgZGlzcGxheS5pbnB1dC5zdXBwb3J0c1RvdWNoKCkgfHwgc2lnbmFsRE9NRXZlbnQoY20sIGUpKSByZXR1cm47XG4gICAgZGlzcGxheS5zaGlmdCA9IGUuc2hpZnRLZXk7XG5cbiAgICBpZiAoZXZlbnRJbldpZGdldChkaXNwbGF5LCBlKSkge1xuICAgICAgaWYgKCF3ZWJraXQpIHtcbiAgICAgICAgLy8gQnJpZWZseSB0dXJuIG9mZiBkcmFnZ2FiaWxpdHksIHRvIGFsbG93IHdpZGdldHMgdG8gZG9cbiAgICAgICAgLy8gbm9ybWFsIGRyYWdnaW5nIHRoaW5ncy5cbiAgICAgICAgZGlzcGxheS5zY3JvbGxlci5kcmFnZ2FibGUgPSBmYWxzZTtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpe2Rpc3BsYXkuc2Nyb2xsZXIuZHJhZ2dhYmxlID0gdHJ1ZTt9LCAxMDApO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY2xpY2tJbkd1dHRlcihjbSwgZSkpIHJldHVybjtcbiAgICB2YXIgc3RhcnQgPSBwb3NGcm9tTW91c2UoY20sIGUpO1xuICAgIHdpbmRvdy5mb2N1cygpO1xuXG4gICAgc3dpdGNoIChlX2J1dHRvbihlKSkge1xuICAgIGNhc2UgMTpcbiAgICAgIC8vICMzMjYxOiBtYWtlIHN1cmUsIHRoYXQgd2UncmUgbm90IHN0YXJ0aW5nIGEgc2Vjb25kIHNlbGVjdGlvblxuICAgICAgaWYgKGNtLnN0YXRlLnNlbGVjdGluZ1RleHQpXG4gICAgICAgIGNtLnN0YXRlLnNlbGVjdGluZ1RleHQoZSk7XG4gICAgICBlbHNlIGlmIChzdGFydClcbiAgICAgICAgbGVmdEJ1dHRvbkRvd24oY20sIGUsIHN0YXJ0KTtcbiAgICAgIGVsc2UgaWYgKGVfdGFyZ2V0KGUpID09IGRpc3BsYXkuc2Nyb2xsZXIpXG4gICAgICAgIGVfcHJldmVudERlZmF1bHQoZSk7XG4gICAgICBicmVhaztcbiAgICBjYXNlIDI6XG4gICAgICBpZiAod2Via2l0KSBjbS5zdGF0ZS5sYXN0TWlkZGxlRG93biA9ICtuZXcgRGF0ZTtcbiAgICAgIGlmIChzdGFydCkgZXh0ZW5kU2VsZWN0aW9uKGNtLmRvYywgc3RhcnQpO1xuICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtkaXNwbGF5LmlucHV0LmZvY3VzKCk7fSwgMjApO1xuICAgICAgZV9wcmV2ZW50RGVmYXVsdChlKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgMzpcbiAgICAgIGlmIChjYXB0dXJlUmlnaHRDbGljaykgb25Db250ZXh0TWVudShjbSwgZSk7XG4gICAgICBlbHNlIGRlbGF5Qmx1ckV2ZW50KGNtKTtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHZhciBsYXN0Q2xpY2ssIGxhc3REb3VibGVDbGljaztcbiAgZnVuY3Rpb24gbGVmdEJ1dHRvbkRvd24oY20sIGUsIHN0YXJ0KSB7XG4gICAgaWYgKGllKSBzZXRUaW1lb3V0KGJpbmQoZW5zdXJlRm9jdXMsIGNtKSwgMCk7XG4gICAgZWxzZSBjbS5jdXJPcC5mb2N1cyA9IGFjdGl2ZUVsdCgpO1xuXG4gICAgdmFyIG5vdyA9ICtuZXcgRGF0ZSwgdHlwZTtcbiAgICBpZiAobGFzdERvdWJsZUNsaWNrICYmIGxhc3REb3VibGVDbGljay50aW1lID4gbm93IC0gNDAwICYmIGNtcChsYXN0RG91YmxlQ2xpY2sucG9zLCBzdGFydCkgPT0gMCkge1xuICAgICAgdHlwZSA9IFwidHJpcGxlXCI7XG4gICAgfSBlbHNlIGlmIChsYXN0Q2xpY2sgJiYgbGFzdENsaWNrLnRpbWUgPiBub3cgLSA0MDAgJiYgY21wKGxhc3RDbGljay5wb3MsIHN0YXJ0KSA9PSAwKSB7XG4gICAgICB0eXBlID0gXCJkb3VibGVcIjtcbiAgICAgIGxhc3REb3VibGVDbGljayA9IHt0aW1lOiBub3csIHBvczogc3RhcnR9O1xuICAgIH0gZWxzZSB7XG4gICAgICB0eXBlID0gXCJzaW5nbGVcIjtcbiAgICAgIGxhc3RDbGljayA9IHt0aW1lOiBub3csIHBvczogc3RhcnR9O1xuICAgIH1cblxuICAgIHZhciBzZWwgPSBjbS5kb2Muc2VsLCBtb2RpZmllciA9IG1hYyA/IGUubWV0YUtleSA6IGUuY3RybEtleSwgY29udGFpbmVkO1xuICAgIGlmIChjbS5vcHRpb25zLmRyYWdEcm9wICYmIGRyYWdBbmREcm9wICYmICFpc1JlYWRPbmx5KGNtKSAmJlxuICAgICAgICB0eXBlID09IFwic2luZ2xlXCIgJiYgKGNvbnRhaW5lZCA9IHNlbC5jb250YWlucyhzdGFydCkpID4gLTEgJiZcbiAgICAgICAgKGNtcCgoY29udGFpbmVkID0gc2VsLnJhbmdlc1tjb250YWluZWRdKS5mcm9tKCksIHN0YXJ0KSA8IDAgfHwgc3RhcnQueFJlbCA+IDApICYmXG4gICAgICAgIChjbXAoY29udGFpbmVkLnRvKCksIHN0YXJ0KSA+IDAgfHwgc3RhcnQueFJlbCA8IDApKVxuICAgICAgbGVmdEJ1dHRvblN0YXJ0RHJhZyhjbSwgZSwgc3RhcnQsIG1vZGlmaWVyKTtcbiAgICBlbHNlXG4gICAgICBsZWZ0QnV0dG9uU2VsZWN0KGNtLCBlLCBzdGFydCwgdHlwZSwgbW9kaWZpZXIpO1xuICB9XG5cbiAgLy8gU3RhcnQgYSB0ZXh0IGRyYWcuIFdoZW4gaXQgZW5kcywgc2VlIGlmIGFueSBkcmFnZ2luZyBhY3R1YWxseVxuICAvLyBoYXBwZW4sIGFuZCB0cmVhdCBhcyBhIGNsaWNrIGlmIGl0IGRpZG4ndC5cbiAgZnVuY3Rpb24gbGVmdEJ1dHRvblN0YXJ0RHJhZyhjbSwgZSwgc3RhcnQsIG1vZGlmaWVyKSB7XG4gICAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCBzdGFydFRpbWUgPSArbmV3IERhdGU7XG4gICAgdmFyIGRyYWdFbmQgPSBvcGVyYXRpb24oY20sIGZ1bmN0aW9uKGUyKSB7XG4gICAgICBpZiAod2Via2l0KSBkaXNwbGF5LnNjcm9sbGVyLmRyYWdnYWJsZSA9IGZhbHNlO1xuICAgICAgY20uc3RhdGUuZHJhZ2dpbmdUZXh0ID0gZmFsc2U7XG4gICAgICBvZmYoZG9jdW1lbnQsIFwibW91c2V1cFwiLCBkcmFnRW5kKTtcbiAgICAgIG9mZihkaXNwbGF5LnNjcm9sbGVyLCBcImRyb3BcIiwgZHJhZ0VuZCk7XG4gICAgICBpZiAoTWF0aC5hYnMoZS5jbGllbnRYIC0gZTIuY2xpZW50WCkgKyBNYXRoLmFicyhlLmNsaWVudFkgLSBlMi5jbGllbnRZKSA8IDEwKSB7XG4gICAgICAgIGVfcHJldmVudERlZmF1bHQoZTIpO1xuICAgICAgICBpZiAoIW1vZGlmaWVyICYmICtuZXcgRGF0ZSAtIDIwMCA8IHN0YXJ0VGltZSlcbiAgICAgICAgICBleHRlbmRTZWxlY3Rpb24oY20uZG9jLCBzdGFydCk7XG4gICAgICAgIC8vIFdvcmsgYXJvdW5kIHVuZXhwbGFpbmFibGUgZm9jdXMgcHJvYmxlbSBpbiBJRTkgKCMyMTI3KSBhbmQgQ2hyb21lICgjMzA4MSlcbiAgICAgICAgaWYgKHdlYmtpdCB8fCBpZSAmJiBpZV92ZXJzaW9uID09IDkpXG4gICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtkb2N1bWVudC5ib2R5LmZvY3VzKCk7IGRpc3BsYXkuaW5wdXQuZm9jdXMoKTt9LCAyMCk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICBkaXNwbGF5LmlucHV0LmZvY3VzKCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgLy8gTGV0IHRoZSBkcmFnIGhhbmRsZXIgaGFuZGxlIHRoaXMuXG4gICAgaWYgKHdlYmtpdCkgZGlzcGxheS5zY3JvbGxlci5kcmFnZ2FibGUgPSB0cnVlO1xuICAgIGNtLnN0YXRlLmRyYWdnaW5nVGV4dCA9IGRyYWdFbmQ7XG4gICAgLy8gSUUncyBhcHByb2FjaCB0byBkcmFnZ2FibGVcbiAgICBpZiAoZGlzcGxheS5zY3JvbGxlci5kcmFnRHJvcCkgZGlzcGxheS5zY3JvbGxlci5kcmFnRHJvcCgpO1xuICAgIG9uKGRvY3VtZW50LCBcIm1vdXNldXBcIiwgZHJhZ0VuZCk7XG4gICAgb24oZGlzcGxheS5zY3JvbGxlciwgXCJkcm9wXCIsIGRyYWdFbmQpO1xuICB9XG5cbiAgLy8gTm9ybWFsIHNlbGVjdGlvbiwgYXMgb3Bwb3NlZCB0byB0ZXh0IGRyYWdnaW5nLlxuICBmdW5jdGlvbiBsZWZ0QnV0dG9uU2VsZWN0KGNtLCBlLCBzdGFydCwgdHlwZSwgYWRkTmV3KSB7XG4gICAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCBkb2MgPSBjbS5kb2M7XG4gICAgZV9wcmV2ZW50RGVmYXVsdChlKTtcblxuICAgIHZhciBvdXJSYW5nZSwgb3VySW5kZXgsIHN0YXJ0U2VsID0gZG9jLnNlbCwgcmFuZ2VzID0gc3RhcnRTZWwucmFuZ2VzO1xuICAgIGlmIChhZGROZXcgJiYgIWUuc2hpZnRLZXkpIHtcbiAgICAgIG91ckluZGV4ID0gZG9jLnNlbC5jb250YWlucyhzdGFydCk7XG4gICAgICBpZiAob3VySW5kZXggPiAtMSlcbiAgICAgICAgb3VyUmFuZ2UgPSByYW5nZXNbb3VySW5kZXhdO1xuICAgICAgZWxzZVxuICAgICAgICBvdXJSYW5nZSA9IG5ldyBSYW5nZShzdGFydCwgc3RhcnQpO1xuICAgIH0gZWxzZSB7XG4gICAgICBvdXJSYW5nZSA9IGRvYy5zZWwucHJpbWFyeSgpO1xuICAgICAgb3VySW5kZXggPSBkb2Muc2VsLnByaW1JbmRleDtcbiAgICB9XG5cbiAgICBpZiAoZS5hbHRLZXkpIHtcbiAgICAgIHR5cGUgPSBcInJlY3RcIjtcbiAgICAgIGlmICghYWRkTmV3KSBvdXJSYW5nZSA9IG5ldyBSYW5nZShzdGFydCwgc3RhcnQpO1xuICAgICAgc3RhcnQgPSBwb3NGcm9tTW91c2UoY20sIGUsIHRydWUsIHRydWUpO1xuICAgICAgb3VySW5kZXggPSAtMTtcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT0gXCJkb3VibGVcIikge1xuICAgICAgdmFyIHdvcmQgPSBjbS5maW5kV29yZEF0KHN0YXJ0KTtcbiAgICAgIGlmIChjbS5kaXNwbGF5LnNoaWZ0IHx8IGRvYy5leHRlbmQpXG4gICAgICAgIG91clJhbmdlID0gZXh0ZW5kUmFuZ2UoZG9jLCBvdXJSYW5nZSwgd29yZC5hbmNob3IsIHdvcmQuaGVhZCk7XG4gICAgICBlbHNlXG4gICAgICAgIG91clJhbmdlID0gd29yZDtcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT0gXCJ0cmlwbGVcIikge1xuICAgICAgdmFyIGxpbmUgPSBuZXcgUmFuZ2UoUG9zKHN0YXJ0LmxpbmUsIDApLCBjbGlwUG9zKGRvYywgUG9zKHN0YXJ0LmxpbmUgKyAxLCAwKSkpO1xuICAgICAgaWYgKGNtLmRpc3BsYXkuc2hpZnQgfHwgZG9jLmV4dGVuZClcbiAgICAgICAgb3VyUmFuZ2UgPSBleHRlbmRSYW5nZShkb2MsIG91clJhbmdlLCBsaW5lLmFuY2hvciwgbGluZS5oZWFkKTtcbiAgICAgIGVsc2VcbiAgICAgICAgb3VyUmFuZ2UgPSBsaW5lO1xuICAgIH0gZWxzZSB7XG4gICAgICBvdXJSYW5nZSA9IGV4dGVuZFJhbmdlKGRvYywgb3VyUmFuZ2UsIHN0YXJ0KTtcbiAgICB9XG5cbiAgICBpZiAoIWFkZE5ldykge1xuICAgICAgb3VySW5kZXggPSAwO1xuICAgICAgc2V0U2VsZWN0aW9uKGRvYywgbmV3IFNlbGVjdGlvbihbb3VyUmFuZ2VdLCAwKSwgc2VsX21vdXNlKTtcbiAgICAgIHN0YXJ0U2VsID0gZG9jLnNlbDtcbiAgICB9IGVsc2UgaWYgKG91ckluZGV4ID09IC0xKSB7XG4gICAgICBvdXJJbmRleCA9IHJhbmdlcy5sZW5ndGg7XG4gICAgICBzZXRTZWxlY3Rpb24oZG9jLCBub3JtYWxpemVTZWxlY3Rpb24ocmFuZ2VzLmNvbmNhdChbb3VyUmFuZ2VdKSwgb3VySW5kZXgpLFxuICAgICAgICAgICAgICAgICAgIHtzY3JvbGw6IGZhbHNlLCBvcmlnaW46IFwiKm1vdXNlXCJ9KTtcbiAgICB9IGVsc2UgaWYgKHJhbmdlcy5sZW5ndGggPiAxICYmIHJhbmdlc1tvdXJJbmRleF0uZW1wdHkoKSAmJiB0eXBlID09IFwic2luZ2xlXCIgJiYgIWUuc2hpZnRLZXkpIHtcbiAgICAgIHNldFNlbGVjdGlvbihkb2MsIG5vcm1hbGl6ZVNlbGVjdGlvbihyYW5nZXMuc2xpY2UoMCwgb3VySW5kZXgpLmNvbmNhdChyYW5nZXMuc2xpY2Uob3VySW5kZXggKyAxKSksIDApLFxuICAgICAgICAgICAgICAgICAgIHtzY3JvbGw6IGZhbHNlLCBvcmlnaW46IFwiKm1vdXNlXCJ9KTtcbiAgICAgIHN0YXJ0U2VsID0gZG9jLnNlbDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVwbGFjZU9uZVNlbGVjdGlvbihkb2MsIG91ckluZGV4LCBvdXJSYW5nZSwgc2VsX21vdXNlKTtcbiAgICB9XG5cbiAgICB2YXIgbGFzdFBvcyA9IHN0YXJ0O1xuICAgIGZ1bmN0aW9uIGV4dGVuZFRvKHBvcykge1xuICAgICAgaWYgKGNtcChsYXN0UG9zLCBwb3MpID09IDApIHJldHVybjtcbiAgICAgIGxhc3RQb3MgPSBwb3M7XG5cbiAgICAgIGlmICh0eXBlID09IFwicmVjdFwiKSB7XG4gICAgICAgIHZhciByYW5nZXMgPSBbXSwgdGFiU2l6ZSA9IGNtLm9wdGlvbnMudGFiU2l6ZTtcbiAgICAgICAgdmFyIHN0YXJ0Q29sID0gY291bnRDb2x1bW4oZ2V0TGluZShkb2MsIHN0YXJ0LmxpbmUpLnRleHQsIHN0YXJ0LmNoLCB0YWJTaXplKTtcbiAgICAgICAgdmFyIHBvc0NvbCA9IGNvdW50Q29sdW1uKGdldExpbmUoZG9jLCBwb3MubGluZSkudGV4dCwgcG9zLmNoLCB0YWJTaXplKTtcbiAgICAgICAgdmFyIGxlZnQgPSBNYXRoLm1pbihzdGFydENvbCwgcG9zQ29sKSwgcmlnaHQgPSBNYXRoLm1heChzdGFydENvbCwgcG9zQ29sKTtcbiAgICAgICAgZm9yICh2YXIgbGluZSA9IE1hdGgubWluKHN0YXJ0LmxpbmUsIHBvcy5saW5lKSwgZW5kID0gTWF0aC5taW4oY20ubGFzdExpbmUoKSwgTWF0aC5tYXgoc3RhcnQubGluZSwgcG9zLmxpbmUpKTtcbiAgICAgICAgICAgICBsaW5lIDw9IGVuZDsgbGluZSsrKSB7XG4gICAgICAgICAgdmFyIHRleHQgPSBnZXRMaW5lKGRvYywgbGluZSkudGV4dCwgbGVmdFBvcyA9IGZpbmRDb2x1bW4odGV4dCwgbGVmdCwgdGFiU2l6ZSk7XG4gICAgICAgICAgaWYgKGxlZnQgPT0gcmlnaHQpXG4gICAgICAgICAgICByYW5nZXMucHVzaChuZXcgUmFuZ2UoUG9zKGxpbmUsIGxlZnRQb3MpLCBQb3MobGluZSwgbGVmdFBvcykpKTtcbiAgICAgICAgICBlbHNlIGlmICh0ZXh0Lmxlbmd0aCA+IGxlZnRQb3MpXG4gICAgICAgICAgICByYW5nZXMucHVzaChuZXcgUmFuZ2UoUG9zKGxpbmUsIGxlZnRQb3MpLCBQb3MobGluZSwgZmluZENvbHVtbih0ZXh0LCByaWdodCwgdGFiU2l6ZSkpKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFyYW5nZXMubGVuZ3RoKSByYW5nZXMucHVzaChuZXcgUmFuZ2Uoc3RhcnQsIHN0YXJ0KSk7XG4gICAgICAgIHNldFNlbGVjdGlvbihkb2MsIG5vcm1hbGl6ZVNlbGVjdGlvbihzdGFydFNlbC5yYW5nZXMuc2xpY2UoMCwgb3VySW5kZXgpLmNvbmNhdChyYW5nZXMpLCBvdXJJbmRleCksXG4gICAgICAgICAgICAgICAgICAgICB7b3JpZ2luOiBcIiptb3VzZVwiLCBzY3JvbGw6IGZhbHNlfSk7XG4gICAgICAgIGNtLnNjcm9sbEludG9WaWV3KHBvcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgb2xkUmFuZ2UgPSBvdXJSYW5nZTtcbiAgICAgICAgdmFyIGFuY2hvciA9IG9sZFJhbmdlLmFuY2hvciwgaGVhZCA9IHBvcztcbiAgICAgICAgaWYgKHR5cGUgIT0gXCJzaW5nbGVcIikge1xuICAgICAgICAgIGlmICh0eXBlID09IFwiZG91YmxlXCIpXG4gICAgICAgICAgICB2YXIgcmFuZ2UgPSBjbS5maW5kV29yZEF0KHBvcyk7XG4gICAgICAgICAgZWxzZVxuICAgICAgICAgICAgdmFyIHJhbmdlID0gbmV3IFJhbmdlKFBvcyhwb3MubGluZSwgMCksIGNsaXBQb3MoZG9jLCBQb3MocG9zLmxpbmUgKyAxLCAwKSkpO1xuICAgICAgICAgIGlmIChjbXAocmFuZ2UuYW5jaG9yLCBhbmNob3IpID4gMCkge1xuICAgICAgICAgICAgaGVhZCA9IHJhbmdlLmhlYWQ7XG4gICAgICAgICAgICBhbmNob3IgPSBtaW5Qb3Mob2xkUmFuZ2UuZnJvbSgpLCByYW5nZS5hbmNob3IpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBoZWFkID0gcmFuZ2UuYW5jaG9yO1xuICAgICAgICAgICAgYW5jaG9yID0gbWF4UG9zKG9sZFJhbmdlLnRvKCksIHJhbmdlLmhlYWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2YXIgcmFuZ2VzID0gc3RhcnRTZWwucmFuZ2VzLnNsaWNlKDApO1xuICAgICAgICByYW5nZXNbb3VySW5kZXhdID0gbmV3IFJhbmdlKGNsaXBQb3MoZG9jLCBhbmNob3IpLCBoZWFkKTtcbiAgICAgICAgc2V0U2VsZWN0aW9uKGRvYywgbm9ybWFsaXplU2VsZWN0aW9uKHJhbmdlcywgb3VySW5kZXgpLCBzZWxfbW91c2UpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBlZGl0b3JTaXplID0gZGlzcGxheS53cmFwcGVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIC8vIFVzZWQgdG8gZW5zdXJlIHRpbWVvdXQgcmUtdHJpZXMgZG9uJ3QgZmlyZSB3aGVuIGFub3RoZXIgZXh0ZW5kXG4gICAgLy8gaGFwcGVuZWQgaW4gdGhlIG1lYW50aW1lIChjbGVhclRpbWVvdXQgaXNuJ3QgcmVsaWFibGUgLS0gYXRcbiAgICAvLyBsZWFzdCBvbiBDaHJvbWUsIHRoZSB0aW1lb3V0cyBzdGlsbCBoYXBwZW4gZXZlbiB3aGVuIGNsZWFyZWQsXG4gICAgLy8gaWYgdGhlIGNsZWFyIGhhcHBlbnMgYWZ0ZXIgdGhlaXIgc2NoZWR1bGVkIGZpcmluZyB0aW1lKS5cbiAgICB2YXIgY291bnRlciA9IDA7XG5cbiAgICBmdW5jdGlvbiBleHRlbmQoZSkge1xuICAgICAgdmFyIGN1ckNvdW50ID0gKytjb3VudGVyO1xuICAgICAgdmFyIGN1ciA9IHBvc0Zyb21Nb3VzZShjbSwgZSwgdHJ1ZSwgdHlwZSA9PSBcInJlY3RcIik7XG4gICAgICBpZiAoIWN1cikgcmV0dXJuO1xuICAgICAgaWYgKGNtcChjdXIsIGxhc3RQb3MpICE9IDApIHtcbiAgICAgICAgY20uY3VyT3AuZm9jdXMgPSBhY3RpdmVFbHQoKTtcbiAgICAgICAgZXh0ZW5kVG8oY3VyKTtcbiAgICAgICAgdmFyIHZpc2libGUgPSB2aXNpYmxlTGluZXMoZGlzcGxheSwgZG9jKTtcbiAgICAgICAgaWYgKGN1ci5saW5lID49IHZpc2libGUudG8gfHwgY3VyLmxpbmUgPCB2aXNpYmxlLmZyb20pXG4gICAgICAgICAgc2V0VGltZW91dChvcGVyYXRpb24oY20sIGZ1bmN0aW9uKCl7aWYgKGNvdW50ZXIgPT0gY3VyQ291bnQpIGV4dGVuZChlKTt9KSwgMTUwKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBvdXRzaWRlID0gZS5jbGllbnRZIDwgZWRpdG9yU2l6ZS50b3AgPyAtMjAgOiBlLmNsaWVudFkgPiBlZGl0b3JTaXplLmJvdHRvbSA/IDIwIDogMDtcbiAgICAgICAgaWYgKG91dHNpZGUpIHNldFRpbWVvdXQob3BlcmF0aW9uKGNtLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiAoY291bnRlciAhPSBjdXJDb3VudCkgcmV0dXJuO1xuICAgICAgICAgIGRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsVG9wICs9IG91dHNpZGU7XG4gICAgICAgICAgZXh0ZW5kKGUpO1xuICAgICAgICB9KSwgNTApO1xuICAgICAgfVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGRvbmUoZSkge1xuICAgICAgY20uc3RhdGUuc2VsZWN0aW5nVGV4dCA9IGZhbHNlO1xuICAgICAgY291bnRlciA9IEluZmluaXR5O1xuICAgICAgZV9wcmV2ZW50RGVmYXVsdChlKTtcbiAgICAgIGRpc3BsYXkuaW5wdXQuZm9jdXMoKTtcbiAgICAgIG9mZihkb2N1bWVudCwgXCJtb3VzZW1vdmVcIiwgbW92ZSk7XG4gICAgICBvZmYoZG9jdW1lbnQsIFwibW91c2V1cFwiLCB1cCk7XG4gICAgICBkb2MuaGlzdG9yeS5sYXN0U2VsT3JpZ2luID0gbnVsbDtcbiAgICB9XG5cbiAgICB2YXIgbW92ZSA9IG9wZXJhdGlvbihjbSwgZnVuY3Rpb24oZSkge1xuICAgICAgaWYgKCFlX2J1dHRvbihlKSkgZG9uZShlKTtcbiAgICAgIGVsc2UgZXh0ZW5kKGUpO1xuICAgIH0pO1xuICAgIHZhciB1cCA9IG9wZXJhdGlvbihjbSwgZG9uZSk7XG4gICAgY20uc3RhdGUuc2VsZWN0aW5nVGV4dCA9IHVwO1xuICAgIG9uKGRvY3VtZW50LCBcIm1vdXNlbW92ZVwiLCBtb3ZlKTtcbiAgICBvbihkb2N1bWVudCwgXCJtb3VzZXVwXCIsIHVwKTtcbiAgfVxuXG4gIC8vIERldGVybWluZXMgd2hldGhlciBhbiBldmVudCBoYXBwZW5lZCBpbiB0aGUgZ3V0dGVyLCBhbmQgZmlyZXMgdGhlXG4gIC8vIGhhbmRsZXJzIGZvciB0aGUgY29ycmVzcG9uZGluZyBldmVudC5cbiAgZnVuY3Rpb24gZ3V0dGVyRXZlbnQoY20sIGUsIHR5cGUsIHByZXZlbnQsIHNpZ25hbGZuKSB7XG4gICAgdHJ5IHsgdmFyIG1YID0gZS5jbGllbnRYLCBtWSA9IGUuY2xpZW50WTsgfVxuICAgIGNhdGNoKGUpIHsgcmV0dXJuIGZhbHNlOyB9XG4gICAgaWYgKG1YID49IE1hdGguZmxvb3IoY20uZGlzcGxheS5ndXR0ZXJzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnJpZ2h0KSkgcmV0dXJuIGZhbHNlO1xuICAgIGlmIChwcmV2ZW50KSBlX3ByZXZlbnREZWZhdWx0KGUpO1xuXG4gICAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5O1xuICAgIHZhciBsaW5lQm94ID0gZGlzcGxheS5saW5lRGl2LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuXG4gICAgaWYgKG1ZID4gbGluZUJveC5ib3R0b20gfHwgIWhhc0hhbmRsZXIoY20sIHR5cGUpKSByZXR1cm4gZV9kZWZhdWx0UHJldmVudGVkKGUpO1xuICAgIG1ZIC09IGxpbmVCb3gudG9wIC0gZGlzcGxheS52aWV3T2Zmc2V0O1xuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjbS5vcHRpb25zLmd1dHRlcnMubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBnID0gZGlzcGxheS5ndXR0ZXJzLmNoaWxkTm9kZXNbaV07XG4gICAgICBpZiAoZyAmJiBnLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnJpZ2h0ID49IG1YKSB7XG4gICAgICAgIHZhciBsaW5lID0gbGluZUF0SGVpZ2h0KGNtLmRvYywgbVkpO1xuICAgICAgICB2YXIgZ3V0dGVyID0gY20ub3B0aW9ucy5ndXR0ZXJzW2ldO1xuICAgICAgICBzaWduYWxmbihjbSwgdHlwZSwgY20sIGxpbmUsIGd1dHRlciwgZSk7XG4gICAgICAgIHJldHVybiBlX2RlZmF1bHRQcmV2ZW50ZWQoZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gY2xpY2tJbkd1dHRlcihjbSwgZSkge1xuICAgIHJldHVybiBndXR0ZXJFdmVudChjbSwgZSwgXCJndXR0ZXJDbGlja1wiLCB0cnVlLCBzaWduYWxMYXRlcik7XG4gIH1cblxuICAvLyBLbHVkZ2UgdG8gd29yayBhcm91bmQgc3RyYW5nZSBJRSBiZWhhdmlvciB3aGVyZSBpdCdsbCBzb21ldGltZXNcbiAgLy8gcmUtZmlyZSBhIHNlcmllcyBvZiBkcmFnLXJlbGF0ZWQgZXZlbnRzIHJpZ2h0IGFmdGVyIHRoZSBkcm9wICgjMTU1MSlcbiAgdmFyIGxhc3REcm9wID0gMDtcblxuICBmdW5jdGlvbiBvbkRyb3AoZSkge1xuICAgIHZhciBjbSA9IHRoaXM7XG4gICAgY2xlYXJEcmFnQ3Vyc29yKGNtKTtcbiAgICBpZiAoc2lnbmFsRE9NRXZlbnQoY20sIGUpIHx8IGV2ZW50SW5XaWRnZXQoY20uZGlzcGxheSwgZSkpXG4gICAgICByZXR1cm47XG4gICAgZV9wcmV2ZW50RGVmYXVsdChlKTtcbiAgICBpZiAoaWUpIGxhc3REcm9wID0gK25ldyBEYXRlO1xuICAgIHZhciBwb3MgPSBwb3NGcm9tTW91c2UoY20sIGUsIHRydWUpLCBmaWxlcyA9IGUuZGF0YVRyYW5zZmVyLmZpbGVzO1xuICAgIGlmICghcG9zIHx8IGlzUmVhZE9ubHkoY20pKSByZXR1cm47XG4gICAgLy8gTWlnaHQgYmUgYSBmaWxlIGRyb3AsIGluIHdoaWNoIGNhc2Ugd2Ugc2ltcGx5IGV4dHJhY3QgdGhlIHRleHRcbiAgICAvLyBhbmQgaW5zZXJ0IGl0LlxuICAgIGlmIChmaWxlcyAmJiBmaWxlcy5sZW5ndGggJiYgd2luZG93LkZpbGVSZWFkZXIgJiYgd2luZG93LkZpbGUpIHtcbiAgICAgIHZhciBuID0gZmlsZXMubGVuZ3RoLCB0ZXh0ID0gQXJyYXkobiksIHJlYWQgPSAwO1xuICAgICAgdmFyIGxvYWRGaWxlID0gZnVuY3Rpb24oZmlsZSwgaSkge1xuICAgICAgICBpZiAoY20ub3B0aW9ucy5hbGxvd0Ryb3BGaWxlVHlwZXMgJiZcbiAgICAgICAgICAgIGluZGV4T2YoY20ub3B0aW9ucy5hbGxvd0Ryb3BGaWxlVHlwZXMsIGZpbGUudHlwZSkgPT0gLTEpXG4gICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcjtcbiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IG9wZXJhdGlvbihjbSwgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIGNvbnRlbnQgPSByZWFkZXIucmVzdWx0O1xuICAgICAgICAgIGlmICgvW1xceDAwLVxceDA4XFx4MGUtXFx4MWZdezJ9Ly50ZXN0KGNvbnRlbnQpKSBjb250ZW50ID0gXCJcIjtcbiAgICAgICAgICB0ZXh0W2ldID0gY29udGVudDtcbiAgICAgICAgICBpZiAoKytyZWFkID09IG4pIHtcbiAgICAgICAgICAgIHBvcyA9IGNsaXBQb3MoY20uZG9jLCBwb3MpO1xuICAgICAgICAgICAgdmFyIGNoYW5nZSA9IHtmcm9tOiBwb3MsIHRvOiBwb3MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGNtLmRvYy5zcGxpdExpbmVzKHRleHQuam9pbihjbS5kb2MubGluZVNlcGFyYXRvcigpKSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbjogXCJwYXN0ZVwifTtcbiAgICAgICAgICAgIG1ha2VDaGFuZ2UoY20uZG9jLCBjaGFuZ2UpO1xuICAgICAgICAgICAgc2V0U2VsZWN0aW9uUmVwbGFjZUhpc3RvcnkoY20uZG9jLCBzaW1wbGVTZWxlY3Rpb24ocG9zLCBjaGFuZ2VFbmQoY2hhbmdlKSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJlYWRlci5yZWFkQXNUZXh0KGZpbGUpO1xuICAgICAgfTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgKytpKSBsb2FkRmlsZShmaWxlc1tpXSwgaSk7XG4gICAgfSBlbHNlIHsgLy8gTm9ybWFsIGRyb3BcbiAgICAgIC8vIERvbid0IGRvIGEgcmVwbGFjZSBpZiB0aGUgZHJvcCBoYXBwZW5lZCBpbnNpZGUgb2YgdGhlIHNlbGVjdGVkIHRleHQuXG4gICAgICBpZiAoY20uc3RhdGUuZHJhZ2dpbmdUZXh0ICYmIGNtLmRvYy5zZWwuY29udGFpbnMocG9zKSA+IC0xKSB7XG4gICAgICAgIGNtLnN0YXRlLmRyYWdnaW5nVGV4dChlKTtcbiAgICAgICAgLy8gRW5zdXJlIHRoZSBlZGl0b3IgaXMgcmUtZm9jdXNlZFxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge2NtLmRpc3BsYXkuaW5wdXQuZm9jdXMoKTt9LCAyMCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIHZhciB0ZXh0ID0gZS5kYXRhVHJhbnNmZXIuZ2V0RGF0YShcIlRleHRcIik7XG4gICAgICAgIGlmICh0ZXh0KSB7XG4gICAgICAgICAgaWYgKGNtLnN0YXRlLmRyYWdnaW5nVGV4dCAmJiAhKG1hYyA/IGUuYWx0S2V5IDogZS5jdHJsS2V5KSlcbiAgICAgICAgICAgIHZhciBzZWxlY3RlZCA9IGNtLmxpc3RTZWxlY3Rpb25zKCk7XG4gICAgICAgICAgc2V0U2VsZWN0aW9uTm9VbmRvKGNtLmRvYywgc2ltcGxlU2VsZWN0aW9uKHBvcywgcG9zKSk7XG4gICAgICAgICAgaWYgKHNlbGVjdGVkKSBmb3IgKHZhciBpID0gMDsgaSA8IHNlbGVjdGVkLmxlbmd0aDsgKytpKVxuICAgICAgICAgICAgcmVwbGFjZVJhbmdlKGNtLmRvYywgXCJcIiwgc2VsZWN0ZWRbaV0uYW5jaG9yLCBzZWxlY3RlZFtpXS5oZWFkLCBcImRyYWdcIik7XG4gICAgICAgICAgY20ucmVwbGFjZVNlbGVjdGlvbih0ZXh0LCBcImFyb3VuZFwiLCBcInBhc3RlXCIpO1xuICAgICAgICAgIGNtLmRpc3BsYXkuaW5wdXQuZm9jdXMoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgY2F0Y2goZSl7fVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIG9uRHJhZ1N0YXJ0KGNtLCBlKSB7XG4gICAgaWYgKGllICYmICghY20uc3RhdGUuZHJhZ2dpbmdUZXh0IHx8ICtuZXcgRGF0ZSAtIGxhc3REcm9wIDwgMTAwKSkgeyBlX3N0b3AoZSk7IHJldHVybjsgfVxuICAgIGlmIChzaWduYWxET01FdmVudChjbSwgZSkgfHwgZXZlbnRJbldpZGdldChjbS5kaXNwbGF5LCBlKSkgcmV0dXJuO1xuXG4gICAgZS5kYXRhVHJhbnNmZXIuc2V0RGF0YShcIlRleHRcIiwgY20uZ2V0U2VsZWN0aW9uKCkpO1xuXG4gICAgLy8gVXNlIGR1bW15IGltYWdlIGluc3RlYWQgb2YgZGVmYXVsdCBicm93c2VycyBpbWFnZS5cbiAgICAvLyBSZWNlbnQgU2FmYXJpICh+Ni4wLjIpIGhhdmUgYSB0ZW5kZW5jeSB0byBzZWdmYXVsdCB3aGVuIHRoaXMgaGFwcGVucywgc28gd2UgZG9uJ3QgZG8gaXQgdGhlcmUuXG4gICAgaWYgKGUuZGF0YVRyYW5zZmVyLnNldERyYWdJbWFnZSAmJiAhc2FmYXJpKSB7XG4gICAgICB2YXIgaW1nID0gZWx0KFwiaW1nXCIsIG51bGwsIG51bGwsIFwicG9zaXRpb246IGZpeGVkOyBsZWZ0OiAwOyB0b3A6IDA7XCIpO1xuICAgICAgaW1nLnNyYyA9IFwiZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoQVFBQkFBQUFBQ0g1QkFFS0FBRUFMQUFBQUFBQkFBRUFBQUlDVEFFQU93PT1cIjtcbiAgICAgIGlmIChwcmVzdG8pIHtcbiAgICAgICAgaW1nLndpZHRoID0gaW1nLmhlaWdodCA9IDE7XG4gICAgICAgIGNtLmRpc3BsYXkud3JhcHBlci5hcHBlbmRDaGlsZChpbWcpO1xuICAgICAgICAvLyBGb3JjZSBhIHJlbGF5b3V0LCBvciBPcGVyYSB3b24ndCB1c2Ugb3VyIGltYWdlIGZvciBzb21lIG9ic2N1cmUgcmVhc29uXG4gICAgICAgIGltZy5fdG9wID0gaW1nLm9mZnNldFRvcDtcbiAgICAgIH1cbiAgICAgIGUuZGF0YVRyYW5zZmVyLnNldERyYWdJbWFnZShpbWcsIDAsIDApO1xuICAgICAgaWYgKHByZXN0bykgaW1nLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoaW1nKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBvbkRyYWdPdmVyKGNtLCBlKSB7XG4gICAgdmFyIHBvcyA9IHBvc0Zyb21Nb3VzZShjbSwgZSk7XG4gICAgaWYgKCFwb3MpIHJldHVybjtcbiAgICB2YXIgZnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICBkcmF3U2VsZWN0aW9uQ3Vyc29yKGNtLCBwb3MsIGZyYWcpO1xuICAgIGlmICghY20uZGlzcGxheS5kcmFnQ3Vyc29yKSB7XG4gICAgICBjbS5kaXNwbGF5LmRyYWdDdXJzb3IgPSBlbHQoXCJkaXZcIiwgbnVsbCwgXCJDb2RlTWlycm9yLWN1cnNvcnMgQ29kZU1pcnJvci1kcmFnY3Vyc29yc1wiKTtcbiAgICAgIGNtLmRpc3BsYXkubGluZVNwYWNlLmluc2VydEJlZm9yZShjbS5kaXNwbGF5LmRyYWdDdXJzb3IsIGNtLmRpc3BsYXkuY3Vyc29yRGl2KTtcbiAgICB9XG4gICAgcmVtb3ZlQ2hpbGRyZW5BbmRBZGQoY20uZGlzcGxheS5kcmFnQ3Vyc29yLCBmcmFnKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNsZWFyRHJhZ0N1cnNvcihjbSkge1xuICAgIGlmIChjbS5kaXNwbGF5LmRyYWdDdXJzb3IpIHtcbiAgICAgIGNtLmRpc3BsYXkubGluZVNwYWNlLnJlbW92ZUNoaWxkKGNtLmRpc3BsYXkuZHJhZ0N1cnNvcik7XG4gICAgICBjbS5kaXNwbGF5LmRyYWdDdXJzb3IgPSBudWxsO1xuICAgIH1cbiAgfVxuXG4gIC8vIFNDUk9MTCBFVkVOVFNcblxuICAvLyBTeW5jIHRoZSBzY3JvbGxhYmxlIGFyZWEgYW5kIHNjcm9sbGJhcnMsIGVuc3VyZSB0aGUgdmlld3BvcnRcbiAgLy8gY292ZXJzIHRoZSB2aXNpYmxlIGFyZWEuXG4gIGZ1bmN0aW9uIHNldFNjcm9sbFRvcChjbSwgdmFsKSB7XG4gICAgaWYgKE1hdGguYWJzKGNtLmRvYy5zY3JvbGxUb3AgLSB2YWwpIDwgMikgcmV0dXJuO1xuICAgIGNtLmRvYy5zY3JvbGxUb3AgPSB2YWw7XG4gICAgaWYgKCFnZWNrbykgdXBkYXRlRGlzcGxheVNpbXBsZShjbSwge3RvcDogdmFsfSk7XG4gICAgaWYgKGNtLmRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsVG9wICE9IHZhbCkgY20uZGlzcGxheS5zY3JvbGxlci5zY3JvbGxUb3AgPSB2YWw7XG4gICAgY20uZGlzcGxheS5zY3JvbGxiYXJzLnNldFNjcm9sbFRvcCh2YWwpO1xuICAgIGlmIChnZWNrbykgdXBkYXRlRGlzcGxheVNpbXBsZShjbSk7XG4gICAgc3RhcnRXb3JrZXIoY20sIDEwMCk7XG4gIH1cbiAgLy8gU3luYyBzY3JvbGxlciBhbmQgc2Nyb2xsYmFyLCBlbnN1cmUgdGhlIGd1dHRlciBlbGVtZW50cyBhcmVcbiAgLy8gYWxpZ25lZC5cbiAgZnVuY3Rpb24gc2V0U2Nyb2xsTGVmdChjbSwgdmFsLCBpc1Njcm9sbGVyKSB7XG4gICAgaWYgKGlzU2Nyb2xsZXIgPyB2YWwgPT0gY20uZG9jLnNjcm9sbExlZnQgOiBNYXRoLmFicyhjbS5kb2Muc2Nyb2xsTGVmdCAtIHZhbCkgPCAyKSByZXR1cm47XG4gICAgdmFsID0gTWF0aC5taW4odmFsLCBjbS5kaXNwbGF5LnNjcm9sbGVyLnNjcm9sbFdpZHRoIC0gY20uZGlzcGxheS5zY3JvbGxlci5jbGllbnRXaWR0aCk7XG4gICAgY20uZG9jLnNjcm9sbExlZnQgPSB2YWw7XG4gICAgYWxpZ25Ib3Jpem9udGFsbHkoY20pO1xuICAgIGlmIChjbS5kaXNwbGF5LnNjcm9sbGVyLnNjcm9sbExlZnQgIT0gdmFsKSBjbS5kaXNwbGF5LnNjcm9sbGVyLnNjcm9sbExlZnQgPSB2YWw7XG4gICAgY20uZGlzcGxheS5zY3JvbGxiYXJzLnNldFNjcm9sbExlZnQodmFsKTtcbiAgfVxuXG4gIC8vIFNpbmNlIHRoZSBkZWx0YSB2YWx1ZXMgcmVwb3J0ZWQgb24gbW91c2Ugd2hlZWwgZXZlbnRzIGFyZVxuICAvLyB1bnN0YW5kYXJkaXplZCBiZXR3ZWVuIGJyb3dzZXJzIGFuZCBldmVuIGJyb3dzZXIgdmVyc2lvbnMsIGFuZFxuICAvLyBnZW5lcmFsbHkgaG9ycmlibHkgdW5wcmVkaWN0YWJsZSwgdGhpcyBjb2RlIHN0YXJ0cyBieSBtZWFzdXJpbmdcbiAgLy8gdGhlIHNjcm9sbCBlZmZlY3QgdGhhdCB0aGUgZmlyc3QgZmV3IG1vdXNlIHdoZWVsIGV2ZW50cyBoYXZlLFxuICAvLyBhbmQsIGZyb20gdGhhdCwgZGV0ZWN0cyB0aGUgd2F5IGl0IGNhbiBjb252ZXJ0IGRlbHRhcyB0byBwaXhlbFxuICAvLyBvZmZzZXRzIGFmdGVyd2FyZHMuXG4gIC8vXG4gIC8vIFRoZSByZWFzb24gd2Ugd2FudCB0byBrbm93IHRoZSBhbW91bnQgYSB3aGVlbCBldmVudCB3aWxsIHNjcm9sbFxuICAvLyBpcyB0aGF0IGl0IGdpdmVzIHVzIGEgY2hhbmNlIHRvIHVwZGF0ZSB0aGUgZGlzcGxheSBiZWZvcmUgdGhlXG4gIC8vIGFjdHVhbCBzY3JvbGxpbmcgaGFwcGVucywgcmVkdWNpbmcgZmxpY2tlcmluZy5cblxuICB2YXIgd2hlZWxTYW1wbGVzID0gMCwgd2hlZWxQaXhlbHNQZXJVbml0ID0gbnVsbDtcbiAgLy8gRmlsbCBpbiBhIGJyb3dzZXItZGV0ZWN0ZWQgc3RhcnRpbmcgdmFsdWUgb24gYnJvd3NlcnMgd2hlcmUgd2VcbiAgLy8ga25vdyBvbmUuIFRoZXNlIGRvbid0IGhhdmUgdG8gYmUgYWNjdXJhdGUgLS0gdGhlIHJlc3VsdCBvZiB0aGVtXG4gIC8vIGJlaW5nIHdyb25nIHdvdWxkIGp1c3QgYmUgYSBzbGlnaHQgZmxpY2tlciBvbiB0aGUgZmlyc3Qgd2hlZWxcbiAgLy8gc2Nyb2xsIChpZiBpdCBpcyBsYXJnZSBlbm91Z2gpLlxuICBpZiAoaWUpIHdoZWVsUGl4ZWxzUGVyVW5pdCA9IC0uNTM7XG4gIGVsc2UgaWYgKGdlY2tvKSB3aGVlbFBpeGVsc1BlclVuaXQgPSAxNTtcbiAgZWxzZSBpZiAoY2hyb21lKSB3aGVlbFBpeGVsc1BlclVuaXQgPSAtLjc7XG4gIGVsc2UgaWYgKHNhZmFyaSkgd2hlZWxQaXhlbHNQZXJVbml0ID0gLTEvMztcblxuICB2YXIgd2hlZWxFdmVudERlbHRhID0gZnVuY3Rpb24oZSkge1xuICAgIHZhciBkeCA9IGUud2hlZWxEZWx0YVgsIGR5ID0gZS53aGVlbERlbHRhWTtcbiAgICBpZiAoZHggPT0gbnVsbCAmJiBlLmRldGFpbCAmJiBlLmF4aXMgPT0gZS5IT1JJWk9OVEFMX0FYSVMpIGR4ID0gZS5kZXRhaWw7XG4gICAgaWYgKGR5ID09IG51bGwgJiYgZS5kZXRhaWwgJiYgZS5heGlzID09IGUuVkVSVElDQUxfQVhJUykgZHkgPSBlLmRldGFpbDtcbiAgICBlbHNlIGlmIChkeSA9PSBudWxsKSBkeSA9IGUud2hlZWxEZWx0YTtcbiAgICByZXR1cm4ge3g6IGR4LCB5OiBkeX07XG4gIH07XG4gIENvZGVNaXJyb3Iud2hlZWxFdmVudFBpeGVscyA9IGZ1bmN0aW9uKGUpIHtcbiAgICB2YXIgZGVsdGEgPSB3aGVlbEV2ZW50RGVsdGEoZSk7XG4gICAgZGVsdGEueCAqPSB3aGVlbFBpeGVsc1BlclVuaXQ7XG4gICAgZGVsdGEueSAqPSB3aGVlbFBpeGVsc1BlclVuaXQ7XG4gICAgcmV0dXJuIGRlbHRhO1xuICB9O1xuXG4gIGZ1bmN0aW9uIG9uU2Nyb2xsV2hlZWwoY20sIGUpIHtcbiAgICB2YXIgZGVsdGEgPSB3aGVlbEV2ZW50RGVsdGEoZSksIGR4ID0gZGVsdGEueCwgZHkgPSBkZWx0YS55O1xuXG4gICAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCBzY3JvbGwgPSBkaXNwbGF5LnNjcm9sbGVyO1xuICAgIC8vIFF1aXQgaWYgdGhlcmUncyBub3RoaW5nIHRvIHNjcm9sbCBoZXJlXG4gICAgdmFyIGNhblNjcm9sbFggPSBzY3JvbGwuc2Nyb2xsV2lkdGggPiBzY3JvbGwuY2xpZW50V2lkdGg7XG4gICAgdmFyIGNhblNjcm9sbFkgPSBzY3JvbGwuc2Nyb2xsSGVpZ2h0ID4gc2Nyb2xsLmNsaWVudEhlaWdodDtcbiAgICBpZiAoIShkeCAmJiBjYW5TY3JvbGxYIHx8IGR5ICYmIGNhblNjcm9sbFkpKSByZXR1cm47XG5cbiAgICAvLyBXZWJraXQgYnJvd3NlcnMgb24gT1MgWCBhYm9ydCBtb21lbnR1bSBzY3JvbGxzIHdoZW4gdGhlIHRhcmdldFxuICAgIC8vIG9mIHRoZSBzY3JvbGwgZXZlbnQgaXMgcmVtb3ZlZCBmcm9tIHRoZSBzY3JvbGxhYmxlIGVsZW1lbnQuXG4gICAgLy8gVGhpcyBoYWNrIChzZWUgcmVsYXRlZCBjb2RlIGluIHBhdGNoRGlzcGxheSkgbWFrZXMgc3VyZSB0aGVcbiAgICAvLyBlbGVtZW50IGlzIGtlcHQgYXJvdW5kLlxuICAgIGlmIChkeSAmJiBtYWMgJiYgd2Via2l0KSB7XG4gICAgICBvdXRlcjogZm9yICh2YXIgY3VyID0gZS50YXJnZXQsIHZpZXcgPSBkaXNwbGF5LnZpZXc7IGN1ciAhPSBzY3JvbGw7IGN1ciA9IGN1ci5wYXJlbnROb2RlKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmlldy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmICh2aWV3W2ldLm5vZGUgPT0gY3VyKSB7XG4gICAgICAgICAgICBjbS5kaXNwbGF5LmN1cnJlbnRXaGVlbFRhcmdldCA9IGN1cjtcbiAgICAgICAgICAgIGJyZWFrIG91dGVyO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIE9uIHNvbWUgYnJvd3NlcnMsIGhvcml6b250YWwgc2Nyb2xsaW5nIHdpbGwgY2F1c2UgcmVkcmF3cyB0b1xuICAgIC8vIGhhcHBlbiBiZWZvcmUgdGhlIGd1dHRlciBoYXMgYmVlbiByZWFsaWduZWQsIGNhdXNpbmcgaXQgdG9cbiAgICAvLyB3cmlnZ2xlIGFyb3VuZCBpbiBhIG1vc3QgdW5zZWVtbHkgd2F5LiBXaGVuIHdlIGhhdmUgYW5cbiAgICAvLyBlc3RpbWF0ZWQgcGl4ZWxzL2RlbHRhIHZhbHVlLCB3ZSBqdXN0IGhhbmRsZSBob3Jpem9udGFsXG4gICAgLy8gc2Nyb2xsaW5nIGVudGlyZWx5IGhlcmUuIEl0J2xsIGJlIHNsaWdodGx5IG9mZiBmcm9tIG5hdGl2ZSwgYnV0XG4gICAgLy8gYmV0dGVyIHRoYW4gZ2xpdGNoaW5nIG91dC5cbiAgICBpZiAoZHggJiYgIWdlY2tvICYmICFwcmVzdG8gJiYgd2hlZWxQaXhlbHNQZXJVbml0ICE9IG51bGwpIHtcbiAgICAgIGlmIChkeSAmJiBjYW5TY3JvbGxZKVxuICAgICAgICBzZXRTY3JvbGxUb3AoY20sIE1hdGgubWF4KDAsIE1hdGgubWluKHNjcm9sbC5zY3JvbGxUb3AgKyBkeSAqIHdoZWVsUGl4ZWxzUGVyVW5pdCwgc2Nyb2xsLnNjcm9sbEhlaWdodCAtIHNjcm9sbC5jbGllbnRIZWlnaHQpKSk7XG4gICAgICBzZXRTY3JvbGxMZWZ0KGNtLCBNYXRoLm1heCgwLCBNYXRoLm1pbihzY3JvbGwuc2Nyb2xsTGVmdCArIGR4ICogd2hlZWxQaXhlbHNQZXJVbml0LCBzY3JvbGwuc2Nyb2xsV2lkdGggLSBzY3JvbGwuY2xpZW50V2lkdGgpKSk7XG4gICAgICAvLyBPbmx5IHByZXZlbnQgZGVmYXVsdCBzY3JvbGxpbmcgaWYgdmVydGljYWwgc2Nyb2xsaW5nIGlzXG4gICAgICAvLyBhY3R1YWxseSBwb3NzaWJsZS4gT3RoZXJ3aXNlLCBpdCBjYXVzZXMgdmVydGljYWwgc2Nyb2xsXG4gICAgICAvLyBqaXR0ZXIgb24gT1NYIHRyYWNrcGFkcyB3aGVuIGRlbHRhWCBpcyBzbWFsbCBhbmQgZGVsdGFZXG4gICAgICAvLyBpcyBsYXJnZSAoaXNzdWUgIzM1NzkpXG4gICAgICBpZiAoIWR5IHx8IChkeSAmJiBjYW5TY3JvbGxZKSlcbiAgICAgICAgZV9wcmV2ZW50RGVmYXVsdChlKTtcbiAgICAgIGRpc3BsYXkud2hlZWxTdGFydFggPSBudWxsOyAvLyBBYm9ydCBtZWFzdXJlbWVudCwgaWYgaW4gcHJvZ3Jlc3NcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyAnUHJvamVjdCcgdGhlIHZpc2libGUgdmlld3BvcnQgdG8gY292ZXIgdGhlIGFyZWEgdGhhdCBpcyBiZWluZ1xuICAgIC8vIHNjcm9sbGVkIGludG8gdmlldyAoaWYgd2Uga25vdyBlbm91Z2ggdG8gZXN0aW1hdGUgaXQpLlxuICAgIGlmIChkeSAmJiB3aGVlbFBpeGVsc1BlclVuaXQgIT0gbnVsbCkge1xuICAgICAgdmFyIHBpeGVscyA9IGR5ICogd2hlZWxQaXhlbHNQZXJVbml0O1xuICAgICAgdmFyIHRvcCA9IGNtLmRvYy5zY3JvbGxUb3AsIGJvdCA9IHRvcCArIGRpc3BsYXkud3JhcHBlci5jbGllbnRIZWlnaHQ7XG4gICAgICBpZiAocGl4ZWxzIDwgMCkgdG9wID0gTWF0aC5tYXgoMCwgdG9wICsgcGl4ZWxzIC0gNTApO1xuICAgICAgZWxzZSBib3QgPSBNYXRoLm1pbihjbS5kb2MuaGVpZ2h0LCBib3QgKyBwaXhlbHMgKyA1MCk7XG4gICAgICB1cGRhdGVEaXNwbGF5U2ltcGxlKGNtLCB7dG9wOiB0b3AsIGJvdHRvbTogYm90fSk7XG4gICAgfVxuXG4gICAgaWYgKHdoZWVsU2FtcGxlcyA8IDIwKSB7XG4gICAgICBpZiAoZGlzcGxheS53aGVlbFN0YXJ0WCA9PSBudWxsKSB7XG4gICAgICAgIGRpc3BsYXkud2hlZWxTdGFydFggPSBzY3JvbGwuc2Nyb2xsTGVmdDsgZGlzcGxheS53aGVlbFN0YXJ0WSA9IHNjcm9sbC5zY3JvbGxUb3A7XG4gICAgICAgIGRpc3BsYXkud2hlZWxEWCA9IGR4OyBkaXNwbGF5LndoZWVsRFkgPSBkeTtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiAoZGlzcGxheS53aGVlbFN0YXJ0WCA9PSBudWxsKSByZXR1cm47XG4gICAgICAgICAgdmFyIG1vdmVkWCA9IHNjcm9sbC5zY3JvbGxMZWZ0IC0gZGlzcGxheS53aGVlbFN0YXJ0WDtcbiAgICAgICAgICB2YXIgbW92ZWRZID0gc2Nyb2xsLnNjcm9sbFRvcCAtIGRpc3BsYXkud2hlZWxTdGFydFk7XG4gICAgICAgICAgdmFyIHNhbXBsZSA9IChtb3ZlZFkgJiYgZGlzcGxheS53aGVlbERZICYmIG1vdmVkWSAvIGRpc3BsYXkud2hlZWxEWSkgfHxcbiAgICAgICAgICAgIChtb3ZlZFggJiYgZGlzcGxheS53aGVlbERYICYmIG1vdmVkWCAvIGRpc3BsYXkud2hlZWxEWCk7XG4gICAgICAgICAgZGlzcGxheS53aGVlbFN0YXJ0WCA9IGRpc3BsYXkud2hlZWxTdGFydFkgPSBudWxsO1xuICAgICAgICAgIGlmICghc2FtcGxlKSByZXR1cm47XG4gICAgICAgICAgd2hlZWxQaXhlbHNQZXJVbml0ID0gKHdoZWVsUGl4ZWxzUGVyVW5pdCAqIHdoZWVsU2FtcGxlcyArIHNhbXBsZSkgLyAod2hlZWxTYW1wbGVzICsgMSk7XG4gICAgICAgICAgKyt3aGVlbFNhbXBsZXM7XG4gICAgICAgIH0sIDIwMCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkaXNwbGF5LndoZWVsRFggKz0gZHg7IGRpc3BsYXkud2hlZWxEWSArPSBkeTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBLRVkgRVZFTlRTXG5cbiAgLy8gUnVuIGEgaGFuZGxlciB0aGF0IHdhcyBib3VuZCB0byBhIGtleS5cbiAgZnVuY3Rpb24gZG9IYW5kbGVCaW5kaW5nKGNtLCBib3VuZCwgZHJvcFNoaWZ0KSB7XG4gICAgaWYgKHR5cGVvZiBib3VuZCA9PSBcInN0cmluZ1wiKSB7XG4gICAgICBib3VuZCA9IGNvbW1hbmRzW2JvdW5kXTtcbiAgICAgIGlmICghYm91bmQpIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLy8gRW5zdXJlIHByZXZpb3VzIGlucHV0IGhhcyBiZWVuIHJlYWQsIHNvIHRoYXQgdGhlIGhhbmRsZXIgc2VlcyBhXG4gICAgLy8gY29uc2lzdGVudCB2aWV3IG9mIHRoZSBkb2N1bWVudFxuICAgIGNtLmRpc3BsYXkuaW5wdXQuZW5zdXJlUG9sbGVkKCk7XG4gICAgdmFyIHByZXZTaGlmdCA9IGNtLmRpc3BsYXkuc2hpZnQsIGRvbmUgPSBmYWxzZTtcbiAgICB0cnkge1xuICAgICAgaWYgKGlzUmVhZE9ubHkoY20pKSBjbS5zdGF0ZS5zdXBwcmVzc0VkaXRzID0gdHJ1ZTtcbiAgICAgIGlmIChkcm9wU2hpZnQpIGNtLmRpc3BsYXkuc2hpZnQgPSBmYWxzZTtcbiAgICAgIGRvbmUgPSBib3VuZChjbSkgIT0gUGFzcztcbiAgICB9IGZpbmFsbHkge1xuICAgICAgY20uZGlzcGxheS5zaGlmdCA9IHByZXZTaGlmdDtcbiAgICAgIGNtLnN0YXRlLnN1cHByZXNzRWRpdHMgPSBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIGRvbmU7XG4gIH1cblxuICBmdW5jdGlvbiBsb29rdXBLZXlGb3JFZGl0b3IoY20sIG5hbWUsIGhhbmRsZSkge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY20uc3RhdGUua2V5TWFwcy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIHJlc3VsdCA9IGxvb2t1cEtleShuYW1lLCBjbS5zdGF0ZS5rZXlNYXBzW2ldLCBoYW5kbGUsIGNtKTtcbiAgICAgIGlmIChyZXN1bHQpIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIHJldHVybiAoY20ub3B0aW9ucy5leHRyYUtleXMgJiYgbG9va3VwS2V5KG5hbWUsIGNtLm9wdGlvbnMuZXh0cmFLZXlzLCBoYW5kbGUsIGNtKSlcbiAgICAgIHx8IGxvb2t1cEtleShuYW1lLCBjbS5vcHRpb25zLmtleU1hcCwgaGFuZGxlLCBjbSk7XG4gIH1cblxuICB2YXIgc3RvcFNlcSA9IG5ldyBEZWxheWVkO1xuICBmdW5jdGlvbiBkaXNwYXRjaEtleShjbSwgbmFtZSwgZSwgaGFuZGxlKSB7XG4gICAgdmFyIHNlcSA9IGNtLnN0YXRlLmtleVNlcTtcbiAgICBpZiAoc2VxKSB7XG4gICAgICBpZiAoaXNNb2RpZmllcktleShuYW1lKSkgcmV0dXJuIFwiaGFuZGxlZFwiO1xuICAgICAgc3RvcFNlcS5zZXQoNTAsIGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoY20uc3RhdGUua2V5U2VxID09IHNlcSkge1xuICAgICAgICAgIGNtLnN0YXRlLmtleVNlcSA9IG51bGw7XG4gICAgICAgICAgY20uZGlzcGxheS5pbnB1dC5yZXNldCgpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIG5hbWUgPSBzZXEgKyBcIiBcIiArIG5hbWU7XG4gICAgfVxuICAgIHZhciByZXN1bHQgPSBsb29rdXBLZXlGb3JFZGl0b3IoY20sIG5hbWUsIGhhbmRsZSk7XG5cbiAgICBpZiAocmVzdWx0ID09IFwibXVsdGlcIilcbiAgICAgIGNtLnN0YXRlLmtleVNlcSA9IG5hbWU7XG4gICAgaWYgKHJlc3VsdCA9PSBcImhhbmRsZWRcIilcbiAgICAgIHNpZ25hbExhdGVyKGNtLCBcImtleUhhbmRsZWRcIiwgY20sIG5hbWUsIGUpO1xuXG4gICAgaWYgKHJlc3VsdCA9PSBcImhhbmRsZWRcIiB8fCByZXN1bHQgPT0gXCJtdWx0aVwiKSB7XG4gICAgICBlX3ByZXZlbnREZWZhdWx0KGUpO1xuICAgICAgcmVzdGFydEJsaW5rKGNtKTtcbiAgICB9XG5cbiAgICBpZiAoc2VxICYmICFyZXN1bHQgJiYgL1xcJyQvLnRlc3QobmFtZSkpIHtcbiAgICAgIGVfcHJldmVudERlZmF1bHQoZSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuICEhcmVzdWx0O1xuICB9XG5cbiAgLy8gSGFuZGxlIGEga2V5IGZyb20gdGhlIGtleWRvd24gZXZlbnQuXG4gIGZ1bmN0aW9uIGhhbmRsZUtleUJpbmRpbmcoY20sIGUpIHtcbiAgICB2YXIgbmFtZSA9IGtleU5hbWUoZSwgdHJ1ZSk7XG4gICAgaWYgKCFuYW1lKSByZXR1cm4gZmFsc2U7XG5cbiAgICBpZiAoZS5zaGlmdEtleSAmJiAhY20uc3RhdGUua2V5U2VxKSB7XG4gICAgICAvLyBGaXJzdCB0cnkgdG8gcmVzb2x2ZSBmdWxsIG5hbWUgKGluY2x1ZGluZyAnU2hpZnQtJykuIEZhaWxpbmdcbiAgICAgIC8vIHRoYXQsIHNlZSBpZiB0aGVyZSBpcyBhIGN1cnNvci1tb3Rpb24gY29tbWFuZCAoc3RhcnRpbmcgd2l0aFxuICAgICAgLy8gJ2dvJykgYm91bmQgdG8gdGhlIGtleW5hbWUgd2l0aG91dCAnU2hpZnQtJy5cbiAgICAgIHJldHVybiBkaXNwYXRjaEtleShjbSwgXCJTaGlmdC1cIiArIG5hbWUsIGUsIGZ1bmN0aW9uKGIpIHtyZXR1cm4gZG9IYW5kbGVCaW5kaW5nKGNtLCBiLCB0cnVlKTt9KVxuICAgICAgICAgIHx8IGRpc3BhdGNoS2V5KGNtLCBuYW1lLCBlLCBmdW5jdGlvbihiKSB7XG4gICAgICAgICAgICAgICBpZiAodHlwZW9mIGIgPT0gXCJzdHJpbmdcIiA/IC9eZ29bQS1aXS8udGVzdChiKSA6IGIubW90aW9uKVxuICAgICAgICAgICAgICAgICByZXR1cm4gZG9IYW5kbGVCaW5kaW5nKGNtLCBiKTtcbiAgICAgICAgICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGRpc3BhdGNoS2V5KGNtLCBuYW1lLCBlLCBmdW5jdGlvbihiKSB7IHJldHVybiBkb0hhbmRsZUJpbmRpbmcoY20sIGIpOyB9KTtcbiAgICB9XG4gIH1cblxuICAvLyBIYW5kbGUgYSBrZXkgZnJvbSB0aGUga2V5cHJlc3MgZXZlbnRcbiAgZnVuY3Rpb24gaGFuZGxlQ2hhckJpbmRpbmcoY20sIGUsIGNoKSB7XG4gICAgcmV0dXJuIGRpc3BhdGNoS2V5KGNtLCBcIidcIiArIGNoICsgXCInXCIsIGUsXG4gICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGIpIHsgcmV0dXJuIGRvSGFuZGxlQmluZGluZyhjbSwgYiwgdHJ1ZSk7IH0pO1xuICB9XG5cbiAgdmFyIGxhc3RTdG9wcGVkS2V5ID0gbnVsbDtcbiAgZnVuY3Rpb24gb25LZXlEb3duKGUpIHtcbiAgICB2YXIgY20gPSB0aGlzO1xuICAgIGNtLmN1ck9wLmZvY3VzID0gYWN0aXZlRWx0KCk7XG4gICAgaWYgKHNpZ25hbERPTUV2ZW50KGNtLCBlKSkgcmV0dXJuO1xuICAgIC8vIElFIGRvZXMgc3RyYW5nZSB0aGluZ3Mgd2l0aCBlc2NhcGUuXG4gICAgaWYgKGllICYmIGllX3ZlcnNpb24gPCAxMSAmJiBlLmtleUNvZGUgPT0gMjcpIGUucmV0dXJuVmFsdWUgPSBmYWxzZTtcbiAgICB2YXIgY29kZSA9IGUua2V5Q29kZTtcbiAgICBjbS5kaXNwbGF5LnNoaWZ0ID0gY29kZSA9PSAxNiB8fCBlLnNoaWZ0S2V5O1xuICAgIHZhciBoYW5kbGVkID0gaGFuZGxlS2V5QmluZGluZyhjbSwgZSk7XG4gICAgaWYgKHByZXN0bykge1xuICAgICAgbGFzdFN0b3BwZWRLZXkgPSBoYW5kbGVkID8gY29kZSA6IG51bGw7XG4gICAgICAvLyBPcGVyYSBoYXMgbm8gY3V0IGV2ZW50Li4uIHdlIHRyeSB0byBhdCBsZWFzdCBjYXRjaCB0aGUga2V5IGNvbWJvXG4gICAgICBpZiAoIWhhbmRsZWQgJiYgY29kZSA9PSA4OCAmJiAhaGFzQ29weUV2ZW50ICYmIChtYWMgPyBlLm1ldGFLZXkgOiBlLmN0cmxLZXkpKVxuICAgICAgICBjbS5yZXBsYWNlU2VsZWN0aW9uKFwiXCIsIG51bGwsIFwiY3V0XCIpO1xuICAgIH1cblxuICAgIC8vIFR1cm4gbW91c2UgaW50byBjcm9zc2hhaXIgd2hlbiBBbHQgaXMgaGVsZCBvbiBNYWMuXG4gICAgaWYgKGNvZGUgPT0gMTggJiYgIS9cXGJDb2RlTWlycm9yLWNyb3NzaGFpclxcYi8udGVzdChjbS5kaXNwbGF5LmxpbmVEaXYuY2xhc3NOYW1lKSlcbiAgICAgIHNob3dDcm9zc0hhaXIoY20pO1xuICB9XG5cbiAgZnVuY3Rpb24gc2hvd0Nyb3NzSGFpcihjbSkge1xuICAgIHZhciBsaW5lRGl2ID0gY20uZGlzcGxheS5saW5lRGl2O1xuICAgIGFkZENsYXNzKGxpbmVEaXYsIFwiQ29kZU1pcnJvci1jcm9zc2hhaXJcIik7XG5cbiAgICBmdW5jdGlvbiB1cChlKSB7XG4gICAgICBpZiAoZS5rZXlDb2RlID09IDE4IHx8ICFlLmFsdEtleSkge1xuICAgICAgICBybUNsYXNzKGxpbmVEaXYsIFwiQ29kZU1pcnJvci1jcm9zc2hhaXJcIik7XG4gICAgICAgIG9mZihkb2N1bWVudCwgXCJrZXl1cFwiLCB1cCk7XG4gICAgICAgIG9mZihkb2N1bWVudCwgXCJtb3VzZW92ZXJcIiwgdXApO1xuICAgICAgfVxuICAgIH1cbiAgICBvbihkb2N1bWVudCwgXCJrZXl1cFwiLCB1cCk7XG4gICAgb24oZG9jdW1lbnQsIFwibW91c2VvdmVyXCIsIHVwKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9uS2V5VXAoZSkge1xuICAgIGlmIChlLmtleUNvZGUgPT0gMTYpIHRoaXMuZG9jLnNlbC5zaGlmdCA9IGZhbHNlO1xuICAgIHNpZ25hbERPTUV2ZW50KHRoaXMsIGUpO1xuICB9XG5cbiAgZnVuY3Rpb24gb25LZXlQcmVzcyhlKSB7XG4gICAgdmFyIGNtID0gdGhpcztcbiAgICBpZiAoZXZlbnRJbldpZGdldChjbS5kaXNwbGF5LCBlKSB8fCBzaWduYWxET01FdmVudChjbSwgZSkgfHwgZS5jdHJsS2V5ICYmICFlLmFsdEtleSB8fCBtYWMgJiYgZS5tZXRhS2V5KSByZXR1cm47XG4gICAgdmFyIGtleUNvZGUgPSBlLmtleUNvZGUsIGNoYXJDb2RlID0gZS5jaGFyQ29kZTtcbiAgICBpZiAocHJlc3RvICYmIGtleUNvZGUgPT0gbGFzdFN0b3BwZWRLZXkpIHtsYXN0U3RvcHBlZEtleSA9IG51bGw7IGVfcHJldmVudERlZmF1bHQoZSk7IHJldHVybjt9XG4gICAgaWYgKChwcmVzdG8gJiYgKCFlLndoaWNoIHx8IGUud2hpY2ggPCAxMCkpICYmIGhhbmRsZUtleUJpbmRpbmcoY20sIGUpKSByZXR1cm47XG4gICAgdmFyIGNoID0gU3RyaW5nLmZyb21DaGFyQ29kZShjaGFyQ29kZSA9PSBudWxsID8ga2V5Q29kZSA6IGNoYXJDb2RlKTtcbiAgICBpZiAoaGFuZGxlQ2hhckJpbmRpbmcoY20sIGUsIGNoKSkgcmV0dXJuO1xuICAgIGNtLmRpc3BsYXkuaW5wdXQub25LZXlQcmVzcyhlKTtcbiAgfVxuXG4gIC8vIEZPQ1VTL0JMVVIgRVZFTlRTXG5cbiAgZnVuY3Rpb24gZGVsYXlCbHVyRXZlbnQoY20pIHtcbiAgICBjbS5zdGF0ZS5kZWxheWluZ0JsdXJFdmVudCA9IHRydWU7XG4gICAgc2V0VGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgIGlmIChjbS5zdGF0ZS5kZWxheWluZ0JsdXJFdmVudCkge1xuICAgICAgICBjbS5zdGF0ZS5kZWxheWluZ0JsdXJFdmVudCA9IGZhbHNlO1xuICAgICAgICBvbkJsdXIoY20pO1xuICAgICAgfVxuICAgIH0sIDEwMCk7XG4gIH1cblxuICBmdW5jdGlvbiBvbkZvY3VzKGNtKSB7XG4gICAgaWYgKGNtLnN0YXRlLmRlbGF5aW5nQmx1ckV2ZW50KSBjbS5zdGF0ZS5kZWxheWluZ0JsdXJFdmVudCA9IGZhbHNlO1xuXG4gICAgaWYgKGNtLm9wdGlvbnMucmVhZE9ubHkgPT0gXCJub2N1cnNvclwiKSByZXR1cm47XG4gICAgaWYgKCFjbS5zdGF0ZS5mb2N1c2VkKSB7XG4gICAgICBzaWduYWwoY20sIFwiZm9jdXNcIiwgY20pO1xuICAgICAgY20uc3RhdGUuZm9jdXNlZCA9IHRydWU7XG4gICAgICBhZGRDbGFzcyhjbS5kaXNwbGF5LndyYXBwZXIsIFwiQ29kZU1pcnJvci1mb2N1c2VkXCIpO1xuICAgICAgLy8gVGhpcyB0ZXN0IHByZXZlbnRzIHRoaXMgZnJvbSBmaXJpbmcgd2hlbiBhIGNvbnRleHRcbiAgICAgIC8vIG1lbnUgaXMgY2xvc2VkIChzaW5jZSB0aGUgaW5wdXQgcmVzZXQgd291bGQga2lsbCB0aGVcbiAgICAgIC8vIHNlbGVjdC1hbGwgZGV0ZWN0aW9uIGhhY2spXG4gICAgICBpZiAoIWNtLmN1ck9wICYmIGNtLmRpc3BsYXkuc2VsRm9yQ29udGV4dE1lbnUgIT0gY20uZG9jLnNlbCkge1xuICAgICAgICBjbS5kaXNwbGF5LmlucHV0LnJlc2V0KCk7XG4gICAgICAgIGlmICh3ZWJraXQpIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7IGNtLmRpc3BsYXkuaW5wdXQucmVzZXQodHJ1ZSk7IH0sIDIwKTsgLy8gSXNzdWUgIzE3MzBcbiAgICAgIH1cbiAgICAgIGNtLmRpc3BsYXkuaW5wdXQucmVjZWl2ZWRGb2N1cygpO1xuICAgIH1cbiAgICByZXN0YXJ0QmxpbmsoY20pO1xuICB9XG4gIGZ1bmN0aW9uIG9uQmx1cihjbSkge1xuICAgIGlmIChjbS5zdGF0ZS5kZWxheWluZ0JsdXJFdmVudCkgcmV0dXJuO1xuXG4gICAgaWYgKGNtLnN0YXRlLmZvY3VzZWQpIHtcbiAgICAgIHNpZ25hbChjbSwgXCJibHVyXCIsIGNtKTtcbiAgICAgIGNtLnN0YXRlLmZvY3VzZWQgPSBmYWxzZTtcbiAgICAgIHJtQ2xhc3MoY20uZGlzcGxheS53cmFwcGVyLCBcIkNvZGVNaXJyb3ItZm9jdXNlZFwiKTtcbiAgICB9XG4gICAgY2xlYXJJbnRlcnZhbChjbS5kaXNwbGF5LmJsaW5rZXIpO1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7aWYgKCFjbS5zdGF0ZS5mb2N1c2VkKSBjbS5kaXNwbGF5LnNoaWZ0ID0gZmFsc2U7fSwgMTUwKTtcbiAgfVxuXG4gIC8vIENPTlRFWFQgTUVOVSBIQU5ETElOR1xuXG4gIC8vIFRvIG1ha2UgdGhlIGNvbnRleHQgbWVudSB3b3JrLCB3ZSBuZWVkIHRvIGJyaWVmbHkgdW5oaWRlIHRoZVxuICAvLyB0ZXh0YXJlYSAobWFraW5nIGl0IGFzIHVub2J0cnVzaXZlIGFzIHBvc3NpYmxlKSB0byBsZXQgdGhlXG4gIC8vIHJpZ2h0LWNsaWNrIHRha2UgZWZmZWN0IG9uIGl0LlxuICBmdW5jdGlvbiBvbkNvbnRleHRNZW51KGNtLCBlKSB7XG4gICAgaWYgKGV2ZW50SW5XaWRnZXQoY20uZGlzcGxheSwgZSkgfHwgY29udGV4dE1lbnVJbkd1dHRlcihjbSwgZSkpIHJldHVybjtcbiAgICBpZiAoc2lnbmFsRE9NRXZlbnQoY20sIGUsIFwiY29udGV4dG1lbnVcIikpIHJldHVybjtcbiAgICBjbS5kaXNwbGF5LmlucHV0Lm9uQ29udGV4dE1lbnUoZSk7XG4gIH1cblxuICBmdW5jdGlvbiBjb250ZXh0TWVudUluR3V0dGVyKGNtLCBlKSB7XG4gICAgaWYgKCFoYXNIYW5kbGVyKGNtLCBcImd1dHRlckNvbnRleHRNZW51XCIpKSByZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuIGd1dHRlckV2ZW50KGNtLCBlLCBcImd1dHRlckNvbnRleHRNZW51XCIsIGZhbHNlLCBzaWduYWwpO1xuICB9XG5cbiAgLy8gVVBEQVRJTkdcblxuICAvLyBDb21wdXRlIHRoZSBwb3NpdGlvbiBvZiB0aGUgZW5kIG9mIGEgY2hhbmdlIChpdHMgJ3RvJyBwcm9wZXJ0eVxuICAvLyByZWZlcnMgdG8gdGhlIHByZS1jaGFuZ2UgZW5kKS5cbiAgdmFyIGNoYW5nZUVuZCA9IENvZGVNaXJyb3IuY2hhbmdlRW5kID0gZnVuY3Rpb24oY2hhbmdlKSB7XG4gICAgaWYgKCFjaGFuZ2UudGV4dCkgcmV0dXJuIGNoYW5nZS50bztcbiAgICByZXR1cm4gUG9zKGNoYW5nZS5mcm9tLmxpbmUgKyBjaGFuZ2UudGV4dC5sZW5ndGggLSAxLFxuICAgICAgICAgICAgICAgbHN0KGNoYW5nZS50ZXh0KS5sZW5ndGggKyAoY2hhbmdlLnRleHQubGVuZ3RoID09IDEgPyBjaGFuZ2UuZnJvbS5jaCA6IDApKTtcbiAgfTtcblxuICAvLyBBZGp1c3QgYSBwb3NpdGlvbiB0byByZWZlciB0byB0aGUgcG9zdC1jaGFuZ2UgcG9zaXRpb24gb2YgdGhlXG4gIC8vIHNhbWUgdGV4dCwgb3IgdGhlIGVuZCBvZiB0aGUgY2hhbmdlIGlmIHRoZSBjaGFuZ2UgY292ZXJzIGl0LlxuICBmdW5jdGlvbiBhZGp1c3RGb3JDaGFuZ2UocG9zLCBjaGFuZ2UpIHtcbiAgICBpZiAoY21wKHBvcywgY2hhbmdlLmZyb20pIDwgMCkgcmV0dXJuIHBvcztcbiAgICBpZiAoY21wKHBvcywgY2hhbmdlLnRvKSA8PSAwKSByZXR1cm4gY2hhbmdlRW5kKGNoYW5nZSk7XG5cbiAgICB2YXIgbGluZSA9IHBvcy5saW5lICsgY2hhbmdlLnRleHQubGVuZ3RoIC0gKGNoYW5nZS50by5saW5lIC0gY2hhbmdlLmZyb20ubGluZSkgLSAxLCBjaCA9IHBvcy5jaDtcbiAgICBpZiAocG9zLmxpbmUgPT0gY2hhbmdlLnRvLmxpbmUpIGNoICs9IGNoYW5nZUVuZChjaGFuZ2UpLmNoIC0gY2hhbmdlLnRvLmNoO1xuICAgIHJldHVybiBQb3MobGluZSwgY2gpO1xuICB9XG5cbiAgZnVuY3Rpb24gY29tcHV0ZVNlbEFmdGVyQ2hhbmdlKGRvYywgY2hhbmdlKSB7XG4gICAgdmFyIG91dCA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZG9jLnNlbC5yYW5nZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciByYW5nZSA9IGRvYy5zZWwucmFuZ2VzW2ldO1xuICAgICAgb3V0LnB1c2gobmV3IFJhbmdlKGFkanVzdEZvckNoYW5nZShyYW5nZS5hbmNob3IsIGNoYW5nZSksXG4gICAgICAgICAgICAgICAgICAgICAgICAgYWRqdXN0Rm9yQ2hhbmdlKHJhbmdlLmhlYWQsIGNoYW5nZSkpKTtcbiAgICB9XG4gICAgcmV0dXJuIG5vcm1hbGl6ZVNlbGVjdGlvbihvdXQsIGRvYy5zZWwucHJpbUluZGV4KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIG9mZnNldFBvcyhwb3MsIG9sZCwgbncpIHtcbiAgICBpZiAocG9zLmxpbmUgPT0gb2xkLmxpbmUpXG4gICAgICByZXR1cm4gUG9zKG53LmxpbmUsIHBvcy5jaCAtIG9sZC5jaCArIG53LmNoKTtcbiAgICBlbHNlXG4gICAgICByZXR1cm4gUG9zKG53LmxpbmUgKyAocG9zLmxpbmUgLSBvbGQubGluZSksIHBvcy5jaCk7XG4gIH1cblxuICAvLyBVc2VkIGJ5IHJlcGxhY2VTZWxlY3Rpb25zIHRvIGFsbG93IG1vdmluZyB0aGUgc2VsZWN0aW9uIHRvIHRoZVxuICAvLyBzdGFydCBvciBhcm91bmQgdGhlIHJlcGxhY2VkIHRlc3QuIEhpbnQgbWF5IGJlIFwic3RhcnRcIiBvciBcImFyb3VuZFwiLlxuICBmdW5jdGlvbiBjb21wdXRlUmVwbGFjZWRTZWwoZG9jLCBjaGFuZ2VzLCBoaW50KSB7XG4gICAgdmFyIG91dCA9IFtdO1xuICAgIHZhciBvbGRQcmV2ID0gUG9zKGRvYy5maXJzdCwgMCksIG5ld1ByZXYgPSBvbGRQcmV2O1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGNoYW5nZSA9IGNoYW5nZXNbaV07XG4gICAgICB2YXIgZnJvbSA9IG9mZnNldFBvcyhjaGFuZ2UuZnJvbSwgb2xkUHJldiwgbmV3UHJldik7XG4gICAgICB2YXIgdG8gPSBvZmZzZXRQb3MoY2hhbmdlRW5kKGNoYW5nZSksIG9sZFByZXYsIG5ld1ByZXYpO1xuICAgICAgb2xkUHJldiA9IGNoYW5nZS50bztcbiAgICAgIG5ld1ByZXYgPSB0bztcbiAgICAgIGlmIChoaW50ID09IFwiYXJvdW5kXCIpIHtcbiAgICAgICAgdmFyIHJhbmdlID0gZG9jLnNlbC5yYW5nZXNbaV0sIGludiA9IGNtcChyYW5nZS5oZWFkLCByYW5nZS5hbmNob3IpIDwgMDtcbiAgICAgICAgb3V0W2ldID0gbmV3IFJhbmdlKGludiA/IHRvIDogZnJvbSwgaW52ID8gZnJvbSA6IHRvKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG91dFtpXSA9IG5ldyBSYW5nZShmcm9tLCBmcm9tKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG5ldyBTZWxlY3Rpb24ob3V0LCBkb2Muc2VsLnByaW1JbmRleCk7XG4gIH1cblxuICAvLyBBbGxvdyBcImJlZm9yZUNoYW5nZVwiIGV2ZW50IGhhbmRsZXJzIHRvIGluZmx1ZW5jZSBhIGNoYW5nZVxuICBmdW5jdGlvbiBmaWx0ZXJDaGFuZ2UoZG9jLCBjaGFuZ2UsIHVwZGF0ZSkge1xuICAgIHZhciBvYmogPSB7XG4gICAgICBjYW5jZWxlZDogZmFsc2UsXG4gICAgICBmcm9tOiBjaGFuZ2UuZnJvbSxcbiAgICAgIHRvOiBjaGFuZ2UudG8sXG4gICAgICB0ZXh0OiBjaGFuZ2UudGV4dCxcbiAgICAgIG9yaWdpbjogY2hhbmdlLm9yaWdpbixcbiAgICAgIGNhbmNlbDogZnVuY3Rpb24oKSB7IHRoaXMuY2FuY2VsZWQgPSB0cnVlOyB9XG4gICAgfTtcbiAgICBpZiAodXBkYXRlKSBvYmoudXBkYXRlID0gZnVuY3Rpb24oZnJvbSwgdG8sIHRleHQsIG9yaWdpbikge1xuICAgICAgaWYgKGZyb20pIHRoaXMuZnJvbSA9IGNsaXBQb3MoZG9jLCBmcm9tKTtcbiAgICAgIGlmICh0bykgdGhpcy50byA9IGNsaXBQb3MoZG9jLCB0byk7XG4gICAgICBpZiAodGV4dCkgdGhpcy50ZXh0ID0gdGV4dDtcbiAgICAgIGlmIChvcmlnaW4gIT09IHVuZGVmaW5lZCkgdGhpcy5vcmlnaW4gPSBvcmlnaW47XG4gICAgfTtcbiAgICBzaWduYWwoZG9jLCBcImJlZm9yZUNoYW5nZVwiLCBkb2MsIG9iaik7XG4gICAgaWYgKGRvYy5jbSkgc2lnbmFsKGRvYy5jbSwgXCJiZWZvcmVDaGFuZ2VcIiwgZG9jLmNtLCBvYmopO1xuXG4gICAgaWYgKG9iai5jYW5jZWxlZCkgcmV0dXJuIG51bGw7XG4gICAgcmV0dXJuIHtmcm9tOiBvYmouZnJvbSwgdG86IG9iai50bywgdGV4dDogb2JqLnRleHQsIG9yaWdpbjogb2JqLm9yaWdpbn07XG4gIH1cblxuICAvLyBBcHBseSBhIGNoYW5nZSB0byBhIGRvY3VtZW50LCBhbmQgYWRkIGl0IHRvIHRoZSBkb2N1bWVudCdzXG4gIC8vIGhpc3RvcnksIGFuZCBwcm9wYWdhdGluZyBpdCB0byBhbGwgbGlua2VkIGRvY3VtZW50cy5cbiAgZnVuY3Rpb24gbWFrZUNoYW5nZShkb2MsIGNoYW5nZSwgaWdub3JlUmVhZE9ubHkpIHtcbiAgICBpZiAoZG9jLmNtKSB7XG4gICAgICBpZiAoIWRvYy5jbS5jdXJPcCkgcmV0dXJuIG9wZXJhdGlvbihkb2MuY20sIG1ha2VDaGFuZ2UpKGRvYywgY2hhbmdlLCBpZ25vcmVSZWFkT25seSk7XG4gICAgICBpZiAoZG9jLmNtLnN0YXRlLnN1cHByZXNzRWRpdHMpIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoaGFzSGFuZGxlcihkb2MsIFwiYmVmb3JlQ2hhbmdlXCIpIHx8IGRvYy5jbSAmJiBoYXNIYW5kbGVyKGRvYy5jbSwgXCJiZWZvcmVDaGFuZ2VcIikpIHtcbiAgICAgIGNoYW5nZSA9IGZpbHRlckNoYW5nZShkb2MsIGNoYW5nZSwgdHJ1ZSk7XG4gICAgICBpZiAoIWNoYW5nZSkgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFBvc3NpYmx5IHNwbGl0IG9yIHN1cHByZXNzIHRoZSB1cGRhdGUgYmFzZWQgb24gdGhlIHByZXNlbmNlXG4gICAgLy8gb2YgcmVhZC1vbmx5IHNwYW5zIGluIGl0cyByYW5nZS5cbiAgICB2YXIgc3BsaXQgPSBzYXdSZWFkT25seVNwYW5zICYmICFpZ25vcmVSZWFkT25seSAmJiByZW1vdmVSZWFkT25seVJhbmdlcyhkb2MsIGNoYW5nZS5mcm9tLCBjaGFuZ2UudG8pO1xuICAgIGlmIChzcGxpdCkge1xuICAgICAgZm9yICh2YXIgaSA9IHNwbGl0Lmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKVxuICAgICAgICBtYWtlQ2hhbmdlSW5uZXIoZG9jLCB7ZnJvbTogc3BsaXRbaV0uZnJvbSwgdG86IHNwbGl0W2ldLnRvLCB0ZXh0OiBpID8gW1wiXCJdIDogY2hhbmdlLnRleHR9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgbWFrZUNoYW5nZUlubmVyKGRvYywgY2hhbmdlKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBtYWtlQ2hhbmdlSW5uZXIoZG9jLCBjaGFuZ2UpIHtcbiAgICBpZiAoY2hhbmdlLnRleHQubGVuZ3RoID09IDEgJiYgY2hhbmdlLnRleHRbMF0gPT0gXCJcIiAmJiBjbXAoY2hhbmdlLmZyb20sIGNoYW5nZS50bykgPT0gMCkgcmV0dXJuO1xuICAgIHZhciBzZWxBZnRlciA9IGNvbXB1dGVTZWxBZnRlckNoYW5nZShkb2MsIGNoYW5nZSk7XG4gICAgYWRkQ2hhbmdlVG9IaXN0b3J5KGRvYywgY2hhbmdlLCBzZWxBZnRlciwgZG9jLmNtID8gZG9jLmNtLmN1ck9wLmlkIDogTmFOKTtcblxuICAgIG1ha2VDaGFuZ2VTaW5nbGVEb2MoZG9jLCBjaGFuZ2UsIHNlbEFmdGVyLCBzdHJldGNoU3BhbnNPdmVyQ2hhbmdlKGRvYywgY2hhbmdlKSk7XG4gICAgdmFyIHJlYmFzZWQgPSBbXTtcblxuICAgIGxpbmtlZERvY3MoZG9jLCBmdW5jdGlvbihkb2MsIHNoYXJlZEhpc3QpIHtcbiAgICAgIGlmICghc2hhcmVkSGlzdCAmJiBpbmRleE9mKHJlYmFzZWQsIGRvYy5oaXN0b3J5KSA9PSAtMSkge1xuICAgICAgICByZWJhc2VIaXN0KGRvYy5oaXN0b3J5LCBjaGFuZ2UpO1xuICAgICAgICByZWJhc2VkLnB1c2goZG9jLmhpc3RvcnkpO1xuICAgICAgfVxuICAgICAgbWFrZUNoYW5nZVNpbmdsZURvYyhkb2MsIGNoYW5nZSwgbnVsbCwgc3RyZXRjaFNwYW5zT3ZlckNoYW5nZShkb2MsIGNoYW5nZSkpO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gUmV2ZXJ0IGEgY2hhbmdlIHN0b3JlZCBpbiBhIGRvY3VtZW50J3MgaGlzdG9yeS5cbiAgZnVuY3Rpb24gbWFrZUNoYW5nZUZyb21IaXN0b3J5KGRvYywgdHlwZSwgYWxsb3dTZWxlY3Rpb25Pbmx5KSB7XG4gICAgaWYgKGRvYy5jbSAmJiBkb2MuY20uc3RhdGUuc3VwcHJlc3NFZGl0cykgcmV0dXJuO1xuXG4gICAgdmFyIGhpc3QgPSBkb2MuaGlzdG9yeSwgZXZlbnQsIHNlbEFmdGVyID0gZG9jLnNlbDtcbiAgICB2YXIgc291cmNlID0gdHlwZSA9PSBcInVuZG9cIiA/IGhpc3QuZG9uZSA6IGhpc3QudW5kb25lLCBkZXN0ID0gdHlwZSA9PSBcInVuZG9cIiA/IGhpc3QudW5kb25lIDogaGlzdC5kb25lO1xuXG4gICAgLy8gVmVyaWZ5IHRoYXQgdGhlcmUgaXMgYSB1c2VhYmxlIGV2ZW50IChzbyB0aGF0IGN0cmwteiB3b24ndFxuICAgIC8vIG5lZWRsZXNzbHkgY2xlYXIgc2VsZWN0aW9uIGV2ZW50cylcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNvdXJjZS5sZW5ndGg7IGkrKykge1xuICAgICAgZXZlbnQgPSBzb3VyY2VbaV07XG4gICAgICBpZiAoYWxsb3dTZWxlY3Rpb25Pbmx5ID8gZXZlbnQucmFuZ2VzICYmICFldmVudC5lcXVhbHMoZG9jLnNlbCkgOiAhZXZlbnQucmFuZ2VzKVxuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgaWYgKGkgPT0gc291cmNlLmxlbmd0aCkgcmV0dXJuO1xuICAgIGhpc3QubGFzdE9yaWdpbiA9IGhpc3QubGFzdFNlbE9yaWdpbiA9IG51bGw7XG5cbiAgICBmb3IgKDs7KSB7XG4gICAgICBldmVudCA9IHNvdXJjZS5wb3AoKTtcbiAgICAgIGlmIChldmVudC5yYW5nZXMpIHtcbiAgICAgICAgcHVzaFNlbGVjdGlvblRvSGlzdG9yeShldmVudCwgZGVzdCk7XG4gICAgICAgIGlmIChhbGxvd1NlbGVjdGlvbk9ubHkgJiYgIWV2ZW50LmVxdWFscyhkb2Muc2VsKSkge1xuICAgICAgICAgIHNldFNlbGVjdGlvbihkb2MsIGV2ZW50LCB7Y2xlYXJSZWRvOiBmYWxzZX0pO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBzZWxBZnRlciA9IGV2ZW50O1xuICAgICAgfVxuICAgICAgZWxzZSBicmVhaztcbiAgICB9XG5cbiAgICAvLyBCdWlsZCB1cCBhIHJldmVyc2UgY2hhbmdlIG9iamVjdCB0byBhZGQgdG8gdGhlIG9wcG9zaXRlIGhpc3RvcnlcbiAgICAvLyBzdGFjayAocmVkbyB3aGVuIHVuZG9pbmcsIGFuZCB2aWNlIHZlcnNhKS5cbiAgICB2YXIgYW50aUNoYW5nZXMgPSBbXTtcbiAgICBwdXNoU2VsZWN0aW9uVG9IaXN0b3J5KHNlbEFmdGVyLCBkZXN0KTtcbiAgICBkZXN0LnB1c2goe2NoYW5nZXM6IGFudGlDaGFuZ2VzLCBnZW5lcmF0aW9uOiBoaXN0LmdlbmVyYXRpb259KTtcbiAgICBoaXN0LmdlbmVyYXRpb24gPSBldmVudC5nZW5lcmF0aW9uIHx8ICsraGlzdC5tYXhHZW5lcmF0aW9uO1xuXG4gICAgdmFyIGZpbHRlciA9IGhhc0hhbmRsZXIoZG9jLCBcImJlZm9yZUNoYW5nZVwiKSB8fCBkb2MuY20gJiYgaGFzSGFuZGxlcihkb2MuY20sIFwiYmVmb3JlQ2hhbmdlXCIpO1xuXG4gICAgZm9yICh2YXIgaSA9IGV2ZW50LmNoYW5nZXMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHtcbiAgICAgIHZhciBjaGFuZ2UgPSBldmVudC5jaGFuZ2VzW2ldO1xuICAgICAgY2hhbmdlLm9yaWdpbiA9IHR5cGU7XG4gICAgICBpZiAoZmlsdGVyICYmICFmaWx0ZXJDaGFuZ2UoZG9jLCBjaGFuZ2UsIGZhbHNlKSkge1xuICAgICAgICBzb3VyY2UubGVuZ3RoID0gMDtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBhbnRpQ2hhbmdlcy5wdXNoKGhpc3RvcnlDaGFuZ2VGcm9tQ2hhbmdlKGRvYywgY2hhbmdlKSk7XG5cbiAgICAgIHZhciBhZnRlciA9IGkgPyBjb21wdXRlU2VsQWZ0ZXJDaGFuZ2UoZG9jLCBjaGFuZ2UpIDogbHN0KHNvdXJjZSk7XG4gICAgICBtYWtlQ2hhbmdlU2luZ2xlRG9jKGRvYywgY2hhbmdlLCBhZnRlciwgbWVyZ2VPbGRTcGFucyhkb2MsIGNoYW5nZSkpO1xuICAgICAgaWYgKCFpICYmIGRvYy5jbSkgZG9jLmNtLnNjcm9sbEludG9WaWV3KHtmcm9tOiBjaGFuZ2UuZnJvbSwgdG86IGNoYW5nZUVuZChjaGFuZ2UpfSk7XG4gICAgICB2YXIgcmViYXNlZCA9IFtdO1xuXG4gICAgICAvLyBQcm9wYWdhdGUgdG8gdGhlIGxpbmtlZCBkb2N1bWVudHNcbiAgICAgIGxpbmtlZERvY3MoZG9jLCBmdW5jdGlvbihkb2MsIHNoYXJlZEhpc3QpIHtcbiAgICAgICAgaWYgKCFzaGFyZWRIaXN0ICYmIGluZGV4T2YocmViYXNlZCwgZG9jLmhpc3RvcnkpID09IC0xKSB7XG4gICAgICAgICAgcmViYXNlSGlzdChkb2MuaGlzdG9yeSwgY2hhbmdlKTtcbiAgICAgICAgICByZWJhc2VkLnB1c2goZG9jLmhpc3RvcnkpO1xuICAgICAgICB9XG4gICAgICAgIG1ha2VDaGFuZ2VTaW5nbGVEb2MoZG9jLCBjaGFuZ2UsIG51bGwsIG1lcmdlT2xkU3BhbnMoZG9jLCBjaGFuZ2UpKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8vIFN1Yi12aWV3cyBuZWVkIHRoZWlyIGxpbmUgbnVtYmVycyBzaGlmdGVkIHdoZW4gdGV4dCBpcyBhZGRlZFxuICAvLyBhYm92ZSBvciBiZWxvdyB0aGVtIGluIHRoZSBwYXJlbnQgZG9jdW1lbnQuXG4gIGZ1bmN0aW9uIHNoaWZ0RG9jKGRvYywgZGlzdGFuY2UpIHtcbiAgICBpZiAoZGlzdGFuY2UgPT0gMCkgcmV0dXJuO1xuICAgIGRvYy5maXJzdCArPSBkaXN0YW5jZTtcbiAgICBkb2Muc2VsID0gbmV3IFNlbGVjdGlvbihtYXAoZG9jLnNlbC5yYW5nZXMsIGZ1bmN0aW9uKHJhbmdlKSB7XG4gICAgICByZXR1cm4gbmV3IFJhbmdlKFBvcyhyYW5nZS5hbmNob3IubGluZSArIGRpc3RhbmNlLCByYW5nZS5hbmNob3IuY2gpLFxuICAgICAgICAgICAgICAgICAgICAgICBQb3MocmFuZ2UuaGVhZC5saW5lICsgZGlzdGFuY2UsIHJhbmdlLmhlYWQuY2gpKTtcbiAgICB9KSwgZG9jLnNlbC5wcmltSW5kZXgpO1xuICAgIGlmIChkb2MuY20pIHtcbiAgICAgIHJlZ0NoYW5nZShkb2MuY20sIGRvYy5maXJzdCwgZG9jLmZpcnN0IC0gZGlzdGFuY2UsIGRpc3RhbmNlKTtcbiAgICAgIGZvciAodmFyIGQgPSBkb2MuY20uZGlzcGxheSwgbCA9IGQudmlld0Zyb207IGwgPCBkLnZpZXdUbzsgbCsrKVxuICAgICAgICByZWdMaW5lQ2hhbmdlKGRvYy5jbSwgbCwgXCJndXR0ZXJcIik7XG4gICAgfVxuICB9XG5cbiAgLy8gTW9yZSBsb3dlci1sZXZlbCBjaGFuZ2UgZnVuY3Rpb24sIGhhbmRsaW5nIG9ubHkgYSBzaW5nbGUgZG9jdW1lbnRcbiAgLy8gKG5vdCBsaW5rZWQgb25lcykuXG4gIGZ1bmN0aW9uIG1ha2VDaGFuZ2VTaW5nbGVEb2MoZG9jLCBjaGFuZ2UsIHNlbEFmdGVyLCBzcGFucykge1xuICAgIGlmIChkb2MuY20gJiYgIWRvYy5jbS5jdXJPcClcbiAgICAgIHJldHVybiBvcGVyYXRpb24oZG9jLmNtLCBtYWtlQ2hhbmdlU2luZ2xlRG9jKShkb2MsIGNoYW5nZSwgc2VsQWZ0ZXIsIHNwYW5zKTtcblxuICAgIGlmIChjaGFuZ2UudG8ubGluZSA8IGRvYy5maXJzdCkge1xuICAgICAgc2hpZnREb2MoZG9jLCBjaGFuZ2UudGV4dC5sZW5ndGggLSAxIC0gKGNoYW5nZS50by5saW5lIC0gY2hhbmdlLmZyb20ubGluZSkpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY2hhbmdlLmZyb20ubGluZSA+IGRvYy5sYXN0TGluZSgpKSByZXR1cm47XG5cbiAgICAvLyBDbGlwIHRoZSBjaGFuZ2UgdG8gdGhlIHNpemUgb2YgdGhpcyBkb2NcbiAgICBpZiAoY2hhbmdlLmZyb20ubGluZSA8IGRvYy5maXJzdCkge1xuICAgICAgdmFyIHNoaWZ0ID0gY2hhbmdlLnRleHQubGVuZ3RoIC0gMSAtIChkb2MuZmlyc3QgLSBjaGFuZ2UuZnJvbS5saW5lKTtcbiAgICAgIHNoaWZ0RG9jKGRvYywgc2hpZnQpO1xuICAgICAgY2hhbmdlID0ge2Zyb206IFBvcyhkb2MuZmlyc3QsIDApLCB0bzogUG9zKGNoYW5nZS50by5saW5lICsgc2hpZnQsIGNoYW5nZS50by5jaCksXG4gICAgICAgICAgICAgICAgdGV4dDogW2xzdChjaGFuZ2UudGV4dCldLCBvcmlnaW46IGNoYW5nZS5vcmlnaW59O1xuICAgIH1cbiAgICB2YXIgbGFzdCA9IGRvYy5sYXN0TGluZSgpO1xuICAgIGlmIChjaGFuZ2UudG8ubGluZSA+IGxhc3QpIHtcbiAgICAgIGNoYW5nZSA9IHtmcm9tOiBjaGFuZ2UuZnJvbSwgdG86IFBvcyhsYXN0LCBnZXRMaW5lKGRvYywgbGFzdCkudGV4dC5sZW5ndGgpLFxuICAgICAgICAgICAgICAgIHRleHQ6IFtjaGFuZ2UudGV4dFswXV0sIG9yaWdpbjogY2hhbmdlLm9yaWdpbn07XG4gICAgfVxuXG4gICAgY2hhbmdlLnJlbW92ZWQgPSBnZXRCZXR3ZWVuKGRvYywgY2hhbmdlLmZyb20sIGNoYW5nZS50byk7XG5cbiAgICBpZiAoIXNlbEFmdGVyKSBzZWxBZnRlciA9IGNvbXB1dGVTZWxBZnRlckNoYW5nZShkb2MsIGNoYW5nZSk7XG4gICAgaWYgKGRvYy5jbSkgbWFrZUNoYW5nZVNpbmdsZURvY0luRWRpdG9yKGRvYy5jbSwgY2hhbmdlLCBzcGFucyk7XG4gICAgZWxzZSB1cGRhdGVEb2MoZG9jLCBjaGFuZ2UsIHNwYW5zKTtcbiAgICBzZXRTZWxlY3Rpb25Ob1VuZG8oZG9jLCBzZWxBZnRlciwgc2VsX2RvbnRTY3JvbGwpO1xuICB9XG5cbiAgLy8gSGFuZGxlIHRoZSBpbnRlcmFjdGlvbiBvZiBhIGNoYW5nZSB0byBhIGRvY3VtZW50IHdpdGggdGhlIGVkaXRvclxuICAvLyB0aGF0IHRoaXMgZG9jdW1lbnQgaXMgcGFydCBvZi5cbiAgZnVuY3Rpb24gbWFrZUNoYW5nZVNpbmdsZURvY0luRWRpdG9yKGNtLCBjaGFuZ2UsIHNwYW5zKSB7XG4gICAgdmFyIGRvYyA9IGNtLmRvYywgZGlzcGxheSA9IGNtLmRpc3BsYXksIGZyb20gPSBjaGFuZ2UuZnJvbSwgdG8gPSBjaGFuZ2UudG87XG5cbiAgICB2YXIgcmVjb21wdXRlTWF4TGVuZ3RoID0gZmFsc2UsIGNoZWNrV2lkdGhTdGFydCA9IGZyb20ubGluZTtcbiAgICBpZiAoIWNtLm9wdGlvbnMubGluZVdyYXBwaW5nKSB7XG4gICAgICBjaGVja1dpZHRoU3RhcnQgPSBsaW5lTm8odmlzdWFsTGluZShnZXRMaW5lKGRvYywgZnJvbS5saW5lKSkpO1xuICAgICAgZG9jLml0ZXIoY2hlY2tXaWR0aFN0YXJ0LCB0by5saW5lICsgMSwgZnVuY3Rpb24obGluZSkge1xuICAgICAgICBpZiAobGluZSA9PSBkaXNwbGF5Lm1heExpbmUpIHtcbiAgICAgICAgICByZWNvbXB1dGVNYXhMZW5ndGggPSB0cnVlO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoZG9jLnNlbC5jb250YWlucyhjaGFuZ2UuZnJvbSwgY2hhbmdlLnRvKSA+IC0xKVxuICAgICAgc2lnbmFsQ3Vyc29yQWN0aXZpdHkoY20pO1xuXG4gICAgdXBkYXRlRG9jKGRvYywgY2hhbmdlLCBzcGFucywgZXN0aW1hdGVIZWlnaHQoY20pKTtcblxuICAgIGlmICghY20ub3B0aW9ucy5saW5lV3JhcHBpbmcpIHtcbiAgICAgIGRvYy5pdGVyKGNoZWNrV2lkdGhTdGFydCwgZnJvbS5saW5lICsgY2hhbmdlLnRleHQubGVuZ3RoLCBmdW5jdGlvbihsaW5lKSB7XG4gICAgICAgIHZhciBsZW4gPSBsaW5lTGVuZ3RoKGxpbmUpO1xuICAgICAgICBpZiAobGVuID4gZGlzcGxheS5tYXhMaW5lTGVuZ3RoKSB7XG4gICAgICAgICAgZGlzcGxheS5tYXhMaW5lID0gbGluZTtcbiAgICAgICAgICBkaXNwbGF5Lm1heExpbmVMZW5ndGggPSBsZW47XG4gICAgICAgICAgZGlzcGxheS5tYXhMaW5lQ2hhbmdlZCA9IHRydWU7XG4gICAgICAgICAgcmVjb21wdXRlTWF4TGVuZ3RoID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgaWYgKHJlY29tcHV0ZU1heExlbmd0aCkgY20uY3VyT3AudXBkYXRlTWF4TGluZSA9IHRydWU7XG4gICAgfVxuXG4gICAgLy8gQWRqdXN0IGZyb250aWVyLCBzY2hlZHVsZSB3b3JrZXJcbiAgICBkb2MuZnJvbnRpZXIgPSBNYXRoLm1pbihkb2MuZnJvbnRpZXIsIGZyb20ubGluZSk7XG4gICAgc3RhcnRXb3JrZXIoY20sIDQwMCk7XG5cbiAgICB2YXIgbGVuZGlmZiA9IGNoYW5nZS50ZXh0Lmxlbmd0aCAtICh0by5saW5lIC0gZnJvbS5saW5lKSAtIDE7XG4gICAgLy8gUmVtZW1iZXIgdGhhdCB0aGVzZSBsaW5lcyBjaGFuZ2VkLCBmb3IgdXBkYXRpbmcgdGhlIGRpc3BsYXlcbiAgICBpZiAoY2hhbmdlLmZ1bGwpXG4gICAgICByZWdDaGFuZ2UoY20pO1xuICAgIGVsc2UgaWYgKGZyb20ubGluZSA9PSB0by5saW5lICYmIGNoYW5nZS50ZXh0Lmxlbmd0aCA9PSAxICYmICFpc1dob2xlTGluZVVwZGF0ZShjbS5kb2MsIGNoYW5nZSkpXG4gICAgICByZWdMaW5lQ2hhbmdlKGNtLCBmcm9tLmxpbmUsIFwidGV4dFwiKTtcbiAgICBlbHNlXG4gICAgICByZWdDaGFuZ2UoY20sIGZyb20ubGluZSwgdG8ubGluZSArIDEsIGxlbmRpZmYpO1xuXG4gICAgdmFyIGNoYW5nZXNIYW5kbGVyID0gaGFzSGFuZGxlcihjbSwgXCJjaGFuZ2VzXCIpLCBjaGFuZ2VIYW5kbGVyID0gaGFzSGFuZGxlcihjbSwgXCJjaGFuZ2VcIik7XG4gICAgaWYgKGNoYW5nZUhhbmRsZXIgfHwgY2hhbmdlc0hhbmRsZXIpIHtcbiAgICAgIHZhciBvYmogPSB7XG4gICAgICAgIGZyb206IGZyb20sIHRvOiB0byxcbiAgICAgICAgdGV4dDogY2hhbmdlLnRleHQsXG4gICAgICAgIHJlbW92ZWQ6IGNoYW5nZS5yZW1vdmVkLFxuICAgICAgICBvcmlnaW46IGNoYW5nZS5vcmlnaW5cbiAgICAgIH07XG4gICAgICBpZiAoY2hhbmdlSGFuZGxlcikgc2lnbmFsTGF0ZXIoY20sIFwiY2hhbmdlXCIsIGNtLCBvYmopO1xuICAgICAgaWYgKGNoYW5nZXNIYW5kbGVyKSAoY20uY3VyT3AuY2hhbmdlT2JqcyB8fCAoY20uY3VyT3AuY2hhbmdlT2JqcyA9IFtdKSkucHVzaChvYmopO1xuICAgIH1cbiAgICBjbS5kaXNwbGF5LnNlbEZvckNvbnRleHRNZW51ID0gbnVsbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlcGxhY2VSYW5nZShkb2MsIGNvZGUsIGZyb20sIHRvLCBvcmlnaW4pIHtcbiAgICBpZiAoIXRvKSB0byA9IGZyb207XG4gICAgaWYgKGNtcCh0bywgZnJvbSkgPCAwKSB7IHZhciB0bXAgPSB0bzsgdG8gPSBmcm9tOyBmcm9tID0gdG1wOyB9XG4gICAgaWYgKHR5cGVvZiBjb2RlID09IFwic3RyaW5nXCIpIGNvZGUgPSBkb2Muc3BsaXRMaW5lcyhjb2RlKTtcbiAgICBtYWtlQ2hhbmdlKGRvYywge2Zyb206IGZyb20sIHRvOiB0bywgdGV4dDogY29kZSwgb3JpZ2luOiBvcmlnaW59KTtcbiAgfVxuXG4gIC8vIFNDUk9MTElORyBUSElOR1MgSU5UTyBWSUVXXG5cbiAgLy8gSWYgYW4gZWRpdG9yIHNpdHMgb24gdGhlIHRvcCBvciBib3R0b20gb2YgdGhlIHdpbmRvdywgcGFydGlhbGx5XG4gIC8vIHNjcm9sbGVkIG91dCBvZiB2aWV3LCB0aGlzIGVuc3VyZXMgdGhhdCB0aGUgY3Vyc29yIGlzIHZpc2libGUuXG4gIGZ1bmN0aW9uIG1heWJlU2Nyb2xsV2luZG93KGNtLCBjb29yZHMpIHtcbiAgICBpZiAoc2lnbmFsRE9NRXZlbnQoY20sIFwic2Nyb2xsQ3Vyc29ySW50b1ZpZXdcIikpIHJldHVybjtcblxuICAgIHZhciBkaXNwbGF5ID0gY20uZGlzcGxheSwgYm94ID0gZGlzcGxheS5zaXplci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwgZG9TY3JvbGwgPSBudWxsO1xuICAgIGlmIChjb29yZHMudG9wICsgYm94LnRvcCA8IDApIGRvU2Nyb2xsID0gdHJ1ZTtcbiAgICBlbHNlIGlmIChjb29yZHMuYm90dG9tICsgYm94LnRvcCA+ICh3aW5kb3cuaW5uZXJIZWlnaHQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCkpIGRvU2Nyb2xsID0gZmFsc2U7XG4gICAgaWYgKGRvU2Nyb2xsICE9IG51bGwgJiYgIXBoYW50b20pIHtcbiAgICAgIHZhciBzY3JvbGxOb2RlID0gZWx0KFwiZGl2XCIsIFwiXFx1MjAwYlwiLCBudWxsLCBcInBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAoY29vcmRzLnRvcCAtIGRpc3BsYXkudmlld09mZnNldCAtIHBhZGRpbmdUb3AoY20uZGlzcGxheSkpICsgXCJweDsgaGVpZ2h0OiBcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAoY29vcmRzLmJvdHRvbSAtIGNvb3Jkcy50b3AgKyBzY3JvbGxHYXAoY20pICsgZGlzcGxheS5iYXJIZWlnaHQpICsgXCJweDsgbGVmdDogXCIgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgY29vcmRzLmxlZnQgKyBcInB4OyB3aWR0aDogMnB4O1wiKTtcbiAgICAgIGNtLmRpc3BsYXkubGluZVNwYWNlLmFwcGVuZENoaWxkKHNjcm9sbE5vZGUpO1xuICAgICAgc2Nyb2xsTm9kZS5zY3JvbGxJbnRvVmlldyhkb1Njcm9sbCk7XG4gICAgICBjbS5kaXNwbGF5LmxpbmVTcGFjZS5yZW1vdmVDaGlsZChzY3JvbGxOb2RlKTtcbiAgICB9XG4gIH1cblxuICAvLyBTY3JvbGwgYSBnaXZlbiBwb3NpdGlvbiBpbnRvIHZpZXcgKGltbWVkaWF0ZWx5KSwgdmVyaWZ5aW5nIHRoYXRcbiAgLy8gaXQgYWN0dWFsbHkgYmVjYW1lIHZpc2libGUgKGFzIGxpbmUgaGVpZ2h0cyBhcmUgYWNjdXJhdGVseVxuICAvLyBtZWFzdXJlZCwgdGhlIHBvc2l0aW9uIG9mIHNvbWV0aGluZyBtYXkgJ2RyaWZ0JyBkdXJpbmcgZHJhd2luZykuXG4gIGZ1bmN0aW9uIHNjcm9sbFBvc0ludG9WaWV3KGNtLCBwb3MsIGVuZCwgbWFyZ2luKSB7XG4gICAgaWYgKG1hcmdpbiA9PSBudWxsKSBtYXJnaW4gPSAwO1xuICAgIGZvciAodmFyIGxpbWl0ID0gMDsgbGltaXQgPCA1OyBsaW1pdCsrKSB7XG4gICAgICB2YXIgY2hhbmdlZCA9IGZhbHNlLCBjb29yZHMgPSBjdXJzb3JDb29yZHMoY20sIHBvcyk7XG4gICAgICB2YXIgZW5kQ29vcmRzID0gIWVuZCB8fCBlbmQgPT0gcG9zID8gY29vcmRzIDogY3Vyc29yQ29vcmRzKGNtLCBlbmQpO1xuICAgICAgdmFyIHNjcm9sbFBvcyA9IGNhbGN1bGF0ZVNjcm9sbFBvcyhjbSwgTWF0aC5taW4oY29vcmRzLmxlZnQsIGVuZENvb3Jkcy5sZWZ0KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5taW4oY29vcmRzLnRvcCwgZW5kQ29vcmRzLnRvcCkgLSBtYXJnaW4sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgubWF4KGNvb3Jkcy5sZWZ0LCBlbmRDb29yZHMubGVmdCksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgubWF4KGNvb3Jkcy5ib3R0b20sIGVuZENvb3Jkcy5ib3R0b20pICsgbWFyZ2luKTtcbiAgICAgIHZhciBzdGFydFRvcCA9IGNtLmRvYy5zY3JvbGxUb3AsIHN0YXJ0TGVmdCA9IGNtLmRvYy5zY3JvbGxMZWZ0O1xuICAgICAgaWYgKHNjcm9sbFBvcy5zY3JvbGxUb3AgIT0gbnVsbCkge1xuICAgICAgICBzZXRTY3JvbGxUb3AoY20sIHNjcm9sbFBvcy5zY3JvbGxUb3ApO1xuICAgICAgICBpZiAoTWF0aC5hYnMoY20uZG9jLnNjcm9sbFRvcCAtIHN0YXJ0VG9wKSA+IDEpIGNoYW5nZWQgPSB0cnVlO1xuICAgICAgfVxuICAgICAgaWYgKHNjcm9sbFBvcy5zY3JvbGxMZWZ0ICE9IG51bGwpIHtcbiAgICAgICAgc2V0U2Nyb2xsTGVmdChjbSwgc2Nyb2xsUG9zLnNjcm9sbExlZnQpO1xuICAgICAgICBpZiAoTWF0aC5hYnMoY20uZG9jLnNjcm9sbExlZnQgLSBzdGFydExlZnQpID4gMSkgY2hhbmdlZCA9IHRydWU7XG4gICAgICB9XG4gICAgICBpZiAoIWNoYW5nZWQpIGJyZWFrO1xuICAgIH1cbiAgICByZXR1cm4gY29vcmRzO1xuICB9XG5cbiAgLy8gU2Nyb2xsIGEgZ2l2ZW4gc2V0IG9mIGNvb3JkaW5hdGVzIGludG8gdmlldyAoaW1tZWRpYXRlbHkpLlxuICBmdW5jdGlvbiBzY3JvbGxJbnRvVmlldyhjbSwgeDEsIHkxLCB4MiwgeTIpIHtcbiAgICB2YXIgc2Nyb2xsUG9zID0gY2FsY3VsYXRlU2Nyb2xsUG9zKGNtLCB4MSwgeTEsIHgyLCB5Mik7XG4gICAgaWYgKHNjcm9sbFBvcy5zY3JvbGxUb3AgIT0gbnVsbCkgc2V0U2Nyb2xsVG9wKGNtLCBzY3JvbGxQb3Muc2Nyb2xsVG9wKTtcbiAgICBpZiAoc2Nyb2xsUG9zLnNjcm9sbExlZnQgIT0gbnVsbCkgc2V0U2Nyb2xsTGVmdChjbSwgc2Nyb2xsUG9zLnNjcm9sbExlZnQpO1xuICB9XG5cbiAgLy8gQ2FsY3VsYXRlIGEgbmV3IHNjcm9sbCBwb3NpdGlvbiBuZWVkZWQgdG8gc2Nyb2xsIHRoZSBnaXZlblxuICAvLyByZWN0YW5nbGUgaW50byB2aWV3LiBSZXR1cm5zIGFuIG9iamVjdCB3aXRoIHNjcm9sbFRvcCBhbmRcbiAgLy8gc2Nyb2xsTGVmdCBwcm9wZXJ0aWVzLiBXaGVuIHRoZXNlIGFyZSB1bmRlZmluZWQsIHRoZVxuICAvLyB2ZXJ0aWNhbC9ob3Jpem9udGFsIHBvc2l0aW9uIGRvZXMgbm90IG5lZWQgdG8gYmUgYWRqdXN0ZWQuXG4gIGZ1bmN0aW9uIGNhbGN1bGF0ZVNjcm9sbFBvcyhjbSwgeDEsIHkxLCB4MiwgeTIpIHtcbiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXksIHNuYXBNYXJnaW4gPSB0ZXh0SGVpZ2h0KGNtLmRpc3BsYXkpO1xuICAgIGlmICh5MSA8IDApIHkxID0gMDtcbiAgICB2YXIgc2NyZWVudG9wID0gY20uY3VyT3AgJiYgY20uY3VyT3Auc2Nyb2xsVG9wICE9IG51bGwgPyBjbS5jdXJPcC5zY3JvbGxUb3AgOiBkaXNwbGF5LnNjcm9sbGVyLnNjcm9sbFRvcDtcbiAgICB2YXIgc2NyZWVuID0gZGlzcGxheUhlaWdodChjbSksIHJlc3VsdCA9IHt9O1xuICAgIGlmICh5MiAtIHkxID4gc2NyZWVuKSB5MiA9IHkxICsgc2NyZWVuO1xuICAgIHZhciBkb2NCb3R0b20gPSBjbS5kb2MuaGVpZ2h0ICsgcGFkZGluZ1ZlcnQoZGlzcGxheSk7XG4gICAgdmFyIGF0VG9wID0geTEgPCBzbmFwTWFyZ2luLCBhdEJvdHRvbSA9IHkyID4gZG9jQm90dG9tIC0gc25hcE1hcmdpbjtcbiAgICBpZiAoeTEgPCBzY3JlZW50b3ApIHtcbiAgICAgIHJlc3VsdC5zY3JvbGxUb3AgPSBhdFRvcCA/IDAgOiB5MTtcbiAgICB9IGVsc2UgaWYgKHkyID4gc2NyZWVudG9wICsgc2NyZWVuKSB7XG4gICAgICB2YXIgbmV3VG9wID0gTWF0aC5taW4oeTEsIChhdEJvdHRvbSA/IGRvY0JvdHRvbSA6IHkyKSAtIHNjcmVlbik7XG4gICAgICBpZiAobmV3VG9wICE9IHNjcmVlbnRvcCkgcmVzdWx0LnNjcm9sbFRvcCA9IG5ld1RvcDtcbiAgICB9XG5cbiAgICB2YXIgc2NyZWVubGVmdCA9IGNtLmN1ck9wICYmIGNtLmN1ck9wLnNjcm9sbExlZnQgIT0gbnVsbCA/IGNtLmN1ck9wLnNjcm9sbExlZnQgOiBkaXNwbGF5LnNjcm9sbGVyLnNjcm9sbExlZnQ7XG4gICAgdmFyIHNjcmVlbncgPSBkaXNwbGF5V2lkdGgoY20pIC0gKGNtLm9wdGlvbnMuZml4ZWRHdXR0ZXIgPyBkaXNwbGF5Lmd1dHRlcnMub2Zmc2V0V2lkdGggOiAwKTtcbiAgICB2YXIgdG9vV2lkZSA9IHgyIC0geDEgPiBzY3JlZW53O1xuICAgIGlmICh0b29XaWRlKSB4MiA9IHgxICsgc2NyZWVudztcbiAgICBpZiAoeDEgPCAxMClcbiAgICAgIHJlc3VsdC5zY3JvbGxMZWZ0ID0gMDtcbiAgICBlbHNlIGlmICh4MSA8IHNjcmVlbmxlZnQpXG4gICAgICByZXN1bHQuc2Nyb2xsTGVmdCA9IE1hdGgubWF4KDAsIHgxIC0gKHRvb1dpZGUgPyAwIDogMTApKTtcbiAgICBlbHNlIGlmICh4MiA+IHNjcmVlbncgKyBzY3JlZW5sZWZ0IC0gMylcbiAgICAgIHJlc3VsdC5zY3JvbGxMZWZ0ID0geDIgKyAodG9vV2lkZSA/IDAgOiAxMCkgLSBzY3JlZW53O1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvLyBTdG9yZSBhIHJlbGF0aXZlIGFkanVzdG1lbnQgdG8gdGhlIHNjcm9sbCBwb3NpdGlvbiBpbiB0aGUgY3VycmVudFxuICAvLyBvcGVyYXRpb24gKHRvIGJlIGFwcGxpZWQgd2hlbiB0aGUgb3BlcmF0aW9uIGZpbmlzaGVzKS5cbiAgZnVuY3Rpb24gYWRkVG9TY3JvbGxQb3MoY20sIGxlZnQsIHRvcCkge1xuICAgIGlmIChsZWZ0ICE9IG51bGwgfHwgdG9wICE9IG51bGwpIHJlc29sdmVTY3JvbGxUb1BvcyhjbSk7XG4gICAgaWYgKGxlZnQgIT0gbnVsbClcbiAgICAgIGNtLmN1ck9wLnNjcm9sbExlZnQgPSAoY20uY3VyT3Auc2Nyb2xsTGVmdCA9PSBudWxsID8gY20uZG9jLnNjcm9sbExlZnQgOiBjbS5jdXJPcC5zY3JvbGxMZWZ0KSArIGxlZnQ7XG4gICAgaWYgKHRvcCAhPSBudWxsKVxuICAgICAgY20uY3VyT3Auc2Nyb2xsVG9wID0gKGNtLmN1ck9wLnNjcm9sbFRvcCA9PSBudWxsID8gY20uZG9jLnNjcm9sbFRvcCA6IGNtLmN1ck9wLnNjcm9sbFRvcCkgKyB0b3A7XG4gIH1cblxuICAvLyBNYWtlIHN1cmUgdGhhdCBhdCB0aGUgZW5kIG9mIHRoZSBvcGVyYXRpb24gdGhlIGN1cnJlbnQgY3Vyc29yIGlzXG4gIC8vIHNob3duLlxuICBmdW5jdGlvbiBlbnN1cmVDdXJzb3JWaXNpYmxlKGNtKSB7XG4gICAgcmVzb2x2ZVNjcm9sbFRvUG9zKGNtKTtcbiAgICB2YXIgY3VyID0gY20uZ2V0Q3Vyc29yKCksIGZyb20gPSBjdXIsIHRvID0gY3VyO1xuICAgIGlmICghY20ub3B0aW9ucy5saW5lV3JhcHBpbmcpIHtcbiAgICAgIGZyb20gPSBjdXIuY2ggPyBQb3MoY3VyLmxpbmUsIGN1ci5jaCAtIDEpIDogY3VyO1xuICAgICAgdG8gPSBQb3MoY3VyLmxpbmUsIGN1ci5jaCArIDEpO1xuICAgIH1cbiAgICBjbS5jdXJPcC5zY3JvbGxUb1BvcyA9IHtmcm9tOiBmcm9tLCB0bzogdG8sIG1hcmdpbjogY20ub3B0aW9ucy5jdXJzb3JTY3JvbGxNYXJnaW4sIGlzQ3Vyc29yOiB0cnVlfTtcbiAgfVxuXG4gIC8vIFdoZW4gYW4gb3BlcmF0aW9uIGhhcyBpdHMgc2Nyb2xsVG9Qb3MgcHJvcGVydHkgc2V0LCBhbmQgYW5vdGhlclxuICAvLyBzY3JvbGwgYWN0aW9uIGlzIGFwcGxpZWQgYmVmb3JlIHRoZSBlbmQgb2YgdGhlIG9wZXJhdGlvbiwgdGhpc1xuICAvLyAnc2ltdWxhdGVzJyBzY3JvbGxpbmcgdGhhdCBwb3NpdGlvbiBpbnRvIHZpZXcgaW4gYSBjaGVhcCB3YXksIHNvXG4gIC8vIHRoYXQgdGhlIGVmZmVjdCBvZiBpbnRlcm1lZGlhdGUgc2Nyb2xsIGNvbW1hbmRzIGlzIG5vdCBpZ25vcmVkLlxuICBmdW5jdGlvbiByZXNvbHZlU2Nyb2xsVG9Qb3MoY20pIHtcbiAgICB2YXIgcmFuZ2UgPSBjbS5jdXJPcC5zY3JvbGxUb1BvcztcbiAgICBpZiAocmFuZ2UpIHtcbiAgICAgIGNtLmN1ck9wLnNjcm9sbFRvUG9zID0gbnVsbDtcbiAgICAgIHZhciBmcm9tID0gZXN0aW1hdGVDb29yZHMoY20sIHJhbmdlLmZyb20pLCB0byA9IGVzdGltYXRlQ29vcmRzKGNtLCByYW5nZS50byk7XG4gICAgICB2YXIgc1BvcyA9IGNhbGN1bGF0ZVNjcm9sbFBvcyhjbSwgTWF0aC5taW4oZnJvbS5sZWZ0LCB0by5sZWZ0KSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIE1hdGgubWluKGZyb20udG9wLCB0by50b3ApIC0gcmFuZ2UubWFyZ2luLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5tYXgoZnJvbS5yaWdodCwgdG8ucmlnaHQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5tYXgoZnJvbS5ib3R0b20sIHRvLmJvdHRvbSkgKyByYW5nZS5tYXJnaW4pO1xuICAgICAgY20uc2Nyb2xsVG8oc1Bvcy5zY3JvbGxMZWZ0LCBzUG9zLnNjcm9sbFRvcCk7XG4gICAgfVxuICB9XG5cbiAgLy8gQVBJIFVUSUxJVElFU1xuXG4gIC8vIEluZGVudCB0aGUgZ2l2ZW4gbGluZS4gVGhlIGhvdyBwYXJhbWV0ZXIgY2FuIGJlIFwic21hcnRcIixcbiAgLy8gXCJhZGRcIi9udWxsLCBcInN1YnRyYWN0XCIsIG9yIFwicHJldlwiLiBXaGVuIGFnZ3Jlc3NpdmUgaXMgZmFsc2VcbiAgLy8gKHR5cGljYWxseSBzZXQgdG8gdHJ1ZSBmb3IgZm9yY2VkIHNpbmdsZS1saW5lIGluZGVudHMpLCBlbXB0eVxuICAvLyBsaW5lcyBhcmUgbm90IGluZGVudGVkLCBhbmQgcGxhY2VzIHdoZXJlIHRoZSBtb2RlIHJldHVybnMgUGFzc1xuICAvLyBhcmUgbGVmdCBhbG9uZS5cbiAgZnVuY3Rpb24gaW5kZW50TGluZShjbSwgbiwgaG93LCBhZ2dyZXNzaXZlKSB7XG4gICAgdmFyIGRvYyA9IGNtLmRvYywgc3RhdGU7XG4gICAgaWYgKGhvdyA9PSBudWxsKSBob3cgPSBcImFkZFwiO1xuICAgIGlmIChob3cgPT0gXCJzbWFydFwiKSB7XG4gICAgICAvLyBGYWxsIGJhY2sgdG8gXCJwcmV2XCIgd2hlbiB0aGUgbW9kZSBkb2Vzbid0IGhhdmUgYW4gaW5kZW50YXRpb25cbiAgICAgIC8vIG1ldGhvZC5cbiAgICAgIGlmICghZG9jLm1vZGUuaW5kZW50KSBob3cgPSBcInByZXZcIjtcbiAgICAgIGVsc2Ugc3RhdGUgPSBnZXRTdGF0ZUJlZm9yZShjbSwgbik7XG4gICAgfVxuXG4gICAgdmFyIHRhYlNpemUgPSBjbS5vcHRpb25zLnRhYlNpemU7XG4gICAgdmFyIGxpbmUgPSBnZXRMaW5lKGRvYywgbiksIGN1clNwYWNlID0gY291bnRDb2x1bW4obGluZS50ZXh0LCBudWxsLCB0YWJTaXplKTtcbiAgICBpZiAobGluZS5zdGF0ZUFmdGVyKSBsaW5lLnN0YXRlQWZ0ZXIgPSBudWxsO1xuICAgIHZhciBjdXJTcGFjZVN0cmluZyA9IGxpbmUudGV4dC5tYXRjaCgvXlxccyovKVswXSwgaW5kZW50YXRpb247XG4gICAgaWYgKCFhZ2dyZXNzaXZlICYmICEvXFxTLy50ZXN0KGxpbmUudGV4dCkpIHtcbiAgICAgIGluZGVudGF0aW9uID0gMDtcbiAgICAgIGhvdyA9IFwibm90XCI7XG4gICAgfSBlbHNlIGlmIChob3cgPT0gXCJzbWFydFwiKSB7XG4gICAgICBpbmRlbnRhdGlvbiA9IGRvYy5tb2RlLmluZGVudChzdGF0ZSwgbGluZS50ZXh0LnNsaWNlKGN1clNwYWNlU3RyaW5nLmxlbmd0aCksIGxpbmUudGV4dCk7XG4gICAgICBpZiAoaW5kZW50YXRpb24gPT0gUGFzcyB8fCBpbmRlbnRhdGlvbiA+IDE1MCkge1xuICAgICAgICBpZiAoIWFnZ3Jlc3NpdmUpIHJldHVybjtcbiAgICAgICAgaG93ID0gXCJwcmV2XCI7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChob3cgPT0gXCJwcmV2XCIpIHtcbiAgICAgIGlmIChuID4gZG9jLmZpcnN0KSBpbmRlbnRhdGlvbiA9IGNvdW50Q29sdW1uKGdldExpbmUoZG9jLCBuLTEpLnRleHQsIG51bGwsIHRhYlNpemUpO1xuICAgICAgZWxzZSBpbmRlbnRhdGlvbiA9IDA7XG4gICAgfSBlbHNlIGlmIChob3cgPT0gXCJhZGRcIikge1xuICAgICAgaW5kZW50YXRpb24gPSBjdXJTcGFjZSArIGNtLm9wdGlvbnMuaW5kZW50VW5pdDtcbiAgICB9IGVsc2UgaWYgKGhvdyA9PSBcInN1YnRyYWN0XCIpIHtcbiAgICAgIGluZGVudGF0aW9uID0gY3VyU3BhY2UgLSBjbS5vcHRpb25zLmluZGVudFVuaXQ7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgaG93ID09IFwibnVtYmVyXCIpIHtcbiAgICAgIGluZGVudGF0aW9uID0gY3VyU3BhY2UgKyBob3c7XG4gICAgfVxuICAgIGluZGVudGF0aW9uID0gTWF0aC5tYXgoMCwgaW5kZW50YXRpb24pO1xuXG4gICAgdmFyIGluZGVudFN0cmluZyA9IFwiXCIsIHBvcyA9IDA7XG4gICAgaWYgKGNtLm9wdGlvbnMuaW5kZW50V2l0aFRhYnMpXG4gICAgICBmb3IgKHZhciBpID0gTWF0aC5mbG9vcihpbmRlbnRhdGlvbiAvIHRhYlNpemUpOyBpOyAtLWkpIHtwb3MgKz0gdGFiU2l6ZTsgaW5kZW50U3RyaW5nICs9IFwiXFx0XCI7fVxuICAgIGlmIChwb3MgPCBpbmRlbnRhdGlvbikgaW5kZW50U3RyaW5nICs9IHNwYWNlU3RyKGluZGVudGF0aW9uIC0gcG9zKTtcblxuICAgIGlmIChpbmRlbnRTdHJpbmcgIT0gY3VyU3BhY2VTdHJpbmcpIHtcbiAgICAgIHJlcGxhY2VSYW5nZShkb2MsIGluZGVudFN0cmluZywgUG9zKG4sIDApLCBQb3MobiwgY3VyU3BhY2VTdHJpbmcubGVuZ3RoKSwgXCIraW5wdXRcIik7XG4gICAgICBsaW5lLnN0YXRlQWZ0ZXIgPSBudWxsO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEVuc3VyZSB0aGF0LCBpZiB0aGUgY3Vyc29yIHdhcyBpbiB0aGUgd2hpdGVzcGFjZSBhdCB0aGUgc3RhcnRcbiAgICAgIC8vIG9mIHRoZSBsaW5lLCBpdCBpcyBtb3ZlZCB0byB0aGUgZW5kIG9mIHRoYXQgc3BhY2UuXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRvYy5zZWwucmFuZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciByYW5nZSA9IGRvYy5zZWwucmFuZ2VzW2ldO1xuICAgICAgICBpZiAocmFuZ2UuaGVhZC5saW5lID09IG4gJiYgcmFuZ2UuaGVhZC5jaCA8IGN1clNwYWNlU3RyaW5nLmxlbmd0aCkge1xuICAgICAgICAgIHZhciBwb3MgPSBQb3MobiwgY3VyU3BhY2VTdHJpbmcubGVuZ3RoKTtcbiAgICAgICAgICByZXBsYWNlT25lU2VsZWN0aW9uKGRvYywgaSwgbmV3IFJhbmdlKHBvcywgcG9zKSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBVdGlsaXR5IGZvciBhcHBseWluZyBhIGNoYW5nZSB0byBhIGxpbmUgYnkgaGFuZGxlIG9yIG51bWJlcixcbiAgLy8gcmV0dXJuaW5nIHRoZSBudW1iZXIgYW5kIG9wdGlvbmFsbHkgcmVnaXN0ZXJpbmcgdGhlIGxpbmUgYXNcbiAgLy8gY2hhbmdlZC5cbiAgZnVuY3Rpb24gY2hhbmdlTGluZShkb2MsIGhhbmRsZSwgY2hhbmdlVHlwZSwgb3ApIHtcbiAgICB2YXIgbm8gPSBoYW5kbGUsIGxpbmUgPSBoYW5kbGU7XG4gICAgaWYgKHR5cGVvZiBoYW5kbGUgPT0gXCJudW1iZXJcIikgbGluZSA9IGdldExpbmUoZG9jLCBjbGlwTGluZShkb2MsIGhhbmRsZSkpO1xuICAgIGVsc2Ugbm8gPSBsaW5lTm8oaGFuZGxlKTtcbiAgICBpZiAobm8gPT0gbnVsbCkgcmV0dXJuIG51bGw7XG4gICAgaWYgKG9wKGxpbmUsIG5vKSAmJiBkb2MuY20pIHJlZ0xpbmVDaGFuZ2UoZG9jLmNtLCBubywgY2hhbmdlVHlwZSk7XG4gICAgcmV0dXJuIGxpbmU7XG4gIH1cblxuICAvLyBIZWxwZXIgZm9yIGRlbGV0aW5nIHRleHQgbmVhciB0aGUgc2VsZWN0aW9uKHMpLCB1c2VkIHRvIGltcGxlbWVudFxuICAvLyBiYWNrc3BhY2UsIGRlbGV0ZSwgYW5kIHNpbWlsYXIgZnVuY3Rpb25hbGl0eS5cbiAgZnVuY3Rpb24gZGVsZXRlTmVhclNlbGVjdGlvbihjbSwgY29tcHV0ZSkge1xuICAgIHZhciByYW5nZXMgPSBjbS5kb2Muc2VsLnJhbmdlcywga2lsbCA9IFtdO1xuICAgIC8vIEJ1aWxkIHVwIGEgc2V0IG9mIHJhbmdlcyB0byBraWxsIGZpcnN0LCBtZXJnaW5nIG92ZXJsYXBwaW5nXG4gICAgLy8gcmFuZ2VzLlxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmFuZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgdG9LaWxsID0gY29tcHV0ZShyYW5nZXNbaV0pO1xuICAgICAgd2hpbGUgKGtpbGwubGVuZ3RoICYmIGNtcCh0b0tpbGwuZnJvbSwgbHN0KGtpbGwpLnRvKSA8PSAwKSB7XG4gICAgICAgIHZhciByZXBsYWNlZCA9IGtpbGwucG9wKCk7XG4gICAgICAgIGlmIChjbXAocmVwbGFjZWQuZnJvbSwgdG9LaWxsLmZyb20pIDwgMCkge1xuICAgICAgICAgIHRvS2lsbC5mcm9tID0gcmVwbGFjZWQuZnJvbTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAga2lsbC5wdXNoKHRvS2lsbCk7XG4gICAgfVxuICAgIC8vIE5leHQsIHJlbW92ZSB0aG9zZSBhY3R1YWwgcmFuZ2VzLlxuICAgIHJ1bkluT3AoY20sIGZ1bmN0aW9uKCkge1xuICAgICAgZm9yICh2YXIgaSA9IGtpbGwubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pXG4gICAgICAgIHJlcGxhY2VSYW5nZShjbS5kb2MsIFwiXCIsIGtpbGxbaV0uZnJvbSwga2lsbFtpXS50bywgXCIrZGVsZXRlXCIpO1xuICAgICAgZW5zdXJlQ3Vyc29yVmlzaWJsZShjbSk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBVc2VkIGZvciBob3Jpem9udGFsIHJlbGF0aXZlIG1vdGlvbi4gRGlyIGlzIC0xIG9yIDEgKGxlZnQgb3JcbiAgLy8gcmlnaHQpLCB1bml0IGNhbiBiZSBcImNoYXJcIiwgXCJjb2x1bW5cIiAobGlrZSBjaGFyLCBidXQgZG9lc24ndFxuICAvLyBjcm9zcyBsaW5lIGJvdW5kYXJpZXMpLCBcIndvcmRcIiAoYWNyb3NzIG5leHQgd29yZCksIG9yIFwiZ3JvdXBcIiAodG9cbiAgLy8gdGhlIHN0YXJ0IG9mIG5leHQgZ3JvdXAgb2Ygd29yZCBvciBub24td29yZC1ub24td2hpdGVzcGFjZVxuICAvLyBjaGFycykuIFRoZSB2aXN1YWxseSBwYXJhbSBjb250cm9scyB3aGV0aGVyLCBpbiByaWdodC10by1sZWZ0XG4gIC8vIHRleHQsIGRpcmVjdGlvbiAxIG1lYW5zIHRvIG1vdmUgdG93YXJkcyB0aGUgbmV4dCBpbmRleCBpbiB0aGVcbiAgLy8gc3RyaW5nLCBvciB0b3dhcmRzIHRoZSBjaGFyYWN0ZXIgdG8gdGhlIHJpZ2h0IG9mIHRoZSBjdXJyZW50XG4gIC8vIHBvc2l0aW9uLiBUaGUgcmVzdWx0aW5nIHBvc2l0aW9uIHdpbGwgaGF2ZSBhIGhpdFNpZGU9dHJ1ZVxuICAvLyBwcm9wZXJ0eSBpZiBpdCByZWFjaGVkIHRoZSBlbmQgb2YgdGhlIGRvY3VtZW50LlxuICBmdW5jdGlvbiBmaW5kUG9zSChkb2MsIHBvcywgZGlyLCB1bml0LCB2aXN1YWxseSkge1xuICAgIHZhciBsaW5lID0gcG9zLmxpbmUsIGNoID0gcG9zLmNoLCBvcmlnRGlyID0gZGlyO1xuICAgIHZhciBsaW5lT2JqID0gZ2V0TGluZShkb2MsIGxpbmUpO1xuICAgIHZhciBwb3NzaWJsZSA9IHRydWU7XG4gICAgZnVuY3Rpb24gZmluZE5leHRMaW5lKCkge1xuICAgICAgdmFyIGwgPSBsaW5lICsgZGlyO1xuICAgICAgaWYgKGwgPCBkb2MuZmlyc3QgfHwgbCA+PSBkb2MuZmlyc3QgKyBkb2Muc2l6ZSkgcmV0dXJuIChwb3NzaWJsZSA9IGZhbHNlKTtcbiAgICAgIGxpbmUgPSBsO1xuICAgICAgcmV0dXJuIGxpbmVPYmogPSBnZXRMaW5lKGRvYywgbCk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIG1vdmVPbmNlKGJvdW5kVG9MaW5lKSB7XG4gICAgICB2YXIgbmV4dCA9ICh2aXN1YWxseSA/IG1vdmVWaXN1YWxseSA6IG1vdmVMb2dpY2FsbHkpKGxpbmVPYmosIGNoLCBkaXIsIHRydWUpO1xuICAgICAgaWYgKG5leHQgPT0gbnVsbCkge1xuICAgICAgICBpZiAoIWJvdW5kVG9MaW5lICYmIGZpbmROZXh0TGluZSgpKSB7XG4gICAgICAgICAgaWYgKHZpc3VhbGx5KSBjaCA9IChkaXIgPCAwID8gbGluZVJpZ2h0IDogbGluZUxlZnQpKGxpbmVPYmopO1xuICAgICAgICAgIGVsc2UgY2ggPSBkaXIgPCAwID8gbGluZU9iai50ZXh0Lmxlbmd0aCA6IDA7XG4gICAgICAgIH0gZWxzZSByZXR1cm4gKHBvc3NpYmxlID0gZmFsc2UpO1xuICAgICAgfSBlbHNlIGNoID0gbmV4dDtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIGlmICh1bml0ID09IFwiY2hhclwiKSBtb3ZlT25jZSgpO1xuICAgIGVsc2UgaWYgKHVuaXQgPT0gXCJjb2x1bW5cIikgbW92ZU9uY2UodHJ1ZSk7XG4gICAgZWxzZSBpZiAodW5pdCA9PSBcIndvcmRcIiB8fCB1bml0ID09IFwiZ3JvdXBcIikge1xuICAgICAgdmFyIHNhd1R5cGUgPSBudWxsLCBncm91cCA9IHVuaXQgPT0gXCJncm91cFwiO1xuICAgICAgdmFyIGhlbHBlciA9IGRvYy5jbSAmJiBkb2MuY20uZ2V0SGVscGVyKHBvcywgXCJ3b3JkQ2hhcnNcIik7XG4gICAgICBmb3IgKHZhciBmaXJzdCA9IHRydWU7OyBmaXJzdCA9IGZhbHNlKSB7XG4gICAgICAgIGlmIChkaXIgPCAwICYmICFtb3ZlT25jZSghZmlyc3QpKSBicmVhaztcbiAgICAgICAgdmFyIGN1ciA9IGxpbmVPYmoudGV4dC5jaGFyQXQoY2gpIHx8IFwiXFxuXCI7XG4gICAgICAgIHZhciB0eXBlID0gaXNXb3JkQ2hhcihjdXIsIGhlbHBlcikgPyBcIndcIlxuICAgICAgICAgIDogZ3JvdXAgJiYgY3VyID09IFwiXFxuXCIgPyBcIm5cIlxuICAgICAgICAgIDogIWdyb3VwIHx8IC9cXHMvLnRlc3QoY3VyKSA/IG51bGxcbiAgICAgICAgICA6IFwicFwiO1xuICAgICAgICBpZiAoZ3JvdXAgJiYgIWZpcnN0ICYmICF0eXBlKSB0eXBlID0gXCJzXCI7XG4gICAgICAgIGlmIChzYXdUeXBlICYmIHNhd1R5cGUgIT0gdHlwZSkge1xuICAgICAgICAgIGlmIChkaXIgPCAwKSB7ZGlyID0gMTsgbW92ZU9uY2UoKTt9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodHlwZSkgc2F3VHlwZSA9IHR5cGU7XG4gICAgICAgIGlmIChkaXIgPiAwICYmICFtb3ZlT25jZSghZmlyc3QpKSBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIHJlc3VsdCA9IHNraXBBdG9taWMoZG9jLCBQb3MobGluZSwgY2gpLCBvcmlnRGlyLCB0cnVlKTtcbiAgICBpZiAoIXBvc3NpYmxlKSByZXN1bHQuaGl0U2lkZSA9IHRydWU7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8vIEZvciByZWxhdGl2ZSB2ZXJ0aWNhbCBtb3ZlbWVudC4gRGlyIG1heSBiZSAtMSBvciAxLiBVbml0IGNhbiBiZVxuICAvLyBcInBhZ2VcIiBvciBcImxpbmVcIi4gVGhlIHJlc3VsdGluZyBwb3NpdGlvbiB3aWxsIGhhdmUgYSBoaXRTaWRlPXRydWVcbiAgLy8gcHJvcGVydHkgaWYgaXQgcmVhY2hlZCB0aGUgZW5kIG9mIHRoZSBkb2N1bWVudC5cbiAgZnVuY3Rpb24gZmluZFBvc1YoY20sIHBvcywgZGlyLCB1bml0KSB7XG4gICAgdmFyIGRvYyA9IGNtLmRvYywgeCA9IHBvcy5sZWZ0LCB5O1xuICAgIGlmICh1bml0ID09IFwicGFnZVwiKSB7XG4gICAgICB2YXIgcGFnZVNpemUgPSBNYXRoLm1pbihjbS5kaXNwbGF5LndyYXBwZXIuY2xpZW50SGVpZ2h0LCB3aW5kb3cuaW5uZXJIZWlnaHQgfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCk7XG4gICAgICB5ID0gcG9zLnRvcCArIGRpciAqIChwYWdlU2l6ZSAtIChkaXIgPCAwID8gMS41IDogLjUpICogdGV4dEhlaWdodChjbS5kaXNwbGF5KSk7XG4gICAgfSBlbHNlIGlmICh1bml0ID09IFwibGluZVwiKSB7XG4gICAgICB5ID0gZGlyID4gMCA/IHBvcy5ib3R0b20gKyAzIDogcG9zLnRvcCAtIDM7XG4gICAgfVxuICAgIGZvciAoOzspIHtcbiAgICAgIHZhciB0YXJnZXQgPSBjb29yZHNDaGFyKGNtLCB4LCB5KTtcbiAgICAgIGlmICghdGFyZ2V0Lm91dHNpZGUpIGJyZWFrO1xuICAgICAgaWYgKGRpciA8IDAgPyB5IDw9IDAgOiB5ID49IGRvYy5oZWlnaHQpIHsgdGFyZ2V0LmhpdFNpZGUgPSB0cnVlOyBicmVhazsgfVxuICAgICAgeSArPSBkaXIgKiA1O1xuICAgIH1cbiAgICByZXR1cm4gdGFyZ2V0O1xuICB9XG5cbiAgLy8gRURJVE9SIE1FVEhPRFNcblxuICAvLyBUaGUgcHVibGljbHkgdmlzaWJsZSBBUEkuIE5vdGUgdGhhdCBtZXRob2RPcChmKSBtZWFuc1xuICAvLyAnd3JhcCBmIGluIGFuIG9wZXJhdGlvbiwgcGVyZm9ybWVkIG9uIGl0cyBgdGhpc2AgcGFyYW1ldGVyJy5cblxuICAvLyBUaGlzIGlzIG5vdCB0aGUgY29tcGxldGUgc2V0IG9mIGVkaXRvciBtZXRob2RzLiBNb3N0IG9mIHRoZVxuICAvLyBtZXRob2RzIGRlZmluZWQgb24gdGhlIERvYyB0eXBlIGFyZSBhbHNvIGluamVjdGVkIGludG9cbiAgLy8gQ29kZU1pcnJvci5wcm90b3R5cGUsIGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSBhbmRcbiAgLy8gY29udmVuaWVuY2UuXG5cbiAgQ29kZU1pcnJvci5wcm90b3R5cGUgPSB7XG4gICAgY29uc3RydWN0b3I6IENvZGVNaXJyb3IsXG4gICAgZm9jdXM6IGZ1bmN0aW9uKCl7d2luZG93LmZvY3VzKCk7IHRoaXMuZGlzcGxheS5pbnB1dC5mb2N1cygpO30sXG5cbiAgICBzZXRPcHRpb246IGZ1bmN0aW9uKG9wdGlvbiwgdmFsdWUpIHtcbiAgICAgIHZhciBvcHRpb25zID0gdGhpcy5vcHRpb25zLCBvbGQgPSBvcHRpb25zW29wdGlvbl07XG4gICAgICBpZiAob3B0aW9uc1tvcHRpb25dID09IHZhbHVlICYmIG9wdGlvbiAhPSBcIm1vZGVcIikgcmV0dXJuO1xuICAgICAgb3B0aW9uc1tvcHRpb25dID0gdmFsdWU7XG4gICAgICBpZiAob3B0aW9uSGFuZGxlcnMuaGFzT3duUHJvcGVydHkob3B0aW9uKSlcbiAgICAgICAgb3BlcmF0aW9uKHRoaXMsIG9wdGlvbkhhbmRsZXJzW29wdGlvbl0pKHRoaXMsIHZhbHVlLCBvbGQpO1xuICAgIH0sXG5cbiAgICBnZXRPcHRpb246IGZ1bmN0aW9uKG9wdGlvbikge3JldHVybiB0aGlzLm9wdGlvbnNbb3B0aW9uXTt9LFxuICAgIGdldERvYzogZnVuY3Rpb24oKSB7cmV0dXJuIHRoaXMuZG9jO30sXG5cbiAgICBhZGRLZXlNYXA6IGZ1bmN0aW9uKG1hcCwgYm90dG9tKSB7XG4gICAgICB0aGlzLnN0YXRlLmtleU1hcHNbYm90dG9tID8gXCJwdXNoXCIgOiBcInVuc2hpZnRcIl0oZ2V0S2V5TWFwKG1hcCkpO1xuICAgIH0sXG4gICAgcmVtb3ZlS2V5TWFwOiBmdW5jdGlvbihtYXApIHtcbiAgICAgIHZhciBtYXBzID0gdGhpcy5zdGF0ZS5rZXlNYXBzO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXBzLmxlbmd0aDsgKytpKVxuICAgICAgICBpZiAobWFwc1tpXSA9PSBtYXAgfHwgbWFwc1tpXS5uYW1lID09IG1hcCkge1xuICAgICAgICAgIG1hcHMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGFkZE92ZXJsYXk6IG1ldGhvZE9wKGZ1bmN0aW9uKHNwZWMsIG9wdGlvbnMpIHtcbiAgICAgIHZhciBtb2RlID0gc3BlYy50b2tlbiA/IHNwZWMgOiBDb2RlTWlycm9yLmdldE1vZGUodGhpcy5vcHRpb25zLCBzcGVjKTtcbiAgICAgIGlmIChtb2RlLnN0YXJ0U3RhdGUpIHRocm93IG5ldyBFcnJvcihcIk92ZXJsYXlzIG1heSBub3QgYmUgc3RhdGVmdWwuXCIpO1xuICAgICAgdGhpcy5zdGF0ZS5vdmVybGF5cy5wdXNoKHttb2RlOiBtb2RlLCBtb2RlU3BlYzogc3BlYywgb3BhcXVlOiBvcHRpb25zICYmIG9wdGlvbnMub3BhcXVlfSk7XG4gICAgICB0aGlzLnN0YXRlLm1vZGVHZW4rKztcbiAgICAgIHJlZ0NoYW5nZSh0aGlzKTtcbiAgICB9KSxcbiAgICByZW1vdmVPdmVybGF5OiBtZXRob2RPcChmdW5jdGlvbihzcGVjKSB7XG4gICAgICB2YXIgb3ZlcmxheXMgPSB0aGlzLnN0YXRlLm92ZXJsYXlzO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvdmVybGF5cy5sZW5ndGg7ICsraSkge1xuICAgICAgICB2YXIgY3VyID0gb3ZlcmxheXNbaV0ubW9kZVNwZWM7XG4gICAgICAgIGlmIChjdXIgPT0gc3BlYyB8fCB0eXBlb2Ygc3BlYyA9PSBcInN0cmluZ1wiICYmIGN1ci5uYW1lID09IHNwZWMpIHtcbiAgICAgICAgICBvdmVybGF5cy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgdGhpcy5zdGF0ZS5tb2RlR2VuKys7XG4gICAgICAgICAgcmVnQ2hhbmdlKHRoaXMpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pLFxuXG4gICAgaW5kZW50TGluZTogbWV0aG9kT3AoZnVuY3Rpb24obiwgZGlyLCBhZ2dyZXNzaXZlKSB7XG4gICAgICBpZiAodHlwZW9mIGRpciAhPSBcInN0cmluZ1wiICYmIHR5cGVvZiBkaXIgIT0gXCJudW1iZXJcIikge1xuICAgICAgICBpZiAoZGlyID09IG51bGwpIGRpciA9IHRoaXMub3B0aW9ucy5zbWFydEluZGVudCA/IFwic21hcnRcIiA6IFwicHJldlwiO1xuICAgICAgICBlbHNlIGRpciA9IGRpciA/IFwiYWRkXCIgOiBcInN1YnRyYWN0XCI7XG4gICAgICB9XG4gICAgICBpZiAoaXNMaW5lKHRoaXMuZG9jLCBuKSkgaW5kZW50TGluZSh0aGlzLCBuLCBkaXIsIGFnZ3Jlc3NpdmUpO1xuICAgIH0pLFxuICAgIGluZGVudFNlbGVjdGlvbjogbWV0aG9kT3AoZnVuY3Rpb24oaG93KSB7XG4gICAgICB2YXIgcmFuZ2VzID0gdGhpcy5kb2Muc2VsLnJhbmdlcywgZW5kID0gLTE7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgcmFuZ2UgPSByYW5nZXNbaV07XG4gICAgICAgIGlmICghcmFuZ2UuZW1wdHkoKSkge1xuICAgICAgICAgIHZhciBmcm9tID0gcmFuZ2UuZnJvbSgpLCB0byA9IHJhbmdlLnRvKCk7XG4gICAgICAgICAgdmFyIHN0YXJ0ID0gTWF0aC5tYXgoZW5kLCBmcm9tLmxpbmUpO1xuICAgICAgICAgIGVuZCA9IE1hdGgubWluKHRoaXMubGFzdExpbmUoKSwgdG8ubGluZSAtICh0by5jaCA/IDAgOiAxKSkgKyAxO1xuICAgICAgICAgIGZvciAodmFyIGogPSBzdGFydDsgaiA8IGVuZDsgKytqKVxuICAgICAgICAgICAgaW5kZW50TGluZSh0aGlzLCBqLCBob3cpO1xuICAgICAgICAgIHZhciBuZXdSYW5nZXMgPSB0aGlzLmRvYy5zZWwucmFuZ2VzO1xuICAgICAgICAgIGlmIChmcm9tLmNoID09IDAgJiYgcmFuZ2VzLmxlbmd0aCA9PSBuZXdSYW5nZXMubGVuZ3RoICYmIG5ld1Jhbmdlc1tpXS5mcm9tKCkuY2ggPiAwKVxuICAgICAgICAgICAgcmVwbGFjZU9uZVNlbGVjdGlvbih0aGlzLmRvYywgaSwgbmV3IFJhbmdlKGZyb20sIG5ld1Jhbmdlc1tpXS50bygpKSwgc2VsX2RvbnRTY3JvbGwpO1xuICAgICAgICB9IGVsc2UgaWYgKHJhbmdlLmhlYWQubGluZSA+IGVuZCkge1xuICAgICAgICAgIGluZGVudExpbmUodGhpcywgcmFuZ2UuaGVhZC5saW5lLCBob3csIHRydWUpO1xuICAgICAgICAgIGVuZCA9IHJhbmdlLmhlYWQubGluZTtcbiAgICAgICAgICBpZiAoaSA9PSB0aGlzLmRvYy5zZWwucHJpbUluZGV4KSBlbnN1cmVDdXJzb3JWaXNpYmxlKHRoaXMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSksXG5cbiAgICAvLyBGZXRjaCB0aGUgcGFyc2VyIHRva2VuIGZvciBhIGdpdmVuIGNoYXJhY3Rlci4gVXNlZnVsIGZvciBoYWNrc1xuICAgIC8vIHRoYXQgd2FudCB0byBpbnNwZWN0IHRoZSBtb2RlIHN0YXRlIChzYXksIGZvciBjb21wbGV0aW9uKS5cbiAgICBnZXRUb2tlbkF0OiBmdW5jdGlvbihwb3MsIHByZWNpc2UpIHtcbiAgICAgIHJldHVybiB0YWtlVG9rZW4odGhpcywgcG9zLCBwcmVjaXNlKTtcbiAgICB9LFxuXG4gICAgZ2V0TGluZVRva2VuczogZnVuY3Rpb24obGluZSwgcHJlY2lzZSkge1xuICAgICAgcmV0dXJuIHRha2VUb2tlbih0aGlzLCBQb3MobGluZSksIHByZWNpc2UsIHRydWUpO1xuICAgIH0sXG5cbiAgICBnZXRUb2tlblR5cGVBdDogZnVuY3Rpb24ocG9zKSB7XG4gICAgICBwb3MgPSBjbGlwUG9zKHRoaXMuZG9jLCBwb3MpO1xuICAgICAgdmFyIHN0eWxlcyA9IGdldExpbmVTdHlsZXModGhpcywgZ2V0TGluZSh0aGlzLmRvYywgcG9zLmxpbmUpKTtcbiAgICAgIHZhciBiZWZvcmUgPSAwLCBhZnRlciA9IChzdHlsZXMubGVuZ3RoIC0gMSkgLyAyLCBjaCA9IHBvcy5jaDtcbiAgICAgIHZhciB0eXBlO1xuICAgICAgaWYgKGNoID09IDApIHR5cGUgPSBzdHlsZXNbMl07XG4gICAgICBlbHNlIGZvciAoOzspIHtcbiAgICAgICAgdmFyIG1pZCA9IChiZWZvcmUgKyBhZnRlcikgPj4gMTtcbiAgICAgICAgaWYgKChtaWQgPyBzdHlsZXNbbWlkICogMiAtIDFdIDogMCkgPj0gY2gpIGFmdGVyID0gbWlkO1xuICAgICAgICBlbHNlIGlmIChzdHlsZXNbbWlkICogMiArIDFdIDwgY2gpIGJlZm9yZSA9IG1pZCArIDE7XG4gICAgICAgIGVsc2UgeyB0eXBlID0gc3R5bGVzW21pZCAqIDIgKyAyXTsgYnJlYWs7IH1cbiAgICAgIH1cbiAgICAgIHZhciBjdXQgPSB0eXBlID8gdHlwZS5pbmRleE9mKFwiY20tb3ZlcmxheSBcIikgOiAtMTtcbiAgICAgIHJldHVybiBjdXQgPCAwID8gdHlwZSA6IGN1dCA9PSAwID8gbnVsbCA6IHR5cGUuc2xpY2UoMCwgY3V0IC0gMSk7XG4gICAgfSxcblxuICAgIGdldE1vZGVBdDogZnVuY3Rpb24ocG9zKSB7XG4gICAgICB2YXIgbW9kZSA9IHRoaXMuZG9jLm1vZGU7XG4gICAgICBpZiAoIW1vZGUuaW5uZXJNb2RlKSByZXR1cm4gbW9kZTtcbiAgICAgIHJldHVybiBDb2RlTWlycm9yLmlubmVyTW9kZShtb2RlLCB0aGlzLmdldFRva2VuQXQocG9zKS5zdGF0ZSkubW9kZTtcbiAgICB9LFxuXG4gICAgZ2V0SGVscGVyOiBmdW5jdGlvbihwb3MsIHR5cGUpIHtcbiAgICAgIHJldHVybiB0aGlzLmdldEhlbHBlcnMocG9zLCB0eXBlKVswXTtcbiAgICB9LFxuXG4gICAgZ2V0SGVscGVyczogZnVuY3Rpb24ocG9zLCB0eXBlKSB7XG4gICAgICB2YXIgZm91bmQgPSBbXTtcbiAgICAgIGlmICghaGVscGVycy5oYXNPd25Qcm9wZXJ0eSh0eXBlKSkgcmV0dXJuIGZvdW5kO1xuICAgICAgdmFyIGhlbHAgPSBoZWxwZXJzW3R5cGVdLCBtb2RlID0gdGhpcy5nZXRNb2RlQXQocG9zKTtcbiAgICAgIGlmICh0eXBlb2YgbW9kZVt0eXBlXSA9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIGlmIChoZWxwW21vZGVbdHlwZV1dKSBmb3VuZC5wdXNoKGhlbHBbbW9kZVt0eXBlXV0pO1xuICAgICAgfSBlbHNlIGlmIChtb2RlW3R5cGVdKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbW9kZVt0eXBlXS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIHZhciB2YWwgPSBoZWxwW21vZGVbdHlwZV1baV1dO1xuICAgICAgICAgIGlmICh2YWwpIGZvdW5kLnB1c2godmFsKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChtb2RlLmhlbHBlclR5cGUgJiYgaGVscFttb2RlLmhlbHBlclR5cGVdKSB7XG4gICAgICAgIGZvdW5kLnB1c2goaGVscFttb2RlLmhlbHBlclR5cGVdKTtcbiAgICAgIH0gZWxzZSBpZiAoaGVscFttb2RlLm5hbWVdKSB7XG4gICAgICAgIGZvdW5kLnB1c2goaGVscFttb2RlLm5hbWVdKTtcbiAgICAgIH1cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGVscC5fZ2xvYmFsLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBjdXIgPSBoZWxwLl9nbG9iYWxbaV07XG4gICAgICAgIGlmIChjdXIucHJlZChtb2RlLCB0aGlzKSAmJiBpbmRleE9mKGZvdW5kLCBjdXIudmFsKSA9PSAtMSlcbiAgICAgICAgICBmb3VuZC5wdXNoKGN1ci52YWwpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZvdW5kO1xuICAgIH0sXG5cbiAgICBnZXRTdGF0ZUFmdGVyOiBmdW5jdGlvbihsaW5lLCBwcmVjaXNlKSB7XG4gICAgICB2YXIgZG9jID0gdGhpcy5kb2M7XG4gICAgICBsaW5lID0gY2xpcExpbmUoZG9jLCBsaW5lID09IG51bGwgPyBkb2MuZmlyc3QgKyBkb2Muc2l6ZSAtIDE6IGxpbmUpO1xuICAgICAgcmV0dXJuIGdldFN0YXRlQmVmb3JlKHRoaXMsIGxpbmUgKyAxLCBwcmVjaXNlKTtcbiAgICB9LFxuXG4gICAgY3Vyc29yQ29vcmRzOiBmdW5jdGlvbihzdGFydCwgbW9kZSkge1xuICAgICAgdmFyIHBvcywgcmFuZ2UgPSB0aGlzLmRvYy5zZWwucHJpbWFyeSgpO1xuICAgICAgaWYgKHN0YXJ0ID09IG51bGwpIHBvcyA9IHJhbmdlLmhlYWQ7XG4gICAgICBlbHNlIGlmICh0eXBlb2Ygc3RhcnQgPT0gXCJvYmplY3RcIikgcG9zID0gY2xpcFBvcyh0aGlzLmRvYywgc3RhcnQpO1xuICAgICAgZWxzZSBwb3MgPSBzdGFydCA/IHJhbmdlLmZyb20oKSA6IHJhbmdlLnRvKCk7XG4gICAgICByZXR1cm4gY3Vyc29yQ29vcmRzKHRoaXMsIHBvcywgbW9kZSB8fCBcInBhZ2VcIik7XG4gICAgfSxcblxuICAgIGNoYXJDb29yZHM6IGZ1bmN0aW9uKHBvcywgbW9kZSkge1xuICAgICAgcmV0dXJuIGNoYXJDb29yZHModGhpcywgY2xpcFBvcyh0aGlzLmRvYywgcG9zKSwgbW9kZSB8fCBcInBhZ2VcIik7XG4gICAgfSxcblxuICAgIGNvb3Jkc0NoYXI6IGZ1bmN0aW9uKGNvb3JkcywgbW9kZSkge1xuICAgICAgY29vcmRzID0gZnJvbUNvb3JkU3lzdGVtKHRoaXMsIGNvb3JkcywgbW9kZSB8fCBcInBhZ2VcIik7XG4gICAgICByZXR1cm4gY29vcmRzQ2hhcih0aGlzLCBjb29yZHMubGVmdCwgY29vcmRzLnRvcCk7XG4gICAgfSxcblxuICAgIGxpbmVBdEhlaWdodDogZnVuY3Rpb24oaGVpZ2h0LCBtb2RlKSB7XG4gICAgICBoZWlnaHQgPSBmcm9tQ29vcmRTeXN0ZW0odGhpcywge3RvcDogaGVpZ2h0LCBsZWZ0OiAwfSwgbW9kZSB8fCBcInBhZ2VcIikudG9wO1xuICAgICAgcmV0dXJuIGxpbmVBdEhlaWdodCh0aGlzLmRvYywgaGVpZ2h0ICsgdGhpcy5kaXNwbGF5LnZpZXdPZmZzZXQpO1xuICAgIH0sXG4gICAgaGVpZ2h0QXRMaW5lOiBmdW5jdGlvbihsaW5lLCBtb2RlKSB7XG4gICAgICB2YXIgZW5kID0gZmFsc2UsIGxpbmVPYmo7XG4gICAgICBpZiAodHlwZW9mIGxpbmUgPT0gXCJudW1iZXJcIikge1xuICAgICAgICB2YXIgbGFzdCA9IHRoaXMuZG9jLmZpcnN0ICsgdGhpcy5kb2Muc2l6ZSAtIDE7XG4gICAgICAgIGlmIChsaW5lIDwgdGhpcy5kb2MuZmlyc3QpIGxpbmUgPSB0aGlzLmRvYy5maXJzdDtcbiAgICAgICAgZWxzZSBpZiAobGluZSA+IGxhc3QpIHsgbGluZSA9IGxhc3Q7IGVuZCA9IHRydWU7IH1cbiAgICAgICAgbGluZU9iaiA9IGdldExpbmUodGhpcy5kb2MsIGxpbmUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGluZU9iaiA9IGxpbmU7XG4gICAgICB9XG4gICAgICByZXR1cm4gaW50b0Nvb3JkU3lzdGVtKHRoaXMsIGxpbmVPYmosIHt0b3A6IDAsIGxlZnQ6IDB9LCBtb2RlIHx8IFwicGFnZVwiKS50b3AgK1xuICAgICAgICAoZW5kID8gdGhpcy5kb2MuaGVpZ2h0IC0gaGVpZ2h0QXRMaW5lKGxpbmVPYmopIDogMCk7XG4gICAgfSxcblxuICAgIGRlZmF1bHRUZXh0SGVpZ2h0OiBmdW5jdGlvbigpIHsgcmV0dXJuIHRleHRIZWlnaHQodGhpcy5kaXNwbGF5KTsgfSxcbiAgICBkZWZhdWx0Q2hhcldpZHRoOiBmdW5jdGlvbigpIHsgcmV0dXJuIGNoYXJXaWR0aCh0aGlzLmRpc3BsYXkpOyB9LFxuXG4gICAgc2V0R3V0dGVyTWFya2VyOiBtZXRob2RPcChmdW5jdGlvbihsaW5lLCBndXR0ZXJJRCwgdmFsdWUpIHtcbiAgICAgIHJldHVybiBjaGFuZ2VMaW5lKHRoaXMuZG9jLCBsaW5lLCBcImd1dHRlclwiLCBmdW5jdGlvbihsaW5lKSB7XG4gICAgICAgIHZhciBtYXJrZXJzID0gbGluZS5ndXR0ZXJNYXJrZXJzIHx8IChsaW5lLmd1dHRlck1hcmtlcnMgPSB7fSk7XG4gICAgICAgIG1hcmtlcnNbZ3V0dGVySURdID0gdmFsdWU7XG4gICAgICAgIGlmICghdmFsdWUgJiYgaXNFbXB0eShtYXJrZXJzKSkgbGluZS5ndXR0ZXJNYXJrZXJzID0gbnVsbDtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9KTtcbiAgICB9KSxcblxuICAgIGNsZWFyR3V0dGVyOiBtZXRob2RPcChmdW5jdGlvbihndXR0ZXJJRCkge1xuICAgICAgdmFyIGNtID0gdGhpcywgZG9jID0gY20uZG9jLCBpID0gZG9jLmZpcnN0O1xuICAgICAgZG9jLml0ZXIoZnVuY3Rpb24obGluZSkge1xuICAgICAgICBpZiAobGluZS5ndXR0ZXJNYXJrZXJzICYmIGxpbmUuZ3V0dGVyTWFya2Vyc1tndXR0ZXJJRF0pIHtcbiAgICAgICAgICBsaW5lLmd1dHRlck1hcmtlcnNbZ3V0dGVySURdID0gbnVsbDtcbiAgICAgICAgICByZWdMaW5lQ2hhbmdlKGNtLCBpLCBcImd1dHRlclwiKTtcbiAgICAgICAgICBpZiAoaXNFbXB0eShsaW5lLmd1dHRlck1hcmtlcnMpKSBsaW5lLmd1dHRlck1hcmtlcnMgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgICsraTtcbiAgICAgIH0pO1xuICAgIH0pLFxuXG4gICAgbGluZUluZm86IGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgIGlmICh0eXBlb2YgbGluZSA9PSBcIm51bWJlclwiKSB7XG4gICAgICAgIGlmICghaXNMaW5lKHRoaXMuZG9jLCBsaW5lKSkgcmV0dXJuIG51bGw7XG4gICAgICAgIHZhciBuID0gbGluZTtcbiAgICAgICAgbGluZSA9IGdldExpbmUodGhpcy5kb2MsIGxpbmUpO1xuICAgICAgICBpZiAoIWxpbmUpIHJldHVybiBudWxsO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIG4gPSBsaW5lTm8obGluZSk7XG4gICAgICAgIGlmIChuID09IG51bGwpIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtsaW5lOiBuLCBoYW5kbGU6IGxpbmUsIHRleHQ6IGxpbmUudGV4dCwgZ3V0dGVyTWFya2VyczogbGluZS5ndXR0ZXJNYXJrZXJzLFxuICAgICAgICAgICAgICB0ZXh0Q2xhc3M6IGxpbmUudGV4dENsYXNzLCBiZ0NsYXNzOiBsaW5lLmJnQ2xhc3MsIHdyYXBDbGFzczogbGluZS53cmFwQ2xhc3MsXG4gICAgICAgICAgICAgIHdpZGdldHM6IGxpbmUud2lkZ2V0c307XG4gICAgfSxcblxuICAgIGdldFZpZXdwb3J0OiBmdW5jdGlvbigpIHsgcmV0dXJuIHtmcm9tOiB0aGlzLmRpc3BsYXkudmlld0Zyb20sIHRvOiB0aGlzLmRpc3BsYXkudmlld1RvfTt9LFxuXG4gICAgYWRkV2lkZ2V0OiBmdW5jdGlvbihwb3MsIG5vZGUsIHNjcm9sbCwgdmVydCwgaG9yaXopIHtcbiAgICAgIHZhciBkaXNwbGF5ID0gdGhpcy5kaXNwbGF5O1xuICAgICAgcG9zID0gY3Vyc29yQ29vcmRzKHRoaXMsIGNsaXBQb3ModGhpcy5kb2MsIHBvcykpO1xuICAgICAgdmFyIHRvcCA9IHBvcy5ib3R0b20sIGxlZnQgPSBwb3MubGVmdDtcbiAgICAgIG5vZGUuc3R5bGUucG9zaXRpb24gPSBcImFic29sdXRlXCI7XG4gICAgICBub2RlLnNldEF0dHJpYnV0ZShcImNtLWlnbm9yZS1ldmVudHNcIiwgXCJ0cnVlXCIpO1xuICAgICAgdGhpcy5kaXNwbGF5LmlucHV0LnNldFVuZWRpdGFibGUobm9kZSk7XG4gICAgICBkaXNwbGF5LnNpemVyLmFwcGVuZENoaWxkKG5vZGUpO1xuICAgICAgaWYgKHZlcnQgPT0gXCJvdmVyXCIpIHtcbiAgICAgICAgdG9wID0gcG9zLnRvcDtcbiAgICAgIH0gZWxzZSBpZiAodmVydCA9PSBcImFib3ZlXCIgfHwgdmVydCA9PSBcIm5lYXJcIikge1xuICAgICAgICB2YXIgdnNwYWNlID0gTWF0aC5tYXgoZGlzcGxheS53cmFwcGVyLmNsaWVudEhlaWdodCwgdGhpcy5kb2MuaGVpZ2h0KSxcbiAgICAgICAgaHNwYWNlID0gTWF0aC5tYXgoZGlzcGxheS5zaXplci5jbGllbnRXaWR0aCwgZGlzcGxheS5saW5lU3BhY2UuY2xpZW50V2lkdGgpO1xuICAgICAgICAvLyBEZWZhdWx0IHRvIHBvc2l0aW9uaW5nIGFib3ZlIChpZiBzcGVjaWZpZWQgYW5kIHBvc3NpYmxlKTsgb3RoZXJ3aXNlIGRlZmF1bHQgdG8gcG9zaXRpb25pbmcgYmVsb3dcbiAgICAgICAgaWYgKCh2ZXJ0ID09ICdhYm92ZScgfHwgcG9zLmJvdHRvbSArIG5vZGUub2Zmc2V0SGVpZ2h0ID4gdnNwYWNlKSAmJiBwb3MudG9wID4gbm9kZS5vZmZzZXRIZWlnaHQpXG4gICAgICAgICAgdG9wID0gcG9zLnRvcCAtIG5vZGUub2Zmc2V0SGVpZ2h0O1xuICAgICAgICBlbHNlIGlmIChwb3MuYm90dG9tICsgbm9kZS5vZmZzZXRIZWlnaHQgPD0gdnNwYWNlKVxuICAgICAgICAgIHRvcCA9IHBvcy5ib3R0b207XG4gICAgICAgIGlmIChsZWZ0ICsgbm9kZS5vZmZzZXRXaWR0aCA+IGhzcGFjZSlcbiAgICAgICAgICBsZWZ0ID0gaHNwYWNlIC0gbm9kZS5vZmZzZXRXaWR0aDtcbiAgICAgIH1cbiAgICAgIG5vZGUuc3R5bGUudG9wID0gdG9wICsgXCJweFwiO1xuICAgICAgbm9kZS5zdHlsZS5sZWZ0ID0gbm9kZS5zdHlsZS5yaWdodCA9IFwiXCI7XG4gICAgICBpZiAoaG9yaXogPT0gXCJyaWdodFwiKSB7XG4gICAgICAgIGxlZnQgPSBkaXNwbGF5LnNpemVyLmNsaWVudFdpZHRoIC0gbm9kZS5vZmZzZXRXaWR0aDtcbiAgICAgICAgbm9kZS5zdHlsZS5yaWdodCA9IFwiMHB4XCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoaG9yaXogPT0gXCJsZWZ0XCIpIGxlZnQgPSAwO1xuICAgICAgICBlbHNlIGlmIChob3JpeiA9PSBcIm1pZGRsZVwiKSBsZWZ0ID0gKGRpc3BsYXkuc2l6ZXIuY2xpZW50V2lkdGggLSBub2RlLm9mZnNldFdpZHRoKSAvIDI7XG4gICAgICAgIG5vZGUuc3R5bGUubGVmdCA9IGxlZnQgKyBcInB4XCI7XG4gICAgICB9XG4gICAgICBpZiAoc2Nyb2xsKVxuICAgICAgICBzY3JvbGxJbnRvVmlldyh0aGlzLCBsZWZ0LCB0b3AsIGxlZnQgKyBub2RlLm9mZnNldFdpZHRoLCB0b3AgKyBub2RlLm9mZnNldEhlaWdodCk7XG4gICAgfSxcblxuICAgIHRyaWdnZXJPbktleURvd246IG1ldGhvZE9wKG9uS2V5RG93biksXG4gICAgdHJpZ2dlck9uS2V5UHJlc3M6IG1ldGhvZE9wKG9uS2V5UHJlc3MpLFxuICAgIHRyaWdnZXJPbktleVVwOiBvbktleVVwLFxuXG4gICAgZXhlY0NvbW1hbmQ6IGZ1bmN0aW9uKGNtZCkge1xuICAgICAgaWYgKGNvbW1hbmRzLmhhc093blByb3BlcnR5KGNtZCkpXG4gICAgICAgIHJldHVybiBjb21tYW5kc1tjbWRdLmNhbGwobnVsbCwgdGhpcyk7XG4gICAgfSxcblxuICAgIHRyaWdnZXJFbGVjdHJpYzogbWV0aG9kT3AoZnVuY3Rpb24odGV4dCkgeyB0cmlnZ2VyRWxlY3RyaWModGhpcywgdGV4dCk7IH0pLFxuXG4gICAgZmluZFBvc0g6IGZ1bmN0aW9uKGZyb20sIGFtb3VudCwgdW5pdCwgdmlzdWFsbHkpIHtcbiAgICAgIHZhciBkaXIgPSAxO1xuICAgICAgaWYgKGFtb3VudCA8IDApIHsgZGlyID0gLTE7IGFtb3VudCA9IC1hbW91bnQ7IH1cbiAgICAgIGZvciAodmFyIGkgPSAwLCBjdXIgPSBjbGlwUG9zKHRoaXMuZG9jLCBmcm9tKTsgaSA8IGFtb3VudDsgKytpKSB7XG4gICAgICAgIGN1ciA9IGZpbmRQb3NIKHRoaXMuZG9jLCBjdXIsIGRpciwgdW5pdCwgdmlzdWFsbHkpO1xuICAgICAgICBpZiAoY3VyLmhpdFNpZGUpIGJyZWFrO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGN1cjtcbiAgICB9LFxuXG4gICAgbW92ZUg6IG1ldGhvZE9wKGZ1bmN0aW9uKGRpciwgdW5pdCkge1xuICAgICAgdmFyIGNtID0gdGhpcztcbiAgICAgIGNtLmV4dGVuZFNlbGVjdGlvbnNCeShmdW5jdGlvbihyYW5nZSkge1xuICAgICAgICBpZiAoY20uZGlzcGxheS5zaGlmdCB8fCBjbS5kb2MuZXh0ZW5kIHx8IHJhbmdlLmVtcHR5KCkpXG4gICAgICAgICAgcmV0dXJuIGZpbmRQb3NIKGNtLmRvYywgcmFuZ2UuaGVhZCwgZGlyLCB1bml0LCBjbS5vcHRpb25zLnJ0bE1vdmVWaXN1YWxseSk7XG4gICAgICAgIGVsc2VcbiAgICAgICAgICByZXR1cm4gZGlyIDwgMCA/IHJhbmdlLmZyb20oKSA6IHJhbmdlLnRvKCk7XG4gICAgICB9LCBzZWxfbW92ZSk7XG4gICAgfSksXG5cbiAgICBkZWxldGVIOiBtZXRob2RPcChmdW5jdGlvbihkaXIsIHVuaXQpIHtcbiAgICAgIHZhciBzZWwgPSB0aGlzLmRvYy5zZWwsIGRvYyA9IHRoaXMuZG9jO1xuICAgICAgaWYgKHNlbC5zb21ldGhpbmdTZWxlY3RlZCgpKVxuICAgICAgICBkb2MucmVwbGFjZVNlbGVjdGlvbihcIlwiLCBudWxsLCBcIitkZWxldGVcIik7XG4gICAgICBlbHNlXG4gICAgICAgIGRlbGV0ZU5lYXJTZWxlY3Rpb24odGhpcywgZnVuY3Rpb24ocmFuZ2UpIHtcbiAgICAgICAgICB2YXIgb3RoZXIgPSBmaW5kUG9zSChkb2MsIHJhbmdlLmhlYWQsIGRpciwgdW5pdCwgZmFsc2UpO1xuICAgICAgICAgIHJldHVybiBkaXIgPCAwID8ge2Zyb206IG90aGVyLCB0bzogcmFuZ2UuaGVhZH0gOiB7ZnJvbTogcmFuZ2UuaGVhZCwgdG86IG90aGVyfTtcbiAgICAgICAgfSk7XG4gICAgfSksXG5cbiAgICBmaW5kUG9zVjogZnVuY3Rpb24oZnJvbSwgYW1vdW50LCB1bml0LCBnb2FsQ29sdW1uKSB7XG4gICAgICB2YXIgZGlyID0gMSwgeCA9IGdvYWxDb2x1bW47XG4gICAgICBpZiAoYW1vdW50IDwgMCkgeyBkaXIgPSAtMTsgYW1vdW50ID0gLWFtb3VudDsgfVxuICAgICAgZm9yICh2YXIgaSA9IDAsIGN1ciA9IGNsaXBQb3ModGhpcy5kb2MsIGZyb20pOyBpIDwgYW1vdW50OyArK2kpIHtcbiAgICAgICAgdmFyIGNvb3JkcyA9IGN1cnNvckNvb3Jkcyh0aGlzLCBjdXIsIFwiZGl2XCIpO1xuICAgICAgICBpZiAoeCA9PSBudWxsKSB4ID0gY29vcmRzLmxlZnQ7XG4gICAgICAgIGVsc2UgY29vcmRzLmxlZnQgPSB4O1xuICAgICAgICBjdXIgPSBmaW5kUG9zVih0aGlzLCBjb29yZHMsIGRpciwgdW5pdCk7XG4gICAgICAgIGlmIChjdXIuaGl0U2lkZSkgYnJlYWs7XG4gICAgICB9XG4gICAgICByZXR1cm4gY3VyO1xuICAgIH0sXG5cbiAgICBtb3ZlVjogbWV0aG9kT3AoZnVuY3Rpb24oZGlyLCB1bml0KSB7XG4gICAgICB2YXIgY20gPSB0aGlzLCBkb2MgPSB0aGlzLmRvYywgZ29hbHMgPSBbXTtcbiAgICAgIHZhciBjb2xsYXBzZSA9ICFjbS5kaXNwbGF5LnNoaWZ0ICYmICFkb2MuZXh0ZW5kICYmIGRvYy5zZWwuc29tZXRoaW5nU2VsZWN0ZWQoKTtcbiAgICAgIGRvYy5leHRlbmRTZWxlY3Rpb25zQnkoZnVuY3Rpb24ocmFuZ2UpIHtcbiAgICAgICAgaWYgKGNvbGxhcHNlKVxuICAgICAgICAgIHJldHVybiBkaXIgPCAwID8gcmFuZ2UuZnJvbSgpIDogcmFuZ2UudG8oKTtcbiAgICAgICAgdmFyIGhlYWRQb3MgPSBjdXJzb3JDb29yZHMoY20sIHJhbmdlLmhlYWQsIFwiZGl2XCIpO1xuICAgICAgICBpZiAocmFuZ2UuZ29hbENvbHVtbiAhPSBudWxsKSBoZWFkUG9zLmxlZnQgPSByYW5nZS5nb2FsQ29sdW1uO1xuICAgICAgICBnb2Fscy5wdXNoKGhlYWRQb3MubGVmdCk7XG4gICAgICAgIHZhciBwb3MgPSBmaW5kUG9zVihjbSwgaGVhZFBvcywgZGlyLCB1bml0KTtcbiAgICAgICAgaWYgKHVuaXQgPT0gXCJwYWdlXCIgJiYgcmFuZ2UgPT0gZG9jLnNlbC5wcmltYXJ5KCkpXG4gICAgICAgICAgYWRkVG9TY3JvbGxQb3MoY20sIG51bGwsIGNoYXJDb29yZHMoY20sIHBvcywgXCJkaXZcIikudG9wIC0gaGVhZFBvcy50b3ApO1xuICAgICAgICByZXR1cm4gcG9zO1xuICAgICAgfSwgc2VsX21vdmUpO1xuICAgICAgaWYgKGdvYWxzLmxlbmd0aCkgZm9yICh2YXIgaSA9IDA7IGkgPCBkb2Muc2VsLnJhbmdlcy5sZW5ndGg7IGkrKylcbiAgICAgICAgZG9jLnNlbC5yYW5nZXNbaV0uZ29hbENvbHVtbiA9IGdvYWxzW2ldO1xuICAgIH0pLFxuXG4gICAgLy8gRmluZCB0aGUgd29yZCBhdCB0aGUgZ2l2ZW4gcG9zaXRpb24gKGFzIHJldHVybmVkIGJ5IGNvb3Jkc0NoYXIpLlxuICAgIGZpbmRXb3JkQXQ6IGZ1bmN0aW9uKHBvcykge1xuICAgICAgdmFyIGRvYyA9IHRoaXMuZG9jLCBsaW5lID0gZ2V0TGluZShkb2MsIHBvcy5saW5lKS50ZXh0O1xuICAgICAgdmFyIHN0YXJ0ID0gcG9zLmNoLCBlbmQgPSBwb3MuY2g7XG4gICAgICBpZiAobGluZSkge1xuICAgICAgICB2YXIgaGVscGVyID0gdGhpcy5nZXRIZWxwZXIocG9zLCBcIndvcmRDaGFyc1wiKTtcbiAgICAgICAgaWYgKChwb3MueFJlbCA8IDAgfHwgZW5kID09IGxpbmUubGVuZ3RoKSAmJiBzdGFydCkgLS1zdGFydDsgZWxzZSArK2VuZDtcbiAgICAgICAgdmFyIHN0YXJ0Q2hhciA9IGxpbmUuY2hhckF0KHN0YXJ0KTtcbiAgICAgICAgdmFyIGNoZWNrID0gaXNXb3JkQ2hhcihzdGFydENoYXIsIGhlbHBlcilcbiAgICAgICAgICA/IGZ1bmN0aW9uKGNoKSB7IHJldHVybiBpc1dvcmRDaGFyKGNoLCBoZWxwZXIpOyB9XG4gICAgICAgICAgOiAvXFxzLy50ZXN0KHN0YXJ0Q2hhcikgPyBmdW5jdGlvbihjaCkge3JldHVybiAvXFxzLy50ZXN0KGNoKTt9XG4gICAgICAgICAgOiBmdW5jdGlvbihjaCkge3JldHVybiAhL1xccy8udGVzdChjaCkgJiYgIWlzV29yZENoYXIoY2gpO307XG4gICAgICAgIHdoaWxlIChzdGFydCA+IDAgJiYgY2hlY2sobGluZS5jaGFyQXQoc3RhcnQgLSAxKSkpIC0tc3RhcnQ7XG4gICAgICAgIHdoaWxlIChlbmQgPCBsaW5lLmxlbmd0aCAmJiBjaGVjayhsaW5lLmNoYXJBdChlbmQpKSkgKytlbmQ7XG4gICAgICB9XG4gICAgICByZXR1cm4gbmV3IFJhbmdlKFBvcyhwb3MubGluZSwgc3RhcnQpLCBQb3MocG9zLmxpbmUsIGVuZCkpO1xuICAgIH0sXG5cbiAgICB0b2dnbGVPdmVyd3JpdGU6IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAgICBpZiAodmFsdWUgIT0gbnVsbCAmJiB2YWx1ZSA9PSB0aGlzLnN0YXRlLm92ZXJ3cml0ZSkgcmV0dXJuO1xuICAgICAgaWYgKHRoaXMuc3RhdGUub3ZlcndyaXRlID0gIXRoaXMuc3RhdGUub3ZlcndyaXRlKVxuICAgICAgICBhZGRDbGFzcyh0aGlzLmRpc3BsYXkuY3Vyc29yRGl2LCBcIkNvZGVNaXJyb3Itb3ZlcndyaXRlXCIpO1xuICAgICAgZWxzZVxuICAgICAgICBybUNsYXNzKHRoaXMuZGlzcGxheS5jdXJzb3JEaXYsIFwiQ29kZU1pcnJvci1vdmVyd3JpdGVcIik7XG5cbiAgICAgIHNpZ25hbCh0aGlzLCBcIm92ZXJ3cml0ZVRvZ2dsZVwiLCB0aGlzLCB0aGlzLnN0YXRlLm92ZXJ3cml0ZSk7XG4gICAgfSxcbiAgICBoYXNGb2N1czogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLmRpc3BsYXkuaW5wdXQuZ2V0RmllbGQoKSA9PSBhY3RpdmVFbHQoKTsgfSxcblxuICAgIHNjcm9sbFRvOiBtZXRob2RPcChmdW5jdGlvbih4LCB5KSB7XG4gICAgICBpZiAoeCAhPSBudWxsIHx8IHkgIT0gbnVsbCkgcmVzb2x2ZVNjcm9sbFRvUG9zKHRoaXMpO1xuICAgICAgaWYgKHggIT0gbnVsbCkgdGhpcy5jdXJPcC5zY3JvbGxMZWZ0ID0geDtcbiAgICAgIGlmICh5ICE9IG51bGwpIHRoaXMuY3VyT3Auc2Nyb2xsVG9wID0geTtcbiAgICB9KSxcbiAgICBnZXRTY3JvbGxJbmZvOiBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzY3JvbGxlciA9IHRoaXMuZGlzcGxheS5zY3JvbGxlcjtcbiAgICAgIHJldHVybiB7bGVmdDogc2Nyb2xsZXIuc2Nyb2xsTGVmdCwgdG9wOiBzY3JvbGxlci5zY3JvbGxUb3AsXG4gICAgICAgICAgICAgIGhlaWdodDogc2Nyb2xsZXIuc2Nyb2xsSGVpZ2h0IC0gc2Nyb2xsR2FwKHRoaXMpIC0gdGhpcy5kaXNwbGF5LmJhckhlaWdodCxcbiAgICAgICAgICAgICAgd2lkdGg6IHNjcm9sbGVyLnNjcm9sbFdpZHRoIC0gc2Nyb2xsR2FwKHRoaXMpIC0gdGhpcy5kaXNwbGF5LmJhcldpZHRoLFxuICAgICAgICAgICAgICBjbGllbnRIZWlnaHQ6IGRpc3BsYXlIZWlnaHQodGhpcyksIGNsaWVudFdpZHRoOiBkaXNwbGF5V2lkdGgodGhpcyl9O1xuICAgIH0sXG5cbiAgICBzY3JvbGxJbnRvVmlldzogbWV0aG9kT3AoZnVuY3Rpb24ocmFuZ2UsIG1hcmdpbikge1xuICAgICAgaWYgKHJhbmdlID09IG51bGwpIHtcbiAgICAgICAgcmFuZ2UgPSB7ZnJvbTogdGhpcy5kb2Muc2VsLnByaW1hcnkoKS5oZWFkLCB0bzogbnVsbH07XG4gICAgICAgIGlmIChtYXJnaW4gPT0gbnVsbCkgbWFyZ2luID0gdGhpcy5vcHRpb25zLmN1cnNvclNjcm9sbE1hcmdpbjtcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHJhbmdlID09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgcmFuZ2UgPSB7ZnJvbTogUG9zKHJhbmdlLCAwKSwgdG86IG51bGx9O1xuICAgICAgfSBlbHNlIGlmIChyYW5nZS5mcm9tID09IG51bGwpIHtcbiAgICAgICAgcmFuZ2UgPSB7ZnJvbTogcmFuZ2UsIHRvOiBudWxsfTtcbiAgICAgIH1cbiAgICAgIGlmICghcmFuZ2UudG8pIHJhbmdlLnRvID0gcmFuZ2UuZnJvbTtcbiAgICAgIHJhbmdlLm1hcmdpbiA9IG1hcmdpbiB8fCAwO1xuXG4gICAgICBpZiAocmFuZ2UuZnJvbS5saW5lICE9IG51bGwpIHtcbiAgICAgICAgcmVzb2x2ZVNjcm9sbFRvUG9zKHRoaXMpO1xuICAgICAgICB0aGlzLmN1ck9wLnNjcm9sbFRvUG9zID0gcmFuZ2U7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgc1BvcyA9IGNhbGN1bGF0ZVNjcm9sbFBvcyh0aGlzLCBNYXRoLm1pbihyYW5nZS5mcm9tLmxlZnQsIHJhbmdlLnRvLmxlZnQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLm1pbihyYW5nZS5mcm9tLnRvcCwgcmFuZ2UudG8udG9wKSAtIHJhbmdlLm1hcmdpbixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5tYXgocmFuZ2UuZnJvbS5yaWdodCwgcmFuZ2UudG8ucmlnaHQpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBNYXRoLm1heChyYW5nZS5mcm9tLmJvdHRvbSwgcmFuZ2UudG8uYm90dG9tKSArIHJhbmdlLm1hcmdpbik7XG4gICAgICAgIHRoaXMuc2Nyb2xsVG8oc1Bvcy5zY3JvbGxMZWZ0LCBzUG9zLnNjcm9sbFRvcCk7XG4gICAgICB9XG4gICAgfSksXG5cbiAgICBzZXRTaXplOiBtZXRob2RPcChmdW5jdGlvbih3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICB2YXIgY20gPSB0aGlzO1xuICAgICAgZnVuY3Rpb24gaW50ZXJwcmV0KHZhbCkge1xuICAgICAgICByZXR1cm4gdHlwZW9mIHZhbCA9PSBcIm51bWJlclwiIHx8IC9eXFxkKyQvLnRlc3QoU3RyaW5nKHZhbCkpID8gdmFsICsgXCJweFwiIDogdmFsO1xuICAgICAgfVxuICAgICAgaWYgKHdpZHRoICE9IG51bGwpIGNtLmRpc3BsYXkud3JhcHBlci5zdHlsZS53aWR0aCA9IGludGVycHJldCh3aWR0aCk7XG4gICAgICBpZiAoaGVpZ2h0ICE9IG51bGwpIGNtLmRpc3BsYXkud3JhcHBlci5zdHlsZS5oZWlnaHQgPSBpbnRlcnByZXQoaGVpZ2h0KTtcbiAgICAgIGlmIChjbS5vcHRpb25zLmxpbmVXcmFwcGluZykgY2xlYXJMaW5lTWVhc3VyZW1lbnRDYWNoZSh0aGlzKTtcbiAgICAgIHZhciBsaW5lTm8gPSBjbS5kaXNwbGF5LnZpZXdGcm9tO1xuICAgICAgY20uZG9jLml0ZXIobGluZU5vLCBjbS5kaXNwbGF5LnZpZXdUbywgZnVuY3Rpb24obGluZSkge1xuICAgICAgICBpZiAobGluZS53aWRnZXRzKSBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmUud2lkZ2V0cy5sZW5ndGg7IGkrKylcbiAgICAgICAgICBpZiAobGluZS53aWRnZXRzW2ldLm5vSFNjcm9sbCkgeyByZWdMaW5lQ2hhbmdlKGNtLCBsaW5lTm8sIFwid2lkZ2V0XCIpOyBicmVhazsgfVxuICAgICAgICArK2xpbmVObztcbiAgICAgIH0pO1xuICAgICAgY20uY3VyT3AuZm9yY2VVcGRhdGUgPSB0cnVlO1xuICAgICAgc2lnbmFsKGNtLCBcInJlZnJlc2hcIiwgdGhpcyk7XG4gICAgfSksXG5cbiAgICBvcGVyYXRpb246IGZ1bmN0aW9uKGYpe3JldHVybiBydW5Jbk9wKHRoaXMsIGYpO30sXG5cbiAgICByZWZyZXNoOiBtZXRob2RPcChmdW5jdGlvbigpIHtcbiAgICAgIHZhciBvbGRIZWlnaHQgPSB0aGlzLmRpc3BsYXkuY2FjaGVkVGV4dEhlaWdodDtcbiAgICAgIHJlZ0NoYW5nZSh0aGlzKTtcbiAgICAgIHRoaXMuY3VyT3AuZm9yY2VVcGRhdGUgPSB0cnVlO1xuICAgICAgY2xlYXJDYWNoZXModGhpcyk7XG4gICAgICB0aGlzLnNjcm9sbFRvKHRoaXMuZG9jLnNjcm9sbExlZnQsIHRoaXMuZG9jLnNjcm9sbFRvcCk7XG4gICAgICB1cGRhdGVHdXR0ZXJTcGFjZSh0aGlzKTtcbiAgICAgIGlmIChvbGRIZWlnaHQgPT0gbnVsbCB8fCBNYXRoLmFicyhvbGRIZWlnaHQgLSB0ZXh0SGVpZ2h0KHRoaXMuZGlzcGxheSkpID4gLjUpXG4gICAgICAgIGVzdGltYXRlTGluZUhlaWdodHModGhpcyk7XG4gICAgICBzaWduYWwodGhpcywgXCJyZWZyZXNoXCIsIHRoaXMpO1xuICAgIH0pLFxuXG4gICAgc3dhcERvYzogbWV0aG9kT3AoZnVuY3Rpb24oZG9jKSB7XG4gICAgICB2YXIgb2xkID0gdGhpcy5kb2M7XG4gICAgICBvbGQuY20gPSBudWxsO1xuICAgICAgYXR0YWNoRG9jKHRoaXMsIGRvYyk7XG4gICAgICBjbGVhckNhY2hlcyh0aGlzKTtcbiAgICAgIHRoaXMuZGlzcGxheS5pbnB1dC5yZXNldCgpO1xuICAgICAgdGhpcy5zY3JvbGxUbyhkb2Muc2Nyb2xsTGVmdCwgZG9jLnNjcm9sbFRvcCk7XG4gICAgICB0aGlzLmN1ck9wLmZvcmNlU2Nyb2xsID0gdHJ1ZTtcbiAgICAgIHNpZ25hbExhdGVyKHRoaXMsIFwic3dhcERvY1wiLCB0aGlzLCBvbGQpO1xuICAgICAgcmV0dXJuIG9sZDtcbiAgICB9KSxcblxuICAgIGdldElucHV0RmllbGQ6IGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZGlzcGxheS5pbnB1dC5nZXRGaWVsZCgpO30sXG4gICAgZ2V0V3JhcHBlckVsZW1lbnQ6IGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZGlzcGxheS53cmFwcGVyO30sXG4gICAgZ2V0U2Nyb2xsZXJFbGVtZW50OiBmdW5jdGlvbigpe3JldHVybiB0aGlzLmRpc3BsYXkuc2Nyb2xsZXI7fSxcbiAgICBnZXRHdXR0ZXJFbGVtZW50OiBmdW5jdGlvbigpe3JldHVybiB0aGlzLmRpc3BsYXkuZ3V0dGVyczt9XG4gIH07XG4gIGV2ZW50TWl4aW4oQ29kZU1pcnJvcik7XG5cbiAgLy8gT1BUSU9OIERFRkFVTFRTXG5cbiAgLy8gVGhlIGRlZmF1bHQgY29uZmlndXJhdGlvbiBvcHRpb25zLlxuICB2YXIgZGVmYXVsdHMgPSBDb2RlTWlycm9yLmRlZmF1bHRzID0ge307XG4gIC8vIEZ1bmN0aW9ucyB0byBydW4gd2hlbiBvcHRpb25zIGFyZSBjaGFuZ2VkLlxuICB2YXIgb3B0aW9uSGFuZGxlcnMgPSBDb2RlTWlycm9yLm9wdGlvbkhhbmRsZXJzID0ge307XG5cbiAgZnVuY3Rpb24gb3B0aW9uKG5hbWUsIGRlZmx0LCBoYW5kbGUsIG5vdE9uSW5pdCkge1xuICAgIENvZGVNaXJyb3IuZGVmYXVsdHNbbmFtZV0gPSBkZWZsdDtcbiAgICBpZiAoaGFuZGxlKSBvcHRpb25IYW5kbGVyc1tuYW1lXSA9XG4gICAgICBub3RPbkluaXQgPyBmdW5jdGlvbihjbSwgdmFsLCBvbGQpIHtpZiAob2xkICE9IEluaXQpIGhhbmRsZShjbSwgdmFsLCBvbGQpO30gOiBoYW5kbGU7XG4gIH1cblxuICAvLyBQYXNzZWQgdG8gb3B0aW9uIGhhbmRsZXJzIHdoZW4gdGhlcmUgaXMgbm8gb2xkIHZhbHVlLlxuICB2YXIgSW5pdCA9IENvZGVNaXJyb3IuSW5pdCA9IHt0b1N0cmluZzogZnVuY3Rpb24oKXtyZXR1cm4gXCJDb2RlTWlycm9yLkluaXRcIjt9fTtcblxuICAvLyBUaGVzZSB0d28gYXJlLCBvbiBpbml0LCBjYWxsZWQgZnJvbSB0aGUgY29uc3RydWN0b3IgYmVjYXVzZSB0aGV5XG4gIC8vIGhhdmUgdG8gYmUgaW5pdGlhbGl6ZWQgYmVmb3JlIHRoZSBlZGl0b3IgY2FuIHN0YXJ0IGF0IGFsbC5cbiAgb3B0aW9uKFwidmFsdWVcIiwgXCJcIiwgZnVuY3Rpb24oY20sIHZhbCkge1xuICAgIGNtLnNldFZhbHVlKHZhbCk7XG4gIH0sIHRydWUpO1xuICBvcHRpb24oXCJtb2RlXCIsIG51bGwsIGZ1bmN0aW9uKGNtLCB2YWwpIHtcbiAgICBjbS5kb2MubW9kZU9wdGlvbiA9IHZhbDtcbiAgICBsb2FkTW9kZShjbSk7XG4gIH0sIHRydWUpO1xuXG4gIG9wdGlvbihcImluZGVudFVuaXRcIiwgMiwgbG9hZE1vZGUsIHRydWUpO1xuICBvcHRpb24oXCJpbmRlbnRXaXRoVGFic1wiLCBmYWxzZSk7XG4gIG9wdGlvbihcInNtYXJ0SW5kZW50XCIsIHRydWUpO1xuICBvcHRpb24oXCJ0YWJTaXplXCIsIDQsIGZ1bmN0aW9uKGNtKSB7XG4gICAgcmVzZXRNb2RlU3RhdGUoY20pO1xuICAgIGNsZWFyQ2FjaGVzKGNtKTtcbiAgICByZWdDaGFuZ2UoY20pO1xuICB9LCB0cnVlKTtcbiAgb3B0aW9uKFwibGluZVNlcGFyYXRvclwiLCBudWxsLCBmdW5jdGlvbihjbSwgdmFsKSB7XG4gICAgY20uZG9jLmxpbmVTZXAgPSB2YWw7XG4gICAgaWYgKCF2YWwpIHJldHVybjtcbiAgICB2YXIgbmV3QnJlYWtzID0gW10sIGxpbmVObyA9IGNtLmRvYy5maXJzdDtcbiAgICBjbS5kb2MuaXRlcihmdW5jdGlvbihsaW5lKSB7XG4gICAgICBmb3IgKHZhciBwb3MgPSAwOzspIHtcbiAgICAgICAgdmFyIGZvdW5kID0gbGluZS50ZXh0LmluZGV4T2YodmFsLCBwb3MpO1xuICAgICAgICBpZiAoZm91bmQgPT0gLTEpIGJyZWFrO1xuICAgICAgICBwb3MgPSBmb3VuZCArIHZhbC5sZW5ndGg7XG4gICAgICAgIG5ld0JyZWFrcy5wdXNoKFBvcyhsaW5lTm8sIGZvdW5kKSk7XG4gICAgICB9XG4gICAgICBsaW5lTm8rKztcbiAgICB9KTtcbiAgICBmb3IgKHZhciBpID0gbmV3QnJlYWtzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKVxuICAgICAgcmVwbGFjZVJhbmdlKGNtLmRvYywgdmFsLCBuZXdCcmVha3NbaV0sIFBvcyhuZXdCcmVha3NbaV0ubGluZSwgbmV3QnJlYWtzW2ldLmNoICsgdmFsLmxlbmd0aCkpXG4gIH0pO1xuICBvcHRpb24oXCJzcGVjaWFsQ2hhcnNcIiwgL1tcXHRcXHUwMDAwLVxcdTAwMTlcXHUwMGFkXFx1MjAwYi1cXHUyMDBmXFx1MjAyOFxcdTIwMjlcXHVmZWZmXS9nLCBmdW5jdGlvbihjbSwgdmFsLCBvbGQpIHtcbiAgICBjbS5zdGF0ZS5zcGVjaWFsQ2hhcnMgPSBuZXcgUmVnRXhwKHZhbC5zb3VyY2UgKyAodmFsLnRlc3QoXCJcXHRcIikgPyBcIlwiIDogXCJ8XFx0XCIpLCBcImdcIik7XG4gICAgaWYgKG9sZCAhPSBDb2RlTWlycm9yLkluaXQpIGNtLnJlZnJlc2goKTtcbiAgfSk7XG4gIG9wdGlvbihcInNwZWNpYWxDaGFyUGxhY2Vob2xkZXJcIiwgZGVmYXVsdFNwZWNpYWxDaGFyUGxhY2Vob2xkZXIsIGZ1bmN0aW9uKGNtKSB7Y20ucmVmcmVzaCgpO30sIHRydWUpO1xuICBvcHRpb24oXCJlbGVjdHJpY0NoYXJzXCIsIHRydWUpO1xuICBvcHRpb24oXCJpbnB1dFN0eWxlXCIsIG1vYmlsZSA/IFwiY29udGVudGVkaXRhYmxlXCIgOiBcInRleHRhcmVhXCIsIGZ1bmN0aW9uKCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcImlucHV0U3R5bGUgY2FuIG5vdCAoeWV0KSBiZSBjaGFuZ2VkIGluIGEgcnVubmluZyBlZGl0b3JcIik7IC8vIEZJWE1FXG4gIH0sIHRydWUpO1xuICBvcHRpb24oXCJydGxNb3ZlVmlzdWFsbHlcIiwgIXdpbmRvd3MpO1xuICBvcHRpb24oXCJ3aG9sZUxpbmVVcGRhdGVCZWZvcmVcIiwgdHJ1ZSk7XG5cbiAgb3B0aW9uKFwidGhlbWVcIiwgXCJkZWZhdWx0XCIsIGZ1bmN0aW9uKGNtKSB7XG4gICAgdGhlbWVDaGFuZ2VkKGNtKTtcbiAgICBndXR0ZXJzQ2hhbmdlZChjbSk7XG4gIH0sIHRydWUpO1xuICBvcHRpb24oXCJrZXlNYXBcIiwgXCJkZWZhdWx0XCIsIGZ1bmN0aW9uKGNtLCB2YWwsIG9sZCkge1xuICAgIHZhciBuZXh0ID0gZ2V0S2V5TWFwKHZhbCk7XG4gICAgdmFyIHByZXYgPSBvbGQgIT0gQ29kZU1pcnJvci5Jbml0ICYmIGdldEtleU1hcChvbGQpO1xuICAgIGlmIChwcmV2ICYmIHByZXYuZGV0YWNoKSBwcmV2LmRldGFjaChjbSwgbmV4dCk7XG4gICAgaWYgKG5leHQuYXR0YWNoKSBuZXh0LmF0dGFjaChjbSwgcHJldiB8fCBudWxsKTtcbiAgfSk7XG4gIG9wdGlvbihcImV4dHJhS2V5c1wiLCBudWxsKTtcblxuICBvcHRpb24oXCJsaW5lV3JhcHBpbmdcIiwgZmFsc2UsIHdyYXBwaW5nQ2hhbmdlZCwgdHJ1ZSk7XG4gIG9wdGlvbihcImd1dHRlcnNcIiwgW10sIGZ1bmN0aW9uKGNtKSB7XG4gICAgc2V0R3V0dGVyc0ZvckxpbmVOdW1iZXJzKGNtLm9wdGlvbnMpO1xuICAgIGd1dHRlcnNDaGFuZ2VkKGNtKTtcbiAgfSwgdHJ1ZSk7XG4gIG9wdGlvbihcImZpeGVkR3V0dGVyXCIsIHRydWUsIGZ1bmN0aW9uKGNtLCB2YWwpIHtcbiAgICBjbS5kaXNwbGF5Lmd1dHRlcnMuc3R5bGUubGVmdCA9IHZhbCA/IGNvbXBlbnNhdGVGb3JIU2Nyb2xsKGNtLmRpc3BsYXkpICsgXCJweFwiIDogXCIwXCI7XG4gICAgY20ucmVmcmVzaCgpO1xuICB9LCB0cnVlKTtcbiAgb3B0aW9uKFwiY292ZXJHdXR0ZXJOZXh0VG9TY3JvbGxiYXJcIiwgZmFsc2UsIGZ1bmN0aW9uKGNtKSB7dXBkYXRlU2Nyb2xsYmFycyhjbSk7fSwgdHJ1ZSk7XG4gIG9wdGlvbihcInNjcm9sbGJhclN0eWxlXCIsIFwibmF0aXZlXCIsIGZ1bmN0aW9uKGNtKSB7XG4gICAgaW5pdFNjcm9sbGJhcnMoY20pO1xuICAgIHVwZGF0ZVNjcm9sbGJhcnMoY20pO1xuICAgIGNtLmRpc3BsYXkuc2Nyb2xsYmFycy5zZXRTY3JvbGxUb3AoY20uZG9jLnNjcm9sbFRvcCk7XG4gICAgY20uZGlzcGxheS5zY3JvbGxiYXJzLnNldFNjcm9sbExlZnQoY20uZG9jLnNjcm9sbExlZnQpO1xuICB9LCB0cnVlKTtcbiAgb3B0aW9uKFwibGluZU51bWJlcnNcIiwgZmFsc2UsIGZ1bmN0aW9uKGNtKSB7XG4gICAgc2V0R3V0dGVyc0ZvckxpbmVOdW1iZXJzKGNtLm9wdGlvbnMpO1xuICAgIGd1dHRlcnNDaGFuZ2VkKGNtKTtcbiAgfSwgdHJ1ZSk7XG4gIG9wdGlvbihcImZpcnN0TGluZU51bWJlclwiLCAxLCBndXR0ZXJzQ2hhbmdlZCwgdHJ1ZSk7XG4gIG9wdGlvbihcImxpbmVOdW1iZXJGb3JtYXR0ZXJcIiwgZnVuY3Rpb24oaW50ZWdlcikge3JldHVybiBpbnRlZ2VyO30sIGd1dHRlcnNDaGFuZ2VkLCB0cnVlKTtcbiAgb3B0aW9uKFwic2hvd0N1cnNvcldoZW5TZWxlY3RpbmdcIiwgZmFsc2UsIHVwZGF0ZVNlbGVjdGlvbiwgdHJ1ZSk7XG5cbiAgb3B0aW9uKFwicmVzZXRTZWxlY3Rpb25PbkNvbnRleHRNZW51XCIsIHRydWUpO1xuICBvcHRpb24oXCJsaW5lV2lzZUNvcHlDdXRcIiwgdHJ1ZSk7XG5cbiAgb3B0aW9uKFwicmVhZE9ubHlcIiwgZmFsc2UsIGZ1bmN0aW9uKGNtLCB2YWwpIHtcbiAgICBpZiAodmFsID09IFwibm9jdXJzb3JcIikge1xuICAgICAgb25CbHVyKGNtKTtcbiAgICAgIGNtLmRpc3BsYXkuaW5wdXQuYmx1cigpO1xuICAgICAgY20uZGlzcGxheS5kaXNhYmxlZCA9IHRydWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNtLmRpc3BsYXkuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgY20uZGlzcGxheS5pbnB1dC5yZWFkT25seUNoYW5nZWQodmFsKVxuICB9KTtcbiAgb3B0aW9uKFwiZGlzYWJsZUlucHV0XCIsIGZhbHNlLCBmdW5jdGlvbihjbSwgdmFsKSB7aWYgKCF2YWwpIGNtLmRpc3BsYXkuaW5wdXQucmVzZXQoKTt9LCB0cnVlKTtcbiAgb3B0aW9uKFwiZHJhZ0Ryb3BcIiwgdHJ1ZSwgZHJhZ0Ryb3BDaGFuZ2VkKTtcbiAgb3B0aW9uKFwiYWxsb3dEcm9wRmlsZVR5cGVzXCIsIG51bGwpO1xuXG4gIG9wdGlvbihcImN1cnNvckJsaW5rUmF0ZVwiLCA1MzApO1xuICBvcHRpb24oXCJjdXJzb3JTY3JvbGxNYXJnaW5cIiwgMCk7XG4gIG9wdGlvbihcImN1cnNvckhlaWdodFwiLCAxLCB1cGRhdGVTZWxlY3Rpb24sIHRydWUpO1xuICBvcHRpb24oXCJzaW5nbGVDdXJzb3JIZWlnaHRQZXJMaW5lXCIsIHRydWUsIHVwZGF0ZVNlbGVjdGlvbiwgdHJ1ZSk7XG4gIG9wdGlvbihcIndvcmtUaW1lXCIsIDEwMCk7XG4gIG9wdGlvbihcIndvcmtEZWxheVwiLCAxMDApO1xuICBvcHRpb24oXCJmbGF0dGVuU3BhbnNcIiwgdHJ1ZSwgcmVzZXRNb2RlU3RhdGUsIHRydWUpO1xuICBvcHRpb24oXCJhZGRNb2RlQ2xhc3NcIiwgZmFsc2UsIHJlc2V0TW9kZVN0YXRlLCB0cnVlKTtcbiAgb3B0aW9uKFwicG9sbEludGVydmFsXCIsIDEwMCk7XG4gIG9wdGlvbihcInVuZG9EZXB0aFwiLCAyMDAsIGZ1bmN0aW9uKGNtLCB2YWwpe2NtLmRvYy5oaXN0b3J5LnVuZG9EZXB0aCA9IHZhbDt9KTtcbiAgb3B0aW9uKFwiaGlzdG9yeUV2ZW50RGVsYXlcIiwgMTI1MCk7XG4gIG9wdGlvbihcInZpZXdwb3J0TWFyZ2luXCIsIDEwLCBmdW5jdGlvbihjbSl7Y20ucmVmcmVzaCgpO30sIHRydWUpO1xuICBvcHRpb24oXCJtYXhIaWdobGlnaHRMZW5ndGhcIiwgMTAwMDAsIHJlc2V0TW9kZVN0YXRlLCB0cnVlKTtcbiAgb3B0aW9uKFwibW92ZUlucHV0V2l0aEN1cnNvclwiLCB0cnVlLCBmdW5jdGlvbihjbSwgdmFsKSB7XG4gICAgaWYgKCF2YWwpIGNtLmRpc3BsYXkuaW5wdXQucmVzZXRQb3NpdGlvbigpO1xuICB9KTtcblxuICBvcHRpb24oXCJ0YWJpbmRleFwiLCBudWxsLCBmdW5jdGlvbihjbSwgdmFsKSB7XG4gICAgY20uZGlzcGxheS5pbnB1dC5nZXRGaWVsZCgpLnRhYkluZGV4ID0gdmFsIHx8IFwiXCI7XG4gIH0pO1xuICBvcHRpb24oXCJhdXRvZm9jdXNcIiwgbnVsbCk7XG5cbiAgLy8gTU9ERSBERUZJTklUSU9OIEFORCBRVUVSWUlOR1xuXG4gIC8vIEtub3duIG1vZGVzLCBieSBuYW1lIGFuZCBieSBNSU1FXG4gIHZhciBtb2RlcyA9IENvZGVNaXJyb3IubW9kZXMgPSB7fSwgbWltZU1vZGVzID0gQ29kZU1pcnJvci5taW1lTW9kZXMgPSB7fTtcblxuICAvLyBFeHRyYSBhcmd1bWVudHMgYXJlIHN0b3JlZCBhcyB0aGUgbW9kZSdzIGRlcGVuZGVuY2llcywgd2hpY2ggaXNcbiAgLy8gdXNlZCBieSAobGVnYWN5KSBtZWNoYW5pc21zIGxpa2UgbG9hZG1vZGUuanMgdG8gYXV0b21hdGljYWxseVxuICAvLyBsb2FkIGEgbW9kZS4gKFByZWZlcnJlZCBtZWNoYW5pc20gaXMgdGhlIHJlcXVpcmUvZGVmaW5lIGNhbGxzLilcbiAgQ29kZU1pcnJvci5kZWZpbmVNb2RlID0gZnVuY3Rpb24obmFtZSwgbW9kZSkge1xuICAgIGlmICghQ29kZU1pcnJvci5kZWZhdWx0cy5tb2RlICYmIG5hbWUgIT0gXCJudWxsXCIpIENvZGVNaXJyb3IuZGVmYXVsdHMubW9kZSA9IG5hbWU7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAyKVxuICAgICAgbW9kZS5kZXBlbmRlbmNpZXMgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpO1xuICAgIG1vZGVzW25hbWVdID0gbW9kZTtcbiAgfTtcblxuICBDb2RlTWlycm9yLmRlZmluZU1JTUUgPSBmdW5jdGlvbihtaW1lLCBzcGVjKSB7XG4gICAgbWltZU1vZGVzW21pbWVdID0gc3BlYztcbiAgfTtcblxuICAvLyBHaXZlbiBhIE1JTUUgdHlwZSwgYSB7bmFtZSwgLi4ub3B0aW9uc30gY29uZmlnIG9iamVjdCwgb3IgYSBuYW1lXG4gIC8vIHN0cmluZywgcmV0dXJuIGEgbW9kZSBjb25maWcgb2JqZWN0LlxuICBDb2RlTWlycm9yLnJlc29sdmVNb2RlID0gZnVuY3Rpb24oc3BlYykge1xuICAgIGlmICh0eXBlb2Ygc3BlYyA9PSBcInN0cmluZ1wiICYmIG1pbWVNb2Rlcy5oYXNPd25Qcm9wZXJ0eShzcGVjKSkge1xuICAgICAgc3BlYyA9IG1pbWVNb2Rlc1tzcGVjXTtcbiAgICB9IGVsc2UgaWYgKHNwZWMgJiYgdHlwZW9mIHNwZWMubmFtZSA9PSBcInN0cmluZ1wiICYmIG1pbWVNb2Rlcy5oYXNPd25Qcm9wZXJ0eShzcGVjLm5hbWUpKSB7XG4gICAgICB2YXIgZm91bmQgPSBtaW1lTW9kZXNbc3BlYy5uYW1lXTtcbiAgICAgIGlmICh0eXBlb2YgZm91bmQgPT0gXCJzdHJpbmdcIikgZm91bmQgPSB7bmFtZTogZm91bmR9O1xuICAgICAgc3BlYyA9IGNyZWF0ZU9iaihmb3VuZCwgc3BlYyk7XG4gICAgICBzcGVjLm5hbWUgPSBmb3VuZC5uYW1lO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIHNwZWMgPT0gXCJzdHJpbmdcIiAmJiAvXltcXHdcXC1dK1xcL1tcXHdcXC1dK1xcK3htbCQvLnRlc3Qoc3BlYykpIHtcbiAgICAgIHJldHVybiBDb2RlTWlycm9yLnJlc29sdmVNb2RlKFwiYXBwbGljYXRpb24veG1sXCIpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHNwZWMgPT0gXCJzdHJpbmdcIikgcmV0dXJuIHtuYW1lOiBzcGVjfTtcbiAgICBlbHNlIHJldHVybiBzcGVjIHx8IHtuYW1lOiBcIm51bGxcIn07XG4gIH07XG5cbiAgLy8gR2l2ZW4gYSBtb2RlIHNwZWMgKGFueXRoaW5nIHRoYXQgcmVzb2x2ZU1vZGUgYWNjZXB0cyksIGZpbmQgYW5kXG4gIC8vIGluaXRpYWxpemUgYW4gYWN0dWFsIG1vZGUgb2JqZWN0LlxuICBDb2RlTWlycm9yLmdldE1vZGUgPSBmdW5jdGlvbihvcHRpb25zLCBzcGVjKSB7XG4gICAgdmFyIHNwZWMgPSBDb2RlTWlycm9yLnJlc29sdmVNb2RlKHNwZWMpO1xuICAgIHZhciBtZmFjdG9yeSA9IG1vZGVzW3NwZWMubmFtZV07XG4gICAgaWYgKCFtZmFjdG9yeSkgcmV0dXJuIENvZGVNaXJyb3IuZ2V0TW9kZShvcHRpb25zLCBcInRleHQvcGxhaW5cIik7XG4gICAgdmFyIG1vZGVPYmogPSBtZmFjdG9yeShvcHRpb25zLCBzcGVjKTtcbiAgICBpZiAobW9kZUV4dGVuc2lvbnMuaGFzT3duUHJvcGVydHkoc3BlYy5uYW1lKSkge1xuICAgICAgdmFyIGV4dHMgPSBtb2RlRXh0ZW5zaW9uc1tzcGVjLm5hbWVdO1xuICAgICAgZm9yICh2YXIgcHJvcCBpbiBleHRzKSB7XG4gICAgICAgIGlmICghZXh0cy5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgY29udGludWU7XG4gICAgICAgIGlmIChtb2RlT2JqLmhhc093blByb3BlcnR5KHByb3ApKSBtb2RlT2JqW1wiX1wiICsgcHJvcF0gPSBtb2RlT2JqW3Byb3BdO1xuICAgICAgICBtb2RlT2JqW3Byb3BdID0gZXh0c1twcm9wXTtcbiAgICAgIH1cbiAgICB9XG4gICAgbW9kZU9iai5uYW1lID0gc3BlYy5uYW1lO1xuICAgIGlmIChzcGVjLmhlbHBlclR5cGUpIG1vZGVPYmouaGVscGVyVHlwZSA9IHNwZWMuaGVscGVyVHlwZTtcbiAgICBpZiAoc3BlYy5tb2RlUHJvcHMpIGZvciAodmFyIHByb3AgaW4gc3BlYy5tb2RlUHJvcHMpXG4gICAgICBtb2RlT2JqW3Byb3BdID0gc3BlYy5tb2RlUHJvcHNbcHJvcF07XG5cbiAgICByZXR1cm4gbW9kZU9iajtcbiAgfTtcblxuICAvLyBNaW5pbWFsIGRlZmF1bHQgbW9kZS5cbiAgQ29kZU1pcnJvci5kZWZpbmVNb2RlKFwibnVsbFwiLCBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4ge3Rva2VuOiBmdW5jdGlvbihzdHJlYW0pIHtzdHJlYW0uc2tpcFRvRW5kKCk7fX07XG4gIH0pO1xuICBDb2RlTWlycm9yLmRlZmluZU1JTUUoXCJ0ZXh0L3BsYWluXCIsIFwibnVsbFwiKTtcblxuICAvLyBUaGlzIGNhbiBiZSB1c2VkIHRvIGF0dGFjaCBwcm9wZXJ0aWVzIHRvIG1vZGUgb2JqZWN0cyBmcm9tXG4gIC8vIG91dHNpZGUgdGhlIGFjdHVhbCBtb2RlIGRlZmluaXRpb24uXG4gIHZhciBtb2RlRXh0ZW5zaW9ucyA9IENvZGVNaXJyb3IubW9kZUV4dGVuc2lvbnMgPSB7fTtcbiAgQ29kZU1pcnJvci5leHRlbmRNb2RlID0gZnVuY3Rpb24obW9kZSwgcHJvcGVydGllcykge1xuICAgIHZhciBleHRzID0gbW9kZUV4dGVuc2lvbnMuaGFzT3duUHJvcGVydHkobW9kZSkgPyBtb2RlRXh0ZW5zaW9uc1ttb2RlXSA6IChtb2RlRXh0ZW5zaW9uc1ttb2RlXSA9IHt9KTtcbiAgICBjb3B5T2JqKHByb3BlcnRpZXMsIGV4dHMpO1xuICB9O1xuXG4gIC8vIEVYVEVOU0lPTlNcblxuICBDb2RlTWlycm9yLmRlZmluZUV4dGVuc2lvbiA9IGZ1bmN0aW9uKG5hbWUsIGZ1bmMpIHtcbiAgICBDb2RlTWlycm9yLnByb3RvdHlwZVtuYW1lXSA9IGZ1bmM7XG4gIH07XG4gIENvZGVNaXJyb3IuZGVmaW5lRG9jRXh0ZW5zaW9uID0gZnVuY3Rpb24obmFtZSwgZnVuYykge1xuICAgIERvYy5wcm90b3R5cGVbbmFtZV0gPSBmdW5jO1xuICB9O1xuICBDb2RlTWlycm9yLmRlZmluZU9wdGlvbiA9IG9wdGlvbjtcblxuICB2YXIgaW5pdEhvb2tzID0gW107XG4gIENvZGVNaXJyb3IuZGVmaW5lSW5pdEhvb2sgPSBmdW5jdGlvbihmKSB7aW5pdEhvb2tzLnB1c2goZik7fTtcblxuICB2YXIgaGVscGVycyA9IENvZGVNaXJyb3IuaGVscGVycyA9IHt9O1xuICBDb2RlTWlycm9yLnJlZ2lzdGVySGVscGVyID0gZnVuY3Rpb24odHlwZSwgbmFtZSwgdmFsdWUpIHtcbiAgICBpZiAoIWhlbHBlcnMuaGFzT3duUHJvcGVydHkodHlwZSkpIGhlbHBlcnNbdHlwZV0gPSBDb2RlTWlycm9yW3R5cGVdID0ge19nbG9iYWw6IFtdfTtcbiAgICBoZWxwZXJzW3R5cGVdW25hbWVdID0gdmFsdWU7XG4gIH07XG4gIENvZGVNaXJyb3IucmVnaXN0ZXJHbG9iYWxIZWxwZXIgPSBmdW5jdGlvbih0eXBlLCBuYW1lLCBwcmVkaWNhdGUsIHZhbHVlKSB7XG4gICAgQ29kZU1pcnJvci5yZWdpc3RlckhlbHBlcih0eXBlLCBuYW1lLCB2YWx1ZSk7XG4gICAgaGVscGVyc1t0eXBlXS5fZ2xvYmFsLnB1c2goe3ByZWQ6IHByZWRpY2F0ZSwgdmFsOiB2YWx1ZX0pO1xuICB9O1xuXG4gIC8vIE1PREUgU1RBVEUgSEFORExJTkdcblxuICAvLyBVdGlsaXR5IGZ1bmN0aW9ucyBmb3Igd29ya2luZyB3aXRoIHN0YXRlLiBFeHBvcnRlZCBiZWNhdXNlIG5lc3RlZFxuICAvLyBtb2RlcyBuZWVkIHRvIGRvIHRoaXMgZm9yIHRoZWlyIGlubmVyIG1vZGVzLlxuXG4gIHZhciBjb3B5U3RhdGUgPSBDb2RlTWlycm9yLmNvcHlTdGF0ZSA9IGZ1bmN0aW9uKG1vZGUsIHN0YXRlKSB7XG4gICAgaWYgKHN0YXRlID09PSB0cnVlKSByZXR1cm4gc3RhdGU7XG4gICAgaWYgKG1vZGUuY29weVN0YXRlKSByZXR1cm4gbW9kZS5jb3B5U3RhdGUoc3RhdGUpO1xuICAgIHZhciBuc3RhdGUgPSB7fTtcbiAgICBmb3IgKHZhciBuIGluIHN0YXRlKSB7XG4gICAgICB2YXIgdmFsID0gc3RhdGVbbl07XG4gICAgICBpZiAodmFsIGluc3RhbmNlb2YgQXJyYXkpIHZhbCA9IHZhbC5jb25jYXQoW10pO1xuICAgICAgbnN0YXRlW25dID0gdmFsO1xuICAgIH1cbiAgICByZXR1cm4gbnN0YXRlO1xuICB9O1xuXG4gIHZhciBzdGFydFN0YXRlID0gQ29kZU1pcnJvci5zdGFydFN0YXRlID0gZnVuY3Rpb24obW9kZSwgYTEsIGEyKSB7XG4gICAgcmV0dXJuIG1vZGUuc3RhcnRTdGF0ZSA/IG1vZGUuc3RhcnRTdGF0ZShhMSwgYTIpIDogdHJ1ZTtcbiAgfTtcblxuICAvLyBHaXZlbiBhIG1vZGUgYW5kIGEgc3RhdGUgKGZvciB0aGF0IG1vZGUpLCBmaW5kIHRoZSBpbm5lciBtb2RlIGFuZFxuICAvLyBzdGF0ZSBhdCB0aGUgcG9zaXRpb24gdGhhdCB0aGUgc3RhdGUgcmVmZXJzIHRvLlxuICBDb2RlTWlycm9yLmlubmVyTW9kZSA9IGZ1bmN0aW9uKG1vZGUsIHN0YXRlKSB7XG4gICAgd2hpbGUgKG1vZGUuaW5uZXJNb2RlKSB7XG4gICAgICB2YXIgaW5mbyA9IG1vZGUuaW5uZXJNb2RlKHN0YXRlKTtcbiAgICAgIGlmICghaW5mbyB8fCBpbmZvLm1vZGUgPT0gbW9kZSkgYnJlYWs7XG4gICAgICBzdGF0ZSA9IGluZm8uc3RhdGU7XG4gICAgICBtb2RlID0gaW5mby5tb2RlO1xuICAgIH1cbiAgICByZXR1cm4gaW5mbyB8fCB7bW9kZTogbW9kZSwgc3RhdGU6IHN0YXRlfTtcbiAgfTtcblxuICAvLyBTVEFOREFSRCBDT01NQU5EU1xuXG4gIC8vIENvbW1hbmRzIGFyZSBwYXJhbWV0ZXItbGVzcyBhY3Rpb25zIHRoYXQgY2FuIGJlIHBlcmZvcm1lZCBvbiBhblxuICAvLyBlZGl0b3IsIG1vc3RseSB1c2VkIGZvciBrZXliaW5kaW5ncy5cbiAgdmFyIGNvbW1hbmRzID0gQ29kZU1pcnJvci5jb21tYW5kcyA9IHtcbiAgICBzZWxlY3RBbGw6IGZ1bmN0aW9uKGNtKSB7Y20uc2V0U2VsZWN0aW9uKFBvcyhjbS5maXJzdExpbmUoKSwgMCksIFBvcyhjbS5sYXN0TGluZSgpKSwgc2VsX2RvbnRTY3JvbGwpO30sXG4gICAgc2luZ2xlU2VsZWN0aW9uOiBmdW5jdGlvbihjbSkge1xuICAgICAgY20uc2V0U2VsZWN0aW9uKGNtLmdldEN1cnNvcihcImFuY2hvclwiKSwgY20uZ2V0Q3Vyc29yKFwiaGVhZFwiKSwgc2VsX2RvbnRTY3JvbGwpO1xuICAgIH0sXG4gICAga2lsbExpbmU6IGZ1bmN0aW9uKGNtKSB7XG4gICAgICBkZWxldGVOZWFyU2VsZWN0aW9uKGNtLCBmdW5jdGlvbihyYW5nZSkge1xuICAgICAgICBpZiAocmFuZ2UuZW1wdHkoKSkge1xuICAgICAgICAgIHZhciBsZW4gPSBnZXRMaW5lKGNtLmRvYywgcmFuZ2UuaGVhZC5saW5lKS50ZXh0Lmxlbmd0aDtcbiAgICAgICAgICBpZiAocmFuZ2UuaGVhZC5jaCA9PSBsZW4gJiYgcmFuZ2UuaGVhZC5saW5lIDwgY20ubGFzdExpbmUoKSlcbiAgICAgICAgICAgIHJldHVybiB7ZnJvbTogcmFuZ2UuaGVhZCwgdG86IFBvcyhyYW5nZS5oZWFkLmxpbmUgKyAxLCAwKX07XG4gICAgICAgICAgZWxzZVxuICAgICAgICAgICAgcmV0dXJuIHtmcm9tOiByYW5nZS5oZWFkLCB0bzogUG9zKHJhbmdlLmhlYWQubGluZSwgbGVuKX07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHtmcm9tOiByYW5nZS5mcm9tKCksIHRvOiByYW5nZS50bygpfTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSxcbiAgICBkZWxldGVMaW5lOiBmdW5jdGlvbihjbSkge1xuICAgICAgZGVsZXRlTmVhclNlbGVjdGlvbihjbSwgZnVuY3Rpb24ocmFuZ2UpIHtcbiAgICAgICAgcmV0dXJuIHtmcm9tOiBQb3MocmFuZ2UuZnJvbSgpLmxpbmUsIDApLFxuICAgICAgICAgICAgICAgIHRvOiBjbGlwUG9zKGNtLmRvYywgUG9zKHJhbmdlLnRvKCkubGluZSArIDEsIDApKX07XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGRlbExpbmVMZWZ0OiBmdW5jdGlvbihjbSkge1xuICAgICAgZGVsZXRlTmVhclNlbGVjdGlvbihjbSwgZnVuY3Rpb24ocmFuZ2UpIHtcbiAgICAgICAgcmV0dXJuIHtmcm9tOiBQb3MocmFuZ2UuZnJvbSgpLmxpbmUsIDApLCB0bzogcmFuZ2UuZnJvbSgpfTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZGVsV3JhcHBlZExpbmVMZWZ0OiBmdW5jdGlvbihjbSkge1xuICAgICAgZGVsZXRlTmVhclNlbGVjdGlvbihjbSwgZnVuY3Rpb24ocmFuZ2UpIHtcbiAgICAgICAgdmFyIHRvcCA9IGNtLmNoYXJDb29yZHMocmFuZ2UuaGVhZCwgXCJkaXZcIikudG9wICsgNTtcbiAgICAgICAgdmFyIGxlZnRQb3MgPSBjbS5jb29yZHNDaGFyKHtsZWZ0OiAwLCB0b3A6IHRvcH0sIFwiZGl2XCIpO1xuICAgICAgICByZXR1cm4ge2Zyb206IGxlZnRQb3MsIHRvOiByYW5nZS5mcm9tKCl9O1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBkZWxXcmFwcGVkTGluZVJpZ2h0OiBmdW5jdGlvbihjbSkge1xuICAgICAgZGVsZXRlTmVhclNlbGVjdGlvbihjbSwgZnVuY3Rpb24ocmFuZ2UpIHtcbiAgICAgICAgdmFyIHRvcCA9IGNtLmNoYXJDb29yZHMocmFuZ2UuaGVhZCwgXCJkaXZcIikudG9wICsgNTtcbiAgICAgICAgdmFyIHJpZ2h0UG9zID0gY20uY29vcmRzQ2hhcih7bGVmdDogY20uZGlzcGxheS5saW5lRGl2Lm9mZnNldFdpZHRoICsgMTAwLCB0b3A6IHRvcH0sIFwiZGl2XCIpO1xuICAgICAgICByZXR1cm4ge2Zyb206IHJhbmdlLmZyb20oKSwgdG86IHJpZ2h0UG9zIH07XG4gICAgICB9KTtcbiAgICB9LFxuICAgIHVuZG86IGZ1bmN0aW9uKGNtKSB7Y20udW5kbygpO30sXG4gICAgcmVkbzogZnVuY3Rpb24oY20pIHtjbS5yZWRvKCk7fSxcbiAgICB1bmRvU2VsZWN0aW9uOiBmdW5jdGlvbihjbSkge2NtLnVuZG9TZWxlY3Rpb24oKTt9LFxuICAgIHJlZG9TZWxlY3Rpb246IGZ1bmN0aW9uKGNtKSB7Y20ucmVkb1NlbGVjdGlvbigpO30sXG4gICAgZ29Eb2NTdGFydDogZnVuY3Rpb24oY20pIHtjbS5leHRlbmRTZWxlY3Rpb24oUG9zKGNtLmZpcnN0TGluZSgpLCAwKSk7fSxcbiAgICBnb0RvY0VuZDogZnVuY3Rpb24oY20pIHtjbS5leHRlbmRTZWxlY3Rpb24oUG9zKGNtLmxhc3RMaW5lKCkpKTt9LFxuICAgIGdvTGluZVN0YXJ0OiBmdW5jdGlvbihjbSkge1xuICAgICAgY20uZXh0ZW5kU2VsZWN0aW9uc0J5KGZ1bmN0aW9uKHJhbmdlKSB7IHJldHVybiBsaW5lU3RhcnQoY20sIHJhbmdlLmhlYWQubGluZSk7IH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge29yaWdpbjogXCIrbW92ZVwiLCBiaWFzOiAxfSk7XG4gICAgfSxcbiAgICBnb0xpbmVTdGFydFNtYXJ0OiBmdW5jdGlvbihjbSkge1xuICAgICAgY20uZXh0ZW5kU2VsZWN0aW9uc0J5KGZ1bmN0aW9uKHJhbmdlKSB7XG4gICAgICAgIHJldHVybiBsaW5lU3RhcnRTbWFydChjbSwgcmFuZ2UuaGVhZCk7XG4gICAgICB9LCB7b3JpZ2luOiBcIittb3ZlXCIsIGJpYXM6IDF9KTtcbiAgICB9LFxuICAgIGdvTGluZUVuZDogZnVuY3Rpb24oY20pIHtcbiAgICAgIGNtLmV4dGVuZFNlbGVjdGlvbnNCeShmdW5jdGlvbihyYW5nZSkgeyByZXR1cm4gbGluZUVuZChjbSwgcmFuZ2UuaGVhZC5saW5lKTsgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7b3JpZ2luOiBcIittb3ZlXCIsIGJpYXM6IC0xfSk7XG4gICAgfSxcbiAgICBnb0xpbmVSaWdodDogZnVuY3Rpb24oY20pIHtcbiAgICAgIGNtLmV4dGVuZFNlbGVjdGlvbnNCeShmdW5jdGlvbihyYW5nZSkge1xuICAgICAgICB2YXIgdG9wID0gY20uY2hhckNvb3JkcyhyYW5nZS5oZWFkLCBcImRpdlwiKS50b3AgKyA1O1xuICAgICAgICByZXR1cm4gY20uY29vcmRzQ2hhcih7bGVmdDogY20uZGlzcGxheS5saW5lRGl2Lm9mZnNldFdpZHRoICsgMTAwLCB0b3A6IHRvcH0sIFwiZGl2XCIpO1xuICAgICAgfSwgc2VsX21vdmUpO1xuICAgIH0sXG4gICAgZ29MaW5lTGVmdDogZnVuY3Rpb24oY20pIHtcbiAgICAgIGNtLmV4dGVuZFNlbGVjdGlvbnNCeShmdW5jdGlvbihyYW5nZSkge1xuICAgICAgICB2YXIgdG9wID0gY20uY2hhckNvb3JkcyhyYW5nZS5oZWFkLCBcImRpdlwiKS50b3AgKyA1O1xuICAgICAgICByZXR1cm4gY20uY29vcmRzQ2hhcih7bGVmdDogMCwgdG9wOiB0b3B9LCBcImRpdlwiKTtcbiAgICAgIH0sIHNlbF9tb3ZlKTtcbiAgICB9LFxuICAgIGdvTGluZUxlZnRTbWFydDogZnVuY3Rpb24oY20pIHtcbiAgICAgIGNtLmV4dGVuZFNlbGVjdGlvbnNCeShmdW5jdGlvbihyYW5nZSkge1xuICAgICAgICB2YXIgdG9wID0gY20uY2hhckNvb3JkcyhyYW5nZS5oZWFkLCBcImRpdlwiKS50b3AgKyA1O1xuICAgICAgICB2YXIgcG9zID0gY20uY29vcmRzQ2hhcih7bGVmdDogMCwgdG9wOiB0b3B9LCBcImRpdlwiKTtcbiAgICAgICAgaWYgKHBvcy5jaCA8IGNtLmdldExpbmUocG9zLmxpbmUpLnNlYXJjaCgvXFxTLykpIHJldHVybiBsaW5lU3RhcnRTbWFydChjbSwgcmFuZ2UuaGVhZCk7XG4gICAgICAgIHJldHVybiBwb3M7XG4gICAgICB9LCBzZWxfbW92ZSk7XG4gICAgfSxcbiAgICBnb0xpbmVVcDogZnVuY3Rpb24oY20pIHtjbS5tb3ZlVigtMSwgXCJsaW5lXCIpO30sXG4gICAgZ29MaW5lRG93bjogZnVuY3Rpb24oY20pIHtjbS5tb3ZlVigxLCBcImxpbmVcIik7fSxcbiAgICBnb1BhZ2VVcDogZnVuY3Rpb24oY20pIHtjbS5tb3ZlVigtMSwgXCJwYWdlXCIpO30sXG4gICAgZ29QYWdlRG93bjogZnVuY3Rpb24oY20pIHtjbS5tb3ZlVigxLCBcInBhZ2VcIik7fSxcbiAgICBnb0NoYXJMZWZ0OiBmdW5jdGlvbihjbSkge2NtLm1vdmVIKC0xLCBcImNoYXJcIik7fSxcbiAgICBnb0NoYXJSaWdodDogZnVuY3Rpb24oY20pIHtjbS5tb3ZlSCgxLCBcImNoYXJcIik7fSxcbiAgICBnb0NvbHVtbkxlZnQ6IGZ1bmN0aW9uKGNtKSB7Y20ubW92ZUgoLTEsIFwiY29sdW1uXCIpO30sXG4gICAgZ29Db2x1bW5SaWdodDogZnVuY3Rpb24oY20pIHtjbS5tb3ZlSCgxLCBcImNvbHVtblwiKTt9LFxuICAgIGdvV29yZExlZnQ6IGZ1bmN0aW9uKGNtKSB7Y20ubW92ZUgoLTEsIFwid29yZFwiKTt9LFxuICAgIGdvR3JvdXBSaWdodDogZnVuY3Rpb24oY20pIHtjbS5tb3ZlSCgxLCBcImdyb3VwXCIpO30sXG4gICAgZ29Hcm91cExlZnQ6IGZ1bmN0aW9uKGNtKSB7Y20ubW92ZUgoLTEsIFwiZ3JvdXBcIik7fSxcbiAgICBnb1dvcmRSaWdodDogZnVuY3Rpb24oY20pIHtjbS5tb3ZlSCgxLCBcIndvcmRcIik7fSxcbiAgICBkZWxDaGFyQmVmb3JlOiBmdW5jdGlvbihjbSkge2NtLmRlbGV0ZUgoLTEsIFwiY2hhclwiKTt9LFxuICAgIGRlbENoYXJBZnRlcjogZnVuY3Rpb24oY20pIHtjbS5kZWxldGVIKDEsIFwiY2hhclwiKTt9LFxuICAgIGRlbFdvcmRCZWZvcmU6IGZ1bmN0aW9uKGNtKSB7Y20uZGVsZXRlSCgtMSwgXCJ3b3JkXCIpO30sXG4gICAgZGVsV29yZEFmdGVyOiBmdW5jdGlvbihjbSkge2NtLmRlbGV0ZUgoMSwgXCJ3b3JkXCIpO30sXG4gICAgZGVsR3JvdXBCZWZvcmU6IGZ1bmN0aW9uKGNtKSB7Y20uZGVsZXRlSCgtMSwgXCJncm91cFwiKTt9LFxuICAgIGRlbEdyb3VwQWZ0ZXI6IGZ1bmN0aW9uKGNtKSB7Y20uZGVsZXRlSCgxLCBcImdyb3VwXCIpO30sXG4gICAgaW5kZW50QXV0bzogZnVuY3Rpb24oY20pIHtjbS5pbmRlbnRTZWxlY3Rpb24oXCJzbWFydFwiKTt9LFxuICAgIGluZGVudE1vcmU6IGZ1bmN0aW9uKGNtKSB7Y20uaW5kZW50U2VsZWN0aW9uKFwiYWRkXCIpO30sXG4gICAgaW5kZW50TGVzczogZnVuY3Rpb24oY20pIHtjbS5pbmRlbnRTZWxlY3Rpb24oXCJzdWJ0cmFjdFwiKTt9LFxuICAgIGluc2VydFRhYjogZnVuY3Rpb24oY20pIHtjbS5yZXBsYWNlU2VsZWN0aW9uKFwiXFx0XCIpO30sXG4gICAgaW5zZXJ0U29mdFRhYjogZnVuY3Rpb24oY20pIHtcbiAgICAgIHZhciBzcGFjZXMgPSBbXSwgcmFuZ2VzID0gY20ubGlzdFNlbGVjdGlvbnMoKSwgdGFiU2l6ZSA9IGNtLm9wdGlvbnMudGFiU2l6ZTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmFuZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBwb3MgPSByYW5nZXNbaV0uZnJvbSgpO1xuICAgICAgICB2YXIgY29sID0gY291bnRDb2x1bW4oY20uZ2V0TGluZShwb3MubGluZSksIHBvcy5jaCwgdGFiU2l6ZSk7XG4gICAgICAgIHNwYWNlcy5wdXNoKG5ldyBBcnJheSh0YWJTaXplIC0gY29sICUgdGFiU2l6ZSArIDEpLmpvaW4oXCIgXCIpKTtcbiAgICAgIH1cbiAgICAgIGNtLnJlcGxhY2VTZWxlY3Rpb25zKHNwYWNlcyk7XG4gICAgfSxcbiAgICBkZWZhdWx0VGFiOiBmdW5jdGlvbihjbSkge1xuICAgICAgaWYgKGNtLnNvbWV0aGluZ1NlbGVjdGVkKCkpIGNtLmluZGVudFNlbGVjdGlvbihcImFkZFwiKTtcbiAgICAgIGVsc2UgY20uZXhlY0NvbW1hbmQoXCJpbnNlcnRUYWJcIik7XG4gICAgfSxcbiAgICB0cmFuc3Bvc2VDaGFyczogZnVuY3Rpb24oY20pIHtcbiAgICAgIHJ1bkluT3AoY20sIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgcmFuZ2VzID0gY20ubGlzdFNlbGVjdGlvbnMoKSwgbmV3U2VsID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmFuZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgdmFyIGN1ciA9IHJhbmdlc1tpXS5oZWFkLCBsaW5lID0gZ2V0TGluZShjbS5kb2MsIGN1ci5saW5lKS50ZXh0O1xuICAgICAgICAgIGlmIChsaW5lKSB7XG4gICAgICAgICAgICBpZiAoY3VyLmNoID09IGxpbmUubGVuZ3RoKSBjdXIgPSBuZXcgUG9zKGN1ci5saW5lLCBjdXIuY2ggLSAxKTtcbiAgICAgICAgICAgIGlmIChjdXIuY2ggPiAwKSB7XG4gICAgICAgICAgICAgIGN1ciA9IG5ldyBQb3MoY3VyLmxpbmUsIGN1ci5jaCArIDEpO1xuICAgICAgICAgICAgICBjbS5yZXBsYWNlUmFuZ2UobGluZS5jaGFyQXQoY3VyLmNoIC0gMSkgKyBsaW5lLmNoYXJBdChjdXIuY2ggLSAyKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBvcyhjdXIubGluZSwgY3VyLmNoIC0gMiksIGN1ciwgXCIrdHJhbnNwb3NlXCIpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChjdXIubGluZSA+IGNtLmRvYy5maXJzdCkge1xuICAgICAgICAgICAgICB2YXIgcHJldiA9IGdldExpbmUoY20uZG9jLCBjdXIubGluZSAtIDEpLnRleHQ7XG4gICAgICAgICAgICAgIGlmIChwcmV2KVxuICAgICAgICAgICAgICAgIGNtLnJlcGxhY2VSYW5nZShsaW5lLmNoYXJBdCgwKSArIGNtLmRvYy5saW5lU2VwYXJhdG9yKCkgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmV2LmNoYXJBdChwcmV2Lmxlbmd0aCAtIDEpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3MoY3VyLmxpbmUgLSAxLCBwcmV2Lmxlbmd0aCAtIDEpLCBQb3MoY3VyLmxpbmUsIDEpLCBcIit0cmFuc3Bvc2VcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIG5ld1NlbC5wdXNoKG5ldyBSYW5nZShjdXIsIGN1cikpO1xuICAgICAgICB9XG4gICAgICAgIGNtLnNldFNlbGVjdGlvbnMobmV3U2VsKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgbmV3bGluZUFuZEluZGVudDogZnVuY3Rpb24oY20pIHtcbiAgICAgIHJ1bkluT3AoY20sIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgbGVuID0gY20ubGlzdFNlbGVjdGlvbnMoKS5sZW5ndGg7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICB2YXIgcmFuZ2UgPSBjbS5saXN0U2VsZWN0aW9ucygpW2ldO1xuICAgICAgICAgIGNtLnJlcGxhY2VSYW5nZShjbS5kb2MubGluZVNlcGFyYXRvcigpLCByYW5nZS5hbmNob3IsIHJhbmdlLmhlYWQsIFwiK2lucHV0XCIpO1xuICAgICAgICAgIGNtLmluZGVudExpbmUocmFuZ2UuZnJvbSgpLmxpbmUgKyAxLCBudWxsLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbnN1cmVDdXJzb3JWaXNpYmxlKGNtKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgdG9nZ2xlT3ZlcndyaXRlOiBmdW5jdGlvbihjbSkge2NtLnRvZ2dsZU92ZXJ3cml0ZSgpO31cbiAgfTtcblxuXG4gIC8vIFNUQU5EQVJEIEtFWU1BUFNcblxuICB2YXIga2V5TWFwID0gQ29kZU1pcnJvci5rZXlNYXAgPSB7fTtcblxuICBrZXlNYXAuYmFzaWMgPSB7XG4gICAgXCJMZWZ0XCI6IFwiZ29DaGFyTGVmdFwiLCBcIlJpZ2h0XCI6IFwiZ29DaGFyUmlnaHRcIiwgXCJVcFwiOiBcImdvTGluZVVwXCIsIFwiRG93blwiOiBcImdvTGluZURvd25cIixcbiAgICBcIkVuZFwiOiBcImdvTGluZUVuZFwiLCBcIkhvbWVcIjogXCJnb0xpbmVTdGFydFNtYXJ0XCIsIFwiUGFnZVVwXCI6IFwiZ29QYWdlVXBcIiwgXCJQYWdlRG93blwiOiBcImdvUGFnZURvd25cIixcbiAgICBcIkRlbGV0ZVwiOiBcImRlbENoYXJBZnRlclwiLCBcIkJhY2tzcGFjZVwiOiBcImRlbENoYXJCZWZvcmVcIiwgXCJTaGlmdC1CYWNrc3BhY2VcIjogXCJkZWxDaGFyQmVmb3JlXCIsXG4gICAgXCJUYWJcIjogXCJkZWZhdWx0VGFiXCIsIFwiU2hpZnQtVGFiXCI6IFwiaW5kZW50QXV0b1wiLFxuICAgIFwiRW50ZXJcIjogXCJuZXdsaW5lQW5kSW5kZW50XCIsIFwiSW5zZXJ0XCI6IFwidG9nZ2xlT3ZlcndyaXRlXCIsXG4gICAgXCJFc2NcIjogXCJzaW5nbGVTZWxlY3Rpb25cIlxuICB9O1xuICAvLyBOb3RlIHRoYXQgdGhlIHNhdmUgYW5kIGZpbmQtcmVsYXRlZCBjb21tYW5kcyBhcmVuJ3QgZGVmaW5lZCBieVxuICAvLyBkZWZhdWx0LiBVc2VyIGNvZGUgb3IgYWRkb25zIGNhbiBkZWZpbmUgdGhlbS4gVW5rbm93biBjb21tYW5kc1xuICAvLyBhcmUgc2ltcGx5IGlnbm9yZWQuXG4gIGtleU1hcC5wY0RlZmF1bHQgPSB7XG4gICAgXCJDdHJsLUFcIjogXCJzZWxlY3RBbGxcIiwgXCJDdHJsLURcIjogXCJkZWxldGVMaW5lXCIsIFwiQ3RybC1aXCI6IFwidW5kb1wiLCBcIlNoaWZ0LUN0cmwtWlwiOiBcInJlZG9cIiwgXCJDdHJsLVlcIjogXCJyZWRvXCIsXG4gICAgXCJDdHJsLUhvbWVcIjogXCJnb0RvY1N0YXJ0XCIsIFwiQ3RybC1FbmRcIjogXCJnb0RvY0VuZFwiLCBcIkN0cmwtVXBcIjogXCJnb0xpbmVVcFwiLCBcIkN0cmwtRG93blwiOiBcImdvTGluZURvd25cIixcbiAgICBcIkN0cmwtTGVmdFwiOiBcImdvR3JvdXBMZWZ0XCIsIFwiQ3RybC1SaWdodFwiOiBcImdvR3JvdXBSaWdodFwiLCBcIkFsdC1MZWZ0XCI6IFwiZ29MaW5lU3RhcnRcIiwgXCJBbHQtUmlnaHRcIjogXCJnb0xpbmVFbmRcIixcbiAgICBcIkN0cmwtQmFja3NwYWNlXCI6IFwiZGVsR3JvdXBCZWZvcmVcIiwgXCJDdHJsLURlbGV0ZVwiOiBcImRlbEdyb3VwQWZ0ZXJcIiwgXCJDdHJsLVNcIjogXCJzYXZlXCIsIFwiQ3RybC1GXCI6IFwiZmluZFwiLFxuICAgIFwiQ3RybC1HXCI6IFwiZmluZE5leHRcIiwgXCJTaGlmdC1DdHJsLUdcIjogXCJmaW5kUHJldlwiLCBcIlNoaWZ0LUN0cmwtRlwiOiBcInJlcGxhY2VcIiwgXCJTaGlmdC1DdHJsLVJcIjogXCJyZXBsYWNlQWxsXCIsXG4gICAgXCJDdHJsLVtcIjogXCJpbmRlbnRMZXNzXCIsIFwiQ3RybC1dXCI6IFwiaW5kZW50TW9yZVwiLFxuICAgIFwiQ3RybC1VXCI6IFwidW5kb1NlbGVjdGlvblwiLCBcIlNoaWZ0LUN0cmwtVVwiOiBcInJlZG9TZWxlY3Rpb25cIiwgXCJBbHQtVVwiOiBcInJlZG9TZWxlY3Rpb25cIixcbiAgICBmYWxsdGhyb3VnaDogXCJiYXNpY1wiXG4gIH07XG4gIC8vIFZlcnkgYmFzaWMgcmVhZGxpbmUvZW1hY3Mtc3R5bGUgYmluZGluZ3MsIHdoaWNoIGFyZSBzdGFuZGFyZCBvbiBNYWMuXG4gIGtleU1hcC5lbWFjc3kgPSB7XG4gICAgXCJDdHJsLUZcIjogXCJnb0NoYXJSaWdodFwiLCBcIkN0cmwtQlwiOiBcImdvQ2hhckxlZnRcIiwgXCJDdHJsLVBcIjogXCJnb0xpbmVVcFwiLCBcIkN0cmwtTlwiOiBcImdvTGluZURvd25cIixcbiAgICBcIkFsdC1GXCI6IFwiZ29Xb3JkUmlnaHRcIiwgXCJBbHQtQlwiOiBcImdvV29yZExlZnRcIiwgXCJDdHJsLUFcIjogXCJnb0xpbmVTdGFydFwiLCBcIkN0cmwtRVwiOiBcImdvTGluZUVuZFwiLFxuICAgIFwiQ3RybC1WXCI6IFwiZ29QYWdlRG93blwiLCBcIlNoaWZ0LUN0cmwtVlwiOiBcImdvUGFnZVVwXCIsIFwiQ3RybC1EXCI6IFwiZGVsQ2hhckFmdGVyXCIsIFwiQ3RybC1IXCI6IFwiZGVsQ2hhckJlZm9yZVwiLFxuICAgIFwiQWx0LURcIjogXCJkZWxXb3JkQWZ0ZXJcIiwgXCJBbHQtQmFja3NwYWNlXCI6IFwiZGVsV29yZEJlZm9yZVwiLCBcIkN0cmwtS1wiOiBcImtpbGxMaW5lXCIsIFwiQ3RybC1UXCI6IFwidHJhbnNwb3NlQ2hhcnNcIlxuICB9O1xuICBrZXlNYXAubWFjRGVmYXVsdCA9IHtcbiAgICBcIkNtZC1BXCI6IFwic2VsZWN0QWxsXCIsIFwiQ21kLURcIjogXCJkZWxldGVMaW5lXCIsIFwiQ21kLVpcIjogXCJ1bmRvXCIsIFwiU2hpZnQtQ21kLVpcIjogXCJyZWRvXCIsIFwiQ21kLVlcIjogXCJyZWRvXCIsXG4gICAgXCJDbWQtSG9tZVwiOiBcImdvRG9jU3RhcnRcIiwgXCJDbWQtVXBcIjogXCJnb0RvY1N0YXJ0XCIsIFwiQ21kLUVuZFwiOiBcImdvRG9jRW5kXCIsIFwiQ21kLURvd25cIjogXCJnb0RvY0VuZFwiLCBcIkFsdC1MZWZ0XCI6IFwiZ29Hcm91cExlZnRcIixcbiAgICBcIkFsdC1SaWdodFwiOiBcImdvR3JvdXBSaWdodFwiLCBcIkNtZC1MZWZ0XCI6IFwiZ29MaW5lTGVmdFwiLCBcIkNtZC1SaWdodFwiOiBcImdvTGluZVJpZ2h0XCIsIFwiQWx0LUJhY2tzcGFjZVwiOiBcImRlbEdyb3VwQmVmb3JlXCIsXG4gICAgXCJDdHJsLUFsdC1CYWNrc3BhY2VcIjogXCJkZWxHcm91cEFmdGVyXCIsIFwiQWx0LURlbGV0ZVwiOiBcImRlbEdyb3VwQWZ0ZXJcIiwgXCJDbWQtU1wiOiBcInNhdmVcIiwgXCJDbWQtRlwiOiBcImZpbmRcIixcbiAgICBcIkNtZC1HXCI6IFwiZmluZE5leHRcIiwgXCJTaGlmdC1DbWQtR1wiOiBcImZpbmRQcmV2XCIsIFwiQ21kLUFsdC1GXCI6IFwicmVwbGFjZVwiLCBcIlNoaWZ0LUNtZC1BbHQtRlwiOiBcInJlcGxhY2VBbGxcIixcbiAgICBcIkNtZC1bXCI6IFwiaW5kZW50TGVzc1wiLCBcIkNtZC1dXCI6IFwiaW5kZW50TW9yZVwiLCBcIkNtZC1CYWNrc3BhY2VcIjogXCJkZWxXcmFwcGVkTGluZUxlZnRcIiwgXCJDbWQtRGVsZXRlXCI6IFwiZGVsV3JhcHBlZExpbmVSaWdodFwiLFxuICAgIFwiQ21kLVVcIjogXCJ1bmRvU2VsZWN0aW9uXCIsIFwiU2hpZnQtQ21kLVVcIjogXCJyZWRvU2VsZWN0aW9uXCIsIFwiQ3RybC1VcFwiOiBcImdvRG9jU3RhcnRcIiwgXCJDdHJsLURvd25cIjogXCJnb0RvY0VuZFwiLFxuICAgIGZhbGx0aHJvdWdoOiBbXCJiYXNpY1wiLCBcImVtYWNzeVwiXVxuICB9O1xuICBrZXlNYXBbXCJkZWZhdWx0XCJdID0gbWFjID8ga2V5TWFwLm1hY0RlZmF1bHQgOiBrZXlNYXAucGNEZWZhdWx0O1xuXG4gIC8vIEtFWU1BUCBESVNQQVRDSFxuXG4gIGZ1bmN0aW9uIG5vcm1hbGl6ZUtleU5hbWUobmFtZSkge1xuICAgIHZhciBwYXJ0cyA9IG5hbWUuc3BsaXQoLy0oPyEkKS8pLCBuYW1lID0gcGFydHNbcGFydHMubGVuZ3RoIC0gMV07XG4gICAgdmFyIGFsdCwgY3RybCwgc2hpZnQsIGNtZDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhcnRzLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgdmFyIG1vZCA9IHBhcnRzW2ldO1xuICAgICAgaWYgKC9eKGNtZHxtZXRhfG0pJC9pLnRlc3QobW9kKSkgY21kID0gdHJ1ZTtcbiAgICAgIGVsc2UgaWYgKC9eYShsdCk/JC9pLnRlc3QobW9kKSkgYWx0ID0gdHJ1ZTtcbiAgICAgIGVsc2UgaWYgKC9eKGN8Y3RybHxjb250cm9sKSQvaS50ZXN0KG1vZCkpIGN0cmwgPSB0cnVlO1xuICAgICAgZWxzZSBpZiAoL15zKGhpZnQpJC9pLnRlc3QobW9kKSkgc2hpZnQgPSB0cnVlO1xuICAgICAgZWxzZSB0aHJvdyBuZXcgRXJyb3IoXCJVbnJlY29nbml6ZWQgbW9kaWZpZXIgbmFtZTogXCIgKyBtb2QpO1xuICAgIH1cbiAgICBpZiAoYWx0KSBuYW1lID0gXCJBbHQtXCIgKyBuYW1lO1xuICAgIGlmIChjdHJsKSBuYW1lID0gXCJDdHJsLVwiICsgbmFtZTtcbiAgICBpZiAoY21kKSBuYW1lID0gXCJDbWQtXCIgKyBuYW1lO1xuICAgIGlmIChzaGlmdCkgbmFtZSA9IFwiU2hpZnQtXCIgKyBuYW1lO1xuICAgIHJldHVybiBuYW1lO1xuICB9XG5cbiAgLy8gVGhpcyBpcyBhIGtsdWRnZSB0byBrZWVwIGtleW1hcHMgbW9zdGx5IHdvcmtpbmcgYXMgcmF3IG9iamVjdHNcbiAgLy8gKGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5KSB3aGlsZSBhdCB0aGUgc2FtZSB0aW1lIHN1cHBvcnQgZmVhdHVyZXNcbiAgLy8gbGlrZSBub3JtYWxpemF0aW9uIGFuZCBtdWx0aS1zdHJva2Uga2V5IGJpbmRpbmdzLiBJdCBjb21waWxlcyBhXG4gIC8vIG5ldyBub3JtYWxpemVkIGtleW1hcCwgYW5kIHRoZW4gdXBkYXRlcyB0aGUgb2xkIG9iamVjdCB0byByZWZsZWN0XG4gIC8vIHRoaXMuXG4gIENvZGVNaXJyb3Iubm9ybWFsaXplS2V5TWFwID0gZnVuY3Rpb24oa2V5bWFwKSB7XG4gICAgdmFyIGNvcHkgPSB7fTtcbiAgICBmb3IgKHZhciBrZXluYW1lIGluIGtleW1hcCkgaWYgKGtleW1hcC5oYXNPd25Qcm9wZXJ0eShrZXluYW1lKSkge1xuICAgICAgdmFyIHZhbHVlID0ga2V5bWFwW2tleW5hbWVdO1xuICAgICAgaWYgKC9eKG5hbWV8ZmFsbHRocm91Z2h8KGRlfGF0KXRhY2gpJC8udGVzdChrZXluYW1lKSkgY29udGludWU7XG4gICAgICBpZiAodmFsdWUgPT0gXCIuLi5cIikgeyBkZWxldGUga2V5bWFwW2tleW5hbWVdOyBjb250aW51ZTsgfVxuXG4gICAgICB2YXIga2V5cyA9IG1hcChrZXluYW1lLnNwbGl0KFwiIFwiKSwgbm9ybWFsaXplS2V5TmFtZSk7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIHZhbCwgbmFtZTtcbiAgICAgICAgaWYgKGkgPT0ga2V5cy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgbmFtZSA9IGtleXMuam9pbihcIiBcIik7XG4gICAgICAgICAgdmFsID0gdmFsdWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbmFtZSA9IGtleXMuc2xpY2UoMCwgaSArIDEpLmpvaW4oXCIgXCIpO1xuICAgICAgICAgIHZhbCA9IFwiLi4uXCI7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHByZXYgPSBjb3B5W25hbWVdO1xuICAgICAgICBpZiAoIXByZXYpIGNvcHlbbmFtZV0gPSB2YWw7XG4gICAgICAgIGVsc2UgaWYgKHByZXYgIT0gdmFsKSB0aHJvdyBuZXcgRXJyb3IoXCJJbmNvbnNpc3RlbnQgYmluZGluZ3MgZm9yIFwiICsgbmFtZSk7XG4gICAgICB9XG4gICAgICBkZWxldGUga2V5bWFwW2tleW5hbWVdO1xuICAgIH1cbiAgICBmb3IgKHZhciBwcm9wIGluIGNvcHkpIGtleW1hcFtwcm9wXSA9IGNvcHlbcHJvcF07XG4gICAgcmV0dXJuIGtleW1hcDtcbiAgfTtcblxuICB2YXIgbG9va3VwS2V5ID0gQ29kZU1pcnJvci5sb29rdXBLZXkgPSBmdW5jdGlvbihrZXksIG1hcCwgaGFuZGxlLCBjb250ZXh0KSB7XG4gICAgbWFwID0gZ2V0S2V5TWFwKG1hcCk7XG4gICAgdmFyIGZvdW5kID0gbWFwLmNhbGwgPyBtYXAuY2FsbChrZXksIGNvbnRleHQpIDogbWFwW2tleV07XG4gICAgaWYgKGZvdW5kID09PSBmYWxzZSkgcmV0dXJuIFwibm90aGluZ1wiO1xuICAgIGlmIChmb3VuZCA9PT0gXCIuLi5cIikgcmV0dXJuIFwibXVsdGlcIjtcbiAgICBpZiAoZm91bmQgIT0gbnVsbCAmJiBoYW5kbGUoZm91bmQpKSByZXR1cm4gXCJoYW5kbGVkXCI7XG5cbiAgICBpZiAobWFwLmZhbGx0aHJvdWdoKSB7XG4gICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKG1hcC5mYWxsdGhyb3VnaCkgIT0gXCJbb2JqZWN0IEFycmF5XVwiKVxuICAgICAgICByZXR1cm4gbG9va3VwS2V5KGtleSwgbWFwLmZhbGx0aHJvdWdoLCBoYW5kbGUsIGNvbnRleHQpO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXAuZmFsbHRocm91Z2gubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IGxvb2t1cEtleShrZXksIG1hcC5mYWxsdGhyb3VnaFtpXSwgaGFuZGxlLCBjb250ZXh0KTtcbiAgICAgICAgaWYgKHJlc3VsdCkgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgLy8gTW9kaWZpZXIga2V5IHByZXNzZXMgZG9uJ3QgY291bnQgYXMgJ3JlYWwnIGtleSBwcmVzc2VzIGZvciB0aGVcbiAgLy8gcHVycG9zZSBvZiBrZXltYXAgZmFsbHRocm91Z2guXG4gIHZhciBpc01vZGlmaWVyS2V5ID0gQ29kZU1pcnJvci5pc01vZGlmaWVyS2V5ID0gZnVuY3Rpb24odmFsdWUpIHtcbiAgICB2YXIgbmFtZSA9IHR5cGVvZiB2YWx1ZSA9PSBcInN0cmluZ1wiID8gdmFsdWUgOiBrZXlOYW1lc1t2YWx1ZS5rZXlDb2RlXTtcbiAgICByZXR1cm4gbmFtZSA9PSBcIkN0cmxcIiB8fCBuYW1lID09IFwiQWx0XCIgfHwgbmFtZSA9PSBcIlNoaWZ0XCIgfHwgbmFtZSA9PSBcIk1vZFwiO1xuICB9O1xuXG4gIC8vIExvb2sgdXAgdGhlIG5hbWUgb2YgYSBrZXkgYXMgaW5kaWNhdGVkIGJ5IGFuIGV2ZW50IG9iamVjdC5cbiAgdmFyIGtleU5hbWUgPSBDb2RlTWlycm9yLmtleU5hbWUgPSBmdW5jdGlvbihldmVudCwgbm9TaGlmdCkge1xuICAgIGlmIChwcmVzdG8gJiYgZXZlbnQua2V5Q29kZSA9PSAzNCAmJiBldmVudFtcImNoYXJcIl0pIHJldHVybiBmYWxzZTtcbiAgICB2YXIgYmFzZSA9IGtleU5hbWVzW2V2ZW50LmtleUNvZGVdLCBuYW1lID0gYmFzZTtcbiAgICBpZiAobmFtZSA9PSBudWxsIHx8IGV2ZW50LmFsdEdyYXBoS2V5KSByZXR1cm4gZmFsc2U7XG4gICAgaWYgKGV2ZW50LmFsdEtleSAmJiBiYXNlICE9IFwiQWx0XCIpIG5hbWUgPSBcIkFsdC1cIiArIG5hbWU7XG4gICAgaWYgKChmbGlwQ3RybENtZCA/IGV2ZW50Lm1ldGFLZXkgOiBldmVudC5jdHJsS2V5KSAmJiBiYXNlICE9IFwiQ3RybFwiKSBuYW1lID0gXCJDdHJsLVwiICsgbmFtZTtcbiAgICBpZiAoKGZsaXBDdHJsQ21kID8gZXZlbnQuY3RybEtleSA6IGV2ZW50Lm1ldGFLZXkpICYmIGJhc2UgIT0gXCJDbWRcIikgbmFtZSA9IFwiQ21kLVwiICsgbmFtZTtcbiAgICBpZiAoIW5vU2hpZnQgJiYgZXZlbnQuc2hpZnRLZXkgJiYgYmFzZSAhPSBcIlNoaWZ0XCIpIG5hbWUgPSBcIlNoaWZ0LVwiICsgbmFtZTtcbiAgICByZXR1cm4gbmFtZTtcbiAgfTtcblxuICBmdW5jdGlvbiBnZXRLZXlNYXAodmFsKSB7XG4gICAgcmV0dXJuIHR5cGVvZiB2YWwgPT0gXCJzdHJpbmdcIiA/IGtleU1hcFt2YWxdIDogdmFsO1xuICB9XG5cbiAgLy8gRlJPTVRFWFRBUkVBXG5cbiAgQ29kZU1pcnJvci5mcm9tVGV4dEFyZWEgPSBmdW5jdGlvbih0ZXh0YXJlYSwgb3B0aW9ucykge1xuICAgIG9wdGlvbnMgPSBvcHRpb25zID8gY29weU9iaihvcHRpb25zKSA6IHt9O1xuICAgIG9wdGlvbnMudmFsdWUgPSB0ZXh0YXJlYS52YWx1ZTtcbiAgICBpZiAoIW9wdGlvbnMudGFiaW5kZXggJiYgdGV4dGFyZWEudGFiSW5kZXgpXG4gICAgICBvcHRpb25zLnRhYmluZGV4ID0gdGV4dGFyZWEudGFiSW5kZXg7XG4gICAgaWYgKCFvcHRpb25zLnBsYWNlaG9sZGVyICYmIHRleHRhcmVhLnBsYWNlaG9sZGVyKVxuICAgICAgb3B0aW9ucy5wbGFjZWhvbGRlciA9IHRleHRhcmVhLnBsYWNlaG9sZGVyO1xuICAgIC8vIFNldCBhdXRvZm9jdXMgdG8gdHJ1ZSBpZiB0aGlzIHRleHRhcmVhIGlzIGZvY3VzZWQsIG9yIGlmIGl0IGhhc1xuICAgIC8vIGF1dG9mb2N1cyBhbmQgbm8gb3RoZXIgZWxlbWVudCBpcyBmb2N1c2VkLlxuICAgIGlmIChvcHRpb25zLmF1dG9mb2N1cyA9PSBudWxsKSB7XG4gICAgICB2YXIgaGFzRm9jdXMgPSBhY3RpdmVFbHQoKTtcbiAgICAgIG9wdGlvbnMuYXV0b2ZvY3VzID0gaGFzRm9jdXMgPT0gdGV4dGFyZWEgfHxcbiAgICAgICAgdGV4dGFyZWEuZ2V0QXR0cmlidXRlKFwiYXV0b2ZvY3VzXCIpICE9IG51bGwgJiYgaGFzRm9jdXMgPT0gZG9jdW1lbnQuYm9keTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzYXZlKCkge3RleHRhcmVhLnZhbHVlID0gY20uZ2V0VmFsdWUoKTt9XG4gICAgaWYgKHRleHRhcmVhLmZvcm0pIHtcbiAgICAgIG9uKHRleHRhcmVhLmZvcm0sIFwic3VibWl0XCIsIHNhdmUpO1xuICAgICAgLy8gRGVwbG9yYWJsZSBoYWNrIHRvIG1ha2UgdGhlIHN1Ym1pdCBtZXRob2QgZG8gdGhlIHJpZ2h0IHRoaW5nLlxuICAgICAgaWYgKCFvcHRpb25zLmxlYXZlU3VibWl0TWV0aG9kQWxvbmUpIHtcbiAgICAgICAgdmFyIGZvcm0gPSB0ZXh0YXJlYS5mb3JtLCByZWFsU3VibWl0ID0gZm9ybS5zdWJtaXQ7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdmFyIHdyYXBwZWRTdWJtaXQgPSBmb3JtLnN1Ym1pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgc2F2ZSgpO1xuICAgICAgICAgICAgZm9ybS5zdWJtaXQgPSByZWFsU3VibWl0O1xuICAgICAgICAgICAgZm9ybS5zdWJtaXQoKTtcbiAgICAgICAgICAgIGZvcm0uc3VibWl0ID0gd3JhcHBlZFN1Ym1pdDtcbiAgICAgICAgICB9O1xuICAgICAgICB9IGNhdGNoKGUpIHt9XG4gICAgICB9XG4gICAgfVxuXG4gICAgb3B0aW9ucy5maW5pc2hJbml0ID0gZnVuY3Rpb24oY20pIHtcbiAgICAgIGNtLnNhdmUgPSBzYXZlO1xuICAgICAgY20uZ2V0VGV4dEFyZWEgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRleHRhcmVhOyB9O1xuICAgICAgY20udG9UZXh0QXJlYSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBjbS50b1RleHRBcmVhID0gaXNOYU47IC8vIFByZXZlbnQgdGhpcyBmcm9tIGJlaW5nIHJhbiB0d2ljZVxuICAgICAgICBzYXZlKCk7XG4gICAgICAgIHRleHRhcmVhLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoY20uZ2V0V3JhcHBlckVsZW1lbnQoKSk7XG4gICAgICAgIHRleHRhcmVhLnN0eWxlLmRpc3BsYXkgPSBcIlwiO1xuICAgICAgICBpZiAodGV4dGFyZWEuZm9ybSkge1xuICAgICAgICAgIG9mZih0ZXh0YXJlYS5mb3JtLCBcInN1Ym1pdFwiLCBzYXZlKTtcbiAgICAgICAgICBpZiAodHlwZW9mIHRleHRhcmVhLmZvcm0uc3VibWl0ID09IFwiZnVuY3Rpb25cIilcbiAgICAgICAgICAgIHRleHRhcmVhLmZvcm0uc3VibWl0ID0gcmVhbFN1Ym1pdDtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9O1xuXG4gICAgdGV4dGFyZWEuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIHZhciBjbSA9IENvZGVNaXJyb3IoZnVuY3Rpb24obm9kZSkge1xuICAgICAgdGV4dGFyZWEucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobm9kZSwgdGV4dGFyZWEubmV4dFNpYmxpbmcpO1xuICAgIH0sIG9wdGlvbnMpO1xuICAgIHJldHVybiBjbTtcbiAgfTtcblxuICAvLyBTVFJJTkcgU1RSRUFNXG5cbiAgLy8gRmVkIHRvIHRoZSBtb2RlIHBhcnNlcnMsIHByb3ZpZGVzIGhlbHBlciBmdW5jdGlvbnMgdG8gbWFrZVxuICAvLyBwYXJzZXJzIG1vcmUgc3VjY2luY3QuXG5cbiAgdmFyIFN0cmluZ1N0cmVhbSA9IENvZGVNaXJyb3IuU3RyaW5nU3RyZWFtID0gZnVuY3Rpb24oc3RyaW5nLCB0YWJTaXplKSB7XG4gICAgdGhpcy5wb3MgPSB0aGlzLnN0YXJ0ID0gMDtcbiAgICB0aGlzLnN0cmluZyA9IHN0cmluZztcbiAgICB0aGlzLnRhYlNpemUgPSB0YWJTaXplIHx8IDg7XG4gICAgdGhpcy5sYXN0Q29sdW1uUG9zID0gdGhpcy5sYXN0Q29sdW1uVmFsdWUgPSAwO1xuICAgIHRoaXMubGluZVN0YXJ0ID0gMDtcbiAgfTtcblxuICBTdHJpbmdTdHJlYW0ucHJvdG90eXBlID0ge1xuICAgIGVvbDogZnVuY3Rpb24oKSB7cmV0dXJuIHRoaXMucG9zID49IHRoaXMuc3RyaW5nLmxlbmd0aDt9LFxuICAgIHNvbDogZnVuY3Rpb24oKSB7cmV0dXJuIHRoaXMucG9zID09IHRoaXMubGluZVN0YXJ0O30sXG4gICAgcGVlazogZnVuY3Rpb24oKSB7cmV0dXJuIHRoaXMuc3RyaW5nLmNoYXJBdCh0aGlzLnBvcykgfHwgdW5kZWZpbmVkO30sXG4gICAgbmV4dDogZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodGhpcy5wb3MgPCB0aGlzLnN0cmluZy5sZW5ndGgpXG4gICAgICAgIHJldHVybiB0aGlzLnN0cmluZy5jaGFyQXQodGhpcy5wb3MrKyk7XG4gICAgfSxcbiAgICBlYXQ6IGZ1bmN0aW9uKG1hdGNoKSB7XG4gICAgICB2YXIgY2ggPSB0aGlzLnN0cmluZy5jaGFyQXQodGhpcy5wb3MpO1xuICAgICAgaWYgKHR5cGVvZiBtYXRjaCA9PSBcInN0cmluZ1wiKSB2YXIgb2sgPSBjaCA9PSBtYXRjaDtcbiAgICAgIGVsc2UgdmFyIG9rID0gY2ggJiYgKG1hdGNoLnRlc3QgPyBtYXRjaC50ZXN0KGNoKSA6IG1hdGNoKGNoKSk7XG4gICAgICBpZiAob2spIHsrK3RoaXMucG9zOyByZXR1cm4gY2g7fVxuICAgIH0sXG4gICAgZWF0V2hpbGU6IGZ1bmN0aW9uKG1hdGNoKSB7XG4gICAgICB2YXIgc3RhcnQgPSB0aGlzLnBvcztcbiAgICAgIHdoaWxlICh0aGlzLmVhdChtYXRjaCkpe31cbiAgICAgIHJldHVybiB0aGlzLnBvcyA+IHN0YXJ0O1xuICAgIH0sXG4gICAgZWF0U3BhY2U6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5wb3M7XG4gICAgICB3aGlsZSAoL1tcXHNcXHUwMGEwXS8udGVzdCh0aGlzLnN0cmluZy5jaGFyQXQodGhpcy5wb3MpKSkgKyt0aGlzLnBvcztcbiAgICAgIHJldHVybiB0aGlzLnBvcyA+IHN0YXJ0O1xuICAgIH0sXG4gICAgc2tpcFRvRW5kOiBmdW5jdGlvbigpIHt0aGlzLnBvcyA9IHRoaXMuc3RyaW5nLmxlbmd0aDt9LFxuICAgIHNraXBUbzogZnVuY3Rpb24oY2gpIHtcbiAgICAgIHZhciBmb3VuZCA9IHRoaXMuc3RyaW5nLmluZGV4T2YoY2gsIHRoaXMucG9zKTtcbiAgICAgIGlmIChmb3VuZCA+IC0xKSB7dGhpcy5wb3MgPSBmb3VuZDsgcmV0dXJuIHRydWU7fVxuICAgIH0sXG4gICAgYmFja1VwOiBmdW5jdGlvbihuKSB7dGhpcy5wb3MgLT0gbjt9LFxuICAgIGNvbHVtbjogZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodGhpcy5sYXN0Q29sdW1uUG9zIDwgdGhpcy5zdGFydCkge1xuICAgICAgICB0aGlzLmxhc3RDb2x1bW5WYWx1ZSA9IGNvdW50Q29sdW1uKHRoaXMuc3RyaW5nLCB0aGlzLnN0YXJ0LCB0aGlzLnRhYlNpemUsIHRoaXMubGFzdENvbHVtblBvcywgdGhpcy5sYXN0Q29sdW1uVmFsdWUpO1xuICAgICAgICB0aGlzLmxhc3RDb2x1bW5Qb3MgPSB0aGlzLnN0YXJ0O1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMubGFzdENvbHVtblZhbHVlIC0gKHRoaXMubGluZVN0YXJ0ID8gY291bnRDb2x1bW4odGhpcy5zdHJpbmcsIHRoaXMubGluZVN0YXJ0LCB0aGlzLnRhYlNpemUpIDogMCk7XG4gICAgfSxcbiAgICBpbmRlbnRhdGlvbjogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gY291bnRDb2x1bW4odGhpcy5zdHJpbmcsIG51bGwsIHRoaXMudGFiU2l6ZSkgLVxuICAgICAgICAodGhpcy5saW5lU3RhcnQgPyBjb3VudENvbHVtbih0aGlzLnN0cmluZywgdGhpcy5saW5lU3RhcnQsIHRoaXMudGFiU2l6ZSkgOiAwKTtcbiAgICB9LFxuICAgIG1hdGNoOiBmdW5jdGlvbihwYXR0ZXJuLCBjb25zdW1lLCBjYXNlSW5zZW5zaXRpdmUpIHtcbiAgICAgIGlmICh0eXBlb2YgcGF0dGVybiA9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHZhciBjYXNlZCA9IGZ1bmN0aW9uKHN0cikge3JldHVybiBjYXNlSW5zZW5zaXRpdmUgPyBzdHIudG9Mb3dlckNhc2UoKSA6IHN0cjt9O1xuICAgICAgICB2YXIgc3Vic3RyID0gdGhpcy5zdHJpbmcuc3Vic3RyKHRoaXMucG9zLCBwYXR0ZXJuLmxlbmd0aCk7XG4gICAgICAgIGlmIChjYXNlZChzdWJzdHIpID09IGNhc2VkKHBhdHRlcm4pKSB7XG4gICAgICAgICAgaWYgKGNvbnN1bWUgIT09IGZhbHNlKSB0aGlzLnBvcyArPSBwYXR0ZXJuLmxlbmd0aDtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIG1hdGNoID0gdGhpcy5zdHJpbmcuc2xpY2UodGhpcy5wb3MpLm1hdGNoKHBhdHRlcm4pO1xuICAgICAgICBpZiAobWF0Y2ggJiYgbWF0Y2guaW5kZXggPiAwKSByZXR1cm4gbnVsbDtcbiAgICAgICAgaWYgKG1hdGNoICYmIGNvbnN1bWUgIT09IGZhbHNlKSB0aGlzLnBvcyArPSBtYXRjaFswXS5sZW5ndGg7XG4gICAgICAgIHJldHVybiBtYXRjaDtcbiAgICAgIH1cbiAgICB9LFxuICAgIGN1cnJlbnQ6IGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc3RyaW5nLnNsaWNlKHRoaXMuc3RhcnQsIHRoaXMucG9zKTt9LFxuICAgIGhpZGVGaXJzdENoYXJzOiBmdW5jdGlvbihuLCBpbm5lcikge1xuICAgICAgdGhpcy5saW5lU3RhcnQgKz0gbjtcbiAgICAgIHRyeSB7IHJldHVybiBpbm5lcigpOyB9XG4gICAgICBmaW5hbGx5IHsgdGhpcy5saW5lU3RhcnQgLT0gbjsgfVxuICAgIH1cbiAgfTtcblxuICAvLyBURVhUTUFSS0VSU1xuXG4gIC8vIENyZWF0ZWQgd2l0aCBtYXJrVGV4dCBhbmQgc2V0Qm9va21hcmsgbWV0aG9kcy4gQSBUZXh0TWFya2VyIGlzIGFcbiAgLy8gaGFuZGxlIHRoYXQgY2FuIGJlIHVzZWQgdG8gY2xlYXIgb3IgZmluZCBhIG1hcmtlZCBwb3NpdGlvbiBpbiB0aGVcbiAgLy8gZG9jdW1lbnQuIExpbmUgb2JqZWN0cyBob2xkIGFycmF5cyAobWFya2VkU3BhbnMpIGNvbnRhaW5pbmdcbiAgLy8ge2Zyb20sIHRvLCBtYXJrZXJ9IG9iamVjdCBwb2ludGluZyB0byBzdWNoIG1hcmtlciBvYmplY3RzLCBhbmRcbiAgLy8gaW5kaWNhdGluZyB0aGF0IHN1Y2ggYSBtYXJrZXIgaXMgcHJlc2VudCBvbiB0aGF0IGxpbmUuIE11bHRpcGxlXG4gIC8vIGxpbmVzIG1heSBwb2ludCB0byB0aGUgc2FtZSBtYXJrZXIgd2hlbiBpdCBzcGFucyBhY3Jvc3MgbGluZXMuXG4gIC8vIFRoZSBzcGFucyB3aWxsIGhhdmUgbnVsbCBmb3IgdGhlaXIgZnJvbS90byBwcm9wZXJ0aWVzIHdoZW4gdGhlXG4gIC8vIG1hcmtlciBjb250aW51ZXMgYmV5b25kIHRoZSBzdGFydC9lbmQgb2YgdGhlIGxpbmUuIE1hcmtlcnMgaGF2ZVxuICAvLyBsaW5rcyBiYWNrIHRvIHRoZSBsaW5lcyB0aGV5IGN1cnJlbnRseSB0b3VjaC5cblxuICB2YXIgbmV4dE1hcmtlcklkID0gMDtcblxuICB2YXIgVGV4dE1hcmtlciA9IENvZGVNaXJyb3IuVGV4dE1hcmtlciA9IGZ1bmN0aW9uKGRvYywgdHlwZSkge1xuICAgIHRoaXMubGluZXMgPSBbXTtcbiAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgIHRoaXMuZG9jID0gZG9jO1xuICAgIHRoaXMuaWQgPSArK25leHRNYXJrZXJJZDtcbiAgfTtcbiAgZXZlbnRNaXhpbihUZXh0TWFya2VyKTtcblxuICAvLyBDbGVhciB0aGUgbWFya2VyLlxuICBUZXh0TWFya2VyLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLmV4cGxpY2l0bHlDbGVhcmVkKSByZXR1cm47XG4gICAgdmFyIGNtID0gdGhpcy5kb2MuY20sIHdpdGhPcCA9IGNtICYmICFjbS5jdXJPcDtcbiAgICBpZiAod2l0aE9wKSBzdGFydE9wZXJhdGlvbihjbSk7XG4gICAgaWYgKGhhc0hhbmRsZXIodGhpcywgXCJjbGVhclwiKSkge1xuICAgICAgdmFyIGZvdW5kID0gdGhpcy5maW5kKCk7XG4gICAgICBpZiAoZm91bmQpIHNpZ25hbExhdGVyKHRoaXMsIFwiY2xlYXJcIiwgZm91bmQuZnJvbSwgZm91bmQudG8pO1xuICAgIH1cbiAgICB2YXIgbWluID0gbnVsbCwgbWF4ID0gbnVsbDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGluZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBsaW5lID0gdGhpcy5saW5lc1tpXTtcbiAgICAgIHZhciBzcGFuID0gZ2V0TWFya2VkU3BhbkZvcihsaW5lLm1hcmtlZFNwYW5zLCB0aGlzKTtcbiAgICAgIGlmIChjbSAmJiAhdGhpcy5jb2xsYXBzZWQpIHJlZ0xpbmVDaGFuZ2UoY20sIGxpbmVObyhsaW5lKSwgXCJ0ZXh0XCIpO1xuICAgICAgZWxzZSBpZiAoY20pIHtcbiAgICAgICAgaWYgKHNwYW4udG8gIT0gbnVsbCkgbWF4ID0gbGluZU5vKGxpbmUpO1xuICAgICAgICBpZiAoc3Bhbi5mcm9tICE9IG51bGwpIG1pbiA9IGxpbmVObyhsaW5lKTtcbiAgICAgIH1cbiAgICAgIGxpbmUubWFya2VkU3BhbnMgPSByZW1vdmVNYXJrZWRTcGFuKGxpbmUubWFya2VkU3BhbnMsIHNwYW4pO1xuICAgICAgaWYgKHNwYW4uZnJvbSA9PSBudWxsICYmIHRoaXMuY29sbGFwc2VkICYmICFsaW5lSXNIaWRkZW4odGhpcy5kb2MsIGxpbmUpICYmIGNtKVxuICAgICAgICB1cGRhdGVMaW5lSGVpZ2h0KGxpbmUsIHRleHRIZWlnaHQoY20uZGlzcGxheSkpO1xuICAgIH1cbiAgICBpZiAoY20gJiYgdGhpcy5jb2xsYXBzZWQgJiYgIWNtLm9wdGlvbnMubGluZVdyYXBwaW5nKSBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGluZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciB2aXN1YWwgPSB2aXN1YWxMaW5lKHRoaXMubGluZXNbaV0pLCBsZW4gPSBsaW5lTGVuZ3RoKHZpc3VhbCk7XG4gICAgICBpZiAobGVuID4gY20uZGlzcGxheS5tYXhMaW5lTGVuZ3RoKSB7XG4gICAgICAgIGNtLmRpc3BsYXkubWF4TGluZSA9IHZpc3VhbDtcbiAgICAgICAgY20uZGlzcGxheS5tYXhMaW5lTGVuZ3RoID0gbGVuO1xuICAgICAgICBjbS5kaXNwbGF5Lm1heExpbmVDaGFuZ2VkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAobWluICE9IG51bGwgJiYgY20gJiYgdGhpcy5jb2xsYXBzZWQpIHJlZ0NoYW5nZShjbSwgbWluLCBtYXggKyAxKTtcbiAgICB0aGlzLmxpbmVzLmxlbmd0aCA9IDA7XG4gICAgdGhpcy5leHBsaWNpdGx5Q2xlYXJlZCA9IHRydWU7XG4gICAgaWYgKHRoaXMuYXRvbWljICYmIHRoaXMuZG9jLmNhbnRFZGl0KSB7XG4gICAgICB0aGlzLmRvYy5jYW50RWRpdCA9IGZhbHNlO1xuICAgICAgaWYgKGNtKSByZUNoZWNrU2VsZWN0aW9uKGNtLmRvYyk7XG4gICAgfVxuICAgIGlmIChjbSkgc2lnbmFsTGF0ZXIoY20sIFwibWFya2VyQ2xlYXJlZFwiLCBjbSwgdGhpcyk7XG4gICAgaWYgKHdpdGhPcCkgZW5kT3BlcmF0aW9uKGNtKTtcbiAgICBpZiAodGhpcy5wYXJlbnQpIHRoaXMucGFyZW50LmNsZWFyKCk7XG4gIH07XG5cbiAgLy8gRmluZCB0aGUgcG9zaXRpb24gb2YgdGhlIG1hcmtlciBpbiB0aGUgZG9jdW1lbnQuIFJldHVybnMgYSB7ZnJvbSxcbiAgLy8gdG99IG9iamVjdCBieSBkZWZhdWx0LiBTaWRlIGNhbiBiZSBwYXNzZWQgdG8gZ2V0IGEgc3BlY2lmaWMgc2lkZVxuICAvLyAtLSAwIChib3RoKSwgLTEgKGxlZnQpLCBvciAxIChyaWdodCkuIFdoZW4gbGluZU9iaiBpcyB0cnVlLCB0aGVcbiAgLy8gUG9zIG9iamVjdHMgcmV0dXJuZWQgY29udGFpbiBhIGxpbmUgb2JqZWN0LCByYXRoZXIgdGhhbiBhIGxpbmVcbiAgLy8gbnVtYmVyICh1c2VkIHRvIHByZXZlbnQgbG9va2luZyB1cCB0aGUgc2FtZSBsaW5lIHR3aWNlKS5cbiAgVGV4dE1hcmtlci5wcm90b3R5cGUuZmluZCA9IGZ1bmN0aW9uKHNpZGUsIGxpbmVPYmopIHtcbiAgICBpZiAoc2lkZSA9PSBudWxsICYmIHRoaXMudHlwZSA9PSBcImJvb2ttYXJrXCIpIHNpZGUgPSAxO1xuICAgIHZhciBmcm9tLCB0bztcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGluZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBsaW5lID0gdGhpcy5saW5lc1tpXTtcbiAgICAgIHZhciBzcGFuID0gZ2V0TWFya2VkU3BhbkZvcihsaW5lLm1hcmtlZFNwYW5zLCB0aGlzKTtcbiAgICAgIGlmIChzcGFuLmZyb20gIT0gbnVsbCkge1xuICAgICAgICBmcm9tID0gUG9zKGxpbmVPYmogPyBsaW5lIDogbGluZU5vKGxpbmUpLCBzcGFuLmZyb20pO1xuICAgICAgICBpZiAoc2lkZSA9PSAtMSkgcmV0dXJuIGZyb207XG4gICAgICB9XG4gICAgICBpZiAoc3Bhbi50byAhPSBudWxsKSB7XG4gICAgICAgIHRvID0gUG9zKGxpbmVPYmogPyBsaW5lIDogbGluZU5vKGxpbmUpLCBzcGFuLnRvKTtcbiAgICAgICAgaWYgKHNpZGUgPT0gMSkgcmV0dXJuIHRvO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZnJvbSAmJiB7ZnJvbTogZnJvbSwgdG86IHRvfTtcbiAgfTtcblxuICAvLyBTaWduYWxzIHRoYXQgdGhlIG1hcmtlcidzIHdpZGdldCBjaGFuZ2VkLCBhbmQgc3Vycm91bmRpbmcgbGF5b3V0XG4gIC8vIHNob3VsZCBiZSByZWNvbXB1dGVkLlxuICBUZXh0TWFya2VyLnByb3RvdHlwZS5jaGFuZ2VkID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHBvcyA9IHRoaXMuZmluZCgtMSwgdHJ1ZSksIHdpZGdldCA9IHRoaXMsIGNtID0gdGhpcy5kb2MuY207XG4gICAgaWYgKCFwb3MgfHwgIWNtKSByZXR1cm47XG4gICAgcnVuSW5PcChjbSwgZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgbGluZSA9IHBvcy5saW5lLCBsaW5lTiA9IGxpbmVObyhwb3MubGluZSk7XG4gICAgICB2YXIgdmlldyA9IGZpbmRWaWV3Rm9yTGluZShjbSwgbGluZU4pO1xuICAgICAgaWYgKHZpZXcpIHtcbiAgICAgICAgY2xlYXJMaW5lTWVhc3VyZW1lbnRDYWNoZUZvcih2aWV3KTtcbiAgICAgICAgY20uY3VyT3Auc2VsZWN0aW9uQ2hhbmdlZCA9IGNtLmN1ck9wLmZvcmNlVXBkYXRlID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGNtLmN1ck9wLnVwZGF0ZU1heExpbmUgPSB0cnVlO1xuICAgICAgaWYgKCFsaW5lSXNIaWRkZW4od2lkZ2V0LmRvYywgbGluZSkgJiYgd2lkZ2V0LmhlaWdodCAhPSBudWxsKSB7XG4gICAgICAgIHZhciBvbGRIZWlnaHQgPSB3aWRnZXQuaGVpZ2h0O1xuICAgICAgICB3aWRnZXQuaGVpZ2h0ID0gbnVsbDtcbiAgICAgICAgdmFyIGRIZWlnaHQgPSB3aWRnZXRIZWlnaHQod2lkZ2V0KSAtIG9sZEhlaWdodDtcbiAgICAgICAgaWYgKGRIZWlnaHQpXG4gICAgICAgICAgdXBkYXRlTGluZUhlaWdodChsaW5lLCBsaW5lLmhlaWdodCArIGRIZWlnaHQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIFRleHRNYXJrZXIucHJvdG90eXBlLmF0dGFjaExpbmUgPSBmdW5jdGlvbihsaW5lKSB7XG4gICAgaWYgKCF0aGlzLmxpbmVzLmxlbmd0aCAmJiB0aGlzLmRvYy5jbSkge1xuICAgICAgdmFyIG9wID0gdGhpcy5kb2MuY20uY3VyT3A7XG4gICAgICBpZiAoIW9wLm1heWJlSGlkZGVuTWFya2VycyB8fCBpbmRleE9mKG9wLm1heWJlSGlkZGVuTWFya2VycywgdGhpcykgPT0gLTEpXG4gICAgICAgIChvcC5tYXliZVVuaGlkZGVuTWFya2VycyB8fCAob3AubWF5YmVVbmhpZGRlbk1hcmtlcnMgPSBbXSkpLnB1c2godGhpcyk7XG4gICAgfVxuICAgIHRoaXMubGluZXMucHVzaChsaW5lKTtcbiAgfTtcbiAgVGV4dE1hcmtlci5wcm90b3R5cGUuZGV0YWNoTGluZSA9IGZ1bmN0aW9uKGxpbmUpIHtcbiAgICB0aGlzLmxpbmVzLnNwbGljZShpbmRleE9mKHRoaXMubGluZXMsIGxpbmUpLCAxKTtcbiAgICBpZiAoIXRoaXMubGluZXMubGVuZ3RoICYmIHRoaXMuZG9jLmNtKSB7XG4gICAgICB2YXIgb3AgPSB0aGlzLmRvYy5jbS5jdXJPcDtcbiAgICAgIChvcC5tYXliZUhpZGRlbk1hcmtlcnMgfHwgKG9wLm1heWJlSGlkZGVuTWFya2VycyA9IFtdKSkucHVzaCh0aGlzKTtcbiAgICB9XG4gIH07XG5cbiAgLy8gQ29sbGFwc2VkIG1hcmtlcnMgaGF2ZSB1bmlxdWUgaWRzLCBpbiBvcmRlciB0byBiZSBhYmxlIHRvIG9yZGVyXG4gIC8vIHRoZW0sIHdoaWNoIGlzIG5lZWRlZCBmb3IgdW5pcXVlbHkgZGV0ZXJtaW5pbmcgYW4gb3V0ZXIgbWFya2VyXG4gIC8vIHdoZW4gdGhleSBvdmVybGFwICh0aGV5IG1heSBuZXN0LCBidXQgbm90IHBhcnRpYWxseSBvdmVybGFwKS5cbiAgdmFyIG5leHRNYXJrZXJJZCA9IDA7XG5cbiAgLy8gQ3JlYXRlIGEgbWFya2VyLCB3aXJlIGl0IHVwIHRvIHRoZSByaWdodCBsaW5lcywgYW5kXG4gIGZ1bmN0aW9uIG1hcmtUZXh0KGRvYywgZnJvbSwgdG8sIG9wdGlvbnMsIHR5cGUpIHtcbiAgICAvLyBTaGFyZWQgbWFya2VycyAoYWNyb3NzIGxpbmtlZCBkb2N1bWVudHMpIGFyZSBoYW5kbGVkIHNlcGFyYXRlbHlcbiAgICAvLyAobWFya1RleHRTaGFyZWQgd2lsbCBjYWxsIG91dCB0byB0aGlzIGFnYWluLCBvbmNlIHBlclxuICAgIC8vIGRvY3VtZW50KS5cbiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnNoYXJlZCkgcmV0dXJuIG1hcmtUZXh0U2hhcmVkKGRvYywgZnJvbSwgdG8sIG9wdGlvbnMsIHR5cGUpO1xuICAgIC8vIEVuc3VyZSB3ZSBhcmUgaW4gYW4gb3BlcmF0aW9uLlxuICAgIGlmIChkb2MuY20gJiYgIWRvYy5jbS5jdXJPcCkgcmV0dXJuIG9wZXJhdGlvbihkb2MuY20sIG1hcmtUZXh0KShkb2MsIGZyb20sIHRvLCBvcHRpb25zLCB0eXBlKTtcblxuICAgIHZhciBtYXJrZXIgPSBuZXcgVGV4dE1hcmtlcihkb2MsIHR5cGUpLCBkaWZmID0gY21wKGZyb20sIHRvKTtcbiAgICBpZiAob3B0aW9ucykgY29weU9iaihvcHRpb25zLCBtYXJrZXIsIGZhbHNlKTtcbiAgICAvLyBEb24ndCBjb25uZWN0IGVtcHR5IG1hcmtlcnMgdW5sZXNzIGNsZWFyV2hlbkVtcHR5IGlzIGZhbHNlXG4gICAgaWYgKGRpZmYgPiAwIHx8IGRpZmYgPT0gMCAmJiBtYXJrZXIuY2xlYXJXaGVuRW1wdHkgIT09IGZhbHNlKVxuICAgICAgcmV0dXJuIG1hcmtlcjtcbiAgICBpZiAobWFya2VyLnJlcGxhY2VkV2l0aCkge1xuICAgICAgLy8gU2hvd2luZyB1cCBhcyBhIHdpZGdldCBpbXBsaWVzIGNvbGxhcHNlZCAod2lkZ2V0IHJlcGxhY2VzIHRleHQpXG4gICAgICBtYXJrZXIuY29sbGFwc2VkID0gdHJ1ZTtcbiAgICAgIG1hcmtlci53aWRnZXROb2RlID0gZWx0KFwic3BhblwiLCBbbWFya2VyLnJlcGxhY2VkV2l0aF0sIFwiQ29kZU1pcnJvci13aWRnZXRcIik7XG4gICAgICBpZiAoIW9wdGlvbnMuaGFuZGxlTW91c2VFdmVudHMpIG1hcmtlci53aWRnZXROb2RlLnNldEF0dHJpYnV0ZShcImNtLWlnbm9yZS1ldmVudHNcIiwgXCJ0cnVlXCIpO1xuICAgICAgaWYgKG9wdGlvbnMuaW5zZXJ0TGVmdCkgbWFya2VyLndpZGdldE5vZGUuaW5zZXJ0TGVmdCA9IHRydWU7XG4gICAgfVxuICAgIGlmIChtYXJrZXIuY29sbGFwc2VkKSB7XG4gICAgICBpZiAoY29uZmxpY3RpbmdDb2xsYXBzZWRSYW5nZShkb2MsIGZyb20ubGluZSwgZnJvbSwgdG8sIG1hcmtlcikgfHxcbiAgICAgICAgICBmcm9tLmxpbmUgIT0gdG8ubGluZSAmJiBjb25mbGljdGluZ0NvbGxhcHNlZFJhbmdlKGRvYywgdG8ubGluZSwgZnJvbSwgdG8sIG1hcmtlcikpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkluc2VydGluZyBjb2xsYXBzZWQgbWFya2VyIHBhcnRpYWxseSBvdmVybGFwcGluZyBhbiBleGlzdGluZyBvbmVcIik7XG4gICAgICBzYXdDb2xsYXBzZWRTcGFucyA9IHRydWU7XG4gICAgfVxuXG4gICAgaWYgKG1hcmtlci5hZGRUb0hpc3RvcnkpXG4gICAgICBhZGRDaGFuZ2VUb0hpc3RvcnkoZG9jLCB7ZnJvbTogZnJvbSwgdG86IHRvLCBvcmlnaW46IFwibWFya1RleHRcIn0sIGRvYy5zZWwsIE5hTik7XG5cbiAgICB2YXIgY3VyTGluZSA9IGZyb20ubGluZSwgY20gPSBkb2MuY20sIHVwZGF0ZU1heExpbmU7XG4gICAgZG9jLml0ZXIoY3VyTGluZSwgdG8ubGluZSArIDEsIGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgIGlmIChjbSAmJiBtYXJrZXIuY29sbGFwc2VkICYmICFjbS5vcHRpb25zLmxpbmVXcmFwcGluZyAmJiB2aXN1YWxMaW5lKGxpbmUpID09IGNtLmRpc3BsYXkubWF4TGluZSlcbiAgICAgICAgdXBkYXRlTWF4TGluZSA9IHRydWU7XG4gICAgICBpZiAobWFya2VyLmNvbGxhcHNlZCAmJiBjdXJMaW5lICE9IGZyb20ubGluZSkgdXBkYXRlTGluZUhlaWdodChsaW5lLCAwKTtcbiAgICAgIGFkZE1hcmtlZFNwYW4obGluZSwgbmV3IE1hcmtlZFNwYW4obWFya2VyLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJMaW5lID09IGZyb20ubGluZSA/IGZyb20uY2ggOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJMaW5lID09IHRvLmxpbmUgPyB0by5jaCA6IG51bGwpKTtcbiAgICAgICsrY3VyTGluZTtcbiAgICB9KTtcbiAgICAvLyBsaW5lSXNIaWRkZW4gZGVwZW5kcyBvbiB0aGUgcHJlc2VuY2Ugb2YgdGhlIHNwYW5zLCBzbyBuZWVkcyBhIHNlY29uZCBwYXNzXG4gICAgaWYgKG1hcmtlci5jb2xsYXBzZWQpIGRvYy5pdGVyKGZyb20ubGluZSwgdG8ubGluZSArIDEsIGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgIGlmIChsaW5lSXNIaWRkZW4oZG9jLCBsaW5lKSkgdXBkYXRlTGluZUhlaWdodChsaW5lLCAwKTtcbiAgICB9KTtcblxuICAgIGlmIChtYXJrZXIuY2xlYXJPbkVudGVyKSBvbihtYXJrZXIsIFwiYmVmb3JlQ3Vyc29yRW50ZXJcIiwgZnVuY3Rpb24oKSB7IG1hcmtlci5jbGVhcigpOyB9KTtcblxuICAgIGlmIChtYXJrZXIucmVhZE9ubHkpIHtcbiAgICAgIHNhd1JlYWRPbmx5U3BhbnMgPSB0cnVlO1xuICAgICAgaWYgKGRvYy5oaXN0b3J5LmRvbmUubGVuZ3RoIHx8IGRvYy5oaXN0b3J5LnVuZG9uZS5sZW5ndGgpXG4gICAgICAgIGRvYy5jbGVhckhpc3RvcnkoKTtcbiAgICB9XG4gICAgaWYgKG1hcmtlci5jb2xsYXBzZWQpIHtcbiAgICAgIG1hcmtlci5pZCA9ICsrbmV4dE1hcmtlcklkO1xuICAgICAgbWFya2VyLmF0b21pYyA9IHRydWU7XG4gICAgfVxuICAgIGlmIChjbSkge1xuICAgICAgLy8gU3luYyBlZGl0b3Igc3RhdGVcbiAgICAgIGlmICh1cGRhdGVNYXhMaW5lKSBjbS5jdXJPcC51cGRhdGVNYXhMaW5lID0gdHJ1ZTtcbiAgICAgIGlmIChtYXJrZXIuY29sbGFwc2VkKVxuICAgICAgICByZWdDaGFuZ2UoY20sIGZyb20ubGluZSwgdG8ubGluZSArIDEpO1xuICAgICAgZWxzZSBpZiAobWFya2VyLmNsYXNzTmFtZSB8fCBtYXJrZXIudGl0bGUgfHwgbWFya2VyLnN0YXJ0U3R5bGUgfHwgbWFya2VyLmVuZFN0eWxlIHx8IG1hcmtlci5jc3MpXG4gICAgICAgIGZvciAodmFyIGkgPSBmcm9tLmxpbmU7IGkgPD0gdG8ubGluZTsgaSsrKSByZWdMaW5lQ2hhbmdlKGNtLCBpLCBcInRleHRcIik7XG4gICAgICBpZiAobWFya2VyLmF0b21pYykgcmVDaGVja1NlbGVjdGlvbihjbS5kb2MpO1xuICAgICAgc2lnbmFsTGF0ZXIoY20sIFwibWFya2VyQWRkZWRcIiwgY20sIG1hcmtlcik7XG4gICAgfVxuICAgIHJldHVybiBtYXJrZXI7XG4gIH1cblxuICAvLyBTSEFSRUQgVEVYVE1BUktFUlNcblxuICAvLyBBIHNoYXJlZCBtYXJrZXIgc3BhbnMgbXVsdGlwbGUgbGlua2VkIGRvY3VtZW50cy4gSXQgaXNcbiAgLy8gaW1wbGVtZW50ZWQgYXMgYSBtZXRhLW1hcmtlci1vYmplY3QgY29udHJvbGxpbmcgbXVsdGlwbGUgbm9ybWFsXG4gIC8vIG1hcmtlcnMuXG4gIHZhciBTaGFyZWRUZXh0TWFya2VyID0gQ29kZU1pcnJvci5TaGFyZWRUZXh0TWFya2VyID0gZnVuY3Rpb24obWFya2VycywgcHJpbWFyeSkge1xuICAgIHRoaXMubWFya2VycyA9IG1hcmtlcnM7XG4gICAgdGhpcy5wcmltYXJ5ID0gcHJpbWFyeTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1hcmtlcnMubGVuZ3RoOyArK2kpXG4gICAgICBtYXJrZXJzW2ldLnBhcmVudCA9IHRoaXM7XG4gIH07XG4gIGV2ZW50TWl4aW4oU2hhcmVkVGV4dE1hcmtlcik7XG5cbiAgU2hhcmVkVGV4dE1hcmtlci5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5leHBsaWNpdGx5Q2xlYXJlZCkgcmV0dXJuO1xuICAgIHRoaXMuZXhwbGljaXRseUNsZWFyZWQgPSB0cnVlO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5tYXJrZXJzLmxlbmd0aDsgKytpKVxuICAgICAgdGhpcy5tYXJrZXJzW2ldLmNsZWFyKCk7XG4gICAgc2lnbmFsTGF0ZXIodGhpcywgXCJjbGVhclwiKTtcbiAgfTtcbiAgU2hhcmVkVGV4dE1hcmtlci5wcm90b3R5cGUuZmluZCA9IGZ1bmN0aW9uKHNpZGUsIGxpbmVPYmopIHtcbiAgICByZXR1cm4gdGhpcy5wcmltYXJ5LmZpbmQoc2lkZSwgbGluZU9iaik7XG4gIH07XG5cbiAgZnVuY3Rpb24gbWFya1RleHRTaGFyZWQoZG9jLCBmcm9tLCB0bywgb3B0aW9ucywgdHlwZSkge1xuICAgIG9wdGlvbnMgPSBjb3B5T2JqKG9wdGlvbnMpO1xuICAgIG9wdGlvbnMuc2hhcmVkID0gZmFsc2U7XG4gICAgdmFyIG1hcmtlcnMgPSBbbWFya1RleHQoZG9jLCBmcm9tLCB0bywgb3B0aW9ucywgdHlwZSldLCBwcmltYXJ5ID0gbWFya2Vyc1swXTtcbiAgICB2YXIgd2lkZ2V0ID0gb3B0aW9ucy53aWRnZXROb2RlO1xuICAgIGxpbmtlZERvY3MoZG9jLCBmdW5jdGlvbihkb2MpIHtcbiAgICAgIGlmICh3aWRnZXQpIG9wdGlvbnMud2lkZ2V0Tm9kZSA9IHdpZGdldC5jbG9uZU5vZGUodHJ1ZSk7XG4gICAgICBtYXJrZXJzLnB1c2gobWFya1RleHQoZG9jLCBjbGlwUG9zKGRvYywgZnJvbSksIGNsaXBQb3MoZG9jLCB0byksIG9wdGlvbnMsIHR5cGUpKTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZG9jLmxpbmtlZC5sZW5ndGg7ICsraSlcbiAgICAgICAgaWYgKGRvYy5saW5rZWRbaV0uaXNQYXJlbnQpIHJldHVybjtcbiAgICAgIHByaW1hcnkgPSBsc3QobWFya2Vycyk7XG4gICAgfSk7XG4gICAgcmV0dXJuIG5ldyBTaGFyZWRUZXh0TWFya2VyKG1hcmtlcnMsIHByaW1hcnkpO1xuICB9XG5cbiAgZnVuY3Rpb24gZmluZFNoYXJlZE1hcmtlcnMoZG9jKSB7XG4gICAgcmV0dXJuIGRvYy5maW5kTWFya3MoUG9zKGRvYy5maXJzdCwgMCksIGRvYy5jbGlwUG9zKFBvcyhkb2MubGFzdExpbmUoKSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKG0pIHsgcmV0dXJuIG0ucGFyZW50OyB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNvcHlTaGFyZWRNYXJrZXJzKGRvYywgbWFya2Vycykge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWFya2Vycy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIG1hcmtlciA9IG1hcmtlcnNbaV0sIHBvcyA9IG1hcmtlci5maW5kKCk7XG4gICAgICB2YXIgbUZyb20gPSBkb2MuY2xpcFBvcyhwb3MuZnJvbSksIG1UbyA9IGRvYy5jbGlwUG9zKHBvcy50byk7XG4gICAgICBpZiAoY21wKG1Gcm9tLCBtVG8pKSB7XG4gICAgICAgIHZhciBzdWJNYXJrID0gbWFya1RleHQoZG9jLCBtRnJvbSwgbVRvLCBtYXJrZXIucHJpbWFyeSwgbWFya2VyLnByaW1hcnkudHlwZSk7XG4gICAgICAgIG1hcmtlci5tYXJrZXJzLnB1c2goc3ViTWFyayk7XG4gICAgICAgIHN1Yk1hcmsucGFyZW50ID0gbWFya2VyO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGRldGFjaFNoYXJlZE1hcmtlcnMobWFya2Vycykge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWFya2Vycy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIG1hcmtlciA9IG1hcmtlcnNbaV0sIGxpbmtlZCA9IFttYXJrZXIucHJpbWFyeS5kb2NdOztcbiAgICAgIGxpbmtlZERvY3MobWFya2VyLnByaW1hcnkuZG9jLCBmdW5jdGlvbihkKSB7IGxpbmtlZC5wdXNoKGQpOyB9KTtcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbWFya2VyLm1hcmtlcnMubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgdmFyIHN1Yk1hcmtlciA9IG1hcmtlci5tYXJrZXJzW2pdO1xuICAgICAgICBpZiAoaW5kZXhPZihsaW5rZWQsIHN1Yk1hcmtlci5kb2MpID09IC0xKSB7XG4gICAgICAgICAgc3ViTWFya2VyLnBhcmVudCA9IG51bGw7XG4gICAgICAgICAgbWFya2VyLm1hcmtlcnMuc3BsaWNlKGotLSwgMSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvLyBURVhUTUFSS0VSIFNQQU5TXG5cbiAgZnVuY3Rpb24gTWFya2VkU3BhbihtYXJrZXIsIGZyb20sIHRvKSB7XG4gICAgdGhpcy5tYXJrZXIgPSBtYXJrZXI7XG4gICAgdGhpcy5mcm9tID0gZnJvbTsgdGhpcy50byA9IHRvO1xuICB9XG5cbiAgLy8gU2VhcmNoIGFuIGFycmF5IG9mIHNwYW5zIGZvciBhIHNwYW4gbWF0Y2hpbmcgdGhlIGdpdmVuIG1hcmtlci5cbiAgZnVuY3Rpb24gZ2V0TWFya2VkU3BhbkZvcihzcGFucywgbWFya2VyKSB7XG4gICAgaWYgKHNwYW5zKSBmb3IgKHZhciBpID0gMDsgaSA8IHNwYW5zLmxlbmd0aDsgKytpKSB7XG4gICAgICB2YXIgc3BhbiA9IHNwYW5zW2ldO1xuICAgICAgaWYgKHNwYW4ubWFya2VyID09IG1hcmtlcikgcmV0dXJuIHNwYW47XG4gICAgfVxuICB9XG4gIC8vIFJlbW92ZSBhIHNwYW4gZnJvbSBhbiBhcnJheSwgcmV0dXJuaW5nIHVuZGVmaW5lZCBpZiBubyBzcGFucyBhcmVcbiAgLy8gbGVmdCAod2UgZG9uJ3Qgc3RvcmUgYXJyYXlzIGZvciBsaW5lcyB3aXRob3V0IHNwYW5zKS5cbiAgZnVuY3Rpb24gcmVtb3ZlTWFya2VkU3BhbihzcGFucywgc3Bhbikge1xuICAgIGZvciAodmFyIHIsIGkgPSAwOyBpIDwgc3BhbnMubGVuZ3RoOyArK2kpXG4gICAgICBpZiAoc3BhbnNbaV0gIT0gc3BhbikgKHIgfHwgKHIgPSBbXSkpLnB1c2goc3BhbnNbaV0pO1xuICAgIHJldHVybiByO1xuICB9XG4gIC8vIEFkZCBhIHNwYW4gdG8gYSBsaW5lLlxuICBmdW5jdGlvbiBhZGRNYXJrZWRTcGFuKGxpbmUsIHNwYW4pIHtcbiAgICBsaW5lLm1hcmtlZFNwYW5zID0gbGluZS5tYXJrZWRTcGFucyA/IGxpbmUubWFya2VkU3BhbnMuY29uY2F0KFtzcGFuXSkgOiBbc3Bhbl07XG4gICAgc3Bhbi5tYXJrZXIuYXR0YWNoTGluZShsaW5lKTtcbiAgfVxuXG4gIC8vIFVzZWQgZm9yIHRoZSBhbGdvcml0aG0gdGhhdCBhZGp1c3RzIG1hcmtlcnMgZm9yIGEgY2hhbmdlIGluIHRoZVxuICAvLyBkb2N1bWVudC4gVGhlc2UgZnVuY3Rpb25zIGN1dCBhbiBhcnJheSBvZiBzcGFucyBhdCBhIGdpdmVuXG4gIC8vIGNoYXJhY3RlciBwb3NpdGlvbiwgcmV0dXJuaW5nIGFuIGFycmF5IG9mIHJlbWFpbmluZyBjaHVua3MgKG9yXG4gIC8vIHVuZGVmaW5lZCBpZiBub3RoaW5nIHJlbWFpbnMpLlxuICBmdW5jdGlvbiBtYXJrZWRTcGFuc0JlZm9yZShvbGQsIHN0YXJ0Q2gsIGlzSW5zZXJ0KSB7XG4gICAgaWYgKG9sZCkgZm9yICh2YXIgaSA9IDAsIG53OyBpIDwgb2xkLmxlbmd0aDsgKytpKSB7XG4gICAgICB2YXIgc3BhbiA9IG9sZFtpXSwgbWFya2VyID0gc3Bhbi5tYXJrZXI7XG4gICAgICB2YXIgc3RhcnRzQmVmb3JlID0gc3Bhbi5mcm9tID09IG51bGwgfHwgKG1hcmtlci5pbmNsdXNpdmVMZWZ0ID8gc3Bhbi5mcm9tIDw9IHN0YXJ0Q2ggOiBzcGFuLmZyb20gPCBzdGFydENoKTtcbiAgICAgIGlmIChzdGFydHNCZWZvcmUgfHwgc3Bhbi5mcm9tID09IHN0YXJ0Q2ggJiYgbWFya2VyLnR5cGUgPT0gXCJib29rbWFya1wiICYmICghaXNJbnNlcnQgfHwgIXNwYW4ubWFya2VyLmluc2VydExlZnQpKSB7XG4gICAgICAgIHZhciBlbmRzQWZ0ZXIgPSBzcGFuLnRvID09IG51bGwgfHwgKG1hcmtlci5pbmNsdXNpdmVSaWdodCA/IHNwYW4udG8gPj0gc3RhcnRDaCA6IHNwYW4udG8gPiBzdGFydENoKTtcbiAgICAgICAgKG53IHx8IChudyA9IFtdKSkucHVzaChuZXcgTWFya2VkU3BhbihtYXJrZXIsIHNwYW4uZnJvbSwgZW5kc0FmdGVyID8gbnVsbCA6IHNwYW4udG8pKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG53O1xuICB9XG4gIGZ1bmN0aW9uIG1hcmtlZFNwYW5zQWZ0ZXIob2xkLCBlbmRDaCwgaXNJbnNlcnQpIHtcbiAgICBpZiAob2xkKSBmb3IgKHZhciBpID0gMCwgbnc7IGkgPCBvbGQubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBzcGFuID0gb2xkW2ldLCBtYXJrZXIgPSBzcGFuLm1hcmtlcjtcbiAgICAgIHZhciBlbmRzQWZ0ZXIgPSBzcGFuLnRvID09IG51bGwgfHwgKG1hcmtlci5pbmNsdXNpdmVSaWdodCA/IHNwYW4udG8gPj0gZW5kQ2ggOiBzcGFuLnRvID4gZW5kQ2gpO1xuICAgICAgaWYgKGVuZHNBZnRlciB8fCBzcGFuLmZyb20gPT0gZW5kQ2ggJiYgbWFya2VyLnR5cGUgPT0gXCJib29rbWFya1wiICYmICghaXNJbnNlcnQgfHwgc3Bhbi5tYXJrZXIuaW5zZXJ0TGVmdCkpIHtcbiAgICAgICAgdmFyIHN0YXJ0c0JlZm9yZSA9IHNwYW4uZnJvbSA9PSBudWxsIHx8IChtYXJrZXIuaW5jbHVzaXZlTGVmdCA/IHNwYW4uZnJvbSA8PSBlbmRDaCA6IHNwYW4uZnJvbSA8IGVuZENoKTtcbiAgICAgICAgKG53IHx8IChudyA9IFtdKSkucHVzaChuZXcgTWFya2VkU3BhbihtYXJrZXIsIHN0YXJ0c0JlZm9yZSA/IG51bGwgOiBzcGFuLmZyb20gLSBlbmRDaCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGFuLnRvID09IG51bGwgPyBudWxsIDogc3Bhbi50byAtIGVuZENoKSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudztcbiAgfVxuXG4gIC8vIEdpdmVuIGEgY2hhbmdlIG9iamVjdCwgY29tcHV0ZSB0aGUgbmV3IHNldCBvZiBtYXJrZXIgc3BhbnMgdGhhdFxuICAvLyBjb3ZlciB0aGUgbGluZSBpbiB3aGljaCB0aGUgY2hhbmdlIHRvb2sgcGxhY2UuIFJlbW92ZXMgc3BhbnNcbiAgLy8gZW50aXJlbHkgd2l0aGluIHRoZSBjaGFuZ2UsIHJlY29ubmVjdHMgc3BhbnMgYmVsb25naW5nIHRvIHRoZVxuICAvLyBzYW1lIG1hcmtlciB0aGF0IGFwcGVhciBvbiBib3RoIHNpZGVzIG9mIHRoZSBjaGFuZ2UsIGFuZCBjdXRzIG9mZlxuICAvLyBzcGFucyBwYXJ0aWFsbHkgd2l0aGluIHRoZSBjaGFuZ2UuIFJldHVybnMgYW4gYXJyYXkgb2Ygc3BhblxuICAvLyBhcnJheXMgd2l0aCBvbmUgZWxlbWVudCBmb3IgZWFjaCBsaW5lIGluIChhZnRlcikgdGhlIGNoYW5nZS5cbiAgZnVuY3Rpb24gc3RyZXRjaFNwYW5zT3ZlckNoYW5nZShkb2MsIGNoYW5nZSkge1xuICAgIGlmIChjaGFuZ2UuZnVsbCkgcmV0dXJuIG51bGw7XG4gICAgdmFyIG9sZEZpcnN0ID0gaXNMaW5lKGRvYywgY2hhbmdlLmZyb20ubGluZSkgJiYgZ2V0TGluZShkb2MsIGNoYW5nZS5mcm9tLmxpbmUpLm1hcmtlZFNwYW5zO1xuICAgIHZhciBvbGRMYXN0ID0gaXNMaW5lKGRvYywgY2hhbmdlLnRvLmxpbmUpICYmIGdldExpbmUoZG9jLCBjaGFuZ2UudG8ubGluZSkubWFya2VkU3BhbnM7XG4gICAgaWYgKCFvbGRGaXJzdCAmJiAhb2xkTGFzdCkgcmV0dXJuIG51bGw7XG5cbiAgICB2YXIgc3RhcnRDaCA9IGNoYW5nZS5mcm9tLmNoLCBlbmRDaCA9IGNoYW5nZS50by5jaCwgaXNJbnNlcnQgPSBjbXAoY2hhbmdlLmZyb20sIGNoYW5nZS50bykgPT0gMDtcbiAgICAvLyBHZXQgdGhlIHNwYW5zIHRoYXQgJ3N0aWNrIG91dCcgb24gYm90aCBzaWRlc1xuICAgIHZhciBmaXJzdCA9IG1hcmtlZFNwYW5zQmVmb3JlKG9sZEZpcnN0LCBzdGFydENoLCBpc0luc2VydCk7XG4gICAgdmFyIGxhc3QgPSBtYXJrZWRTcGFuc0FmdGVyKG9sZExhc3QsIGVuZENoLCBpc0luc2VydCk7XG5cbiAgICAvLyBOZXh0LCBtZXJnZSB0aG9zZSB0d28gZW5kc1xuICAgIHZhciBzYW1lTGluZSA9IGNoYW5nZS50ZXh0Lmxlbmd0aCA9PSAxLCBvZmZzZXQgPSBsc3QoY2hhbmdlLnRleHQpLmxlbmd0aCArIChzYW1lTGluZSA/IHN0YXJ0Q2ggOiAwKTtcbiAgICBpZiAoZmlyc3QpIHtcbiAgICAgIC8vIEZpeCB1cCAudG8gcHJvcGVydGllcyBvZiBmaXJzdFxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaXJzdC5sZW5ndGg7ICsraSkge1xuICAgICAgICB2YXIgc3BhbiA9IGZpcnN0W2ldO1xuICAgICAgICBpZiAoc3Bhbi50byA9PSBudWxsKSB7XG4gICAgICAgICAgdmFyIGZvdW5kID0gZ2V0TWFya2VkU3BhbkZvcihsYXN0LCBzcGFuLm1hcmtlcik7XG4gICAgICAgICAgaWYgKCFmb3VuZCkgc3Bhbi50byA9IHN0YXJ0Q2g7XG4gICAgICAgICAgZWxzZSBpZiAoc2FtZUxpbmUpIHNwYW4udG8gPSBmb3VuZC50byA9PSBudWxsID8gbnVsbCA6IGZvdW5kLnRvICsgb2Zmc2V0O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChsYXN0KSB7XG4gICAgICAvLyBGaXggdXAgLmZyb20gaW4gbGFzdCAob3IgbW92ZSB0aGVtIGludG8gZmlyc3QgaW4gY2FzZSBvZiBzYW1lTGluZSlcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGFzdC5sZW5ndGg7ICsraSkge1xuICAgICAgICB2YXIgc3BhbiA9IGxhc3RbaV07XG4gICAgICAgIGlmIChzcGFuLnRvICE9IG51bGwpIHNwYW4udG8gKz0gb2Zmc2V0O1xuICAgICAgICBpZiAoc3Bhbi5mcm9tID09IG51bGwpIHtcbiAgICAgICAgICB2YXIgZm91bmQgPSBnZXRNYXJrZWRTcGFuRm9yKGZpcnN0LCBzcGFuLm1hcmtlcik7XG4gICAgICAgICAgaWYgKCFmb3VuZCkge1xuICAgICAgICAgICAgc3Bhbi5mcm9tID0gb2Zmc2V0O1xuICAgICAgICAgICAgaWYgKHNhbWVMaW5lKSAoZmlyc3QgfHwgKGZpcnN0ID0gW10pKS5wdXNoKHNwYW4pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzcGFuLmZyb20gKz0gb2Zmc2V0O1xuICAgICAgICAgIGlmIChzYW1lTGluZSkgKGZpcnN0IHx8IChmaXJzdCA9IFtdKSkucHVzaChzcGFuKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICAvLyBNYWtlIHN1cmUgd2UgZGlkbid0IGNyZWF0ZSBhbnkgemVyby1sZW5ndGggc3BhbnNcbiAgICBpZiAoZmlyc3QpIGZpcnN0ID0gY2xlYXJFbXB0eVNwYW5zKGZpcnN0KTtcbiAgICBpZiAobGFzdCAmJiBsYXN0ICE9IGZpcnN0KSBsYXN0ID0gY2xlYXJFbXB0eVNwYW5zKGxhc3QpO1xuXG4gICAgdmFyIG5ld01hcmtlcnMgPSBbZmlyc3RdO1xuICAgIGlmICghc2FtZUxpbmUpIHtcbiAgICAgIC8vIEZpbGwgZ2FwIHdpdGggd2hvbGUtbGluZS1zcGFuc1xuICAgICAgdmFyIGdhcCA9IGNoYW5nZS50ZXh0Lmxlbmd0aCAtIDIsIGdhcE1hcmtlcnM7XG4gICAgICBpZiAoZ2FwID4gMCAmJiBmaXJzdClcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaXJzdC5sZW5ndGg7ICsraSlcbiAgICAgICAgICBpZiAoZmlyc3RbaV0udG8gPT0gbnVsbClcbiAgICAgICAgICAgIChnYXBNYXJrZXJzIHx8IChnYXBNYXJrZXJzID0gW10pKS5wdXNoKG5ldyBNYXJrZWRTcGFuKGZpcnN0W2ldLm1hcmtlciwgbnVsbCwgbnVsbCkpO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBnYXA7ICsraSlcbiAgICAgICAgbmV3TWFya2Vycy5wdXNoKGdhcE1hcmtlcnMpO1xuICAgICAgbmV3TWFya2Vycy5wdXNoKGxhc3QpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3TWFya2VycztcbiAgfVxuXG4gIC8vIFJlbW92ZSBzcGFucyB0aGF0IGFyZSBlbXB0eSBhbmQgZG9uJ3QgaGF2ZSBhIGNsZWFyV2hlbkVtcHR5XG4gIC8vIG9wdGlvbiBvZiBmYWxzZS5cbiAgZnVuY3Rpb24gY2xlYXJFbXB0eVNwYW5zKHNwYW5zKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGFucy5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIHNwYW4gPSBzcGFuc1tpXTtcbiAgICAgIGlmIChzcGFuLmZyb20gIT0gbnVsbCAmJiBzcGFuLmZyb20gPT0gc3Bhbi50byAmJiBzcGFuLm1hcmtlci5jbGVhcldoZW5FbXB0eSAhPT0gZmFsc2UpXG4gICAgICAgIHNwYW5zLnNwbGljZShpLS0sIDEpO1xuICAgIH1cbiAgICBpZiAoIXNwYW5zLmxlbmd0aCkgcmV0dXJuIG51bGw7XG4gICAgcmV0dXJuIHNwYW5zO1xuICB9XG5cbiAgLy8gVXNlZCBmb3IgdW4vcmUtZG9pbmcgY2hhbmdlcyBmcm9tIHRoZSBoaXN0b3J5LiBDb21iaW5lcyB0aGVcbiAgLy8gcmVzdWx0IG9mIGNvbXB1dGluZyB0aGUgZXhpc3Rpbmcgc3BhbnMgd2l0aCB0aGUgc2V0IG9mIHNwYW5zIHRoYXRcbiAgLy8gZXhpc3RlZCBpbiB0aGUgaGlzdG9yeSAoc28gdGhhdCBkZWxldGluZyBhcm91bmQgYSBzcGFuIGFuZCB0aGVuXG4gIC8vIHVuZG9pbmcgYnJpbmdzIGJhY2sgdGhlIHNwYW4pLlxuICBmdW5jdGlvbiBtZXJnZU9sZFNwYW5zKGRvYywgY2hhbmdlKSB7XG4gICAgdmFyIG9sZCA9IGdldE9sZFNwYW5zKGRvYywgY2hhbmdlKTtcbiAgICB2YXIgc3RyZXRjaGVkID0gc3RyZXRjaFNwYW5zT3ZlckNoYW5nZShkb2MsIGNoYW5nZSk7XG4gICAgaWYgKCFvbGQpIHJldHVybiBzdHJldGNoZWQ7XG4gICAgaWYgKCFzdHJldGNoZWQpIHJldHVybiBvbGQ7XG5cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9sZC5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIG9sZEN1ciA9IG9sZFtpXSwgc3RyZXRjaEN1ciA9IHN0cmV0Y2hlZFtpXTtcbiAgICAgIGlmIChvbGRDdXIgJiYgc3RyZXRjaEN1cikge1xuICAgICAgICBzcGFuczogZm9yICh2YXIgaiA9IDA7IGogPCBzdHJldGNoQ3VyLmxlbmd0aDsgKytqKSB7XG4gICAgICAgICAgdmFyIHNwYW4gPSBzdHJldGNoQ3VyW2pdO1xuICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgb2xkQ3VyLmxlbmd0aDsgKytrKVxuICAgICAgICAgICAgaWYgKG9sZEN1cltrXS5tYXJrZXIgPT0gc3Bhbi5tYXJrZXIpIGNvbnRpbnVlIHNwYW5zO1xuICAgICAgICAgIG9sZEN1ci5wdXNoKHNwYW4pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHN0cmV0Y2hDdXIpIHtcbiAgICAgICAgb2xkW2ldID0gc3RyZXRjaEN1cjtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG9sZDtcbiAgfVxuXG4gIC8vIFVzZWQgdG8gJ2NsaXAnIG91dCByZWFkT25seSByYW5nZXMgd2hlbiBtYWtpbmcgYSBjaGFuZ2UuXG4gIGZ1bmN0aW9uIHJlbW92ZVJlYWRPbmx5UmFuZ2VzKGRvYywgZnJvbSwgdG8pIHtcbiAgICB2YXIgbWFya2VycyA9IG51bGw7XG4gICAgZG9jLml0ZXIoZnJvbS5saW5lLCB0by5saW5lICsgMSwgZnVuY3Rpb24obGluZSkge1xuICAgICAgaWYgKGxpbmUubWFya2VkU3BhbnMpIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZS5tYXJrZWRTcGFucy5sZW5ndGg7ICsraSkge1xuICAgICAgICB2YXIgbWFyayA9IGxpbmUubWFya2VkU3BhbnNbaV0ubWFya2VyO1xuICAgICAgICBpZiAobWFyay5yZWFkT25seSAmJiAoIW1hcmtlcnMgfHwgaW5kZXhPZihtYXJrZXJzLCBtYXJrKSA9PSAtMSkpXG4gICAgICAgICAgKG1hcmtlcnMgfHwgKG1hcmtlcnMgPSBbXSkpLnB1c2gobWFyayk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgaWYgKCFtYXJrZXJzKSByZXR1cm4gbnVsbDtcbiAgICB2YXIgcGFydHMgPSBbe2Zyb206IGZyb20sIHRvOiB0b31dO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWFya2Vycy5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIG1rID0gbWFya2Vyc1tpXSwgbSA9IG1rLmZpbmQoMCk7XG4gICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHBhcnRzLmxlbmd0aDsgKytqKSB7XG4gICAgICAgIHZhciBwID0gcGFydHNbal07XG4gICAgICAgIGlmIChjbXAocC50bywgbS5mcm9tKSA8IDAgfHwgY21wKHAuZnJvbSwgbS50bykgPiAwKSBjb250aW51ZTtcbiAgICAgICAgdmFyIG5ld1BhcnRzID0gW2osIDFdLCBkZnJvbSA9IGNtcChwLmZyb20sIG0uZnJvbSksIGR0byA9IGNtcChwLnRvLCBtLnRvKTtcbiAgICAgICAgaWYgKGRmcm9tIDwgMCB8fCAhbWsuaW5jbHVzaXZlTGVmdCAmJiAhZGZyb20pXG4gICAgICAgICAgbmV3UGFydHMucHVzaCh7ZnJvbTogcC5mcm9tLCB0bzogbS5mcm9tfSk7XG4gICAgICAgIGlmIChkdG8gPiAwIHx8ICFtay5pbmNsdXNpdmVSaWdodCAmJiAhZHRvKVxuICAgICAgICAgIG5ld1BhcnRzLnB1c2goe2Zyb206IG0udG8sIHRvOiBwLnRvfSk7XG4gICAgICAgIHBhcnRzLnNwbGljZS5hcHBseShwYXJ0cywgbmV3UGFydHMpO1xuICAgICAgICBqICs9IG5ld1BhcnRzLmxlbmd0aCAtIDE7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBwYXJ0cztcbiAgfVxuXG4gIC8vIENvbm5lY3Qgb3IgZGlzY29ubmVjdCBzcGFucyBmcm9tIGEgbGluZS5cbiAgZnVuY3Rpb24gZGV0YWNoTWFya2VkU3BhbnMobGluZSkge1xuICAgIHZhciBzcGFucyA9IGxpbmUubWFya2VkU3BhbnM7XG4gICAgaWYgKCFzcGFucykgcmV0dXJuO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3BhbnMubGVuZ3RoOyArK2kpXG4gICAgICBzcGFuc1tpXS5tYXJrZXIuZGV0YWNoTGluZShsaW5lKTtcbiAgICBsaW5lLm1hcmtlZFNwYW5zID0gbnVsbDtcbiAgfVxuICBmdW5jdGlvbiBhdHRhY2hNYXJrZWRTcGFucyhsaW5lLCBzcGFucykge1xuICAgIGlmICghc3BhbnMpIHJldHVybjtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNwYW5zLmxlbmd0aDsgKytpKVxuICAgICAgc3BhbnNbaV0ubWFya2VyLmF0dGFjaExpbmUobGluZSk7XG4gICAgbGluZS5tYXJrZWRTcGFucyA9IHNwYW5zO1xuICB9XG5cbiAgLy8gSGVscGVycyB1c2VkIHdoZW4gY29tcHV0aW5nIHdoaWNoIG92ZXJsYXBwaW5nIGNvbGxhcHNlZCBzcGFuXG4gIC8vIGNvdW50cyBhcyB0aGUgbGFyZ2VyIG9uZS5cbiAgZnVuY3Rpb24gZXh0cmFMZWZ0KG1hcmtlcikgeyByZXR1cm4gbWFya2VyLmluY2x1c2l2ZUxlZnQgPyAtMSA6IDA7IH1cbiAgZnVuY3Rpb24gZXh0cmFSaWdodChtYXJrZXIpIHsgcmV0dXJuIG1hcmtlci5pbmNsdXNpdmVSaWdodCA/IDEgOiAwOyB9XG5cbiAgLy8gUmV0dXJucyBhIG51bWJlciBpbmRpY2F0aW5nIHdoaWNoIG9mIHR3byBvdmVybGFwcGluZyBjb2xsYXBzZWRcbiAgLy8gc3BhbnMgaXMgbGFyZ2VyIChhbmQgdGh1cyBpbmNsdWRlcyB0aGUgb3RoZXIpLiBGYWxscyBiYWNrIHRvXG4gIC8vIGNvbXBhcmluZyBpZHMgd2hlbiB0aGUgc3BhbnMgY292ZXIgZXhhY3RseSB0aGUgc2FtZSByYW5nZS5cbiAgZnVuY3Rpb24gY29tcGFyZUNvbGxhcHNlZE1hcmtlcnMoYSwgYikge1xuICAgIHZhciBsZW5EaWZmID0gYS5saW5lcy5sZW5ndGggLSBiLmxpbmVzLmxlbmd0aDtcbiAgICBpZiAobGVuRGlmZiAhPSAwKSByZXR1cm4gbGVuRGlmZjtcbiAgICB2YXIgYVBvcyA9IGEuZmluZCgpLCBiUG9zID0gYi5maW5kKCk7XG4gICAgdmFyIGZyb21DbXAgPSBjbXAoYVBvcy5mcm9tLCBiUG9zLmZyb20pIHx8IGV4dHJhTGVmdChhKSAtIGV4dHJhTGVmdChiKTtcbiAgICBpZiAoZnJvbUNtcCkgcmV0dXJuIC1mcm9tQ21wO1xuICAgIHZhciB0b0NtcCA9IGNtcChhUG9zLnRvLCBiUG9zLnRvKSB8fCBleHRyYVJpZ2h0KGEpIC0gZXh0cmFSaWdodChiKTtcbiAgICBpZiAodG9DbXApIHJldHVybiB0b0NtcDtcbiAgICByZXR1cm4gYi5pZCAtIGEuaWQ7XG4gIH1cblxuICAvLyBGaW5kIG91dCB3aGV0aGVyIGEgbGluZSBlbmRzIG9yIHN0YXJ0cyBpbiBhIGNvbGxhcHNlZCBzcGFuLiBJZlxuICAvLyBzbywgcmV0dXJuIHRoZSBtYXJrZXIgZm9yIHRoYXQgc3Bhbi5cbiAgZnVuY3Rpb24gY29sbGFwc2VkU3BhbkF0U2lkZShsaW5lLCBzdGFydCkge1xuICAgIHZhciBzcHMgPSBzYXdDb2xsYXBzZWRTcGFucyAmJiBsaW5lLm1hcmtlZFNwYW5zLCBmb3VuZDtcbiAgICBpZiAoc3BzKSBmb3IgKHZhciBzcCwgaSA9IDA7IGkgPCBzcHMubGVuZ3RoOyArK2kpIHtcbiAgICAgIHNwID0gc3BzW2ldO1xuICAgICAgaWYgKHNwLm1hcmtlci5jb2xsYXBzZWQgJiYgKHN0YXJ0ID8gc3AuZnJvbSA6IHNwLnRvKSA9PSBudWxsICYmXG4gICAgICAgICAgKCFmb3VuZCB8fCBjb21wYXJlQ29sbGFwc2VkTWFya2Vycyhmb3VuZCwgc3AubWFya2VyKSA8IDApKVxuICAgICAgICBmb3VuZCA9IHNwLm1hcmtlcjtcbiAgICB9XG4gICAgcmV0dXJuIGZvdW5kO1xuICB9XG4gIGZ1bmN0aW9uIGNvbGxhcHNlZFNwYW5BdFN0YXJ0KGxpbmUpIHsgcmV0dXJuIGNvbGxhcHNlZFNwYW5BdFNpZGUobGluZSwgdHJ1ZSk7IH1cbiAgZnVuY3Rpb24gY29sbGFwc2VkU3BhbkF0RW5kKGxpbmUpIHsgcmV0dXJuIGNvbGxhcHNlZFNwYW5BdFNpZGUobGluZSwgZmFsc2UpOyB9XG5cbiAgLy8gVGVzdCB3aGV0aGVyIHRoZXJlIGV4aXN0cyBhIGNvbGxhcHNlZCBzcGFuIHRoYXQgcGFydGlhbGx5XG4gIC8vIG92ZXJsYXBzIChjb3ZlcnMgdGhlIHN0YXJ0IG9yIGVuZCwgYnV0IG5vdCBib3RoKSBvZiBhIG5ldyBzcGFuLlxuICAvLyBTdWNoIG92ZXJsYXAgaXMgbm90IGFsbG93ZWQuXG4gIGZ1bmN0aW9uIGNvbmZsaWN0aW5nQ29sbGFwc2VkUmFuZ2UoZG9jLCBsaW5lTm8sIGZyb20sIHRvLCBtYXJrZXIpIHtcbiAgICB2YXIgbGluZSA9IGdldExpbmUoZG9jLCBsaW5lTm8pO1xuICAgIHZhciBzcHMgPSBzYXdDb2xsYXBzZWRTcGFucyAmJiBsaW5lLm1hcmtlZFNwYW5zO1xuICAgIGlmIChzcHMpIGZvciAodmFyIGkgPSAwOyBpIDwgc3BzLmxlbmd0aDsgKytpKSB7XG4gICAgICB2YXIgc3AgPSBzcHNbaV07XG4gICAgICBpZiAoIXNwLm1hcmtlci5jb2xsYXBzZWQpIGNvbnRpbnVlO1xuICAgICAgdmFyIGZvdW5kID0gc3AubWFya2VyLmZpbmQoMCk7XG4gICAgICB2YXIgZnJvbUNtcCA9IGNtcChmb3VuZC5mcm9tLCBmcm9tKSB8fCBleHRyYUxlZnQoc3AubWFya2VyKSAtIGV4dHJhTGVmdChtYXJrZXIpO1xuICAgICAgdmFyIHRvQ21wID0gY21wKGZvdW5kLnRvLCB0bykgfHwgZXh0cmFSaWdodChzcC5tYXJrZXIpIC0gZXh0cmFSaWdodChtYXJrZXIpO1xuICAgICAgaWYgKGZyb21DbXAgPj0gMCAmJiB0b0NtcCA8PSAwIHx8IGZyb21DbXAgPD0gMCAmJiB0b0NtcCA+PSAwKSBjb250aW51ZTtcbiAgICAgIGlmIChmcm9tQ21wIDw9IDAgJiYgKGNtcChmb3VuZC50bywgZnJvbSkgPiAwIHx8IChzcC5tYXJrZXIuaW5jbHVzaXZlUmlnaHQgJiYgbWFya2VyLmluY2x1c2l2ZUxlZnQpKSB8fFxuICAgICAgICAgIGZyb21DbXAgPj0gMCAmJiAoY21wKGZvdW5kLmZyb20sIHRvKSA8IDAgfHwgKHNwLm1hcmtlci5pbmNsdXNpdmVMZWZ0ICYmIG1hcmtlci5pbmNsdXNpdmVSaWdodCkpKVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICAvLyBBIHZpc3VhbCBsaW5lIGlzIGEgbGluZSBhcyBkcmF3biBvbiB0aGUgc2NyZWVuLiBGb2xkaW5nLCBmb3JcbiAgLy8gZXhhbXBsZSwgY2FuIGNhdXNlIG11bHRpcGxlIGxvZ2ljYWwgbGluZXMgdG8gYXBwZWFyIG9uIHRoZSBzYW1lXG4gIC8vIHZpc3VhbCBsaW5lLiBUaGlzIGZpbmRzIHRoZSBzdGFydCBvZiB0aGUgdmlzdWFsIGxpbmUgdGhhdCB0aGVcbiAgLy8gZ2l2ZW4gbGluZSBpcyBwYXJ0IG9mICh1c3VhbGx5IHRoYXQgaXMgdGhlIGxpbmUgaXRzZWxmKS5cbiAgZnVuY3Rpb24gdmlzdWFsTGluZShsaW5lKSB7XG4gICAgdmFyIG1lcmdlZDtcbiAgICB3aGlsZSAobWVyZ2VkID0gY29sbGFwc2VkU3BhbkF0U3RhcnQobGluZSkpXG4gICAgICBsaW5lID0gbWVyZ2VkLmZpbmQoLTEsIHRydWUpLmxpbmU7XG4gICAgcmV0dXJuIGxpbmU7XG4gIH1cblxuICAvLyBSZXR1cm5zIGFuIGFycmF5IG9mIGxvZ2ljYWwgbGluZXMgdGhhdCBjb250aW51ZSB0aGUgdmlzdWFsIGxpbmVcbiAgLy8gc3RhcnRlZCBieSB0aGUgYXJndW1lbnQsIG9yIHVuZGVmaW5lZCBpZiB0aGVyZSBhcmUgbm8gc3VjaCBsaW5lcy5cbiAgZnVuY3Rpb24gdmlzdWFsTGluZUNvbnRpbnVlZChsaW5lKSB7XG4gICAgdmFyIG1lcmdlZCwgbGluZXM7XG4gICAgd2hpbGUgKG1lcmdlZCA9IGNvbGxhcHNlZFNwYW5BdEVuZChsaW5lKSkge1xuICAgICAgbGluZSA9IG1lcmdlZC5maW5kKDEsIHRydWUpLmxpbmU7XG4gICAgICAobGluZXMgfHwgKGxpbmVzID0gW10pKS5wdXNoKGxpbmUpO1xuICAgIH1cbiAgICByZXR1cm4gbGluZXM7XG4gIH1cblxuICAvLyBHZXQgdGhlIGxpbmUgbnVtYmVyIG9mIHRoZSBzdGFydCBvZiB0aGUgdmlzdWFsIGxpbmUgdGhhdCB0aGVcbiAgLy8gZ2l2ZW4gbGluZSBudW1iZXIgaXMgcGFydCBvZi5cbiAgZnVuY3Rpb24gdmlzdWFsTGluZU5vKGRvYywgbGluZU4pIHtcbiAgICB2YXIgbGluZSA9IGdldExpbmUoZG9jLCBsaW5lTiksIHZpcyA9IHZpc3VhbExpbmUobGluZSk7XG4gICAgaWYgKGxpbmUgPT0gdmlzKSByZXR1cm4gbGluZU47XG4gICAgcmV0dXJuIGxpbmVObyh2aXMpO1xuICB9XG4gIC8vIEdldCB0aGUgbGluZSBudW1iZXIgb2YgdGhlIHN0YXJ0IG9mIHRoZSBuZXh0IHZpc3VhbCBsaW5lIGFmdGVyXG4gIC8vIHRoZSBnaXZlbiBsaW5lLlxuICBmdW5jdGlvbiB2aXN1YWxMaW5lRW5kTm8oZG9jLCBsaW5lTikge1xuICAgIGlmIChsaW5lTiA+IGRvYy5sYXN0TGluZSgpKSByZXR1cm4gbGluZU47XG4gICAgdmFyIGxpbmUgPSBnZXRMaW5lKGRvYywgbGluZU4pLCBtZXJnZWQ7XG4gICAgaWYgKCFsaW5lSXNIaWRkZW4oZG9jLCBsaW5lKSkgcmV0dXJuIGxpbmVOO1xuICAgIHdoaWxlIChtZXJnZWQgPSBjb2xsYXBzZWRTcGFuQXRFbmQobGluZSkpXG4gICAgICBsaW5lID0gbWVyZ2VkLmZpbmQoMSwgdHJ1ZSkubGluZTtcbiAgICByZXR1cm4gbGluZU5vKGxpbmUpICsgMTtcbiAgfVxuXG4gIC8vIENvbXB1dGUgd2hldGhlciBhIGxpbmUgaXMgaGlkZGVuLiBMaW5lcyBjb3VudCBhcyBoaWRkZW4gd2hlbiB0aGV5XG4gIC8vIGFyZSBwYXJ0IG9mIGEgdmlzdWFsIGxpbmUgdGhhdCBzdGFydHMgd2l0aCBhbm90aGVyIGxpbmUsIG9yIHdoZW5cbiAgLy8gdGhleSBhcmUgZW50aXJlbHkgY292ZXJlZCBieSBjb2xsYXBzZWQsIG5vbi13aWRnZXQgc3Bhbi5cbiAgZnVuY3Rpb24gbGluZUlzSGlkZGVuKGRvYywgbGluZSkge1xuICAgIHZhciBzcHMgPSBzYXdDb2xsYXBzZWRTcGFucyAmJiBsaW5lLm1hcmtlZFNwYW5zO1xuICAgIGlmIChzcHMpIGZvciAodmFyIHNwLCBpID0gMDsgaSA8IHNwcy5sZW5ndGg7ICsraSkge1xuICAgICAgc3AgPSBzcHNbaV07XG4gICAgICBpZiAoIXNwLm1hcmtlci5jb2xsYXBzZWQpIGNvbnRpbnVlO1xuICAgICAgaWYgKHNwLmZyb20gPT0gbnVsbCkgcmV0dXJuIHRydWU7XG4gICAgICBpZiAoc3AubWFya2VyLndpZGdldE5vZGUpIGNvbnRpbnVlO1xuICAgICAgaWYgKHNwLmZyb20gPT0gMCAmJiBzcC5tYXJrZXIuaW5jbHVzaXZlTGVmdCAmJiBsaW5lSXNIaWRkZW5Jbm5lcihkb2MsIGxpbmUsIHNwKSlcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIGxpbmVJc0hpZGRlbklubmVyKGRvYywgbGluZSwgc3Bhbikge1xuICAgIGlmIChzcGFuLnRvID09IG51bGwpIHtcbiAgICAgIHZhciBlbmQgPSBzcGFuLm1hcmtlci5maW5kKDEsIHRydWUpO1xuICAgICAgcmV0dXJuIGxpbmVJc0hpZGRlbklubmVyKGRvYywgZW5kLmxpbmUsIGdldE1hcmtlZFNwYW5Gb3IoZW5kLmxpbmUubWFya2VkU3BhbnMsIHNwYW4ubWFya2VyKSk7XG4gICAgfVxuICAgIGlmIChzcGFuLm1hcmtlci5pbmNsdXNpdmVSaWdodCAmJiBzcGFuLnRvID09IGxpbmUudGV4dC5sZW5ndGgpXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICBmb3IgKHZhciBzcCwgaSA9IDA7IGkgPCBsaW5lLm1hcmtlZFNwYW5zLmxlbmd0aDsgKytpKSB7XG4gICAgICBzcCA9IGxpbmUubWFya2VkU3BhbnNbaV07XG4gICAgICBpZiAoc3AubWFya2VyLmNvbGxhcHNlZCAmJiAhc3AubWFya2VyLndpZGdldE5vZGUgJiYgc3AuZnJvbSA9PSBzcGFuLnRvICYmXG4gICAgICAgICAgKHNwLnRvID09IG51bGwgfHwgc3AudG8gIT0gc3Bhbi5mcm9tKSAmJlxuICAgICAgICAgIChzcC5tYXJrZXIuaW5jbHVzaXZlTGVmdCB8fCBzcGFuLm1hcmtlci5pbmNsdXNpdmVSaWdodCkgJiZcbiAgICAgICAgICBsaW5lSXNIaWRkZW5Jbm5lcihkb2MsIGxpbmUsIHNwKSkgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgLy8gTElORSBXSURHRVRTXG5cbiAgLy8gTGluZSB3aWRnZXRzIGFyZSBibG9jayBlbGVtZW50cyBkaXNwbGF5ZWQgYWJvdmUgb3IgYmVsb3cgYSBsaW5lLlxuXG4gIHZhciBMaW5lV2lkZ2V0ID0gQ29kZU1pcnJvci5MaW5lV2lkZ2V0ID0gZnVuY3Rpb24oZG9jLCBub2RlLCBvcHRpb25zKSB7XG4gICAgaWYgKG9wdGlvbnMpIGZvciAodmFyIG9wdCBpbiBvcHRpb25zKSBpZiAob3B0aW9ucy5oYXNPd25Qcm9wZXJ0eShvcHQpKVxuICAgICAgdGhpc1tvcHRdID0gb3B0aW9uc1tvcHRdO1xuICAgIHRoaXMuZG9jID0gZG9jO1xuICAgIHRoaXMubm9kZSA9IG5vZGU7XG4gIH07XG4gIGV2ZW50TWl4aW4oTGluZVdpZGdldCk7XG5cbiAgZnVuY3Rpb24gYWRqdXN0U2Nyb2xsV2hlbkFib3ZlVmlzaWJsZShjbSwgbGluZSwgZGlmZikge1xuICAgIGlmIChoZWlnaHRBdExpbmUobGluZSkgPCAoKGNtLmN1ck9wICYmIGNtLmN1ck9wLnNjcm9sbFRvcCkgfHwgY20uZG9jLnNjcm9sbFRvcCkpXG4gICAgICBhZGRUb1Njcm9sbFBvcyhjbSwgbnVsbCwgZGlmZik7XG4gIH1cblxuICBMaW5lV2lkZ2V0LnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjbSA9IHRoaXMuZG9jLmNtLCB3cyA9IHRoaXMubGluZS53aWRnZXRzLCBsaW5lID0gdGhpcy5saW5lLCBubyA9IGxpbmVObyhsaW5lKTtcbiAgICBpZiAobm8gPT0gbnVsbCB8fCAhd3MpIHJldHVybjtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHdzLmxlbmd0aDsgKytpKSBpZiAod3NbaV0gPT0gdGhpcykgd3Muc3BsaWNlKGktLSwgMSk7XG4gICAgaWYgKCF3cy5sZW5ndGgpIGxpbmUud2lkZ2V0cyA9IG51bGw7XG4gICAgdmFyIGhlaWdodCA9IHdpZGdldEhlaWdodCh0aGlzKTtcbiAgICB1cGRhdGVMaW5lSGVpZ2h0KGxpbmUsIE1hdGgubWF4KDAsIGxpbmUuaGVpZ2h0IC0gaGVpZ2h0KSk7XG4gICAgaWYgKGNtKSBydW5Jbk9wKGNtLCBmdW5jdGlvbigpIHtcbiAgICAgIGFkanVzdFNjcm9sbFdoZW5BYm92ZVZpc2libGUoY20sIGxpbmUsIC1oZWlnaHQpO1xuICAgICAgcmVnTGluZUNoYW5nZShjbSwgbm8sIFwid2lkZ2V0XCIpO1xuICAgIH0pO1xuICB9O1xuICBMaW5lV2lkZ2V0LnByb3RvdHlwZS5jaGFuZ2VkID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIG9sZEggPSB0aGlzLmhlaWdodCwgY20gPSB0aGlzLmRvYy5jbSwgbGluZSA9IHRoaXMubGluZTtcbiAgICB0aGlzLmhlaWdodCA9IG51bGw7XG4gICAgdmFyIGRpZmYgPSB3aWRnZXRIZWlnaHQodGhpcykgLSBvbGRIO1xuICAgIGlmICghZGlmZikgcmV0dXJuO1xuICAgIHVwZGF0ZUxpbmVIZWlnaHQobGluZSwgbGluZS5oZWlnaHQgKyBkaWZmKTtcbiAgICBpZiAoY20pIHJ1bkluT3AoY20sIGZ1bmN0aW9uKCkge1xuICAgICAgY20uY3VyT3AuZm9yY2VVcGRhdGUgPSB0cnVlO1xuICAgICAgYWRqdXN0U2Nyb2xsV2hlbkFib3ZlVmlzaWJsZShjbSwgbGluZSwgZGlmZik7XG4gICAgfSk7XG4gIH07XG5cbiAgZnVuY3Rpb24gd2lkZ2V0SGVpZ2h0KHdpZGdldCkge1xuICAgIGlmICh3aWRnZXQuaGVpZ2h0ICE9IG51bGwpIHJldHVybiB3aWRnZXQuaGVpZ2h0O1xuICAgIHZhciBjbSA9IHdpZGdldC5kb2MuY207XG4gICAgaWYgKCFjbSkgcmV0dXJuIDA7XG4gICAgaWYgKCFjb250YWlucyhkb2N1bWVudC5ib2R5LCB3aWRnZXQubm9kZSkpIHtcbiAgICAgIHZhciBwYXJlbnRTdHlsZSA9IFwicG9zaXRpb246IHJlbGF0aXZlO1wiO1xuICAgICAgaWYgKHdpZGdldC5jb3Zlckd1dHRlcilcbiAgICAgICAgcGFyZW50U3R5bGUgKz0gXCJtYXJnaW4tbGVmdDogLVwiICsgY20uZGlzcGxheS5ndXR0ZXJzLm9mZnNldFdpZHRoICsgXCJweDtcIjtcbiAgICAgIGlmICh3aWRnZXQubm9IU2Nyb2xsKVxuICAgICAgICBwYXJlbnRTdHlsZSArPSBcIndpZHRoOiBcIiArIGNtLmRpc3BsYXkud3JhcHBlci5jbGllbnRXaWR0aCArIFwicHg7XCI7XG4gICAgICByZW1vdmVDaGlsZHJlbkFuZEFkZChjbS5kaXNwbGF5Lm1lYXN1cmUsIGVsdChcImRpdlwiLCBbd2lkZ2V0Lm5vZGVdLCBudWxsLCBwYXJlbnRTdHlsZSkpO1xuICAgIH1cbiAgICByZXR1cm4gd2lkZ2V0LmhlaWdodCA9IHdpZGdldC5ub2RlLm9mZnNldEhlaWdodDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGFkZExpbmVXaWRnZXQoZG9jLCBoYW5kbGUsIG5vZGUsIG9wdGlvbnMpIHtcbiAgICB2YXIgd2lkZ2V0ID0gbmV3IExpbmVXaWRnZXQoZG9jLCBub2RlLCBvcHRpb25zKTtcbiAgICB2YXIgY20gPSBkb2MuY207XG4gICAgaWYgKGNtICYmIHdpZGdldC5ub0hTY3JvbGwpIGNtLmRpc3BsYXkuYWxpZ25XaWRnZXRzID0gdHJ1ZTtcbiAgICBjaGFuZ2VMaW5lKGRvYywgaGFuZGxlLCBcIndpZGdldFwiLCBmdW5jdGlvbihsaW5lKSB7XG4gICAgICB2YXIgd2lkZ2V0cyA9IGxpbmUud2lkZ2V0cyB8fCAobGluZS53aWRnZXRzID0gW10pO1xuICAgICAgaWYgKHdpZGdldC5pbnNlcnRBdCA9PSBudWxsKSB3aWRnZXRzLnB1c2god2lkZ2V0KTtcbiAgICAgIGVsc2Ugd2lkZ2V0cy5zcGxpY2UoTWF0aC5taW4od2lkZ2V0cy5sZW5ndGggLSAxLCBNYXRoLm1heCgwLCB3aWRnZXQuaW5zZXJ0QXQpKSwgMCwgd2lkZ2V0KTtcbiAgICAgIHdpZGdldC5saW5lID0gbGluZTtcbiAgICAgIGlmIChjbSAmJiAhbGluZUlzSGlkZGVuKGRvYywgbGluZSkpIHtcbiAgICAgICAgdmFyIGFib3ZlVmlzaWJsZSA9IGhlaWdodEF0TGluZShsaW5lKSA8IGRvYy5zY3JvbGxUb3A7XG4gICAgICAgIHVwZGF0ZUxpbmVIZWlnaHQobGluZSwgbGluZS5oZWlnaHQgKyB3aWRnZXRIZWlnaHQod2lkZ2V0KSk7XG4gICAgICAgIGlmIChhYm92ZVZpc2libGUpIGFkZFRvU2Nyb2xsUG9zKGNtLCBudWxsLCB3aWRnZXQuaGVpZ2h0KTtcbiAgICAgICAgY20uY3VyT3AuZm9yY2VVcGRhdGUgPSB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG4gICAgcmV0dXJuIHdpZGdldDtcbiAgfVxuXG4gIC8vIExJTkUgREFUQSBTVFJVQ1RVUkVcblxuICAvLyBMaW5lIG9iamVjdHMuIFRoZXNlIGhvbGQgc3RhdGUgcmVsYXRlZCB0byBhIGxpbmUsIGluY2x1ZGluZ1xuICAvLyBoaWdobGlnaHRpbmcgaW5mbyAodGhlIHN0eWxlcyBhcnJheSkuXG4gIHZhciBMaW5lID0gQ29kZU1pcnJvci5MaW5lID0gZnVuY3Rpb24odGV4dCwgbWFya2VkU3BhbnMsIGVzdGltYXRlSGVpZ2h0KSB7XG4gICAgdGhpcy50ZXh0ID0gdGV4dDtcbiAgICBhdHRhY2hNYXJrZWRTcGFucyh0aGlzLCBtYXJrZWRTcGFucyk7XG4gICAgdGhpcy5oZWlnaHQgPSBlc3RpbWF0ZUhlaWdodCA/IGVzdGltYXRlSGVpZ2h0KHRoaXMpIDogMTtcbiAgfTtcbiAgZXZlbnRNaXhpbihMaW5lKTtcbiAgTGluZS5wcm90b3R5cGUubGluZU5vID0gZnVuY3Rpb24oKSB7IHJldHVybiBsaW5lTm8odGhpcyk7IH07XG5cbiAgLy8gQ2hhbmdlIHRoZSBjb250ZW50ICh0ZXh0LCBtYXJrZXJzKSBvZiBhIGxpbmUuIEF1dG9tYXRpY2FsbHlcbiAgLy8gaW52YWxpZGF0ZXMgY2FjaGVkIGluZm9ybWF0aW9uIGFuZCB0cmllcyB0byByZS1lc3RpbWF0ZSB0aGVcbiAgLy8gbGluZSdzIGhlaWdodC5cbiAgZnVuY3Rpb24gdXBkYXRlTGluZShsaW5lLCB0ZXh0LCBtYXJrZWRTcGFucywgZXN0aW1hdGVIZWlnaHQpIHtcbiAgICBsaW5lLnRleHQgPSB0ZXh0O1xuICAgIGlmIChsaW5lLnN0YXRlQWZ0ZXIpIGxpbmUuc3RhdGVBZnRlciA9IG51bGw7XG4gICAgaWYgKGxpbmUuc3R5bGVzKSBsaW5lLnN0eWxlcyA9IG51bGw7XG4gICAgaWYgKGxpbmUub3JkZXIgIT0gbnVsbCkgbGluZS5vcmRlciA9IG51bGw7XG4gICAgZGV0YWNoTWFya2VkU3BhbnMobGluZSk7XG4gICAgYXR0YWNoTWFya2VkU3BhbnMobGluZSwgbWFya2VkU3BhbnMpO1xuICAgIHZhciBlc3RIZWlnaHQgPSBlc3RpbWF0ZUhlaWdodCA/IGVzdGltYXRlSGVpZ2h0KGxpbmUpIDogMTtcbiAgICBpZiAoZXN0SGVpZ2h0ICE9IGxpbmUuaGVpZ2h0KSB1cGRhdGVMaW5lSGVpZ2h0KGxpbmUsIGVzdEhlaWdodCk7XG4gIH1cblxuICAvLyBEZXRhY2ggYSBsaW5lIGZyb20gdGhlIGRvY3VtZW50IHRyZWUgYW5kIGl0cyBtYXJrZXJzLlxuICBmdW5jdGlvbiBjbGVhblVwTGluZShsaW5lKSB7XG4gICAgbGluZS5wYXJlbnQgPSBudWxsO1xuICAgIGRldGFjaE1hcmtlZFNwYW5zKGxpbmUpO1xuICB9XG5cbiAgZnVuY3Rpb24gZXh0cmFjdExpbmVDbGFzc2VzKHR5cGUsIG91dHB1dCkge1xuICAgIGlmICh0eXBlKSBmb3IgKDs7KSB7XG4gICAgICB2YXIgbGluZUNsYXNzID0gdHlwZS5tYXRjaCgvKD86XnxcXHMrKWxpbmUtKGJhY2tncm91bmQtKT8oXFxTKykvKTtcbiAgICAgIGlmICghbGluZUNsYXNzKSBicmVhaztcbiAgICAgIHR5cGUgPSB0eXBlLnNsaWNlKDAsIGxpbmVDbGFzcy5pbmRleCkgKyB0eXBlLnNsaWNlKGxpbmVDbGFzcy5pbmRleCArIGxpbmVDbGFzc1swXS5sZW5ndGgpO1xuICAgICAgdmFyIHByb3AgPSBsaW5lQ2xhc3NbMV0gPyBcImJnQ2xhc3NcIiA6IFwidGV4dENsYXNzXCI7XG4gICAgICBpZiAob3V0cHV0W3Byb3BdID09IG51bGwpXG4gICAgICAgIG91dHB1dFtwcm9wXSA9IGxpbmVDbGFzc1syXTtcbiAgICAgIGVsc2UgaWYgKCEobmV3IFJlZ0V4cChcIig/Ol58XFxzKVwiICsgbGluZUNsYXNzWzJdICsgXCIoPzokfFxccylcIikpLnRlc3Qob3V0cHV0W3Byb3BdKSlcbiAgICAgICAgb3V0cHV0W3Byb3BdICs9IFwiIFwiICsgbGluZUNsYXNzWzJdO1xuICAgIH1cbiAgICByZXR1cm4gdHlwZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGNhbGxCbGFua0xpbmUobW9kZSwgc3RhdGUpIHtcbiAgICBpZiAobW9kZS5ibGFua0xpbmUpIHJldHVybiBtb2RlLmJsYW5rTGluZShzdGF0ZSk7XG4gICAgaWYgKCFtb2RlLmlubmVyTW9kZSkgcmV0dXJuO1xuICAgIHZhciBpbm5lciA9IENvZGVNaXJyb3IuaW5uZXJNb2RlKG1vZGUsIHN0YXRlKTtcbiAgICBpZiAoaW5uZXIubW9kZS5ibGFua0xpbmUpIHJldHVybiBpbm5lci5tb2RlLmJsYW5rTGluZShpbm5lci5zdGF0ZSk7XG4gIH1cblxuICBmdW5jdGlvbiByZWFkVG9rZW4obW9kZSwgc3RyZWFtLCBzdGF0ZSwgaW5uZXIpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDEwOyBpKyspIHtcbiAgICAgIGlmIChpbm5lcikgaW5uZXJbMF0gPSBDb2RlTWlycm9yLmlubmVyTW9kZShtb2RlLCBzdGF0ZSkubW9kZTtcbiAgICAgIHZhciBzdHlsZSA9IG1vZGUudG9rZW4oc3RyZWFtLCBzdGF0ZSk7XG4gICAgICBpZiAoc3RyZWFtLnBvcyA+IHN0cmVhbS5zdGFydCkgcmV0dXJuIHN0eWxlO1xuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJNb2RlIFwiICsgbW9kZS5uYW1lICsgXCIgZmFpbGVkIHRvIGFkdmFuY2Ugc3RyZWFtLlwiKTtcbiAgfVxuXG4gIC8vIFV0aWxpdHkgZm9yIGdldFRva2VuQXQgYW5kIGdldExpbmVUb2tlbnNcbiAgZnVuY3Rpb24gdGFrZVRva2VuKGNtLCBwb3MsIHByZWNpc2UsIGFzQXJyYXkpIHtcbiAgICBmdW5jdGlvbiBnZXRPYmooY29weSkge1xuICAgICAgcmV0dXJuIHtzdGFydDogc3RyZWFtLnN0YXJ0LCBlbmQ6IHN0cmVhbS5wb3MsXG4gICAgICAgICAgICAgIHN0cmluZzogc3RyZWFtLmN1cnJlbnQoKSxcbiAgICAgICAgICAgICAgdHlwZTogc3R5bGUgfHwgbnVsbCxcbiAgICAgICAgICAgICAgc3RhdGU6IGNvcHkgPyBjb3B5U3RhdGUoZG9jLm1vZGUsIHN0YXRlKSA6IHN0YXRlfTtcbiAgICB9XG5cbiAgICB2YXIgZG9jID0gY20uZG9jLCBtb2RlID0gZG9jLm1vZGUsIHN0eWxlO1xuICAgIHBvcyA9IGNsaXBQb3MoZG9jLCBwb3MpO1xuICAgIHZhciBsaW5lID0gZ2V0TGluZShkb2MsIHBvcy5saW5lKSwgc3RhdGUgPSBnZXRTdGF0ZUJlZm9yZShjbSwgcG9zLmxpbmUsIHByZWNpc2UpO1xuICAgIHZhciBzdHJlYW0gPSBuZXcgU3RyaW5nU3RyZWFtKGxpbmUudGV4dCwgY20ub3B0aW9ucy50YWJTaXplKSwgdG9rZW5zO1xuICAgIGlmIChhc0FycmF5KSB0b2tlbnMgPSBbXTtcbiAgICB3aGlsZSAoKGFzQXJyYXkgfHwgc3RyZWFtLnBvcyA8IHBvcy5jaCkgJiYgIXN0cmVhbS5lb2woKSkge1xuICAgICAgc3RyZWFtLnN0YXJ0ID0gc3RyZWFtLnBvcztcbiAgICAgIHN0eWxlID0gcmVhZFRva2VuKG1vZGUsIHN0cmVhbSwgc3RhdGUpO1xuICAgICAgaWYgKGFzQXJyYXkpIHRva2Vucy5wdXNoKGdldE9iaih0cnVlKSk7XG4gICAgfVxuICAgIHJldHVybiBhc0FycmF5ID8gdG9rZW5zIDogZ2V0T2JqKCk7XG4gIH1cblxuICAvLyBSdW4gdGhlIGdpdmVuIG1vZGUncyBwYXJzZXIgb3ZlciBhIGxpbmUsIGNhbGxpbmcgZiBmb3IgZWFjaCB0b2tlbi5cbiAgZnVuY3Rpb24gcnVuTW9kZShjbSwgdGV4dCwgbW9kZSwgc3RhdGUsIGYsIGxpbmVDbGFzc2VzLCBmb3JjZVRvRW5kKSB7XG4gICAgdmFyIGZsYXR0ZW5TcGFucyA9IG1vZGUuZmxhdHRlblNwYW5zO1xuICAgIGlmIChmbGF0dGVuU3BhbnMgPT0gbnVsbCkgZmxhdHRlblNwYW5zID0gY20ub3B0aW9ucy5mbGF0dGVuU3BhbnM7XG4gICAgdmFyIGN1clN0YXJ0ID0gMCwgY3VyU3R5bGUgPSBudWxsO1xuICAgIHZhciBzdHJlYW0gPSBuZXcgU3RyaW5nU3RyZWFtKHRleHQsIGNtLm9wdGlvbnMudGFiU2l6ZSksIHN0eWxlO1xuICAgIHZhciBpbm5lciA9IGNtLm9wdGlvbnMuYWRkTW9kZUNsYXNzICYmIFtudWxsXTtcbiAgICBpZiAodGV4dCA9PSBcIlwiKSBleHRyYWN0TGluZUNsYXNzZXMoY2FsbEJsYW5rTGluZShtb2RlLCBzdGF0ZSksIGxpbmVDbGFzc2VzKTtcbiAgICB3aGlsZSAoIXN0cmVhbS5lb2woKSkge1xuICAgICAgaWYgKHN0cmVhbS5wb3MgPiBjbS5vcHRpb25zLm1heEhpZ2hsaWdodExlbmd0aCkge1xuICAgICAgICBmbGF0dGVuU3BhbnMgPSBmYWxzZTtcbiAgICAgICAgaWYgKGZvcmNlVG9FbmQpIHByb2Nlc3NMaW5lKGNtLCB0ZXh0LCBzdGF0ZSwgc3RyZWFtLnBvcyk7XG4gICAgICAgIHN0cmVhbS5wb3MgPSB0ZXh0Lmxlbmd0aDtcbiAgICAgICAgc3R5bGUgPSBudWxsO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc3R5bGUgPSBleHRyYWN0TGluZUNsYXNzZXMocmVhZFRva2VuKG1vZGUsIHN0cmVhbSwgc3RhdGUsIGlubmVyKSwgbGluZUNsYXNzZXMpO1xuICAgICAgfVxuICAgICAgaWYgKGlubmVyKSB7XG4gICAgICAgIHZhciBtTmFtZSA9IGlubmVyWzBdLm5hbWU7XG4gICAgICAgIGlmIChtTmFtZSkgc3R5bGUgPSBcIm0tXCIgKyAoc3R5bGUgPyBtTmFtZSArIFwiIFwiICsgc3R5bGUgOiBtTmFtZSk7XG4gICAgICB9XG4gICAgICBpZiAoIWZsYXR0ZW5TcGFucyB8fCBjdXJTdHlsZSAhPSBzdHlsZSkge1xuICAgICAgICB3aGlsZSAoY3VyU3RhcnQgPCBzdHJlYW0uc3RhcnQpIHtcbiAgICAgICAgICBjdXJTdGFydCA9IE1hdGgubWluKHN0cmVhbS5zdGFydCwgY3VyU3RhcnQgKyA1MDAwMCk7XG4gICAgICAgICAgZihjdXJTdGFydCwgY3VyU3R5bGUpO1xuICAgICAgICB9XG4gICAgICAgIGN1clN0eWxlID0gc3R5bGU7XG4gICAgICB9XG4gICAgICBzdHJlYW0uc3RhcnQgPSBzdHJlYW0ucG9zO1xuICAgIH1cbiAgICB3aGlsZSAoY3VyU3RhcnQgPCBzdHJlYW0ucG9zKSB7XG4gICAgICAvLyBXZWJraXQgc2VlbXMgdG8gcmVmdXNlIHRvIHJlbmRlciB0ZXh0IG5vZGVzIGxvbmdlciB0aGFuIDU3NDQ0IGNoYXJhY3RlcnNcbiAgICAgIHZhciBwb3MgPSBNYXRoLm1pbihzdHJlYW0ucG9zLCBjdXJTdGFydCArIDUwMDAwKTtcbiAgICAgIGYocG9zLCBjdXJTdHlsZSk7XG4gICAgICBjdXJTdGFydCA9IHBvcztcbiAgICB9XG4gIH1cblxuICAvLyBDb21wdXRlIGEgc3R5bGUgYXJyYXkgKGFuIGFycmF5IHN0YXJ0aW5nIHdpdGggYSBtb2RlIGdlbmVyYXRpb25cbiAgLy8gLS0gZm9yIGludmFsaWRhdGlvbiAtLSBmb2xsb3dlZCBieSBwYWlycyBvZiBlbmQgcG9zaXRpb25zIGFuZFxuICAvLyBzdHlsZSBzdHJpbmdzKSwgd2hpY2ggaXMgdXNlZCB0byBoaWdobGlnaHQgdGhlIHRva2VucyBvbiB0aGVcbiAgLy8gbGluZS5cbiAgZnVuY3Rpb24gaGlnaGxpZ2h0TGluZShjbSwgbGluZSwgc3RhdGUsIGZvcmNlVG9FbmQpIHtcbiAgICAvLyBBIHN0eWxlcyBhcnJheSBhbHdheXMgc3RhcnRzIHdpdGggYSBudW1iZXIgaWRlbnRpZnlpbmcgdGhlXG4gICAgLy8gbW9kZS9vdmVybGF5cyB0aGF0IGl0IGlzIGJhc2VkIG9uIChmb3IgZWFzeSBpbnZhbGlkYXRpb24pLlxuICAgIHZhciBzdCA9IFtjbS5zdGF0ZS5tb2RlR2VuXSwgbGluZUNsYXNzZXMgPSB7fTtcbiAgICAvLyBDb21wdXRlIHRoZSBiYXNlIGFycmF5IG9mIHN0eWxlc1xuICAgIHJ1bk1vZGUoY20sIGxpbmUudGV4dCwgY20uZG9jLm1vZGUsIHN0YXRlLCBmdW5jdGlvbihlbmQsIHN0eWxlKSB7XG4gICAgICBzdC5wdXNoKGVuZCwgc3R5bGUpO1xuICAgIH0sIGxpbmVDbGFzc2VzLCBmb3JjZVRvRW5kKTtcblxuICAgIC8vIFJ1biBvdmVybGF5cywgYWRqdXN0IHN0eWxlIGFycmF5LlxuICAgIGZvciAodmFyIG8gPSAwOyBvIDwgY20uc3RhdGUub3ZlcmxheXMubGVuZ3RoOyArK28pIHtcbiAgICAgIHZhciBvdmVybGF5ID0gY20uc3RhdGUub3ZlcmxheXNbb10sIGkgPSAxLCBhdCA9IDA7XG4gICAgICBydW5Nb2RlKGNtLCBsaW5lLnRleHQsIG92ZXJsYXkubW9kZSwgdHJ1ZSwgZnVuY3Rpb24oZW5kLCBzdHlsZSkge1xuICAgICAgICB2YXIgc3RhcnQgPSBpO1xuICAgICAgICAvLyBFbnN1cmUgdGhlcmUncyBhIHRva2VuIGVuZCBhdCB0aGUgY3VycmVudCBwb3NpdGlvbiwgYW5kIHRoYXQgaSBwb2ludHMgYXQgaXRcbiAgICAgICAgd2hpbGUgKGF0IDwgZW5kKSB7XG4gICAgICAgICAgdmFyIGlfZW5kID0gc3RbaV07XG4gICAgICAgICAgaWYgKGlfZW5kID4gZW5kKVxuICAgICAgICAgICAgc3Quc3BsaWNlKGksIDEsIGVuZCwgc3RbaSsxXSwgaV9lbmQpO1xuICAgICAgICAgIGkgKz0gMjtcbiAgICAgICAgICBhdCA9IE1hdGgubWluKGVuZCwgaV9lbmQpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghc3R5bGUpIHJldHVybjtcbiAgICAgICAgaWYgKG92ZXJsYXkub3BhcXVlKSB7XG4gICAgICAgICAgc3Quc3BsaWNlKHN0YXJ0LCBpIC0gc3RhcnQsIGVuZCwgXCJjbS1vdmVybGF5IFwiICsgc3R5bGUpO1xuICAgICAgICAgIGkgPSBzdGFydCArIDI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZm9yICg7IHN0YXJ0IDwgaTsgc3RhcnQgKz0gMikge1xuICAgICAgICAgICAgdmFyIGN1ciA9IHN0W3N0YXJ0KzFdO1xuICAgICAgICAgICAgc3Rbc3RhcnQrMV0gPSAoY3VyID8gY3VyICsgXCIgXCIgOiBcIlwiKSArIFwiY20tb3ZlcmxheSBcIiArIHN0eWxlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSwgbGluZUNsYXNzZXMpO1xuICAgIH1cblxuICAgIHJldHVybiB7c3R5bGVzOiBzdCwgY2xhc3NlczogbGluZUNsYXNzZXMuYmdDbGFzcyB8fCBsaW5lQ2xhc3Nlcy50ZXh0Q2xhc3MgPyBsaW5lQ2xhc3NlcyA6IG51bGx9O1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0TGluZVN0eWxlcyhjbSwgbGluZSwgdXBkYXRlRnJvbnRpZXIpIHtcbiAgICBpZiAoIWxpbmUuc3R5bGVzIHx8IGxpbmUuc3R5bGVzWzBdICE9IGNtLnN0YXRlLm1vZGVHZW4pIHtcbiAgICAgIHZhciBzdGF0ZSA9IGdldFN0YXRlQmVmb3JlKGNtLCBsaW5lTm8obGluZSkpO1xuICAgICAgdmFyIHJlc3VsdCA9IGhpZ2hsaWdodExpbmUoY20sIGxpbmUsIGxpbmUudGV4dC5sZW5ndGggPiBjbS5vcHRpb25zLm1heEhpZ2hsaWdodExlbmd0aCA/IGNvcHlTdGF0ZShjbS5kb2MubW9kZSwgc3RhdGUpIDogc3RhdGUpO1xuICAgICAgbGluZS5zdGF0ZUFmdGVyID0gc3RhdGU7XG4gICAgICBsaW5lLnN0eWxlcyA9IHJlc3VsdC5zdHlsZXM7XG4gICAgICBpZiAocmVzdWx0LmNsYXNzZXMpIGxpbmUuc3R5bGVDbGFzc2VzID0gcmVzdWx0LmNsYXNzZXM7XG4gICAgICBlbHNlIGlmIChsaW5lLnN0eWxlQ2xhc3NlcykgbGluZS5zdHlsZUNsYXNzZXMgPSBudWxsO1xuICAgICAgaWYgKHVwZGF0ZUZyb250aWVyID09PSBjbS5kb2MuZnJvbnRpZXIpIGNtLmRvYy5mcm9udGllcisrO1xuICAgIH1cbiAgICByZXR1cm4gbGluZS5zdHlsZXM7XG4gIH1cblxuICAvLyBMaWdodHdlaWdodCBmb3JtIG9mIGhpZ2hsaWdodCAtLSBwcm9jZWVkIG92ZXIgdGhpcyBsaW5lIGFuZFxuICAvLyB1cGRhdGUgc3RhdGUsIGJ1dCBkb24ndCBzYXZlIGEgc3R5bGUgYXJyYXkuIFVzZWQgZm9yIGxpbmVzIHRoYXRcbiAgLy8gYXJlbid0IGN1cnJlbnRseSB2aXNpYmxlLlxuICBmdW5jdGlvbiBwcm9jZXNzTGluZShjbSwgdGV4dCwgc3RhdGUsIHN0YXJ0QXQpIHtcbiAgICB2YXIgbW9kZSA9IGNtLmRvYy5tb2RlO1xuICAgIHZhciBzdHJlYW0gPSBuZXcgU3RyaW5nU3RyZWFtKHRleHQsIGNtLm9wdGlvbnMudGFiU2l6ZSk7XG4gICAgc3RyZWFtLnN0YXJ0ID0gc3RyZWFtLnBvcyA9IHN0YXJ0QXQgfHwgMDtcbiAgICBpZiAodGV4dCA9PSBcIlwiKSBjYWxsQmxhbmtMaW5lKG1vZGUsIHN0YXRlKTtcbiAgICB3aGlsZSAoIXN0cmVhbS5lb2woKSkge1xuICAgICAgcmVhZFRva2VuKG1vZGUsIHN0cmVhbSwgc3RhdGUpO1xuICAgICAgc3RyZWFtLnN0YXJ0ID0gc3RyZWFtLnBvcztcbiAgICB9XG4gIH1cblxuICAvLyBDb252ZXJ0IGEgc3R5bGUgYXMgcmV0dXJuZWQgYnkgYSBtb2RlIChlaXRoZXIgbnVsbCwgb3IgYSBzdHJpbmdcbiAgLy8gY29udGFpbmluZyBvbmUgb3IgbW9yZSBzdHlsZXMpIHRvIGEgQ1NTIHN0eWxlLiBUaGlzIGlzIGNhY2hlZCxcbiAgLy8gYW5kIGFsc28gbG9va3MgZm9yIGxpbmUtd2lkZSBzdHlsZXMuXG4gIHZhciBzdHlsZVRvQ2xhc3NDYWNoZSA9IHt9LCBzdHlsZVRvQ2xhc3NDYWNoZVdpdGhNb2RlID0ge307XG4gIGZ1bmN0aW9uIGludGVycHJldFRva2VuU3R5bGUoc3R5bGUsIG9wdGlvbnMpIHtcbiAgICBpZiAoIXN0eWxlIHx8IC9eXFxzKiQvLnRlc3Qoc3R5bGUpKSByZXR1cm4gbnVsbDtcbiAgICB2YXIgY2FjaGUgPSBvcHRpb25zLmFkZE1vZGVDbGFzcyA/IHN0eWxlVG9DbGFzc0NhY2hlV2l0aE1vZGUgOiBzdHlsZVRvQ2xhc3NDYWNoZTtcbiAgICByZXR1cm4gY2FjaGVbc3R5bGVdIHx8XG4gICAgICAoY2FjaGVbc3R5bGVdID0gc3R5bGUucmVwbGFjZSgvXFxTKy9nLCBcImNtLSQmXCIpKTtcbiAgfVxuXG4gIC8vIFJlbmRlciB0aGUgRE9NIHJlcHJlc2VudGF0aW9uIG9mIHRoZSB0ZXh0IG9mIGEgbGluZS4gQWxzbyBidWlsZHNcbiAgLy8gdXAgYSAnbGluZSBtYXAnLCB3aGljaCBwb2ludHMgYXQgdGhlIERPTSBub2RlcyB0aGF0IHJlcHJlc2VudFxuICAvLyBzcGVjaWZpYyBzdHJldGNoZXMgb2YgdGV4dCwgYW5kIGlzIHVzZWQgYnkgdGhlIG1lYXN1cmluZyBjb2RlLlxuICAvLyBUaGUgcmV0dXJuZWQgb2JqZWN0IGNvbnRhaW5zIHRoZSBET00gbm9kZSwgdGhpcyBtYXAsIGFuZFxuICAvLyBpbmZvcm1hdGlvbiBhYm91dCBsaW5lLXdpZGUgc3R5bGVzIHRoYXQgd2VyZSBzZXQgYnkgdGhlIG1vZGUuXG4gIGZ1bmN0aW9uIGJ1aWxkTGluZUNvbnRlbnQoY20sIGxpbmVWaWV3KSB7XG4gICAgLy8gVGhlIHBhZGRpbmctcmlnaHQgZm9yY2VzIHRoZSBlbGVtZW50IHRvIGhhdmUgYSAnYm9yZGVyJywgd2hpY2hcbiAgICAvLyBpcyBuZWVkZWQgb24gV2Via2l0IHRvIGJlIGFibGUgdG8gZ2V0IGxpbmUtbGV2ZWwgYm91bmRpbmdcbiAgICAvLyByZWN0YW5nbGVzIGZvciBpdCAoaW4gbWVhc3VyZUNoYXIpLlxuICAgIHZhciBjb250ZW50ID0gZWx0KFwic3BhblwiLCBudWxsLCBudWxsLCB3ZWJraXQgPyBcInBhZGRpbmctcmlnaHQ6IC4xcHhcIiA6IG51bGwpO1xuICAgIHZhciBidWlsZGVyID0ge3ByZTogZWx0KFwicHJlXCIsIFtjb250ZW50XSwgXCJDb2RlTWlycm9yLWxpbmVcIiksIGNvbnRlbnQ6IGNvbnRlbnQsXG4gICAgICAgICAgICAgICAgICAgY29sOiAwLCBwb3M6IDAsIGNtOiBjbSxcbiAgICAgICAgICAgICAgICAgICBzcGxpdFNwYWNlczogKGllIHx8IHdlYmtpdCkgJiYgY20uZ2V0T3B0aW9uKFwibGluZVdyYXBwaW5nXCIpfTtcbiAgICBsaW5lVmlldy5tZWFzdXJlID0ge307XG5cbiAgICAvLyBJdGVyYXRlIG92ZXIgdGhlIGxvZ2ljYWwgbGluZXMgdGhhdCBtYWtlIHVwIHRoaXMgdmlzdWFsIGxpbmUuXG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPD0gKGxpbmVWaWV3LnJlc3QgPyBsaW5lVmlldy5yZXN0Lmxlbmd0aCA6IDApOyBpKyspIHtcbiAgICAgIHZhciBsaW5lID0gaSA/IGxpbmVWaWV3LnJlc3RbaSAtIDFdIDogbGluZVZpZXcubGluZSwgb3JkZXI7XG4gICAgICBidWlsZGVyLnBvcyA9IDA7XG4gICAgICBidWlsZGVyLmFkZFRva2VuID0gYnVpbGRUb2tlbjtcbiAgICAgIC8vIE9wdGlvbmFsbHkgd2lyZSBpbiBzb21lIGhhY2tzIGludG8gdGhlIHRva2VuLXJlbmRlcmluZ1xuICAgICAgLy8gYWxnb3JpdGhtLCB0byBkZWFsIHdpdGggYnJvd3NlciBxdWlya3MuXG4gICAgICBpZiAoaGFzQmFkQmlkaVJlY3RzKGNtLmRpc3BsYXkubWVhc3VyZSkgJiYgKG9yZGVyID0gZ2V0T3JkZXIobGluZSkpKVxuICAgICAgICBidWlsZGVyLmFkZFRva2VuID0gYnVpbGRUb2tlbkJhZEJpZGkoYnVpbGRlci5hZGRUb2tlbiwgb3JkZXIpO1xuICAgICAgYnVpbGRlci5tYXAgPSBbXTtcbiAgICAgIHZhciBhbGxvd0Zyb250aWVyVXBkYXRlID0gbGluZVZpZXcgIT0gY20uZGlzcGxheS5leHRlcm5hbE1lYXN1cmVkICYmIGxpbmVObyhsaW5lKTtcbiAgICAgIGluc2VydExpbmVDb250ZW50KGxpbmUsIGJ1aWxkZXIsIGdldExpbmVTdHlsZXMoY20sIGxpbmUsIGFsbG93RnJvbnRpZXJVcGRhdGUpKTtcbiAgICAgIGlmIChsaW5lLnN0eWxlQ2xhc3Nlcykge1xuICAgICAgICBpZiAobGluZS5zdHlsZUNsYXNzZXMuYmdDbGFzcylcbiAgICAgICAgICBidWlsZGVyLmJnQ2xhc3MgPSBqb2luQ2xhc3NlcyhsaW5lLnN0eWxlQ2xhc3Nlcy5iZ0NsYXNzLCBidWlsZGVyLmJnQ2xhc3MgfHwgXCJcIik7XG4gICAgICAgIGlmIChsaW5lLnN0eWxlQ2xhc3Nlcy50ZXh0Q2xhc3MpXG4gICAgICAgICAgYnVpbGRlci50ZXh0Q2xhc3MgPSBqb2luQ2xhc3NlcyhsaW5lLnN0eWxlQ2xhc3Nlcy50ZXh0Q2xhc3MsIGJ1aWxkZXIudGV4dENsYXNzIHx8IFwiXCIpO1xuICAgICAgfVxuXG4gICAgICAvLyBFbnN1cmUgYXQgbGVhc3QgYSBzaW5nbGUgbm9kZSBpcyBwcmVzZW50LCBmb3IgbWVhc3VyaW5nLlxuICAgICAgaWYgKGJ1aWxkZXIubWFwLmxlbmd0aCA9PSAwKVxuICAgICAgICBidWlsZGVyLm1hcC5wdXNoKDAsIDAsIGJ1aWxkZXIuY29udGVudC5hcHBlbmRDaGlsZCh6ZXJvV2lkdGhFbGVtZW50KGNtLmRpc3BsYXkubWVhc3VyZSkpKTtcblxuICAgICAgLy8gU3RvcmUgdGhlIG1hcCBhbmQgYSBjYWNoZSBvYmplY3QgZm9yIHRoZSBjdXJyZW50IGxvZ2ljYWwgbGluZVxuICAgICAgaWYgKGkgPT0gMCkge1xuICAgICAgICBsaW5lVmlldy5tZWFzdXJlLm1hcCA9IGJ1aWxkZXIubWFwO1xuICAgICAgICBsaW5lVmlldy5tZWFzdXJlLmNhY2hlID0ge307XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAobGluZVZpZXcubWVhc3VyZS5tYXBzIHx8IChsaW5lVmlldy5tZWFzdXJlLm1hcHMgPSBbXSkpLnB1c2goYnVpbGRlci5tYXApO1xuICAgICAgICAobGluZVZpZXcubWVhc3VyZS5jYWNoZXMgfHwgKGxpbmVWaWV3Lm1lYXN1cmUuY2FjaGVzID0gW10pKS5wdXNoKHt9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTZWUgaXNzdWUgIzI5MDFcbiAgICBpZiAod2Via2l0ICYmIC9cXGJjbS10YWJcXGIvLnRlc3QoYnVpbGRlci5jb250ZW50Lmxhc3RDaGlsZC5jbGFzc05hbWUpKVxuICAgICAgYnVpbGRlci5jb250ZW50LmNsYXNzTmFtZSA9IFwiY20tdGFiLXdyYXAtaGFja1wiO1xuXG4gICAgc2lnbmFsKGNtLCBcInJlbmRlckxpbmVcIiwgY20sIGxpbmVWaWV3LmxpbmUsIGJ1aWxkZXIucHJlKTtcbiAgICBpZiAoYnVpbGRlci5wcmUuY2xhc3NOYW1lKVxuICAgICAgYnVpbGRlci50ZXh0Q2xhc3MgPSBqb2luQ2xhc3NlcyhidWlsZGVyLnByZS5jbGFzc05hbWUsIGJ1aWxkZXIudGV4dENsYXNzIHx8IFwiXCIpO1xuXG4gICAgcmV0dXJuIGJ1aWxkZXI7XG4gIH1cblxuICBmdW5jdGlvbiBkZWZhdWx0U3BlY2lhbENoYXJQbGFjZWhvbGRlcihjaCkge1xuICAgIHZhciB0b2tlbiA9IGVsdChcInNwYW5cIiwgXCJcXHUyMDIyXCIsIFwiY20taW52YWxpZGNoYXJcIik7XG4gICAgdG9rZW4udGl0bGUgPSBcIlxcXFx1XCIgKyBjaC5jaGFyQ29kZUF0KDApLnRvU3RyaW5nKDE2KTtcbiAgICB0b2tlbi5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIHRva2VuLnRpdGxlKTtcbiAgICByZXR1cm4gdG9rZW47XG4gIH1cblxuICAvLyBCdWlsZCB1cCB0aGUgRE9NIHJlcHJlc2VudGF0aW9uIGZvciBhIHNpbmdsZSB0b2tlbiwgYW5kIGFkZCBpdCB0b1xuICAvLyB0aGUgbGluZSBtYXAuIFRha2VzIGNhcmUgdG8gcmVuZGVyIHNwZWNpYWwgY2hhcmFjdGVycyBzZXBhcmF0ZWx5LlxuICBmdW5jdGlvbiBidWlsZFRva2VuKGJ1aWxkZXIsIHRleHQsIHN0eWxlLCBzdGFydFN0eWxlLCBlbmRTdHlsZSwgdGl0bGUsIGNzcykge1xuICAgIGlmICghdGV4dCkgcmV0dXJuO1xuICAgIHZhciBkaXNwbGF5VGV4dCA9IGJ1aWxkZXIuc3BsaXRTcGFjZXMgPyB0ZXh0LnJlcGxhY2UoLyB7Myx9L2csIHNwbGl0U3BhY2VzKSA6IHRleHQ7XG4gICAgdmFyIHNwZWNpYWwgPSBidWlsZGVyLmNtLnN0YXRlLnNwZWNpYWxDaGFycywgbXVzdFdyYXAgPSBmYWxzZTtcbiAgICBpZiAoIXNwZWNpYWwudGVzdCh0ZXh0KSkge1xuICAgICAgYnVpbGRlci5jb2wgKz0gdGV4dC5sZW5ndGg7XG4gICAgICB2YXIgY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGRpc3BsYXlUZXh0KTtcbiAgICAgIGJ1aWxkZXIubWFwLnB1c2goYnVpbGRlci5wb3MsIGJ1aWxkZXIucG9zICsgdGV4dC5sZW5ndGgsIGNvbnRlbnQpO1xuICAgICAgaWYgKGllICYmIGllX3ZlcnNpb24gPCA5KSBtdXN0V3JhcCA9IHRydWU7XG4gICAgICBidWlsZGVyLnBvcyArPSB0ZXh0Lmxlbmd0aDtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGNvbnRlbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksIHBvcyA9IDA7XG4gICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICBzcGVjaWFsLmxhc3RJbmRleCA9IHBvcztcbiAgICAgICAgdmFyIG0gPSBzcGVjaWFsLmV4ZWModGV4dCk7XG4gICAgICAgIHZhciBza2lwcGVkID0gbSA/IG0uaW5kZXggLSBwb3MgOiB0ZXh0Lmxlbmd0aCAtIHBvcztcbiAgICAgICAgaWYgKHNraXBwZWQpIHtcbiAgICAgICAgICB2YXIgdHh0ID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZGlzcGxheVRleHQuc2xpY2UocG9zLCBwb3MgKyBza2lwcGVkKSk7XG4gICAgICAgICAgaWYgKGllICYmIGllX3ZlcnNpb24gPCA5KSBjb250ZW50LmFwcGVuZENoaWxkKGVsdChcInNwYW5cIiwgW3R4dF0pKTtcbiAgICAgICAgICBlbHNlIGNvbnRlbnQuYXBwZW5kQ2hpbGQodHh0KTtcbiAgICAgICAgICBidWlsZGVyLm1hcC5wdXNoKGJ1aWxkZXIucG9zLCBidWlsZGVyLnBvcyArIHNraXBwZWQsIHR4dCk7XG4gICAgICAgICAgYnVpbGRlci5jb2wgKz0gc2tpcHBlZDtcbiAgICAgICAgICBidWlsZGVyLnBvcyArPSBza2lwcGVkO1xuICAgICAgICB9XG4gICAgICAgIGlmICghbSkgYnJlYWs7XG4gICAgICAgIHBvcyArPSBza2lwcGVkICsgMTtcbiAgICAgICAgaWYgKG1bMF0gPT0gXCJcXHRcIikge1xuICAgICAgICAgIHZhciB0YWJTaXplID0gYnVpbGRlci5jbS5vcHRpb25zLnRhYlNpemUsIHRhYldpZHRoID0gdGFiU2l6ZSAtIGJ1aWxkZXIuY29sICUgdGFiU2l6ZTtcbiAgICAgICAgICB2YXIgdHh0ID0gY29udGVudC5hcHBlbmRDaGlsZChlbHQoXCJzcGFuXCIsIHNwYWNlU3RyKHRhYldpZHRoKSwgXCJjbS10YWJcIikpO1xuICAgICAgICAgIHR4dC5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwicHJlc2VudGF0aW9uXCIpO1xuICAgICAgICAgIHR4dC5zZXRBdHRyaWJ1dGUoXCJjbS10ZXh0XCIsIFwiXFx0XCIpO1xuICAgICAgICAgIGJ1aWxkZXIuY29sICs9IHRhYldpZHRoO1xuICAgICAgICB9IGVsc2UgaWYgKG1bMF0gPT0gXCJcXHJcIiB8fCBtWzBdID09IFwiXFxuXCIpIHtcbiAgICAgICAgICB2YXIgdHh0ID0gY29udGVudC5hcHBlbmRDaGlsZChlbHQoXCJzcGFuXCIsIG1bMF0gPT0gXCJcXHJcIiA/IFwiXFx1MjQwZFwiIDogXCJcXHUyNDI0XCIsIFwiY20taW52YWxpZGNoYXJcIikpO1xuICAgICAgICAgIHR4dC5zZXRBdHRyaWJ1dGUoXCJjbS10ZXh0XCIsIG1bMF0pO1xuICAgICAgICAgIGJ1aWxkZXIuY29sICs9IDE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIHR4dCA9IGJ1aWxkZXIuY20ub3B0aW9ucy5zcGVjaWFsQ2hhclBsYWNlaG9sZGVyKG1bMF0pO1xuICAgICAgICAgIHR4dC5zZXRBdHRyaWJ1dGUoXCJjbS10ZXh0XCIsIG1bMF0pO1xuICAgICAgICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uIDwgOSkgY29udGVudC5hcHBlbmRDaGlsZChlbHQoXCJzcGFuXCIsIFt0eHRdKSk7XG4gICAgICAgICAgZWxzZSBjb250ZW50LmFwcGVuZENoaWxkKHR4dCk7XG4gICAgICAgICAgYnVpbGRlci5jb2wgKz0gMTtcbiAgICAgICAgfVxuICAgICAgICBidWlsZGVyLm1hcC5wdXNoKGJ1aWxkZXIucG9zLCBidWlsZGVyLnBvcyArIDEsIHR4dCk7XG4gICAgICAgIGJ1aWxkZXIucG9zKys7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChzdHlsZSB8fCBzdGFydFN0eWxlIHx8IGVuZFN0eWxlIHx8IG11c3RXcmFwIHx8IGNzcykge1xuICAgICAgdmFyIGZ1bGxTdHlsZSA9IHN0eWxlIHx8IFwiXCI7XG4gICAgICBpZiAoc3RhcnRTdHlsZSkgZnVsbFN0eWxlICs9IHN0YXJ0U3R5bGU7XG4gICAgICBpZiAoZW5kU3R5bGUpIGZ1bGxTdHlsZSArPSBlbmRTdHlsZTtcbiAgICAgIHZhciB0b2tlbiA9IGVsdChcInNwYW5cIiwgW2NvbnRlbnRdLCBmdWxsU3R5bGUsIGNzcyk7XG4gICAgICBpZiAodGl0bGUpIHRva2VuLnRpdGxlID0gdGl0bGU7XG4gICAgICByZXR1cm4gYnVpbGRlci5jb250ZW50LmFwcGVuZENoaWxkKHRva2VuKTtcbiAgICB9XG4gICAgYnVpbGRlci5jb250ZW50LmFwcGVuZENoaWxkKGNvbnRlbnQpO1xuICB9XG5cbiAgZnVuY3Rpb24gc3BsaXRTcGFjZXMob2xkKSB7XG4gICAgdmFyIG91dCA9IFwiIFwiO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2xkLmxlbmd0aCAtIDI7ICsraSkgb3V0ICs9IGkgJSAyID8gXCIgXCIgOiBcIlxcdTAwYTBcIjtcbiAgICBvdXQgKz0gXCIgXCI7XG4gICAgcmV0dXJuIG91dDtcbiAgfVxuXG4gIC8vIFdvcmsgYXJvdW5kIG5vbnNlbnNlIGRpbWVuc2lvbnMgYmVpbmcgcmVwb3J0ZWQgZm9yIHN0cmV0Y2hlcyBvZlxuICAvLyByaWdodC10by1sZWZ0IHRleHQuXG4gIGZ1bmN0aW9uIGJ1aWxkVG9rZW5CYWRCaWRpKGlubmVyLCBvcmRlcikge1xuICAgIHJldHVybiBmdW5jdGlvbihidWlsZGVyLCB0ZXh0LCBzdHlsZSwgc3RhcnRTdHlsZSwgZW5kU3R5bGUsIHRpdGxlLCBjc3MpIHtcbiAgICAgIHN0eWxlID0gc3R5bGUgPyBzdHlsZSArIFwiIGNtLWZvcmNlLWJvcmRlclwiIDogXCJjbS1mb3JjZS1ib3JkZXJcIjtcbiAgICAgIHZhciBzdGFydCA9IGJ1aWxkZXIucG9zLCBlbmQgPSBzdGFydCArIHRleHQubGVuZ3RoO1xuICAgICAgZm9yICg7Oykge1xuICAgICAgICAvLyBGaW5kIHRoZSBwYXJ0IHRoYXQgb3ZlcmxhcHMgd2l0aCB0aGUgc3RhcnQgb2YgdGhpcyB0ZXh0XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3JkZXIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICB2YXIgcGFydCA9IG9yZGVyW2ldO1xuICAgICAgICAgIGlmIChwYXJ0LnRvID4gc3RhcnQgJiYgcGFydC5mcm9tIDw9IHN0YXJ0KSBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBpZiAocGFydC50byA+PSBlbmQpIHJldHVybiBpbm5lcihidWlsZGVyLCB0ZXh0LCBzdHlsZSwgc3RhcnRTdHlsZSwgZW5kU3R5bGUsIHRpdGxlLCBjc3MpO1xuICAgICAgICBpbm5lcihidWlsZGVyLCB0ZXh0LnNsaWNlKDAsIHBhcnQudG8gLSBzdGFydCksIHN0eWxlLCBzdGFydFN0eWxlLCBudWxsLCB0aXRsZSwgY3NzKTtcbiAgICAgICAgc3RhcnRTdHlsZSA9IG51bGw7XG4gICAgICAgIHRleHQgPSB0ZXh0LnNsaWNlKHBhcnQudG8gLSBzdGFydCk7XG4gICAgICAgIHN0YXJ0ID0gcGFydC50bztcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgZnVuY3Rpb24gYnVpbGRDb2xsYXBzZWRTcGFuKGJ1aWxkZXIsIHNpemUsIG1hcmtlciwgaWdub3JlV2lkZ2V0KSB7XG4gICAgdmFyIHdpZGdldCA9ICFpZ25vcmVXaWRnZXQgJiYgbWFya2VyLndpZGdldE5vZGU7XG4gICAgaWYgKHdpZGdldCkgYnVpbGRlci5tYXAucHVzaChidWlsZGVyLnBvcywgYnVpbGRlci5wb3MgKyBzaXplLCB3aWRnZXQpO1xuICAgIGlmICghaWdub3JlV2lkZ2V0ICYmIGJ1aWxkZXIuY20uZGlzcGxheS5pbnB1dC5uZWVkc0NvbnRlbnRBdHRyaWJ1dGUpIHtcbiAgICAgIGlmICghd2lkZ2V0KVxuICAgICAgICB3aWRnZXQgPSBidWlsZGVyLmNvbnRlbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcInNwYW5cIikpO1xuICAgICAgd2lkZ2V0LnNldEF0dHJpYnV0ZShcImNtLW1hcmtlclwiLCBtYXJrZXIuaWQpO1xuICAgIH1cbiAgICBpZiAod2lkZ2V0KSB7XG4gICAgICBidWlsZGVyLmNtLmRpc3BsYXkuaW5wdXQuc2V0VW5lZGl0YWJsZSh3aWRnZXQpO1xuICAgICAgYnVpbGRlci5jb250ZW50LmFwcGVuZENoaWxkKHdpZGdldCk7XG4gICAgfVxuICAgIGJ1aWxkZXIucG9zICs9IHNpemU7XG4gIH1cblxuICAvLyBPdXRwdXRzIGEgbnVtYmVyIG9mIHNwYW5zIHRvIG1ha2UgdXAgYSBsaW5lLCB0YWtpbmcgaGlnaGxpZ2h0aW5nXG4gIC8vIGFuZCBtYXJrZWQgdGV4dCBpbnRvIGFjY291bnQuXG4gIGZ1bmN0aW9uIGluc2VydExpbmVDb250ZW50KGxpbmUsIGJ1aWxkZXIsIHN0eWxlcykge1xuICAgIHZhciBzcGFucyA9IGxpbmUubWFya2VkU3BhbnMsIGFsbFRleHQgPSBsaW5lLnRleHQsIGF0ID0gMDtcbiAgICBpZiAoIXNwYW5zKSB7XG4gICAgICBmb3IgKHZhciBpID0gMTsgaSA8IHN0eWxlcy5sZW5ndGg7IGkrPTIpXG4gICAgICAgIGJ1aWxkZXIuYWRkVG9rZW4oYnVpbGRlciwgYWxsVGV4dC5zbGljZShhdCwgYXQgPSBzdHlsZXNbaV0pLCBpbnRlcnByZXRUb2tlblN0eWxlKHN0eWxlc1tpKzFdLCBidWlsZGVyLmNtLm9wdGlvbnMpKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2YXIgbGVuID0gYWxsVGV4dC5sZW5ndGgsIHBvcyA9IDAsIGkgPSAxLCB0ZXh0ID0gXCJcIiwgc3R5bGUsIGNzcztcbiAgICB2YXIgbmV4dENoYW5nZSA9IDAsIHNwYW5TdHlsZSwgc3BhbkVuZFN0eWxlLCBzcGFuU3RhcnRTdHlsZSwgdGl0bGUsIGNvbGxhcHNlZDtcbiAgICBmb3IgKDs7KSB7XG4gICAgICBpZiAobmV4dENoYW5nZSA9PSBwb3MpIHsgLy8gVXBkYXRlIGN1cnJlbnQgbWFya2VyIHNldFxuICAgICAgICBzcGFuU3R5bGUgPSBzcGFuRW5kU3R5bGUgPSBzcGFuU3RhcnRTdHlsZSA9IHRpdGxlID0gY3NzID0gXCJcIjtcbiAgICAgICAgY29sbGFwc2VkID0gbnVsbDsgbmV4dENoYW5nZSA9IEluZmluaXR5O1xuICAgICAgICB2YXIgZm91bmRCb29rbWFya3MgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzcGFucy5sZW5ndGg7ICsraikge1xuICAgICAgICAgIHZhciBzcCA9IHNwYW5zW2pdLCBtID0gc3AubWFya2VyO1xuICAgICAgICAgIGlmIChtLnR5cGUgPT0gXCJib29rbWFya1wiICYmIHNwLmZyb20gPT0gcG9zICYmIG0ud2lkZ2V0Tm9kZSkge1xuICAgICAgICAgICAgZm91bmRCb29rbWFya3MucHVzaChtKTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHNwLmZyb20gPD0gcG9zICYmIChzcC50byA9PSBudWxsIHx8IHNwLnRvID4gcG9zIHx8IG0uY29sbGFwc2VkICYmIHNwLnRvID09IHBvcyAmJiBzcC5mcm9tID09IHBvcykpIHtcbiAgICAgICAgICAgIGlmIChzcC50byAhPSBudWxsICYmIHNwLnRvICE9IHBvcyAmJiBuZXh0Q2hhbmdlID4gc3AudG8pIHtcbiAgICAgICAgICAgICAgbmV4dENoYW5nZSA9IHNwLnRvO1xuICAgICAgICAgICAgICBzcGFuRW5kU3R5bGUgPSBcIlwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG0uY2xhc3NOYW1lKSBzcGFuU3R5bGUgKz0gXCIgXCIgKyBtLmNsYXNzTmFtZTtcbiAgICAgICAgICAgIGlmIChtLmNzcykgY3NzID0gbS5jc3M7XG4gICAgICAgICAgICBpZiAobS5zdGFydFN0eWxlICYmIHNwLmZyb20gPT0gcG9zKSBzcGFuU3RhcnRTdHlsZSArPSBcIiBcIiArIG0uc3RhcnRTdHlsZTtcbiAgICAgICAgICAgIGlmIChtLmVuZFN0eWxlICYmIHNwLnRvID09IG5leHRDaGFuZ2UpIHNwYW5FbmRTdHlsZSArPSBcIiBcIiArIG0uZW5kU3R5bGU7XG4gICAgICAgICAgICBpZiAobS50aXRsZSAmJiAhdGl0bGUpIHRpdGxlID0gbS50aXRsZTtcbiAgICAgICAgICAgIGlmIChtLmNvbGxhcHNlZCAmJiAoIWNvbGxhcHNlZCB8fCBjb21wYXJlQ29sbGFwc2VkTWFya2Vycyhjb2xsYXBzZWQubWFya2VyLCBtKSA8IDApKVxuICAgICAgICAgICAgICBjb2xsYXBzZWQgPSBzcDtcbiAgICAgICAgICB9IGVsc2UgaWYgKHNwLmZyb20gPiBwb3MgJiYgbmV4dENoYW5nZSA+IHNwLmZyb20pIHtcbiAgICAgICAgICAgIG5leHRDaGFuZ2UgPSBzcC5mcm9tO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoY29sbGFwc2VkICYmIChjb2xsYXBzZWQuZnJvbSB8fCAwKSA9PSBwb3MpIHtcbiAgICAgICAgICBidWlsZENvbGxhcHNlZFNwYW4oYnVpbGRlciwgKGNvbGxhcHNlZC50byA9PSBudWxsID8gbGVuICsgMSA6IGNvbGxhcHNlZC50bykgLSBwb3MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbGxhcHNlZC5tYXJrZXIsIGNvbGxhcHNlZC5mcm9tID09IG51bGwpO1xuICAgICAgICAgIGlmIChjb2xsYXBzZWQudG8gPT0gbnVsbCkgcmV0dXJuO1xuICAgICAgICAgIGlmIChjb2xsYXBzZWQudG8gPT0gcG9zKSBjb2xsYXBzZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWNvbGxhcHNlZCAmJiBmb3VuZEJvb2ttYXJrcy5sZW5ndGgpIGZvciAodmFyIGogPSAwOyBqIDwgZm91bmRCb29rbWFya3MubGVuZ3RoOyArK2opXG4gICAgICAgICAgYnVpbGRDb2xsYXBzZWRTcGFuKGJ1aWxkZXIsIDAsIGZvdW5kQm9va21hcmtzW2pdKTtcbiAgICAgIH1cbiAgICAgIGlmIChwb3MgPj0gbGVuKSBicmVhaztcblxuICAgICAgdmFyIHVwdG8gPSBNYXRoLm1pbihsZW4sIG5leHRDaGFuZ2UpO1xuICAgICAgd2hpbGUgKHRydWUpIHtcbiAgICAgICAgaWYgKHRleHQpIHtcbiAgICAgICAgICB2YXIgZW5kID0gcG9zICsgdGV4dC5sZW5ndGg7XG4gICAgICAgICAgaWYgKCFjb2xsYXBzZWQpIHtcbiAgICAgICAgICAgIHZhciB0b2tlblRleHQgPSBlbmQgPiB1cHRvID8gdGV4dC5zbGljZSgwLCB1cHRvIC0gcG9zKSA6IHRleHQ7XG4gICAgICAgICAgICBidWlsZGVyLmFkZFRva2VuKGJ1aWxkZXIsIHRva2VuVGV4dCwgc3R5bGUgPyBzdHlsZSArIHNwYW5TdHlsZSA6IHNwYW5TdHlsZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BhblN0YXJ0U3R5bGUsIHBvcyArIHRva2VuVGV4dC5sZW5ndGggPT0gbmV4dENoYW5nZSA/IHNwYW5FbmRTdHlsZSA6IFwiXCIsIHRpdGxlLCBjc3MpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZW5kID49IHVwdG8pIHt0ZXh0ID0gdGV4dC5zbGljZSh1cHRvIC0gcG9zKTsgcG9zID0gdXB0bzsgYnJlYWs7fVxuICAgICAgICAgIHBvcyA9IGVuZDtcbiAgICAgICAgICBzcGFuU3RhcnRTdHlsZSA9IFwiXCI7XG4gICAgICAgIH1cbiAgICAgICAgdGV4dCA9IGFsbFRleHQuc2xpY2UoYXQsIGF0ID0gc3R5bGVzW2krK10pO1xuICAgICAgICBzdHlsZSA9IGludGVycHJldFRva2VuU3R5bGUoc3R5bGVzW2krK10sIGJ1aWxkZXIuY20ub3B0aW9ucyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8gRE9DVU1FTlQgREFUQSBTVFJVQ1RVUkVcblxuICAvLyBCeSBkZWZhdWx0LCB1cGRhdGVzIHRoYXQgc3RhcnQgYW5kIGVuZCBhdCB0aGUgYmVnaW5uaW5nIG9mIGEgbGluZVxuICAvLyBhcmUgdHJlYXRlZCBzcGVjaWFsbHksIGluIG9yZGVyIHRvIG1ha2UgdGhlIGFzc29jaWF0aW9uIG9mIGxpbmVcbiAgLy8gd2lkZ2V0cyBhbmQgbWFya2VyIGVsZW1lbnRzIHdpdGggdGhlIHRleHQgYmVoYXZlIG1vcmUgaW50dWl0aXZlLlxuICBmdW5jdGlvbiBpc1dob2xlTGluZVVwZGF0ZShkb2MsIGNoYW5nZSkge1xuICAgIHJldHVybiBjaGFuZ2UuZnJvbS5jaCA9PSAwICYmIGNoYW5nZS50by5jaCA9PSAwICYmIGxzdChjaGFuZ2UudGV4dCkgPT0gXCJcIiAmJlxuICAgICAgKCFkb2MuY20gfHwgZG9jLmNtLm9wdGlvbnMud2hvbGVMaW5lVXBkYXRlQmVmb3JlKTtcbiAgfVxuXG4gIC8vIFBlcmZvcm0gYSBjaGFuZ2Ugb24gdGhlIGRvY3VtZW50IGRhdGEgc3RydWN0dXJlLlxuICBmdW5jdGlvbiB1cGRhdGVEb2MoZG9jLCBjaGFuZ2UsIG1hcmtlZFNwYW5zLCBlc3RpbWF0ZUhlaWdodCkge1xuICAgIGZ1bmN0aW9uIHNwYW5zRm9yKG4pIHtyZXR1cm4gbWFya2VkU3BhbnMgPyBtYXJrZWRTcGFuc1tuXSA6IG51bGw7fVxuICAgIGZ1bmN0aW9uIHVwZGF0ZShsaW5lLCB0ZXh0LCBzcGFucykge1xuICAgICAgdXBkYXRlTGluZShsaW5lLCB0ZXh0LCBzcGFucywgZXN0aW1hdGVIZWlnaHQpO1xuICAgICAgc2lnbmFsTGF0ZXIobGluZSwgXCJjaGFuZ2VcIiwgbGluZSwgY2hhbmdlKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gbGluZXNGb3Ioc3RhcnQsIGVuZCkge1xuICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0LCByZXN1bHQgPSBbXTsgaSA8IGVuZDsgKytpKVxuICAgICAgICByZXN1bHQucHVzaChuZXcgTGluZSh0ZXh0W2ldLCBzcGFuc0ZvcihpKSwgZXN0aW1hdGVIZWlnaHQpKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuXG4gICAgdmFyIGZyb20gPSBjaGFuZ2UuZnJvbSwgdG8gPSBjaGFuZ2UudG8sIHRleHQgPSBjaGFuZ2UudGV4dDtcbiAgICB2YXIgZmlyc3RMaW5lID0gZ2V0TGluZShkb2MsIGZyb20ubGluZSksIGxhc3RMaW5lID0gZ2V0TGluZShkb2MsIHRvLmxpbmUpO1xuICAgIHZhciBsYXN0VGV4dCA9IGxzdCh0ZXh0KSwgbGFzdFNwYW5zID0gc3BhbnNGb3IodGV4dC5sZW5ndGggLSAxKSwgbmxpbmVzID0gdG8ubGluZSAtIGZyb20ubGluZTtcblxuICAgIC8vIEFkanVzdCB0aGUgbGluZSBzdHJ1Y3R1cmVcbiAgICBpZiAoY2hhbmdlLmZ1bGwpIHtcbiAgICAgIGRvYy5pbnNlcnQoMCwgbGluZXNGb3IoMCwgdGV4dC5sZW5ndGgpKTtcbiAgICAgIGRvYy5yZW1vdmUodGV4dC5sZW5ndGgsIGRvYy5zaXplIC0gdGV4dC5sZW5ndGgpO1xuICAgIH0gZWxzZSBpZiAoaXNXaG9sZUxpbmVVcGRhdGUoZG9jLCBjaGFuZ2UpKSB7XG4gICAgICAvLyBUaGlzIGlzIGEgd2hvbGUtbGluZSByZXBsYWNlLiBUcmVhdGVkIHNwZWNpYWxseSB0byBtYWtlXG4gICAgICAvLyBzdXJlIGxpbmUgb2JqZWN0cyBtb3ZlIHRoZSB3YXkgdGhleSBhcmUgc3VwcG9zZWQgdG8uXG4gICAgICB2YXIgYWRkZWQgPSBsaW5lc0ZvcigwLCB0ZXh0Lmxlbmd0aCAtIDEpO1xuICAgICAgdXBkYXRlKGxhc3RMaW5lLCBsYXN0TGluZS50ZXh0LCBsYXN0U3BhbnMpO1xuICAgICAgaWYgKG5saW5lcykgZG9jLnJlbW92ZShmcm9tLmxpbmUsIG5saW5lcyk7XG4gICAgICBpZiAoYWRkZWQubGVuZ3RoKSBkb2MuaW5zZXJ0KGZyb20ubGluZSwgYWRkZWQpO1xuICAgIH0gZWxzZSBpZiAoZmlyc3RMaW5lID09IGxhc3RMaW5lKSB7XG4gICAgICBpZiAodGV4dC5sZW5ndGggPT0gMSkge1xuICAgICAgICB1cGRhdGUoZmlyc3RMaW5lLCBmaXJzdExpbmUudGV4dC5zbGljZSgwLCBmcm9tLmNoKSArIGxhc3RUZXh0ICsgZmlyc3RMaW5lLnRleHQuc2xpY2UodG8uY2gpLCBsYXN0U3BhbnMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGFkZGVkID0gbGluZXNGb3IoMSwgdGV4dC5sZW5ndGggLSAxKTtcbiAgICAgICAgYWRkZWQucHVzaChuZXcgTGluZShsYXN0VGV4dCArIGZpcnN0TGluZS50ZXh0LnNsaWNlKHRvLmNoKSwgbGFzdFNwYW5zLCBlc3RpbWF0ZUhlaWdodCkpO1xuICAgICAgICB1cGRhdGUoZmlyc3RMaW5lLCBmaXJzdExpbmUudGV4dC5zbGljZSgwLCBmcm9tLmNoKSArIHRleHRbMF0sIHNwYW5zRm9yKDApKTtcbiAgICAgICAgZG9jLmluc2VydChmcm9tLmxpbmUgKyAxLCBhZGRlZCk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0ZXh0Lmxlbmd0aCA9PSAxKSB7XG4gICAgICB1cGRhdGUoZmlyc3RMaW5lLCBmaXJzdExpbmUudGV4dC5zbGljZSgwLCBmcm9tLmNoKSArIHRleHRbMF0gKyBsYXN0TGluZS50ZXh0LnNsaWNlKHRvLmNoKSwgc3BhbnNGb3IoMCkpO1xuICAgICAgZG9jLnJlbW92ZShmcm9tLmxpbmUgKyAxLCBubGluZXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICB1cGRhdGUoZmlyc3RMaW5lLCBmaXJzdExpbmUudGV4dC5zbGljZSgwLCBmcm9tLmNoKSArIHRleHRbMF0sIHNwYW5zRm9yKDApKTtcbiAgICAgIHVwZGF0ZShsYXN0TGluZSwgbGFzdFRleHQgKyBsYXN0TGluZS50ZXh0LnNsaWNlKHRvLmNoKSwgbGFzdFNwYW5zKTtcbiAgICAgIHZhciBhZGRlZCA9IGxpbmVzRm9yKDEsIHRleHQubGVuZ3RoIC0gMSk7XG4gICAgICBpZiAobmxpbmVzID4gMSkgZG9jLnJlbW92ZShmcm9tLmxpbmUgKyAxLCBubGluZXMgLSAxKTtcbiAgICAgIGRvYy5pbnNlcnQoZnJvbS5saW5lICsgMSwgYWRkZWQpO1xuICAgIH1cblxuICAgIHNpZ25hbExhdGVyKGRvYywgXCJjaGFuZ2VcIiwgZG9jLCBjaGFuZ2UpO1xuICB9XG5cbiAgLy8gVGhlIGRvY3VtZW50IGlzIHJlcHJlc2VudGVkIGFzIGEgQlRyZWUgY29uc2lzdGluZyBvZiBsZWF2ZXMsIHdpdGhcbiAgLy8gY2h1bmsgb2YgbGluZXMgaW4gdGhlbSwgYW5kIGJyYW5jaGVzLCB3aXRoIHVwIHRvIHRlbiBsZWF2ZXMgb3JcbiAgLy8gb3RoZXIgYnJhbmNoIG5vZGVzIGJlbG93IHRoZW0uIFRoZSB0b3Agbm9kZSBpcyBhbHdheXMgYSBicmFuY2hcbiAgLy8gbm9kZSwgYW5kIGlzIHRoZSBkb2N1bWVudCBvYmplY3QgaXRzZWxmIChtZWFuaW5nIGl0IGhhc1xuICAvLyBhZGRpdGlvbmFsIG1ldGhvZHMgYW5kIHByb3BlcnRpZXMpLlxuICAvL1xuICAvLyBBbGwgbm9kZXMgaGF2ZSBwYXJlbnQgbGlua3MuIFRoZSB0cmVlIGlzIHVzZWQgYm90aCB0byBnbyBmcm9tXG4gIC8vIGxpbmUgbnVtYmVycyB0byBsaW5lIG9iamVjdHMsIGFuZCB0byBnbyBmcm9tIG9iamVjdHMgdG8gbnVtYmVycy5cbiAgLy8gSXQgYWxzbyBpbmRleGVzIGJ5IGhlaWdodCwgYW5kIGlzIHVzZWQgdG8gY29udmVydCBiZXR3ZWVuIGhlaWdodFxuICAvLyBhbmQgbGluZSBvYmplY3QsIGFuZCB0byBmaW5kIHRoZSB0b3RhbCBoZWlnaHQgb2YgdGhlIGRvY3VtZW50LlxuICAvL1xuICAvLyBTZWUgYWxzbyBodHRwOi8vbWFyaWpuaGF2ZXJiZWtlLm5sL2Jsb2cvY29kZW1pcnJvci1saW5lLXRyZWUuaHRtbFxuXG4gIGZ1bmN0aW9uIExlYWZDaHVuayhsaW5lcykge1xuICAgIHRoaXMubGluZXMgPSBsaW5lcztcbiAgICB0aGlzLnBhcmVudCA9IG51bGw7XG4gICAgZm9yICh2YXIgaSA9IDAsIGhlaWdodCA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7ICsraSkge1xuICAgICAgbGluZXNbaV0ucGFyZW50ID0gdGhpcztcbiAgICAgIGhlaWdodCArPSBsaW5lc1tpXS5oZWlnaHQ7XG4gICAgfVxuICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICB9XG5cbiAgTGVhZkNodW5rLnByb3RvdHlwZSA9IHtcbiAgICBjaHVua1NpemU6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5saW5lcy5sZW5ndGg7IH0sXG4gICAgLy8gUmVtb3ZlIHRoZSBuIGxpbmVzIGF0IG9mZnNldCAnYXQnLlxuICAgIHJlbW92ZUlubmVyOiBmdW5jdGlvbihhdCwgbikge1xuICAgICAgZm9yICh2YXIgaSA9IGF0LCBlID0gYXQgKyBuOyBpIDwgZTsgKytpKSB7XG4gICAgICAgIHZhciBsaW5lID0gdGhpcy5saW5lc1tpXTtcbiAgICAgICAgdGhpcy5oZWlnaHQgLT0gbGluZS5oZWlnaHQ7XG4gICAgICAgIGNsZWFuVXBMaW5lKGxpbmUpO1xuICAgICAgICBzaWduYWxMYXRlcihsaW5lLCBcImRlbGV0ZVwiKTtcbiAgICAgIH1cbiAgICAgIHRoaXMubGluZXMuc3BsaWNlKGF0LCBuKTtcbiAgICB9LFxuICAgIC8vIEhlbHBlciB1c2VkIHRvIGNvbGxhcHNlIGEgc21hbGwgYnJhbmNoIGludG8gYSBzaW5nbGUgbGVhZi5cbiAgICBjb2xsYXBzZTogZnVuY3Rpb24obGluZXMpIHtcbiAgICAgIGxpbmVzLnB1c2guYXBwbHkobGluZXMsIHRoaXMubGluZXMpO1xuICAgIH0sXG4gICAgLy8gSW5zZXJ0IHRoZSBnaXZlbiBhcnJheSBvZiBsaW5lcyBhdCBvZmZzZXQgJ2F0JywgY291bnQgdGhlbSBhc1xuICAgIC8vIGhhdmluZyB0aGUgZ2l2ZW4gaGVpZ2h0LlxuICAgIGluc2VydElubmVyOiBmdW5jdGlvbihhdCwgbGluZXMsIGhlaWdodCkge1xuICAgICAgdGhpcy5oZWlnaHQgKz0gaGVpZ2h0O1xuICAgICAgdGhpcy5saW5lcyA9IHRoaXMubGluZXMuc2xpY2UoMCwgYXQpLmNvbmNhdChsaW5lcykuY29uY2F0KHRoaXMubGluZXMuc2xpY2UoYXQpKTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoOyArK2kpIGxpbmVzW2ldLnBhcmVudCA9IHRoaXM7XG4gICAgfSxcbiAgICAvLyBVc2VkIHRvIGl0ZXJhdGUgb3ZlciBhIHBhcnQgb2YgdGhlIHRyZWUuXG4gICAgaXRlck46IGZ1bmN0aW9uKGF0LCBuLCBvcCkge1xuICAgICAgZm9yICh2YXIgZSA9IGF0ICsgbjsgYXQgPCBlOyArK2F0KVxuICAgICAgICBpZiAob3AodGhpcy5saW5lc1thdF0pKSByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH07XG5cbiAgZnVuY3Rpb24gQnJhbmNoQ2h1bmsoY2hpbGRyZW4pIHtcbiAgICB0aGlzLmNoaWxkcmVuID0gY2hpbGRyZW47XG4gICAgdmFyIHNpemUgPSAwLCBoZWlnaHQgPSAwO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hpbGRyZW4ubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBjaCA9IGNoaWxkcmVuW2ldO1xuICAgICAgc2l6ZSArPSBjaC5jaHVua1NpemUoKTsgaGVpZ2h0ICs9IGNoLmhlaWdodDtcbiAgICAgIGNoLnBhcmVudCA9IHRoaXM7XG4gICAgfVxuICAgIHRoaXMuc2l6ZSA9IHNpemU7XG4gICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgdGhpcy5wYXJlbnQgPSBudWxsO1xuICB9XG5cbiAgQnJhbmNoQ2h1bmsucHJvdG90eXBlID0ge1xuICAgIGNodW5rU2l6ZTogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnNpemU7IH0sXG4gICAgcmVtb3ZlSW5uZXI6IGZ1bmN0aW9uKGF0LCBuKSB7XG4gICAgICB0aGlzLnNpemUgLT0gbjtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jaGlsZHJlbi5sZW5ndGg7ICsraSkge1xuICAgICAgICB2YXIgY2hpbGQgPSB0aGlzLmNoaWxkcmVuW2ldLCBzeiA9IGNoaWxkLmNodW5rU2l6ZSgpO1xuICAgICAgICBpZiAoYXQgPCBzeikge1xuICAgICAgICAgIHZhciBybSA9IE1hdGgubWluKG4sIHN6IC0gYXQpLCBvbGRIZWlnaHQgPSBjaGlsZC5oZWlnaHQ7XG4gICAgICAgICAgY2hpbGQucmVtb3ZlSW5uZXIoYXQsIHJtKTtcbiAgICAgICAgICB0aGlzLmhlaWdodCAtPSBvbGRIZWlnaHQgLSBjaGlsZC5oZWlnaHQ7XG4gICAgICAgICAgaWYgKHN6ID09IHJtKSB7IHRoaXMuY2hpbGRyZW4uc3BsaWNlKGktLSwgMSk7IGNoaWxkLnBhcmVudCA9IG51bGw7IH1cbiAgICAgICAgICBpZiAoKG4gLT0gcm0pID09IDApIGJyZWFrO1xuICAgICAgICAgIGF0ID0gMDtcbiAgICAgICAgfSBlbHNlIGF0IC09IHN6O1xuICAgICAgfVxuICAgICAgLy8gSWYgdGhlIHJlc3VsdCBpcyBzbWFsbGVyIHRoYW4gMjUgbGluZXMsIGVuc3VyZSB0aGF0IGl0IGlzIGFcbiAgICAgIC8vIHNpbmdsZSBsZWFmIG5vZGUuXG4gICAgICBpZiAodGhpcy5zaXplIC0gbiA8IDI1ICYmXG4gICAgICAgICAgKHRoaXMuY2hpbGRyZW4ubGVuZ3RoID4gMSB8fCAhKHRoaXMuY2hpbGRyZW5bMF0gaW5zdGFuY2VvZiBMZWFmQ2h1bmspKSkge1xuICAgICAgICB2YXIgbGluZXMgPSBbXTtcbiAgICAgICAgdGhpcy5jb2xsYXBzZShsaW5lcyk7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4gPSBbbmV3IExlYWZDaHVuayhsaW5lcyldO1xuICAgICAgICB0aGlzLmNoaWxkcmVuWzBdLnBhcmVudCA9IHRoaXM7XG4gICAgICB9XG4gICAgfSxcbiAgICBjb2xsYXBzZTogZnVuY3Rpb24obGluZXMpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jaGlsZHJlbi5sZW5ndGg7ICsraSkgdGhpcy5jaGlsZHJlbltpXS5jb2xsYXBzZShsaW5lcyk7XG4gICAgfSxcbiAgICBpbnNlcnRJbm5lcjogZnVuY3Rpb24oYXQsIGxpbmVzLCBoZWlnaHQpIHtcbiAgICAgIHRoaXMuc2l6ZSArPSBsaW5lcy5sZW5ndGg7XG4gICAgICB0aGlzLmhlaWdodCArPSBoZWlnaHQ7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgdmFyIGNoaWxkID0gdGhpcy5jaGlsZHJlbltpXSwgc3ogPSBjaGlsZC5jaHVua1NpemUoKTtcbiAgICAgICAgaWYgKGF0IDw9IHN6KSB7XG4gICAgICAgICAgY2hpbGQuaW5zZXJ0SW5uZXIoYXQsIGxpbmVzLCBoZWlnaHQpO1xuICAgICAgICAgIGlmIChjaGlsZC5saW5lcyAmJiBjaGlsZC5saW5lcy5sZW5ndGggPiA1MCkge1xuICAgICAgICAgICAgd2hpbGUgKGNoaWxkLmxpbmVzLmxlbmd0aCA+IDUwKSB7XG4gICAgICAgICAgICAgIHZhciBzcGlsbGVkID0gY2hpbGQubGluZXMuc3BsaWNlKGNoaWxkLmxpbmVzLmxlbmd0aCAtIDI1LCAyNSk7XG4gICAgICAgICAgICAgIHZhciBuZXdsZWFmID0gbmV3IExlYWZDaHVuayhzcGlsbGVkKTtcbiAgICAgICAgICAgICAgY2hpbGQuaGVpZ2h0IC09IG5ld2xlYWYuaGVpZ2h0O1xuICAgICAgICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpICsgMSwgMCwgbmV3bGVhZik7XG4gICAgICAgICAgICAgIG5ld2xlYWYucGFyZW50ID0gdGhpcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubWF5YmVTcGlsbCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBhdCAtPSBzejtcbiAgICAgIH1cbiAgICB9LFxuICAgIC8vIFdoZW4gYSBub2RlIGhhcyBncm93biwgY2hlY2sgd2hldGhlciBpdCBzaG91bGQgYmUgc3BsaXQuXG4gICAgbWF5YmVTcGlsbDogZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodGhpcy5jaGlsZHJlbi5sZW5ndGggPD0gMTApIHJldHVybjtcbiAgICAgIHZhciBtZSA9IHRoaXM7XG4gICAgICBkbyB7XG4gICAgICAgIHZhciBzcGlsbGVkID0gbWUuY2hpbGRyZW4uc3BsaWNlKG1lLmNoaWxkcmVuLmxlbmd0aCAtIDUsIDUpO1xuICAgICAgICB2YXIgc2libGluZyA9IG5ldyBCcmFuY2hDaHVuayhzcGlsbGVkKTtcbiAgICAgICAgaWYgKCFtZS5wYXJlbnQpIHsgLy8gQmVjb21lIHRoZSBwYXJlbnQgbm9kZVxuICAgICAgICAgIHZhciBjb3B5ID0gbmV3IEJyYW5jaENodW5rKG1lLmNoaWxkcmVuKTtcbiAgICAgICAgICBjb3B5LnBhcmVudCA9IG1lO1xuICAgICAgICAgIG1lLmNoaWxkcmVuID0gW2NvcHksIHNpYmxpbmddO1xuICAgICAgICAgIG1lID0gY29weTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBtZS5zaXplIC09IHNpYmxpbmcuc2l6ZTtcbiAgICAgICAgICBtZS5oZWlnaHQgLT0gc2libGluZy5oZWlnaHQ7XG4gICAgICAgICAgdmFyIG15SW5kZXggPSBpbmRleE9mKG1lLnBhcmVudC5jaGlsZHJlbiwgbWUpO1xuICAgICAgICAgIG1lLnBhcmVudC5jaGlsZHJlbi5zcGxpY2UobXlJbmRleCArIDEsIDAsIHNpYmxpbmcpO1xuICAgICAgICB9XG4gICAgICAgIHNpYmxpbmcucGFyZW50ID0gbWUucGFyZW50O1xuICAgICAgfSB3aGlsZSAobWUuY2hpbGRyZW4ubGVuZ3RoID4gMTApO1xuICAgICAgbWUucGFyZW50Lm1heWJlU3BpbGwoKTtcbiAgICB9LFxuICAgIGl0ZXJOOiBmdW5jdGlvbihhdCwgbiwgb3ApIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jaGlsZHJlbi5sZW5ndGg7ICsraSkge1xuICAgICAgICB2YXIgY2hpbGQgPSB0aGlzLmNoaWxkcmVuW2ldLCBzeiA9IGNoaWxkLmNodW5rU2l6ZSgpO1xuICAgICAgICBpZiAoYXQgPCBzeikge1xuICAgICAgICAgIHZhciB1c2VkID0gTWF0aC5taW4obiwgc3ogLSBhdCk7XG4gICAgICAgICAgaWYgKGNoaWxkLml0ZXJOKGF0LCB1c2VkLCBvcCkpIHJldHVybiB0cnVlO1xuICAgICAgICAgIGlmICgobiAtPSB1c2VkKSA9PSAwKSBicmVhaztcbiAgICAgICAgICBhdCA9IDA7XG4gICAgICAgIH0gZWxzZSBhdCAtPSBzejtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgdmFyIG5leHREb2NJZCA9IDA7XG4gIHZhciBEb2MgPSBDb2RlTWlycm9yLkRvYyA9IGZ1bmN0aW9uKHRleHQsIG1vZGUsIGZpcnN0TGluZSwgbGluZVNlcCkge1xuICAgIGlmICghKHRoaXMgaW5zdGFuY2VvZiBEb2MpKSByZXR1cm4gbmV3IERvYyh0ZXh0LCBtb2RlLCBmaXJzdExpbmUsIGxpbmVTZXApO1xuICAgIGlmIChmaXJzdExpbmUgPT0gbnVsbCkgZmlyc3RMaW5lID0gMDtcblxuICAgIEJyYW5jaENodW5rLmNhbGwodGhpcywgW25ldyBMZWFmQ2h1bmsoW25ldyBMaW5lKFwiXCIsIG51bGwpXSldKTtcbiAgICB0aGlzLmZpcnN0ID0gZmlyc3RMaW5lO1xuICAgIHRoaXMuc2Nyb2xsVG9wID0gdGhpcy5zY3JvbGxMZWZ0ID0gMDtcbiAgICB0aGlzLmNhbnRFZGl0ID0gZmFsc2U7XG4gICAgdGhpcy5jbGVhbkdlbmVyYXRpb24gPSAxO1xuICAgIHRoaXMuZnJvbnRpZXIgPSBmaXJzdExpbmU7XG4gICAgdmFyIHN0YXJ0ID0gUG9zKGZpcnN0TGluZSwgMCk7XG4gICAgdGhpcy5zZWwgPSBzaW1wbGVTZWxlY3Rpb24oc3RhcnQpO1xuICAgIHRoaXMuaGlzdG9yeSA9IG5ldyBIaXN0b3J5KG51bGwpO1xuICAgIHRoaXMuaWQgPSArK25leHREb2NJZDtcbiAgICB0aGlzLm1vZGVPcHRpb24gPSBtb2RlO1xuICAgIHRoaXMubGluZVNlcCA9IGxpbmVTZXA7XG5cbiAgICBpZiAodHlwZW9mIHRleHQgPT0gXCJzdHJpbmdcIikgdGV4dCA9IHRoaXMuc3BsaXRMaW5lcyh0ZXh0KTtcbiAgICB1cGRhdGVEb2ModGhpcywge2Zyb206IHN0YXJ0LCB0bzogc3RhcnQsIHRleHQ6IHRleHR9KTtcbiAgICBzZXRTZWxlY3Rpb24odGhpcywgc2ltcGxlU2VsZWN0aW9uKHN0YXJ0KSwgc2VsX2RvbnRTY3JvbGwpO1xuICB9O1xuXG4gIERvYy5wcm90b3R5cGUgPSBjcmVhdGVPYmooQnJhbmNoQ2h1bmsucHJvdG90eXBlLCB7XG4gICAgY29uc3RydWN0b3I6IERvYyxcbiAgICAvLyBJdGVyYXRlIG92ZXIgdGhlIGRvY3VtZW50LiBTdXBwb3J0cyB0d28gZm9ybXMgLS0gd2l0aCBvbmx5IG9uZVxuICAgIC8vIGFyZ3VtZW50LCBpdCBjYWxscyB0aGF0IGZvciBlYWNoIGxpbmUgaW4gdGhlIGRvY3VtZW50LiBXaXRoXG4gICAgLy8gdGhyZWUsIGl0IGl0ZXJhdGVzIG92ZXIgdGhlIHJhbmdlIGdpdmVuIGJ5IHRoZSBmaXJzdCB0d28gKHdpdGhcbiAgICAvLyB0aGUgc2Vjb25kIGJlaW5nIG5vbi1pbmNsdXNpdmUpLlxuICAgIGl0ZXI6IGZ1bmN0aW9uKGZyb20sIHRvLCBvcCkge1xuICAgICAgaWYgKG9wKSB0aGlzLml0ZXJOKGZyb20gLSB0aGlzLmZpcnN0LCB0byAtIGZyb20sIG9wKTtcbiAgICAgIGVsc2UgdGhpcy5pdGVyTih0aGlzLmZpcnN0LCB0aGlzLmZpcnN0ICsgdGhpcy5zaXplLCBmcm9tKTtcbiAgICB9LFxuXG4gICAgLy8gTm9uLXB1YmxpYyBpbnRlcmZhY2UgZm9yIGFkZGluZyBhbmQgcmVtb3ZpbmcgbGluZXMuXG4gICAgaW5zZXJ0OiBmdW5jdGlvbihhdCwgbGluZXMpIHtcbiAgICAgIHZhciBoZWlnaHQgPSAwO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7ICsraSkgaGVpZ2h0ICs9IGxpbmVzW2ldLmhlaWdodDtcbiAgICAgIHRoaXMuaW5zZXJ0SW5uZXIoYXQgLSB0aGlzLmZpcnN0LCBsaW5lcywgaGVpZ2h0KTtcbiAgICB9LFxuICAgIHJlbW92ZTogZnVuY3Rpb24oYXQsIG4pIHsgdGhpcy5yZW1vdmVJbm5lcihhdCAtIHRoaXMuZmlyc3QsIG4pOyB9LFxuXG4gICAgLy8gRnJvbSBoZXJlLCB0aGUgbWV0aG9kcyBhcmUgcGFydCBvZiB0aGUgcHVibGljIGludGVyZmFjZS4gTW9zdFxuICAgIC8vIGFyZSBhbHNvIGF2YWlsYWJsZSBmcm9tIENvZGVNaXJyb3IgKGVkaXRvcikgaW5zdGFuY2VzLlxuXG4gICAgZ2V0VmFsdWU6IGZ1bmN0aW9uKGxpbmVTZXApIHtcbiAgICAgIHZhciBsaW5lcyA9IGdldExpbmVzKHRoaXMsIHRoaXMuZmlyc3QsIHRoaXMuZmlyc3QgKyB0aGlzLnNpemUpO1xuICAgICAgaWYgKGxpbmVTZXAgPT09IGZhbHNlKSByZXR1cm4gbGluZXM7XG4gICAgICByZXR1cm4gbGluZXMuam9pbihsaW5lU2VwIHx8IHRoaXMubGluZVNlcGFyYXRvcigpKTtcbiAgICB9LFxuICAgIHNldFZhbHVlOiBkb2NNZXRob2RPcChmdW5jdGlvbihjb2RlKSB7XG4gICAgICB2YXIgdG9wID0gUG9zKHRoaXMuZmlyc3QsIDApLCBsYXN0ID0gdGhpcy5maXJzdCArIHRoaXMuc2l6ZSAtIDE7XG4gICAgICBtYWtlQ2hhbmdlKHRoaXMsIHtmcm9tOiB0b3AsIHRvOiBQb3MobGFzdCwgZ2V0TGluZSh0aGlzLCBsYXN0KS50ZXh0Lmxlbmd0aCksXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiB0aGlzLnNwbGl0TGluZXMoY29kZSksIG9yaWdpbjogXCJzZXRWYWx1ZVwiLCBmdWxsOiB0cnVlfSwgdHJ1ZSk7XG4gICAgICBzZXRTZWxlY3Rpb24odGhpcywgc2ltcGxlU2VsZWN0aW9uKHRvcCkpO1xuICAgIH0pLFxuICAgIHJlcGxhY2VSYW5nZTogZnVuY3Rpb24oY29kZSwgZnJvbSwgdG8sIG9yaWdpbikge1xuICAgICAgZnJvbSA9IGNsaXBQb3ModGhpcywgZnJvbSk7XG4gICAgICB0byA9IHRvID8gY2xpcFBvcyh0aGlzLCB0bykgOiBmcm9tO1xuICAgICAgcmVwbGFjZVJhbmdlKHRoaXMsIGNvZGUsIGZyb20sIHRvLCBvcmlnaW4pO1xuICAgIH0sXG4gICAgZ2V0UmFuZ2U6IGZ1bmN0aW9uKGZyb20sIHRvLCBsaW5lU2VwKSB7XG4gICAgICB2YXIgbGluZXMgPSBnZXRCZXR3ZWVuKHRoaXMsIGNsaXBQb3ModGhpcywgZnJvbSksIGNsaXBQb3ModGhpcywgdG8pKTtcbiAgICAgIGlmIChsaW5lU2VwID09PSBmYWxzZSkgcmV0dXJuIGxpbmVzO1xuICAgICAgcmV0dXJuIGxpbmVzLmpvaW4obGluZVNlcCB8fCB0aGlzLmxpbmVTZXBhcmF0b3IoKSk7XG4gICAgfSxcblxuICAgIGdldExpbmU6IGZ1bmN0aW9uKGxpbmUpIHt2YXIgbCA9IHRoaXMuZ2V0TGluZUhhbmRsZShsaW5lKTsgcmV0dXJuIGwgJiYgbC50ZXh0O30sXG5cbiAgICBnZXRMaW5lSGFuZGxlOiBmdW5jdGlvbihsaW5lKSB7aWYgKGlzTGluZSh0aGlzLCBsaW5lKSkgcmV0dXJuIGdldExpbmUodGhpcywgbGluZSk7fSxcbiAgICBnZXRMaW5lTnVtYmVyOiBmdW5jdGlvbihsaW5lKSB7cmV0dXJuIGxpbmVObyhsaW5lKTt9LFxuXG4gICAgZ2V0TGluZUhhbmRsZVZpc3VhbFN0YXJ0OiBmdW5jdGlvbihsaW5lKSB7XG4gICAgICBpZiAodHlwZW9mIGxpbmUgPT0gXCJudW1iZXJcIikgbGluZSA9IGdldExpbmUodGhpcywgbGluZSk7XG4gICAgICByZXR1cm4gdmlzdWFsTGluZShsaW5lKTtcbiAgICB9LFxuXG4gICAgbGluZUNvdW50OiBmdW5jdGlvbigpIHtyZXR1cm4gdGhpcy5zaXplO30sXG4gICAgZmlyc3RMaW5lOiBmdW5jdGlvbigpIHtyZXR1cm4gdGhpcy5maXJzdDt9LFxuICAgIGxhc3RMaW5lOiBmdW5jdGlvbigpIHtyZXR1cm4gdGhpcy5maXJzdCArIHRoaXMuc2l6ZSAtIDE7fSxcblxuICAgIGNsaXBQb3M6IGZ1bmN0aW9uKHBvcykge3JldHVybiBjbGlwUG9zKHRoaXMsIHBvcyk7fSxcblxuICAgIGdldEN1cnNvcjogZnVuY3Rpb24oc3RhcnQpIHtcbiAgICAgIHZhciByYW5nZSA9IHRoaXMuc2VsLnByaW1hcnkoKSwgcG9zO1xuICAgICAgaWYgKHN0YXJ0ID09IG51bGwgfHwgc3RhcnQgPT0gXCJoZWFkXCIpIHBvcyA9IHJhbmdlLmhlYWQ7XG4gICAgICBlbHNlIGlmIChzdGFydCA9PSBcImFuY2hvclwiKSBwb3MgPSByYW5nZS5hbmNob3I7XG4gICAgICBlbHNlIGlmIChzdGFydCA9PSBcImVuZFwiIHx8IHN0YXJ0ID09IFwidG9cIiB8fCBzdGFydCA9PT0gZmFsc2UpIHBvcyA9IHJhbmdlLnRvKCk7XG4gICAgICBlbHNlIHBvcyA9IHJhbmdlLmZyb20oKTtcbiAgICAgIHJldHVybiBwb3M7XG4gICAgfSxcbiAgICBsaXN0U2VsZWN0aW9uczogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnNlbC5yYW5nZXM7IH0sXG4gICAgc29tZXRoaW5nU2VsZWN0ZWQ6IGZ1bmN0aW9uKCkge3JldHVybiB0aGlzLnNlbC5zb21ldGhpbmdTZWxlY3RlZCgpO30sXG5cbiAgICBzZXRDdXJzb3I6IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGxpbmUsIGNoLCBvcHRpb25zKSB7XG4gICAgICBzZXRTaW1wbGVTZWxlY3Rpb24odGhpcywgY2xpcFBvcyh0aGlzLCB0eXBlb2YgbGluZSA9PSBcIm51bWJlclwiID8gUG9zKGxpbmUsIGNoIHx8IDApIDogbGluZSksIG51bGwsIG9wdGlvbnMpO1xuICAgIH0pLFxuICAgIHNldFNlbGVjdGlvbjogZG9jTWV0aG9kT3AoZnVuY3Rpb24oYW5jaG9yLCBoZWFkLCBvcHRpb25zKSB7XG4gICAgICBzZXRTaW1wbGVTZWxlY3Rpb24odGhpcywgY2xpcFBvcyh0aGlzLCBhbmNob3IpLCBjbGlwUG9zKHRoaXMsIGhlYWQgfHwgYW5jaG9yKSwgb3B0aW9ucyk7XG4gICAgfSksXG4gICAgZXh0ZW5kU2VsZWN0aW9uOiBkb2NNZXRob2RPcChmdW5jdGlvbihoZWFkLCBvdGhlciwgb3B0aW9ucykge1xuICAgICAgZXh0ZW5kU2VsZWN0aW9uKHRoaXMsIGNsaXBQb3ModGhpcywgaGVhZCksIG90aGVyICYmIGNsaXBQb3ModGhpcywgb3RoZXIpLCBvcHRpb25zKTtcbiAgICB9KSxcbiAgICBleHRlbmRTZWxlY3Rpb25zOiBkb2NNZXRob2RPcChmdW5jdGlvbihoZWFkcywgb3B0aW9ucykge1xuICAgICAgZXh0ZW5kU2VsZWN0aW9ucyh0aGlzLCBjbGlwUG9zQXJyYXkodGhpcywgaGVhZHMsIG9wdGlvbnMpKTtcbiAgICB9KSxcbiAgICBleHRlbmRTZWxlY3Rpb25zQnk6IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGYsIG9wdGlvbnMpIHtcbiAgICAgIGV4dGVuZFNlbGVjdGlvbnModGhpcywgbWFwKHRoaXMuc2VsLnJhbmdlcywgZiksIG9wdGlvbnMpO1xuICAgIH0pLFxuICAgIHNldFNlbGVjdGlvbnM6IGRvY01ldGhvZE9wKGZ1bmN0aW9uKHJhbmdlcywgcHJpbWFyeSwgb3B0aW9ucykge1xuICAgICAgaWYgKCFyYW5nZXMubGVuZ3RoKSByZXR1cm47XG4gICAgICBmb3IgKHZhciBpID0gMCwgb3V0ID0gW107IGkgPCByYW5nZXMubGVuZ3RoOyBpKyspXG4gICAgICAgIG91dFtpXSA9IG5ldyBSYW5nZShjbGlwUG9zKHRoaXMsIHJhbmdlc1tpXS5hbmNob3IpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpcFBvcyh0aGlzLCByYW5nZXNbaV0uaGVhZCkpO1xuICAgICAgaWYgKHByaW1hcnkgPT0gbnVsbCkgcHJpbWFyeSA9IE1hdGgubWluKHJhbmdlcy5sZW5ndGggLSAxLCB0aGlzLnNlbC5wcmltSW5kZXgpO1xuICAgICAgc2V0U2VsZWN0aW9uKHRoaXMsIG5vcm1hbGl6ZVNlbGVjdGlvbihvdXQsIHByaW1hcnkpLCBvcHRpb25zKTtcbiAgICB9KSxcbiAgICBhZGRTZWxlY3Rpb246IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGFuY2hvciwgaGVhZCwgb3B0aW9ucykge1xuICAgICAgdmFyIHJhbmdlcyA9IHRoaXMuc2VsLnJhbmdlcy5zbGljZSgwKTtcbiAgICAgIHJhbmdlcy5wdXNoKG5ldyBSYW5nZShjbGlwUG9zKHRoaXMsIGFuY2hvciksIGNsaXBQb3ModGhpcywgaGVhZCB8fCBhbmNob3IpKSk7XG4gICAgICBzZXRTZWxlY3Rpb24odGhpcywgbm9ybWFsaXplU2VsZWN0aW9uKHJhbmdlcywgcmFuZ2VzLmxlbmd0aCAtIDEpLCBvcHRpb25zKTtcbiAgICB9KSxcblxuICAgIGdldFNlbGVjdGlvbjogZnVuY3Rpb24obGluZVNlcCkge1xuICAgICAgdmFyIHJhbmdlcyA9IHRoaXMuc2VsLnJhbmdlcywgbGluZXM7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgc2VsID0gZ2V0QmV0d2Vlbih0aGlzLCByYW5nZXNbaV0uZnJvbSgpLCByYW5nZXNbaV0udG8oKSk7XG4gICAgICAgIGxpbmVzID0gbGluZXMgPyBsaW5lcy5jb25jYXQoc2VsKSA6IHNlbDtcbiAgICAgIH1cbiAgICAgIGlmIChsaW5lU2VwID09PSBmYWxzZSkgcmV0dXJuIGxpbmVzO1xuICAgICAgZWxzZSByZXR1cm4gbGluZXMuam9pbihsaW5lU2VwIHx8IHRoaXMubGluZVNlcGFyYXRvcigpKTtcbiAgICB9LFxuICAgIGdldFNlbGVjdGlvbnM6IGZ1bmN0aW9uKGxpbmVTZXApIHtcbiAgICAgIHZhciBwYXJ0cyA9IFtdLCByYW5nZXMgPSB0aGlzLnNlbC5yYW5nZXM7XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgc2VsID0gZ2V0QmV0d2Vlbih0aGlzLCByYW5nZXNbaV0uZnJvbSgpLCByYW5nZXNbaV0udG8oKSk7XG4gICAgICAgIGlmIChsaW5lU2VwICE9PSBmYWxzZSkgc2VsID0gc2VsLmpvaW4obGluZVNlcCB8fCB0aGlzLmxpbmVTZXBhcmF0b3IoKSk7XG4gICAgICAgIHBhcnRzW2ldID0gc2VsO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHBhcnRzO1xuICAgIH0sXG4gICAgcmVwbGFjZVNlbGVjdGlvbjogZnVuY3Rpb24oY29kZSwgY29sbGFwc2UsIG9yaWdpbikge1xuICAgICAgdmFyIGR1cCA9IFtdO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNlbC5yYW5nZXMubGVuZ3RoOyBpKyspXG4gICAgICAgIGR1cFtpXSA9IGNvZGU7XG4gICAgICB0aGlzLnJlcGxhY2VTZWxlY3Rpb25zKGR1cCwgY29sbGFwc2UsIG9yaWdpbiB8fCBcIitpbnB1dFwiKTtcbiAgICB9LFxuICAgIHJlcGxhY2VTZWxlY3Rpb25zOiBkb2NNZXRob2RPcChmdW5jdGlvbihjb2RlLCBjb2xsYXBzZSwgb3JpZ2luKSB7XG4gICAgICB2YXIgY2hhbmdlcyA9IFtdLCBzZWwgPSB0aGlzLnNlbDtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsLnJhbmdlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YXIgcmFuZ2UgPSBzZWwucmFuZ2VzW2ldO1xuICAgICAgICBjaGFuZ2VzW2ldID0ge2Zyb206IHJhbmdlLmZyb20oKSwgdG86IHJhbmdlLnRvKCksIHRleHQ6IHRoaXMuc3BsaXRMaW5lcyhjb2RlW2ldKSwgb3JpZ2luOiBvcmlnaW59O1xuICAgICAgfVxuICAgICAgdmFyIG5ld1NlbCA9IGNvbGxhcHNlICYmIGNvbGxhcHNlICE9IFwiZW5kXCIgJiYgY29tcHV0ZVJlcGxhY2VkU2VsKHRoaXMsIGNoYW5nZXMsIGNvbGxhcHNlKTtcbiAgICAgIGZvciAodmFyIGkgPSBjaGFuZ2VzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKVxuICAgICAgICBtYWtlQ2hhbmdlKHRoaXMsIGNoYW5nZXNbaV0pO1xuICAgICAgaWYgKG5ld1NlbCkgc2V0U2VsZWN0aW9uUmVwbGFjZUhpc3RvcnkodGhpcywgbmV3U2VsKTtcbiAgICAgIGVsc2UgaWYgKHRoaXMuY20pIGVuc3VyZUN1cnNvclZpc2libGUodGhpcy5jbSk7XG4gICAgfSksXG4gICAgdW5kbzogZG9jTWV0aG9kT3AoZnVuY3Rpb24oKSB7bWFrZUNoYW5nZUZyb21IaXN0b3J5KHRoaXMsIFwidW5kb1wiKTt9KSxcbiAgICByZWRvOiBkb2NNZXRob2RPcChmdW5jdGlvbigpIHttYWtlQ2hhbmdlRnJvbUhpc3RvcnkodGhpcywgXCJyZWRvXCIpO30pLFxuICAgIHVuZG9TZWxlY3Rpb246IGRvY01ldGhvZE9wKGZ1bmN0aW9uKCkge21ha2VDaGFuZ2VGcm9tSGlzdG9yeSh0aGlzLCBcInVuZG9cIiwgdHJ1ZSk7fSksXG4gICAgcmVkb1NlbGVjdGlvbjogZG9jTWV0aG9kT3AoZnVuY3Rpb24oKSB7bWFrZUNoYW5nZUZyb21IaXN0b3J5KHRoaXMsIFwicmVkb1wiLCB0cnVlKTt9KSxcblxuICAgIHNldEV4dGVuZGluZzogZnVuY3Rpb24odmFsKSB7dGhpcy5leHRlbmQgPSB2YWw7fSxcbiAgICBnZXRFeHRlbmRpbmc6IGZ1bmN0aW9uKCkge3JldHVybiB0aGlzLmV4dGVuZDt9LFxuXG4gICAgaGlzdG9yeVNpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGhpc3QgPSB0aGlzLmhpc3RvcnksIGRvbmUgPSAwLCB1bmRvbmUgPSAwO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoaXN0LmRvbmUubGVuZ3RoOyBpKyspIGlmICghaGlzdC5kb25lW2ldLnJhbmdlcykgKytkb25lO1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoaXN0LnVuZG9uZS5sZW5ndGg7IGkrKykgaWYgKCFoaXN0LnVuZG9uZVtpXS5yYW5nZXMpICsrdW5kb25lO1xuICAgICAgcmV0dXJuIHt1bmRvOiBkb25lLCByZWRvOiB1bmRvbmV9O1xuICAgIH0sXG4gICAgY2xlYXJIaXN0b3J5OiBmdW5jdGlvbigpIHt0aGlzLmhpc3RvcnkgPSBuZXcgSGlzdG9yeSh0aGlzLmhpc3RvcnkubWF4R2VuZXJhdGlvbik7fSxcblxuICAgIG1hcmtDbGVhbjogZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmNsZWFuR2VuZXJhdGlvbiA9IHRoaXMuY2hhbmdlR2VuZXJhdGlvbih0cnVlKTtcbiAgICB9LFxuICAgIGNoYW5nZUdlbmVyYXRpb246IGZ1bmN0aW9uKGZvcmNlU3BsaXQpIHtcbiAgICAgIGlmIChmb3JjZVNwbGl0KVxuICAgICAgICB0aGlzLmhpc3RvcnkubGFzdE9wID0gdGhpcy5oaXN0b3J5Lmxhc3RTZWxPcCA9IHRoaXMuaGlzdG9yeS5sYXN0T3JpZ2luID0gbnVsbDtcbiAgICAgIHJldHVybiB0aGlzLmhpc3RvcnkuZ2VuZXJhdGlvbjtcbiAgICB9LFxuICAgIGlzQ2xlYW46IGZ1bmN0aW9uIChnZW4pIHtcbiAgICAgIHJldHVybiB0aGlzLmhpc3RvcnkuZ2VuZXJhdGlvbiA9PSAoZ2VuIHx8IHRoaXMuY2xlYW5HZW5lcmF0aW9uKTtcbiAgICB9LFxuXG4gICAgZ2V0SGlzdG9yeTogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4ge2RvbmU6IGNvcHlIaXN0b3J5QXJyYXkodGhpcy5oaXN0b3J5LmRvbmUpLFxuICAgICAgICAgICAgICB1bmRvbmU6IGNvcHlIaXN0b3J5QXJyYXkodGhpcy5oaXN0b3J5LnVuZG9uZSl9O1xuICAgIH0sXG4gICAgc2V0SGlzdG9yeTogZnVuY3Rpb24oaGlzdERhdGEpIHtcbiAgICAgIHZhciBoaXN0ID0gdGhpcy5oaXN0b3J5ID0gbmV3IEhpc3RvcnkodGhpcy5oaXN0b3J5Lm1heEdlbmVyYXRpb24pO1xuICAgICAgaGlzdC5kb25lID0gY29weUhpc3RvcnlBcnJheShoaXN0RGF0YS5kb25lLnNsaWNlKDApLCBudWxsLCB0cnVlKTtcbiAgICAgIGhpc3QudW5kb25lID0gY29weUhpc3RvcnlBcnJheShoaXN0RGF0YS51bmRvbmUuc2xpY2UoMCksIG51bGwsIHRydWUpO1xuICAgIH0sXG5cbiAgICBhZGRMaW5lQ2xhc3M6IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGhhbmRsZSwgd2hlcmUsIGNscykge1xuICAgICAgcmV0dXJuIGNoYW5nZUxpbmUodGhpcywgaGFuZGxlLCB3aGVyZSA9PSBcImd1dHRlclwiID8gXCJndXR0ZXJcIiA6IFwiY2xhc3NcIiwgZnVuY3Rpb24obGluZSkge1xuICAgICAgICB2YXIgcHJvcCA9IHdoZXJlID09IFwidGV4dFwiID8gXCJ0ZXh0Q2xhc3NcIlxuICAgICAgICAgICAgICAgICA6IHdoZXJlID09IFwiYmFja2dyb3VuZFwiID8gXCJiZ0NsYXNzXCJcbiAgICAgICAgICAgICAgICAgOiB3aGVyZSA9PSBcImd1dHRlclwiID8gXCJndXR0ZXJDbGFzc1wiIDogXCJ3cmFwQ2xhc3NcIjtcbiAgICAgICAgaWYgKCFsaW5lW3Byb3BdKSBsaW5lW3Byb3BdID0gY2xzO1xuICAgICAgICBlbHNlIGlmIChjbGFzc1Rlc3QoY2xzKS50ZXN0KGxpbmVbcHJvcF0pKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGVsc2UgbGluZVtwcm9wXSArPSBcIiBcIiArIGNscztcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9KTtcbiAgICB9KSxcbiAgICByZW1vdmVMaW5lQ2xhc3M6IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGhhbmRsZSwgd2hlcmUsIGNscykge1xuICAgICAgcmV0dXJuIGNoYW5nZUxpbmUodGhpcywgaGFuZGxlLCB3aGVyZSA9PSBcImd1dHRlclwiID8gXCJndXR0ZXJcIiA6IFwiY2xhc3NcIiwgZnVuY3Rpb24obGluZSkge1xuICAgICAgICB2YXIgcHJvcCA9IHdoZXJlID09IFwidGV4dFwiID8gXCJ0ZXh0Q2xhc3NcIlxuICAgICAgICAgICAgICAgICA6IHdoZXJlID09IFwiYmFja2dyb3VuZFwiID8gXCJiZ0NsYXNzXCJcbiAgICAgICAgICAgICAgICAgOiB3aGVyZSA9PSBcImd1dHRlclwiID8gXCJndXR0ZXJDbGFzc1wiIDogXCJ3cmFwQ2xhc3NcIjtcbiAgICAgICAgdmFyIGN1ciA9IGxpbmVbcHJvcF07XG4gICAgICAgIGlmICghY3VyKSByZXR1cm4gZmFsc2U7XG4gICAgICAgIGVsc2UgaWYgKGNscyA9PSBudWxsKSBsaW5lW3Byb3BdID0gbnVsbDtcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdmFyIGZvdW5kID0gY3VyLm1hdGNoKGNsYXNzVGVzdChjbHMpKTtcbiAgICAgICAgICBpZiAoIWZvdW5kKSByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgdmFyIGVuZCA9IGZvdW5kLmluZGV4ICsgZm91bmRbMF0ubGVuZ3RoO1xuICAgICAgICAgIGxpbmVbcHJvcF0gPSBjdXIuc2xpY2UoMCwgZm91bmQuaW5kZXgpICsgKCFmb3VuZC5pbmRleCB8fCBlbmQgPT0gY3VyLmxlbmd0aCA/IFwiXCIgOiBcIiBcIikgKyBjdXIuc2xpY2UoZW5kKSB8fCBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSk7XG4gICAgfSksXG5cbiAgICBhZGRMaW5lV2lkZ2V0OiBkb2NNZXRob2RPcChmdW5jdGlvbihoYW5kbGUsIG5vZGUsIG9wdGlvbnMpIHtcbiAgICAgIHJldHVybiBhZGRMaW5lV2lkZ2V0KHRoaXMsIGhhbmRsZSwgbm9kZSwgb3B0aW9ucyk7XG4gICAgfSksXG4gICAgcmVtb3ZlTGluZVdpZGdldDogZnVuY3Rpb24od2lkZ2V0KSB7IHdpZGdldC5jbGVhcigpOyB9LFxuXG4gICAgbWFya1RleHQ6IGZ1bmN0aW9uKGZyb20sIHRvLCBvcHRpb25zKSB7XG4gICAgICByZXR1cm4gbWFya1RleHQodGhpcywgY2xpcFBvcyh0aGlzLCBmcm9tKSwgY2xpcFBvcyh0aGlzLCB0byksIG9wdGlvbnMsIG9wdGlvbnMgJiYgb3B0aW9ucy50eXBlIHx8IFwicmFuZ2VcIik7XG4gICAgfSxcbiAgICBzZXRCb29rbWFyazogZnVuY3Rpb24ocG9zLCBvcHRpb25zKSB7XG4gICAgICB2YXIgcmVhbE9wdHMgPSB7cmVwbGFjZWRXaXRoOiBvcHRpb25zICYmIChvcHRpb25zLm5vZGVUeXBlID09IG51bGwgPyBvcHRpb25zLndpZGdldCA6IG9wdGlvbnMpLFxuICAgICAgICAgICAgICAgICAgICAgIGluc2VydExlZnQ6IG9wdGlvbnMgJiYgb3B0aW9ucy5pbnNlcnRMZWZ0LFxuICAgICAgICAgICAgICAgICAgICAgIGNsZWFyV2hlbkVtcHR5OiBmYWxzZSwgc2hhcmVkOiBvcHRpb25zICYmIG9wdGlvbnMuc2hhcmVkLFxuICAgICAgICAgICAgICAgICAgICAgIGhhbmRsZU1vdXNlRXZlbnRzOiBvcHRpb25zICYmIG9wdGlvbnMuaGFuZGxlTW91c2VFdmVudHN9O1xuICAgICAgcG9zID0gY2xpcFBvcyh0aGlzLCBwb3MpO1xuICAgICAgcmV0dXJuIG1hcmtUZXh0KHRoaXMsIHBvcywgcG9zLCByZWFsT3B0cywgXCJib29rbWFya1wiKTtcbiAgICB9LFxuICAgIGZpbmRNYXJrc0F0OiBmdW5jdGlvbihwb3MpIHtcbiAgICAgIHBvcyA9IGNsaXBQb3ModGhpcywgcG9zKTtcbiAgICAgIHZhciBtYXJrZXJzID0gW10sIHNwYW5zID0gZ2V0TGluZSh0aGlzLCBwb3MubGluZSkubWFya2VkU3BhbnM7XG4gICAgICBpZiAoc3BhbnMpIGZvciAodmFyIGkgPSAwOyBpIDwgc3BhbnMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgdmFyIHNwYW4gPSBzcGFuc1tpXTtcbiAgICAgICAgaWYgKChzcGFuLmZyb20gPT0gbnVsbCB8fCBzcGFuLmZyb20gPD0gcG9zLmNoKSAmJlxuICAgICAgICAgICAgKHNwYW4udG8gPT0gbnVsbCB8fCBzcGFuLnRvID49IHBvcy5jaCkpXG4gICAgICAgICAgbWFya2Vycy5wdXNoKHNwYW4ubWFya2VyLnBhcmVudCB8fCBzcGFuLm1hcmtlcik7XG4gICAgICB9XG4gICAgICByZXR1cm4gbWFya2VycztcbiAgICB9LFxuICAgIGZpbmRNYXJrczogZnVuY3Rpb24oZnJvbSwgdG8sIGZpbHRlcikge1xuICAgICAgZnJvbSA9IGNsaXBQb3ModGhpcywgZnJvbSk7IHRvID0gY2xpcFBvcyh0aGlzLCB0byk7XG4gICAgICB2YXIgZm91bmQgPSBbXSwgbGluZU5vID0gZnJvbS5saW5lO1xuICAgICAgdGhpcy5pdGVyKGZyb20ubGluZSwgdG8ubGluZSArIDEsIGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgICAgdmFyIHNwYW5zID0gbGluZS5tYXJrZWRTcGFucztcbiAgICAgICAgaWYgKHNwYW5zKSBmb3IgKHZhciBpID0gMDsgaSA8IHNwYW5zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgdmFyIHNwYW4gPSBzcGFuc1tpXTtcbiAgICAgICAgICBpZiAoIShsaW5lTm8gPT0gZnJvbS5saW5lICYmIGZyb20uY2ggPiBzcGFuLnRvIHx8XG4gICAgICAgICAgICAgICAgc3Bhbi5mcm9tID09IG51bGwgJiYgbGluZU5vICE9IGZyb20ubGluZXx8XG4gICAgICAgICAgICAgICAgbGluZU5vID09IHRvLmxpbmUgJiYgc3Bhbi5mcm9tID4gdG8uY2gpICYmXG4gICAgICAgICAgICAgICghZmlsdGVyIHx8IGZpbHRlcihzcGFuLm1hcmtlcikpKVxuICAgICAgICAgICAgZm91bmQucHVzaChzcGFuLm1hcmtlci5wYXJlbnQgfHwgc3Bhbi5tYXJrZXIpO1xuICAgICAgICB9XG4gICAgICAgICsrbGluZU5vO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZm91bmQ7XG4gICAgfSxcbiAgICBnZXRBbGxNYXJrczogZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgbWFya2VycyA9IFtdO1xuICAgICAgdGhpcy5pdGVyKGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgICAgdmFyIHNwcyA9IGxpbmUubWFya2VkU3BhbnM7XG4gICAgICAgIGlmIChzcHMpIGZvciAodmFyIGkgPSAwOyBpIDwgc3BzLmxlbmd0aDsgKytpKVxuICAgICAgICAgIGlmIChzcHNbaV0uZnJvbSAhPSBudWxsKSBtYXJrZXJzLnB1c2goc3BzW2ldLm1hcmtlcik7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBtYXJrZXJzO1xuICAgIH0sXG5cbiAgICBwb3NGcm9tSW5kZXg6IGZ1bmN0aW9uKG9mZikge1xuICAgICAgdmFyIGNoLCBsaW5lTm8gPSB0aGlzLmZpcnN0O1xuICAgICAgdGhpcy5pdGVyKGZ1bmN0aW9uKGxpbmUpIHtcbiAgICAgICAgdmFyIHN6ID0gbGluZS50ZXh0Lmxlbmd0aCArIDE7XG4gICAgICAgIGlmIChzeiA+IG9mZikgeyBjaCA9IG9mZjsgcmV0dXJuIHRydWU7IH1cbiAgICAgICAgb2ZmIC09IHN6O1xuICAgICAgICArK2xpbmVObztcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGNsaXBQb3ModGhpcywgUG9zKGxpbmVObywgY2gpKTtcbiAgICB9LFxuICAgIGluZGV4RnJvbVBvczogZnVuY3Rpb24gKGNvb3Jkcykge1xuICAgICAgY29vcmRzID0gY2xpcFBvcyh0aGlzLCBjb29yZHMpO1xuICAgICAgdmFyIGluZGV4ID0gY29vcmRzLmNoO1xuICAgICAgaWYgKGNvb3Jkcy5saW5lIDwgdGhpcy5maXJzdCB8fCBjb29yZHMuY2ggPCAwKSByZXR1cm4gMDtcbiAgICAgIHRoaXMuaXRlcih0aGlzLmZpcnN0LCBjb29yZHMubGluZSwgZnVuY3Rpb24gKGxpbmUpIHtcbiAgICAgICAgaW5kZXggKz0gbGluZS50ZXh0Lmxlbmd0aCArIDE7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBpbmRleDtcbiAgICB9LFxuXG4gICAgY29weTogZnVuY3Rpb24oY29weUhpc3RvcnkpIHtcbiAgICAgIHZhciBkb2MgPSBuZXcgRG9jKGdldExpbmVzKHRoaXMsIHRoaXMuZmlyc3QsIHRoaXMuZmlyc3QgKyB0aGlzLnNpemUpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RlT3B0aW9uLCB0aGlzLmZpcnN0LCB0aGlzLmxpbmVTZXApO1xuICAgICAgZG9jLnNjcm9sbFRvcCA9IHRoaXMuc2Nyb2xsVG9wOyBkb2Muc2Nyb2xsTGVmdCA9IHRoaXMuc2Nyb2xsTGVmdDtcbiAgICAgIGRvYy5zZWwgPSB0aGlzLnNlbDtcbiAgICAgIGRvYy5leHRlbmQgPSBmYWxzZTtcbiAgICAgIGlmIChjb3B5SGlzdG9yeSkge1xuICAgICAgICBkb2MuaGlzdG9yeS51bmRvRGVwdGggPSB0aGlzLmhpc3RvcnkudW5kb0RlcHRoO1xuICAgICAgICBkb2Muc2V0SGlzdG9yeSh0aGlzLmdldEhpc3RvcnkoKSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZG9jO1xuICAgIH0sXG5cbiAgICBsaW5rZWREb2M6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcbiAgICAgIGlmICghb3B0aW9ucykgb3B0aW9ucyA9IHt9O1xuICAgICAgdmFyIGZyb20gPSB0aGlzLmZpcnN0LCB0byA9IHRoaXMuZmlyc3QgKyB0aGlzLnNpemU7XG4gICAgICBpZiAob3B0aW9ucy5mcm9tICE9IG51bGwgJiYgb3B0aW9ucy5mcm9tID4gZnJvbSkgZnJvbSA9IG9wdGlvbnMuZnJvbTtcbiAgICAgIGlmIChvcHRpb25zLnRvICE9IG51bGwgJiYgb3B0aW9ucy50byA8IHRvKSB0byA9IG9wdGlvbnMudG87XG4gICAgICB2YXIgY29weSA9IG5ldyBEb2MoZ2V0TGluZXModGhpcywgZnJvbSwgdG8pLCBvcHRpb25zLm1vZGUgfHwgdGhpcy5tb2RlT3B0aW9uLCBmcm9tLCB0aGlzLmxpbmVTZXApO1xuICAgICAgaWYgKG9wdGlvbnMuc2hhcmVkSGlzdCkgY29weS5oaXN0b3J5ID0gdGhpcy5oaXN0b3J5O1xuICAgICAgKHRoaXMubGlua2VkIHx8ICh0aGlzLmxpbmtlZCA9IFtdKSkucHVzaCh7ZG9jOiBjb3B5LCBzaGFyZWRIaXN0OiBvcHRpb25zLnNoYXJlZEhpc3R9KTtcbiAgICAgIGNvcHkubGlua2VkID0gW3tkb2M6IHRoaXMsIGlzUGFyZW50OiB0cnVlLCBzaGFyZWRIaXN0OiBvcHRpb25zLnNoYXJlZEhpc3R9XTtcbiAgICAgIGNvcHlTaGFyZWRNYXJrZXJzKGNvcHksIGZpbmRTaGFyZWRNYXJrZXJzKHRoaXMpKTtcbiAgICAgIHJldHVybiBjb3B5O1xuICAgIH0sXG4gICAgdW5saW5rRG9jOiBmdW5jdGlvbihvdGhlcikge1xuICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2YgQ29kZU1pcnJvcikgb3RoZXIgPSBvdGhlci5kb2M7XG4gICAgICBpZiAodGhpcy5saW5rZWQpIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5saW5rZWQubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgdmFyIGxpbmsgPSB0aGlzLmxpbmtlZFtpXTtcbiAgICAgICAgaWYgKGxpbmsuZG9jICE9IG90aGVyKSBjb250aW51ZTtcbiAgICAgICAgdGhpcy5saW5rZWQuc3BsaWNlKGksIDEpO1xuICAgICAgICBvdGhlci51bmxpbmtEb2ModGhpcyk7XG4gICAgICAgIGRldGFjaFNoYXJlZE1hcmtlcnMoZmluZFNoYXJlZE1hcmtlcnModGhpcykpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIC8vIElmIHRoZSBoaXN0b3JpZXMgd2VyZSBzaGFyZWQsIHNwbGl0IHRoZW0gYWdhaW5cbiAgICAgIGlmIChvdGhlci5oaXN0b3J5ID09IHRoaXMuaGlzdG9yeSkge1xuICAgICAgICB2YXIgc3BsaXRJZHMgPSBbb3RoZXIuaWRdO1xuICAgICAgICBsaW5rZWREb2NzKG90aGVyLCBmdW5jdGlvbihkb2MpIHtzcGxpdElkcy5wdXNoKGRvYy5pZCk7fSwgdHJ1ZSk7XG4gICAgICAgIG90aGVyLmhpc3RvcnkgPSBuZXcgSGlzdG9yeShudWxsKTtcbiAgICAgICAgb3RoZXIuaGlzdG9yeS5kb25lID0gY29weUhpc3RvcnlBcnJheSh0aGlzLmhpc3RvcnkuZG9uZSwgc3BsaXRJZHMpO1xuICAgICAgICBvdGhlci5oaXN0b3J5LnVuZG9uZSA9IGNvcHlIaXN0b3J5QXJyYXkodGhpcy5oaXN0b3J5LnVuZG9uZSwgc3BsaXRJZHMpO1xuICAgICAgfVxuICAgIH0sXG4gICAgaXRlckxpbmtlZERvY3M6IGZ1bmN0aW9uKGYpIHtsaW5rZWREb2NzKHRoaXMsIGYpO30sXG5cbiAgICBnZXRNb2RlOiBmdW5jdGlvbigpIHtyZXR1cm4gdGhpcy5tb2RlO30sXG4gICAgZ2V0RWRpdG9yOiBmdW5jdGlvbigpIHtyZXR1cm4gdGhpcy5jbTt9LFxuXG4gICAgc3BsaXRMaW5lczogZnVuY3Rpb24oc3RyKSB7XG4gICAgICBpZiAodGhpcy5saW5lU2VwKSByZXR1cm4gc3RyLnNwbGl0KHRoaXMubGluZVNlcCk7XG4gICAgICByZXR1cm4gc3BsaXRMaW5lc0F1dG8oc3RyKTtcbiAgICB9LFxuICAgIGxpbmVTZXBhcmF0b3I6IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpcy5saW5lU2VwIHx8IFwiXFxuXCI7IH1cbiAgfSk7XG5cbiAgLy8gUHVibGljIGFsaWFzLlxuICBEb2MucHJvdG90eXBlLmVhY2hMaW5lID0gRG9jLnByb3RvdHlwZS5pdGVyO1xuXG4gIC8vIFNldCB1cCBtZXRob2RzIG9uIENvZGVNaXJyb3IncyBwcm90b3R5cGUgdG8gcmVkaXJlY3QgdG8gdGhlIGVkaXRvcidzIGRvY3VtZW50LlxuICB2YXIgZG9udERlbGVnYXRlID0gXCJpdGVyIGluc2VydCByZW1vdmUgY29weSBnZXRFZGl0b3IgY29uc3RydWN0b3JcIi5zcGxpdChcIiBcIik7XG4gIGZvciAodmFyIHByb3AgaW4gRG9jLnByb3RvdHlwZSkgaWYgKERvYy5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkocHJvcCkgJiYgaW5kZXhPZihkb250RGVsZWdhdGUsIHByb3ApIDwgMClcbiAgICBDb2RlTWlycm9yLnByb3RvdHlwZVtwcm9wXSA9IChmdW5jdGlvbihtZXRob2QpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbigpIHtyZXR1cm4gbWV0aG9kLmFwcGx5KHRoaXMuZG9jLCBhcmd1bWVudHMpO307XG4gICAgfSkoRG9jLnByb3RvdHlwZVtwcm9wXSk7XG5cbiAgZXZlbnRNaXhpbihEb2MpO1xuXG4gIC8vIENhbGwgZiBmb3IgYWxsIGxpbmtlZCBkb2N1bWVudHMuXG4gIGZ1bmN0aW9uIGxpbmtlZERvY3MoZG9jLCBmLCBzaGFyZWRIaXN0T25seSkge1xuICAgIGZ1bmN0aW9uIHByb3BhZ2F0ZShkb2MsIHNraXAsIHNoYXJlZEhpc3QpIHtcbiAgICAgIGlmIChkb2MubGlua2VkKSBmb3IgKHZhciBpID0gMDsgaSA8IGRvYy5saW5rZWQubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgdmFyIHJlbCA9IGRvYy5saW5rZWRbaV07XG4gICAgICAgIGlmIChyZWwuZG9jID09IHNraXApIGNvbnRpbnVlO1xuICAgICAgICB2YXIgc2hhcmVkID0gc2hhcmVkSGlzdCAmJiByZWwuc2hhcmVkSGlzdDtcbiAgICAgICAgaWYgKHNoYXJlZEhpc3RPbmx5ICYmICFzaGFyZWQpIGNvbnRpbnVlO1xuICAgICAgICBmKHJlbC5kb2MsIHNoYXJlZCk7XG4gICAgICAgIHByb3BhZ2F0ZShyZWwuZG9jLCBkb2MsIHNoYXJlZCk7XG4gICAgICB9XG4gICAgfVxuICAgIHByb3BhZ2F0ZShkb2MsIG51bGwsIHRydWUpO1xuICB9XG5cbiAgLy8gQXR0YWNoIGEgZG9jdW1lbnQgdG8gYW4gZWRpdG9yLlxuICBmdW5jdGlvbiBhdHRhY2hEb2MoY20sIGRvYykge1xuICAgIGlmIChkb2MuY20pIHRocm93IG5ldyBFcnJvcihcIlRoaXMgZG9jdW1lbnQgaXMgYWxyZWFkeSBpbiB1c2UuXCIpO1xuICAgIGNtLmRvYyA9IGRvYztcbiAgICBkb2MuY20gPSBjbTtcbiAgICBlc3RpbWF0ZUxpbmVIZWlnaHRzKGNtKTtcbiAgICBsb2FkTW9kZShjbSk7XG4gICAgaWYgKCFjbS5vcHRpb25zLmxpbmVXcmFwcGluZykgZmluZE1heExpbmUoY20pO1xuICAgIGNtLm9wdGlvbnMubW9kZSA9IGRvYy5tb2RlT3B0aW9uO1xuICAgIHJlZ0NoYW5nZShjbSk7XG4gIH1cblxuICAvLyBMSU5FIFVUSUxJVElFU1xuXG4gIC8vIEZpbmQgdGhlIGxpbmUgb2JqZWN0IGNvcnJlc3BvbmRpbmcgdG8gdGhlIGdpdmVuIGxpbmUgbnVtYmVyLlxuICBmdW5jdGlvbiBnZXRMaW5lKGRvYywgbikge1xuICAgIG4gLT0gZG9jLmZpcnN0O1xuICAgIGlmIChuIDwgMCB8fCBuID49IGRvYy5zaXplKSB0aHJvdyBuZXcgRXJyb3IoXCJUaGVyZSBpcyBubyBsaW5lIFwiICsgKG4gKyBkb2MuZmlyc3QpICsgXCIgaW4gdGhlIGRvY3VtZW50LlwiKTtcbiAgICBmb3IgKHZhciBjaHVuayA9IGRvYzsgIWNodW5rLmxpbmVzOykge1xuICAgICAgZm9yICh2YXIgaSA9IDA7OyArK2kpIHtcbiAgICAgICAgdmFyIGNoaWxkID0gY2h1bmsuY2hpbGRyZW5baV0sIHN6ID0gY2hpbGQuY2h1bmtTaXplKCk7XG4gICAgICAgIGlmIChuIDwgc3opIHsgY2h1bmsgPSBjaGlsZDsgYnJlYWs7IH1cbiAgICAgICAgbiAtPSBzejtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNodW5rLmxpbmVzW25dO1xuICB9XG5cbiAgLy8gR2V0IHRoZSBwYXJ0IG9mIGEgZG9jdW1lbnQgYmV0d2VlbiB0d28gcG9zaXRpb25zLCBhcyBhbiBhcnJheSBvZlxuICAvLyBzdHJpbmdzLlxuICBmdW5jdGlvbiBnZXRCZXR3ZWVuKGRvYywgc3RhcnQsIGVuZCkge1xuICAgIHZhciBvdXQgPSBbXSwgbiA9IHN0YXJ0LmxpbmU7XG4gICAgZG9jLml0ZXIoc3RhcnQubGluZSwgZW5kLmxpbmUgKyAxLCBmdW5jdGlvbihsaW5lKSB7XG4gICAgICB2YXIgdGV4dCA9IGxpbmUudGV4dDtcbiAgICAgIGlmIChuID09IGVuZC5saW5lKSB0ZXh0ID0gdGV4dC5zbGljZSgwLCBlbmQuY2gpO1xuICAgICAgaWYgKG4gPT0gc3RhcnQubGluZSkgdGV4dCA9IHRleHQuc2xpY2Uoc3RhcnQuY2gpO1xuICAgICAgb3V0LnB1c2godGV4dCk7XG4gICAgICArK247XG4gICAgfSk7XG4gICAgcmV0dXJuIG91dDtcbiAgfVxuICAvLyBHZXQgdGhlIGxpbmVzIGJldHdlZW4gZnJvbSBhbmQgdG8sIGFzIGFycmF5IG9mIHN0cmluZ3MuXG4gIGZ1bmN0aW9uIGdldExpbmVzKGRvYywgZnJvbSwgdG8pIHtcbiAgICB2YXIgb3V0ID0gW107XG4gICAgZG9jLml0ZXIoZnJvbSwgdG8sIGZ1bmN0aW9uKGxpbmUpIHsgb3V0LnB1c2gobGluZS50ZXh0KTsgfSk7XG4gICAgcmV0dXJuIG91dDtcbiAgfVxuXG4gIC8vIFVwZGF0ZSB0aGUgaGVpZ2h0IG9mIGEgbGluZSwgcHJvcGFnYXRpbmcgdGhlIGhlaWdodCBjaGFuZ2VcbiAgLy8gdXB3YXJkcyB0byBwYXJlbnQgbm9kZXMuXG4gIGZ1bmN0aW9uIHVwZGF0ZUxpbmVIZWlnaHQobGluZSwgaGVpZ2h0KSB7XG4gICAgdmFyIGRpZmYgPSBoZWlnaHQgLSBsaW5lLmhlaWdodDtcbiAgICBpZiAoZGlmZikgZm9yICh2YXIgbiA9IGxpbmU7IG47IG4gPSBuLnBhcmVudCkgbi5oZWlnaHQgKz0gZGlmZjtcbiAgfVxuXG4gIC8vIEdpdmVuIGEgbGluZSBvYmplY3QsIGZpbmQgaXRzIGxpbmUgbnVtYmVyIGJ5IHdhbGtpbmcgdXAgdGhyb3VnaFxuICAvLyBpdHMgcGFyZW50IGxpbmtzLlxuICBmdW5jdGlvbiBsaW5lTm8obGluZSkge1xuICAgIGlmIChsaW5lLnBhcmVudCA9PSBudWxsKSByZXR1cm4gbnVsbDtcbiAgICB2YXIgY3VyID0gbGluZS5wYXJlbnQsIG5vID0gaW5kZXhPZihjdXIubGluZXMsIGxpbmUpO1xuICAgIGZvciAodmFyIGNodW5rID0gY3VyLnBhcmVudDsgY2h1bms7IGN1ciA9IGNodW5rLCBjaHVuayA9IGNodW5rLnBhcmVudCkge1xuICAgICAgZm9yICh2YXIgaSA9IDA7OyArK2kpIHtcbiAgICAgICAgaWYgKGNodW5rLmNoaWxkcmVuW2ldID09IGN1cikgYnJlYWs7XG4gICAgICAgIG5vICs9IGNodW5rLmNoaWxkcmVuW2ldLmNodW5rU2l6ZSgpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbm8gKyBjdXIuZmlyc3Q7XG4gIH1cblxuICAvLyBGaW5kIHRoZSBsaW5lIGF0IHRoZSBnaXZlbiB2ZXJ0aWNhbCBwb3NpdGlvbiwgdXNpbmcgdGhlIGhlaWdodFxuICAvLyBpbmZvcm1hdGlvbiBpbiB0aGUgZG9jdW1lbnQgdHJlZS5cbiAgZnVuY3Rpb24gbGluZUF0SGVpZ2h0KGNodW5rLCBoKSB7XG4gICAgdmFyIG4gPSBjaHVuay5maXJzdDtcbiAgICBvdXRlcjogZG8ge1xuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaHVuay5jaGlsZHJlbi5sZW5ndGg7ICsraSkge1xuICAgICAgICB2YXIgY2hpbGQgPSBjaHVuay5jaGlsZHJlbltpXSwgY2ggPSBjaGlsZC5oZWlnaHQ7XG4gICAgICAgIGlmIChoIDwgY2gpIHsgY2h1bmsgPSBjaGlsZDsgY29udGludWUgb3V0ZXI7IH1cbiAgICAgICAgaCAtPSBjaDtcbiAgICAgICAgbiArPSBjaGlsZC5jaHVua1NpemUoKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBuO1xuICAgIH0gd2hpbGUgKCFjaHVuay5saW5lcyk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaHVuay5saW5lcy5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIGxpbmUgPSBjaHVuay5saW5lc1tpXSwgbGggPSBsaW5lLmhlaWdodDtcbiAgICAgIGlmIChoIDwgbGgpIGJyZWFrO1xuICAgICAgaCAtPSBsaDtcbiAgICB9XG4gICAgcmV0dXJuIG4gKyBpO1xuICB9XG5cblxuICAvLyBGaW5kIHRoZSBoZWlnaHQgYWJvdmUgdGhlIGdpdmVuIGxpbmUuXG4gIGZ1bmN0aW9uIGhlaWdodEF0TGluZShsaW5lT2JqKSB7XG4gICAgbGluZU9iaiA9IHZpc3VhbExpbmUobGluZU9iaik7XG5cbiAgICB2YXIgaCA9IDAsIGNodW5rID0gbGluZU9iai5wYXJlbnQ7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaHVuay5saW5lcy5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIGxpbmUgPSBjaHVuay5saW5lc1tpXTtcbiAgICAgIGlmIChsaW5lID09IGxpbmVPYmopIGJyZWFrO1xuICAgICAgZWxzZSBoICs9IGxpbmUuaGVpZ2h0O1xuICAgIH1cbiAgICBmb3IgKHZhciBwID0gY2h1bmsucGFyZW50OyBwOyBjaHVuayA9IHAsIHAgPSBjaHVuay5wYXJlbnQpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcC5jaGlsZHJlbi5sZW5ndGg7ICsraSkge1xuICAgICAgICB2YXIgY3VyID0gcC5jaGlsZHJlbltpXTtcbiAgICAgICAgaWYgKGN1ciA9PSBjaHVuaykgYnJlYWs7XG4gICAgICAgIGVsc2UgaCArPSBjdXIuaGVpZ2h0O1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaDtcbiAgfVxuXG4gIC8vIEdldCB0aGUgYmlkaSBvcmRlcmluZyBmb3IgdGhlIGdpdmVuIGxpbmUgKGFuZCBjYWNoZSBpdCkuIFJldHVybnNcbiAgLy8gZmFsc2UgZm9yIGxpbmVzIHRoYXQgYXJlIGZ1bGx5IGxlZnQtdG8tcmlnaHQsIGFuZCBhbiBhcnJheSBvZlxuICAvLyBCaWRpU3BhbiBvYmplY3RzIG90aGVyd2lzZS5cbiAgZnVuY3Rpb24gZ2V0T3JkZXIobGluZSkge1xuICAgIHZhciBvcmRlciA9IGxpbmUub3JkZXI7XG4gICAgaWYgKG9yZGVyID09IG51bGwpIG9yZGVyID0gbGluZS5vcmRlciA9IGJpZGlPcmRlcmluZyhsaW5lLnRleHQpO1xuICAgIHJldHVybiBvcmRlcjtcbiAgfVxuXG4gIC8vIEhJU1RPUllcblxuICBmdW5jdGlvbiBIaXN0b3J5KHN0YXJ0R2VuKSB7XG4gICAgLy8gQXJyYXlzIG9mIGNoYW5nZSBldmVudHMgYW5kIHNlbGVjdGlvbnMuIERvaW5nIHNvbWV0aGluZyBhZGRzIGFuXG4gICAgLy8gZXZlbnQgdG8gZG9uZSBhbmQgY2xlYXJzIHVuZG8uIFVuZG9pbmcgbW92ZXMgZXZlbnRzIGZyb20gZG9uZVxuICAgIC8vIHRvIHVuZG9uZSwgcmVkb2luZyBtb3ZlcyB0aGVtIGluIHRoZSBvdGhlciBkaXJlY3Rpb24uXG4gICAgdGhpcy5kb25lID0gW107IHRoaXMudW5kb25lID0gW107XG4gICAgdGhpcy51bmRvRGVwdGggPSBJbmZpbml0eTtcbiAgICAvLyBVc2VkIHRvIHRyYWNrIHdoZW4gY2hhbmdlcyBjYW4gYmUgbWVyZ2VkIGludG8gYSBzaW5nbGUgdW5kb1xuICAgIC8vIGV2ZW50XG4gICAgdGhpcy5sYXN0TW9kVGltZSA9IHRoaXMubGFzdFNlbFRpbWUgPSAwO1xuICAgIHRoaXMubGFzdE9wID0gdGhpcy5sYXN0U2VsT3AgPSBudWxsO1xuICAgIHRoaXMubGFzdE9yaWdpbiA9IHRoaXMubGFzdFNlbE9yaWdpbiA9IG51bGw7XG4gICAgLy8gVXNlZCBieSB0aGUgaXNDbGVhbigpIG1ldGhvZFxuICAgIHRoaXMuZ2VuZXJhdGlvbiA9IHRoaXMubWF4R2VuZXJhdGlvbiA9IHN0YXJ0R2VuIHx8IDE7XG4gIH1cblxuICAvLyBDcmVhdGUgYSBoaXN0b3J5IGNoYW5nZSBldmVudCBmcm9tIGFuIHVwZGF0ZURvYy1zdHlsZSBjaGFuZ2VcbiAgLy8gb2JqZWN0LlxuICBmdW5jdGlvbiBoaXN0b3J5Q2hhbmdlRnJvbUNoYW5nZShkb2MsIGNoYW5nZSkge1xuICAgIHZhciBoaXN0Q2hhbmdlID0ge2Zyb206IGNvcHlQb3MoY2hhbmdlLmZyb20pLCB0bzogY2hhbmdlRW5kKGNoYW5nZSksIHRleHQ6IGdldEJldHdlZW4oZG9jLCBjaGFuZ2UuZnJvbSwgY2hhbmdlLnRvKX07XG4gICAgYXR0YWNoTG9jYWxTcGFucyhkb2MsIGhpc3RDaGFuZ2UsIGNoYW5nZS5mcm9tLmxpbmUsIGNoYW5nZS50by5saW5lICsgMSk7XG4gICAgbGlua2VkRG9jcyhkb2MsIGZ1bmN0aW9uKGRvYykge2F0dGFjaExvY2FsU3BhbnMoZG9jLCBoaXN0Q2hhbmdlLCBjaGFuZ2UuZnJvbS5saW5lLCBjaGFuZ2UudG8ubGluZSArIDEpO30sIHRydWUpO1xuICAgIHJldHVybiBoaXN0Q2hhbmdlO1xuICB9XG5cbiAgLy8gUG9wIGFsbCBzZWxlY3Rpb24gZXZlbnRzIG9mZiB0aGUgZW5kIG9mIGEgaGlzdG9yeSBhcnJheS4gU3RvcCBhdFxuICAvLyBhIGNoYW5nZSBldmVudC5cbiAgZnVuY3Rpb24gY2xlYXJTZWxlY3Rpb25FdmVudHMoYXJyYXkpIHtcbiAgICB3aGlsZSAoYXJyYXkubGVuZ3RoKSB7XG4gICAgICB2YXIgbGFzdCA9IGxzdChhcnJheSk7XG4gICAgICBpZiAobGFzdC5yYW5nZXMpIGFycmF5LnBvcCgpO1xuICAgICAgZWxzZSBicmVhaztcbiAgICB9XG4gIH1cblxuICAvLyBGaW5kIHRoZSB0b3AgY2hhbmdlIGV2ZW50IGluIHRoZSBoaXN0b3J5LiBQb3Agb2ZmIHNlbGVjdGlvblxuICAvLyBldmVudHMgdGhhdCBhcmUgaW4gdGhlIHdheS5cbiAgZnVuY3Rpb24gbGFzdENoYW5nZUV2ZW50KGhpc3QsIGZvcmNlKSB7XG4gICAgaWYgKGZvcmNlKSB7XG4gICAgICBjbGVhclNlbGVjdGlvbkV2ZW50cyhoaXN0LmRvbmUpO1xuICAgICAgcmV0dXJuIGxzdChoaXN0LmRvbmUpO1xuICAgIH0gZWxzZSBpZiAoaGlzdC5kb25lLmxlbmd0aCAmJiAhbHN0KGhpc3QuZG9uZSkucmFuZ2VzKSB7XG4gICAgICByZXR1cm4gbHN0KGhpc3QuZG9uZSk7XG4gICAgfSBlbHNlIGlmIChoaXN0LmRvbmUubGVuZ3RoID4gMSAmJiAhaGlzdC5kb25lW2hpc3QuZG9uZS5sZW5ndGggLSAyXS5yYW5nZXMpIHtcbiAgICAgIGhpc3QuZG9uZS5wb3AoKTtcbiAgICAgIHJldHVybiBsc3QoaGlzdC5kb25lKTtcbiAgICB9XG4gIH1cblxuICAvLyBSZWdpc3RlciBhIGNoYW5nZSBpbiB0aGUgaGlzdG9yeS4gTWVyZ2VzIGNoYW5nZXMgdGhhdCBhcmUgd2l0aGluXG4gIC8vIGEgc2luZ2xlIG9wZXJhdGlvbiwgb3JlIGFyZSBjbG9zZSB0b2dldGhlciB3aXRoIGFuIG9yaWdpbiB0aGF0XG4gIC8vIGFsbG93cyBtZXJnaW5nIChzdGFydGluZyB3aXRoIFwiK1wiKSBpbnRvIGEgc2luZ2xlIGV2ZW50LlxuICBmdW5jdGlvbiBhZGRDaGFuZ2VUb0hpc3RvcnkoZG9jLCBjaGFuZ2UsIHNlbEFmdGVyLCBvcElkKSB7XG4gICAgdmFyIGhpc3QgPSBkb2MuaGlzdG9yeTtcbiAgICBoaXN0LnVuZG9uZS5sZW5ndGggPSAwO1xuICAgIHZhciB0aW1lID0gK25ldyBEYXRlLCBjdXI7XG5cbiAgICBpZiAoKGhpc3QubGFzdE9wID09IG9wSWQgfHxcbiAgICAgICAgIGhpc3QubGFzdE9yaWdpbiA9PSBjaGFuZ2Uub3JpZ2luICYmIGNoYW5nZS5vcmlnaW4gJiZcbiAgICAgICAgICgoY2hhbmdlLm9yaWdpbi5jaGFyQXQoMCkgPT0gXCIrXCIgJiYgZG9jLmNtICYmIGhpc3QubGFzdE1vZFRpbWUgPiB0aW1lIC0gZG9jLmNtLm9wdGlvbnMuaGlzdG9yeUV2ZW50RGVsYXkpIHx8XG4gICAgICAgICAgY2hhbmdlLm9yaWdpbi5jaGFyQXQoMCkgPT0gXCIqXCIpKSAmJlxuICAgICAgICAoY3VyID0gbGFzdENoYW5nZUV2ZW50KGhpc3QsIGhpc3QubGFzdE9wID09IG9wSWQpKSkge1xuICAgICAgLy8gTWVyZ2UgdGhpcyBjaGFuZ2UgaW50byB0aGUgbGFzdCBldmVudFxuICAgICAgdmFyIGxhc3QgPSBsc3QoY3VyLmNoYW5nZXMpO1xuICAgICAgaWYgKGNtcChjaGFuZ2UuZnJvbSwgY2hhbmdlLnRvKSA9PSAwICYmIGNtcChjaGFuZ2UuZnJvbSwgbGFzdC50bykgPT0gMCkge1xuICAgICAgICAvLyBPcHRpbWl6ZWQgY2FzZSBmb3Igc2ltcGxlIGluc2VydGlvbiAtLSBkb24ndCB3YW50IHRvIGFkZFxuICAgICAgICAvLyBuZXcgY2hhbmdlc2V0cyBmb3IgZXZlcnkgY2hhcmFjdGVyIHR5cGVkXG4gICAgICAgIGxhc3QudG8gPSBjaGFuZ2VFbmQoY2hhbmdlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEFkZCBuZXcgc3ViLWV2ZW50XG4gICAgICAgIGN1ci5jaGFuZ2VzLnB1c2goaGlzdG9yeUNoYW5nZUZyb21DaGFuZ2UoZG9jLCBjaGFuZ2UpKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgLy8gQ2FuIG5vdCBiZSBtZXJnZWQsIHN0YXJ0IGEgbmV3IGV2ZW50LlxuICAgICAgdmFyIGJlZm9yZSA9IGxzdChoaXN0LmRvbmUpO1xuICAgICAgaWYgKCFiZWZvcmUgfHwgIWJlZm9yZS5yYW5nZXMpXG4gICAgICAgIHB1c2hTZWxlY3Rpb25Ub0hpc3RvcnkoZG9jLnNlbCwgaGlzdC5kb25lKTtcbiAgICAgIGN1ciA9IHtjaGFuZ2VzOiBbaGlzdG9yeUNoYW5nZUZyb21DaGFuZ2UoZG9jLCBjaGFuZ2UpXSxcbiAgICAgICAgICAgICBnZW5lcmF0aW9uOiBoaXN0LmdlbmVyYXRpb259O1xuICAgICAgaGlzdC5kb25lLnB1c2goY3VyKTtcbiAgICAgIHdoaWxlIChoaXN0LmRvbmUubGVuZ3RoID4gaGlzdC51bmRvRGVwdGgpIHtcbiAgICAgICAgaGlzdC5kb25lLnNoaWZ0KCk7XG4gICAgICAgIGlmICghaGlzdC5kb25lWzBdLnJhbmdlcykgaGlzdC5kb25lLnNoaWZ0KCk7XG4gICAgICB9XG4gICAgfVxuICAgIGhpc3QuZG9uZS5wdXNoKHNlbEFmdGVyKTtcbiAgICBoaXN0LmdlbmVyYXRpb24gPSArK2hpc3QubWF4R2VuZXJhdGlvbjtcbiAgICBoaXN0Lmxhc3RNb2RUaW1lID0gaGlzdC5sYXN0U2VsVGltZSA9IHRpbWU7XG4gICAgaGlzdC5sYXN0T3AgPSBoaXN0Lmxhc3RTZWxPcCA9IG9wSWQ7XG4gICAgaGlzdC5sYXN0T3JpZ2luID0gaGlzdC5sYXN0U2VsT3JpZ2luID0gY2hhbmdlLm9yaWdpbjtcblxuICAgIGlmICghbGFzdCkgc2lnbmFsKGRvYywgXCJoaXN0b3J5QWRkZWRcIik7XG4gIH1cblxuICBmdW5jdGlvbiBzZWxlY3Rpb25FdmVudENhbkJlTWVyZ2VkKGRvYywgb3JpZ2luLCBwcmV2LCBzZWwpIHtcbiAgICB2YXIgY2ggPSBvcmlnaW4uY2hhckF0KDApO1xuICAgIHJldHVybiBjaCA9PSBcIipcIiB8fFxuICAgICAgY2ggPT0gXCIrXCIgJiZcbiAgICAgIHByZXYucmFuZ2VzLmxlbmd0aCA9PSBzZWwucmFuZ2VzLmxlbmd0aCAmJlxuICAgICAgcHJldi5zb21ldGhpbmdTZWxlY3RlZCgpID09IHNlbC5zb21ldGhpbmdTZWxlY3RlZCgpICYmXG4gICAgICBuZXcgRGF0ZSAtIGRvYy5oaXN0b3J5Lmxhc3RTZWxUaW1lIDw9IChkb2MuY20gPyBkb2MuY20ub3B0aW9ucy5oaXN0b3J5RXZlbnREZWxheSA6IDUwMCk7XG4gIH1cblxuICAvLyBDYWxsZWQgd2hlbmV2ZXIgdGhlIHNlbGVjdGlvbiBjaGFuZ2VzLCBzZXRzIHRoZSBuZXcgc2VsZWN0aW9uIGFzXG4gIC8vIHRoZSBwZW5kaW5nIHNlbGVjdGlvbiBpbiB0aGUgaGlzdG9yeSwgYW5kIHB1c2hlcyB0aGUgb2xkIHBlbmRpbmdcbiAgLy8gc2VsZWN0aW9uIGludG8gdGhlICdkb25lJyBhcnJheSB3aGVuIGl0IHdhcyBzaWduaWZpY2FudGx5XG4gIC8vIGRpZmZlcmVudCAoaW4gbnVtYmVyIG9mIHNlbGVjdGVkIHJhbmdlcywgZW1wdGluZXNzLCBvciB0aW1lKS5cbiAgZnVuY3Rpb24gYWRkU2VsZWN0aW9uVG9IaXN0b3J5KGRvYywgc2VsLCBvcElkLCBvcHRpb25zKSB7XG4gICAgdmFyIGhpc3QgPSBkb2MuaGlzdG9yeSwgb3JpZ2luID0gb3B0aW9ucyAmJiBvcHRpb25zLm9yaWdpbjtcblxuICAgIC8vIEEgbmV3IGV2ZW50IGlzIHN0YXJ0ZWQgd2hlbiB0aGUgcHJldmlvdXMgb3JpZ2luIGRvZXMgbm90IG1hdGNoXG4gICAgLy8gdGhlIGN1cnJlbnQsIG9yIHRoZSBvcmlnaW5zIGRvbid0IGFsbG93IG1hdGNoaW5nLiBPcmlnaW5zXG4gICAgLy8gc3RhcnRpbmcgd2l0aCAqIGFyZSBhbHdheXMgbWVyZ2VkLCB0aG9zZSBzdGFydGluZyB3aXRoICsgYXJlXG4gICAgLy8gbWVyZ2VkIHdoZW4gc2ltaWxhciBhbmQgY2xvc2UgdG9nZXRoZXIgaW4gdGltZS5cbiAgICBpZiAob3BJZCA9PSBoaXN0Lmxhc3RTZWxPcCB8fFxuICAgICAgICAob3JpZ2luICYmIGhpc3QubGFzdFNlbE9yaWdpbiA9PSBvcmlnaW4gJiZcbiAgICAgICAgIChoaXN0Lmxhc3RNb2RUaW1lID09IGhpc3QubGFzdFNlbFRpbWUgJiYgaGlzdC5sYXN0T3JpZ2luID09IG9yaWdpbiB8fFxuICAgICAgICAgIHNlbGVjdGlvbkV2ZW50Q2FuQmVNZXJnZWQoZG9jLCBvcmlnaW4sIGxzdChoaXN0LmRvbmUpLCBzZWwpKSkpXG4gICAgICBoaXN0LmRvbmVbaGlzdC5kb25lLmxlbmd0aCAtIDFdID0gc2VsO1xuICAgIGVsc2VcbiAgICAgIHB1c2hTZWxlY3Rpb25Ub0hpc3Rvcnkoc2VsLCBoaXN0LmRvbmUpO1xuXG4gICAgaGlzdC5sYXN0U2VsVGltZSA9ICtuZXcgRGF0ZTtcbiAgICBoaXN0Lmxhc3RTZWxPcmlnaW4gPSBvcmlnaW47XG4gICAgaGlzdC5sYXN0U2VsT3AgPSBvcElkO1xuICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuY2xlYXJSZWRvICE9PSBmYWxzZSlcbiAgICAgIGNsZWFyU2VsZWN0aW9uRXZlbnRzKGhpc3QudW5kb25lKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHB1c2hTZWxlY3Rpb25Ub0hpc3Rvcnkoc2VsLCBkZXN0KSB7XG4gICAgdmFyIHRvcCA9IGxzdChkZXN0KTtcbiAgICBpZiAoISh0b3AgJiYgdG9wLnJhbmdlcyAmJiB0b3AuZXF1YWxzKHNlbCkpKVxuICAgICAgZGVzdC5wdXNoKHNlbCk7XG4gIH1cblxuICAvLyBVc2VkIHRvIHN0b3JlIG1hcmtlZCBzcGFuIGluZm9ybWF0aW9uIGluIHRoZSBoaXN0b3J5LlxuICBmdW5jdGlvbiBhdHRhY2hMb2NhbFNwYW5zKGRvYywgY2hhbmdlLCBmcm9tLCB0bykge1xuICAgIHZhciBleGlzdGluZyA9IGNoYW5nZVtcInNwYW5zX1wiICsgZG9jLmlkXSwgbiA9IDA7XG4gICAgZG9jLml0ZXIoTWF0aC5tYXgoZG9jLmZpcnN0LCBmcm9tKSwgTWF0aC5taW4oZG9jLmZpcnN0ICsgZG9jLnNpemUsIHRvKSwgZnVuY3Rpb24obGluZSkge1xuICAgICAgaWYgKGxpbmUubWFya2VkU3BhbnMpXG4gICAgICAgIChleGlzdGluZyB8fCAoZXhpc3RpbmcgPSBjaGFuZ2VbXCJzcGFuc19cIiArIGRvYy5pZF0gPSB7fSkpW25dID0gbGluZS5tYXJrZWRTcGFucztcbiAgICAgICsrbjtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIFdoZW4gdW4vcmUtZG9pbmcgcmVzdG9yZXMgdGV4dCBjb250YWluaW5nIG1hcmtlZCBzcGFucywgdGhvc2VcbiAgLy8gdGhhdCBoYXZlIGJlZW4gZXhwbGljaXRseSBjbGVhcmVkIHNob3VsZCBub3QgYmUgcmVzdG9yZWQuXG4gIGZ1bmN0aW9uIHJlbW92ZUNsZWFyZWRTcGFucyhzcGFucykge1xuICAgIGlmICghc3BhbnMpIHJldHVybiBudWxsO1xuICAgIGZvciAodmFyIGkgPSAwLCBvdXQ7IGkgPCBzcGFucy5sZW5ndGg7ICsraSkge1xuICAgICAgaWYgKHNwYW5zW2ldLm1hcmtlci5leHBsaWNpdGx5Q2xlYXJlZCkgeyBpZiAoIW91dCkgb3V0ID0gc3BhbnMuc2xpY2UoMCwgaSk7IH1cbiAgICAgIGVsc2UgaWYgKG91dCkgb3V0LnB1c2goc3BhbnNbaV0pO1xuICAgIH1cbiAgICByZXR1cm4gIW91dCA/IHNwYW5zIDogb3V0Lmxlbmd0aCA/IG91dCA6IG51bGw7XG4gIH1cblxuICAvLyBSZXRyaWV2ZSBhbmQgZmlsdGVyIHRoZSBvbGQgbWFya2VkIHNwYW5zIHN0b3JlZCBpbiBhIGNoYW5nZSBldmVudC5cbiAgZnVuY3Rpb24gZ2V0T2xkU3BhbnMoZG9jLCBjaGFuZ2UpIHtcbiAgICB2YXIgZm91bmQgPSBjaGFuZ2VbXCJzcGFuc19cIiArIGRvYy5pZF07XG4gICAgaWYgKCFmb3VuZCkgcmV0dXJuIG51bGw7XG4gICAgZm9yICh2YXIgaSA9IDAsIG53ID0gW107IGkgPCBjaGFuZ2UudGV4dC5sZW5ndGg7ICsraSlcbiAgICAgIG53LnB1c2gocmVtb3ZlQ2xlYXJlZFNwYW5zKGZvdW5kW2ldKSk7XG4gICAgcmV0dXJuIG53O1xuICB9XG5cbiAgLy8gVXNlZCBib3RoIHRvIHByb3ZpZGUgYSBKU09OLXNhZmUgb2JqZWN0IGluIC5nZXRIaXN0b3J5LCBhbmQsIHdoZW5cbiAgLy8gZGV0YWNoaW5nIGEgZG9jdW1lbnQsIHRvIHNwbGl0IHRoZSBoaXN0b3J5IGluIHR3b1xuICBmdW5jdGlvbiBjb3B5SGlzdG9yeUFycmF5KGV2ZW50cywgbmV3R3JvdXAsIGluc3RhbnRpYXRlU2VsKSB7XG4gICAgZm9yICh2YXIgaSA9IDAsIGNvcHkgPSBbXTsgaSA8IGV2ZW50cy5sZW5ndGg7ICsraSkge1xuICAgICAgdmFyIGV2ZW50ID0gZXZlbnRzW2ldO1xuICAgICAgaWYgKGV2ZW50LnJhbmdlcykge1xuICAgICAgICBjb3B5LnB1c2goaW5zdGFudGlhdGVTZWwgPyBTZWxlY3Rpb24ucHJvdG90eXBlLmRlZXBDb3B5LmNhbGwoZXZlbnQpIDogZXZlbnQpO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHZhciBjaGFuZ2VzID0gZXZlbnQuY2hhbmdlcywgbmV3Q2hhbmdlcyA9IFtdO1xuICAgICAgY29weS5wdXNoKHtjaGFuZ2VzOiBuZXdDaGFuZ2VzfSk7XG4gICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGNoYW5nZXMubGVuZ3RoOyArK2opIHtcbiAgICAgICAgdmFyIGNoYW5nZSA9IGNoYW5nZXNbal0sIG07XG4gICAgICAgIG5ld0NoYW5nZXMucHVzaCh7ZnJvbTogY2hhbmdlLmZyb20sIHRvOiBjaGFuZ2UudG8sIHRleHQ6IGNoYW5nZS50ZXh0fSk7XG4gICAgICAgIGlmIChuZXdHcm91cCkgZm9yICh2YXIgcHJvcCBpbiBjaGFuZ2UpIGlmIChtID0gcHJvcC5tYXRjaCgvXnNwYW5zXyhcXGQrKSQvKSkge1xuICAgICAgICAgIGlmIChpbmRleE9mKG5ld0dyb3VwLCBOdW1iZXIobVsxXSkpID4gLTEpIHtcbiAgICAgICAgICAgIGxzdChuZXdDaGFuZ2VzKVtwcm9wXSA9IGNoYW5nZVtwcm9wXTtcbiAgICAgICAgICAgIGRlbGV0ZSBjaGFuZ2VbcHJvcF07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjb3B5O1xuICB9XG5cbiAgLy8gUmViYXNpbmcvcmVzZXR0aW5nIGhpc3RvcnkgdG8gZGVhbCB3aXRoIGV4dGVybmFsbHktc291cmNlZCBjaGFuZ2VzXG5cbiAgZnVuY3Rpb24gcmViYXNlSGlzdFNlbFNpbmdsZShwb3MsIGZyb20sIHRvLCBkaWZmKSB7XG4gICAgaWYgKHRvIDwgcG9zLmxpbmUpIHtcbiAgICAgIHBvcy5saW5lICs9IGRpZmY7XG4gICAgfSBlbHNlIGlmIChmcm9tIDwgcG9zLmxpbmUpIHtcbiAgICAgIHBvcy5saW5lID0gZnJvbTtcbiAgICAgIHBvcy5jaCA9IDA7XG4gICAgfVxuICB9XG5cbiAgLy8gVHJpZXMgdG8gcmViYXNlIGFuIGFycmF5IG9mIGhpc3RvcnkgZXZlbnRzIGdpdmVuIGEgY2hhbmdlIGluIHRoZVxuICAvLyBkb2N1bWVudC4gSWYgdGhlIGNoYW5nZSB0b3VjaGVzIHRoZSBzYW1lIGxpbmVzIGFzIHRoZSBldmVudCwgdGhlXG4gIC8vIGV2ZW50LCBhbmQgZXZlcnl0aGluZyAnYmVoaW5kJyBpdCwgaXMgZGlzY2FyZGVkLiBJZiB0aGUgY2hhbmdlIGlzXG4gIC8vIGJlZm9yZSB0aGUgZXZlbnQsIHRoZSBldmVudCdzIHBvc2l0aW9ucyBhcmUgdXBkYXRlZC4gVXNlcyBhXG4gIC8vIGNvcHktb24td3JpdGUgc2NoZW1lIGZvciB0aGUgcG9zaXRpb25zLCB0byBhdm9pZCBoYXZpbmcgdG9cbiAgLy8gcmVhbGxvY2F0ZSB0aGVtIGFsbCBvbiBldmVyeSByZWJhc2UsIGJ1dCBhbHNvIGF2b2lkIHByb2JsZW1zIHdpdGhcbiAgLy8gc2hhcmVkIHBvc2l0aW9uIG9iamVjdHMgYmVpbmcgdW5zYWZlbHkgdXBkYXRlZC5cbiAgZnVuY3Rpb24gcmViYXNlSGlzdEFycmF5KGFycmF5LCBmcm9tLCB0bywgZGlmZikge1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBzdWIgPSBhcnJheVtpXSwgb2sgPSB0cnVlO1xuICAgICAgaWYgKHN1Yi5yYW5nZXMpIHtcbiAgICAgICAgaWYgKCFzdWIuY29waWVkKSB7IHN1YiA9IGFycmF5W2ldID0gc3ViLmRlZXBDb3B5KCk7IHN1Yi5jb3BpZWQgPSB0cnVlOyB9XG4gICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgc3ViLnJhbmdlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgIHJlYmFzZUhpc3RTZWxTaW5nbGUoc3ViLnJhbmdlc1tqXS5hbmNob3IsIGZyb20sIHRvLCBkaWZmKTtcbiAgICAgICAgICByZWJhc2VIaXN0U2VsU2luZ2xlKHN1Yi5yYW5nZXNbal0uaGVhZCwgZnJvbSwgdG8sIGRpZmYpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzdWIuY2hhbmdlcy5sZW5ndGg7ICsraikge1xuICAgICAgICB2YXIgY3VyID0gc3ViLmNoYW5nZXNbal07XG4gICAgICAgIGlmICh0byA8IGN1ci5mcm9tLmxpbmUpIHtcbiAgICAgICAgICBjdXIuZnJvbSA9IFBvcyhjdXIuZnJvbS5saW5lICsgZGlmZiwgY3VyLmZyb20uY2gpO1xuICAgICAgICAgIGN1ci50byA9IFBvcyhjdXIudG8ubGluZSArIGRpZmYsIGN1ci50by5jaCk7XG4gICAgICAgIH0gZWxzZSBpZiAoZnJvbSA8PSBjdXIudG8ubGluZSkge1xuICAgICAgICAgIG9rID0gZmFsc2U7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmICghb2spIHtcbiAgICAgICAgYXJyYXkuc3BsaWNlKDAsIGkgKyAxKTtcbiAgICAgICAgaSA9IDA7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gcmViYXNlSGlzdChoaXN0LCBjaGFuZ2UpIHtcbiAgICB2YXIgZnJvbSA9IGNoYW5nZS5mcm9tLmxpbmUsIHRvID0gY2hhbmdlLnRvLmxpbmUsIGRpZmYgPSBjaGFuZ2UudGV4dC5sZW5ndGggLSAodG8gLSBmcm9tKSAtIDE7XG4gICAgcmViYXNlSGlzdEFycmF5KGhpc3QuZG9uZSwgZnJvbSwgdG8sIGRpZmYpO1xuICAgIHJlYmFzZUhpc3RBcnJheShoaXN0LnVuZG9uZSwgZnJvbSwgdG8sIGRpZmYpO1xuICB9XG5cbiAgLy8gRVZFTlQgVVRJTElUSUVTXG5cbiAgLy8gRHVlIHRvIHRoZSBmYWN0IHRoYXQgd2Ugc3RpbGwgc3VwcG9ydCBqdXJhc3NpYyBJRSB2ZXJzaW9ucywgc29tZVxuICAvLyBjb21wYXRpYmlsaXR5IHdyYXBwZXJzIGFyZSBuZWVkZWQuXG5cbiAgdmFyIGVfcHJldmVudERlZmF1bHQgPSBDb2RlTWlycm9yLmVfcHJldmVudERlZmF1bHQgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGUucHJldmVudERlZmF1bHQpIGUucHJldmVudERlZmF1bHQoKTtcbiAgICBlbHNlIGUucmV0dXJuVmFsdWUgPSBmYWxzZTtcbiAgfTtcbiAgdmFyIGVfc3RvcFByb3BhZ2F0aW9uID0gQ29kZU1pcnJvci5lX3N0b3BQcm9wYWdhdGlvbiA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZS5zdG9wUHJvcGFnYXRpb24pIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgZWxzZSBlLmNhbmNlbEJ1YmJsZSA9IHRydWU7XG4gIH07XG4gIGZ1bmN0aW9uIGVfZGVmYXVsdFByZXZlbnRlZChlKSB7XG4gICAgcmV0dXJuIGUuZGVmYXVsdFByZXZlbnRlZCAhPSBudWxsID8gZS5kZWZhdWx0UHJldmVudGVkIDogZS5yZXR1cm5WYWx1ZSA9PSBmYWxzZTtcbiAgfVxuICB2YXIgZV9zdG9wID0gQ29kZU1pcnJvci5lX3N0b3AgPSBmdW5jdGlvbihlKSB7ZV9wcmV2ZW50RGVmYXVsdChlKTsgZV9zdG9wUHJvcGFnYXRpb24oZSk7fTtcblxuICBmdW5jdGlvbiBlX3RhcmdldChlKSB7cmV0dXJuIGUudGFyZ2V0IHx8IGUuc3JjRWxlbWVudDt9XG4gIGZ1bmN0aW9uIGVfYnV0dG9uKGUpIHtcbiAgICB2YXIgYiA9IGUud2hpY2g7XG4gICAgaWYgKGIgPT0gbnVsbCkge1xuICAgICAgaWYgKGUuYnV0dG9uICYgMSkgYiA9IDE7XG4gICAgICBlbHNlIGlmIChlLmJ1dHRvbiAmIDIpIGIgPSAzO1xuICAgICAgZWxzZSBpZiAoZS5idXR0b24gJiA0KSBiID0gMjtcbiAgICB9XG4gICAgaWYgKG1hYyAmJiBlLmN0cmxLZXkgJiYgYiA9PSAxKSBiID0gMztcbiAgICByZXR1cm4gYjtcbiAgfVxuXG4gIC8vIEVWRU5UIEhBTkRMSU5HXG5cbiAgLy8gTGlnaHR3ZWlnaHQgZXZlbnQgZnJhbWV3b3JrLiBvbi9vZmYgYWxzbyB3b3JrIG9uIERPTSBub2RlcyxcbiAgLy8gcmVnaXN0ZXJpbmcgbmF0aXZlIERPTSBoYW5kbGVycy5cblxuICB2YXIgb24gPSBDb2RlTWlycm9yLm9uID0gZnVuY3Rpb24oZW1pdHRlciwgdHlwZSwgZikge1xuICAgIGlmIChlbWl0dGVyLmFkZEV2ZW50TGlzdGVuZXIpXG4gICAgICBlbWl0dGVyLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgZiwgZmFsc2UpO1xuICAgIGVsc2UgaWYgKGVtaXR0ZXIuYXR0YWNoRXZlbnQpXG4gICAgICBlbWl0dGVyLmF0dGFjaEV2ZW50KFwib25cIiArIHR5cGUsIGYpO1xuICAgIGVsc2Uge1xuICAgICAgdmFyIG1hcCA9IGVtaXR0ZXIuX2hhbmRsZXJzIHx8IChlbWl0dGVyLl9oYW5kbGVycyA9IHt9KTtcbiAgICAgIHZhciBhcnIgPSBtYXBbdHlwZV0gfHwgKG1hcFt0eXBlXSA9IFtdKTtcbiAgICAgIGFyci5wdXNoKGYpO1xuICAgIH1cbiAgfTtcblxuICB2YXIgbm9IYW5kbGVycyA9IFtdXG4gIGZ1bmN0aW9uIGdldEhhbmRsZXJzKGVtaXR0ZXIsIHR5cGUsIGNvcHkpIHtcbiAgICB2YXIgYXJyID0gZW1pdHRlci5faGFuZGxlcnMgJiYgZW1pdHRlci5faGFuZGxlcnNbdHlwZV1cbiAgICBpZiAoY29weSkgcmV0dXJuIGFyciAmJiBhcnIubGVuZ3RoID4gMCA/IGFyci5zbGljZSgpIDogbm9IYW5kbGVyc1xuICAgIGVsc2UgcmV0dXJuIGFyciB8fCBub0hhbmRsZXJzXG4gIH1cblxuICB2YXIgb2ZmID0gQ29kZU1pcnJvci5vZmYgPSBmdW5jdGlvbihlbWl0dGVyLCB0eXBlLCBmKSB7XG4gICAgaWYgKGVtaXR0ZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcilcbiAgICAgIGVtaXR0ZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBmLCBmYWxzZSk7XG4gICAgZWxzZSBpZiAoZW1pdHRlci5kZXRhY2hFdmVudClcbiAgICAgIGVtaXR0ZXIuZGV0YWNoRXZlbnQoXCJvblwiICsgdHlwZSwgZik7XG4gICAgZWxzZSB7XG4gICAgICB2YXIgaGFuZGxlcnMgPSBnZXRIYW5kbGVycyhlbWl0dGVyLCB0eXBlLCBmYWxzZSlcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGFuZGxlcnMubGVuZ3RoOyArK2kpXG4gICAgICAgIGlmIChoYW5kbGVyc1tpXSA9PSBmKSB7IGhhbmRsZXJzLnNwbGljZShpLCAxKTsgYnJlYWs7IH1cbiAgICB9XG4gIH07XG5cbiAgdmFyIHNpZ25hbCA9IENvZGVNaXJyb3Iuc2lnbmFsID0gZnVuY3Rpb24oZW1pdHRlciwgdHlwZSAvKiwgdmFsdWVzLi4uKi8pIHtcbiAgICB2YXIgaGFuZGxlcnMgPSBnZXRIYW5kbGVycyhlbWl0dGVyLCB0eXBlLCB0cnVlKVxuICAgIGlmICghaGFuZGxlcnMubGVuZ3RoKSByZXR1cm47XG4gICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaGFuZGxlcnMubGVuZ3RoOyArK2kpIGhhbmRsZXJzW2ldLmFwcGx5KG51bGwsIGFyZ3MpO1xuICB9O1xuXG4gIHZhciBvcnBoYW5EZWxheWVkQ2FsbGJhY2tzID0gbnVsbDtcblxuICAvLyBPZnRlbiwgd2Ugd2FudCB0byBzaWduYWwgZXZlbnRzIGF0IGEgcG9pbnQgd2hlcmUgd2UgYXJlIGluIHRoZVxuICAvLyBtaWRkbGUgb2Ygc29tZSB3b3JrLCBidXQgZG9uJ3Qgd2FudCB0aGUgaGFuZGxlciB0byBzdGFydCBjYWxsaW5nXG4gIC8vIG90aGVyIG1ldGhvZHMgb24gdGhlIGVkaXRvciwgd2hpY2ggbWlnaHQgYmUgaW4gYW4gaW5jb25zaXN0ZW50XG4gIC8vIHN0YXRlIG9yIHNpbXBseSBub3QgZXhwZWN0IGFueSBvdGhlciBldmVudHMgdG8gaGFwcGVuLlxuICAvLyBzaWduYWxMYXRlciBsb29rcyB3aGV0aGVyIHRoZXJlIGFyZSBhbnkgaGFuZGxlcnMsIGFuZCBzY2hlZHVsZXNcbiAgLy8gdGhlbSB0byBiZSBleGVjdXRlZCB3aGVuIHRoZSBsYXN0IG9wZXJhdGlvbiBlbmRzLCBvciwgaWYgbm9cbiAgLy8gb3BlcmF0aW9uIGlzIGFjdGl2ZSwgd2hlbiBhIHRpbWVvdXQgZmlyZXMuXG4gIGZ1bmN0aW9uIHNpZ25hbExhdGVyKGVtaXR0ZXIsIHR5cGUgLyosIHZhbHVlcy4uLiovKSB7XG4gICAgdmFyIGFyciA9IGdldEhhbmRsZXJzKGVtaXR0ZXIsIHR5cGUsIGZhbHNlKVxuICAgIGlmICghYXJyLmxlbmd0aCkgcmV0dXJuO1xuICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAyKSwgbGlzdDtcbiAgICBpZiAob3BlcmF0aW9uR3JvdXApIHtcbiAgICAgIGxpc3QgPSBvcGVyYXRpb25Hcm91cC5kZWxheWVkQ2FsbGJhY2tzO1xuICAgIH0gZWxzZSBpZiAob3JwaGFuRGVsYXllZENhbGxiYWNrcykge1xuICAgICAgbGlzdCA9IG9ycGhhbkRlbGF5ZWRDYWxsYmFja3M7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxpc3QgPSBvcnBoYW5EZWxheWVkQ2FsbGJhY2tzID0gW107XG4gICAgICBzZXRUaW1lb3V0KGZpcmVPcnBoYW5EZWxheWVkLCAwKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gYm5kKGYpIHtyZXR1cm4gZnVuY3Rpb24oKXtmLmFwcGx5KG51bGwsIGFyZ3MpO307fTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7ICsraSlcbiAgICAgIGxpc3QucHVzaChibmQoYXJyW2ldKSk7XG4gIH1cblxuICBmdW5jdGlvbiBmaXJlT3JwaGFuRGVsYXllZCgpIHtcbiAgICB2YXIgZGVsYXllZCA9IG9ycGhhbkRlbGF5ZWRDYWxsYmFja3M7XG4gICAgb3JwaGFuRGVsYXllZENhbGxiYWNrcyA9IG51bGw7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkZWxheWVkLmxlbmd0aDsgKytpKSBkZWxheWVkW2ldKCk7XG4gIH1cblxuICAvLyBUaGUgRE9NIGV2ZW50cyB0aGF0IENvZGVNaXJyb3IgaGFuZGxlcyBjYW4gYmUgb3ZlcnJpZGRlbiBieVxuICAvLyByZWdpc3RlcmluZyBhIChub24tRE9NKSBoYW5kbGVyIG9uIHRoZSBlZGl0b3IgZm9yIHRoZSBldmVudCBuYW1lLFxuICAvLyBhbmQgcHJldmVudERlZmF1bHQtaW5nIHRoZSBldmVudCBpbiB0aGF0IGhhbmRsZXIuXG4gIGZ1bmN0aW9uIHNpZ25hbERPTUV2ZW50KGNtLCBlLCBvdmVycmlkZSkge1xuICAgIGlmICh0eXBlb2YgZSA9PSBcInN0cmluZ1wiKVxuICAgICAgZSA9IHt0eXBlOiBlLCBwcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24oKSB7IHRoaXMuZGVmYXVsdFByZXZlbnRlZCA9IHRydWU7IH19O1xuICAgIHNpZ25hbChjbSwgb3ZlcnJpZGUgfHwgZS50eXBlLCBjbSwgZSk7XG4gICAgcmV0dXJuIGVfZGVmYXVsdFByZXZlbnRlZChlKSB8fCBlLmNvZGVtaXJyb3JJZ25vcmU7XG4gIH1cblxuICBmdW5jdGlvbiBzaWduYWxDdXJzb3JBY3Rpdml0eShjbSkge1xuICAgIHZhciBhcnIgPSBjbS5faGFuZGxlcnMgJiYgY20uX2hhbmRsZXJzLmN1cnNvckFjdGl2aXR5O1xuICAgIGlmICghYXJyKSByZXR1cm47XG4gICAgdmFyIHNldCA9IGNtLmN1ck9wLmN1cnNvckFjdGl2aXR5SGFuZGxlcnMgfHwgKGNtLmN1ck9wLmN1cnNvckFjdGl2aXR5SGFuZGxlcnMgPSBbXSk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyArK2kpIGlmIChpbmRleE9mKHNldCwgYXJyW2ldKSA9PSAtMSlcbiAgICAgIHNldC5wdXNoKGFycltpXSk7XG4gIH1cblxuICBmdW5jdGlvbiBoYXNIYW5kbGVyKGVtaXR0ZXIsIHR5cGUpIHtcbiAgICByZXR1cm4gZ2V0SGFuZGxlcnMoZW1pdHRlciwgdHlwZSkubGVuZ3RoID4gMFxuICB9XG5cbiAgLy8gQWRkIG9uIGFuZCBvZmYgbWV0aG9kcyB0byBhIGNvbnN0cnVjdG9yJ3MgcHJvdG90eXBlLCB0byBtYWtlXG4gIC8vIHJlZ2lzdGVyaW5nIGV2ZW50cyBvbiBzdWNoIG9iamVjdHMgbW9yZSBjb252ZW5pZW50LlxuICBmdW5jdGlvbiBldmVudE1peGluKGN0b3IpIHtcbiAgICBjdG9yLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uKHR5cGUsIGYpIHtvbih0aGlzLCB0eXBlLCBmKTt9O1xuICAgIGN0b3IucHJvdG90eXBlLm9mZiA9IGZ1bmN0aW9uKHR5cGUsIGYpIHtvZmYodGhpcywgdHlwZSwgZik7fTtcbiAgfVxuXG4gIC8vIE1JU0MgVVRJTElUSUVTXG5cbiAgLy8gTnVtYmVyIG9mIHBpeGVscyBhZGRlZCB0byBzY3JvbGxlciBhbmQgc2l6ZXIgdG8gaGlkZSBzY3JvbGxiYXJcbiAgdmFyIHNjcm9sbGVyR2FwID0gMzA7XG5cbiAgLy8gUmV0dXJuZWQgb3IgdGhyb3duIGJ5IHZhcmlvdXMgcHJvdG9jb2xzIHRvIHNpZ25hbCAnSSdtIG5vdFxuICAvLyBoYW5kbGluZyB0aGlzJy5cbiAgdmFyIFBhc3MgPSBDb2RlTWlycm9yLlBhc3MgPSB7dG9TdHJpbmc6IGZ1bmN0aW9uKCl7cmV0dXJuIFwiQ29kZU1pcnJvci5QYXNzXCI7fX07XG5cbiAgLy8gUmV1c2VkIG9wdGlvbiBvYmplY3RzIGZvciBzZXRTZWxlY3Rpb24gJiBmcmllbmRzXG4gIHZhciBzZWxfZG9udFNjcm9sbCA9IHtzY3JvbGw6IGZhbHNlfSwgc2VsX21vdXNlID0ge29yaWdpbjogXCIqbW91c2VcIn0sIHNlbF9tb3ZlID0ge29yaWdpbjogXCIrbW92ZVwifTtcblxuICBmdW5jdGlvbiBEZWxheWVkKCkge3RoaXMuaWQgPSBudWxsO31cbiAgRGVsYXllZC5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24obXMsIGYpIHtcbiAgICBjbGVhclRpbWVvdXQodGhpcy5pZCk7XG4gICAgdGhpcy5pZCA9IHNldFRpbWVvdXQoZiwgbXMpO1xuICB9O1xuXG4gIC8vIENvdW50cyB0aGUgY29sdW1uIG9mZnNldCBpbiBhIHN0cmluZywgdGFraW5nIHRhYnMgaW50byBhY2NvdW50LlxuICAvLyBVc2VkIG1vc3RseSB0byBmaW5kIGluZGVudGF0aW9uLlxuICB2YXIgY291bnRDb2x1bW4gPSBDb2RlTWlycm9yLmNvdW50Q29sdW1uID0gZnVuY3Rpb24oc3RyaW5nLCBlbmQsIHRhYlNpemUsIHN0YXJ0SW5kZXgsIHN0YXJ0VmFsdWUpIHtcbiAgICBpZiAoZW5kID09IG51bGwpIHtcbiAgICAgIGVuZCA9IHN0cmluZy5zZWFyY2goL1teXFxzXFx1MDBhMF0vKTtcbiAgICAgIGlmIChlbmQgPT0gLTEpIGVuZCA9IHN0cmluZy5sZW5ndGg7XG4gICAgfVxuICAgIGZvciAodmFyIGkgPSBzdGFydEluZGV4IHx8IDAsIG4gPSBzdGFydFZhbHVlIHx8IDA7Oykge1xuICAgICAgdmFyIG5leHRUYWIgPSBzdHJpbmcuaW5kZXhPZihcIlxcdFwiLCBpKTtcbiAgICAgIGlmIChuZXh0VGFiIDwgMCB8fCBuZXh0VGFiID49IGVuZClcbiAgICAgICAgcmV0dXJuIG4gKyAoZW5kIC0gaSk7XG4gICAgICBuICs9IG5leHRUYWIgLSBpO1xuICAgICAgbiArPSB0YWJTaXplIC0gKG4gJSB0YWJTaXplKTtcbiAgICAgIGkgPSBuZXh0VGFiICsgMTtcbiAgICB9XG4gIH07XG5cbiAgLy8gVGhlIGludmVyc2Ugb2YgY291bnRDb2x1bW4gLS0gZmluZCB0aGUgb2Zmc2V0IHRoYXQgY29ycmVzcG9uZHMgdG9cbiAgLy8gYSBwYXJ0aWN1bGFyIGNvbHVtbi5cbiAgdmFyIGZpbmRDb2x1bW4gPSBDb2RlTWlycm9yLmZpbmRDb2x1bW4gPSBmdW5jdGlvbihzdHJpbmcsIGdvYWwsIHRhYlNpemUpIHtcbiAgICBmb3IgKHZhciBwb3MgPSAwLCBjb2wgPSAwOzspIHtcbiAgICAgIHZhciBuZXh0VGFiID0gc3RyaW5nLmluZGV4T2YoXCJcXHRcIiwgcG9zKTtcbiAgICAgIGlmIChuZXh0VGFiID09IC0xKSBuZXh0VGFiID0gc3RyaW5nLmxlbmd0aDtcbiAgICAgIHZhciBza2lwcGVkID0gbmV4dFRhYiAtIHBvcztcbiAgICAgIGlmIChuZXh0VGFiID09IHN0cmluZy5sZW5ndGggfHwgY29sICsgc2tpcHBlZCA+PSBnb2FsKVxuICAgICAgICByZXR1cm4gcG9zICsgTWF0aC5taW4oc2tpcHBlZCwgZ29hbCAtIGNvbCk7XG4gICAgICBjb2wgKz0gbmV4dFRhYiAtIHBvcztcbiAgICAgIGNvbCArPSB0YWJTaXplIC0gKGNvbCAlIHRhYlNpemUpO1xuICAgICAgcG9zID0gbmV4dFRhYiArIDE7XG4gICAgICBpZiAoY29sID49IGdvYWwpIHJldHVybiBwb3M7XG4gICAgfVxuICB9XG5cbiAgdmFyIHNwYWNlU3RycyA9IFtcIlwiXTtcbiAgZnVuY3Rpb24gc3BhY2VTdHIobikge1xuICAgIHdoaWxlIChzcGFjZVN0cnMubGVuZ3RoIDw9IG4pXG4gICAgICBzcGFjZVN0cnMucHVzaChsc3Qoc3BhY2VTdHJzKSArIFwiIFwiKTtcbiAgICByZXR1cm4gc3BhY2VTdHJzW25dO1xuICB9XG5cbiAgZnVuY3Rpb24gbHN0KGFycikgeyByZXR1cm4gYXJyW2Fyci5sZW5ndGgtMV07IH1cblxuICB2YXIgc2VsZWN0SW5wdXQgPSBmdW5jdGlvbihub2RlKSB7IG5vZGUuc2VsZWN0KCk7IH07XG4gIGlmIChpb3MpIC8vIE1vYmlsZSBTYWZhcmkgYXBwYXJlbnRseSBoYXMgYSBidWcgd2hlcmUgc2VsZWN0KCkgaXMgYnJva2VuLlxuICAgIHNlbGVjdElucHV0ID0gZnVuY3Rpb24obm9kZSkgeyBub2RlLnNlbGVjdGlvblN0YXJ0ID0gMDsgbm9kZS5zZWxlY3Rpb25FbmQgPSBub2RlLnZhbHVlLmxlbmd0aDsgfTtcbiAgZWxzZSBpZiAoaWUpIC8vIFN1cHByZXNzIG15c3RlcmlvdXMgSUUxMCBlcnJvcnNcbiAgICBzZWxlY3RJbnB1dCA9IGZ1bmN0aW9uKG5vZGUpIHsgdHJ5IHsgbm9kZS5zZWxlY3QoKTsgfSBjYXRjaChfZSkge30gfTtcblxuICBmdW5jdGlvbiBpbmRleE9mKGFycmF5LCBlbHQpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgKytpKVxuICAgICAgaWYgKGFycmF5W2ldID09IGVsdCkgcmV0dXJuIGk7XG4gICAgcmV0dXJuIC0xO1xuICB9XG4gIGZ1bmN0aW9uIG1hcChhcnJheSwgZikge1xuICAgIHZhciBvdXQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgaSsrKSBvdXRbaV0gPSBmKGFycmF5W2ldLCBpKTtcbiAgICByZXR1cm4gb3V0O1xuICB9XG5cbiAgZnVuY3Rpb24gbm90aGluZygpIHt9XG5cbiAgZnVuY3Rpb24gY3JlYXRlT2JqKGJhc2UsIHByb3BzKSB7XG4gICAgdmFyIGluc3Q7XG4gICAgaWYgKE9iamVjdC5jcmVhdGUpIHtcbiAgICAgIGluc3QgPSBPYmplY3QuY3JlYXRlKGJhc2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICBub3RoaW5nLnByb3RvdHlwZSA9IGJhc2U7XG4gICAgICBpbnN0ID0gbmV3IG5vdGhpbmcoKTtcbiAgICB9XG4gICAgaWYgKHByb3BzKSBjb3B5T2JqKHByb3BzLCBpbnN0KTtcbiAgICByZXR1cm4gaW5zdDtcbiAgfTtcblxuICBmdW5jdGlvbiBjb3B5T2JqKG9iaiwgdGFyZ2V0LCBvdmVyd3JpdGUpIHtcbiAgICBpZiAoIXRhcmdldCkgdGFyZ2V0ID0ge307XG4gICAgZm9yICh2YXIgcHJvcCBpbiBvYmopXG4gICAgICBpZiAob2JqLmhhc093blByb3BlcnR5KHByb3ApICYmIChvdmVyd3JpdGUgIT09IGZhbHNlIHx8ICF0YXJnZXQuaGFzT3duUHJvcGVydHkocHJvcCkpKVxuICAgICAgICB0YXJnZXRbcHJvcF0gPSBvYmpbcHJvcF07XG4gICAgcmV0dXJuIHRhcmdldDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGJpbmQoZikge1xuICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTtcbiAgICByZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gZi5hcHBseShudWxsLCBhcmdzKTt9O1xuICB9XG5cbiAgdmFyIG5vbkFTQ0lJU2luZ2xlQ2FzZVdvcmRDaGFyID0gL1tcXHUwMGRmXFx1MDU4N1xcdTA1OTAtXFx1MDVmNFxcdTA2MDAtXFx1MDZmZlxcdTMwNDAtXFx1MzA5ZlxcdTMwYTAtXFx1MzBmZlxcdTM0MDAtXFx1NGRiNVxcdTRlMDAtXFx1OWZjY1xcdWFjMDAtXFx1ZDdhZl0vO1xuICB2YXIgaXNXb3JkQ2hhckJhc2ljID0gQ29kZU1pcnJvci5pc1dvcmRDaGFyID0gZnVuY3Rpb24oY2gpIHtcbiAgICByZXR1cm4gL1xcdy8udGVzdChjaCkgfHwgY2ggPiBcIlxceDgwXCIgJiZcbiAgICAgIChjaC50b1VwcGVyQ2FzZSgpICE9IGNoLnRvTG93ZXJDYXNlKCkgfHwgbm9uQVNDSUlTaW5nbGVDYXNlV29yZENoYXIudGVzdChjaCkpO1xuICB9O1xuICBmdW5jdGlvbiBpc1dvcmRDaGFyKGNoLCBoZWxwZXIpIHtcbiAgICBpZiAoIWhlbHBlcikgcmV0dXJuIGlzV29yZENoYXJCYXNpYyhjaCk7XG4gICAgaWYgKGhlbHBlci5zb3VyY2UuaW5kZXhPZihcIlxcXFx3XCIpID4gLTEgJiYgaXNXb3JkQ2hhckJhc2ljKGNoKSkgcmV0dXJuIHRydWU7XG4gICAgcmV0dXJuIGhlbHBlci50ZXN0KGNoKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzRW1wdHkob2JqKSB7XG4gICAgZm9yICh2YXIgbiBpbiBvYmopIGlmIChvYmouaGFzT3duUHJvcGVydHkobikgJiYgb2JqW25dKSByZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvLyBFeHRlbmRpbmcgdW5pY29kZSBjaGFyYWN0ZXJzLiBBIHNlcmllcyBvZiBhIG5vbi1leHRlbmRpbmcgY2hhciArXG4gIC8vIGFueSBudW1iZXIgb2YgZXh0ZW5kaW5nIGNoYXJzIGlzIHRyZWF0ZWQgYXMgYSBzaW5nbGUgdW5pdCBhcyBmYXJcbiAgLy8gYXMgZWRpdGluZyBhbmQgbWVhc3VyaW5nIGlzIGNvbmNlcm5lZC4gVGhpcyBpcyBub3QgZnVsbHkgY29ycmVjdCxcbiAgLy8gc2luY2Ugc29tZSBzY3JpcHRzL2ZvbnRzL2Jyb3dzZXJzIGFsc28gdHJlYXQgb3RoZXIgY29uZmlndXJhdGlvbnNcbiAgLy8gb2YgY29kZSBwb2ludHMgYXMgYSBncm91cC5cbiAgdmFyIGV4dGVuZGluZ0NoYXJzID0gL1tcXHUwMzAwLVxcdTAzNmZcXHUwNDgzLVxcdTA0ODlcXHUwNTkxLVxcdTA1YmRcXHUwNWJmXFx1MDVjMVxcdTA1YzJcXHUwNWM0XFx1MDVjNVxcdTA1YzdcXHUwNjEwLVxcdTA2MWFcXHUwNjRiLVxcdTA2NWVcXHUwNjcwXFx1MDZkNi1cXHUwNmRjXFx1MDZkZS1cXHUwNmU0XFx1MDZlN1xcdTA2ZThcXHUwNmVhLVxcdTA2ZWRcXHUwNzExXFx1MDczMC1cXHUwNzRhXFx1MDdhNi1cXHUwN2IwXFx1MDdlYi1cXHUwN2YzXFx1MDgxNi1cXHUwODE5XFx1MDgxYi1cXHUwODIzXFx1MDgyNS1cXHUwODI3XFx1MDgyOS1cXHUwODJkXFx1MDkwMC1cXHUwOTAyXFx1MDkzY1xcdTA5NDEtXFx1MDk0OFxcdTA5NGRcXHUwOTUxLVxcdTA5NTVcXHUwOTYyXFx1MDk2M1xcdTA5ODFcXHUwOWJjXFx1MDliZVxcdTA5YzEtXFx1MDljNFxcdTA5Y2RcXHUwOWQ3XFx1MDllMlxcdTA5ZTNcXHUwYTAxXFx1MGEwMlxcdTBhM2NcXHUwYTQxXFx1MGE0MlxcdTBhNDdcXHUwYTQ4XFx1MGE0Yi1cXHUwYTRkXFx1MGE1MVxcdTBhNzBcXHUwYTcxXFx1MGE3NVxcdTBhODFcXHUwYTgyXFx1MGFiY1xcdTBhYzEtXFx1MGFjNVxcdTBhYzdcXHUwYWM4XFx1MGFjZFxcdTBhZTJcXHUwYWUzXFx1MGIwMVxcdTBiM2NcXHUwYjNlXFx1MGIzZlxcdTBiNDEtXFx1MGI0NFxcdTBiNGRcXHUwYjU2XFx1MGI1N1xcdTBiNjJcXHUwYjYzXFx1MGI4MlxcdTBiYmVcXHUwYmMwXFx1MGJjZFxcdTBiZDdcXHUwYzNlLVxcdTBjNDBcXHUwYzQ2LVxcdTBjNDhcXHUwYzRhLVxcdTBjNGRcXHUwYzU1XFx1MGM1NlxcdTBjNjJcXHUwYzYzXFx1MGNiY1xcdTBjYmZcXHUwY2MyXFx1MGNjNlxcdTBjY2NcXHUwY2NkXFx1MGNkNVxcdTBjZDZcXHUwY2UyXFx1MGNlM1xcdTBkM2VcXHUwZDQxLVxcdTBkNDRcXHUwZDRkXFx1MGQ1N1xcdTBkNjJcXHUwZDYzXFx1MGRjYVxcdTBkY2ZcXHUwZGQyLVxcdTBkZDRcXHUwZGQ2XFx1MGRkZlxcdTBlMzFcXHUwZTM0LVxcdTBlM2FcXHUwZTQ3LVxcdTBlNGVcXHUwZWIxXFx1MGViNC1cXHUwZWI5XFx1MGViYlxcdTBlYmNcXHUwZWM4LVxcdTBlY2RcXHUwZjE4XFx1MGYxOVxcdTBmMzVcXHUwZjM3XFx1MGYzOVxcdTBmNzEtXFx1MGY3ZVxcdTBmODAtXFx1MGY4NFxcdTBmODZcXHUwZjg3XFx1MGY5MC1cXHUwZjk3XFx1MGY5OS1cXHUwZmJjXFx1MGZjNlxcdTEwMmQtXFx1MTAzMFxcdTEwMzItXFx1MTAzN1xcdTEwMzlcXHUxMDNhXFx1MTAzZFxcdTEwM2VcXHUxMDU4XFx1MTA1OVxcdTEwNWUtXFx1MTA2MFxcdTEwNzEtXFx1MTA3NFxcdTEwODJcXHUxMDg1XFx1MTA4NlxcdTEwOGRcXHUxMDlkXFx1MTM1ZlxcdTE3MTItXFx1MTcxNFxcdTE3MzItXFx1MTczNFxcdTE3NTJcXHUxNzUzXFx1MTc3MlxcdTE3NzNcXHUxN2I3LVxcdTE3YmRcXHUxN2M2XFx1MTdjOS1cXHUxN2QzXFx1MTdkZFxcdTE4MGItXFx1MTgwZFxcdTE4YTlcXHUxOTIwLVxcdTE5MjJcXHUxOTI3XFx1MTkyOFxcdTE5MzJcXHUxOTM5LVxcdTE5M2JcXHUxYTE3XFx1MWExOFxcdTFhNTZcXHUxYTU4LVxcdTFhNWVcXHUxYTYwXFx1MWE2MlxcdTFhNjUtXFx1MWE2Y1xcdTFhNzMtXFx1MWE3Y1xcdTFhN2ZcXHUxYjAwLVxcdTFiMDNcXHUxYjM0XFx1MWIzNi1cXHUxYjNhXFx1MWIzY1xcdTFiNDJcXHUxYjZiLVxcdTFiNzNcXHUxYjgwXFx1MWI4MVxcdTFiYTItXFx1MWJhNVxcdTFiYThcXHUxYmE5XFx1MWMyYy1cXHUxYzMzXFx1MWMzNlxcdTFjMzdcXHUxY2QwLVxcdTFjZDJcXHUxY2Q0LVxcdTFjZTBcXHUxY2UyLVxcdTFjZThcXHUxY2VkXFx1MWRjMC1cXHUxZGU2XFx1MWRmZC1cXHUxZGZmXFx1MjAwY1xcdTIwMGRcXHUyMGQwLVxcdTIwZjBcXHUyY2VmLVxcdTJjZjFcXHUyZGUwLVxcdTJkZmZcXHUzMDJhLVxcdTMwMmZcXHUzMDk5XFx1MzA5YVxcdWE2NmYtXFx1YTY3MlxcdWE2N2NcXHVhNjdkXFx1YTZmMFxcdWE2ZjFcXHVhODAyXFx1YTgwNlxcdWE4MGJcXHVhODI1XFx1YTgyNlxcdWE4YzRcXHVhOGUwLVxcdWE4ZjFcXHVhOTI2LVxcdWE5MmRcXHVhOTQ3LVxcdWE5NTFcXHVhOTgwLVxcdWE5ODJcXHVhOWIzXFx1YTliNi1cXHVhOWI5XFx1YTliY1xcdWFhMjktXFx1YWEyZVxcdWFhMzFcXHVhYTMyXFx1YWEzNVxcdWFhMzZcXHVhYTQzXFx1YWE0Y1xcdWFhYjBcXHVhYWIyLVxcdWFhYjRcXHVhYWI3XFx1YWFiOFxcdWFhYmVcXHVhYWJmXFx1YWFjMVxcdWFiZTVcXHVhYmU4XFx1YWJlZFxcdWRjMDAtXFx1ZGZmZlxcdWZiMWVcXHVmZTAwLVxcdWZlMGZcXHVmZTIwLVxcdWZlMjZcXHVmZjllXFx1ZmY5Zl0vO1xuICBmdW5jdGlvbiBpc0V4dGVuZGluZ0NoYXIoY2gpIHsgcmV0dXJuIGNoLmNoYXJDb2RlQXQoMCkgPj0gNzY4ICYmIGV4dGVuZGluZ0NoYXJzLnRlc3QoY2gpOyB9XG5cbiAgLy8gRE9NIFVUSUxJVElFU1xuXG4gIGZ1bmN0aW9uIGVsdCh0YWcsIGNvbnRlbnQsIGNsYXNzTmFtZSwgc3R5bGUpIHtcbiAgICB2YXIgZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodGFnKTtcbiAgICBpZiAoY2xhc3NOYW1lKSBlLmNsYXNzTmFtZSA9IGNsYXNzTmFtZTtcbiAgICBpZiAoc3R5bGUpIGUuc3R5bGUuY3NzVGV4dCA9IHN0eWxlO1xuICAgIGlmICh0eXBlb2YgY29udGVudCA9PSBcInN0cmluZ1wiKSBlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNvbnRlbnQpKTtcbiAgICBlbHNlIGlmIChjb250ZW50KSBmb3IgKHZhciBpID0gMDsgaSA8IGNvbnRlbnQubGVuZ3RoOyArK2kpIGUuYXBwZW5kQ2hpbGQoY29udGVudFtpXSk7XG4gICAgcmV0dXJuIGU7XG4gIH1cblxuICB2YXIgcmFuZ2U7XG4gIGlmIChkb2N1bWVudC5jcmVhdGVSYW5nZSkgcmFuZ2UgPSBmdW5jdGlvbihub2RlLCBzdGFydCwgZW5kLCBlbmROb2RlKSB7XG4gICAgdmFyIHIgPSBkb2N1bWVudC5jcmVhdGVSYW5nZSgpO1xuICAgIHIuc2V0RW5kKGVuZE5vZGUgfHwgbm9kZSwgZW5kKTtcbiAgICByLnNldFN0YXJ0KG5vZGUsIHN0YXJ0KTtcbiAgICByZXR1cm4gcjtcbiAgfTtcbiAgZWxzZSByYW5nZSA9IGZ1bmN0aW9uKG5vZGUsIHN0YXJ0LCBlbmQpIHtcbiAgICB2YXIgciA9IGRvY3VtZW50LmJvZHkuY3JlYXRlVGV4dFJhbmdlKCk7XG4gICAgdHJ5IHsgci5tb3ZlVG9FbGVtZW50VGV4dChub2RlLnBhcmVudE5vZGUpOyB9XG4gICAgY2F0Y2goZSkgeyByZXR1cm4gcjsgfVxuICAgIHIuY29sbGFwc2UodHJ1ZSk7XG4gICAgci5tb3ZlRW5kKFwiY2hhcmFjdGVyXCIsIGVuZCk7XG4gICAgci5tb3ZlU3RhcnQoXCJjaGFyYWN0ZXJcIiwgc3RhcnQpO1xuICAgIHJldHVybiByO1xuICB9O1xuXG4gIGZ1bmN0aW9uIHJlbW92ZUNoaWxkcmVuKGUpIHtcbiAgICBmb3IgKHZhciBjb3VudCA9IGUuY2hpbGROb2Rlcy5sZW5ndGg7IGNvdW50ID4gMDsgLS1jb3VudClcbiAgICAgIGUucmVtb3ZlQ2hpbGQoZS5maXJzdENoaWxkKTtcbiAgICByZXR1cm4gZTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlbW92ZUNoaWxkcmVuQW5kQWRkKHBhcmVudCwgZSkge1xuICAgIHJldHVybiByZW1vdmVDaGlsZHJlbihwYXJlbnQpLmFwcGVuZENoaWxkKGUpO1xuICB9XG5cbiAgdmFyIGNvbnRhaW5zID0gQ29kZU1pcnJvci5jb250YWlucyA9IGZ1bmN0aW9uKHBhcmVudCwgY2hpbGQpIHtcbiAgICBpZiAoY2hpbGQubm9kZVR5cGUgPT0gMykgLy8gQW5kcm9pZCBicm93c2VyIGFsd2F5cyByZXR1cm5zIGZhbHNlIHdoZW4gY2hpbGQgaXMgYSB0ZXh0bm9kZVxuICAgICAgY2hpbGQgPSBjaGlsZC5wYXJlbnROb2RlO1xuICAgIGlmIChwYXJlbnQuY29udGFpbnMpXG4gICAgICByZXR1cm4gcGFyZW50LmNvbnRhaW5zKGNoaWxkKTtcbiAgICBkbyB7XG4gICAgICBpZiAoY2hpbGQubm9kZVR5cGUgPT0gMTEpIGNoaWxkID0gY2hpbGQuaG9zdDtcbiAgICAgIGlmIChjaGlsZCA9PSBwYXJlbnQpIHJldHVybiB0cnVlO1xuICAgIH0gd2hpbGUgKGNoaWxkID0gY2hpbGQucGFyZW50Tm9kZSk7XG4gIH07XG5cbiAgZnVuY3Rpb24gYWN0aXZlRWx0KCkge1xuICAgIHZhciBhY3RpdmVFbGVtZW50ID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDtcbiAgICB3aGlsZSAoYWN0aXZlRWxlbWVudCAmJiBhY3RpdmVFbGVtZW50LnJvb3QgJiYgYWN0aXZlRWxlbWVudC5yb290LmFjdGl2ZUVsZW1lbnQpXG4gICAgICBhY3RpdmVFbGVtZW50ID0gYWN0aXZlRWxlbWVudC5yb290LmFjdGl2ZUVsZW1lbnQ7XG4gICAgcmV0dXJuIGFjdGl2ZUVsZW1lbnQ7XG4gIH1cbiAgLy8gT2xkZXIgdmVyc2lvbnMgb2YgSUUgdGhyb3dzIHVuc3BlY2lmaWVkIGVycm9yIHdoZW4gdG91Y2hpbmdcbiAgLy8gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCBpbiBzb21lIGNhc2VzIChkdXJpbmcgbG9hZGluZywgaW4gaWZyYW1lKVxuICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDExKSBhY3RpdmVFbHQgPSBmdW5jdGlvbigpIHtcbiAgICB0cnkgeyByZXR1cm4gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDsgfVxuICAgIGNhdGNoKGUpIHsgcmV0dXJuIGRvY3VtZW50LmJvZHk7IH1cbiAgfTtcblxuICBmdW5jdGlvbiBjbGFzc1Rlc3QoY2xzKSB7IHJldHVybiBuZXcgUmVnRXhwKFwiKF58XFxcXHMpXCIgKyBjbHMgKyBcIig/OiR8XFxcXHMpXFxcXHMqXCIpOyB9XG4gIHZhciBybUNsYXNzID0gQ29kZU1pcnJvci5ybUNsYXNzID0gZnVuY3Rpb24obm9kZSwgY2xzKSB7XG4gICAgdmFyIGN1cnJlbnQgPSBub2RlLmNsYXNzTmFtZTtcbiAgICB2YXIgbWF0Y2ggPSBjbGFzc1Rlc3QoY2xzKS5leGVjKGN1cnJlbnQpO1xuICAgIGlmIChtYXRjaCkge1xuICAgICAgdmFyIGFmdGVyID0gY3VycmVudC5zbGljZShtYXRjaC5pbmRleCArIG1hdGNoWzBdLmxlbmd0aCk7XG4gICAgICBub2RlLmNsYXNzTmFtZSA9IGN1cnJlbnQuc2xpY2UoMCwgbWF0Y2guaW5kZXgpICsgKGFmdGVyID8gbWF0Y2hbMV0gKyBhZnRlciA6IFwiXCIpO1xuICAgIH1cbiAgfTtcbiAgdmFyIGFkZENsYXNzID0gQ29kZU1pcnJvci5hZGRDbGFzcyA9IGZ1bmN0aW9uKG5vZGUsIGNscykge1xuICAgIHZhciBjdXJyZW50ID0gbm9kZS5jbGFzc05hbWU7XG4gICAgaWYgKCFjbGFzc1Rlc3QoY2xzKS50ZXN0KGN1cnJlbnQpKSBub2RlLmNsYXNzTmFtZSArPSAoY3VycmVudCA/IFwiIFwiIDogXCJcIikgKyBjbHM7XG4gIH07XG4gIGZ1bmN0aW9uIGpvaW5DbGFzc2VzKGEsIGIpIHtcbiAgICB2YXIgYXMgPSBhLnNwbGl0KFwiIFwiKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFzLmxlbmd0aDsgaSsrKVxuICAgICAgaWYgKGFzW2ldICYmICFjbGFzc1Rlc3QoYXNbaV0pLnRlc3QoYikpIGIgKz0gXCIgXCIgKyBhc1tpXTtcbiAgICByZXR1cm4gYjtcbiAgfVxuXG4gIC8vIFdJTkRPVy1XSURFIEVWRU5UU1xuXG4gIC8vIFRoZXNlIG11c3QgYmUgaGFuZGxlZCBjYXJlZnVsbHksIGJlY2F1c2UgbmFpdmVseSByZWdpc3RlcmluZyBhXG4gIC8vIGhhbmRsZXIgZm9yIGVhY2ggZWRpdG9yIHdpbGwgY2F1c2UgdGhlIGVkaXRvcnMgdG8gbmV2ZXIgYmVcbiAgLy8gZ2FyYmFnZSBjb2xsZWN0ZWQuXG5cbiAgZnVuY3Rpb24gZm9yRWFjaENvZGVNaXJyb3IoZikge1xuICAgIGlmICghZG9jdW1lbnQuYm9keS5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKSByZXR1cm47XG4gICAgdmFyIGJ5Q2xhc3MgPSBkb2N1bWVudC5ib2R5LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoXCJDb2RlTWlycm9yXCIpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYnlDbGFzcy5sZW5ndGg7IGkrKykge1xuICAgICAgdmFyIGNtID0gYnlDbGFzc1tpXS5Db2RlTWlycm9yO1xuICAgICAgaWYgKGNtKSBmKGNtKTtcbiAgICB9XG4gIH1cblxuICB2YXIgZ2xvYmFsc1JlZ2lzdGVyZWQgPSBmYWxzZTtcbiAgZnVuY3Rpb24gZW5zdXJlR2xvYmFsSGFuZGxlcnMoKSB7XG4gICAgaWYgKGdsb2JhbHNSZWdpc3RlcmVkKSByZXR1cm47XG4gICAgcmVnaXN0ZXJHbG9iYWxIYW5kbGVycygpO1xuICAgIGdsb2JhbHNSZWdpc3RlcmVkID0gdHJ1ZTtcbiAgfVxuICBmdW5jdGlvbiByZWdpc3Rlckdsb2JhbEhhbmRsZXJzKCkge1xuICAgIC8vIFdoZW4gdGhlIHdpbmRvdyByZXNpemVzLCB3ZSBuZWVkIHRvIHJlZnJlc2ggYWN0aXZlIGVkaXRvcnMuXG4gICAgdmFyIHJlc2l6ZVRpbWVyO1xuICAgIG9uKHdpbmRvdywgXCJyZXNpemVcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBpZiAocmVzaXplVGltZXIgPT0gbnVsbCkgcmVzaXplVGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICByZXNpemVUaW1lciA9IG51bGw7XG4gICAgICAgIGZvckVhY2hDb2RlTWlycm9yKG9uUmVzaXplKTtcbiAgICAgIH0sIDEwMCk7XG4gICAgfSk7XG4gICAgLy8gV2hlbiB0aGUgd2luZG93IGxvc2VzIGZvY3VzLCB3ZSB3YW50IHRvIHNob3cgdGhlIGVkaXRvciBhcyBibHVycmVkXG4gICAgb24od2luZG93LCBcImJsdXJcIiwgZnVuY3Rpb24oKSB7XG4gICAgICBmb3JFYWNoQ29kZU1pcnJvcihvbkJsdXIpO1xuICAgIH0pO1xuICB9XG5cbiAgLy8gRkVBVFVSRSBERVRFQ1RJT05cblxuICAvLyBEZXRlY3QgZHJhZy1hbmQtZHJvcFxuICB2YXIgZHJhZ0FuZERyb3AgPSBmdW5jdGlvbigpIHtcbiAgICAvLyBUaGVyZSBpcyAqc29tZSoga2luZCBvZiBkcmFnLWFuZC1kcm9wIHN1cHBvcnQgaW4gSUU2LTgsIGJ1dCBJXG4gICAgLy8gY291bGRuJ3QgZ2V0IGl0IHRvIHdvcmsgeWV0LlxuICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uIDwgOSkgcmV0dXJuIGZhbHNlO1xuICAgIHZhciBkaXYgPSBlbHQoJ2RpdicpO1xuICAgIHJldHVybiBcImRyYWdnYWJsZVwiIGluIGRpdiB8fCBcImRyYWdEcm9wXCIgaW4gZGl2O1xuICB9KCk7XG5cbiAgdmFyIHp3c3BTdXBwb3J0ZWQ7XG4gIGZ1bmN0aW9uIHplcm9XaWR0aEVsZW1lbnQobWVhc3VyZSkge1xuICAgIGlmICh6d3NwU3VwcG9ydGVkID09IG51bGwpIHtcbiAgICAgIHZhciB0ZXN0ID0gZWx0KFwic3BhblwiLCBcIlxcdTIwMGJcIik7XG4gICAgICByZW1vdmVDaGlsZHJlbkFuZEFkZChtZWFzdXJlLCBlbHQoXCJzcGFuXCIsIFt0ZXN0LCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShcInhcIildKSk7XG4gICAgICBpZiAobWVhc3VyZS5maXJzdENoaWxkLm9mZnNldEhlaWdodCAhPSAwKVxuICAgICAgICB6d3NwU3VwcG9ydGVkID0gdGVzdC5vZmZzZXRXaWR0aCA8PSAxICYmIHRlc3Qub2Zmc2V0SGVpZ2h0ID4gMiAmJiAhKGllICYmIGllX3ZlcnNpb24gPCA4KTtcbiAgICB9XG4gICAgdmFyIG5vZGUgPSB6d3NwU3VwcG9ydGVkID8gZWx0KFwic3BhblwiLCBcIlxcdTIwMGJcIikgOlxuICAgICAgZWx0KFwic3BhblwiLCBcIlxcdTAwYTBcIiwgbnVsbCwgXCJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IHdpZHRoOiAxcHg7IG1hcmdpbi1yaWdodDogLTFweFwiKTtcbiAgICBub2RlLnNldEF0dHJpYnV0ZShcImNtLXRleHRcIiwgXCJcIik7XG4gICAgcmV0dXJuIG5vZGU7XG4gIH1cblxuICAvLyBGZWF0dXJlLWRldGVjdCBJRSdzIGNydW1teSBjbGllbnQgcmVjdCByZXBvcnRpbmcgZm9yIGJpZGkgdGV4dFxuICB2YXIgYmFkQmlkaVJlY3RzO1xuICBmdW5jdGlvbiBoYXNCYWRCaWRpUmVjdHMobWVhc3VyZSkge1xuICAgIGlmIChiYWRCaWRpUmVjdHMgIT0gbnVsbCkgcmV0dXJuIGJhZEJpZGlSZWN0cztcbiAgICB2YXIgdHh0ID0gcmVtb3ZlQ2hpbGRyZW5BbmRBZGQobWVhc3VyZSwgZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoXCJBXFx1MDYyZUFcIikpO1xuICAgIHZhciByMCA9IHJhbmdlKHR4dCwgMCwgMSkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgaWYgKCFyMCB8fCByMC5sZWZ0ID09IHIwLnJpZ2h0KSByZXR1cm4gZmFsc2U7IC8vIFNhZmFyaSByZXR1cm5zIG51bGwgaW4gc29tZSBjYXNlcyAoIzI3ODApXG4gICAgdmFyIHIxID0gcmFuZ2UodHh0LCAxLCAyKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICByZXR1cm4gYmFkQmlkaVJlY3RzID0gKHIxLnJpZ2h0IC0gcjAucmlnaHQgPCAzKTtcbiAgfVxuXG4gIC8vIFNlZSBpZiBcIlwiLnNwbGl0IGlzIHRoZSBicm9rZW4gSUUgdmVyc2lvbiwgaWYgc28sIHByb3ZpZGUgYW5cbiAgLy8gYWx0ZXJuYXRpdmUgd2F5IHRvIHNwbGl0IGxpbmVzLlxuICB2YXIgc3BsaXRMaW5lc0F1dG8gPSBDb2RlTWlycm9yLnNwbGl0TGluZXMgPSBcIlxcblxcbmJcIi5zcGxpdCgvXFxuLykubGVuZ3RoICE9IDMgPyBmdW5jdGlvbihzdHJpbmcpIHtcbiAgICB2YXIgcG9zID0gMCwgcmVzdWx0ID0gW10sIGwgPSBzdHJpbmcubGVuZ3RoO1xuICAgIHdoaWxlIChwb3MgPD0gbCkge1xuICAgICAgdmFyIG5sID0gc3RyaW5nLmluZGV4T2YoXCJcXG5cIiwgcG9zKTtcbiAgICAgIGlmIChubCA9PSAtMSkgbmwgPSBzdHJpbmcubGVuZ3RoO1xuICAgICAgdmFyIGxpbmUgPSBzdHJpbmcuc2xpY2UocG9zLCBzdHJpbmcuY2hhckF0KG5sIC0gMSkgPT0gXCJcXHJcIiA/IG5sIC0gMSA6IG5sKTtcbiAgICAgIHZhciBydCA9IGxpbmUuaW5kZXhPZihcIlxcclwiKTtcbiAgICAgIGlmIChydCAhPSAtMSkge1xuICAgICAgICByZXN1bHQucHVzaChsaW5lLnNsaWNlKDAsIHJ0KSk7XG4gICAgICAgIHBvcyArPSBydCArIDE7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXN1bHQucHVzaChsaW5lKTtcbiAgICAgICAgcG9zID0gbmwgKyAxO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9IDogZnVuY3Rpb24oc3RyaW5nKXtyZXR1cm4gc3RyaW5nLnNwbGl0KC9cXHJcXG4/fFxcbi8pO307XG5cbiAgdmFyIGhhc1NlbGVjdGlvbiA9IHdpbmRvdy5nZXRTZWxlY3Rpb24gPyBmdW5jdGlvbih0ZSkge1xuICAgIHRyeSB7IHJldHVybiB0ZS5zZWxlY3Rpb25TdGFydCAhPSB0ZS5zZWxlY3Rpb25FbmQ7IH1cbiAgICBjYXRjaChlKSB7IHJldHVybiBmYWxzZTsgfVxuICB9IDogZnVuY3Rpb24odGUpIHtcbiAgICB0cnkge3ZhciByYW5nZSA9IHRlLm93bmVyRG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCk7fVxuICAgIGNhdGNoKGUpIHt9XG4gICAgaWYgKCFyYW5nZSB8fCByYW5nZS5wYXJlbnRFbGVtZW50KCkgIT0gdGUpIHJldHVybiBmYWxzZTtcbiAgICByZXR1cm4gcmFuZ2UuY29tcGFyZUVuZFBvaW50cyhcIlN0YXJ0VG9FbmRcIiwgcmFuZ2UpICE9IDA7XG4gIH07XG5cbiAgdmFyIGhhc0NvcHlFdmVudCA9IChmdW5jdGlvbigpIHtcbiAgICB2YXIgZSA9IGVsdChcImRpdlwiKTtcbiAgICBpZiAoXCJvbmNvcHlcIiBpbiBlKSByZXR1cm4gdHJ1ZTtcbiAgICBlLnNldEF0dHJpYnV0ZShcIm9uY29weVwiLCBcInJldHVybjtcIik7XG4gICAgcmV0dXJuIHR5cGVvZiBlLm9uY29weSA9PSBcImZ1bmN0aW9uXCI7XG4gIH0pKCk7XG5cbiAgdmFyIGJhZFpvb21lZFJlY3RzID0gbnVsbDtcbiAgZnVuY3Rpb24gaGFzQmFkWm9vbWVkUmVjdHMobWVhc3VyZSkge1xuICAgIGlmIChiYWRab29tZWRSZWN0cyAhPSBudWxsKSByZXR1cm4gYmFkWm9vbWVkUmVjdHM7XG4gICAgdmFyIG5vZGUgPSByZW1vdmVDaGlsZHJlbkFuZEFkZChtZWFzdXJlLCBlbHQoXCJzcGFuXCIsIFwieFwiKSk7XG4gICAgdmFyIG5vcm1hbCA9IG5vZGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgdmFyIGZyb21SYW5nZSA9IHJhbmdlKG5vZGUsIDAsIDEpLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHJldHVybiBiYWRab29tZWRSZWN0cyA9IE1hdGguYWJzKG5vcm1hbC5sZWZ0IC0gZnJvbVJhbmdlLmxlZnQpID4gMTtcbiAgfVxuXG4gIC8vIEtFWSBOQU1FU1xuXG4gIHZhciBrZXlOYW1lcyA9IENvZGVNaXJyb3Iua2V5TmFtZXMgPSB7XG4gICAgMzogXCJFbnRlclwiLCA4OiBcIkJhY2tzcGFjZVwiLCA5OiBcIlRhYlwiLCAxMzogXCJFbnRlclwiLCAxNjogXCJTaGlmdFwiLCAxNzogXCJDdHJsXCIsIDE4OiBcIkFsdFwiLFxuICAgIDE5OiBcIlBhdXNlXCIsIDIwOiBcIkNhcHNMb2NrXCIsIDI3OiBcIkVzY1wiLCAzMjogXCJTcGFjZVwiLCAzMzogXCJQYWdlVXBcIiwgMzQ6IFwiUGFnZURvd25cIiwgMzU6IFwiRW5kXCIsXG4gICAgMzY6IFwiSG9tZVwiLCAzNzogXCJMZWZ0XCIsIDM4OiBcIlVwXCIsIDM5OiBcIlJpZ2h0XCIsIDQwOiBcIkRvd25cIiwgNDQ6IFwiUHJpbnRTY3JuXCIsIDQ1OiBcIkluc2VydFwiLFxuICAgIDQ2OiBcIkRlbGV0ZVwiLCA1OTogXCI7XCIsIDYxOiBcIj1cIiwgOTE6IFwiTW9kXCIsIDkyOiBcIk1vZFwiLCA5MzogXCJNb2RcIixcbiAgICAxMDY6IFwiKlwiLCAxMDc6IFwiPVwiLCAxMDk6IFwiLVwiLCAxMTA6IFwiLlwiLCAxMTE6IFwiL1wiLCAxMjc6IFwiRGVsZXRlXCIsXG4gICAgMTczOiBcIi1cIiwgMTg2OiBcIjtcIiwgMTg3OiBcIj1cIiwgMTg4OiBcIixcIiwgMTg5OiBcIi1cIiwgMTkwOiBcIi5cIiwgMTkxOiBcIi9cIiwgMTkyOiBcImBcIiwgMjE5OiBcIltcIiwgMjIwOiBcIlxcXFxcIixcbiAgICAyMjE6IFwiXVwiLCAyMjI6IFwiJ1wiLCA2MzIzMjogXCJVcFwiLCA2MzIzMzogXCJEb3duXCIsIDYzMjM0OiBcIkxlZnRcIiwgNjMyMzU6IFwiUmlnaHRcIiwgNjMyNzI6IFwiRGVsZXRlXCIsXG4gICAgNjMyNzM6IFwiSG9tZVwiLCA2MzI3NTogXCJFbmRcIiwgNjMyNzY6IFwiUGFnZVVwXCIsIDYzMjc3OiBcIlBhZ2VEb3duXCIsIDYzMzAyOiBcIkluc2VydFwiXG4gIH07XG4gIChmdW5jdGlvbigpIHtcbiAgICAvLyBOdW1iZXIga2V5c1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgMTA7IGkrKykga2V5TmFtZXNbaSArIDQ4XSA9IGtleU5hbWVzW2kgKyA5Nl0gPSBTdHJpbmcoaSk7XG4gICAgLy8gQWxwaGFiZXRpYyBrZXlzXG4gICAgZm9yICh2YXIgaSA9IDY1OyBpIDw9IDkwOyBpKyspIGtleU5hbWVzW2ldID0gU3RyaW5nLmZyb21DaGFyQ29kZShpKTtcbiAgICAvLyBGdW5jdGlvbiBrZXlzXG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPD0gMTI7IGkrKykga2V5TmFtZXNbaSArIDExMV0gPSBrZXlOYW1lc1tpICsgNjMyMzVdID0gXCJGXCIgKyBpO1xuICB9KSgpO1xuXG4gIC8vIEJJREkgSEVMUEVSU1xuXG4gIGZ1bmN0aW9uIGl0ZXJhdGVCaWRpU2VjdGlvbnMob3JkZXIsIGZyb20sIHRvLCBmKSB7XG4gICAgaWYgKCFvcmRlcikgcmV0dXJuIGYoZnJvbSwgdG8sIFwibHRyXCIpO1xuICAgIHZhciBmb3VuZCA9IGZhbHNlO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3JkZXIubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBwYXJ0ID0gb3JkZXJbaV07XG4gICAgICBpZiAocGFydC5mcm9tIDwgdG8gJiYgcGFydC50byA+IGZyb20gfHwgZnJvbSA9PSB0byAmJiBwYXJ0LnRvID09IGZyb20pIHtcbiAgICAgICAgZihNYXRoLm1heChwYXJ0LmZyb20sIGZyb20pLCBNYXRoLm1pbihwYXJ0LnRvLCB0byksIHBhcnQubGV2ZWwgPT0gMSA/IFwicnRsXCIgOiBcImx0clwiKTtcbiAgICAgICAgZm91bmQgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAoIWZvdW5kKSBmKGZyb20sIHRvLCBcImx0clwiKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGJpZGlMZWZ0KHBhcnQpIHsgcmV0dXJuIHBhcnQubGV2ZWwgJSAyID8gcGFydC50byA6IHBhcnQuZnJvbTsgfVxuICBmdW5jdGlvbiBiaWRpUmlnaHQocGFydCkgeyByZXR1cm4gcGFydC5sZXZlbCAlIDIgPyBwYXJ0LmZyb20gOiBwYXJ0LnRvOyB9XG5cbiAgZnVuY3Rpb24gbGluZUxlZnQobGluZSkgeyB2YXIgb3JkZXIgPSBnZXRPcmRlcihsaW5lKTsgcmV0dXJuIG9yZGVyID8gYmlkaUxlZnQob3JkZXJbMF0pIDogMDsgfVxuICBmdW5jdGlvbiBsaW5lUmlnaHQobGluZSkge1xuICAgIHZhciBvcmRlciA9IGdldE9yZGVyKGxpbmUpO1xuICAgIGlmICghb3JkZXIpIHJldHVybiBsaW5lLnRleHQubGVuZ3RoO1xuICAgIHJldHVybiBiaWRpUmlnaHQobHN0KG9yZGVyKSk7XG4gIH1cblxuICBmdW5jdGlvbiBsaW5lU3RhcnQoY20sIGxpbmVOKSB7XG4gICAgdmFyIGxpbmUgPSBnZXRMaW5lKGNtLmRvYywgbGluZU4pO1xuICAgIHZhciB2aXN1YWwgPSB2aXN1YWxMaW5lKGxpbmUpO1xuICAgIGlmICh2aXN1YWwgIT0gbGluZSkgbGluZU4gPSBsaW5lTm8odmlzdWFsKTtcbiAgICB2YXIgb3JkZXIgPSBnZXRPcmRlcih2aXN1YWwpO1xuICAgIHZhciBjaCA9ICFvcmRlciA/IDAgOiBvcmRlclswXS5sZXZlbCAlIDIgPyBsaW5lUmlnaHQodmlzdWFsKSA6IGxpbmVMZWZ0KHZpc3VhbCk7XG4gICAgcmV0dXJuIFBvcyhsaW5lTiwgY2gpO1xuICB9XG4gIGZ1bmN0aW9uIGxpbmVFbmQoY20sIGxpbmVOKSB7XG4gICAgdmFyIG1lcmdlZCwgbGluZSA9IGdldExpbmUoY20uZG9jLCBsaW5lTik7XG4gICAgd2hpbGUgKG1lcmdlZCA9IGNvbGxhcHNlZFNwYW5BdEVuZChsaW5lKSkge1xuICAgICAgbGluZSA9IG1lcmdlZC5maW5kKDEsIHRydWUpLmxpbmU7XG4gICAgICBsaW5lTiA9IG51bGw7XG4gICAgfVxuICAgIHZhciBvcmRlciA9IGdldE9yZGVyKGxpbmUpO1xuICAgIHZhciBjaCA9ICFvcmRlciA/IGxpbmUudGV4dC5sZW5ndGggOiBvcmRlclswXS5sZXZlbCAlIDIgPyBsaW5lTGVmdChsaW5lKSA6IGxpbmVSaWdodChsaW5lKTtcbiAgICByZXR1cm4gUG9zKGxpbmVOID09IG51bGwgPyBsaW5lTm8obGluZSkgOiBsaW5lTiwgY2gpO1xuICB9XG4gIGZ1bmN0aW9uIGxpbmVTdGFydFNtYXJ0KGNtLCBwb3MpIHtcbiAgICB2YXIgc3RhcnQgPSBsaW5lU3RhcnQoY20sIHBvcy5saW5lKTtcbiAgICB2YXIgbGluZSA9IGdldExpbmUoY20uZG9jLCBzdGFydC5saW5lKTtcbiAgICB2YXIgb3JkZXIgPSBnZXRPcmRlcihsaW5lKTtcbiAgICBpZiAoIW9yZGVyIHx8IG9yZGVyWzBdLmxldmVsID09IDApIHtcbiAgICAgIHZhciBmaXJzdE5vbldTID0gTWF0aC5tYXgoMCwgbGluZS50ZXh0LnNlYXJjaCgvXFxTLykpO1xuICAgICAgdmFyIGluV1MgPSBwb3MubGluZSA9PSBzdGFydC5saW5lICYmIHBvcy5jaCA8PSBmaXJzdE5vbldTICYmIHBvcy5jaDtcbiAgICAgIHJldHVybiBQb3Moc3RhcnQubGluZSwgaW5XUyA/IDAgOiBmaXJzdE5vbldTKTtcbiAgICB9XG4gICAgcmV0dXJuIHN0YXJ0O1xuICB9XG5cbiAgZnVuY3Rpb24gY29tcGFyZUJpZGlMZXZlbChvcmRlciwgYSwgYikge1xuICAgIHZhciBsaW5lZGlyID0gb3JkZXJbMF0ubGV2ZWw7XG4gICAgaWYgKGEgPT0gbGluZWRpcikgcmV0dXJuIHRydWU7XG4gICAgaWYgKGIgPT0gbGluZWRpcikgcmV0dXJuIGZhbHNlO1xuICAgIHJldHVybiBhIDwgYjtcbiAgfVxuICB2YXIgYmlkaU90aGVyO1xuICBmdW5jdGlvbiBnZXRCaWRpUGFydEF0KG9yZGVyLCBwb3MpIHtcbiAgICBiaWRpT3RoZXIgPSBudWxsO1xuICAgIGZvciAodmFyIGkgPSAwLCBmb3VuZDsgaSA8IG9yZGVyLmxlbmd0aDsgKytpKSB7XG4gICAgICB2YXIgY3VyID0gb3JkZXJbaV07XG4gICAgICBpZiAoY3VyLmZyb20gPCBwb3MgJiYgY3VyLnRvID4gcG9zKSByZXR1cm4gaTtcbiAgICAgIGlmICgoY3VyLmZyb20gPT0gcG9zIHx8IGN1ci50byA9PSBwb3MpKSB7XG4gICAgICAgIGlmIChmb3VuZCA9PSBudWxsKSB7XG4gICAgICAgICAgZm91bmQgPSBpO1xuICAgICAgICB9IGVsc2UgaWYgKGNvbXBhcmVCaWRpTGV2ZWwob3JkZXIsIGN1ci5sZXZlbCwgb3JkZXJbZm91bmRdLmxldmVsKSkge1xuICAgICAgICAgIGlmIChjdXIuZnJvbSAhPSBjdXIudG8pIGJpZGlPdGhlciA9IGZvdW5kO1xuICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChjdXIuZnJvbSAhPSBjdXIudG8pIGJpZGlPdGhlciA9IGk7XG4gICAgICAgICAgcmV0dXJuIGZvdW5kO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmb3VuZDtcbiAgfVxuXG4gIGZ1bmN0aW9uIG1vdmVJbkxpbmUobGluZSwgcG9zLCBkaXIsIGJ5VW5pdCkge1xuICAgIGlmICghYnlVbml0KSByZXR1cm4gcG9zICsgZGlyO1xuICAgIGRvIHBvcyArPSBkaXI7XG4gICAgd2hpbGUgKHBvcyA+IDAgJiYgaXNFeHRlbmRpbmdDaGFyKGxpbmUudGV4dC5jaGFyQXQocG9zKSkpO1xuICAgIHJldHVybiBwb3M7XG4gIH1cblxuICAvLyBUaGlzIGlzIG5lZWRlZCBpbiBvcmRlciB0byBtb3ZlICd2aXN1YWxseScgdGhyb3VnaCBiaS1kaXJlY3Rpb25hbFxuICAvLyB0ZXh0IC0tIGkuZS4sIHByZXNzaW5nIGxlZnQgc2hvdWxkIG1ha2UgdGhlIGN1cnNvciBnbyBsZWZ0LCBldmVuXG4gIC8vIHdoZW4gaW4gUlRMIHRleHQuIFRoZSB0cmlja3kgcGFydCBpcyB0aGUgJ2p1bXBzJywgd2hlcmUgUlRMIGFuZFxuICAvLyBMVFIgdGV4dCB0b3VjaCBlYWNoIG90aGVyLiBUaGlzIG9mdGVuIHJlcXVpcmVzIHRoZSBjdXJzb3Igb2Zmc2V0XG4gIC8vIHRvIG1vdmUgbW9yZSB0aGFuIG9uZSB1bml0LCBpbiBvcmRlciB0byB2aXN1YWxseSBtb3ZlIG9uZSB1bml0LlxuICBmdW5jdGlvbiBtb3ZlVmlzdWFsbHkobGluZSwgc3RhcnQsIGRpciwgYnlVbml0KSB7XG4gICAgdmFyIGJpZGkgPSBnZXRPcmRlcihsaW5lKTtcbiAgICBpZiAoIWJpZGkpIHJldHVybiBtb3ZlTG9naWNhbGx5KGxpbmUsIHN0YXJ0LCBkaXIsIGJ5VW5pdCk7XG4gICAgdmFyIHBvcyA9IGdldEJpZGlQYXJ0QXQoYmlkaSwgc3RhcnQpLCBwYXJ0ID0gYmlkaVtwb3NdO1xuICAgIHZhciB0YXJnZXQgPSBtb3ZlSW5MaW5lKGxpbmUsIHN0YXJ0LCBwYXJ0LmxldmVsICUgMiA/IC1kaXIgOiBkaXIsIGJ5VW5pdCk7XG5cbiAgICBmb3IgKDs7KSB7XG4gICAgICBpZiAodGFyZ2V0ID4gcGFydC5mcm9tICYmIHRhcmdldCA8IHBhcnQudG8pIHJldHVybiB0YXJnZXQ7XG4gICAgICBpZiAodGFyZ2V0ID09IHBhcnQuZnJvbSB8fCB0YXJnZXQgPT0gcGFydC50bykge1xuICAgICAgICBpZiAoZ2V0QmlkaVBhcnRBdChiaWRpLCB0YXJnZXQpID09IHBvcykgcmV0dXJuIHRhcmdldDtcbiAgICAgICAgcGFydCA9IGJpZGlbcG9zICs9IGRpcl07XG4gICAgICAgIHJldHVybiAoZGlyID4gMCkgPT0gcGFydC5sZXZlbCAlIDIgPyBwYXJ0LnRvIDogcGFydC5mcm9tO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcGFydCA9IGJpZGlbcG9zICs9IGRpcl07XG4gICAgICAgIGlmICghcGFydCkgcmV0dXJuIG51bGw7XG4gICAgICAgIGlmICgoZGlyID4gMCkgPT0gcGFydC5sZXZlbCAlIDIpXG4gICAgICAgICAgdGFyZ2V0ID0gbW92ZUluTGluZShsaW5lLCBwYXJ0LnRvLCAtMSwgYnlVbml0KTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgIHRhcmdldCA9IG1vdmVJbkxpbmUobGluZSwgcGFydC5mcm9tLCAxLCBieVVuaXQpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIG1vdmVMb2dpY2FsbHkobGluZSwgc3RhcnQsIGRpciwgYnlVbml0KSB7XG4gICAgdmFyIHRhcmdldCA9IHN0YXJ0ICsgZGlyO1xuICAgIGlmIChieVVuaXQpIHdoaWxlICh0YXJnZXQgPiAwICYmIGlzRXh0ZW5kaW5nQ2hhcihsaW5lLnRleHQuY2hhckF0KHRhcmdldCkpKSB0YXJnZXQgKz0gZGlyO1xuICAgIHJldHVybiB0YXJnZXQgPCAwIHx8IHRhcmdldCA+IGxpbmUudGV4dC5sZW5ndGggPyBudWxsIDogdGFyZ2V0O1xuICB9XG5cbiAgLy8gQmlkaXJlY3Rpb25hbCBvcmRlcmluZyBhbGdvcml0aG1cbiAgLy8gU2VlIGh0dHA6Ly91bmljb2RlLm9yZy9yZXBvcnRzL3RyOS90cjktMTMuaHRtbCBmb3IgdGhlIGFsZ29yaXRobVxuICAvLyB0aGF0IHRoaXMgKHBhcnRpYWxseSkgaW1wbGVtZW50cy5cblxuICAvLyBPbmUtY2hhciBjb2RlcyB1c2VkIGZvciBjaGFyYWN0ZXIgdHlwZXM6XG4gIC8vIEwgKEwpOiAgIExlZnQtdG8tUmlnaHRcbiAgLy8gUiAoUik6ICAgUmlnaHQtdG8tTGVmdFxuICAvLyByIChBTCk6ICBSaWdodC10by1MZWZ0IEFyYWJpY1xuICAvLyAxIChFTik6ICBFdXJvcGVhbiBOdW1iZXJcbiAgLy8gKyAoRVMpOiAgRXVyb3BlYW4gTnVtYmVyIFNlcGFyYXRvclxuICAvLyAlIChFVCk6ICBFdXJvcGVhbiBOdW1iZXIgVGVybWluYXRvclxuICAvLyBuIChBTik6ICBBcmFiaWMgTnVtYmVyXG4gIC8vICwgKENTKTogIENvbW1vbiBOdW1iZXIgU2VwYXJhdG9yXG4gIC8vIG0gKE5TTSk6IE5vbi1TcGFjaW5nIE1hcmtcbiAgLy8gYiAoQk4pOiAgQm91bmRhcnkgTmV1dHJhbFxuICAvLyBzIChCKTogICBQYXJhZ3JhcGggU2VwYXJhdG9yXG4gIC8vIHQgKFMpOiAgIFNlZ21lbnQgU2VwYXJhdG9yXG4gIC8vIHcgKFdTKTogIFdoaXRlc3BhY2VcbiAgLy8gTiAoT04pOiAgT3RoZXIgTmV1dHJhbHNcblxuICAvLyBSZXR1cm5zIG51bGwgaWYgY2hhcmFjdGVycyBhcmUgb3JkZXJlZCBhcyB0aGV5IGFwcGVhclxuICAvLyAobGVmdC10by1yaWdodCksIG9yIGFuIGFycmF5IG9mIHNlY3Rpb25zICh7ZnJvbSwgdG8sIGxldmVsfVxuICAvLyBvYmplY3RzKSBpbiB0aGUgb3JkZXIgaW4gd2hpY2ggdGhleSBvY2N1ciB2aXN1YWxseS5cbiAgdmFyIGJpZGlPcmRlcmluZyA9IChmdW5jdGlvbigpIHtcbiAgICAvLyBDaGFyYWN0ZXIgdHlwZXMgZm9yIGNvZGVwb2ludHMgMCB0byAweGZmXG4gICAgdmFyIGxvd1R5cGVzID0gXCJiYmJiYmJiYmJ0c3R3c2JiYmJiYmJiYmJiYmJic3NzdHdOTiUlJU5OTk5OTixOLE4xMTExMTExMTExTk5OTk5OTkxMTExMTExMTExMTExMTExMTExMTExMTExMTk5OTk5OTExMTExMTExMTExMTExMTExMTExMTExMTExOTk5OYmJiYmJic2JiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiLE4lJSUlTk5OTkxOTk5OTiUlMTFOTE5OTjFMTk5OTk5MTExMTExMTExMTExMTExMTExMTExMTE5MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTlwiO1xuICAgIC8vIENoYXJhY3RlciB0eXBlcyBmb3IgY29kZXBvaW50cyAweDYwMCB0byAweDZmZlxuICAgIHZhciBhcmFiaWNUeXBlcyA9IFwicnJycnJycnJycnJyLHJOTm1tbW1tbXJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJybW1tbW1tbW1tbW1tbW1ycnJycnJybm5ubm5ubm5ubiVubnJycm1ycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycm1tbW1tbW1tbW1tbW1tbW1tbW1ObW1tbVwiO1xuICAgIGZ1bmN0aW9uIGNoYXJUeXBlKGNvZGUpIHtcbiAgICAgIGlmIChjb2RlIDw9IDB4ZjcpIHJldHVybiBsb3dUeXBlcy5jaGFyQXQoY29kZSk7XG4gICAgICBlbHNlIGlmICgweDU5MCA8PSBjb2RlICYmIGNvZGUgPD0gMHg1ZjQpIHJldHVybiBcIlJcIjtcbiAgICAgIGVsc2UgaWYgKDB4NjAwIDw9IGNvZGUgJiYgY29kZSA8PSAweDZlZCkgcmV0dXJuIGFyYWJpY1R5cGVzLmNoYXJBdChjb2RlIC0gMHg2MDApO1xuICAgICAgZWxzZSBpZiAoMHg2ZWUgPD0gY29kZSAmJiBjb2RlIDw9IDB4OGFjKSByZXR1cm4gXCJyXCI7XG4gICAgICBlbHNlIGlmICgweDIwMDAgPD0gY29kZSAmJiBjb2RlIDw9IDB4MjAwYikgcmV0dXJuIFwid1wiO1xuICAgICAgZWxzZSBpZiAoY29kZSA9PSAweDIwMGMpIHJldHVybiBcImJcIjtcbiAgICAgIGVsc2UgcmV0dXJuIFwiTFwiO1xuICAgIH1cblxuICAgIHZhciBiaWRpUkUgPSAvW1xcdTA1OTAtXFx1MDVmNFxcdTA2MDAtXFx1MDZmZlxcdTA3MDAtXFx1MDhhY10vO1xuICAgIHZhciBpc05ldXRyYWwgPSAvW3N0d05dLywgaXNTdHJvbmcgPSAvW0xScl0vLCBjb3VudHNBc0xlZnQgPSAvW0xiMW5dLywgY291bnRzQXNOdW0gPSAvWzFuXS87XG4gICAgLy8gQnJvd3NlcnMgc2VlbSB0byBhbHdheXMgdHJlYXQgdGhlIGJvdW5kYXJpZXMgb2YgYmxvY2sgZWxlbWVudHMgYXMgYmVpbmcgTC5cbiAgICB2YXIgb3V0ZXJUeXBlID0gXCJMXCI7XG5cbiAgICBmdW5jdGlvbiBCaWRpU3BhbihsZXZlbCwgZnJvbSwgdG8pIHtcbiAgICAgIHRoaXMubGV2ZWwgPSBsZXZlbDtcbiAgICAgIHRoaXMuZnJvbSA9IGZyb207IHRoaXMudG8gPSB0bztcbiAgICB9XG5cbiAgICByZXR1cm4gZnVuY3Rpb24oc3RyKSB7XG4gICAgICBpZiAoIWJpZGlSRS50ZXN0KHN0cikpIHJldHVybiBmYWxzZTtcbiAgICAgIHZhciBsZW4gPSBzdHIubGVuZ3RoLCB0eXBlcyA9IFtdO1xuICAgICAgZm9yICh2YXIgaSA9IDAsIHR5cGU7IGkgPCBsZW47ICsraSlcbiAgICAgICAgdHlwZXMucHVzaCh0eXBlID0gY2hhclR5cGUoc3RyLmNoYXJDb2RlQXQoaSkpKTtcblxuICAgICAgLy8gVzEuIEV4YW1pbmUgZWFjaCBub24tc3BhY2luZyBtYXJrIChOU00pIGluIHRoZSBsZXZlbCBydW4sIGFuZFxuICAgICAgLy8gY2hhbmdlIHRoZSB0eXBlIG9mIHRoZSBOU00gdG8gdGhlIHR5cGUgb2YgdGhlIHByZXZpb3VzXG4gICAgICAvLyBjaGFyYWN0ZXIuIElmIHRoZSBOU00gaXMgYXQgdGhlIHN0YXJ0IG9mIHRoZSBsZXZlbCBydW4sIGl0IHdpbGxcbiAgICAgIC8vIGdldCB0aGUgdHlwZSBvZiBzb3IuXG4gICAgICBmb3IgKHZhciBpID0gMCwgcHJldiA9IG91dGVyVHlwZTsgaSA8IGxlbjsgKytpKSB7XG4gICAgICAgIHZhciB0eXBlID0gdHlwZXNbaV07XG4gICAgICAgIGlmICh0eXBlID09IFwibVwiKSB0eXBlc1tpXSA9IHByZXY7XG4gICAgICAgIGVsc2UgcHJldiA9IHR5cGU7XG4gICAgICB9XG5cbiAgICAgIC8vIFcyLiBTZWFyY2ggYmFja3dhcmRzIGZyb20gZWFjaCBpbnN0YW5jZSBvZiBhIEV1cm9wZWFuIG51bWJlclxuICAgICAgLy8gdW50aWwgdGhlIGZpcnN0IHN0cm9uZyB0eXBlIChSLCBMLCBBTCwgb3Igc29yKSBpcyBmb3VuZC4gSWYgYW5cbiAgICAgIC8vIEFMIGlzIGZvdW5kLCBjaGFuZ2UgdGhlIHR5cGUgb2YgdGhlIEV1cm9wZWFuIG51bWJlciB0byBBcmFiaWNcbiAgICAgIC8vIG51bWJlci5cbiAgICAgIC8vIFczLiBDaGFuZ2UgYWxsIEFMcyB0byBSLlxuICAgICAgZm9yICh2YXIgaSA9IDAsIGN1ciA9IG91dGVyVHlwZTsgaSA8IGxlbjsgKytpKSB7XG4gICAgICAgIHZhciB0eXBlID0gdHlwZXNbaV07XG4gICAgICAgIGlmICh0eXBlID09IFwiMVwiICYmIGN1ciA9PSBcInJcIikgdHlwZXNbaV0gPSBcIm5cIjtcbiAgICAgICAgZWxzZSBpZiAoaXNTdHJvbmcudGVzdCh0eXBlKSkgeyBjdXIgPSB0eXBlOyBpZiAodHlwZSA9PSBcInJcIikgdHlwZXNbaV0gPSBcIlJcIjsgfVxuICAgICAgfVxuXG4gICAgICAvLyBXNC4gQSBzaW5nbGUgRXVyb3BlYW4gc2VwYXJhdG9yIGJldHdlZW4gdHdvIEV1cm9wZWFuIG51bWJlcnNcbiAgICAgIC8vIGNoYW5nZXMgdG8gYSBFdXJvcGVhbiBudW1iZXIuIEEgc2luZ2xlIGNvbW1vbiBzZXBhcmF0b3IgYmV0d2VlblxuICAgICAgLy8gdHdvIG51bWJlcnMgb2YgdGhlIHNhbWUgdHlwZSBjaGFuZ2VzIHRvIHRoYXQgdHlwZS5cbiAgICAgIGZvciAodmFyIGkgPSAxLCBwcmV2ID0gdHlwZXNbMF07IGkgPCBsZW4gLSAxOyArK2kpIHtcbiAgICAgICAgdmFyIHR5cGUgPSB0eXBlc1tpXTtcbiAgICAgICAgaWYgKHR5cGUgPT0gXCIrXCIgJiYgcHJldiA9PSBcIjFcIiAmJiB0eXBlc1tpKzFdID09IFwiMVwiKSB0eXBlc1tpXSA9IFwiMVwiO1xuICAgICAgICBlbHNlIGlmICh0eXBlID09IFwiLFwiICYmIHByZXYgPT0gdHlwZXNbaSsxXSAmJlxuICAgICAgICAgICAgICAgICAocHJldiA9PSBcIjFcIiB8fCBwcmV2ID09IFwiblwiKSkgdHlwZXNbaV0gPSBwcmV2O1xuICAgICAgICBwcmV2ID0gdHlwZTtcbiAgICAgIH1cblxuICAgICAgLy8gVzUuIEEgc2VxdWVuY2Ugb2YgRXVyb3BlYW4gdGVybWluYXRvcnMgYWRqYWNlbnQgdG8gRXVyb3BlYW5cbiAgICAgIC8vIG51bWJlcnMgY2hhbmdlcyB0byBhbGwgRXVyb3BlYW4gbnVtYmVycy5cbiAgICAgIC8vIFc2LiBPdGhlcndpc2UsIHNlcGFyYXRvcnMgYW5kIHRlcm1pbmF0b3JzIGNoYW5nZSB0byBPdGhlclxuICAgICAgLy8gTmV1dHJhbC5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyArK2kpIHtcbiAgICAgICAgdmFyIHR5cGUgPSB0eXBlc1tpXTtcbiAgICAgICAgaWYgKHR5cGUgPT0gXCIsXCIpIHR5cGVzW2ldID0gXCJOXCI7XG4gICAgICAgIGVsc2UgaWYgKHR5cGUgPT0gXCIlXCIpIHtcbiAgICAgICAgICBmb3IgKHZhciBlbmQgPSBpICsgMTsgZW5kIDwgbGVuICYmIHR5cGVzW2VuZF0gPT0gXCIlXCI7ICsrZW5kKSB7fVxuICAgICAgICAgIHZhciByZXBsYWNlID0gKGkgJiYgdHlwZXNbaS0xXSA9PSBcIiFcIikgfHwgKGVuZCA8IGxlbiAmJiB0eXBlc1tlbmRdID09IFwiMVwiKSA/IFwiMVwiIDogXCJOXCI7XG4gICAgICAgICAgZm9yICh2YXIgaiA9IGk7IGogPCBlbmQ7ICsraikgdHlwZXNbal0gPSByZXBsYWNlO1xuICAgICAgICAgIGkgPSBlbmQgLSAxO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFc3LiBTZWFyY2ggYmFja3dhcmRzIGZyb20gZWFjaCBpbnN0YW5jZSBvZiBhIEV1cm9wZWFuIG51bWJlclxuICAgICAgLy8gdW50aWwgdGhlIGZpcnN0IHN0cm9uZyB0eXBlIChSLCBMLCBvciBzb3IpIGlzIGZvdW5kLiBJZiBhbiBMIGlzXG4gICAgICAvLyBmb3VuZCwgdGhlbiBjaGFuZ2UgdGhlIHR5cGUgb2YgdGhlIEV1cm9wZWFuIG51bWJlciB0byBMLlxuICAgICAgZm9yICh2YXIgaSA9IDAsIGN1ciA9IG91dGVyVHlwZTsgaSA8IGxlbjsgKytpKSB7XG4gICAgICAgIHZhciB0eXBlID0gdHlwZXNbaV07XG4gICAgICAgIGlmIChjdXIgPT0gXCJMXCIgJiYgdHlwZSA9PSBcIjFcIikgdHlwZXNbaV0gPSBcIkxcIjtcbiAgICAgICAgZWxzZSBpZiAoaXNTdHJvbmcudGVzdCh0eXBlKSkgY3VyID0gdHlwZTtcbiAgICAgIH1cblxuICAgICAgLy8gTjEuIEEgc2VxdWVuY2Ugb2YgbmV1dHJhbHMgdGFrZXMgdGhlIGRpcmVjdGlvbiBvZiB0aGVcbiAgICAgIC8vIHN1cnJvdW5kaW5nIHN0cm9uZyB0ZXh0IGlmIHRoZSB0ZXh0IG9uIGJvdGggc2lkZXMgaGFzIHRoZSBzYW1lXG4gICAgICAvLyBkaXJlY3Rpb24uIEV1cm9wZWFuIGFuZCBBcmFiaWMgbnVtYmVycyBhY3QgYXMgaWYgdGhleSB3ZXJlIFIgaW5cbiAgICAgIC8vIHRlcm1zIG9mIHRoZWlyIGluZmx1ZW5jZSBvbiBuZXV0cmFscy4gU3RhcnQtb2YtbGV2ZWwtcnVuIChzb3IpXG4gICAgICAvLyBhbmQgZW5kLW9mLWxldmVsLXJ1biAoZW9yKSBhcmUgdXNlZCBhdCBsZXZlbCBydW4gYm91bmRhcmllcy5cbiAgICAgIC8vIE4yLiBBbnkgcmVtYWluaW5nIG5ldXRyYWxzIHRha2UgdGhlIGVtYmVkZGluZyBkaXJlY3Rpb24uXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgKytpKSB7XG4gICAgICAgIGlmIChpc05ldXRyYWwudGVzdCh0eXBlc1tpXSkpIHtcbiAgICAgICAgICBmb3IgKHZhciBlbmQgPSBpICsgMTsgZW5kIDwgbGVuICYmIGlzTmV1dHJhbC50ZXN0KHR5cGVzW2VuZF0pOyArK2VuZCkge31cbiAgICAgICAgICB2YXIgYmVmb3JlID0gKGkgPyB0eXBlc1tpLTFdIDogb3V0ZXJUeXBlKSA9PSBcIkxcIjtcbiAgICAgICAgICB2YXIgYWZ0ZXIgPSAoZW5kIDwgbGVuID8gdHlwZXNbZW5kXSA6IG91dGVyVHlwZSkgPT0gXCJMXCI7XG4gICAgICAgICAgdmFyIHJlcGxhY2UgPSBiZWZvcmUgfHwgYWZ0ZXIgPyBcIkxcIiA6IFwiUlwiO1xuICAgICAgICAgIGZvciAodmFyIGogPSBpOyBqIDwgZW5kOyArK2opIHR5cGVzW2pdID0gcmVwbGFjZTtcbiAgICAgICAgICBpID0gZW5kIC0gMTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBIZXJlIHdlIGRlcGFydCBmcm9tIHRoZSBkb2N1bWVudGVkIGFsZ29yaXRobSwgaW4gb3JkZXIgdG8gYXZvaWRcbiAgICAgIC8vIGJ1aWxkaW5nIHVwIGFuIGFjdHVhbCBsZXZlbHMgYXJyYXkuIFNpbmNlIHRoZXJlIGFyZSBvbmx5IHRocmVlXG4gICAgICAvLyBsZXZlbHMgKDAsIDEsIDIpIGluIGFuIGltcGxlbWVudGF0aW9uIHRoYXQgZG9lc24ndCB0YWtlXG4gICAgICAvLyBleHBsaWNpdCBlbWJlZGRpbmcgaW50byBhY2NvdW50LCB3ZSBjYW4gYnVpbGQgdXAgdGhlIG9yZGVyIG9uXG4gICAgICAvLyB0aGUgZmx5LCB3aXRob3V0IGZvbGxvd2luZyB0aGUgbGV2ZWwtYmFzZWQgYWxnb3JpdGhtLlxuICAgICAgdmFyIG9yZGVyID0gW10sIG07XG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbjspIHtcbiAgICAgICAgaWYgKGNvdW50c0FzTGVmdC50ZXN0KHR5cGVzW2ldKSkge1xuICAgICAgICAgIHZhciBzdGFydCA9IGk7XG4gICAgICAgICAgZm9yICgrK2k7IGkgPCBsZW4gJiYgY291bnRzQXNMZWZ0LnRlc3QodHlwZXNbaV0pOyArK2kpIHt9XG4gICAgICAgICAgb3JkZXIucHVzaChuZXcgQmlkaVNwYW4oMCwgc3RhcnQsIGkpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YXIgcG9zID0gaSwgYXQgPSBvcmRlci5sZW5ndGg7XG4gICAgICAgICAgZm9yICgrK2k7IGkgPCBsZW4gJiYgdHlwZXNbaV0gIT0gXCJMXCI7ICsraSkge31cbiAgICAgICAgICBmb3IgKHZhciBqID0gcG9zOyBqIDwgaTspIHtcbiAgICAgICAgICAgIGlmIChjb3VudHNBc051bS50ZXN0KHR5cGVzW2pdKSkge1xuICAgICAgICAgICAgICBpZiAocG9zIDwgaikgb3JkZXIuc3BsaWNlKGF0LCAwLCBuZXcgQmlkaVNwYW4oMSwgcG9zLCBqKSk7XG4gICAgICAgICAgICAgIHZhciBuc3RhcnQgPSBqO1xuICAgICAgICAgICAgICBmb3IgKCsrajsgaiA8IGkgJiYgY291bnRzQXNOdW0udGVzdCh0eXBlc1tqXSk7ICsraikge31cbiAgICAgICAgICAgICAgb3JkZXIuc3BsaWNlKGF0LCAwLCBuZXcgQmlkaVNwYW4oMiwgbnN0YXJ0LCBqKSk7XG4gICAgICAgICAgICAgIHBvcyA9IGo7XG4gICAgICAgICAgICB9IGVsc2UgKytqO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAocG9zIDwgaSkgb3JkZXIuc3BsaWNlKGF0LCAwLCBuZXcgQmlkaVNwYW4oMSwgcG9zLCBpKSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChvcmRlclswXS5sZXZlbCA9PSAxICYmIChtID0gc3RyLm1hdGNoKC9eXFxzKy8pKSkge1xuICAgICAgICBvcmRlclswXS5mcm9tID0gbVswXS5sZW5ndGg7XG4gICAgICAgIG9yZGVyLnVuc2hpZnQobmV3IEJpZGlTcGFuKDAsIDAsIG1bMF0ubGVuZ3RoKSk7XG4gICAgICB9XG4gICAgICBpZiAobHN0KG9yZGVyKS5sZXZlbCA9PSAxICYmIChtID0gc3RyLm1hdGNoKC9cXHMrJC8pKSkge1xuICAgICAgICBsc3Qob3JkZXIpLnRvIC09IG1bMF0ubGVuZ3RoO1xuICAgICAgICBvcmRlci5wdXNoKG5ldyBCaWRpU3BhbigwLCBsZW4gLSBtWzBdLmxlbmd0aCwgbGVuKSk7XG4gICAgICB9XG4gICAgICBpZiAob3JkZXJbMF0ubGV2ZWwgPT0gMilcbiAgICAgICAgb3JkZXIudW5zaGlmdChuZXcgQmlkaVNwYW4oMSwgb3JkZXJbMF0udG8sIG9yZGVyWzBdLnRvKSk7XG4gICAgICBpZiAob3JkZXJbMF0ubGV2ZWwgIT0gbHN0KG9yZGVyKS5sZXZlbClcbiAgICAgICAgb3JkZXIucHVzaChuZXcgQmlkaVNwYW4ob3JkZXJbMF0ubGV2ZWwsIGxlbiwgbGVuKSk7XG5cbiAgICAgIHJldHVybiBvcmRlcjtcbiAgICB9O1xuICB9KSgpO1xuXG4gIC8vIFRIRSBFTkRcblxuICBDb2RlTWlycm9yLnZlcnNpb24gPSBcIjUuOC4wXCI7XG5cbiAgcmV0dXJuIENvZGVNaXJyb3I7XG59KTtcbiIsIi8vIENvZGVNaXJyb3IsIGNvcHlyaWdodCAoYykgYnkgTWFyaWpuIEhhdmVyYmVrZSBhbmQgb3RoZXJzXG4vLyBEaXN0cmlidXRlZCB1bmRlciBhbiBNSVQgbGljZW5zZTogaHR0cDovL2NvZGVtaXJyb3IubmV0L0xJQ0VOU0VcblxuLyoqXG4gKiBBdXRob3I6IEhhbnMgRW5nZWxcbiAqIEJyYW5jaGVkIGZyb20gQ29kZU1pcnJvcidzIFNjaGVtZSBtb2RlIChieSBLb2ggWmkgSGFuLCBiYXNlZCBvbiBpbXBsZW1lbnRhdGlvbiBieSBLb2ggWmkgQ2h1bilcbiAqL1xuXG4oZnVuY3Rpb24obW9kKSB7XG4gIGlmICh0eXBlb2YgZXhwb3J0cyA9PSBcIm9iamVjdFwiICYmIHR5cGVvZiBtb2R1bGUgPT0gXCJvYmplY3RcIikgLy8gQ29tbW9uSlNcbiAgICBtb2QocmVxdWlyZShcIi4uLy4uL2xpYi9jb2RlbWlycm9yXCIpKTtcbiAgZWxzZSBpZiAodHlwZW9mIGRlZmluZSA9PSBcImZ1bmN0aW9uXCIgJiYgZGVmaW5lLmFtZCkgLy8gQU1EXG4gICAgZGVmaW5lKFtcIi4uLy4uL2xpYi9jb2RlbWlycm9yXCJdLCBtb2QpO1xuICBlbHNlIC8vIFBsYWluIGJyb3dzZXIgZW52XG4gICAgbW9kKENvZGVNaXJyb3IpO1xufSkoZnVuY3Rpb24oQ29kZU1pcnJvcikge1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbkNvZGVNaXJyb3IuZGVmaW5lTW9kZShcImNsb2p1cmVcIiwgZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICB2YXIgQlVJTFRJTiA9IFwiYnVpbHRpblwiLCBDT01NRU5UID0gXCJjb21tZW50XCIsIFNUUklORyA9IFwic3RyaW5nXCIsIENIQVJBQ1RFUiA9IFwic3RyaW5nLTJcIixcbiAgICAgICAgQVRPTSA9IFwiYXRvbVwiLCBOVU1CRVIgPSBcIm51bWJlclwiLCBCUkFDS0VUID0gXCJicmFja2V0XCIsIEtFWVdPUkQgPSBcImtleXdvcmRcIiwgVkFSID0gXCJ2YXJpYWJsZVwiO1xuICAgIHZhciBJTkRFTlRfV09SRF9TS0lQID0gb3B0aW9ucy5pbmRlbnRVbml0IHx8IDI7XG4gICAgdmFyIE5PUk1BTF9JTkRFTlRfVU5JVCA9IG9wdGlvbnMuaW5kZW50VW5pdCB8fCAyO1xuXG4gICAgZnVuY3Rpb24gbWFrZUtleXdvcmRzKHN0cikge1xuICAgICAgICB2YXIgb2JqID0ge30sIHdvcmRzID0gc3RyLnNwbGl0KFwiIFwiKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3b3Jkcy5sZW5ndGg7ICsraSkgb2JqW3dvcmRzW2ldXSA9IHRydWU7XG4gICAgICAgIHJldHVybiBvYmo7XG4gICAgfVxuXG4gICAgdmFyIGF0b21zID0gbWFrZUtleXdvcmRzKFwidHJ1ZSBmYWxzZSBuaWxcIik7XG5cbiAgICB2YXIga2V5d29yZHMgPSBtYWtlS2V5d29yZHMoXG4gICAgICBcImRlZm4gZGVmbi0gZGVmIGRlZi0gZGVmb25jZSBkZWZtdWx0aSBkZWZtZXRob2QgZGVmbWFjcm8gZGVmc3RydWN0IGRlZnR5cGUgZGVmcHJvdG9jb2wgZGVmcmVjb3JkIGRlZnByb2plY3QgZGVmdGVzdCBzbGljZSBkZWZhbGlhcyBkZWZoaW50ZWQgZGVmbWFjcm8tIGRlZm4tbWVtbyBkZWZuayBkZWZuayBkZWZvbmNlLSBkZWZ1bmJvdW5kIGRlZnVuYm91bmQtIGRlZnZhciBkZWZ2YXItIGxldCBsZXRmbiBkbyBjYXNlIGNvbmQgY29uZHAgZm9yIGxvb3AgcmVjdXIgd2hlbiB3aGVuLW5vdCB3aGVuLWxldCB3aGVuLWZpcnN0IGlmIGlmLWxldCBpZi1ub3QgLiAuLiAtPiAtPj4gZG90byBhbmQgb3IgZG9zeW5jIGRvc2VxIGRvdGltZXMgZG9ydW4gZG9hbGwgbG9hZCBpbXBvcnQgdW5pbXBvcnQgbnMgaW4tbnMgcmVmZXIgdHJ5IGNhdGNoIGZpbmFsbHkgdGhyb3cgd2l0aC1vcGVuIHdpdGgtbG9jYWwtdmFycyBiaW5kaW5nIGdlbi1jbGFzcyBnZW4tYW5kLWxvYWQtY2xhc3MgZ2VuLWFuZC1zYXZlLWNsYXNzIGhhbmRsZXItY2FzZSBoYW5kbGVcIik7XG5cbiAgICB2YXIgYnVpbHRpbnMgPSBtYWtlS2V5d29yZHMoXG4gICAgICAgIFwiKiAqJyAqMSAqMiAqMyAqYWdlbnQqICphbGxvdy11bnJlc29sdmVkLXZhcnMqICphc3NlcnQqICpjbG9qdXJlLXZlcnNpb24qICpjb21tYW5kLWxpbmUtYXJncyogKmNvbXBpbGUtZmlsZXMqICpjb21waWxlLXBhdGgqICpjb21waWxlci1vcHRpb25zKiAqZGF0YS1yZWFkZXJzKiAqZSAqZXJyKiAqZmlsZSogKmZsdXNoLW9uLW5ld2xpbmUqICpmbi1sb2FkZXIqICppbiogKm1hdGgtY29udGV4dCogKm5zKiAqb3V0KiAqcHJpbnQtZHVwKiAqcHJpbnQtbGVuZ3RoKiAqcHJpbnQtbGV2ZWwqICpwcmludC1tZXRhKiAqcHJpbnQtcmVhZGFibHkqICpyZWFkLWV2YWwqICpzb3VyY2UtcGF0aCogKnVuY2hlY2tlZC1tYXRoKiAqdXNlLWNvbnRleHQtY2xhc3Nsb2FkZXIqICp2ZXJib3NlLWRlZnJlY29yZHMqICp3YXJuLW9uLXJlZmxlY3Rpb24qICsgKycgLSAtJyAtPiAtPj4gLT5BcnJheUNodW5rIC0+VmVjIC0+VmVjTm9kZSAtPlZlY1NlcSAtY2FjaGUtcHJvdG9jb2wtZm4gLXJlc2V0LW1ldGhvZHMgLi4gLyA8IDw9ID0gPT0gPiA+PSBFTVBUWS1OT0RFIGFjY2Vzc29yIGFjbG9uZSBhZGQtY2xhc3NwYXRoIGFkZC13YXRjaCBhZ2VudCBhZ2VudC1lcnJvciBhZ2VudC1lcnJvcnMgYWdldCBhbGVuZ3RoIGFsaWFzIGFsbC1ucyBhbHRlciBhbHRlci1tZXRhISBhbHRlci12YXItcm9vdCBhbWFwIGFuY2VzdG9ycyBhbmQgYXBwbHkgYXJlZHVjZSBhcnJheS1tYXAgYXNldCBhc2V0LWJvb2xlYW4gYXNldC1ieXRlIGFzZXQtY2hhciBhc2V0LWRvdWJsZSBhc2V0LWZsb2F0IGFzZXQtaW50IGFzZXQtbG9uZyBhc2V0LXNob3J0IGFzc2VydCBhc3NvYyBhc3NvYyEgYXNzb2MtaW4gYXNzb2NpYXRpdmU/IGF0b20gYXdhaXQgYXdhaXQtZm9yIGF3YWl0MSBiYXNlcyBiZWFuIGJpZ2RlYyBiaWdpbnQgYmlnaW50ZWdlciBiaW5kaW5nIGJpdC1hbmQgYml0LWFuZC1ub3QgYml0LWNsZWFyIGJpdC1mbGlwIGJpdC1ub3QgYml0LW9yIGJpdC1zZXQgYml0LXNoaWZ0LWxlZnQgYml0LXNoaWZ0LXJpZ2h0IGJpdC10ZXN0IGJpdC14b3IgYm9vbGVhbiBib29sZWFuLWFycmF5IGJvb2xlYW5zIGJvdW5kLWZuIGJvdW5kLWZuKiBib3VuZD8gYnV0bGFzdCBieXRlIGJ5dGUtYXJyYXkgYnl0ZXMgY2FzZSBjYXN0IGNoYXIgY2hhci1hcnJheSBjaGFyLWVzY2FwZS1zdHJpbmcgY2hhci1uYW1lLXN0cmluZyBjaGFyPyBjaGFycyBjaHVuayBjaHVuay1hcHBlbmQgY2h1bmstYnVmZmVyIGNodW5rLWNvbnMgY2h1bmstZmlyc3QgY2h1bmstbmV4dCBjaHVuay1yZXN0IGNodW5rZWQtc2VxPyBjbGFzcyBjbGFzcz8gY2xlYXItYWdlbnQtZXJyb3JzIGNsb2p1cmUtdmVyc2lvbiBjb2xsPyBjb21tZW50IGNvbW11dGUgY29tcCBjb21wYXJhdG9yIGNvbXBhcmUgY29tcGFyZS1hbmQtc2V0ISBjb21waWxlIGNvbXBsZW1lbnQgY29uY2F0IGNvbmQgY29uZHAgY29uaiBjb25qISBjb25zIGNvbnN0YW50bHkgY29uc3RydWN0LXByb3h5IGNvbnRhaW5zPyBjb3VudCBjb3VudGVkPyBjcmVhdGUtbnMgY3JlYXRlLXN0cnVjdCBjeWNsZSBkZWMgZGVjJyBkZWNpbWFsPyBkZWNsYXJlIGRlZmF1bHQtZGF0YS1yZWFkZXJzIGRlZmlubGluZSBkZWZpbnRlcmZhY2UgZGVmbWFjcm8gZGVmbWV0aG9kIGRlZm11bHRpIGRlZm4gZGVmbi0gZGVmb25jZSBkZWZwcm90b2NvbCBkZWZyZWNvcmQgZGVmc3RydWN0IGRlZnR5cGUgZGVsYXkgZGVsYXk/IGRlbGl2ZXIgZGVub21pbmF0b3IgZGVyZWYgZGVyaXZlIGRlc2NlbmRhbnRzIGRlc3RydWN0dXJlIGRpc2ogZGlzaiEgZGlzc29jIGRpc3NvYyEgZGlzdGluY3QgZGlzdGluY3Q/IGRvYWxsIGRvcnVuIGRvc2VxIGRvc3luYyBkb3RpbWVzIGRvdG8gZG91YmxlIGRvdWJsZS1hcnJheSBkb3VibGVzIGRyb3AgZHJvcC1sYXN0IGRyb3Atd2hpbGUgZW1wdHkgZW1wdHk/IGVuc3VyZSBlbnVtZXJhdGlvbi1zZXEgZXJyb3ItaGFuZGxlciBlcnJvci1tb2RlIGV2YWwgZXZlbj8gZXZlcnktcHJlZCBldmVyeT8gZXgtZGF0YSBleC1pbmZvIGV4dGVuZCBleHRlbmQtcHJvdG9jb2wgZXh0ZW5kLXR5cGUgZXh0ZW5kZXJzIGV4dGVuZHM/IGZhbHNlPyBmZmlyc3QgZmlsZS1zZXEgZmlsdGVyIGZpbHRlcnYgZmluZCBmaW5kLWtleXdvcmQgZmluZC1ucyBmaW5kLXByb3RvY29sLWltcGwgZmluZC1wcm90b2NvbC1tZXRob2QgZmluZC12YXIgZmlyc3QgZmxhdHRlbiBmbG9hdCBmbG9hdC1hcnJheSBmbG9hdD8gZmxvYXRzIGZsdXNoIGZuIGZuPyBmbmV4dCBmbmlsIGZvciBmb3JjZSBmb3JtYXQgZnJlcXVlbmNpZXMgZnV0dXJlIGZ1dHVyZS1jYWxsIGZ1dHVyZS1jYW5jZWwgZnV0dXJlLWNhbmNlbGxlZD8gZnV0dXJlLWRvbmU/IGZ1dHVyZT8gZ2VuLWNsYXNzIGdlbi1pbnRlcmZhY2UgZ2Vuc3ltIGdldCBnZXQtaW4gZ2V0LW1ldGhvZCBnZXQtcHJveHktY2xhc3MgZ2V0LXRocmVhZC1iaW5kaW5ncyBnZXQtdmFsaWRhdG9yIGdyb3VwLWJ5IGhhc2ggaGFzaC1jb21iaW5lIGhhc2gtbWFwIGhhc2gtc2V0IGlkZW50aWNhbD8gaWRlbnRpdHkgaWYtbGV0IGlmLW5vdCBpZm4/IGltcG9ydCBpbi1ucyBpbmMgaW5jJyBpbml0LXByb3h5IGluc3RhbmNlPyBpbnQgaW50LWFycmF5IGludGVnZXI/IGludGVybGVhdmUgaW50ZXJuIGludGVycG9zZSBpbnRvIGludG8tYXJyYXkgaW50cyBpbyEgaXNhPyBpdGVyYXRlIGl0ZXJhdG9yLXNlcSBqdXh0IGtlZXAga2VlcC1pbmRleGVkIGtleSBrZXlzIGtleXdvcmQga2V5d29yZD8gbGFzdCBsYXp5LWNhdCBsYXp5LXNlcSBsZXQgbGV0Zm4gbGluZS1zZXEgbGlzdCBsaXN0KiBsaXN0PyBsb2FkIGxvYWQtZmlsZSBsb2FkLXJlYWRlciBsb2FkLXN0cmluZyBsb2FkZWQtbGlicyBsb2NraW5nIGxvbmcgbG9uZy1hcnJheSBsb25ncyBsb29wIG1hY3JvZXhwYW5kIG1hY3JvZXhwYW5kLTEgbWFrZS1hcnJheSBtYWtlLWhpZXJhcmNoeSBtYXAgbWFwLWluZGV4ZWQgbWFwPyBtYXBjYXQgbWFwdiBtYXggbWF4LWtleSBtZW1mbiBtZW1vaXplIG1lcmdlIG1lcmdlLXdpdGggbWV0YSBtZXRob2Qtc2lnIG1ldGhvZHMgbWluIG1pbi1rZXkgbW9kIG11bmdlIG5hbWUgbmFtZXNwYWNlIG5hbWVzcGFjZS1tdW5nZSBuZWc/IG5ld2xpbmUgbmV4dCBuZmlyc3QgbmlsPyBubmV4dCBub3Qgbm90LWFueT8gbm90LWVtcHR5IG5vdC1ldmVyeT8gbm90PSBucyBucy1hbGlhc2VzIG5zLWltcG9ydHMgbnMtaW50ZXJucyBucy1tYXAgbnMtbmFtZSBucy1wdWJsaWNzIG5zLXJlZmVycyBucy1yZXNvbHZlIG5zLXVuYWxpYXMgbnMtdW5tYXAgbnRoIG50aG5leHQgbnRocmVzdCBudW0gbnVtYmVyPyBudW1lcmF0b3Igb2JqZWN0LWFycmF5IG9kZD8gb3IgcGFyZW50cyBwYXJ0aWFsIHBhcnRpdGlvbiBwYXJ0aXRpb24tYWxsIHBhcnRpdGlvbi1ieSBwY2FsbHMgcGVlayBwZXJzaXN0ZW50ISBwbWFwIHBvcCBwb3AhIHBvcC10aHJlYWQtYmluZGluZ3MgcG9zPyBwciBwci1zdHIgcHJlZmVyLW1ldGhvZCBwcmVmZXJzIHByaW1pdGl2ZXMtY2xhc3NuYW1lcyBwcmludCBwcmludC1jdG9yIHByaW50LWR1cCBwcmludC1tZXRob2QgcHJpbnQtc2ltcGxlIHByaW50LXN0ciBwcmludGYgcHJpbnRsbiBwcmludGxuLXN0ciBwcm4gcHJuLXN0ciBwcm9taXNlIHByb3h5IHByb3h5LWNhbGwtd2l0aC1zdXBlciBwcm94eS1tYXBwaW5ncyBwcm94eS1uYW1lIHByb3h5LXN1cGVyIHB1c2gtdGhyZWFkLWJpbmRpbmdzIHB2YWx1ZXMgcXVvdCByYW5kIHJhbmQtaW50IHJhbmQtbnRoIHJhbmdlIHJhdGlvPyByYXRpb25hbD8gcmF0aW9uYWxpemUgcmUtZmluZCByZS1ncm91cHMgcmUtbWF0Y2hlciByZS1tYXRjaGVzIHJlLXBhdHRlcm4gcmUtc2VxIHJlYWQgcmVhZC1saW5lIHJlYWQtc3RyaW5nIHJlYWxpemVkPyByZWR1Y2UgcmVkdWNlLWt2IHJlZHVjdGlvbnMgcmVmIHJlZi1oaXN0b3J5LWNvdW50IHJlZi1tYXgtaGlzdG9yeSByZWYtbWluLWhpc3RvcnkgcmVmLXNldCByZWZlciByZWZlci1jbG9qdXJlIHJlaWZ5IHJlbGVhc2UtcGVuZGluZy1zZW5kcyByZW0gcmVtb3ZlIHJlbW92ZS1hbGwtbWV0aG9kcyByZW1vdmUtbWV0aG9kIHJlbW92ZS1ucyByZW1vdmUtd2F0Y2ggcmVwZWF0IHJlcGVhdGVkbHkgcmVwbGFjZSByZXBsaWNhdGUgcmVxdWlyZSByZXNldCEgcmVzZXQtbWV0YSEgcmVzb2x2ZSByZXN0IHJlc3RhcnQtYWdlbnQgcmVzdWx0c2V0LXNlcSByZXZlcnNlIHJldmVyc2libGU/IHJzZXEgcnN1YnNlcSBzYXRpc2ZpZXM/IHNlY29uZCBzZWxlY3Qta2V5cyBzZW5kIHNlbmQtb2ZmIHNlcSBzZXE/IHNlcXVlIHNlcXVlbmNlIHNlcXVlbnRpYWw/IHNldCBzZXQtZXJyb3ItaGFuZGxlciEgc2V0LWVycm9yLW1vZGUhIHNldC12YWxpZGF0b3IhIHNldD8gc2hvcnQgc2hvcnQtYXJyYXkgc2hvcnRzIHNodWZmbGUgc2h1dGRvd24tYWdlbnRzIHNsdXJwIHNvbWUgc29tZS1mbiBzb3J0IHNvcnQtYnkgc29ydGVkLW1hcCBzb3J0ZWQtbWFwLWJ5IHNvcnRlZC1zZXQgc29ydGVkLXNldC1ieSBzb3J0ZWQ/IHNwZWNpYWwtc3ltYm9sPyBzcGl0IHNwbGl0LWF0IHNwbGl0LXdpdGggc3RyIHN0cmluZz8gc3RydWN0IHN0cnVjdC1tYXAgc3VicyBzdWJzZXEgc3VidmVjIHN1cGVycyBzd2FwISBzeW1ib2wgc3ltYm9sPyBzeW5jIHRha2UgdGFrZS1sYXN0IHRha2UtbnRoIHRha2Utd2hpbGUgdGVzdCB0aGUtbnMgdGhyZWFkLWJvdW5kPyB0aW1lIHRvLWFycmF5IHRvLWFycmF5LTJkIHRyYW1wb2xpbmUgdHJhbnNpZW50IHRyZWUtc2VxIHRydWU/IHR5cGUgdW5jaGVja2VkLWFkZCB1bmNoZWNrZWQtYWRkLWludCB1bmNoZWNrZWQtYnl0ZSB1bmNoZWNrZWQtY2hhciB1bmNoZWNrZWQtZGVjIHVuY2hlY2tlZC1kZWMtaW50IHVuY2hlY2tlZC1kaXZpZGUtaW50IHVuY2hlY2tlZC1kb3VibGUgdW5jaGVja2VkLWZsb2F0IHVuY2hlY2tlZC1pbmMgdW5jaGVja2VkLWluYy1pbnQgdW5jaGVja2VkLWludCB1bmNoZWNrZWQtbG9uZyB1bmNoZWNrZWQtbXVsdGlwbHkgdW5jaGVja2VkLW11bHRpcGx5LWludCB1bmNoZWNrZWQtbmVnYXRlIHVuY2hlY2tlZC1uZWdhdGUtaW50IHVuY2hlY2tlZC1yZW1haW5kZXItaW50IHVuY2hlY2tlZC1zaG9ydCB1bmNoZWNrZWQtc3VidHJhY3QgdW5jaGVja2VkLXN1YnRyYWN0LWludCB1bmRlcml2ZSB1bnF1b3RlIHVucXVvdGUtc3BsaWNpbmcgdXBkYXRlLWluIHVwZGF0ZS1wcm94eSB1c2UgdmFsIHZhbHMgdmFyLWdldCB2YXItc2V0IHZhcj8gdmFyeS1tZXRhIHZlYyB2ZWN0b3IgdmVjdG9yLW9mIHZlY3Rvcj8gd2hlbiB3aGVuLWZpcnN0IHdoZW4tbGV0IHdoZW4tbm90IHdoaWxlIHdpdGgtYmluZGluZ3Mgd2l0aC1iaW5kaW5ncyogd2l0aC1pbi1zdHIgd2l0aC1sb2FkaW5nLWNvbnRleHQgd2l0aC1sb2NhbC12YXJzIHdpdGgtbWV0YSB3aXRoLW9wZW4gd2l0aC1vdXQtc3RyIHdpdGgtcHJlY2lzaW9uIHdpdGgtcmVkZWZzIHdpdGgtcmVkZWZzLWZuIHhtbC1zZXEgemVybz8gemlwbWFwICpkZWZhdWx0LWRhdGEtcmVhZGVyLWZuKiBhcy0+IGNvbmQtPiBjb25kLT4+IHJlZHVjZWQgcmVkdWNlZD8gc2VuZC12aWEgc2V0LWFnZW50LXNlbmQtZXhlY3V0b3IhIHNldC1hZ2VudC1zZW5kLW9mZi1leGVjdXRvciEgc29tZS0+IHNvbWUtPj5cIik7XG5cbiAgICB2YXIgaW5kZW50S2V5cyA9IG1ha2VLZXl3b3JkcyhcbiAgICAgICAgLy8gQnVpbHQtaW5zXG4gICAgICAgIFwibnMgZm4gZGVmIGRlZm4gZGVmbWV0aG9kIGJvdW5kLWZuIGlmIGlmLW5vdCBjYXNlIGNvbmRwIHdoZW4gd2hpbGUgd2hlbi1ub3Qgd2hlbi1maXJzdCBkbyBmdXR1cmUgY29tbWVudCBkb3RvIGxvY2tpbmcgcHJveHkgd2l0aC1vcGVuIHdpdGgtcHJlY2lzaW9uIHJlaWZ5IGRlZnR5cGUgZGVmcmVjb3JkIGRlZnByb3RvY29sIGV4dGVuZCBleHRlbmQtcHJvdG9jb2wgZXh0ZW5kLXR5cGUgdHJ5IGNhdGNoIFwiICtcblxuICAgICAgICAvLyBCaW5kaW5nIGZvcm1zXG4gICAgICAgIFwibGV0IGxldGZuIGJpbmRpbmcgbG9vcCBmb3IgZG9zZXEgZG90aW1lcyB3aGVuLWxldCBpZi1sZXQgXCIgK1xuXG4gICAgICAgIC8vIERhdGEgc3RydWN0dXJlc1xuICAgICAgICBcImRlZnN0cnVjdCBzdHJ1Y3QtbWFwIGFzc29jIFwiICtcblxuICAgICAgICAvLyBjbG9qdXJlLnRlc3RcbiAgICAgICAgXCJ0ZXN0aW5nIGRlZnRlc3QgXCIgK1xuXG4gICAgICAgIC8vIGNvbnRyaWJcbiAgICAgICAgXCJoYW5kbGVyLWNhc2UgaGFuZGxlIGRvdHJhY2UgZGVmdHJhY2VcIik7XG5cbiAgICB2YXIgdGVzdHMgPSB7XG4gICAgICAgIGRpZ2l0OiAvXFxkLyxcbiAgICAgICAgZGlnaXRfb3JfY29sb246IC9bXFxkOl0vLFxuICAgICAgICBoZXg6IC9bMC05YS1mXS9pLFxuICAgICAgICBzaWduOiAvWystXS8sXG4gICAgICAgIGV4cG9uZW50OiAvZS9pLFxuICAgICAgICBrZXl3b3JkX2NoYXI6IC9bXlxcc1xcKFxcW1xcO1xcKVxcXV0vLFxuICAgICAgICBzeW1ib2w6IC9bXFx3KishXFwtXFwuXz86PD5cXC9cXHhhMS1cXHVmZmZmXS9cbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gc3RhdGVTdGFjayhpbmRlbnQsIHR5cGUsIHByZXYpIHsgLy8gcmVwcmVzZW50cyBhIHN0YXRlIHN0YWNrIG9iamVjdFxuICAgICAgICB0aGlzLmluZGVudCA9IGluZGVudDtcbiAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgdGhpcy5wcmV2ID0gcHJldjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBwdXNoU3RhY2soc3RhdGUsIGluZGVudCwgdHlwZSkge1xuICAgICAgICBzdGF0ZS5pbmRlbnRTdGFjayA9IG5ldyBzdGF0ZVN0YWNrKGluZGVudCwgdHlwZSwgc3RhdGUuaW5kZW50U3RhY2spO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIHBvcFN0YWNrKHN0YXRlKSB7XG4gICAgICAgIHN0YXRlLmluZGVudFN0YWNrID0gc3RhdGUuaW5kZW50U3RhY2sucHJldjtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpc051bWJlcihjaCwgc3RyZWFtKXtcbiAgICAgICAgLy8gaGV4XG4gICAgICAgIGlmICggY2ggPT09ICcwJyAmJiBzdHJlYW0uZWF0KC94L2kpICkge1xuICAgICAgICAgICAgc3RyZWFtLmVhdFdoaWxlKHRlc3RzLmhleCk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGxlYWRpbmcgc2lnblxuICAgICAgICBpZiAoICggY2ggPT0gJysnIHx8IGNoID09ICctJyApICYmICggdGVzdHMuZGlnaXQudGVzdChzdHJlYW0ucGVlaygpKSApICkge1xuICAgICAgICAgIHN0cmVhbS5lYXQodGVzdHMuc2lnbik7XG4gICAgICAgICAgY2ggPSBzdHJlYW0ubmV4dCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCB0ZXN0cy5kaWdpdC50ZXN0KGNoKSApIHtcbiAgICAgICAgICAgIHN0cmVhbS5lYXQoY2gpO1xuICAgICAgICAgICAgc3RyZWFtLmVhdFdoaWxlKHRlc3RzLmRpZ2l0KTtcblxuICAgICAgICAgICAgaWYgKCAnLicgPT0gc3RyZWFtLnBlZWsoKSApIHtcbiAgICAgICAgICAgICAgICBzdHJlYW0uZWF0KCcuJyk7XG4gICAgICAgICAgICAgICAgc3RyZWFtLmVhdFdoaWxlKHRlc3RzLmRpZ2l0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCBzdHJlYW0uZWF0KHRlc3RzLmV4cG9uZW50KSApIHtcbiAgICAgICAgICAgICAgICBzdHJlYW0uZWF0KHRlc3RzLnNpZ24pO1xuICAgICAgICAgICAgICAgIHN0cmVhbS5lYXRXaGlsZSh0ZXN0cy5kaWdpdCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIEVhdCBjaGFyYWN0ZXIgdGhhdCBzdGFydHMgYWZ0ZXIgYmFja3NsYXNoIFxcXG4gICAgZnVuY3Rpb24gZWF0Q2hhcmFjdGVyKHN0cmVhbSkge1xuICAgICAgICB2YXIgZmlyc3QgPSBzdHJlYW0ubmV4dCgpO1xuICAgICAgICAvLyBSZWFkIHNwZWNpYWwgbGl0ZXJhbHM6IGJhY2tzcGFjZSwgbmV3bGluZSwgc3BhY2UsIHJldHVybi5cbiAgICAgICAgLy8gSnVzdCByZWFkIGFsbCBsb3dlcmNhc2UgbGV0dGVycy5cbiAgICAgICAgaWYgKGZpcnN0ICYmIGZpcnN0Lm1hdGNoKC9bYS16XS8pICYmIHN0cmVhbS5tYXRjaCgvW2Etel0rLywgdHJ1ZSkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBSZWFkIHVuaWNvZGUgY2hhcmFjdGVyOiBcXHUxMDAwIFxcdUEwYTFcbiAgICAgICAgaWYgKGZpcnN0ID09PSBcInVcIikge1xuICAgICAgICAgICAgc3RyZWFtLm1hdGNoKC9bMC05YS16XXs0fS9pLCB0cnVlKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICAgIHN0YXJ0U3RhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaW5kZW50U3RhY2s6IG51bGwsXG4gICAgICAgICAgICAgICAgaW5kZW50YXRpb246IDAsXG4gICAgICAgICAgICAgICAgbW9kZTogZmFsc2VcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG5cbiAgICAgICAgdG9rZW46IGZ1bmN0aW9uIChzdHJlYW0sIHN0YXRlKSB7XG4gICAgICAgICAgICBpZiAoc3RhdGUuaW5kZW50U3RhY2sgPT0gbnVsbCAmJiBzdHJlYW0uc29sKCkpIHtcbiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgaW5kZW50YXRpb24sIGJ1dCBvbmx5IGlmIGluZGVudFN0YWNrIGlzIGVtcHR5XG4gICAgICAgICAgICAgICAgc3RhdGUuaW5kZW50YXRpb24gPSBzdHJlYW0uaW5kZW50YXRpb24oKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gc2tpcCBzcGFjZXNcbiAgICAgICAgICAgIGlmIChzdHJlYW0uZWF0U3BhY2UoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJldHVyblR5cGUgPSBudWxsO1xuXG4gICAgICAgICAgICBzd2l0Y2goc3RhdGUubW9kZSl7XG4gICAgICAgICAgICAgICAgY2FzZSBcInN0cmluZ1wiOiAvLyBtdWx0aS1saW5lIHN0cmluZyBwYXJzaW5nIG1vZGVcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5leHQsIGVzY2FwZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKChuZXh0ID0gc3RyZWFtLm5leHQoKSkgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5leHQgPT0gXCJcXFwiXCIgJiYgIWVzY2FwZWQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLm1vZGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVzY2FwZWQgPSAhZXNjYXBlZCAmJiBuZXh0ID09IFwiXFxcXFwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVyblR5cGUgPSBTVFJJTkc7IC8vIGNvbnRpbnVlIG9uIGluIHN0cmluZyBtb2RlXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6IC8vIGRlZmF1bHQgcGFyc2luZyBtb2RlXG4gICAgICAgICAgICAgICAgICAgIHZhciBjaCA9IHN0cmVhbS5uZXh0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoID09IFwiXFxcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZS5tb2RlID0gXCJzdHJpbmdcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblR5cGUgPSBTVFJJTkc7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2ggPT0gXCJcXFxcXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVhdENoYXJhY3RlcihzdHJlYW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVHlwZSA9IENIQVJBQ1RFUjtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjaCA9PSBcIidcIiAmJiAhKCB0ZXN0cy5kaWdpdF9vcl9jb2xvbi50ZXN0KHN0cmVhbS5wZWVrKCkpICkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblR5cGUgPSBBVE9NO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGNoID09IFwiO1wiKSB7IC8vIGNvbW1lbnRcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmVhbS5za2lwVG9FbmQoKTsgLy8gcmVzdCBvZiB0aGUgbGluZSBpcyBhIGNvbW1lbnRcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblR5cGUgPSBDT01NRU5UO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGlzTnVtYmVyKGNoLHN0cmVhbSkpe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVHlwZSA9IE5VTUJFUjtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjaCA9PSBcIihcIiB8fCBjaCA9PSBcIltcIiB8fCBjaCA9PSBcIntcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBrZXlXb3JkID0gJycsIGluZGVudFRlbXAgPSBzdHJlYW0uY29sdW1uKCksIGxldHRlcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAgICAgICAgRWl0aGVyXG4gICAgICAgICAgICAgICAgICAgICAgICAoaW5kZW50LXdvcmQgLi5cbiAgICAgICAgICAgICAgICAgICAgICAgIChub24taW5kZW50LXdvcmQgLi5cbiAgICAgICAgICAgICAgICAgICAgICAgICg7c29tZXRoaW5nIGVsc2UsIGJyYWNrZXQsIGV0Yy5cbiAgICAgICAgICAgICAgICAgICAgICAgICovXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjaCA9PSBcIihcIikgd2hpbGUgKChsZXR0ZXIgPSBzdHJlYW0uZWF0KHRlc3RzLmtleXdvcmRfY2hhcikpICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBrZXlXb3JkICs9IGxldHRlcjtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleVdvcmQubGVuZ3RoID4gMCAmJiAoaW5kZW50S2V5cy5wcm9wZXJ0eUlzRW51bWVyYWJsZShrZXlXb3JkKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgL14oPzpkZWZ8d2l0aCkvLnRlc3Qoa2V5V29yZCkpKSB7IC8vIGluZGVudC13b3JkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHVzaFN0YWNrKHN0YXRlLCBpbmRlbnRUZW1wICsgSU5ERU5UX1dPUkRfU0tJUCwgY2gpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsgLy8gbm9uLWluZGVudCB3b3JkXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2UgY29udGludWUgZWF0aW5nIHRoZSBzcGFjZXNcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHJlYW0uZWF0U3BhY2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc3RyZWFtLmVvbCgpIHx8IHN0cmVhbS5wZWVrKCkgPT0gXCI7XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbm90aGluZyBzaWduaWZpY2FudCBhZnRlclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB3ZSByZXN0YXJ0IGluZGVudGF0aW9uIHRoZSB1c2VyIGRlZmluZWQgc3BhY2VzIGFmdGVyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2hTdGFjayhzdGF0ZSwgaW5kZW50VGVtcCArIE5PUk1BTF9JTkRFTlRfVU5JVCwgY2gpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHB1c2hTdGFjayhzdGF0ZSwgaW5kZW50VGVtcCArIHN0cmVhbS5jdXJyZW50KCkubGVuZ3RoLCBjaCk7IC8vIGVsc2Ugd2UgbWF0Y2hcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJlYW0uYmFja1VwKHN0cmVhbS5jdXJyZW50KCkubGVuZ3RoIC0gMSk7IC8vIHVuZG8gYWxsIHRoZSBlYXRpbmdcblxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVHlwZSA9IEJSQUNLRVQ7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoY2ggPT0gXCIpXCIgfHwgY2ggPT0gXCJdXCIgfHwgY2ggPT0gXCJ9XCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVyblR5cGUgPSBCUkFDS0VUO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXRlLmluZGVudFN0YWNrICE9IG51bGwgJiYgc3RhdGUuaW5kZW50U3RhY2sudHlwZSA9PSAoY2ggPT0gXCIpXCIgPyBcIihcIiA6IChjaCA9PSBcIl1cIiA/IFwiW1wiIDpcIntcIikpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9wU3RhY2soc3RhdGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCBjaCA9PSBcIjpcIiApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0cmVhbS5lYXRXaGlsZSh0ZXN0cy5zeW1ib2wpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEFUT007XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJlYW0uZWF0V2hpbGUodGVzdHMuc3ltYm9sKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGtleXdvcmRzICYmIGtleXdvcmRzLnByb3BlcnR5SXNFbnVtZXJhYmxlKHN0cmVhbS5jdXJyZW50KCkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVHlwZSA9IEtFWVdPUkQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGJ1aWx0aW5zICYmIGJ1aWx0aW5zLnByb3BlcnR5SXNFbnVtZXJhYmxlKHN0cmVhbS5jdXJyZW50KCkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVHlwZSA9IEJVSUxUSU47XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGF0b21zICYmIGF0b21zLnByb3BlcnR5SXNFbnVtZXJhYmxlKHN0cmVhbS5jdXJyZW50KCkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuVHlwZSA9IEFUT007XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5UeXBlID0gVkFSO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiByZXR1cm5UeXBlO1xuICAgICAgICB9LFxuXG4gICAgICAgIGluZGVudDogZnVuY3Rpb24gKHN0YXRlKSB7XG4gICAgICAgICAgICBpZiAoc3RhdGUuaW5kZW50U3RhY2sgPT0gbnVsbCkgcmV0dXJuIHN0YXRlLmluZGVudGF0aW9uO1xuICAgICAgICAgICAgcmV0dXJuIHN0YXRlLmluZGVudFN0YWNrLmluZGVudDtcbiAgICAgICAgfSxcblxuICAgICAgICBjbG9zZUJyYWNrZXRzOiB7cGFpcnM6IFwiKClbXXt9XFxcIlxcXCJcIn0sXG4gICAgICAgIGxpbmVDb21tZW50OiBcIjs7XCJcbiAgICB9O1xufSk7XG5cbkNvZGVNaXJyb3IuZGVmaW5lTUlNRShcInRleHQveC1jbG9qdXJlXCIsIFwiY2xvanVyZVwiKTtcblxufSk7XG4iLCIvLyBDb2RlTWlycm9yLCBjb3B5cmlnaHQgKGMpIGJ5IE1hcmlqbiBIYXZlcmJla2UgYW5kIG90aGVyc1xuLy8gRGlzdHJpYnV0ZWQgdW5kZXIgYW4gTUlUIGxpY2Vuc2U6IGh0dHA6Ly9jb2RlbWlycm9yLm5ldC9MSUNFTlNFXG5cbihmdW5jdGlvbihtb2QpIHtcbiAgaWYgKHR5cGVvZiBleHBvcnRzID09IFwib2JqZWN0XCIgJiYgdHlwZW9mIG1vZHVsZSA9PSBcIm9iamVjdFwiKSAvLyBDb21tb25KU1xuICAgIG1vZChyZXF1aXJlKFwiLi4vLi4vbGliL2NvZGVtaXJyb3JcIiksIHJlcXVpcmUoXCIuLi9tYXJrZG93bi9tYXJrZG93blwiKSwgcmVxdWlyZShcIi4uLy4uL2FkZG9uL21vZGUvb3ZlcmxheVwiKSk7XG4gIGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT0gXCJmdW5jdGlvblwiICYmIGRlZmluZS5hbWQpIC8vIEFNRFxuICAgIGRlZmluZShbXCIuLi8uLi9saWIvY29kZW1pcnJvclwiLCBcIi4uL21hcmtkb3duL21hcmtkb3duXCIsIFwiLi4vLi4vYWRkb24vbW9kZS9vdmVybGF5XCJdLCBtb2QpO1xuICBlbHNlIC8vIFBsYWluIGJyb3dzZXIgZW52XG4gICAgbW9kKENvZGVNaXJyb3IpO1xufSkoZnVuY3Rpb24oQ29kZU1pcnJvcikge1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbnZhciB1cmxSRSA9IC9eKCg/Oig/OmFhYXM/fGFib3V0fGFjYXB8YWRpdW14dHJhfGFmW3BzXXxhaW18YXB0fGF0dGFjaG1lbnR8YXd8YmVzaGFyZXxiaXRjb2lufGJvbG98Y2FsbHRvfGNhcHxjaHJvbWUoPzotZXh0ZW5zaW9uKT98Y2lkfGNvYXB8Y29tLWV2ZW50YnJpdGUtYXR0ZW5kZWV8Y29udGVudHxjcmlkfGN2c3xkYXRhfGRhdnxkaWN0fGRsbmEtKD86cGxheWNvbnRhaW5lcnxwbGF5c2luZ2xlKXxkbnN8ZG9pfGR0bnxkdmJ8ZWQya3xmYWNldGltZXxmZWVkfGZpbGV8ZmluZ2VyfGZpc2h8ZnRwfGdlb3xnZ3xnaXR8Z2l6bW9wcm9qZWN0fGdvfGdvcGhlcnxndGFsa3xoMzIzfGhjcHxodHRwcz98aWF4fGljYXB8aWNvbnxpbXxpbWFwfGluZm98aXBufGlwcHxpcmNbNnNdP3xpcmlzKD86XFwuYmVlcHxcXC5sd3p8XFwueHBjfFxcLnhwY3MpP3xpdG1zfGphcnxqYXZhc2NyaXB0fGptc3xrZXlwYXJjfGxhc3RmbXxsZGFwcz98bWFnbmV0fG1haWx0b3xtYXBzfG1hcmtldHxtZXNzYWdlfG1pZHxtbXN8bXMtaGVscHxtc25pbXxtc3Jwcz98bXRxcHxtdW1ibGV8bXVwZGF0ZXxtdm58bmV3c3xuZnN8bmloP3xubnRwfG5vdGVzfG9pZHxvcGFxdWVsb2NrdG9rZW58cGFsbXxwYXBhcmF6eml8cGxhdGZvcm18cG9wfHByZXN8cHJveHl8cHN5Y3xxdWVyeXxyZXMoPzpvdXJjZSk/fHJtaXxyc3luY3xydG1wfHJ0c3B8c2Vjb25kbGlmZXxzZXJ2aWNlfHNlc3Npb258c2Z0cHxzZ258c2h0dHB8c2lldmV8c2lwcz98c2t5cGV8c21bYnNdfHNubXB8c29hcFxcLmJlZXBzP3xzb2xkYXR8c3BvdGlmeXxzc2h8c3RlYW18c3ZufHRhZ3x0ZWFtc3BlYWt8dGVsKD86bmV0KT98dGZ0cHx0aGluZ3N8dGhpc21lc3NhZ2V8dGlwfHRuMzI3MHx0dnx1ZHB8dW5yZWFsfHVybnx1dDIwMDR8dmVtbWl8dmVudHJpbG98dmlldy1zb3VyY2V8d2ViY2FsfHdzcz98d3RhaXx3eWNpd3lnfHhjb24oPzotdXNlcmlkKT98eGZpcmV8eG1scnBjXFwuYmVlcHM/fHhtcHB8eHJpfHltc2dyfHozOVxcLjUwW3JzXT8pOig/OlxcL3sxLDN9fFthLXowLTklXSl8d3d3XFxkezAsM31bLl18W2EtejAtOS5cXC1dK1suXVthLXpdezIsNH1cXC8pKD86W15cXHMoKTw+XXxcXChbXlxccygpPD5dKlxcKSkrKD86XFwoW15cXHMoKTw+XSpcXCl8W15cXHNgKiEoKVxcW1xcXXt9OzonXCIuLDw+P8KrwrvigJzigJ3igJjigJldKSkvaVxuXG5Db2RlTWlycm9yLmRlZmluZU1vZGUoXCJnZm1cIiwgZnVuY3Rpb24oY29uZmlnLCBtb2RlQ29uZmlnKSB7XG4gIHZhciBjb2RlRGVwdGggPSAwO1xuICBmdW5jdGlvbiBibGFua0xpbmUoc3RhdGUpIHtcbiAgICBzdGF0ZS5jb2RlID0gZmFsc2U7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgdmFyIGdmbU92ZXJsYXkgPSB7XG4gICAgc3RhcnRTdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjb2RlOiBmYWxzZSxcbiAgICAgICAgY29kZUJsb2NrOiBmYWxzZSxcbiAgICAgICAgYXRlU3BhY2U6IGZhbHNlXG4gICAgICB9O1xuICAgIH0sXG4gICAgY29weVN0YXRlOiBmdW5jdGlvbihzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjb2RlOiBzLmNvZGUsXG4gICAgICAgIGNvZGVCbG9jazogcy5jb2RlQmxvY2ssXG4gICAgICAgIGF0ZVNwYWNlOiBzLmF0ZVNwYWNlXG4gICAgICB9O1xuICAgIH0sXG4gICAgdG9rZW46IGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHtcbiAgICAgIHN0YXRlLmNvbWJpbmVUb2tlbnMgPSBudWxsO1xuXG4gICAgICAvLyBIYWNrIHRvIHByZXZlbnQgZm9ybWF0dGluZyBvdmVycmlkZSBpbnNpZGUgY29kZSBibG9ja3MgKGJsb2NrIGFuZCBpbmxpbmUpXG4gICAgICBpZiAoc3RhdGUuY29kZUJsb2NrKSB7XG4gICAgICAgIGlmIChzdHJlYW0ubWF0Y2goL15gYGArLykpIHtcbiAgICAgICAgICBzdGF0ZS5jb2RlQmxvY2sgPSBmYWxzZTtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBzdHJlYW0uc2tpcFRvRW5kKCk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgaWYgKHN0cmVhbS5zb2woKSkge1xuICAgICAgICBzdGF0ZS5jb2RlID0gZmFsc2U7XG4gICAgICB9XG4gICAgICBpZiAoc3RyZWFtLnNvbCgpICYmIHN0cmVhbS5tYXRjaCgvXmBgYCsvKSkge1xuICAgICAgICBzdHJlYW0uc2tpcFRvRW5kKCk7XG4gICAgICAgIHN0YXRlLmNvZGVCbG9jayA9IHRydWU7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgLy8gSWYgdGhpcyBibG9jayBpcyBjaGFuZ2VkLCBpdCBtYXkgbmVlZCB0byBiZSB1cGRhdGVkIGluIE1hcmtkb3duIG1vZGVcbiAgICAgIGlmIChzdHJlYW0ucGVlaygpID09PSAnYCcpIHtcbiAgICAgICAgc3RyZWFtLm5leHQoKTtcbiAgICAgICAgdmFyIGJlZm9yZSA9IHN0cmVhbS5wb3M7XG4gICAgICAgIHN0cmVhbS5lYXRXaGlsZSgnYCcpO1xuICAgICAgICB2YXIgZGlmZmVyZW5jZSA9IDEgKyBzdHJlYW0ucG9zIC0gYmVmb3JlO1xuICAgICAgICBpZiAoIXN0YXRlLmNvZGUpIHtcbiAgICAgICAgICBjb2RlRGVwdGggPSBkaWZmZXJlbmNlO1xuICAgICAgICAgIHN0YXRlLmNvZGUgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChkaWZmZXJlbmNlID09PSBjb2RlRGVwdGgpIHsgLy8gTXVzdCBiZSBleGFjdFxuICAgICAgICAgICAgc3RhdGUuY29kZSA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH0gZWxzZSBpZiAoc3RhdGUuY29kZSkge1xuICAgICAgICBzdHJlYW0ubmV4dCgpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIC8vIENoZWNrIGlmIHNwYWNlLiBJZiBzbywgbGlua3MgY2FuIGJlIGZvcm1hdHRlZCBsYXRlciBvblxuICAgICAgaWYgKHN0cmVhbS5lYXRTcGFjZSgpKSB7XG4gICAgICAgIHN0YXRlLmF0ZVNwYWNlID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgICBpZiAoc3RyZWFtLnNvbCgpIHx8IHN0YXRlLmF0ZVNwYWNlKSB7XG4gICAgICAgIHN0YXRlLmF0ZVNwYWNlID0gZmFsc2U7XG4gICAgICAgIGlmIChtb2RlQ29uZmlnLmdpdEh1YlNwaWNlICE9PSBmYWxzZSkge1xuICAgICAgICAgIGlmKHN0cmVhbS5tYXRjaCgvXig/OlthLXpBLVowLTlcXC1fXStcXC8pPyg/OlthLXpBLVowLTlcXC1fXStAKT8oPzpbYS1mMC05XXs3LDQwfVxcYikvKSkge1xuICAgICAgICAgICAgLy8gVXNlci9Qcm9qZWN0QFNIQVxuICAgICAgICAgICAgLy8gVXNlckBTSEFcbiAgICAgICAgICAgIC8vIFNIQVxuICAgICAgICAgICAgc3RhdGUuY29tYmluZVRva2VucyA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gXCJsaW5rXCI7XG4gICAgICAgICAgfSBlbHNlIGlmIChzdHJlYW0ubWF0Y2goL14oPzpbYS16QS1aMC05XFwtX10rXFwvKT8oPzpbYS16QS1aMC05XFwtX10rKT8jWzAtOV0rXFxiLykpIHtcbiAgICAgICAgICAgIC8vIFVzZXIvUHJvamVjdCNOdW1cbiAgICAgICAgICAgIC8vIFVzZXIjTnVtXG4gICAgICAgICAgICAvLyAjTnVtXG4gICAgICAgICAgICBzdGF0ZS5jb21iaW5lVG9rZW5zID0gdHJ1ZTtcbiAgICAgICAgICAgIHJldHVybiBcImxpbmtcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChzdHJlYW0ubWF0Y2godXJsUkUpICYmXG4gICAgICAgICAgc3RyZWFtLnN0cmluZy5zbGljZShzdHJlYW0uc3RhcnQgLSAyLCBzdHJlYW0uc3RhcnQpICE9IFwiXShcIiAmJlxuICAgICAgICAgIChzdHJlYW0uc3RhcnQgPT0gMCB8fCAvXFxXLy50ZXN0KHN0cmVhbS5zdHJpbmcuY2hhckF0KHN0cmVhbS5zdGFydCAtIDEpKSkpIHtcbiAgICAgICAgLy8gVVJMc1xuICAgICAgICAvLyBUYWtlbiBmcm9tIGh0dHA6Ly9kYXJpbmdmaXJlYmFsbC5uZXQvMjAxMC8wNy9pbXByb3ZlZF9yZWdleF9mb3JfbWF0Y2hpbmdfdXJsc1xuICAgICAgICAvLyBBbmQgdGhlbiAoaXNzdWUgIzExNjApIHNpbXBsaWZpZWQgdG8gbWFrZSBpdCBub3QgY3Jhc2ggdGhlIENocm9tZSBSZWdleHAgZW5naW5lXG4gICAgICAgIC8vIEFuZCB0aGVuIGxpbWl0ZWQgdXJsIHNjaGVtZXMgdG8gdGhlIENvbW1vbk1hcmsgbGlzdCwgc28gZm9vOmJhciBpc24ndCBtYXRjaGVkIGFzIGEgVVJMXG4gICAgICAgIHN0YXRlLmNvbWJpbmVUb2tlbnMgPSB0cnVlO1xuICAgICAgICByZXR1cm4gXCJsaW5rXCI7XG4gICAgICB9XG4gICAgICBzdHJlYW0ubmV4dCgpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSxcbiAgICBibGFua0xpbmU6IGJsYW5rTGluZVxuICB9O1xuXG4gIHZhciBtYXJrZG93bkNvbmZpZyA9IHtcbiAgICB1bmRlcnNjb3Jlc0JyZWFrV29yZHM6IGZhbHNlLFxuICAgIHRhc2tMaXN0czogdHJ1ZSxcbiAgICBmZW5jZWRDb2RlQmxvY2tzOiAnYGBgJyxcbiAgICBzdHJpa2V0aHJvdWdoOiB0cnVlXG4gIH07XG4gIGZvciAodmFyIGF0dHIgaW4gbW9kZUNvbmZpZykge1xuICAgIG1hcmtkb3duQ29uZmlnW2F0dHJdID0gbW9kZUNvbmZpZ1thdHRyXTtcbiAgfVxuICBtYXJrZG93bkNvbmZpZy5uYW1lID0gXCJtYXJrZG93blwiO1xuICByZXR1cm4gQ29kZU1pcnJvci5vdmVybGF5TW9kZShDb2RlTWlycm9yLmdldE1vZGUoY29uZmlnLCBtYXJrZG93bkNvbmZpZyksIGdmbU92ZXJsYXkpO1xuXG59LCBcIm1hcmtkb3duXCIpO1xuXG4gIENvZGVNaXJyb3IuZGVmaW5lTUlNRShcInRleHQveC1nZm1cIiwgXCJnZm1cIik7XG59KTtcbiIsIi8vIENvZGVNaXJyb3IsIGNvcHlyaWdodCAoYykgYnkgTWFyaWpuIEhhdmVyYmVrZSBhbmQgb3RoZXJzXG4vLyBEaXN0cmlidXRlZCB1bmRlciBhbiBNSVQgbGljZW5zZTogaHR0cDovL2NvZGVtaXJyb3IubmV0L0xJQ0VOU0VcblxuKGZ1bmN0aW9uKG1vZCkge1xuICBpZiAodHlwZW9mIGV4cG9ydHMgPT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgbW9kdWxlID09IFwib2JqZWN0XCIpIC8vIENvbW1vbkpTXG4gICAgbW9kKHJlcXVpcmUoXCIuLi8uLi9saWIvY29kZW1pcnJvclwiKSwgcmVxdWlyZShcIi4uL3htbC94bWxcIiksIHJlcXVpcmUoXCIuLi9tZXRhXCIpKTtcbiAgZWxzZSBpZiAodHlwZW9mIGRlZmluZSA9PSBcImZ1bmN0aW9uXCIgJiYgZGVmaW5lLmFtZCkgLy8gQU1EXG4gICAgZGVmaW5lKFtcIi4uLy4uL2xpYi9jb2RlbWlycm9yXCIsIFwiLi4veG1sL3htbFwiLCBcIi4uL21ldGFcIl0sIG1vZCk7XG4gIGVsc2UgLy8gUGxhaW4gYnJvd3NlciBlbnZcbiAgICBtb2QoQ29kZU1pcnJvcik7XG59KShmdW5jdGlvbihDb2RlTWlycm9yKSB7XG5cInVzZSBzdHJpY3RcIjtcblxuQ29kZU1pcnJvci5kZWZpbmVNb2RlKFwibWFya2Rvd25cIiwgZnVuY3Rpb24oY21DZmcsIG1vZGVDZmcpIHtcblxuICB2YXIgaHRtbEZvdW5kID0gQ29kZU1pcnJvci5tb2Rlcy5oYXNPd25Qcm9wZXJ0eShcInhtbFwiKTtcbiAgdmFyIGh0bWxNb2RlID0gQ29kZU1pcnJvci5nZXRNb2RlKGNtQ2ZnLCBodG1sRm91bmQgPyB7bmFtZTogXCJ4bWxcIiwgaHRtbE1vZGU6IHRydWV9IDogXCJ0ZXh0L3BsYWluXCIpO1xuXG4gIGZ1bmN0aW9uIGdldE1vZGUobmFtZSkge1xuICAgIGlmIChDb2RlTWlycm9yLmZpbmRNb2RlQnlOYW1lKSB7XG4gICAgICB2YXIgZm91bmQgPSBDb2RlTWlycm9yLmZpbmRNb2RlQnlOYW1lKG5hbWUpO1xuICAgICAgaWYgKGZvdW5kKSBuYW1lID0gZm91bmQubWltZSB8fCBmb3VuZC5taW1lc1swXTtcbiAgICB9XG4gICAgdmFyIG1vZGUgPSBDb2RlTWlycm9yLmdldE1vZGUoY21DZmcsIG5hbWUpO1xuICAgIHJldHVybiBtb2RlLm5hbWUgPT0gXCJudWxsXCIgPyBudWxsIDogbW9kZTtcbiAgfVxuXG4gIC8vIFNob3VsZCBjaGFyYWN0ZXJzIHRoYXQgYWZmZWN0IGhpZ2hsaWdodGluZyBiZSBoaWdobGlnaHRlZCBzZXBhcmF0ZT9cbiAgLy8gRG9lcyBub3QgaW5jbHVkZSBjaGFyYWN0ZXJzIHRoYXQgd2lsbCBiZSBvdXRwdXQgKHN1Y2ggYXMgYDEuYCBhbmQgYC1gIGZvciBsaXN0cylcbiAgaWYgKG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZyA9PT0gdW5kZWZpbmVkKVxuICAgIG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZyA9IGZhbHNlO1xuXG4gIC8vIE1heGltdW0gbnVtYmVyIG9mIG5lc3RlZCBibG9ja3F1b3Rlcy4gU2V0IHRvIDAgZm9yIGluZmluaXRlIG5lc3RpbmcuXG4gIC8vIEV4Y2VzcyBgPmAgd2lsbCBlbWl0IGBlcnJvcmAgdG9rZW4uXG4gIGlmIChtb2RlQ2ZnLm1heEJsb2NrcXVvdGVEZXB0aCA9PT0gdW5kZWZpbmVkKVxuICAgIG1vZGVDZmcubWF4QmxvY2txdW90ZURlcHRoID0gMDtcblxuICAvLyBTaG91bGQgdW5kZXJzY29yZXMgaW4gd29yZHMgb3Blbi9jbG9zZSBlbS9zdHJvbmc/XG4gIGlmIChtb2RlQ2ZnLnVuZGVyc2NvcmVzQnJlYWtXb3JkcyA9PT0gdW5kZWZpbmVkKVxuICAgIG1vZGVDZmcudW5kZXJzY29yZXNCcmVha1dvcmRzID0gdHJ1ZTtcblxuICAvLyBVc2UgYGZlbmNlZENvZGVCbG9ja3NgIHRvIGNvbmZpZ3VyZSBmZW5jZWQgY29kZSBibG9ja3MuIGZhbHNlIHRvXG4gIC8vIGRpc2FibGUsIHN0cmluZyB0byBzcGVjaWZ5IGEgcHJlY2lzZSByZWdleHAgdGhhdCB0aGUgZmVuY2Ugc2hvdWxkXG4gIC8vIG1hdGNoLCBhbmQgdHJ1ZSB0byBhbGxvdyB0aHJlZSBvciBtb3JlIGJhY2t0aWNrcyBvciB0aWxkZXMgKGFzXG4gIC8vIHBlciBDb21tb25NYXJrKS5cblxuICAvLyBUdXJuIG9uIHRhc2sgbGlzdHM/IChcIi0gWyBdIFwiIGFuZCBcIi0gW3hdIFwiKVxuICBpZiAobW9kZUNmZy50YXNrTGlzdHMgPT09IHVuZGVmaW5lZCkgbW9kZUNmZy50YXNrTGlzdHMgPSBmYWxzZTtcblxuICAvLyBUdXJuIG9uIHN0cmlrZXRocm91Z2ggc3ludGF4XG4gIGlmIChtb2RlQ2ZnLnN0cmlrZXRocm91Z2ggPT09IHVuZGVmaW5lZClcbiAgICBtb2RlQ2ZnLnN0cmlrZXRocm91Z2ggPSBmYWxzZTtcblxuICAvLyBBbGxvdyB0b2tlbiB0eXBlcyB0byBiZSBvdmVycmlkZGVuIGJ5IHVzZXItcHJvdmlkZWQgdG9rZW4gdHlwZXMuXG4gIGlmIChtb2RlQ2ZnLnRva2VuVHlwZU92ZXJyaWRlcyA9PT0gdW5kZWZpbmVkKVxuICAgIG1vZGVDZmcudG9rZW5UeXBlT3ZlcnJpZGVzID0ge307XG5cbiAgdmFyIGNvZGVEZXB0aCA9IDA7XG5cbiAgdmFyIHRva2VuVHlwZXMgPSB7XG4gICAgaGVhZGVyOiBcImhlYWRlclwiLFxuICAgIGNvZGU6IFwiY29tbWVudFwiLFxuICAgIHF1b3RlOiBcInF1b3RlXCIsXG4gICAgbGlzdDE6IFwidmFyaWFibGUtMlwiLFxuICAgIGxpc3QyOiBcInZhcmlhYmxlLTNcIixcbiAgICBsaXN0MzogXCJrZXl3b3JkXCIsXG4gICAgaHI6IFwiaHJcIixcbiAgICBpbWFnZTogXCJ0YWdcIixcbiAgICBmb3JtYXR0aW5nOiBcImZvcm1hdHRpbmdcIixcbiAgICBsaW5rSW5saW5lOiBcImxpbmtcIixcbiAgICBsaW5rRW1haWw6IFwibGlua1wiLFxuICAgIGxpbmtUZXh0OiBcImxpbmtcIixcbiAgICBsaW5rSHJlZjogXCJzdHJpbmdcIixcbiAgICBlbTogXCJlbVwiLFxuICAgIHN0cm9uZzogXCJzdHJvbmdcIixcbiAgICBzdHJpa2V0aHJvdWdoOiBcInN0cmlrZXRocm91Z2hcIlxuICB9O1xuXG4gIGZvciAodmFyIHRva2VuVHlwZSBpbiB0b2tlblR5cGVzKSB7XG4gICAgaWYgKHRva2VuVHlwZXMuaGFzT3duUHJvcGVydHkodG9rZW5UeXBlKSAmJiBtb2RlQ2ZnLnRva2VuVHlwZU92ZXJyaWRlc1t0b2tlblR5cGVdKSB7XG4gICAgICB0b2tlblR5cGVzW3Rva2VuVHlwZV0gPSBtb2RlQ2ZnLnRva2VuVHlwZU92ZXJyaWRlc1t0b2tlblR5cGVdO1xuICAgIH1cbiAgfVxuXG4gIHZhciBoclJFID0gL14oWypcXC1fXSkoPzpcXHMqXFwxKXsyLH1cXHMqJC9cbiAgLCAgIHVsUkUgPSAvXlsqXFwtK11cXHMrL1xuICAsICAgb2xSRSA9IC9eWzAtOV0rKFsuKV0pXFxzKy9cbiAgLCAgIHRhc2tMaXN0UkUgPSAvXlxcWyh4fCApXFxdKD89XFxzKS8gLy8gTXVzdCBmb2xsb3cgdWxSRSBvciBvbFJFXG4gICwgICBhdHhIZWFkZXJSRSA9IG1vZGVDZmcuYWxsb3dBdHhIZWFkZXJXaXRob3V0U3BhY2UgPyAvXigjKykvIDogL14oIyspKD86IHwkKS9cbiAgLCAgIHNldGV4dEhlYWRlclJFID0gL14gKig/OlxcPXsxLH18LXsxLH0pXFxzKiQvXG4gICwgICB0ZXh0UkUgPSAvXlteIyFcXFtcXF0qX1xcXFw8PmAgXCInKH5dKy9cbiAgLCAgIGZlbmNlZENvZGVSRSA9IG5ldyBSZWdFeHAoXCJeKFwiICsgKG1vZGVDZmcuZmVuY2VkQ29kZUJsb2NrcyA9PT0gdHJ1ZSA/IFwifn5+K3xgYGArXCIgOiBtb2RlQ2ZnLmZlbmNlZENvZGVCbG9ja3MpICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCIpWyBcXFxcdF0qKFtcXFxcdysjXSopXCIpO1xuXG4gIGZ1bmN0aW9uIHN3aXRjaElubGluZShzdHJlYW0sIHN0YXRlLCBmKSB7XG4gICAgc3RhdGUuZiA9IHN0YXRlLmlubGluZSA9IGY7XG4gICAgcmV0dXJuIGYoc3RyZWFtLCBzdGF0ZSk7XG4gIH1cblxuICBmdW5jdGlvbiBzd2l0Y2hCbG9jayhzdHJlYW0sIHN0YXRlLCBmKSB7XG4gICAgc3RhdGUuZiA9IHN0YXRlLmJsb2NrID0gZjtcbiAgICByZXR1cm4gZihzdHJlYW0sIHN0YXRlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGxpbmVJc0VtcHR5KGxpbmUpIHtcbiAgICByZXR1cm4gIWxpbmUgfHwgIS9cXFMvLnRlc3QobGluZS5zdHJpbmcpXG4gIH1cblxuICAvLyBCbG9ja3NcblxuICBmdW5jdGlvbiBibGFua0xpbmUoc3RhdGUpIHtcbiAgICAvLyBSZXNldCBsaW5rVGl0bGUgc3RhdGVcbiAgICBzdGF0ZS5saW5rVGl0bGUgPSBmYWxzZTtcbiAgICAvLyBSZXNldCBFTSBzdGF0ZVxuICAgIHN0YXRlLmVtID0gZmFsc2U7XG4gICAgLy8gUmVzZXQgU1RST05HIHN0YXRlXG4gICAgc3RhdGUuc3Ryb25nID0gZmFsc2U7XG4gICAgLy8gUmVzZXQgc3RyaWtldGhyb3VnaCBzdGF0ZVxuICAgIHN0YXRlLnN0cmlrZXRocm91Z2ggPSBmYWxzZTtcbiAgICAvLyBSZXNldCBzdGF0ZS5xdW90ZVxuICAgIHN0YXRlLnF1b3RlID0gMDtcbiAgICAvLyBSZXNldCBzdGF0ZS5pbmRlbnRlZENvZGVcbiAgICBzdGF0ZS5pbmRlbnRlZENvZGUgPSBmYWxzZTtcbiAgICBpZiAoIWh0bWxGb3VuZCAmJiBzdGF0ZS5mID09IGh0bWxCbG9jaykge1xuICAgICAgc3RhdGUuZiA9IGlubGluZU5vcm1hbDtcbiAgICAgIHN0YXRlLmJsb2NrID0gYmxvY2tOb3JtYWw7XG4gICAgfVxuICAgIC8vIFJlc2V0IHN0YXRlLnRyYWlsaW5nU3BhY2VcbiAgICBzdGF0ZS50cmFpbGluZ1NwYWNlID0gMDtcbiAgICBzdGF0ZS50cmFpbGluZ1NwYWNlTmV3TGluZSA9IGZhbHNlO1xuICAgIC8vIE1hcmsgdGhpcyBsaW5lIGFzIGJsYW5rXG4gICAgc3RhdGUucHJldkxpbmUgPSBzdGF0ZS50aGlzTGluZVxuICAgIHN0YXRlLnRoaXNMaW5lID0gbnVsbFxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgZnVuY3Rpb24gYmxvY2tOb3JtYWwoc3RyZWFtLCBzdGF0ZSkge1xuXG4gICAgdmFyIHNvbCA9IHN0cmVhbS5zb2woKTtcblxuICAgIHZhciBwcmV2TGluZUlzTGlzdCA9IHN0YXRlLmxpc3QgIT09IGZhbHNlLFxuICAgICAgICBwcmV2TGluZUlzSW5kZW50ZWRDb2RlID0gc3RhdGUuaW5kZW50ZWRDb2RlO1xuXG4gICAgc3RhdGUuaW5kZW50ZWRDb2RlID0gZmFsc2U7XG5cbiAgICBpZiAocHJldkxpbmVJc0xpc3QpIHtcbiAgICAgIGlmIChzdGF0ZS5pbmRlbnRhdGlvbkRpZmYgPj0gMCkgeyAvLyBDb250aW51ZWQgbGlzdFxuICAgICAgICBpZiAoc3RhdGUuaW5kZW50YXRpb25EaWZmIDwgNCkgeyAvLyBPbmx5IGFkanVzdCBpbmRlbnRhdGlvbiBpZiAqbm90KiBhIGNvZGUgYmxvY2tcbiAgICAgICAgICBzdGF0ZS5pbmRlbnRhdGlvbiAtPSBzdGF0ZS5pbmRlbnRhdGlvbkRpZmY7XG4gICAgICAgIH1cbiAgICAgICAgc3RhdGUubGlzdCA9IG51bGw7XG4gICAgICB9IGVsc2UgaWYgKHN0YXRlLmluZGVudGF0aW9uID4gMCkge1xuICAgICAgICBzdGF0ZS5saXN0ID0gbnVsbDtcbiAgICAgICAgc3RhdGUubGlzdERlcHRoID0gTWF0aC5mbG9vcihzdGF0ZS5pbmRlbnRhdGlvbiAvIDQpO1xuICAgICAgfSBlbHNlIHsgLy8gTm8gbG9uZ2VyIGEgbGlzdFxuICAgICAgICBzdGF0ZS5saXN0ID0gZmFsc2U7XG4gICAgICAgIHN0YXRlLmxpc3REZXB0aCA9IDA7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdmFyIG1hdGNoID0gbnVsbDtcbiAgICBpZiAoc3RhdGUuaW5kZW50YXRpb25EaWZmID49IDQpIHtcbiAgICAgIHN0cmVhbS5za2lwVG9FbmQoKTtcbiAgICAgIGlmIChwcmV2TGluZUlzSW5kZW50ZWRDb2RlIHx8IGxpbmVJc0VtcHR5KHN0YXRlLnByZXZMaW5lKSkge1xuICAgICAgICBzdGF0ZS5pbmRlbnRhdGlvbiAtPSA0O1xuICAgICAgICBzdGF0ZS5pbmRlbnRlZENvZGUgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdG9rZW5UeXBlcy5jb2RlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChzdHJlYW0uZWF0U3BhY2UoKSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBlbHNlIGlmICgobWF0Y2ggPSBzdHJlYW0ubWF0Y2goYXR4SGVhZGVyUkUpKSAmJiBtYXRjaFsxXS5sZW5ndGggPD0gNikge1xuICAgICAgc3RhdGUuaGVhZGVyID0gbWF0Y2hbMV0ubGVuZ3RoO1xuICAgICAgaWYgKG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZykgc3RhdGUuZm9ybWF0dGluZyA9IFwiaGVhZGVyXCI7XG4gICAgICBzdGF0ZS5mID0gc3RhdGUuaW5saW5lO1xuICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgIH0gZWxzZSBpZiAoIWxpbmVJc0VtcHR5KHN0YXRlLnByZXZMaW5lKSAmJiAhc3RhdGUucXVvdGUgJiYgIXByZXZMaW5lSXNMaXN0ICYmXG4gICAgICAgICAgICAgICAhcHJldkxpbmVJc0luZGVudGVkQ29kZSAmJiAobWF0Y2ggPSBzdHJlYW0ubWF0Y2goc2V0ZXh0SGVhZGVyUkUpKSkge1xuICAgICAgc3RhdGUuaGVhZGVyID0gbWF0Y2hbMF0uY2hhckF0KDApID09ICc9JyA/IDEgOiAyO1xuICAgICAgaWYgKG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZykgc3RhdGUuZm9ybWF0dGluZyA9IFwiaGVhZGVyXCI7XG4gICAgICBzdGF0ZS5mID0gc3RhdGUuaW5saW5lO1xuICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgIH0gZWxzZSBpZiAoc3RyZWFtLmVhdCgnPicpKSB7XG4gICAgICBzdGF0ZS5xdW90ZSA9IHNvbCA/IDEgOiBzdGF0ZS5xdW90ZSArIDE7XG4gICAgICBpZiAobW9kZUNmZy5oaWdobGlnaHRGb3JtYXR0aW5nKSBzdGF0ZS5mb3JtYXR0aW5nID0gXCJxdW90ZVwiO1xuICAgICAgc3RyZWFtLmVhdFNwYWNlKCk7XG4gICAgICByZXR1cm4gZ2V0VHlwZShzdGF0ZSk7XG4gICAgfSBlbHNlIGlmIChzdHJlYW0ucGVlaygpID09PSAnWycpIHtcbiAgICAgIHJldHVybiBzd2l0Y2hJbmxpbmUoc3RyZWFtLCBzdGF0ZSwgZm9vdG5vdGVMaW5rKTtcbiAgICB9IGVsc2UgaWYgKHN0cmVhbS5tYXRjaChoclJFLCB0cnVlKSkge1xuICAgICAgc3RhdGUuaHIgPSB0cnVlO1xuICAgICAgcmV0dXJuIHRva2VuVHlwZXMuaHI7XG4gICAgfSBlbHNlIGlmICgobGluZUlzRW1wdHkoc3RhdGUucHJldkxpbmUpIHx8IHByZXZMaW5lSXNMaXN0KSAmJiAoc3RyZWFtLm1hdGNoKHVsUkUsIGZhbHNlKSB8fCBzdHJlYW0ubWF0Y2gob2xSRSwgZmFsc2UpKSkge1xuICAgICAgdmFyIGxpc3RUeXBlID0gbnVsbDtcbiAgICAgIGlmIChzdHJlYW0ubWF0Y2godWxSRSwgdHJ1ZSkpIHtcbiAgICAgICAgbGlzdFR5cGUgPSAndWwnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc3RyZWFtLm1hdGNoKG9sUkUsIHRydWUpO1xuICAgICAgICBsaXN0VHlwZSA9ICdvbCc7XG4gICAgICB9XG4gICAgICBzdGF0ZS5pbmRlbnRhdGlvbiA9IHN0cmVhbS5jb2x1bW4oKSArIHN0cmVhbS5jdXJyZW50KCkubGVuZ3RoO1xuICAgICAgc3RhdGUubGlzdCA9IHRydWU7XG4gICAgICBzdGF0ZS5saXN0RGVwdGgrKztcbiAgICAgIGlmIChtb2RlQ2ZnLnRhc2tMaXN0cyAmJiBzdHJlYW0ubWF0Y2godGFza0xpc3RSRSwgZmFsc2UpKSB7XG4gICAgICAgIHN0YXRlLnRhc2tMaXN0ID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHN0YXRlLmYgPSBzdGF0ZS5pbmxpbmU7XG4gICAgICBpZiAobW9kZUNmZy5oaWdobGlnaHRGb3JtYXR0aW5nKSBzdGF0ZS5mb3JtYXR0aW5nID0gW1wibGlzdFwiLCBcImxpc3QtXCIgKyBsaXN0VHlwZV07XG4gICAgICByZXR1cm4gZ2V0VHlwZShzdGF0ZSk7XG4gICAgfSBlbHNlIGlmIChtb2RlQ2ZnLmZlbmNlZENvZGVCbG9ja3MgJiYgKG1hdGNoID0gc3RyZWFtLm1hdGNoKGZlbmNlZENvZGVSRSwgdHJ1ZSkpKSB7XG4gICAgICBzdGF0ZS5mZW5jZWRDaGFycyA9IG1hdGNoWzFdXG4gICAgICAvLyB0cnkgc3dpdGNoaW5nIG1vZGVcbiAgICAgIHN0YXRlLmxvY2FsTW9kZSA9IGdldE1vZGUobWF0Y2hbMl0pO1xuICAgICAgaWYgKHN0YXRlLmxvY2FsTW9kZSkgc3RhdGUubG9jYWxTdGF0ZSA9IHN0YXRlLmxvY2FsTW9kZS5zdGFydFN0YXRlKCk7XG4gICAgICBzdGF0ZS5mID0gc3RhdGUuYmxvY2sgPSBsb2NhbDtcbiAgICAgIGlmIChtb2RlQ2ZnLmhpZ2hsaWdodEZvcm1hdHRpbmcpIHN0YXRlLmZvcm1hdHRpbmcgPSBcImNvZGUtYmxvY2tcIjtcbiAgICAgIHN0YXRlLmNvZGUgPSB0cnVlO1xuICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgIH1cblxuICAgIHJldHVybiBzd2l0Y2hJbmxpbmUoc3RyZWFtLCBzdGF0ZSwgc3RhdGUuaW5saW5lKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGh0bWxCbG9jayhzdHJlYW0sIHN0YXRlKSB7XG4gICAgdmFyIHN0eWxlID0gaHRtbE1vZGUudG9rZW4oc3RyZWFtLCBzdGF0ZS5odG1sU3RhdGUpO1xuICAgIGlmICgoaHRtbEZvdW5kICYmIHN0YXRlLmh0bWxTdGF0ZS50YWdTdGFydCA9PT0gbnVsbCAmJlxuICAgICAgICAgKCFzdGF0ZS5odG1sU3RhdGUuY29udGV4dCAmJiBzdGF0ZS5odG1sU3RhdGUudG9rZW5pemUuaXNJblRleHQpKSB8fFxuICAgICAgICAoc3RhdGUubWRfaW5zaWRlICYmIHN0cmVhbS5jdXJyZW50KCkuaW5kZXhPZihcIj5cIikgPiAtMSkpIHtcbiAgICAgIHN0YXRlLmYgPSBpbmxpbmVOb3JtYWw7XG4gICAgICBzdGF0ZS5ibG9jayA9IGJsb2NrTm9ybWFsO1xuICAgICAgc3RhdGUuaHRtbFN0YXRlID0gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIHN0eWxlO1xuICB9XG5cbiAgZnVuY3Rpb24gbG9jYWwoc3RyZWFtLCBzdGF0ZSkge1xuICAgIGlmIChzdHJlYW0uc29sKCkgJiYgc3RhdGUuZmVuY2VkQ2hhcnMgJiYgc3RyZWFtLm1hdGNoKHN0YXRlLmZlbmNlZENoYXJzLCBmYWxzZSkpIHtcbiAgICAgIHN0YXRlLmxvY2FsTW9kZSA9IHN0YXRlLmxvY2FsU3RhdGUgPSBudWxsO1xuICAgICAgc3RhdGUuZiA9IHN0YXRlLmJsb2NrID0gbGVhdmluZ0xvY2FsO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBlbHNlIGlmIChzdGF0ZS5sb2NhbE1vZGUpIHtcbiAgICAgIHJldHVybiBzdGF0ZS5sb2NhbE1vZGUudG9rZW4oc3RyZWFtLCBzdGF0ZS5sb2NhbFN0YXRlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RyZWFtLnNraXBUb0VuZCgpO1xuICAgICAgcmV0dXJuIHRva2VuVHlwZXMuY29kZTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBsZWF2aW5nTG9jYWwoc3RyZWFtLCBzdGF0ZSkge1xuICAgIHN0cmVhbS5tYXRjaChzdGF0ZS5mZW5jZWRDaGFycyk7XG4gICAgc3RhdGUuYmxvY2sgPSBibG9ja05vcm1hbDtcbiAgICBzdGF0ZS5mID0gaW5saW5lTm9ybWFsO1xuICAgIHN0YXRlLmZlbmNlZENoYXJzID0gbnVsbDtcbiAgICBpZiAobW9kZUNmZy5oaWdobGlnaHRGb3JtYXR0aW5nKSBzdGF0ZS5mb3JtYXR0aW5nID0gXCJjb2RlLWJsb2NrXCI7XG4gICAgc3RhdGUuY29kZSA9IHRydWU7XG4gICAgdmFyIHJldHVyblR5cGUgPSBnZXRUeXBlKHN0YXRlKTtcbiAgICBzdGF0ZS5jb2RlID0gZmFsc2U7XG4gICAgcmV0dXJuIHJldHVyblR5cGU7XG4gIH1cblxuICAvLyBJbmxpbmVcbiAgZnVuY3Rpb24gZ2V0VHlwZShzdGF0ZSkge1xuICAgIHZhciBzdHlsZXMgPSBbXTtcblxuICAgIGlmIChzdGF0ZS5mb3JtYXR0aW5nKSB7XG4gICAgICBzdHlsZXMucHVzaCh0b2tlblR5cGVzLmZvcm1hdHRpbmcpO1xuXG4gICAgICBpZiAodHlwZW9mIHN0YXRlLmZvcm1hdHRpbmcgPT09IFwic3RyaW5nXCIpIHN0YXRlLmZvcm1hdHRpbmcgPSBbc3RhdGUuZm9ybWF0dGluZ107XG5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RhdGUuZm9ybWF0dGluZy5sZW5ndGg7IGkrKykge1xuICAgICAgICBzdHlsZXMucHVzaCh0b2tlblR5cGVzLmZvcm1hdHRpbmcgKyBcIi1cIiArIHN0YXRlLmZvcm1hdHRpbmdbaV0pO1xuXG4gICAgICAgIGlmIChzdGF0ZS5mb3JtYXR0aW5nW2ldID09PSBcImhlYWRlclwiKSB7XG4gICAgICAgICAgc3R5bGVzLnB1c2godG9rZW5UeXBlcy5mb3JtYXR0aW5nICsgXCItXCIgKyBzdGF0ZS5mb3JtYXR0aW5nW2ldICsgXCItXCIgKyBzdGF0ZS5oZWFkZXIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQWRkIGBmb3JtYXR0aW5nLXF1b3RlYCBhbmQgYGZvcm1hdHRpbmctcXVvdGUtI2AgZm9yIGJsb2NrcXVvdGVzXG4gICAgICAgIC8vIEFkZCBgZXJyb3JgIGluc3RlYWQgaWYgdGhlIG1heGltdW0gYmxvY2txdW90ZSBuZXN0aW5nIGRlcHRoIGlzIHBhc3NlZFxuICAgICAgICBpZiAoc3RhdGUuZm9ybWF0dGluZ1tpXSA9PT0gXCJxdW90ZVwiKSB7XG4gICAgICAgICAgaWYgKCFtb2RlQ2ZnLm1heEJsb2NrcXVvdGVEZXB0aCB8fCBtb2RlQ2ZnLm1heEJsb2NrcXVvdGVEZXB0aCA+PSBzdGF0ZS5xdW90ZSkge1xuICAgICAgICAgICAgc3R5bGVzLnB1c2godG9rZW5UeXBlcy5mb3JtYXR0aW5nICsgXCItXCIgKyBzdGF0ZS5mb3JtYXR0aW5nW2ldICsgXCItXCIgKyBzdGF0ZS5xdW90ZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN0eWxlcy5wdXNoKFwiZXJyb3JcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHN0YXRlLnRhc2tPcGVuKSB7XG4gICAgICBzdHlsZXMucHVzaChcIm1ldGFcIik7XG4gICAgICByZXR1cm4gc3R5bGVzLmxlbmd0aCA/IHN0eWxlcy5qb2luKCcgJykgOiBudWxsO1xuICAgIH1cbiAgICBpZiAoc3RhdGUudGFza0Nsb3NlZCkge1xuICAgICAgc3R5bGVzLnB1c2goXCJwcm9wZXJ0eVwiKTtcbiAgICAgIHJldHVybiBzdHlsZXMubGVuZ3RoID8gc3R5bGVzLmpvaW4oJyAnKSA6IG51bGw7XG4gICAgfVxuXG4gICAgaWYgKHN0YXRlLmxpbmtIcmVmKSB7XG4gICAgICBzdHlsZXMucHVzaCh0b2tlblR5cGVzLmxpbmtIcmVmLCBcInVybFwiKTtcbiAgICB9IGVsc2UgeyAvLyBPbmx5IGFwcGx5IGlubGluZSBzdHlsZXMgdG8gbm9uLXVybCB0ZXh0XG4gICAgICBpZiAoc3RhdGUuc3Ryb25nKSB7IHN0eWxlcy5wdXNoKHRva2VuVHlwZXMuc3Ryb25nKTsgfVxuICAgICAgaWYgKHN0YXRlLmVtKSB7IHN0eWxlcy5wdXNoKHRva2VuVHlwZXMuZW0pOyB9XG4gICAgICBpZiAoc3RhdGUuc3RyaWtldGhyb3VnaCkgeyBzdHlsZXMucHVzaCh0b2tlblR5cGVzLnN0cmlrZXRocm91Z2gpOyB9XG4gICAgICBpZiAoc3RhdGUubGlua1RleHQpIHsgc3R5bGVzLnB1c2godG9rZW5UeXBlcy5saW5rVGV4dCk7IH1cbiAgICAgIGlmIChzdGF0ZS5jb2RlKSB7IHN0eWxlcy5wdXNoKHRva2VuVHlwZXMuY29kZSk7IH1cbiAgICB9XG5cbiAgICBpZiAoc3RhdGUuaGVhZGVyKSB7IHN0eWxlcy5wdXNoKHRva2VuVHlwZXMuaGVhZGVyLCB0b2tlblR5cGVzLmhlYWRlciArIFwiLVwiICsgc3RhdGUuaGVhZGVyKTsgfVxuXG4gICAgaWYgKHN0YXRlLnF1b3RlKSB7XG4gICAgICBzdHlsZXMucHVzaCh0b2tlblR5cGVzLnF1b3RlKTtcblxuICAgICAgLy8gQWRkIGBxdW90ZS0jYCB3aGVyZSB0aGUgbWF4aW11bSBmb3IgYCNgIGlzIG1vZGVDZmcubWF4QmxvY2txdW90ZURlcHRoXG4gICAgICBpZiAoIW1vZGVDZmcubWF4QmxvY2txdW90ZURlcHRoIHx8IG1vZGVDZmcubWF4QmxvY2txdW90ZURlcHRoID49IHN0YXRlLnF1b3RlKSB7XG4gICAgICAgIHN0eWxlcy5wdXNoKHRva2VuVHlwZXMucXVvdGUgKyBcIi1cIiArIHN0YXRlLnF1b3RlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHN0eWxlcy5wdXNoKHRva2VuVHlwZXMucXVvdGUgKyBcIi1cIiArIG1vZGVDZmcubWF4QmxvY2txdW90ZURlcHRoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoc3RhdGUubGlzdCAhPT0gZmFsc2UpIHtcbiAgICAgIHZhciBsaXN0TW9kID0gKHN0YXRlLmxpc3REZXB0aCAtIDEpICUgMztcbiAgICAgIGlmICghbGlzdE1vZCkge1xuICAgICAgICBzdHlsZXMucHVzaCh0b2tlblR5cGVzLmxpc3QxKTtcbiAgICAgIH0gZWxzZSBpZiAobGlzdE1vZCA9PT0gMSkge1xuICAgICAgICBzdHlsZXMucHVzaCh0b2tlblR5cGVzLmxpc3QyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHN0eWxlcy5wdXNoKHRva2VuVHlwZXMubGlzdDMpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChzdGF0ZS50cmFpbGluZ1NwYWNlTmV3TGluZSkge1xuICAgICAgc3R5bGVzLnB1c2goXCJ0cmFpbGluZy1zcGFjZS1uZXctbGluZVwiKTtcbiAgICB9IGVsc2UgaWYgKHN0YXRlLnRyYWlsaW5nU3BhY2UpIHtcbiAgICAgIHN0eWxlcy5wdXNoKFwidHJhaWxpbmctc3BhY2UtXCIgKyAoc3RhdGUudHJhaWxpbmdTcGFjZSAlIDIgPyBcImFcIiA6IFwiYlwiKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0eWxlcy5sZW5ndGggPyBzdHlsZXMuam9pbignICcpIDogbnVsbDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGhhbmRsZVRleHQoc3RyZWFtLCBzdGF0ZSkge1xuICAgIGlmIChzdHJlYW0ubWF0Y2godGV4dFJFLCB0cnVlKSkge1xuICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgZnVuY3Rpb24gaW5saW5lTm9ybWFsKHN0cmVhbSwgc3RhdGUpIHtcbiAgICB2YXIgc3R5bGUgPSBzdGF0ZS50ZXh0KHN0cmVhbSwgc3RhdGUpO1xuICAgIGlmICh0eXBlb2Ygc3R5bGUgIT09ICd1bmRlZmluZWQnKVxuICAgICAgcmV0dXJuIHN0eWxlO1xuXG4gICAgaWYgKHN0YXRlLmxpc3QpIHsgLy8gTGlzdCBtYXJrZXIgKCosICssIC0sIDEuLCBldGMpXG4gICAgICBzdGF0ZS5saXN0ID0gbnVsbDtcbiAgICAgIHJldHVybiBnZXRUeXBlKHN0YXRlKTtcbiAgICB9XG5cbiAgICBpZiAoc3RhdGUudGFza0xpc3QpIHtcbiAgICAgIHZhciB0YXNrT3BlbiA9IHN0cmVhbS5tYXRjaCh0YXNrTGlzdFJFLCB0cnVlKVsxXSAhPT0gXCJ4XCI7XG4gICAgICBpZiAodGFza09wZW4pIHN0YXRlLnRhc2tPcGVuID0gdHJ1ZTtcbiAgICAgIGVsc2Ugc3RhdGUudGFza0Nsb3NlZCA9IHRydWU7XG4gICAgICBpZiAobW9kZUNmZy5oaWdobGlnaHRGb3JtYXR0aW5nKSBzdGF0ZS5mb3JtYXR0aW5nID0gXCJ0YXNrXCI7XG4gICAgICBzdGF0ZS50YXNrTGlzdCA9IGZhbHNlO1xuICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgIH1cblxuICAgIHN0YXRlLnRhc2tPcGVuID0gZmFsc2U7XG4gICAgc3RhdGUudGFza0Nsb3NlZCA9IGZhbHNlO1xuXG4gICAgaWYgKHN0YXRlLmhlYWRlciAmJiBzdHJlYW0ubWF0Y2goL14jKyQvLCB0cnVlKSkge1xuICAgICAgaWYgKG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZykgc3RhdGUuZm9ybWF0dGluZyA9IFwiaGVhZGVyXCI7XG4gICAgICByZXR1cm4gZ2V0VHlwZShzdGF0ZSk7XG4gICAgfVxuXG4gICAgLy8gR2V0IHNvbCgpIHZhbHVlIG5vdywgYmVmb3JlIGNoYXJhY3RlciBpcyBjb25zdW1lZFxuICAgIHZhciBzb2wgPSBzdHJlYW0uc29sKCk7XG5cbiAgICB2YXIgY2ggPSBzdHJlYW0ubmV4dCgpO1xuXG4gICAgaWYgKGNoID09PSAnXFxcXCcpIHtcbiAgICAgIHN0cmVhbS5uZXh0KCk7XG4gICAgICBpZiAobW9kZUNmZy5oaWdobGlnaHRGb3JtYXR0aW5nKSB7XG4gICAgICAgIHZhciB0eXBlID0gZ2V0VHlwZShzdGF0ZSk7XG4gICAgICAgIHZhciBmb3JtYXR0aW5nRXNjYXBlID0gdG9rZW5UeXBlcy5mb3JtYXR0aW5nICsgXCItZXNjYXBlXCI7XG4gICAgICAgIHJldHVybiB0eXBlID8gdHlwZSArIFwiIFwiICsgZm9ybWF0dGluZ0VzY2FwZSA6IGZvcm1hdHRpbmdFc2NhcGU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gTWF0Y2hlcyBsaW5rIHRpdGxlcyBwcmVzZW50IG9uIG5leHQgbGluZVxuICAgIGlmIChzdGF0ZS5saW5rVGl0bGUpIHtcbiAgICAgIHN0YXRlLmxpbmtUaXRsZSA9IGZhbHNlO1xuICAgICAgdmFyIG1hdGNoQ2ggPSBjaDtcbiAgICAgIGlmIChjaCA9PT0gJygnKSB7XG4gICAgICAgIG1hdGNoQ2ggPSAnKSc7XG4gICAgICB9XG4gICAgICBtYXRjaENoID0gKG1hdGNoQ2grJycpLnJlcGxhY2UoLyhbLj8qK14kW1xcXVxcXFwoKXt9fC1dKS9nLCBcIlxcXFwkMVwiKTtcbiAgICAgIHZhciByZWdleCA9ICdeXFxcXHMqKD86W14nICsgbWF0Y2hDaCArICdcXFxcXFxcXF0rfFxcXFxcXFxcXFxcXFxcXFx8XFxcXFxcXFwuKScgKyBtYXRjaENoO1xuICAgICAgaWYgKHN0cmVhbS5tYXRjaChuZXcgUmVnRXhwKHJlZ2V4KSwgdHJ1ZSkpIHtcbiAgICAgICAgcmV0dXJuIHRva2VuVHlwZXMubGlua0hyZWY7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gSWYgdGhpcyBibG9jayBpcyBjaGFuZ2VkLCBpdCBtYXkgbmVlZCB0byBiZSB1cGRhdGVkIGluIEdGTSBtb2RlXG4gICAgaWYgKGNoID09PSAnYCcpIHtcbiAgICAgIHZhciBwcmV2aW91c0Zvcm1hdHRpbmcgPSBzdGF0ZS5mb3JtYXR0aW5nO1xuICAgICAgaWYgKG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZykgc3RhdGUuZm9ybWF0dGluZyA9IFwiY29kZVwiO1xuICAgICAgdmFyIHQgPSBnZXRUeXBlKHN0YXRlKTtcbiAgICAgIHZhciBiZWZvcmUgPSBzdHJlYW0ucG9zO1xuICAgICAgc3RyZWFtLmVhdFdoaWxlKCdgJyk7XG4gICAgICB2YXIgZGlmZmVyZW5jZSA9IDEgKyBzdHJlYW0ucG9zIC0gYmVmb3JlO1xuICAgICAgaWYgKCFzdGF0ZS5jb2RlKSB7XG4gICAgICAgIGNvZGVEZXB0aCA9IGRpZmZlcmVuY2U7XG4gICAgICAgIHN0YXRlLmNvZGUgPSB0cnVlO1xuICAgICAgICByZXR1cm4gZ2V0VHlwZShzdGF0ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoZGlmZmVyZW5jZSA9PT0gY29kZURlcHRoKSB7IC8vIE11c3QgYmUgZXhhY3RcbiAgICAgICAgICBzdGF0ZS5jb2RlID0gZmFsc2U7XG4gICAgICAgICAgcmV0dXJuIHQ7XG4gICAgICAgIH1cbiAgICAgICAgc3RhdGUuZm9ybWF0dGluZyA9IHByZXZpb3VzRm9ybWF0dGluZztcbiAgICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoc3RhdGUuY29kZSkge1xuICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgIH1cblxuICAgIGlmIChjaCA9PT0gJyEnICYmIHN0cmVhbS5tYXRjaCgvXFxbW15cXF1dKlxcXSA/KD86XFwofFxcWykvLCBmYWxzZSkpIHtcbiAgICAgIHN0cmVhbS5tYXRjaCgvXFxbW15cXF1dKlxcXS8pO1xuICAgICAgc3RhdGUuaW5saW5lID0gc3RhdGUuZiA9IGxpbmtIcmVmO1xuICAgICAgcmV0dXJuIHRva2VuVHlwZXMuaW1hZ2U7XG4gICAgfVxuXG4gICAgaWYgKGNoID09PSAnWycgJiYgc3RyZWFtLm1hdGNoKC8uKlxcXShcXCguKlxcKXwgP1xcWy4qXFxdKS8sIGZhbHNlKSkge1xuICAgICAgc3RhdGUubGlua1RleHQgPSB0cnVlO1xuICAgICAgaWYgKG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZykgc3RhdGUuZm9ybWF0dGluZyA9IFwibGlua1wiO1xuICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgIH1cblxuICAgIGlmIChjaCA9PT0gJ10nICYmIHN0YXRlLmxpbmtUZXh0ICYmIHN0cmVhbS5tYXRjaCgvXFwoLipcXCl8ID9cXFsuKlxcXS8sIGZhbHNlKSkge1xuICAgICAgaWYgKG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZykgc3RhdGUuZm9ybWF0dGluZyA9IFwibGlua1wiO1xuICAgICAgdmFyIHR5cGUgPSBnZXRUeXBlKHN0YXRlKTtcbiAgICAgIHN0YXRlLmxpbmtUZXh0ID0gZmFsc2U7XG4gICAgICBzdGF0ZS5pbmxpbmUgPSBzdGF0ZS5mID0gbGlua0hyZWY7XG4gICAgICByZXR1cm4gdHlwZTtcbiAgICB9XG5cbiAgICBpZiAoY2ggPT09ICc8JyAmJiBzdHJlYW0ubWF0Y2goL14oaHR0cHM/fGZ0cHM/KTpcXC9cXC8oPzpbXlxcXFw+XXxcXFxcLikrPi8sIGZhbHNlKSkge1xuICAgICAgc3RhdGUuZiA9IHN0YXRlLmlubGluZSA9IGxpbmtJbmxpbmU7XG4gICAgICBpZiAobW9kZUNmZy5oaWdobGlnaHRGb3JtYXR0aW5nKSBzdGF0ZS5mb3JtYXR0aW5nID0gXCJsaW5rXCI7XG4gICAgICB2YXIgdHlwZSA9IGdldFR5cGUoc3RhdGUpO1xuICAgICAgaWYgKHR5cGUpe1xuICAgICAgICB0eXBlICs9IFwiIFwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdHlwZSA9IFwiXCI7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHlwZSArIHRva2VuVHlwZXMubGlua0lubGluZTtcbiAgICB9XG5cbiAgICBpZiAoY2ggPT09ICc8JyAmJiBzdHJlYW0ubWF0Y2goL15bXj4gXFxcXF0rQCg/OlteXFxcXD5dfFxcXFwuKSs+LywgZmFsc2UpKSB7XG4gICAgICBzdGF0ZS5mID0gc3RhdGUuaW5saW5lID0gbGlua0lubGluZTtcbiAgICAgIGlmIChtb2RlQ2ZnLmhpZ2hsaWdodEZvcm1hdHRpbmcpIHN0YXRlLmZvcm1hdHRpbmcgPSBcImxpbmtcIjtcbiAgICAgIHZhciB0eXBlID0gZ2V0VHlwZShzdGF0ZSk7XG4gICAgICBpZiAodHlwZSl7XG4gICAgICAgIHR5cGUgKz0gXCIgXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0eXBlID0gXCJcIjtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0eXBlICsgdG9rZW5UeXBlcy5saW5rRW1haWw7XG4gICAgfVxuXG4gICAgaWYgKGNoID09PSAnPCcgJiYgc3RyZWFtLm1hdGNoKC9eKCEtLXxcXHcpLywgZmFsc2UpKSB7XG4gICAgICB2YXIgZW5kID0gc3RyZWFtLnN0cmluZy5pbmRleE9mKFwiPlwiLCBzdHJlYW0ucG9zKTtcbiAgICAgIGlmIChlbmQgIT0gLTEpIHtcbiAgICAgICAgdmFyIGF0dHMgPSBzdHJlYW0uc3RyaW5nLnN1YnN0cmluZyhzdHJlYW0uc3RhcnQsIGVuZCk7XG4gICAgICAgIGlmICgvbWFya2Rvd25cXHMqPVxccyooJ3xcIil7MCwxfTEoJ3xcIil7MCwxfS8udGVzdChhdHRzKSkgc3RhdGUubWRfaW5zaWRlID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHN0cmVhbS5iYWNrVXAoMSk7XG4gICAgICBzdGF0ZS5odG1sU3RhdGUgPSBDb2RlTWlycm9yLnN0YXJ0U3RhdGUoaHRtbE1vZGUpO1xuICAgICAgcmV0dXJuIHN3aXRjaEJsb2NrKHN0cmVhbSwgc3RhdGUsIGh0bWxCbG9jayk7XG4gICAgfVxuXG4gICAgaWYgKGNoID09PSAnPCcgJiYgc3RyZWFtLm1hdGNoKC9eXFwvXFx3Kj8+LykpIHtcbiAgICAgIHN0YXRlLm1kX2luc2lkZSA9IGZhbHNlO1xuICAgICAgcmV0dXJuIFwidGFnXCI7XG4gICAgfVxuXG4gICAgdmFyIGlnbm9yZVVuZGVyc2NvcmUgPSBmYWxzZTtcbiAgICBpZiAoIW1vZGVDZmcudW5kZXJzY29yZXNCcmVha1dvcmRzKSB7XG4gICAgICBpZiAoY2ggPT09ICdfJyAmJiBzdHJlYW0ucGVlaygpICE9PSAnXycgJiYgc3RyZWFtLm1hdGNoKC8oXFx3KS8sIGZhbHNlKSkge1xuICAgICAgICB2YXIgcHJldlBvcyA9IHN0cmVhbS5wb3MgLSAyO1xuICAgICAgICBpZiAocHJldlBvcyA+PSAwKSB7XG4gICAgICAgICAgdmFyIHByZXZDaCA9IHN0cmVhbS5zdHJpbmcuY2hhckF0KHByZXZQb3MpO1xuICAgICAgICAgIGlmIChwcmV2Q2ggIT09ICdfJyAmJiBwcmV2Q2gubWF0Y2goLyhcXHcpLywgZmFsc2UpKSB7XG4gICAgICAgICAgICBpZ25vcmVVbmRlcnNjb3JlID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNoID09PSAnKicgfHwgKGNoID09PSAnXycgJiYgIWlnbm9yZVVuZGVyc2NvcmUpKSB7XG4gICAgICBpZiAoc29sICYmIHN0cmVhbS5wZWVrKCkgPT09ICcgJykge1xuICAgICAgICAvLyBEbyBub3RoaW5nLCBzdXJyb3VuZGVkIGJ5IG5ld2xpbmUgYW5kIHNwYWNlXG4gICAgICB9IGVsc2UgaWYgKHN0YXRlLnN0cm9uZyA9PT0gY2ggJiYgc3RyZWFtLmVhdChjaCkpIHsgLy8gUmVtb3ZlIFNUUk9OR1xuICAgICAgICBpZiAobW9kZUNmZy5oaWdobGlnaHRGb3JtYXR0aW5nKSBzdGF0ZS5mb3JtYXR0aW5nID0gXCJzdHJvbmdcIjtcbiAgICAgICAgdmFyIHQgPSBnZXRUeXBlKHN0YXRlKTtcbiAgICAgICAgc3RhdGUuc3Ryb25nID0gZmFsc2U7XG4gICAgICAgIHJldHVybiB0O1xuICAgICAgfSBlbHNlIGlmICghc3RhdGUuc3Ryb25nICYmIHN0cmVhbS5lYXQoY2gpKSB7IC8vIEFkZCBTVFJPTkdcbiAgICAgICAgc3RhdGUuc3Ryb25nID0gY2g7XG4gICAgICAgIGlmIChtb2RlQ2ZnLmhpZ2hsaWdodEZvcm1hdHRpbmcpIHN0YXRlLmZvcm1hdHRpbmcgPSBcInN0cm9uZ1wiO1xuICAgICAgICByZXR1cm4gZ2V0VHlwZShzdGF0ZSk7XG4gICAgICB9IGVsc2UgaWYgKHN0YXRlLmVtID09PSBjaCkgeyAvLyBSZW1vdmUgRU1cbiAgICAgICAgaWYgKG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZykgc3RhdGUuZm9ybWF0dGluZyA9IFwiZW1cIjtcbiAgICAgICAgdmFyIHQgPSBnZXRUeXBlKHN0YXRlKTtcbiAgICAgICAgc3RhdGUuZW0gPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHQ7XG4gICAgICB9IGVsc2UgaWYgKCFzdGF0ZS5lbSkgeyAvLyBBZGQgRU1cbiAgICAgICAgc3RhdGUuZW0gPSBjaDtcbiAgICAgICAgaWYgKG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZykgc3RhdGUuZm9ybWF0dGluZyA9IFwiZW1cIjtcbiAgICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoY2ggPT09ICcgJykge1xuICAgICAgaWYgKHN0cmVhbS5lYXQoJyonKSB8fCBzdHJlYW0uZWF0KCdfJykpIHsgLy8gUHJvYmFibHkgc3Vycm91bmRlZCBieSBzcGFjZXNcbiAgICAgICAgaWYgKHN0cmVhbS5wZWVrKCkgPT09ICcgJykgeyAvLyBTdXJyb3VuZGVkIGJ5IHNwYWNlcywgaWdub3JlXG4gICAgICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgICAgICB9IGVsc2UgeyAvLyBOb3Qgc3Vycm91bmRlZCBieSBzcGFjZXMsIGJhY2sgdXAgcG9pbnRlclxuICAgICAgICAgIHN0cmVhbS5iYWNrVXAoMSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAobW9kZUNmZy5zdHJpa2V0aHJvdWdoKSB7XG4gICAgICBpZiAoY2ggPT09ICd+JyAmJiBzdHJlYW0uZWF0V2hpbGUoY2gpKSB7XG4gICAgICAgIGlmIChzdGF0ZS5zdHJpa2V0aHJvdWdoKSB7Ly8gUmVtb3ZlIHN0cmlrZXRocm91Z2hcbiAgICAgICAgICBpZiAobW9kZUNmZy5oaWdobGlnaHRGb3JtYXR0aW5nKSBzdGF0ZS5mb3JtYXR0aW5nID0gXCJzdHJpa2V0aHJvdWdoXCI7XG4gICAgICAgICAgdmFyIHQgPSBnZXRUeXBlKHN0YXRlKTtcbiAgICAgICAgICBzdGF0ZS5zdHJpa2V0aHJvdWdoID0gZmFsc2U7XG4gICAgICAgICAgcmV0dXJuIHQ7XG4gICAgICAgIH0gZWxzZSBpZiAoc3RyZWFtLm1hdGNoKC9eW15cXHNdLywgZmFsc2UpKSB7Ly8gQWRkIHN0cmlrZXRocm91Z2hcbiAgICAgICAgICBzdGF0ZS5zdHJpa2V0aHJvdWdoID0gdHJ1ZTtcbiAgICAgICAgICBpZiAobW9kZUNmZy5oaWdobGlnaHRGb3JtYXR0aW5nKSBzdGF0ZS5mb3JtYXR0aW5nID0gXCJzdHJpa2V0aHJvdWdoXCI7XG4gICAgICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGNoID09PSAnICcpIHtcbiAgICAgICAgaWYgKHN0cmVhbS5tYXRjaCgvXn5+LywgdHJ1ZSkpIHsgLy8gUHJvYmFibHkgc3Vycm91bmRlZCBieSBzcGFjZVxuICAgICAgICAgIGlmIChzdHJlYW0ucGVlaygpID09PSAnICcpIHsgLy8gU3Vycm91bmRlZCBieSBzcGFjZXMsIGlnbm9yZVxuICAgICAgICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgICAgICAgIH0gZWxzZSB7IC8vIE5vdCBzdXJyb3VuZGVkIGJ5IHNwYWNlcywgYmFjayB1cCBwb2ludGVyXG4gICAgICAgICAgICBzdHJlYW0uYmFja1VwKDIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChjaCA9PT0gJyAnKSB7XG4gICAgICBpZiAoc3RyZWFtLm1hdGNoKC8gKyQvLCBmYWxzZSkpIHtcbiAgICAgICAgc3RhdGUudHJhaWxpbmdTcGFjZSsrO1xuICAgICAgfSBlbHNlIGlmIChzdGF0ZS50cmFpbGluZ1NwYWNlKSB7XG4gICAgICAgIHN0YXRlLnRyYWlsaW5nU3BhY2VOZXdMaW5lID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZ2V0VHlwZShzdGF0ZSk7XG4gIH1cblxuICBmdW5jdGlvbiBsaW5rSW5saW5lKHN0cmVhbSwgc3RhdGUpIHtcbiAgICB2YXIgY2ggPSBzdHJlYW0ubmV4dCgpO1xuXG4gICAgaWYgKGNoID09PSBcIj5cIikge1xuICAgICAgc3RhdGUuZiA9IHN0YXRlLmlubGluZSA9IGlubGluZU5vcm1hbDtcbiAgICAgIGlmIChtb2RlQ2ZnLmhpZ2hsaWdodEZvcm1hdHRpbmcpIHN0YXRlLmZvcm1hdHRpbmcgPSBcImxpbmtcIjtcbiAgICAgIHZhciB0eXBlID0gZ2V0VHlwZShzdGF0ZSk7XG4gICAgICBpZiAodHlwZSl7XG4gICAgICAgIHR5cGUgKz0gXCIgXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0eXBlID0gXCJcIjtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0eXBlICsgdG9rZW5UeXBlcy5saW5rSW5saW5lO1xuICAgIH1cblxuICAgIHN0cmVhbS5tYXRjaCgvXltePl0rLywgdHJ1ZSk7XG5cbiAgICByZXR1cm4gdG9rZW5UeXBlcy5saW5rSW5saW5lO1xuICB9XG5cbiAgZnVuY3Rpb24gbGlua0hyZWYoc3RyZWFtLCBzdGF0ZSkge1xuICAgIC8vIENoZWNrIGlmIHNwYWNlLCBhbmQgcmV0dXJuIE5VTEwgaWYgc28gKHRvIGF2b2lkIG1hcmtpbmcgdGhlIHNwYWNlKVxuICAgIGlmKHN0cmVhbS5lYXRTcGFjZSgpKXtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICB2YXIgY2ggPSBzdHJlYW0ubmV4dCgpO1xuICAgIGlmIChjaCA9PT0gJygnIHx8IGNoID09PSAnWycpIHtcbiAgICAgIHN0YXRlLmYgPSBzdGF0ZS5pbmxpbmUgPSBnZXRMaW5rSHJlZkluc2lkZShjaCA9PT0gXCIoXCIgPyBcIilcIiA6IFwiXVwiKTtcbiAgICAgIGlmIChtb2RlQ2ZnLmhpZ2hsaWdodEZvcm1hdHRpbmcpIHN0YXRlLmZvcm1hdHRpbmcgPSBcImxpbmstc3RyaW5nXCI7XG4gICAgICBzdGF0ZS5saW5rSHJlZiA9IHRydWU7XG4gICAgICByZXR1cm4gZ2V0VHlwZShzdGF0ZSk7XG4gICAgfVxuICAgIHJldHVybiAnZXJyb3InO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0TGlua0hyZWZJbnNpZGUoZW5kQ2hhcikge1xuICAgIHJldHVybiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7XG4gICAgICB2YXIgY2ggPSBzdHJlYW0ubmV4dCgpO1xuXG4gICAgICBpZiAoY2ggPT09IGVuZENoYXIpIHtcbiAgICAgICAgc3RhdGUuZiA9IHN0YXRlLmlubGluZSA9IGlubGluZU5vcm1hbDtcbiAgICAgICAgaWYgKG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZykgc3RhdGUuZm9ybWF0dGluZyA9IFwibGluay1zdHJpbmdcIjtcbiAgICAgICAgdmFyIHJldHVyblN0YXRlID0gZ2V0VHlwZShzdGF0ZSk7XG4gICAgICAgIHN0YXRlLmxpbmtIcmVmID0gZmFsc2U7XG4gICAgICAgIHJldHVybiByZXR1cm5TdGF0ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKHN0cmVhbS5tYXRjaChpbmxpbmVSRShlbmRDaGFyKSwgdHJ1ZSkpIHtcbiAgICAgICAgc3RyZWFtLmJhY2tVcCgxKTtcbiAgICAgIH1cblxuICAgICAgc3RhdGUubGlua0hyZWYgPSB0cnVlO1xuICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgIH07XG4gIH1cblxuICBmdW5jdGlvbiBmb290bm90ZUxpbmsoc3RyZWFtLCBzdGF0ZSkge1xuICAgIGlmIChzdHJlYW0ubWF0Y2goL15bXlxcXV0qXFxdOi8sIGZhbHNlKSkge1xuICAgICAgc3RhdGUuZiA9IGZvb3Rub3RlTGlua0luc2lkZTtcbiAgICAgIHN0cmVhbS5uZXh0KCk7IC8vIENvbnN1bWUgW1xuICAgICAgaWYgKG1vZGVDZmcuaGlnaGxpZ2h0Rm9ybWF0dGluZykgc3RhdGUuZm9ybWF0dGluZyA9IFwibGlua1wiO1xuICAgICAgc3RhdGUubGlua1RleHQgPSB0cnVlO1xuICAgICAgcmV0dXJuIGdldFR5cGUoc3RhdGUpO1xuICAgIH1cbiAgICByZXR1cm4gc3dpdGNoSW5saW5lKHN0cmVhbSwgc3RhdGUsIGlubGluZU5vcm1hbCk7XG4gIH1cblxuICBmdW5jdGlvbiBmb290bm90ZUxpbmtJbnNpZGUoc3RyZWFtLCBzdGF0ZSkge1xuICAgIGlmIChzdHJlYW0ubWF0Y2goL15cXF06LywgdHJ1ZSkpIHtcbiAgICAgIHN0YXRlLmYgPSBzdGF0ZS5pbmxpbmUgPSBmb290bm90ZVVybDtcbiAgICAgIGlmIChtb2RlQ2ZnLmhpZ2hsaWdodEZvcm1hdHRpbmcpIHN0YXRlLmZvcm1hdHRpbmcgPSBcImxpbmtcIjtcbiAgICAgIHZhciByZXR1cm5UeXBlID0gZ2V0VHlwZShzdGF0ZSk7XG4gICAgICBzdGF0ZS5saW5rVGV4dCA9IGZhbHNlO1xuICAgICAgcmV0dXJuIHJldHVyblR5cGU7XG4gICAgfVxuXG4gICAgc3RyZWFtLm1hdGNoKC9eW15cXF1dKy8sIHRydWUpO1xuXG4gICAgcmV0dXJuIHRva2VuVHlwZXMubGlua1RleHQ7XG4gIH1cblxuICBmdW5jdGlvbiBmb290bm90ZVVybChzdHJlYW0sIHN0YXRlKSB7XG4gICAgLy8gQ2hlY2sgaWYgc3BhY2UsIGFuZCByZXR1cm4gTlVMTCBpZiBzbyAodG8gYXZvaWQgbWFya2luZyB0aGUgc3BhY2UpXG4gICAgaWYoc3RyZWFtLmVhdFNwYWNlKCkpe1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8vIE1hdGNoIFVSTFxuICAgIHN0cmVhbS5tYXRjaCgvXlteXFxzXSsvLCB0cnVlKTtcbiAgICAvLyBDaGVjayBmb3IgbGluayB0aXRsZVxuICAgIGlmIChzdHJlYW0ucGVlaygpID09PSB1bmRlZmluZWQpIHsgLy8gRW5kIG9mIGxpbmUsIHNldCBmbGFnIHRvIGNoZWNrIG5leHQgbGluZVxuICAgICAgc3RhdGUubGlua1RpdGxlID0gdHJ1ZTtcbiAgICB9IGVsc2UgeyAvLyBNb3JlIGNvbnRlbnQgb24gbGluZSwgY2hlY2sgaWYgbGluayB0aXRsZVxuICAgICAgc3RyZWFtLm1hdGNoKC9eKD86XFxzKyg/OlwiKD86W15cIlxcXFxdfFxcXFxcXFxcfFxcXFwuKStcInwnKD86W14nXFxcXF18XFxcXFxcXFx8XFxcXC4pKyd8XFwoKD86W14pXFxcXF18XFxcXFxcXFx8XFxcXC4pK1xcKSkpPy8sIHRydWUpO1xuICAgIH1cbiAgICBzdGF0ZS5mID0gc3RhdGUuaW5saW5lID0gaW5saW5lTm9ybWFsO1xuICAgIHJldHVybiB0b2tlblR5cGVzLmxpbmtIcmVmICsgXCIgdXJsXCI7XG4gIH1cblxuICB2YXIgc2F2ZWRJbmxpbmVSRSA9IFtdO1xuICBmdW5jdGlvbiBpbmxpbmVSRShlbmRDaGFyKSB7XG4gICAgaWYgKCFzYXZlZElubGluZVJFW2VuZENoYXJdKSB7XG4gICAgICAvLyBFc2NhcGUgZW5kQ2hhciBmb3IgUmVnRXhwICh0YWtlbiBmcm9tIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9hLzQ5NDEyMi81MjY3NDEpXG4gICAgICBlbmRDaGFyID0gKGVuZENoYXIrJycpLnJlcGxhY2UoLyhbLj8qK14kW1xcXVxcXFwoKXt9fC1dKS9nLCBcIlxcXFwkMVwiKTtcbiAgICAgIC8vIE1hdGNoIGFueSBub24tZW5kQ2hhciwgZXNjYXBlZCBjaGFyYWN0ZXIsIGFzIHdlbGwgYXMgdGhlIGNsb3NpbmdcbiAgICAgIC8vIGVuZENoYXIuXG4gICAgICBzYXZlZElubGluZVJFW2VuZENoYXJdID0gbmV3IFJlZ0V4cCgnXig/OlteXFxcXFxcXFxdfFxcXFxcXFxcLikqPygnICsgZW5kQ2hhciArICcpJyk7XG4gICAgfVxuICAgIHJldHVybiBzYXZlZElubGluZVJFW2VuZENoYXJdO1xuICB9XG5cbiAgdmFyIG1vZGUgPSB7XG4gICAgc3RhcnRTdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBmOiBibG9ja05vcm1hbCxcblxuICAgICAgICBwcmV2TGluZTogbnVsbCxcbiAgICAgICAgdGhpc0xpbmU6IG51bGwsXG5cbiAgICAgICAgYmxvY2s6IGJsb2NrTm9ybWFsLFxuICAgICAgICBodG1sU3RhdGU6IG51bGwsXG4gICAgICAgIGluZGVudGF0aW9uOiAwLFxuXG4gICAgICAgIGlubGluZTogaW5saW5lTm9ybWFsLFxuICAgICAgICB0ZXh0OiBoYW5kbGVUZXh0LFxuXG4gICAgICAgIGZvcm1hdHRpbmc6IGZhbHNlLFxuICAgICAgICBsaW5rVGV4dDogZmFsc2UsXG4gICAgICAgIGxpbmtIcmVmOiBmYWxzZSxcbiAgICAgICAgbGlua1RpdGxlOiBmYWxzZSxcbiAgICAgICAgZW06IGZhbHNlLFxuICAgICAgICBzdHJvbmc6IGZhbHNlLFxuICAgICAgICBoZWFkZXI6IDAsXG4gICAgICAgIGhyOiBmYWxzZSxcbiAgICAgICAgdGFza0xpc3Q6IGZhbHNlLFxuICAgICAgICBsaXN0OiBmYWxzZSxcbiAgICAgICAgbGlzdERlcHRoOiAwLFxuICAgICAgICBxdW90ZTogMCxcbiAgICAgICAgdHJhaWxpbmdTcGFjZTogMCxcbiAgICAgICAgdHJhaWxpbmdTcGFjZU5ld0xpbmU6IGZhbHNlLFxuICAgICAgICBzdHJpa2V0aHJvdWdoOiBmYWxzZSxcbiAgICAgICAgZmVuY2VkQ2hhcnM6IG51bGxcbiAgICAgIH07XG4gICAgfSxcblxuICAgIGNvcHlTdGF0ZTogZnVuY3Rpb24ocykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZjogcy5mLFxuXG4gICAgICAgIHByZXZMaW5lOiBzLnByZXZMaW5lLFxuICAgICAgICB0aGlzTGluZTogcy50aGlzLFxuXG4gICAgICAgIGJsb2NrOiBzLmJsb2NrLFxuICAgICAgICBodG1sU3RhdGU6IHMuaHRtbFN0YXRlICYmIENvZGVNaXJyb3IuY29weVN0YXRlKGh0bWxNb2RlLCBzLmh0bWxTdGF0ZSksXG4gICAgICAgIGluZGVudGF0aW9uOiBzLmluZGVudGF0aW9uLFxuXG4gICAgICAgIGxvY2FsTW9kZTogcy5sb2NhbE1vZGUsXG4gICAgICAgIGxvY2FsU3RhdGU6IHMubG9jYWxNb2RlID8gQ29kZU1pcnJvci5jb3B5U3RhdGUocy5sb2NhbE1vZGUsIHMubG9jYWxTdGF0ZSkgOiBudWxsLFxuXG4gICAgICAgIGlubGluZTogcy5pbmxpbmUsXG4gICAgICAgIHRleHQ6IHMudGV4dCxcbiAgICAgICAgZm9ybWF0dGluZzogZmFsc2UsXG4gICAgICAgIGxpbmtUaXRsZTogcy5saW5rVGl0bGUsXG4gICAgICAgIGNvZGU6IHMuY29kZSxcbiAgICAgICAgZW06IHMuZW0sXG4gICAgICAgIHN0cm9uZzogcy5zdHJvbmcsXG4gICAgICAgIHN0cmlrZXRocm91Z2g6IHMuc3RyaWtldGhyb3VnaCxcbiAgICAgICAgaGVhZGVyOiBzLmhlYWRlcixcbiAgICAgICAgaHI6IHMuaHIsXG4gICAgICAgIHRhc2tMaXN0OiBzLnRhc2tMaXN0LFxuICAgICAgICBsaXN0OiBzLmxpc3QsXG4gICAgICAgIGxpc3REZXB0aDogcy5saXN0RGVwdGgsXG4gICAgICAgIHF1b3RlOiBzLnF1b3RlLFxuICAgICAgICBpbmRlbnRlZENvZGU6IHMuaW5kZW50ZWRDb2RlLFxuICAgICAgICB0cmFpbGluZ1NwYWNlOiBzLnRyYWlsaW5nU3BhY2UsXG4gICAgICAgIHRyYWlsaW5nU3BhY2VOZXdMaW5lOiBzLnRyYWlsaW5nU3BhY2VOZXdMaW5lLFxuICAgICAgICBtZF9pbnNpZGU6IHMubWRfaW5zaWRlLFxuICAgICAgICBmZW5jZWRDaGFyczogcy5mZW5jZWRDaGFyc1xuICAgICAgfTtcbiAgICB9LFxuXG4gICAgdG9rZW46IGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHtcblxuICAgICAgLy8gUmVzZXQgc3RhdGUuZm9ybWF0dGluZ1xuICAgICAgc3RhdGUuZm9ybWF0dGluZyA9IGZhbHNlO1xuXG4gICAgICBpZiAoc3RyZWFtICE9IHN0YXRlLnRoaXNMaW5lKSB7XG4gICAgICAgIHZhciBmb3JjZUJsYW5rTGluZSA9IHN0YXRlLmhlYWRlciB8fCBzdGF0ZS5ocjtcblxuICAgICAgICAvLyBSZXNldCBzdGF0ZS5oZWFkZXIgYW5kIHN0YXRlLmhyXG4gICAgICAgIHN0YXRlLmhlYWRlciA9IDA7XG4gICAgICAgIHN0YXRlLmhyID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKHN0cmVhbS5tYXRjaCgvXlxccyokLywgdHJ1ZSkgfHwgZm9yY2VCbGFua0xpbmUpIHtcbiAgICAgICAgICBibGFua0xpbmUoc3RhdGUpO1xuICAgICAgICAgIGlmICghZm9yY2VCbGFua0xpbmUpIHJldHVybiBudWxsXG4gICAgICAgICAgc3RhdGUucHJldkxpbmUgPSBudWxsXG4gICAgICAgIH1cblxuICAgICAgICBzdGF0ZS5wcmV2TGluZSA9IHN0YXRlLnRoaXNMaW5lXG4gICAgICAgIHN0YXRlLnRoaXNMaW5lID0gc3RyZWFtXG5cbiAgICAgICAgLy8gUmVzZXQgc3RhdGUudGFza0xpc3RcbiAgICAgICAgc3RhdGUudGFza0xpc3QgPSBmYWxzZTtcblxuICAgICAgICAvLyBSZXNldCBzdGF0ZS50cmFpbGluZ1NwYWNlXG4gICAgICAgIHN0YXRlLnRyYWlsaW5nU3BhY2UgPSAwO1xuICAgICAgICBzdGF0ZS50cmFpbGluZ1NwYWNlTmV3TGluZSA9IGZhbHNlO1xuXG4gICAgICAgIHN0YXRlLmYgPSBzdGF0ZS5ibG9jaztcbiAgICAgICAgdmFyIGluZGVudGF0aW9uID0gc3RyZWFtLm1hdGNoKC9eXFxzKi8sIHRydWUpWzBdLnJlcGxhY2UoL1xcdC9nLCAnICAgICcpLmxlbmd0aDtcbiAgICAgICAgdmFyIGRpZmZlcmVuY2UgPSBNYXRoLmZsb29yKChpbmRlbnRhdGlvbiAtIHN0YXRlLmluZGVudGF0aW9uKSAvIDQpICogNDtcbiAgICAgICAgaWYgKGRpZmZlcmVuY2UgPiA0KSBkaWZmZXJlbmNlID0gNDtcbiAgICAgICAgdmFyIGFkanVzdGVkSW5kZW50YXRpb24gPSBzdGF0ZS5pbmRlbnRhdGlvbiArIGRpZmZlcmVuY2U7XG4gICAgICAgIHN0YXRlLmluZGVudGF0aW9uRGlmZiA9IGFkanVzdGVkSW5kZW50YXRpb24gLSBzdGF0ZS5pbmRlbnRhdGlvbjtcbiAgICAgICAgc3RhdGUuaW5kZW50YXRpb24gPSBhZGp1c3RlZEluZGVudGF0aW9uO1xuICAgICAgICBpZiAoaW5kZW50YXRpb24gPiAwKSByZXR1cm4gbnVsbDtcbiAgICAgIH1cbiAgICAgIHJldHVybiBzdGF0ZS5mKHN0cmVhbSwgc3RhdGUpO1xuICAgIH0sXG5cbiAgICBpbm5lck1vZGU6IGZ1bmN0aW9uKHN0YXRlKSB7XG4gICAgICBpZiAoc3RhdGUuYmxvY2sgPT0gaHRtbEJsb2NrKSByZXR1cm4ge3N0YXRlOiBzdGF0ZS5odG1sU3RhdGUsIG1vZGU6IGh0bWxNb2RlfTtcbiAgICAgIGlmIChzdGF0ZS5sb2NhbFN0YXRlKSByZXR1cm4ge3N0YXRlOiBzdGF0ZS5sb2NhbFN0YXRlLCBtb2RlOiBzdGF0ZS5sb2NhbE1vZGV9O1xuICAgICAgcmV0dXJuIHtzdGF0ZTogc3RhdGUsIG1vZGU6IG1vZGV9O1xuICAgIH0sXG5cbiAgICBibGFua0xpbmU6IGJsYW5rTGluZSxcblxuICAgIGdldFR5cGU6IGdldFR5cGUsXG5cbiAgICBmb2xkOiBcIm1hcmtkb3duXCJcbiAgfTtcbiAgcmV0dXJuIG1vZGU7XG59LCBcInhtbFwiKTtcblxuQ29kZU1pcnJvci5kZWZpbmVNSU1FKFwidGV4dC94LW1hcmtkb3duXCIsIFwibWFya2Rvd25cIik7XG5cbn0pO1xuIiwiLy8gQ29kZU1pcnJvciwgY29weXJpZ2h0IChjKSBieSBNYXJpam4gSGF2ZXJiZWtlIGFuZCBvdGhlcnNcbi8vIERpc3RyaWJ1dGVkIHVuZGVyIGFuIE1JVCBsaWNlbnNlOiBodHRwOi8vY29kZW1pcnJvci5uZXQvTElDRU5TRVxuXG4oZnVuY3Rpb24obW9kKSB7XG4gIGlmICh0eXBlb2YgZXhwb3J0cyA9PSBcIm9iamVjdFwiICYmIHR5cGVvZiBtb2R1bGUgPT0gXCJvYmplY3RcIikgLy8gQ29tbW9uSlNcbiAgICBtb2QocmVxdWlyZShcIi4uL2xpYi9jb2RlbWlycm9yXCIpKTtcbiAgZWxzZSBpZiAodHlwZW9mIGRlZmluZSA9PSBcImZ1bmN0aW9uXCIgJiYgZGVmaW5lLmFtZCkgLy8gQU1EXG4gICAgZGVmaW5lKFtcIi4uL2xpYi9jb2RlbWlycm9yXCJdLCBtb2QpO1xuICBlbHNlIC8vIFBsYWluIGJyb3dzZXIgZW52XG4gICAgbW9kKENvZGVNaXJyb3IpO1xufSkoZnVuY3Rpb24oQ29kZU1pcnJvcikge1xuICBcInVzZSBzdHJpY3RcIjtcblxuICBDb2RlTWlycm9yLm1vZGVJbmZvID0gW1xuICAgIHtuYW1lOiBcIkFQTFwiLCBtaW1lOiBcInRleHQvYXBsXCIsIG1vZGU6IFwiYXBsXCIsIGV4dDogW1wiZHlhbG9nXCIsIFwiYXBsXCJdfSxcbiAgICB7bmFtZTogXCJQR1BcIiwgbWltZXM6IFtcImFwcGxpY2F0aW9uL3BncFwiLCBcImFwcGxpY2F0aW9uL3BncC1rZXlzXCIsIFwiYXBwbGljYXRpb24vcGdwLXNpZ25hdHVyZVwiXSwgbW9kZTogXCJhc2NpaWFybW9yXCIsIGV4dDogW1wicGdwXCJdfSxcbiAgICB7bmFtZTogXCJBU04uMVwiLCBtaW1lOiBcInRleHQveC10dGNuLWFzblwiLCBtb2RlOiBcImFzbi4xXCIsIGV4dDogW1wiYXNuXCIsIFwiYXNuMVwiXX0sXG4gICAge25hbWU6IFwiQXN0ZXJpc2tcIiwgbWltZTogXCJ0ZXh0L3gtYXN0ZXJpc2tcIiwgbW9kZTogXCJhc3Rlcmlza1wiLCBmaWxlOiAvXmV4dGVuc2lvbnNcXC5jb25mJC9pfSxcbiAgICB7bmFtZTogXCJCcmFpbmZ1Y2tcIiwgbWltZTogXCJ0ZXh0L3gtYnJhaW5mdWNrXCIsIG1vZGU6IFwiYnJhaW5mdWNrXCIsIGV4dDogW1wiYlwiLCBcImJmXCJdfSxcbiAgICB7bmFtZTogXCJDXCIsIG1pbWU6IFwidGV4dC94LWNzcmNcIiwgbW9kZTogXCJjbGlrZVwiLCBleHQ6IFtcImNcIiwgXCJoXCJdfSxcbiAgICB7bmFtZTogXCJDKytcIiwgbWltZTogXCJ0ZXh0L3gtYysrc3JjXCIsIG1vZGU6IFwiY2xpa2VcIiwgZXh0OiBbXCJjcHBcIiwgXCJjKytcIiwgXCJjY1wiLCBcImN4eFwiLCBcImhwcFwiLCBcImgrK1wiLCBcImhoXCIsIFwiaHh4XCJdLCBhbGlhczogW1wiY3BwXCJdfSxcbiAgICB7bmFtZTogXCJDb2JvbFwiLCBtaW1lOiBcInRleHQveC1jb2JvbFwiLCBtb2RlOiBcImNvYm9sXCIsIGV4dDogW1wiY29iXCIsIFwiY3B5XCJdfSxcbiAgICB7bmFtZTogXCJDI1wiLCBtaW1lOiBcInRleHQveC1jc2hhcnBcIiwgbW9kZTogXCJjbGlrZVwiLCBleHQ6IFtcImNzXCJdLCBhbGlhczogW1wiY3NoYXJwXCJdfSxcbiAgICB7bmFtZTogXCJDbG9qdXJlXCIsIG1pbWU6IFwidGV4dC94LWNsb2p1cmVcIiwgbW9kZTogXCJjbG9qdXJlXCIsIGV4dDogW1wiY2xqXCJdfSxcbiAgICB7bmFtZTogXCJDbG9zdXJlIFN0eWxlc2hlZXRzIChHU1MpXCIsIG1pbWU6IFwidGV4dC94LWdzc1wiLCBtb2RlOiBcImNzc1wiLCBleHQ6IFtcImdzc1wiXX0sXG4gICAge25hbWU6IFwiQ01ha2VcIiwgbWltZTogXCJ0ZXh0L3gtY21ha2VcIiwgbW9kZTogXCJjbWFrZVwiLCBleHQ6IFtcImNtYWtlXCIsIFwiY21ha2UuaW5cIl0sIGZpbGU6IC9eQ01ha2VMaXN0cy50eHQkL30sXG4gICAge25hbWU6IFwiQ29mZmVlU2NyaXB0XCIsIG1pbWU6IFwidGV4dC94LWNvZmZlZXNjcmlwdFwiLCBtb2RlOiBcImNvZmZlZXNjcmlwdFwiLCBleHQ6IFtcImNvZmZlZVwiXSwgYWxpYXM6IFtcImNvZmZlZVwiLCBcImNvZmZlZS1zY3JpcHRcIl19LFxuICAgIHtuYW1lOiBcIkNvbW1vbiBMaXNwXCIsIG1pbWU6IFwidGV4dC94LWNvbW1vbi1saXNwXCIsIG1vZGU6IFwiY29tbW9ubGlzcFwiLCBleHQ6IFtcImNsXCIsIFwibGlzcFwiLCBcImVsXCJdLCBhbGlhczogW1wibGlzcFwiXX0sXG4gICAge25hbWU6IFwiQ3lwaGVyXCIsIG1pbWU6IFwiYXBwbGljYXRpb24veC1jeXBoZXItcXVlcnlcIiwgbW9kZTogXCJjeXBoZXJcIiwgZXh0OiBbXCJjeXBcIiwgXCJjeXBoZXJcIl19LFxuICAgIHtuYW1lOiBcIkN5dGhvblwiLCBtaW1lOiBcInRleHQveC1jeXRob25cIiwgbW9kZTogXCJweXRob25cIiwgZXh0OiBbXCJweXhcIiwgXCJweGRcIiwgXCJweGlcIl19LFxuICAgIHtuYW1lOiBcIkNTU1wiLCBtaW1lOiBcInRleHQvY3NzXCIsIG1vZGU6IFwiY3NzXCIsIGV4dDogW1wiY3NzXCJdfSxcbiAgICB7bmFtZTogXCJDUUxcIiwgbWltZTogXCJ0ZXh0L3gtY2Fzc2FuZHJhXCIsIG1vZGU6IFwic3FsXCIsIGV4dDogW1wiY3FsXCJdfSxcbiAgICB7bmFtZTogXCJEXCIsIG1pbWU6IFwidGV4dC94LWRcIiwgbW9kZTogXCJkXCIsIGV4dDogW1wiZFwiXX0sXG4gICAge25hbWU6IFwiRGFydFwiLCBtaW1lczogW1wiYXBwbGljYXRpb24vZGFydFwiLCBcInRleHQveC1kYXJ0XCJdLCBtb2RlOiBcImRhcnRcIiwgZXh0OiBbXCJkYXJ0XCJdfSxcbiAgICB7bmFtZTogXCJkaWZmXCIsIG1pbWU6IFwidGV4dC94LWRpZmZcIiwgbW9kZTogXCJkaWZmXCIsIGV4dDogW1wiZGlmZlwiLCBcInBhdGNoXCJdfSxcbiAgICB7bmFtZTogXCJEamFuZ29cIiwgbWltZTogXCJ0ZXh0L3gtZGphbmdvXCIsIG1vZGU6IFwiZGphbmdvXCJ9LFxuICAgIHtuYW1lOiBcIkRvY2tlcmZpbGVcIiwgbWltZTogXCJ0ZXh0L3gtZG9ja2VyZmlsZVwiLCBtb2RlOiBcImRvY2tlcmZpbGVcIiwgZmlsZTogL15Eb2NrZXJmaWxlJC99LFxuICAgIHtuYW1lOiBcIkRURFwiLCBtaW1lOiBcImFwcGxpY2F0aW9uL3htbC1kdGRcIiwgbW9kZTogXCJkdGRcIiwgZXh0OiBbXCJkdGRcIl19LFxuICAgIHtuYW1lOiBcIkR5bGFuXCIsIG1pbWU6IFwidGV4dC94LWR5bGFuXCIsIG1vZGU6IFwiZHlsYW5cIiwgZXh0OiBbXCJkeWxhblwiLCBcImR5bFwiLCBcImludHJcIl19LFxuICAgIHtuYW1lOiBcIkVCTkZcIiwgbWltZTogXCJ0ZXh0L3gtZWJuZlwiLCBtb2RlOiBcImVibmZcIn0sXG4gICAge25hbWU6IFwiRUNMXCIsIG1pbWU6IFwidGV4dC94LWVjbFwiLCBtb2RlOiBcImVjbFwiLCBleHQ6IFtcImVjbFwiXX0sXG4gICAge25hbWU6IFwiRWlmZmVsXCIsIG1pbWU6IFwidGV4dC94LWVpZmZlbFwiLCBtb2RlOiBcImVpZmZlbFwiLCBleHQ6IFtcImVcIl19LFxuICAgIHtuYW1lOiBcIkVsbVwiLCBtaW1lOiBcInRleHQveC1lbG1cIiwgbW9kZTogXCJlbG1cIiwgZXh0OiBbXCJlbG1cIl19LFxuICAgIHtuYW1lOiBcIkVtYmVkZGVkIEphdmFzY3JpcHRcIiwgbWltZTogXCJhcHBsaWNhdGlvbi94LWVqc1wiLCBtb2RlOiBcImh0bWxlbWJlZGRlZFwiLCBleHQ6IFtcImVqc1wiXX0sXG4gICAge25hbWU6IFwiRW1iZWRkZWQgUnVieVwiLCBtaW1lOiBcImFwcGxpY2F0aW9uL3gtZXJiXCIsIG1vZGU6IFwiaHRtbGVtYmVkZGVkXCIsIGV4dDogW1wiZXJiXCJdfSxcbiAgICB7bmFtZTogXCJFcmxhbmdcIiwgbWltZTogXCJ0ZXh0L3gtZXJsYW5nXCIsIG1vZGU6IFwiZXJsYW5nXCIsIGV4dDogW1wiZXJsXCJdfSxcbiAgICB7bmFtZTogXCJGYWN0b3JcIiwgbWltZTogXCJ0ZXh0L3gtZmFjdG9yXCIsIG1vZGU6IFwiZmFjdG9yXCIsIGV4dDogW1wiZmFjdG9yXCJdfSxcbiAgICB7bmFtZTogXCJGb3J0aFwiLCBtaW1lOiBcInRleHQveC1mb3J0aFwiLCBtb2RlOiBcImZvcnRoXCIsIGV4dDogW1wiZm9ydGhcIiwgXCJmdGhcIiwgXCI0dGhcIl19LFxuICAgIHtuYW1lOiBcIkZvcnRyYW5cIiwgbWltZTogXCJ0ZXh0L3gtZm9ydHJhblwiLCBtb2RlOiBcImZvcnRyYW5cIiwgZXh0OiBbXCJmXCIsIFwiZm9yXCIsIFwiZjc3XCIsIFwiZjkwXCJdfSxcbiAgICB7bmFtZTogXCJGI1wiLCBtaW1lOiBcInRleHQveC1mc2hhcnBcIiwgbW9kZTogXCJtbGxpa2VcIiwgZXh0OiBbXCJmc1wiXSwgYWxpYXM6IFtcImZzaGFycFwiXX0sXG4gICAge25hbWU6IFwiR2FzXCIsIG1pbWU6IFwidGV4dC94LWdhc1wiLCBtb2RlOiBcImdhc1wiLCBleHQ6IFtcInNcIl19LFxuICAgIHtuYW1lOiBcIkdoZXJraW5cIiwgbWltZTogXCJ0ZXh0L3gtZmVhdHVyZVwiLCBtb2RlOiBcImdoZXJraW5cIiwgZXh0OiBbXCJmZWF0dXJlXCJdfSxcbiAgICB7bmFtZTogXCJHaXRIdWIgRmxhdm9yZWQgTWFya2Rvd25cIiwgbWltZTogXCJ0ZXh0L3gtZ2ZtXCIsIG1vZGU6IFwiZ2ZtXCIsIGZpbGU6IC9eKHJlYWRtZXxjb250cmlidXRpbmd8aGlzdG9yeSkubWQkL2l9LFxuICAgIHtuYW1lOiBcIkdvXCIsIG1pbWU6IFwidGV4dC94LWdvXCIsIG1vZGU6IFwiZ29cIiwgZXh0OiBbXCJnb1wiXX0sXG4gICAge25hbWU6IFwiR3Jvb3Z5XCIsIG1pbWU6IFwidGV4dC94LWdyb292eVwiLCBtb2RlOiBcImdyb292eVwiLCBleHQ6IFtcImdyb292eVwiXX0sXG4gICAge25hbWU6IFwiSEFNTFwiLCBtaW1lOiBcInRleHQveC1oYW1sXCIsIG1vZGU6IFwiaGFtbFwiLCBleHQ6IFtcImhhbWxcIl19LFxuICAgIHtuYW1lOiBcIkhhc2tlbGxcIiwgbWltZTogXCJ0ZXh0L3gtaGFza2VsbFwiLCBtb2RlOiBcImhhc2tlbGxcIiwgZXh0OiBbXCJoc1wiXX0sXG4gICAge25hbWU6IFwiSGF4ZVwiLCBtaW1lOiBcInRleHQveC1oYXhlXCIsIG1vZGU6IFwiaGF4ZVwiLCBleHQ6IFtcImh4XCJdfSxcbiAgICB7bmFtZTogXCJIWE1MXCIsIG1pbWU6IFwidGV4dC94LWh4bWxcIiwgbW9kZTogXCJoYXhlXCIsIGV4dDogW1wiaHhtbFwiXX0sXG4gICAge25hbWU6IFwiQVNQLk5FVFwiLCBtaW1lOiBcImFwcGxpY2F0aW9uL3gtYXNweFwiLCBtb2RlOiBcImh0bWxlbWJlZGRlZFwiLCBleHQ6IFtcImFzcHhcIl0sIGFsaWFzOiBbXCJhc3BcIiwgXCJhc3B4XCJdfSxcbiAgICB7bmFtZTogXCJIVE1MXCIsIG1pbWU6IFwidGV4dC9odG1sXCIsIG1vZGU6IFwiaHRtbG1peGVkXCIsIGV4dDogW1wiaHRtbFwiLCBcImh0bVwiXSwgYWxpYXM6IFtcInhodG1sXCJdfSxcbiAgICB7bmFtZTogXCJIVFRQXCIsIG1pbWU6IFwibWVzc2FnZS9odHRwXCIsIG1vZGU6IFwiaHR0cFwifSxcbiAgICB7bmFtZTogXCJJRExcIiwgbWltZTogXCJ0ZXh0L3gtaWRsXCIsIG1vZGU6IFwiaWRsXCIsIGV4dDogW1wicHJvXCJdfSxcbiAgICB7bmFtZTogXCJKYWRlXCIsIG1pbWU6IFwidGV4dC94LWphZGVcIiwgbW9kZTogXCJqYWRlXCIsIGV4dDogW1wiamFkZVwiXX0sXG4gICAge25hbWU6IFwiSmF2YVwiLCBtaW1lOiBcInRleHQveC1qYXZhXCIsIG1vZGU6IFwiY2xpa2VcIiwgZXh0OiBbXCJqYXZhXCJdfSxcbiAgICB7bmFtZTogXCJKYXZhIFNlcnZlciBQYWdlc1wiLCBtaW1lOiBcImFwcGxpY2F0aW9uL3gtanNwXCIsIG1vZGU6IFwiaHRtbGVtYmVkZGVkXCIsIGV4dDogW1wianNwXCJdLCBhbGlhczogW1wianNwXCJdfSxcbiAgICB7bmFtZTogXCJKYXZhU2NyaXB0XCIsIG1pbWVzOiBbXCJ0ZXh0L2phdmFzY3JpcHRcIiwgXCJ0ZXh0L2VjbWFzY3JpcHRcIiwgXCJhcHBsaWNhdGlvbi9qYXZhc2NyaXB0XCIsIFwiYXBwbGljYXRpb24veC1qYXZhc2NyaXB0XCIsIFwiYXBwbGljYXRpb24vZWNtYXNjcmlwdFwiXSxcbiAgICAgbW9kZTogXCJqYXZhc2NyaXB0XCIsIGV4dDogW1wianNcIl0sIGFsaWFzOiBbXCJlY21hc2NyaXB0XCIsIFwianNcIiwgXCJub2RlXCJdfSxcbiAgICB7bmFtZTogXCJKU09OXCIsIG1pbWVzOiBbXCJhcHBsaWNhdGlvbi9qc29uXCIsIFwiYXBwbGljYXRpb24veC1qc29uXCJdLCBtb2RlOiBcImphdmFzY3JpcHRcIiwgZXh0OiBbXCJqc29uXCIsIFwibWFwXCJdLCBhbGlhczogW1wianNvbjVcIl19LFxuICAgIHtuYW1lOiBcIkpTT04tTERcIiwgbWltZTogXCJhcHBsaWNhdGlvbi9sZCtqc29uXCIsIG1vZGU6IFwiamF2YXNjcmlwdFwiLCBleHQ6IFtcImpzb25sZFwiXSwgYWxpYXM6IFtcImpzb25sZFwiXX0sXG4gICAge25hbWU6IFwiSmluamEyXCIsIG1pbWU6IFwibnVsbFwiLCBtb2RlOiBcImppbmphMlwifSxcbiAgICB7bmFtZTogXCJKdWxpYVwiLCBtaW1lOiBcInRleHQveC1qdWxpYVwiLCBtb2RlOiBcImp1bGlhXCIsIGV4dDogW1wiamxcIl19LFxuICAgIHtuYW1lOiBcIktvdGxpblwiLCBtaW1lOiBcInRleHQveC1rb3RsaW5cIiwgbW9kZTogXCJjbGlrZVwiLCBleHQ6IFtcImt0XCJdfSxcbiAgICB7bmFtZTogXCJMRVNTXCIsIG1pbWU6IFwidGV4dC94LWxlc3NcIiwgbW9kZTogXCJjc3NcIiwgZXh0OiBbXCJsZXNzXCJdfSxcbiAgICB7bmFtZTogXCJMaXZlU2NyaXB0XCIsIG1pbWU6IFwidGV4dC94LWxpdmVzY3JpcHRcIiwgbW9kZTogXCJsaXZlc2NyaXB0XCIsIGV4dDogW1wibHNcIl0sIGFsaWFzOiBbXCJsc1wiXX0sXG4gICAge25hbWU6IFwiTHVhXCIsIG1pbWU6IFwidGV4dC94LWx1YVwiLCBtb2RlOiBcImx1YVwiLCBleHQ6IFtcImx1YVwiXX0sXG4gICAge25hbWU6IFwiTWFya2Rvd25cIiwgbWltZTogXCJ0ZXh0L3gtbWFya2Rvd25cIiwgbW9kZTogXCJtYXJrZG93blwiLCBleHQ6IFtcIm1hcmtkb3duXCIsIFwibWRcIiwgXCJta2RcIl19LFxuICAgIHtuYW1lOiBcIm1JUkNcIiwgbWltZTogXCJ0ZXh0L21pcmNcIiwgbW9kZTogXCJtaXJjXCJ9LFxuICAgIHtuYW1lOiBcIk1hcmlhREIgU1FMXCIsIG1pbWU6IFwidGV4dC94LW1hcmlhZGJcIiwgbW9kZTogXCJzcWxcIn0sXG4gICAge25hbWU6IFwiTWF0aGVtYXRpY2FcIiwgbWltZTogXCJ0ZXh0L3gtbWF0aGVtYXRpY2FcIiwgbW9kZTogXCJtYXRoZW1hdGljYVwiLCBleHQ6IFtcIm1cIiwgXCJuYlwiXX0sXG4gICAge25hbWU6IFwiTW9kZWxpY2FcIiwgbWltZTogXCJ0ZXh0L3gtbW9kZWxpY2FcIiwgbW9kZTogXCJtb2RlbGljYVwiLCBleHQ6IFtcIm1vXCJdfSxcbiAgICB7bmFtZTogXCJNVU1QU1wiLCBtaW1lOiBcInRleHQveC1tdW1wc1wiLCBtb2RlOiBcIm11bXBzXCJ9LFxuICAgIHtuYW1lOiBcIk1TIFNRTFwiLCBtaW1lOiBcInRleHQveC1tc3NxbFwiLCBtb2RlOiBcInNxbFwifSxcbiAgICB7bmFtZTogXCJNeVNRTFwiLCBtaW1lOiBcInRleHQveC1teXNxbFwiLCBtb2RlOiBcInNxbFwifSxcbiAgICB7bmFtZTogXCJOZ2lueFwiLCBtaW1lOiBcInRleHQveC1uZ2lueC1jb25mXCIsIG1vZGU6IFwibmdpbnhcIiwgZmlsZTogL25naW54LipcXC5jb25mJC9pfSxcbiAgICB7bmFtZTogXCJOU0lTXCIsIG1pbWU6IFwidGV4dC94LW5zaXNcIiwgbW9kZTogXCJuc2lzXCIsIGV4dDogW1wibnNoXCIsIFwibnNpXCJdfSxcbiAgICB7bmFtZTogXCJOVHJpcGxlc1wiLCBtaW1lOiBcInRleHQvbi10cmlwbGVzXCIsIG1vZGU6IFwibnRyaXBsZXNcIiwgZXh0OiBbXCJudFwiXX0sXG4gICAge25hbWU6IFwiT2JqZWN0aXZlIENcIiwgbWltZTogXCJ0ZXh0L3gtb2JqZWN0aXZlY1wiLCBtb2RlOiBcImNsaWtlXCIsIGV4dDogW1wibVwiLCBcIm1tXCJdfSxcbiAgICB7bmFtZTogXCJPQ2FtbFwiLCBtaW1lOiBcInRleHQveC1vY2FtbFwiLCBtb2RlOiBcIm1sbGlrZVwiLCBleHQ6IFtcIm1sXCIsIFwibWxpXCIsIFwibWxsXCIsIFwibWx5XCJdfSxcbiAgICB7bmFtZTogXCJPY3RhdmVcIiwgbWltZTogXCJ0ZXh0L3gtb2N0YXZlXCIsIG1vZGU6IFwib2N0YXZlXCIsIGV4dDogW1wibVwiXX0sXG4gICAge25hbWU6IFwiT3pcIiwgbWltZTogXCJ0ZXh0L3gtb3pcIiwgbW9kZTogXCJvelwiLCBleHQ6IFtcIm96XCJdfSxcbiAgICB7bmFtZTogXCJQYXNjYWxcIiwgbWltZTogXCJ0ZXh0L3gtcGFzY2FsXCIsIG1vZGU6IFwicGFzY2FsXCIsIGV4dDogW1wicFwiLCBcInBhc1wiXX0sXG4gICAge25hbWU6IFwiUEVHLmpzXCIsIG1pbWU6IFwibnVsbFwiLCBtb2RlOiBcInBlZ2pzXCIsIGV4dDogW1wianNvbmxkXCJdfSxcbiAgICB7bmFtZTogXCJQZXJsXCIsIG1pbWU6IFwidGV4dC94LXBlcmxcIiwgbW9kZTogXCJwZXJsXCIsIGV4dDogW1wicGxcIiwgXCJwbVwiXX0sXG4gICAge25hbWU6IFwiUEhQXCIsIG1pbWU6IFwiYXBwbGljYXRpb24veC1odHRwZC1waHBcIiwgbW9kZTogXCJwaHBcIiwgZXh0OiBbXCJwaHBcIiwgXCJwaHAzXCIsIFwicGhwNFwiLCBcInBocDVcIiwgXCJwaHRtbFwiXX0sXG4gICAge25hbWU6IFwiUGlnXCIsIG1pbWU6IFwidGV4dC94LXBpZ1wiLCBtb2RlOiBcInBpZ1wiLCBleHQ6IFtcInBpZ1wiXX0sXG4gICAge25hbWU6IFwiUGxhaW4gVGV4dFwiLCBtaW1lOiBcInRleHQvcGxhaW5cIiwgbW9kZTogXCJudWxsXCIsIGV4dDogW1widHh0XCIsIFwidGV4dFwiLCBcImNvbmZcIiwgXCJkZWZcIiwgXCJsaXN0XCIsIFwibG9nXCJdfSxcbiAgICB7bmFtZTogXCJQTFNRTFwiLCBtaW1lOiBcInRleHQveC1wbHNxbFwiLCBtb2RlOiBcInNxbFwiLCBleHQ6IFtcInBsc1wiXX0sXG4gICAge25hbWU6IFwiUHJvcGVydGllcyBmaWxlc1wiLCBtaW1lOiBcInRleHQveC1wcm9wZXJ0aWVzXCIsIG1vZGU6IFwicHJvcGVydGllc1wiLCBleHQ6IFtcInByb3BlcnRpZXNcIiwgXCJpbmlcIiwgXCJpblwiXSwgYWxpYXM6IFtcImluaVwiLCBcInByb3BlcnRpZXNcIl19LFxuICAgIHtuYW1lOiBcIlB5dGhvblwiLCBtaW1lOiBcInRleHQveC1weXRob25cIiwgbW9kZTogXCJweXRob25cIiwgZXh0OiBbXCJweVwiLCBcInB5d1wiXX0sXG4gICAge25hbWU6IFwiUHVwcGV0XCIsIG1pbWU6IFwidGV4dC94LXB1cHBldFwiLCBtb2RlOiBcInB1cHBldFwiLCBleHQ6IFtcInBwXCJdfSxcbiAgICB7bmFtZTogXCJRXCIsIG1pbWU6IFwidGV4dC94LXFcIiwgbW9kZTogXCJxXCIsIGV4dDogW1wicVwiXX0sXG4gICAge25hbWU6IFwiUlwiLCBtaW1lOiBcInRleHQveC1yc3JjXCIsIG1vZGU6IFwiclwiLCBleHQ6IFtcInJcIl0sIGFsaWFzOiBbXCJyc2NyaXB0XCJdfSxcbiAgICB7bmFtZTogXCJyZVN0cnVjdHVyZWRUZXh0XCIsIG1pbWU6IFwidGV4dC94LXJzdFwiLCBtb2RlOiBcInJzdFwiLCBleHQ6IFtcInJzdFwiXSwgYWxpYXM6IFtcInJzdFwiXX0sXG4gICAge25hbWU6IFwiUlBNIENoYW5nZXNcIiwgbWltZTogXCJ0ZXh0L3gtcnBtLWNoYW5nZXNcIiwgbW9kZTogXCJycG1cIn0sXG4gICAge25hbWU6IFwiUlBNIFNwZWNcIiwgbWltZTogXCJ0ZXh0L3gtcnBtLXNwZWNcIiwgbW9kZTogXCJycG1cIiwgZXh0OiBbXCJzcGVjXCJdfSxcbiAgICB7bmFtZTogXCJSdWJ5XCIsIG1pbWU6IFwidGV4dC94LXJ1YnlcIiwgbW9kZTogXCJydWJ5XCIsIGV4dDogW1wicmJcIl0sIGFsaWFzOiBbXCJqcnVieVwiLCBcIm1hY3J1YnlcIiwgXCJyYWtlXCIsIFwicmJcIiwgXCJyYnhcIl19LFxuICAgIHtuYW1lOiBcIlJ1c3RcIiwgbWltZTogXCJ0ZXh0L3gtcnVzdHNyY1wiLCBtb2RlOiBcInJ1c3RcIiwgZXh0OiBbXCJyc1wiXX0sXG4gICAge25hbWU6IFwiU2Fzc1wiLCBtaW1lOiBcInRleHQveC1zYXNzXCIsIG1vZGU6IFwic2Fzc1wiLCBleHQ6IFtcInNhc3NcIl19LFxuICAgIHtuYW1lOiBcIlNjYWxhXCIsIG1pbWU6IFwidGV4dC94LXNjYWxhXCIsIG1vZGU6IFwiY2xpa2VcIiwgZXh0OiBbXCJzY2FsYVwiXX0sXG4gICAge25hbWU6IFwiU2NoZW1lXCIsIG1pbWU6IFwidGV4dC94LXNjaGVtZVwiLCBtb2RlOiBcInNjaGVtZVwiLCBleHQ6IFtcInNjbVwiLCBcInNzXCJdfSxcbiAgICB7bmFtZTogXCJTQ1NTXCIsIG1pbWU6IFwidGV4dC94LXNjc3NcIiwgbW9kZTogXCJjc3NcIiwgZXh0OiBbXCJzY3NzXCJdfSxcbiAgICB7bmFtZTogXCJTaGVsbFwiLCBtaW1lOiBcInRleHQveC1zaFwiLCBtb2RlOiBcInNoZWxsXCIsIGV4dDogW1wic2hcIiwgXCJrc2hcIiwgXCJiYXNoXCJdLCBhbGlhczogW1wiYmFzaFwiLCBcInNoXCIsIFwienNoXCJdLCBmaWxlOiAvXlBLR0JVSUxEJC99LFxuICAgIHtuYW1lOiBcIlNpZXZlXCIsIG1pbWU6IFwiYXBwbGljYXRpb24vc2lldmVcIiwgbW9kZTogXCJzaWV2ZVwiLCBleHQ6IFtcInNpdlwiLCBcInNpZXZlXCJdfSxcbiAgICB7bmFtZTogXCJTbGltXCIsIG1pbWVzOiBbXCJ0ZXh0L3gtc2xpbVwiLCBcImFwcGxpY2F0aW9uL3gtc2xpbVwiXSwgbW9kZTogXCJzbGltXCIsIGV4dDogW1wic2xpbVwiXX0sXG4gICAge25hbWU6IFwiU21hbGx0YWxrXCIsIG1pbWU6IFwidGV4dC94LXN0c3JjXCIsIG1vZGU6IFwic21hbGx0YWxrXCIsIGV4dDogW1wic3RcIl19LFxuICAgIHtuYW1lOiBcIlNtYXJ0eVwiLCBtaW1lOiBcInRleHQveC1zbWFydHlcIiwgbW9kZTogXCJzbWFydHlcIiwgZXh0OiBbXCJ0cGxcIl19LFxuICAgIHtuYW1lOiBcIlNvbHJcIiwgbWltZTogXCJ0ZXh0L3gtc29sclwiLCBtb2RlOiBcInNvbHJcIn0sXG4gICAge25hbWU6IFwiU295XCIsIG1pbWU6IFwidGV4dC94LXNveVwiLCBtb2RlOiBcInNveVwiLCBleHQ6IFtcInNveVwiXSwgYWxpYXM6IFtcImNsb3N1cmUgdGVtcGxhdGVcIl19LFxuICAgIHtuYW1lOiBcIlNQQVJRTFwiLCBtaW1lOiBcImFwcGxpY2F0aW9uL3NwYXJxbC1xdWVyeVwiLCBtb2RlOiBcInNwYXJxbFwiLCBleHQ6IFtcInJxXCIsIFwic3BhcnFsXCJdLCBhbGlhczogW1wic3BhcnVsXCJdfSxcbiAgICB7bmFtZTogXCJTcHJlYWRzaGVldFwiLCBtaW1lOiBcInRleHQveC1zcHJlYWRzaGVldFwiLCBtb2RlOiBcInNwcmVhZHNoZWV0XCIsIGFsaWFzOiBbXCJleGNlbFwiLCBcImZvcm11bGFcIl19LFxuICAgIHtuYW1lOiBcIlNRTFwiLCBtaW1lOiBcInRleHQveC1zcWxcIiwgbW9kZTogXCJzcWxcIiwgZXh0OiBbXCJzcWxcIl19LFxuICAgIHtuYW1lOiBcIlNxdWlycmVsXCIsIG1pbWU6IFwidGV4dC94LXNxdWlycmVsXCIsIG1vZGU6IFwiY2xpa2VcIiwgZXh0OiBbXCJudXRcIl19LFxuICAgIHtuYW1lOiBcIlN3aWZ0XCIsIG1pbWU6IFwidGV4dC94LXN3aWZ0XCIsIG1vZGU6IFwic3dpZnRcIiwgZXh0OiBbXCJzd2lmdFwiXX0sXG4gICAge25hbWU6IFwiTWFyaWFEQlwiLCBtaW1lOiBcInRleHQveC1tYXJpYWRiXCIsIG1vZGU6IFwic3FsXCJ9LFxuICAgIHtuYW1lOiBcInNUZVhcIiwgbWltZTogXCJ0ZXh0L3gtc3RleFwiLCBtb2RlOiBcInN0ZXhcIn0sXG4gICAge25hbWU6IFwiTGFUZVhcIiwgbWltZTogXCJ0ZXh0L3gtbGF0ZXhcIiwgbW9kZTogXCJzdGV4XCIsIGV4dDogW1widGV4dFwiLCBcImx0eFwiXSwgYWxpYXM6IFtcInRleFwiXX0sXG4gICAge25hbWU6IFwiU3lzdGVtVmVyaWxvZ1wiLCBtaW1lOiBcInRleHQveC1zeXN0ZW12ZXJpbG9nXCIsIG1vZGU6IFwidmVyaWxvZ1wiLCBleHQ6IFtcInZcIl19LFxuICAgIHtuYW1lOiBcIlRjbFwiLCBtaW1lOiBcInRleHQveC10Y2xcIiwgbW9kZTogXCJ0Y2xcIiwgZXh0OiBbXCJ0Y2xcIl19LFxuICAgIHtuYW1lOiBcIlRleHRpbGVcIiwgbWltZTogXCJ0ZXh0L3gtdGV4dGlsZVwiLCBtb2RlOiBcInRleHRpbGVcIiwgZXh0OiBbXCJ0ZXh0aWxlXCJdfSxcbiAgICB7bmFtZTogXCJUaWRkbHlXaWtpIFwiLCBtaW1lOiBcInRleHQveC10aWRkbHl3aWtpXCIsIG1vZGU6IFwidGlkZGx5d2lraVwifSxcbiAgICB7bmFtZTogXCJUaWtpIHdpa2lcIiwgbWltZTogXCJ0ZXh0L3Rpa2lcIiwgbW9kZTogXCJ0aWtpXCJ9LFxuICAgIHtuYW1lOiBcIlRPTUxcIiwgbWltZTogXCJ0ZXh0L3gtdG9tbFwiLCBtb2RlOiBcInRvbWxcIiwgZXh0OiBbXCJ0b21sXCJdfSxcbiAgICB7bmFtZTogXCJUb3JuYWRvXCIsIG1pbWU6IFwidGV4dC94LXRvcm5hZG9cIiwgbW9kZTogXCJ0b3JuYWRvXCJ9LFxuICAgIHtuYW1lOiBcInRyb2ZmXCIsIG1pbWU6IFwidHJvZmZcIiwgbW9kZTogXCJ0cm9mZlwiLCBleHQ6IFtcIjFcIiwgXCIyXCIsIFwiM1wiLCBcIjRcIiwgXCI1XCIsIFwiNlwiLCBcIjdcIiwgXCI4XCIsIFwiOVwiXX0sXG4gICAge25hbWU6IFwiVFRDTlwiLCBtaW1lOiBcInRleHQveC10dGNuXCIsIG1vZGU6IFwidHRjblwiLCBleHQ6IFtcInR0Y25cIiwgXCJ0dGNuM1wiLCBcInR0Y25wcFwiXX0sXG4gICAge25hbWU6IFwiVFRDTl9DRkdcIiwgbWltZTogXCJ0ZXh0L3gtdHRjbi1jZmdcIiwgbW9kZTogXCJ0dGNuLWNmZ1wiLCBleHQ6IFtcImNmZ1wiXX0sXG4gICAge25hbWU6IFwiVHVydGxlXCIsIG1pbWU6IFwidGV4dC90dXJ0bGVcIiwgbW9kZTogXCJ0dXJ0bGVcIiwgZXh0OiBbXCJ0dGxcIl19LFxuICAgIHtuYW1lOiBcIlR5cGVTY3JpcHRcIiwgbWltZTogXCJhcHBsaWNhdGlvbi90eXBlc2NyaXB0XCIsIG1vZGU6IFwiamF2YXNjcmlwdFwiLCBleHQ6IFtcInRzXCJdLCBhbGlhczogW1widHNcIl19LFxuICAgIHtuYW1lOiBcIlR3aWdcIiwgbWltZTogXCJ0ZXh0L3gtdHdpZ1wiLCBtb2RlOiBcInR3aWdcIn0sXG4gICAge25hbWU6IFwiVkIuTkVUXCIsIG1pbWU6IFwidGV4dC94LXZiXCIsIG1vZGU6IFwidmJcIiwgZXh0OiBbXCJ2YlwiXX0sXG4gICAge25hbWU6IFwiVkJTY3JpcHRcIiwgbWltZTogXCJ0ZXh0L3Zic2NyaXB0XCIsIG1vZGU6IFwidmJzY3JpcHRcIiwgZXh0OiBbXCJ2YnNcIl19LFxuICAgIHtuYW1lOiBcIlZlbG9jaXR5XCIsIG1pbWU6IFwidGV4dC92ZWxvY2l0eVwiLCBtb2RlOiBcInZlbG9jaXR5XCIsIGV4dDogW1widnRsXCJdfSxcbiAgICB7bmFtZTogXCJWZXJpbG9nXCIsIG1pbWU6IFwidGV4dC94LXZlcmlsb2dcIiwgbW9kZTogXCJ2ZXJpbG9nXCIsIGV4dDogW1widlwiXX0sXG4gICAge25hbWU6IFwiVkhETFwiLCBtaW1lOiBcInRleHQveC12aGRsXCIsIG1vZGU6IFwidmhkbFwiLCBleHQ6IFtcInZoZFwiLCBcInZoZGxcIl19LFxuICAgIHtuYW1lOiBcIlhNTFwiLCBtaW1lczogW1wiYXBwbGljYXRpb24veG1sXCIsIFwidGV4dC94bWxcIl0sIG1vZGU6IFwieG1sXCIsIGV4dDogW1wieG1sXCIsIFwieHNsXCIsIFwieHNkXCJdLCBhbGlhczogW1wicnNzXCIsIFwid3NkbFwiLCBcInhzZFwiXX0sXG4gICAge25hbWU6IFwiWFF1ZXJ5XCIsIG1pbWU6IFwiYXBwbGljYXRpb24veHF1ZXJ5XCIsIG1vZGU6IFwieHF1ZXJ5XCIsIGV4dDogW1wieHlcIiwgXCJ4cXVlcnlcIl19LFxuICAgIHtuYW1lOiBcIllBTUxcIiwgbWltZTogXCJ0ZXh0L3gteWFtbFwiLCBtb2RlOiBcInlhbWxcIiwgZXh0OiBbXCJ5YW1sXCIsIFwieW1sXCJdLCBhbGlhczogW1wieW1sXCJdfSxcbiAgICB7bmFtZTogXCJaODBcIiwgbWltZTogXCJ0ZXh0L3gtejgwXCIsIG1vZGU6IFwiejgwXCIsIGV4dDogW1wiejgwXCJdfSxcbiAgICB7bmFtZTogXCJtc2NnZW5cIiwgbWltZTogXCJ0ZXh0L3gtbXNjZ2VuXCIsIG1vZGU6IFwibXNjZ2VuXCIsIGV4dDogW1wibXNjZ2VuXCIsIFwibXNjaW5cIiwgXCJtc2NcIl19LFxuICAgIHtuYW1lOiBcInh1XCIsIG1pbWU6IFwidGV4dC94LXh1XCIsIG1vZGU6IFwibXNjZ2VuXCIsIGV4dDogW1wieHVcIl19LFxuICAgIHtuYW1lOiBcIm1zZ2VubnlcIiwgbWltZTogXCJ0ZXh0L3gtbXNnZW5ueVwiLCBtb2RlOiBcIm1zY2dlblwiLCBleHQ6IFtcIm1zZ2VubnlcIl19XG4gIF07XG4gIC8vIEVuc3VyZSBhbGwgbW9kZXMgaGF2ZSBhIG1pbWUgcHJvcGVydHkgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgQ29kZU1pcnJvci5tb2RlSW5mby5sZW5ndGg7IGkrKykge1xuICAgIHZhciBpbmZvID0gQ29kZU1pcnJvci5tb2RlSW5mb1tpXTtcbiAgICBpZiAoaW5mby5taW1lcykgaW5mby5taW1lID0gaW5mby5taW1lc1swXTtcbiAgfVxuXG4gIENvZGVNaXJyb3IuZmluZE1vZGVCeU1JTUUgPSBmdW5jdGlvbihtaW1lKSB7XG4gICAgbWltZSA9IG1pbWUudG9Mb3dlckNhc2UoKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IENvZGVNaXJyb3IubW9kZUluZm8ubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBpbmZvID0gQ29kZU1pcnJvci5tb2RlSW5mb1tpXTtcbiAgICAgIGlmIChpbmZvLm1pbWUgPT0gbWltZSkgcmV0dXJuIGluZm87XG4gICAgICBpZiAoaW5mby5taW1lcykgZm9yICh2YXIgaiA9IDA7IGogPCBpbmZvLm1pbWVzLmxlbmd0aDsgaisrKVxuICAgICAgICBpZiAoaW5mby5taW1lc1tqXSA9PSBtaW1lKSByZXR1cm4gaW5mbztcbiAgICB9XG4gIH07XG5cbiAgQ29kZU1pcnJvci5maW5kTW9kZUJ5RXh0ZW5zaW9uID0gZnVuY3Rpb24oZXh0KSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBDb2RlTWlycm9yLm1vZGVJbmZvLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgaW5mbyA9IENvZGVNaXJyb3IubW9kZUluZm9baV07XG4gICAgICBpZiAoaW5mby5leHQpIGZvciAodmFyIGogPSAwOyBqIDwgaW5mby5leHQubGVuZ3RoOyBqKyspXG4gICAgICAgIGlmIChpbmZvLmV4dFtqXSA9PSBleHQpIHJldHVybiBpbmZvO1xuICAgIH1cbiAgfTtcblxuICBDb2RlTWlycm9yLmZpbmRNb2RlQnlGaWxlTmFtZSA9IGZ1bmN0aW9uKGZpbGVuYW1lKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBDb2RlTWlycm9yLm1vZGVJbmZvLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgaW5mbyA9IENvZGVNaXJyb3IubW9kZUluZm9baV07XG4gICAgICBpZiAoaW5mby5maWxlICYmIGluZm8uZmlsZS50ZXN0KGZpbGVuYW1lKSkgcmV0dXJuIGluZm87XG4gICAgfVxuICAgIHZhciBkb3QgPSBmaWxlbmFtZS5sYXN0SW5kZXhPZihcIi5cIik7XG4gICAgdmFyIGV4dCA9IGRvdCA+IC0xICYmIGZpbGVuYW1lLnN1YnN0cmluZyhkb3QgKyAxLCBmaWxlbmFtZS5sZW5ndGgpO1xuICAgIGlmIChleHQpIHJldHVybiBDb2RlTWlycm9yLmZpbmRNb2RlQnlFeHRlbnNpb24oZXh0KTtcbiAgfTtcblxuICBDb2RlTWlycm9yLmZpbmRNb2RlQnlOYW1lID0gZnVuY3Rpb24obmFtZSkge1xuICAgIG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBDb2RlTWlycm9yLm1vZGVJbmZvLmxlbmd0aDsgaSsrKSB7XG4gICAgICB2YXIgaW5mbyA9IENvZGVNaXJyb3IubW9kZUluZm9baV07XG4gICAgICBpZiAoaW5mby5uYW1lLnRvTG93ZXJDYXNlKCkgPT0gbmFtZSkgcmV0dXJuIGluZm87XG4gICAgICBpZiAoaW5mby5hbGlhcykgZm9yICh2YXIgaiA9IDA7IGogPCBpbmZvLmFsaWFzLmxlbmd0aDsgaisrKVxuICAgICAgICBpZiAoaW5mby5hbGlhc1tqXS50b0xvd2VyQ2FzZSgpID09IG5hbWUpIHJldHVybiBpbmZvO1xuICAgIH1cbiAgfTtcbn0pO1xuIiwiLy8gQ29kZU1pcnJvciwgY29weXJpZ2h0IChjKSBieSBNYXJpam4gSGF2ZXJiZWtlIGFuZCBvdGhlcnNcbi8vIERpc3RyaWJ1dGVkIHVuZGVyIGFuIE1JVCBsaWNlbnNlOiBodHRwOi8vY29kZW1pcnJvci5uZXQvTElDRU5TRVxuXG4oZnVuY3Rpb24obW9kKSB7XG4gIGlmICh0eXBlb2YgZXhwb3J0cyA9PSBcIm9iamVjdFwiICYmIHR5cGVvZiBtb2R1bGUgPT0gXCJvYmplY3RcIikgLy8gQ29tbW9uSlNcbiAgICBtb2QocmVxdWlyZShcIi4uLy4uL2xpYi9jb2RlbWlycm9yXCIpKTtcbiAgZWxzZSBpZiAodHlwZW9mIGRlZmluZSA9PSBcImZ1bmN0aW9uXCIgJiYgZGVmaW5lLmFtZCkgLy8gQU1EXG4gICAgZGVmaW5lKFtcIi4uLy4uL2xpYi9jb2RlbWlycm9yXCJdLCBtb2QpO1xuICBlbHNlIC8vIFBsYWluIGJyb3dzZXIgZW52XG4gICAgbW9kKENvZGVNaXJyb3IpO1xufSkoZnVuY3Rpb24oQ29kZU1pcnJvcikge1xuXCJ1c2Ugc3RyaWN0XCI7XG5cbkNvZGVNaXJyb3IuZGVmaW5lTW9kZShcInhtbFwiLCBmdW5jdGlvbihjb25maWcsIHBhcnNlckNvbmZpZykge1xuICB2YXIgaW5kZW50VW5pdCA9IGNvbmZpZy5pbmRlbnRVbml0O1xuICB2YXIgbXVsdGlsaW5lVGFnSW5kZW50RmFjdG9yID0gcGFyc2VyQ29uZmlnLm11bHRpbGluZVRhZ0luZGVudEZhY3RvciB8fCAxO1xuICB2YXIgbXVsdGlsaW5lVGFnSW5kZW50UGFzdFRhZyA9IHBhcnNlckNvbmZpZy5tdWx0aWxpbmVUYWdJbmRlbnRQYXN0VGFnO1xuICBpZiAobXVsdGlsaW5lVGFnSW5kZW50UGFzdFRhZyA9PSBudWxsKSBtdWx0aWxpbmVUYWdJbmRlbnRQYXN0VGFnID0gdHJ1ZTtcblxuICB2YXIgS2x1ZGdlcyA9IHBhcnNlckNvbmZpZy5odG1sTW9kZSA/IHtcbiAgICBhdXRvU2VsZkNsb3NlcnM6IHsnYXJlYSc6IHRydWUsICdiYXNlJzogdHJ1ZSwgJ2JyJzogdHJ1ZSwgJ2NvbCc6IHRydWUsICdjb21tYW5kJzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAnZW1iZWQnOiB0cnVlLCAnZnJhbWUnOiB0cnVlLCAnaHInOiB0cnVlLCAnaW1nJzogdHJ1ZSwgJ2lucHV0JzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAna2V5Z2VuJzogdHJ1ZSwgJ2xpbmsnOiB0cnVlLCAnbWV0YSc6IHRydWUsICdwYXJhbSc6IHRydWUsICdzb3VyY2UnOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICd0cmFjayc6IHRydWUsICd3YnInOiB0cnVlLCAnbWVudWl0ZW0nOiB0cnVlfSxcbiAgICBpbXBsaWNpdGx5Q2xvc2VkOiB7J2RkJzogdHJ1ZSwgJ2xpJzogdHJ1ZSwgJ29wdGdyb3VwJzogdHJ1ZSwgJ29wdGlvbic6IHRydWUsICdwJzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgJ3JwJzogdHJ1ZSwgJ3J0JzogdHJ1ZSwgJ3Rib2R5JzogdHJ1ZSwgJ3RkJzogdHJ1ZSwgJ3Rmb290JzogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgJ3RoJzogdHJ1ZSwgJ3RyJzogdHJ1ZX0sXG4gICAgY29udGV4dEdyYWJiZXJzOiB7XG4gICAgICAnZGQnOiB7J2RkJzogdHJ1ZSwgJ2R0JzogdHJ1ZX0sXG4gICAgICAnZHQnOiB7J2RkJzogdHJ1ZSwgJ2R0JzogdHJ1ZX0sXG4gICAgICAnbGknOiB7J2xpJzogdHJ1ZX0sXG4gICAgICAnb3B0aW9uJzogeydvcHRpb24nOiB0cnVlLCAnb3B0Z3JvdXAnOiB0cnVlfSxcbiAgICAgICdvcHRncm91cCc6IHsnb3B0Z3JvdXAnOiB0cnVlfSxcbiAgICAgICdwJzogeydhZGRyZXNzJzogdHJ1ZSwgJ2FydGljbGUnOiB0cnVlLCAnYXNpZGUnOiB0cnVlLCAnYmxvY2txdW90ZSc6IHRydWUsICdkaXInOiB0cnVlLFxuICAgICAgICAgICAgJ2Rpdic6IHRydWUsICdkbCc6IHRydWUsICdmaWVsZHNldCc6IHRydWUsICdmb290ZXInOiB0cnVlLCAnZm9ybSc6IHRydWUsXG4gICAgICAgICAgICAnaDEnOiB0cnVlLCAnaDInOiB0cnVlLCAnaDMnOiB0cnVlLCAnaDQnOiB0cnVlLCAnaDUnOiB0cnVlLCAnaDYnOiB0cnVlLFxuICAgICAgICAgICAgJ2hlYWRlcic6IHRydWUsICdoZ3JvdXAnOiB0cnVlLCAnaHInOiB0cnVlLCAnbWVudSc6IHRydWUsICduYXYnOiB0cnVlLCAnb2wnOiB0cnVlLFxuICAgICAgICAgICAgJ3AnOiB0cnVlLCAncHJlJzogdHJ1ZSwgJ3NlY3Rpb24nOiB0cnVlLCAndGFibGUnOiB0cnVlLCAndWwnOiB0cnVlfSxcbiAgICAgICdycCc6IHsncnAnOiB0cnVlLCAncnQnOiB0cnVlfSxcbiAgICAgICdydCc6IHsncnAnOiB0cnVlLCAncnQnOiB0cnVlfSxcbiAgICAgICd0Ym9keSc6IHsndGJvZHknOiB0cnVlLCAndGZvb3QnOiB0cnVlfSxcbiAgICAgICd0ZCc6IHsndGQnOiB0cnVlLCAndGgnOiB0cnVlfSxcbiAgICAgICd0Zm9vdCc6IHsndGJvZHknOiB0cnVlfSxcbiAgICAgICd0aCc6IHsndGQnOiB0cnVlLCAndGgnOiB0cnVlfSxcbiAgICAgICd0aGVhZCc6IHsndGJvZHknOiB0cnVlLCAndGZvb3QnOiB0cnVlfSxcbiAgICAgICd0cic6IHsndHInOiB0cnVlfVxuICAgIH0sXG4gICAgZG9Ob3RJbmRlbnQ6IHtcInByZVwiOiB0cnVlfSxcbiAgICBhbGxvd1VucXVvdGVkOiB0cnVlLFxuICAgIGFsbG93TWlzc2luZzogdHJ1ZSxcbiAgICBjYXNlRm9sZDogdHJ1ZVxuICB9IDoge1xuICAgIGF1dG9TZWxmQ2xvc2Vyczoge30sXG4gICAgaW1wbGljaXRseUNsb3NlZDoge30sXG4gICAgY29udGV4dEdyYWJiZXJzOiB7fSxcbiAgICBkb05vdEluZGVudDoge30sXG4gICAgYWxsb3dVbnF1b3RlZDogZmFsc2UsXG4gICAgYWxsb3dNaXNzaW5nOiBmYWxzZSxcbiAgICBjYXNlRm9sZDogZmFsc2VcbiAgfTtcbiAgdmFyIGFsaWduQ0RBVEEgPSBwYXJzZXJDb25maWcuYWxpZ25DREFUQTtcblxuICAvLyBSZXR1cm4gdmFyaWFibGVzIGZvciB0b2tlbml6ZXJzXG4gIHZhciB0eXBlLCBzZXRTdHlsZTtcblxuICBmdW5jdGlvbiBpblRleHQoc3RyZWFtLCBzdGF0ZSkge1xuICAgIGZ1bmN0aW9uIGNoYWluKHBhcnNlcikge1xuICAgICAgc3RhdGUudG9rZW5pemUgPSBwYXJzZXI7XG4gICAgICByZXR1cm4gcGFyc2VyKHN0cmVhbSwgc3RhdGUpO1xuICAgIH1cblxuICAgIHZhciBjaCA9IHN0cmVhbS5uZXh0KCk7XG4gICAgaWYgKGNoID09IFwiPFwiKSB7XG4gICAgICBpZiAoc3RyZWFtLmVhdChcIiFcIikpIHtcbiAgICAgICAgaWYgKHN0cmVhbS5lYXQoXCJbXCIpKSB7XG4gICAgICAgICAgaWYgKHN0cmVhbS5tYXRjaChcIkNEQVRBW1wiKSkgcmV0dXJuIGNoYWluKGluQmxvY2soXCJhdG9tXCIsIFwiXV0+XCIpKTtcbiAgICAgICAgICBlbHNlIHJldHVybiBudWxsO1xuICAgICAgICB9IGVsc2UgaWYgKHN0cmVhbS5tYXRjaChcIi0tXCIpKSB7XG4gICAgICAgICAgcmV0dXJuIGNoYWluKGluQmxvY2soXCJjb21tZW50XCIsIFwiLS0+XCIpKTtcbiAgICAgICAgfSBlbHNlIGlmIChzdHJlYW0ubWF0Y2goXCJET0NUWVBFXCIsIHRydWUsIHRydWUpKSB7XG4gICAgICAgICAgc3RyZWFtLmVhdFdoaWxlKC9bXFx3XFwuX1xcLV0vKTtcbiAgICAgICAgICByZXR1cm4gY2hhaW4oZG9jdHlwZSgxKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoc3RyZWFtLmVhdChcIj9cIikpIHtcbiAgICAgICAgc3RyZWFtLmVhdFdoaWxlKC9bXFx3XFwuX1xcLV0vKTtcbiAgICAgICAgc3RhdGUudG9rZW5pemUgPSBpbkJsb2NrKFwibWV0YVwiLCBcIj8+XCIpO1xuICAgICAgICByZXR1cm4gXCJtZXRhXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0eXBlID0gc3RyZWFtLmVhdChcIi9cIikgPyBcImNsb3NlVGFnXCIgOiBcIm9wZW5UYWdcIjtcbiAgICAgICAgc3RhdGUudG9rZW5pemUgPSBpblRhZztcbiAgICAgICAgcmV0dXJuIFwidGFnIGJyYWNrZXRcIjtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGNoID09IFwiJlwiKSB7XG4gICAgICB2YXIgb2s7XG4gICAgICBpZiAoc3RyZWFtLmVhdChcIiNcIikpIHtcbiAgICAgICAgaWYgKHN0cmVhbS5lYXQoXCJ4XCIpKSB7XG4gICAgICAgICAgb2sgPSBzdHJlYW0uZWF0V2hpbGUoL1thLWZBLUZcXGRdLykgJiYgc3RyZWFtLmVhdChcIjtcIik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgb2sgPSBzdHJlYW0uZWF0V2hpbGUoL1tcXGRdLykgJiYgc3RyZWFtLmVhdChcIjtcIik7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9rID0gc3RyZWFtLmVhdFdoaWxlKC9bXFx3XFwuXFwtOl0vKSAmJiBzdHJlYW0uZWF0KFwiO1wiKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBvayA/IFwiYXRvbVwiIDogXCJlcnJvclwiO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdHJlYW0uZWF0V2hpbGUoL1teJjxdLyk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cbiAgaW5UZXh0LmlzSW5UZXh0ID0gdHJ1ZTtcblxuICBmdW5jdGlvbiBpblRhZyhzdHJlYW0sIHN0YXRlKSB7XG4gICAgdmFyIGNoID0gc3RyZWFtLm5leHQoKTtcbiAgICBpZiAoY2ggPT0gXCI+XCIgfHwgKGNoID09IFwiL1wiICYmIHN0cmVhbS5lYXQoXCI+XCIpKSkge1xuICAgICAgc3RhdGUudG9rZW5pemUgPSBpblRleHQ7XG4gICAgICB0eXBlID0gY2ggPT0gXCI+XCIgPyBcImVuZFRhZ1wiIDogXCJzZWxmY2xvc2VUYWdcIjtcbiAgICAgIHJldHVybiBcInRhZyBicmFja2V0XCI7XG4gICAgfSBlbHNlIGlmIChjaCA9PSBcIj1cIikge1xuICAgICAgdHlwZSA9IFwiZXF1YWxzXCI7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9IGVsc2UgaWYgKGNoID09IFwiPFwiKSB7XG4gICAgICBzdGF0ZS50b2tlbml6ZSA9IGluVGV4dDtcbiAgICAgIHN0YXRlLnN0YXRlID0gYmFzZVN0YXRlO1xuICAgICAgc3RhdGUudGFnTmFtZSA9IHN0YXRlLnRhZ1N0YXJ0ID0gbnVsbDtcbiAgICAgIHZhciBuZXh0ID0gc3RhdGUudG9rZW5pemUoc3RyZWFtLCBzdGF0ZSk7XG4gICAgICByZXR1cm4gbmV4dCA/IG5leHQgKyBcIiB0YWcgZXJyb3JcIiA6IFwidGFnIGVycm9yXCI7XG4gICAgfSBlbHNlIGlmICgvW1xcJ1xcXCJdLy50ZXN0KGNoKSkge1xuICAgICAgc3RhdGUudG9rZW5pemUgPSBpbkF0dHJpYnV0ZShjaCk7XG4gICAgICBzdGF0ZS5zdHJpbmdTdGFydENvbCA9IHN0cmVhbS5jb2x1bW4oKTtcbiAgICAgIHJldHVybiBzdGF0ZS50b2tlbml6ZShzdHJlYW0sIHN0YXRlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc3RyZWFtLm1hdGNoKC9eW15cXHNcXHUwMGEwPTw+XFxcIlxcJ10qW15cXHNcXHUwMGEwPTw+XFxcIlxcJ1xcL10vKTtcbiAgICAgIHJldHVybiBcIndvcmRcIjtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBpbkF0dHJpYnV0ZShxdW90ZSkge1xuICAgIHZhciBjbG9zdXJlID0gZnVuY3Rpb24oc3RyZWFtLCBzdGF0ZSkge1xuICAgICAgd2hpbGUgKCFzdHJlYW0uZW9sKCkpIHtcbiAgICAgICAgaWYgKHN0cmVhbS5uZXh0KCkgPT0gcXVvdGUpIHtcbiAgICAgICAgICBzdGF0ZS50b2tlbml6ZSA9IGluVGFnO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gXCJzdHJpbmdcIjtcbiAgICB9O1xuICAgIGNsb3N1cmUuaXNJbkF0dHJpYnV0ZSA9IHRydWU7XG4gICAgcmV0dXJuIGNsb3N1cmU7XG4gIH1cblxuICBmdW5jdGlvbiBpbkJsb2NrKHN0eWxlLCB0ZXJtaW5hdG9yKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHtcbiAgICAgIHdoaWxlICghc3RyZWFtLmVvbCgpKSB7XG4gICAgICAgIGlmIChzdHJlYW0ubWF0Y2godGVybWluYXRvcikpIHtcbiAgICAgICAgICBzdGF0ZS50b2tlbml6ZSA9IGluVGV4dDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBzdHJlYW0ubmV4dCgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHN0eWxlO1xuICAgIH07XG4gIH1cbiAgZnVuY3Rpb24gZG9jdHlwZShkZXB0aCkge1xuICAgIHJldHVybiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7XG4gICAgICB2YXIgY2g7XG4gICAgICB3aGlsZSAoKGNoID0gc3RyZWFtLm5leHQoKSkgIT0gbnVsbCkge1xuICAgICAgICBpZiAoY2ggPT0gXCI8XCIpIHtcbiAgICAgICAgICBzdGF0ZS50b2tlbml6ZSA9IGRvY3R5cGUoZGVwdGggKyAxKTtcbiAgICAgICAgICByZXR1cm4gc3RhdGUudG9rZW5pemUoc3RyZWFtLCBzdGF0ZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoY2ggPT0gXCI+XCIpIHtcbiAgICAgICAgICBpZiAoZGVwdGggPT0gMSkge1xuICAgICAgICAgICAgc3RhdGUudG9rZW5pemUgPSBpblRleHQ7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc3RhdGUudG9rZW5pemUgPSBkb2N0eXBlKGRlcHRoIC0gMSk7XG4gICAgICAgICAgICByZXR1cm4gc3RhdGUudG9rZW5pemUoc3RyZWFtLCBzdGF0ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gXCJtZXRhXCI7XG4gICAgfTtcbiAgfVxuXG4gIGZ1bmN0aW9uIENvbnRleHQoc3RhdGUsIHRhZ05hbWUsIHN0YXJ0T2ZMaW5lKSB7XG4gICAgdGhpcy5wcmV2ID0gc3RhdGUuY29udGV4dDtcbiAgICB0aGlzLnRhZ05hbWUgPSB0YWdOYW1lO1xuICAgIHRoaXMuaW5kZW50ID0gc3RhdGUuaW5kZW50ZWQ7XG4gICAgdGhpcy5zdGFydE9mTGluZSA9IHN0YXJ0T2ZMaW5lO1xuICAgIGlmIChLbHVkZ2VzLmRvTm90SW5kZW50Lmhhc093blByb3BlcnR5KHRhZ05hbWUpIHx8IChzdGF0ZS5jb250ZXh0ICYmIHN0YXRlLmNvbnRleHQubm9JbmRlbnQpKVxuICAgICAgdGhpcy5ub0luZGVudCA9IHRydWU7XG4gIH1cbiAgZnVuY3Rpb24gcG9wQ29udGV4dChzdGF0ZSkge1xuICAgIGlmIChzdGF0ZS5jb250ZXh0KSBzdGF0ZS5jb250ZXh0ID0gc3RhdGUuY29udGV4dC5wcmV2O1xuICB9XG4gIGZ1bmN0aW9uIG1heWJlUG9wQ29udGV4dChzdGF0ZSwgbmV4dFRhZ05hbWUpIHtcbiAgICB2YXIgcGFyZW50VGFnTmFtZTtcbiAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgaWYgKCFzdGF0ZS5jb250ZXh0KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHBhcmVudFRhZ05hbWUgPSBzdGF0ZS5jb250ZXh0LnRhZ05hbWU7XG4gICAgICBpZiAoIUtsdWRnZXMuY29udGV4dEdyYWJiZXJzLmhhc093blByb3BlcnR5KHBhcmVudFRhZ05hbWUpIHx8XG4gICAgICAgICAgIUtsdWRnZXMuY29udGV4dEdyYWJiZXJzW3BhcmVudFRhZ05hbWVdLmhhc093blByb3BlcnR5KG5leHRUYWdOYW1lKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBwb3BDb250ZXh0KHN0YXRlKTtcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBiYXNlU3RhdGUodHlwZSwgc3RyZWFtLCBzdGF0ZSkge1xuICAgIGlmICh0eXBlID09IFwib3BlblRhZ1wiKSB7XG4gICAgICBzdGF0ZS50YWdTdGFydCA9IHN0cmVhbS5jb2x1bW4oKTtcbiAgICAgIHJldHVybiB0YWdOYW1lU3RhdGU7XG4gICAgfSBlbHNlIGlmICh0eXBlID09IFwiY2xvc2VUYWdcIikge1xuICAgICAgcmV0dXJuIGNsb3NlVGFnTmFtZVN0YXRlO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gYmFzZVN0YXRlO1xuICAgIH1cbiAgfVxuICBmdW5jdGlvbiB0YWdOYW1lU3RhdGUodHlwZSwgc3RyZWFtLCBzdGF0ZSkge1xuICAgIGlmICh0eXBlID09IFwid29yZFwiKSB7XG4gICAgICBzdGF0ZS50YWdOYW1lID0gc3RyZWFtLmN1cnJlbnQoKTtcbiAgICAgIHNldFN0eWxlID0gXCJ0YWdcIjtcbiAgICAgIHJldHVybiBhdHRyU3RhdGU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNldFN0eWxlID0gXCJlcnJvclwiO1xuICAgICAgcmV0dXJuIHRhZ05hbWVTdGF0ZTtcbiAgICB9XG4gIH1cbiAgZnVuY3Rpb24gY2xvc2VUYWdOYW1lU3RhdGUodHlwZSwgc3RyZWFtLCBzdGF0ZSkge1xuICAgIGlmICh0eXBlID09IFwid29yZFwiKSB7XG4gICAgICB2YXIgdGFnTmFtZSA9IHN0cmVhbS5jdXJyZW50KCk7XG4gICAgICBpZiAoc3RhdGUuY29udGV4dCAmJiBzdGF0ZS5jb250ZXh0LnRhZ05hbWUgIT0gdGFnTmFtZSAmJlxuICAgICAgICAgIEtsdWRnZXMuaW1wbGljaXRseUNsb3NlZC5oYXNPd25Qcm9wZXJ0eShzdGF0ZS5jb250ZXh0LnRhZ05hbWUpKVxuICAgICAgICBwb3BDb250ZXh0KHN0YXRlKTtcbiAgICAgIGlmIChzdGF0ZS5jb250ZXh0ICYmIHN0YXRlLmNvbnRleHQudGFnTmFtZSA9PSB0YWdOYW1lKSB7XG4gICAgICAgIHNldFN0eWxlID0gXCJ0YWdcIjtcbiAgICAgICAgcmV0dXJuIGNsb3NlU3RhdGU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZXRTdHlsZSA9IFwidGFnIGVycm9yXCI7XG4gICAgICAgIHJldHVybiBjbG9zZVN0YXRlRXJyO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBzZXRTdHlsZSA9IFwiZXJyb3JcIjtcbiAgICAgIHJldHVybiBjbG9zZVN0YXRlRXJyO1xuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGNsb3NlU3RhdGUodHlwZSwgX3N0cmVhbSwgc3RhdGUpIHtcbiAgICBpZiAodHlwZSAhPSBcImVuZFRhZ1wiKSB7XG4gICAgICBzZXRTdHlsZSA9IFwiZXJyb3JcIjtcbiAgICAgIHJldHVybiBjbG9zZVN0YXRlO1xuICAgIH1cbiAgICBwb3BDb250ZXh0KHN0YXRlKTtcbiAgICByZXR1cm4gYmFzZVN0YXRlO1xuICB9XG4gIGZ1bmN0aW9uIGNsb3NlU3RhdGVFcnIodHlwZSwgc3RyZWFtLCBzdGF0ZSkge1xuICAgIHNldFN0eWxlID0gXCJlcnJvclwiO1xuICAgIHJldHVybiBjbG9zZVN0YXRlKHR5cGUsIHN0cmVhbSwgc3RhdGUpO1xuICB9XG5cbiAgZnVuY3Rpb24gYXR0clN0YXRlKHR5cGUsIF9zdHJlYW0sIHN0YXRlKSB7XG4gICAgaWYgKHR5cGUgPT0gXCJ3b3JkXCIpIHtcbiAgICAgIHNldFN0eWxlID0gXCJhdHRyaWJ1dGVcIjtcbiAgICAgIHJldHVybiBhdHRyRXFTdGF0ZTtcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT0gXCJlbmRUYWdcIiB8fCB0eXBlID09IFwic2VsZmNsb3NlVGFnXCIpIHtcbiAgICAgIHZhciB0YWdOYW1lID0gc3RhdGUudGFnTmFtZSwgdGFnU3RhcnQgPSBzdGF0ZS50YWdTdGFydDtcbiAgICAgIHN0YXRlLnRhZ05hbWUgPSBzdGF0ZS50YWdTdGFydCA9IG51bGw7XG4gICAgICBpZiAodHlwZSA9PSBcInNlbGZjbG9zZVRhZ1wiIHx8XG4gICAgICAgICAgS2x1ZGdlcy5hdXRvU2VsZkNsb3NlcnMuaGFzT3duUHJvcGVydHkodGFnTmFtZSkpIHtcbiAgICAgICAgbWF5YmVQb3BDb250ZXh0KHN0YXRlLCB0YWdOYW1lKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1heWJlUG9wQ29udGV4dChzdGF0ZSwgdGFnTmFtZSk7XG4gICAgICAgIHN0YXRlLmNvbnRleHQgPSBuZXcgQ29udGV4dChzdGF0ZSwgdGFnTmFtZSwgdGFnU3RhcnQgPT0gc3RhdGUuaW5kZW50ZWQpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGJhc2VTdGF0ZTtcbiAgICB9XG4gICAgc2V0U3R5bGUgPSBcImVycm9yXCI7XG4gICAgcmV0dXJuIGF0dHJTdGF0ZTtcbiAgfVxuICBmdW5jdGlvbiBhdHRyRXFTdGF0ZSh0eXBlLCBzdHJlYW0sIHN0YXRlKSB7XG4gICAgaWYgKHR5cGUgPT0gXCJlcXVhbHNcIikgcmV0dXJuIGF0dHJWYWx1ZVN0YXRlO1xuICAgIGlmICghS2x1ZGdlcy5hbGxvd01pc3NpbmcpIHNldFN0eWxlID0gXCJlcnJvclwiO1xuICAgIHJldHVybiBhdHRyU3RhdGUodHlwZSwgc3RyZWFtLCBzdGF0ZSk7XG4gIH1cbiAgZnVuY3Rpb24gYXR0clZhbHVlU3RhdGUodHlwZSwgc3RyZWFtLCBzdGF0ZSkge1xuICAgIGlmICh0eXBlID09IFwic3RyaW5nXCIpIHJldHVybiBhdHRyQ29udGludWVkU3RhdGU7XG4gICAgaWYgKHR5cGUgPT0gXCJ3b3JkXCIgJiYgS2x1ZGdlcy5hbGxvd1VucXVvdGVkKSB7c2V0U3R5bGUgPSBcInN0cmluZ1wiOyByZXR1cm4gYXR0clN0YXRlO31cbiAgICBzZXRTdHlsZSA9IFwiZXJyb3JcIjtcbiAgICByZXR1cm4gYXR0clN0YXRlKHR5cGUsIHN0cmVhbSwgc3RhdGUpO1xuICB9XG4gIGZ1bmN0aW9uIGF0dHJDb250aW51ZWRTdGF0ZSh0eXBlLCBzdHJlYW0sIHN0YXRlKSB7XG4gICAgaWYgKHR5cGUgPT0gXCJzdHJpbmdcIikgcmV0dXJuIGF0dHJDb250aW51ZWRTdGF0ZTtcbiAgICByZXR1cm4gYXR0clN0YXRlKHR5cGUsIHN0cmVhbSwgc3RhdGUpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBzdGFydFN0YXRlOiBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB7dG9rZW5pemU6IGluVGV4dCxcbiAgICAgICAgICAgICAgc3RhdGU6IGJhc2VTdGF0ZSxcbiAgICAgICAgICAgICAgaW5kZW50ZWQ6IDAsXG4gICAgICAgICAgICAgIHRhZ05hbWU6IG51bGwsIHRhZ1N0YXJ0OiBudWxsLFxuICAgICAgICAgICAgICBjb250ZXh0OiBudWxsfTtcbiAgICB9LFxuXG4gICAgdG9rZW46IGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHtcbiAgICAgIGlmICghc3RhdGUudGFnTmFtZSAmJiBzdHJlYW0uc29sKCkpXG4gICAgICAgIHN0YXRlLmluZGVudGVkID0gc3RyZWFtLmluZGVudGF0aW9uKCk7XG5cbiAgICAgIGlmIChzdHJlYW0uZWF0U3BhY2UoKSkgcmV0dXJuIG51bGw7XG4gICAgICB0eXBlID0gbnVsbDtcbiAgICAgIHZhciBzdHlsZSA9IHN0YXRlLnRva2VuaXplKHN0cmVhbSwgc3RhdGUpO1xuICAgICAgaWYgKChzdHlsZSB8fCB0eXBlKSAmJiBzdHlsZSAhPSBcImNvbW1lbnRcIikge1xuICAgICAgICBzZXRTdHlsZSA9IG51bGw7XG4gICAgICAgIHN0YXRlLnN0YXRlID0gc3RhdGUuc3RhdGUodHlwZSB8fCBzdHlsZSwgc3RyZWFtLCBzdGF0ZSk7XG4gICAgICAgIGlmIChzZXRTdHlsZSlcbiAgICAgICAgICBzdHlsZSA9IHNldFN0eWxlID09IFwiZXJyb3JcIiA/IHN0eWxlICsgXCIgZXJyb3JcIiA6IHNldFN0eWxlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHN0eWxlO1xuICAgIH0sXG5cbiAgICBpbmRlbnQ6IGZ1bmN0aW9uKHN0YXRlLCB0ZXh0QWZ0ZXIsIGZ1bGxMaW5lKSB7XG4gICAgICB2YXIgY29udGV4dCA9IHN0YXRlLmNvbnRleHQ7XG4gICAgICAvLyBJbmRlbnQgbXVsdGktbGluZSBzdHJpbmdzIChlLmcuIGNzcykuXG4gICAgICBpZiAoc3RhdGUudG9rZW5pemUuaXNJbkF0dHJpYnV0ZSkge1xuICAgICAgICBpZiAoc3RhdGUudGFnU3RhcnQgPT0gc3RhdGUuaW5kZW50ZWQpXG4gICAgICAgICAgcmV0dXJuIHN0YXRlLnN0cmluZ1N0YXJ0Q29sICsgMTtcbiAgICAgICAgZWxzZVxuICAgICAgICAgIHJldHVybiBzdGF0ZS5pbmRlbnRlZCArIGluZGVudFVuaXQ7XG4gICAgICB9XG4gICAgICBpZiAoY29udGV4dCAmJiBjb250ZXh0Lm5vSW5kZW50KSByZXR1cm4gQ29kZU1pcnJvci5QYXNzO1xuICAgICAgaWYgKHN0YXRlLnRva2VuaXplICE9IGluVGFnICYmIHN0YXRlLnRva2VuaXplICE9IGluVGV4dClcbiAgICAgICAgcmV0dXJuIGZ1bGxMaW5lID8gZnVsbExpbmUubWF0Y2goL14oXFxzKikvKVswXS5sZW5ndGggOiAwO1xuICAgICAgLy8gSW5kZW50IHRoZSBzdGFydHMgb2YgYXR0cmlidXRlIG5hbWVzLlxuICAgICAgaWYgKHN0YXRlLnRhZ05hbWUpIHtcbiAgICAgICAgaWYgKG11bHRpbGluZVRhZ0luZGVudFBhc3RUYWcpXG4gICAgICAgICAgcmV0dXJuIHN0YXRlLnRhZ1N0YXJ0ICsgc3RhdGUudGFnTmFtZS5sZW5ndGggKyAyO1xuICAgICAgICBlbHNlXG4gICAgICAgICAgcmV0dXJuIHN0YXRlLnRhZ1N0YXJ0ICsgaW5kZW50VW5pdCAqIG11bHRpbGluZVRhZ0luZGVudEZhY3RvcjtcbiAgICAgIH1cbiAgICAgIGlmIChhbGlnbkNEQVRBICYmIC88IVxcW0NEQVRBXFxbLy50ZXN0KHRleHRBZnRlcikpIHJldHVybiAwO1xuICAgICAgdmFyIHRhZ0FmdGVyID0gdGV4dEFmdGVyICYmIC9ePChcXC8pPyhbXFx3XzpcXC4tXSopLy5leGVjKHRleHRBZnRlcik7XG4gICAgICBpZiAodGFnQWZ0ZXIgJiYgdGFnQWZ0ZXJbMV0pIHsgLy8gQ2xvc2luZyB0YWcgc3BvdHRlZFxuICAgICAgICB3aGlsZSAoY29udGV4dCkge1xuICAgICAgICAgIGlmIChjb250ZXh0LnRhZ05hbWUgPT0gdGFnQWZ0ZXJbMl0pIHtcbiAgICAgICAgICAgIGNvbnRleHQgPSBjb250ZXh0LnByZXY7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9IGVsc2UgaWYgKEtsdWRnZXMuaW1wbGljaXRseUNsb3NlZC5oYXNPd25Qcm9wZXJ0eShjb250ZXh0LnRhZ05hbWUpKSB7XG4gICAgICAgICAgICBjb250ZXh0ID0gY29udGV4dC5wcmV2O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodGFnQWZ0ZXIpIHsgLy8gT3BlbmluZyB0YWcgc3BvdHRlZFxuICAgICAgICB3aGlsZSAoY29udGV4dCkge1xuICAgICAgICAgIHZhciBncmFiYmVycyA9IEtsdWRnZXMuY29udGV4dEdyYWJiZXJzW2NvbnRleHQudGFnTmFtZV07XG4gICAgICAgICAgaWYgKGdyYWJiZXJzICYmIGdyYWJiZXJzLmhhc093blByb3BlcnR5KHRhZ0FmdGVyWzJdKSlcbiAgICAgICAgICAgIGNvbnRleHQgPSBjb250ZXh0LnByZXY7XG4gICAgICAgICAgZWxzZVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHdoaWxlIChjb250ZXh0ICYmICFjb250ZXh0LnN0YXJ0T2ZMaW5lKVxuICAgICAgICBjb250ZXh0ID0gY29udGV4dC5wcmV2O1xuICAgICAgaWYgKGNvbnRleHQpIHJldHVybiBjb250ZXh0LmluZGVudCArIGluZGVudFVuaXQ7XG4gICAgICBlbHNlIHJldHVybiAwO1xuICAgIH0sXG5cbiAgICBlbGVjdHJpY0lucHV0OiAvPFxcL1tcXHNcXHc6XSs+JC8sXG4gICAgYmxvY2tDb21tZW50U3RhcnQ6IFwiPCEtLVwiLFxuICAgIGJsb2NrQ29tbWVudEVuZDogXCItLT5cIixcblxuICAgIGNvbmZpZ3VyYXRpb246IHBhcnNlckNvbmZpZy5odG1sTW9kZSA/IFwiaHRtbFwiIDogXCJ4bWxcIixcbiAgICBoZWxwZXJUeXBlOiBwYXJzZXJDb25maWcuaHRtbE1vZGUgPyBcImh0bWxcIiA6IFwieG1sXCJcbiAgfTtcbn0pO1xuXG5Db2RlTWlycm9yLmRlZmluZU1JTUUoXCJ0ZXh0L3htbFwiLCBcInhtbFwiKTtcbkNvZGVNaXJyb3IuZGVmaW5lTUlNRShcImFwcGxpY2F0aW9uL3htbFwiLCBcInhtbFwiKTtcbmlmICghQ29kZU1pcnJvci5taW1lTW9kZXMuaGFzT3duUHJvcGVydHkoXCJ0ZXh0L2h0bWxcIikpXG4gIENvZGVNaXJyb3IuZGVmaW5lTUlNRShcInRleHQvaHRtbFwiLCB7bmFtZTogXCJ4bWxcIiwgaHRtbE1vZGU6IHRydWV9KTtcblxufSk7XG4iLCJpbXBvcnQge2V2ZX0gZnJvbSBcIi4vYXBwXCI7XG5cbmRlY2xhcmUgdmFyIHBsdXJhbGl6ZTtcbmRlY2xhcmUgdmFyIG5scDtcbmRlY2xhcmUgdmFyIHV1aWQ7XG5cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIFVzZXItRmFjaW5nIGZ1bmN0aW9uc1xuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5leHBvcnQgaW50ZXJmYWNlIFBhcnNlUmVzdWx0IHtcbiAgdG9rZW5zOiBBcnJheTxUb2tlbj4sXG4gIHRyZWU6IE5vZGUsXG4gIGNvbnRleHQ6IENvbnRleHQsXG4gIHF1ZXJ5OiBRdWVyeSxcbiAgc2NvcmU6IG51bWJlcixcbiAgc3RhdGU6IFN0YXRlRmxhZ3MsXG59XG5cbmV4cG9ydCBlbnVtIFN0YXRlRmxhZ3Mge1xuICBDT01QTEVURSxcbiAgTU9SRUlORk8sXG4gIE5PUkVTVUxULCAgXG59XG5cbi8vIEVudHJ5IHBvaW50IGZvciBOTFFQXG5leHBvcnQgZnVuY3Rpb24gcGFyc2UocXVlcnlTdHJpbmc6IHN0cmluZyk6IEFycmF5PFBhcnNlUmVzdWx0PiB7XG4gIGxldCBwcmVUb2tlbnMgPSBwcmVwcm9jZXNzUXVlcnlTdHJpbmcocXVlcnlTdHJpbmcpO1xuICBsZXQgdG9rZW5zID0gZm9ybVRva2VucyhwcmVUb2tlbnMpO1xuICBsZXQge3RyZWUsIGNvbnRleHR9ID0gZm9ybVRyZWUodG9rZW5zKTtcbiAgbGV0IHF1ZXJ5ID0gZm9ybVF1ZXJ5KHRyZWUpO1xuICAvLyBGaWd1cmUgb3V0IHRoZSBzdGF0ZSBmbGFnc1xuICBsZXQgZmxhZzogU3RhdGVGbGFncztcbiAgaWYgKHF1ZXJ5LnByb2plY3RzLmxlbmd0aCA9PT0gMCAmJiBxdWVyeS50ZXJtcy5sZW5ndGggPT09IDApIHtcbiAgICBmbGFnID0gU3RhdGVGbGFncy5OT1JFU1VMVDtcbiAgfSBlbHNlIGlmICh0cmVlQ29tcGxldGUodHJlZSkpIHtcbiAgICBmbGFnID0gU3RhdGVGbGFncy5DT01QTEVURTsgXG4gIH0gZWxzZSB7XG4gICAgZmxhZyA9IFN0YXRlRmxhZ3MuTU9SRUlORk87XG4gIH1cbiAgcmV0dXJuIFt7dG9rZW5zOiB0b2tlbnMsIHRyZWU6IHRyZWUsIGNvbnRleHQ6IGNvbnRleHQsIHF1ZXJ5OiBxdWVyeSwgc2NvcmU6IHVuZGVmaW5lZCwgc3RhdGU6IGZsYWd9XTtcbn1cblxuLy8gUmV0dXJucyBmYWxzZSBpZiBhbnkgbm9kZXMgYXJlIG5vdCBtYXJrZWQgZm91bmRcbi8vIFJldHVybnMgdHJ1ZSBpZiBhbGwgbm9kZXMgYXJlIG1hcmtlZCBmb3VuZFxuZnVuY3Rpb24gdHJlZUNvbXBsZXRlKG5vZGU6IE5vZGUpOiBib29sZWFuIHtcbiAgaWYgKG5vZGUuZm91bmQgPT09IGZhbHNlKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9IGVsc2Uge1xuICAgIGxldCBjaGlsZHJlblN0YXR1cyA9IG5vZGUuY2hpbGRyZW4ubWFwKHRyZWVDb21wbGV0ZSk7XG4gICAgcmV0dXJuIGNoaWxkcmVuU3RhdHVzLmV2ZXJ5KChjaGlsZCkgPT4gY2hpbGQgPT09IHRydWUpOyBcbiAgfVxufVxuXG4vLyBQZXJmb3JtcyBzb21lIHRyYW5zZm9ybWF0aW9ucyB0byB0aGUgcXVlcnkgc3RyaW5nIGJlZm9yZSB0b2tlbml6aW5nXG5leHBvcnQgZnVuY3Rpb24gcHJlcHJvY2Vzc1F1ZXJ5U3RyaW5nKHF1ZXJ5U3RyaW5nOiBzdHJpbmcpOiBBcnJheTxQcmVUb2tlbj4ge1xuICAvLyBBZGQgd2hpdGVzcGFjZSBiZWZvcmUgY29tbWFzXG4gIGxldCBwcm9jZXNzZWRTdHJpbmcgPSBxdWVyeVN0cmluZy5yZXBsYWNlKG5ldyBSZWdFeHAoXCIsXCIsICdnJyksXCIgLCBcIik7XG4gIHByb2Nlc3NlZFN0cmluZyA9IHByb2Nlc3NlZFN0cmluZy5yZXBsYWNlKG5ldyBSZWdFeHAoXCI7XCIsICdnJyksXCIgOyBcIik7XG4gIHByb2Nlc3NlZFN0cmluZyA9IHByb2Nlc3NlZFN0cmluZy5yZXBsYWNlKG5ldyBSZWdFeHAoXCJcXFxcK1wiLCAnZycpLFwiICsgXCIpO1xuICBwcm9jZXNzZWRTdHJpbmcgPSBwcm9jZXNzZWRTdHJpbmcucmVwbGFjZShuZXcgUmVnRXhwKFwiLVwiLCAnZycpLFwiIC0gXCIpO1xuICBwcm9jZXNzZWRTdHJpbmcgPSBwcm9jZXNzZWRTdHJpbmcucmVwbGFjZShuZXcgUmVnRXhwKFwiXFxcXCpcIiwgJ2cnKSxcIiAqIFwiKTtcbiAgcHJvY2Vzc2VkU3RyaW5nID0gcHJvY2Vzc2VkU3RyaW5nLnJlcGxhY2UobmV3IFJlZ0V4cChcIi9cIiwgJ2cnKSxcIiAvIFwiKTtcbiAgcHJvY2Vzc2VkU3RyaW5nID0gcHJvY2Vzc2VkU3RyaW5nLnJlcGxhY2UobmV3IFJlZ0V4cChcIlxcXFxzK1wiLCAnZycpLFwiIFwiKTtcbiAgLy8gR2V0IHBhcnRzIG9mIHNwZWFjaCB3aXRoIHNlbnRlbmNlIGluZm9ybWF0aW9uLiBJdCdzIG9rYXkgaWYgdGhleSdyZSB3cm9uZzsgdGhleSBcbiAgLy8gd2lsbCBiZSBjb3JyZWN0ZWQgYXMgd2UgY3JlYXRlIHRoZSB0cmVlIGFuZCBtYXRjaCBhZ2FpbnN0IHRoZSB1bmRlcmx5aW5nIGRhdGEgbW9kZWxcbiAgbGV0IHNlbnRlbmNlcyA9IG5scC5wb3MocHJvY2Vzc2VkU3RyaW5nLCB7ZG9udF9jb21iaW5lOiB0cnVlfSkuc2VudGVuY2VzOyAgIFxuICAvLyBJZiBubyBzZW50ZW5jZXMgd2VyZSBmb3VuZCwgZG9uJ3QgYm90aGVyIHBhcnNpbmdcbiAgaWYgKHNlbnRlbmNlcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gW107XG4gIH1cbiAgbGV0IG5scGNUb2tlbnMgPSBzZW50ZW5jZXNbMF0udG9rZW5zO1xuICBsZXQgcHJlVG9rZW5zOiBBcnJheTxQcmVUb2tlbj4gPSBubHBjVG9rZW5zLm1hcCgodG9rZW4saSkgPT4ge1xuICAgIHJldHVybiB7aXg6IGksIHRleHQ6IHRva2VuLnRleHQsIHRhZzogdG9rZW4ucG9zLnRhZ307XG4gIH0pO1xuICAvLyBHcm91cCBxdW90ZWQgdGV4dCBoZXJlXG4gIGxldCBxdW90ZVN0YXJ0cyA9IHByZVRva2Vucy5maWx0ZXIoKHQpID0+IHQudGV4dC5jaGFyQXQoMCkgPT09IGBcImApO1xuICBsZXQgcXVvdGVFbmRzID0gcHJlVG9rZW5zLmZpbHRlcigodCkgPT4gdC50ZXh0LmNoYXJBdCh0LnRleHQubGVuZ3RoLTEpID09PSBgXCJgKTtcbiAgLy8gSWYgd2UgaGF2ZSBiYWxhbmNlZCBxdW90ZXMsIGNvbWJpbmUgdG9rZW5zXG4gIGlmIChxdW90ZVN0YXJ0cy5sZW5ndGggPT09IHF1b3RlRW5kcy5sZW5ndGgpIHtcbiAgICBsZXQgZW5kLCBzdGFydDsgLy8gQEhBQ0sgdG8gZ2V0IGFyb3VuZCBibG9jayBzY29wZWQgdmFyaWFibGUgcmVzdHJpY3Rpb25cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHF1b3RlU3RhcnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBzdGFydCA9IHF1b3RlU3RhcnRzW2ldO1xuICAgICAgZW5kID0gcXVvdGVFbmRzW2ldO1xuICAgICAgLy8gR2V0IGFsbCB0b2tlbnMgYmV0d2VlbiBxdW90ZXMgKGluY2x1c2l2ZSlcbiAgICAgIGxldCBxdW90ZWRUb2tlbnMgPSBwcmVUb2tlbnMuZmlsdGVyKCh0b2tlbikgPT4gdG9rZW4uaXggPj0gc3RhcnQuaXggJiYgdG9rZW4uaXggPD0gZW5kLml4KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKHRva2VuKSA9PiB0b2tlbi50ZXh0KTtcbiAgICAgIGxldCBxdW90ZWRUZXh0ID0gcXVvdGVkVG9rZW5zLmpvaW4oXCIgXCIpOyAgICAgICAgICAgICAgICAgIFxuICAgICAgLy8gUmVtb3ZlIHF1b3RlcyAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgcXVvdGVkVGV4dCA9IHF1b3RlZFRleHQucmVwbGFjZShuZXcgUmVnRXhwKFwiXFxcIlwiLCAnZycpLFwiXCIpO1xuICAgICAgLy8gQ3JlYXRlIGEgbmV3IHByZXRva2VuXG4gICAgICBsZXQgbmV3UHJlVG9rZW46IFByZVRva2VuID0ge2l4OiBzdGFydC5peCwgdGV4dDogcXVvdGVkVGV4dCwgdGFnOiBcIk5OUVwifTtcbiAgICAgIHByZVRva2Vucy5zcGxpY2UocHJlVG9rZW5zLmluZGV4T2Yoc3RhcnQpLHF1b3RlZFRva2Vucy5sZW5ndGgsbmV3UHJlVG9rZW4pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcHJlVG9rZW5zO1xufVxuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBUb2tlbiBmdW5jdGlvbnNcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuaW50ZXJmYWNlIFByZVRva2VuIHtcbiAgaXg6IG51bWJlcixcbiAgdGV4dDogc3RyaW5nLFxuICB0YWc6IHN0cmluZyxcbn1cblxuZW51bSBNYWpvclBhcnRzT2ZTcGVlY2gge1xuICBST09ULFxuICBWRVJCLFxuICBBREpFQ1RJVkUsXG4gIEFEVkVSQixcbiAgTk9VTixcbiAgVkFMVUUsXG4gIEdMVUUsXG4gIFdIV09SRCxcbiAgU1lNQk9MLFxufVxuXG5lbnVtIE1pbm9yUGFydHNPZlNwZWVjaCB7XG4gIFJPT1QsXG4gIC8vIFZlcmJcbiAgVkIsICAgLy8gdmVyYiwgZ2VuZXJpYyAoZWF0KVxuICBWQkQsICAvLyBwYXN0LXRlbnNlIHZlcmIgKGF0ZSlcbiAgVkJOLCAgLy8gcGFzdC1wYXJ0aWNpcGxlIHZlcmIgKGVhdGVuKVxuICBWQlAsICAvLyBpbmZpbml0aXZlIHZlcmIgKGVhdClcbiAgVkJaLCAgLy8gcHJlc250LXRlbnNlIHZlcmIgKGVhdHMpXG4gIFZCRiwgIC8vIGZ1dHVyZS10ZW5zZSB2ZXJiIChlYXQpXG4gIENQLCAgIC8vIGNvcHVsYSAoaXMsIHdhcywgd2VyZSlcbiAgVkJHLCAgLy8gZ2VydW5kIHZlcmIgKGVhdGluZylcbiAgLy8gQWRqZWN0aXZlXG4gIEpKLCAgIC8vIGFkamVjdGl2ZSwgZ2VuZXJpYyAoYmlnKVxuICBKSlIsICAvLyBjb21wYXJhdGl2ZSBhZGplY3RpdmUgKGJpZ2dlcilcbiAgSkpTLCAgLy8gc3VwZXJsYXRpdmUgYWRqZWN0aXZlIChiaWdnZXN0KVxuICAvLyBBZHZlcmJcbiAgUkIsICAgLy8gYWR2ZXJiLCBnZW5lcmljIChxdWlja2x5KVxuICBSQlIsICAvLyBjb21wYXJhdGl2ZSBhZHZlcmIgKGNvb2xlcilcbiAgUkJTLCAgLy8gc3VwZXJsYXRpdmUgYWR2ZXJiIChjb29sZXN0IChsb29raW5nKSlcbiAgLy8gTm91blxuICBOTiwgICAvLyBub3VuLCBzaW5ndWxhciAoZG9nKSBcbiAgTk5QQSwgLy8gYWNyb255bSAoRkJJKVxuICBOTkFCLCAvLyBhYmJyZXZpYXRpb24gKGpyLilcbiAgTkcsICAgLy8gZ2VydW5kIG5vdW4gKGVhdGluZywgd2lubmluZywgYnV0IHVzZWQgYXMgYSBub3VuKVxuICBQUlAsICAvLyBwZXJzb25hbCBwcm9ub3VuIChJLCB5b3UsIHNoZSlcbiAgUFAsICAgLy8gcG9zc2Vzc2l2ZSBwcm9ub3VuIChteSwgb25lJ3MpXG4gIC8vIExlZ2FjeSBOb3VuXG4gIE5OUCwgIC8vIFNpbmd1bGFyIHByb3BlciBub3VuIChTbWl0aClcbiAgTk5QUywgLy8gUGx1cmFsIHByb3BlciBub3VuIChTbWl0aHMpXG4gIE5OTywgIC8vIFBvc3Nlc3NpdmUgbm91biAocGVvcGxlJ3MpXG4gIE5OUywgIC8vIFBsdXJhbCBub3VuIChwZW9wbGUpXG4gIE5OQSwgIC8vIEBUT0RPIGZpZ3VyZSBvdXQgd2hhdCBOTkEgaXMuXG4gIE5OUSwgIC8vIFF1b3RlZCB0ZXh0XG4gIC8vIEdsdWVcbiAgRlcsICAgLy8gZm9yZWlnbiB3b3JkICh2b2lsYSkgXG4gIElOLCAgIC8vIHByZXBvc2l0aW9uIChvZiwgaW4sIGJ5KVxuICBNRCwgICAvLyBtb2RhbCB2ZXJiIChjYW4sIHNob3VsZClcbiAgQ0MsICAgLy8gY29vcmRpbmF0aW5nIGNvbmp1bmN0aW9uIChhbmQsIGJ1dCwgb3IpXG4gIFBEVCwgIC8vIHByZWRldGVybWluZXIgKHNvbWUsIGFsbCwgYW55KVxuICBEVCwgICAvLyBkZXRlcm1pbmVyICh0aGUpXG4gIFVILCAgIC8vIGludGVyamVjdGlvbiAob2gsIG9vcHMpXG4gIEVYLCAgIC8vIGV4aXN0ZW50aWFsIHRoZXJlICh0aGVyZSlcbiAgLy8gVmFsdWVcbiAgQ0QsICAgLy8gY2FyZGluYWwgdmFsdWUgKG9uZSwgdHdvLCBmaXJzdClcbiAgREEsICAgLy8gZGF0ZSAoanVuZSA1dGggMTk5OClcbiAgTlUsICAgLy8gbnVtYmVyICgxMDAsIG9uZSBodW5kcmVkKVxuICAvLyBTeW1ib2xcbiAgTFQsICAgLy8gU3ltYm9sICg8KVxuICBHVCwgICAvLyBTeW1ib2wgKD4pXG4gIEdURSwgIC8vIFN5bWJvbCAoPj0pXG4gIExURSwgIC8vIFN5bWJvbCAoPD0pXG4gIEVRLCAgIC8vIFN5bWJvbCAoPSlcbiAgTkVRLCAgLy8gU3ltYm9sICghPSlcbiAgUExVUywgLy8gU3VtYm9sICgrKVxuICBNSU5VUywvLyBTdW1ib2wgKC0pXG4gIERJViwgIC8vIFN1bWJvbCAoLylcbiAgTVVMLCAgLy8gU3VtYm9sICgqKVxuICBTRVAsICAvLyBTZXBhcmF0b3IgKCwgOylcbiAgLy8gV2gtIHdvcmRcbiAgV0RULCAgLy8gV2gtZGV0ZXJtaW5lciAodGhhdCB3aGF0IHdoYXRldmVyIHdoaWNoIHdoaWNoZXZlcilcbiAgV1AsICAgLy8gV2gtcHJvbm91biAodGhhdCB3aGF0IHdoYXRldmVyIHdoaWNoIHdobyB3aG9tKVxuICBXUE8sICAvLyBXaC1wcm9ub3VuIHBvc3Nlc3NpdmUgKHdob3NlKVxuICBXUkIgICAvLyBXaC1hZHZlcmIgKGhvd2V2ZXIgd2hlbmV2ZXIgd2hlcmUgd2h5KVxufVxuXG5pbnRlcmZhY2UgVG9rZW4ge1xuICBpeDogbnVtYmVyLFxuICBzdGFydD86IG51bWJlcixcbiAgZW5kPzogbnVtYmVyLFxuICBvcmlnaW5hbFdvcmQ6IHN0cmluZyxcbiAgbm9ybWFsaXplZFdvcmQ6IHN0cmluZyxcbiAgUE9TOiBNaW5vclBhcnRzT2ZTcGVlY2gsXG4gIHByb3BlcnRpZXM6IEFycmF5PFByb3BlcnRpZXM+LFxuICBub2RlPzogTm9kZSxcbiAgcHJldj86IFRva2VuLFxuICBuZXh0PzogVG9rZW4sXG59XG5cbmZ1bmN0aW9uIGNsb25lVG9rZW4odG9rZW46IFRva2VuKTogVG9rZW4ge1xuICBsZXQgY2xvbmU6IFRva2VuID0ge1xuICAgIGl4OiB0b2tlbi5peCxcbiAgICBvcmlnaW5hbFdvcmQ6IHRva2VuLm9yaWdpbmFsV29yZCxcbiAgICBub3JtYWxpemVkV29yZDogdG9rZW4ubm9ybWFsaXplZFdvcmQsXG4gICAgUE9TOiB0b2tlbi5QT1MsXG4gICAgcHJvcGVydGllczogW10sXG4gIH07XG4gIHRva2VuLnByb3BlcnRpZXMubWFwKChwcm9wZXJ0eSkgPT4gY2xvbmUucHJvcGVydGllcy5wdXNoKHByb3BlcnR5KSk7XG4gIHJldHVybiBjbG9uZTtcbn1cblxuZnVuY3Rpb24gbmV3VG9rZW4od29yZDogc3RyaW5nKTogVG9rZW4ge1xuICBsZXQgdG9rZW4gPSB7XG4gICAgaXg6IDAsXG4gICAgb3JpZ2luYWxXb3JkOiB3b3JkLFxuICAgIG5vcm1hbGl6ZWRXb3JkOiB3b3JkLFxuICAgIFBPUzogTWlub3JQYXJ0c09mU3BlZWNoLk5OLFxuICAgIHByb3BlcnRpZXM6IFtdLFxuICB9XG4gIHJldHVybiB0b2tlbjtcbn1cblxuZW51bSBQcm9wZXJ0aWVzIHtcbiAgUk9PVCxcbiAgRU5USVRZLFxuICBDT0xMRUNUSU9OLFxuICBBVFRSSUJVVEUsXG4gIFFVQU5USVRZLFxuICBQUk9QRVIsXG4gIFBMVVJBTCxcbiAgUE9TU0VTU0lWRSxcbiAgQkFDS1JFTEFUSU9OU0hJUCxcbiAgQ09NUEFSQVRJVkUsXG4gIFNVUEVSTEFUSVZFLFxuICBQUk9OT1VOLCAgXG4gIFNFUEFSQVRPUixcbiAgQ09OSlVOQ1RJT04sXG4gIENPTVBPVU5ELFxuICBRVU9URUQsXG4gIEZVTkNUSU9OLFxuICBHUk9VUElORyxcbiAgT1VUUFVULFxuICBJTlBVVCxcbiAgTkVHQVRFUyxcbiAgSU1QTElDSVQsXG4gIEFHR1JFR0FURSxcbiAgQ0FMQ1VMQVRFLFxuICBPUEVSQVRPUixcbn1cblxuLy8gRmluZHMgYSBnaXZlbiBwcm9wZXJ0eSBpbiBhIHRva2VuXG5mdW5jdGlvbiBoYXNQcm9wZXJ0eSh0b2tlbjogVG9rZW4sIHByb3BlcnR5OiBQcm9wZXJ0aWVzKTogYm9vbGVhbiB7XG4gIGxldCBmb3VuZCA9IHRva2VuLnByb3BlcnRpZXMuaW5kZXhPZihwcm9wZXJ0eSk7XG4gIGlmIChmb3VuZCAhPT0gLTEpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuXG4vLyB0YWtlIGFuIGlucHV0IHN0cmluZywgZXh0cmFjdCB0b2tlbnNcbmZ1bmN0aW9uIGZvcm1Ub2tlbnMocHJlVG9rZW5zOiBBcnJheTxQcmVUb2tlbj4pOiBBcnJheTxUb2tlbj4ge1xuICAgIFxuICAgIC8vIEZvcm0gYSB0b2tlbiBmb3IgZWFjaCB3b3JkXG4gICAgbGV0IGN1cnNvclBvcyA9IC0yO1xuICAgIGxldCB0b2tlbnM6IEFycmF5PFRva2VuPiA9IHByZVRva2Vucy5tYXAoKHByZVRva2VuOiBQcmVUb2tlbiwgaTogbnVtYmVyKSA9PiB7XG4gICAgICBsZXQgd29yZCA9IHByZVRva2VuLnRleHQ7XG4gICAgICBsZXQgdGFnID0gcHJlVG9rZW4udGFnO1xuICAgICAgbGV0IHRva2VuOiBUb2tlbiA9IHtcbiAgICAgICAgaXg6IGkrMSwgXG4gICAgICAgIG9yaWdpbmFsV29yZDogd29yZCwgXG4gICAgICAgIG5vcm1hbGl6ZWRXb3JkOiB3b3JkLFxuICAgICAgICBzdGFydDogY3Vyc29yUG9zICs9IDIsXG4gICAgICAgIGVuZDogY3Vyc29yUG9zICs9IHdvcmQubGVuZ3RoIC0gMSxcbiAgICAgICAgUE9TOiBNaW5vclBhcnRzT2ZTcGVlY2hbdGFnXSxcbiAgICAgICAgcHJvcGVydGllczogW10sIFxuICAgICAgfTtcbiAgICAgIGxldCBiZWZvcmUgPSBcIlwiO1xuICAgICAgICAgICBcbiAgICAgIC8vIEFkZCBkZWZhdWx0IGF0dHJpYnV0ZSBtYXJrZXJzIHRvIG5vdW5zXG4gICAgICBpZiAodG9rZW4uUE9TID09PSBNaW5vclBhcnRzT2ZTcGVlY2guTk5PIHx8IFxuICAgICAgICAgIHRva2VuLlBPUyA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLlBQKSB7XG4gICAgICAgIHRva2VuLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLlBPU1NFU1NJVkUpO1xuICAgICAgfVxuICAgICAgaWYgKHRva2VuLlBPUyA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLk5OUCAgfHxcbiAgICAgICAgICB0b2tlbi5QT1MgPT09IE1pbm9yUGFydHNPZlNwZWVjaC5OTlBTIHx8XG4gICAgICAgICAgdG9rZW4uUE9TID09PSBNaW5vclBhcnRzT2ZTcGVlY2guTk5QQSkge1xuICAgICAgICB0b2tlbi5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5QUk9QRVIpO1xuICAgICAgfVxuICAgICAgaWYgKHRva2VuLlBPUyA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLk5OUFMgIHx8XG4gICAgICAgICAgdG9rZW4uUE9TID09PSBNaW5vclBhcnRzT2ZTcGVlY2guTk5TKSB7XG4gICAgICAgIHRva2VuLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLlBMVVJBTCk7XG4gICAgICB9XG4gICAgICBpZiAodG9rZW4uUE9TID09PSBNaW5vclBhcnRzT2ZTcGVlY2guUFAgfHxcbiAgICAgICAgICB0b2tlbi5QT1MgPT09IE1pbm9yUGFydHNPZlNwZWVjaC5QUlApIHtcbiAgICAgICAgdG9rZW4ucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuUFJPTk9VTik7XG4gICAgICB9XG4gICAgICBpZiAodG9rZW4uUE9TID09PSBNaW5vclBhcnRzT2ZTcGVlY2guTk5RKSB7XG4gICAgICAgIHRva2VuLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLlBST1BFUik7XG4gICAgICAgIHRva2VuLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLlFVT1RFRCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIFxuICAgICAgLy8gQWRkIGRlZmF1bHQgcHJvcGVydGllcyB0byBhZGplY3RpdmVzIGFuZCBhZHZlcmJzXG4gICAgICBpZiAodG9rZW4uUE9TID09PSBNaW5vclBhcnRzT2ZTcGVlY2guSkpSIHx8IHRva2VuLlBPUyA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLlJCUikge1xuICAgICAgICB0b2tlbi5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5DT01QQVJBVElWRSk7XG4gICAgICB9XG4gICAgICBlbHNlIGlmICh0b2tlbi5QT1MgPT09IE1pbm9yUGFydHNPZlNwZWVjaC5KSlMgfHwgdG9rZW4uUE9TID09PSBNaW5vclBhcnRzT2ZTcGVlY2guUkJTKSB7ICAgICAgICBcbiAgICAgICAgdG9rZW4ucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuU1VQRVJMQVRJVkUpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBBZGQgZGVmYXVsdCBwcm9wZXJ0aWVzIHRvIHZhbHVlc1xuICAgICAgaWYgKHRva2VuLlBPUyA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLkNEIHx8XG4gICAgICAgICAgdG9rZW4uUE9TID09PSBNaW5vclBhcnRzT2ZTcGVlY2guTlUpIHtcbiAgICAgICAgdG9rZW4ucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuUVVBTlRJVFkpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBBZGQgZGVmYXVsdCBwcm9wZXJ0aWVzIHRvIHNlcGFyYXRvcnNcbiAgICAgIGlmICh0b2tlbi5QT1MgPT09IE1pbm9yUGFydHNPZlNwZWVjaC5DQykge1xuICAgICAgICB0b2tlbi5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5DT05KVU5DVElPTik7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIG5vcm1hbGl6ZSB0aGUgd29yZCB3aXRoIHRoZSBmb2xsb3dpbmcgdHJhbnNmb3JtYXRpb25zOiBcbiAgICAgIC8vIC0tLSBzdHJpcCBwdW5jdHVhdGlvblxuICAgICAgLy8gLS0tIGdldCByaWQgb2YgcG9zc2Vzc2l2ZSBlbmRpbmcgXG4gICAgICAvLyAtLS0gY29udmVydCB0byBsb3dlciBjYXNlXG4gICAgICAvLyAtLS0gc2luZ3VsYXJpemVcbiAgICAgIC8vIElmIHRoZSB3b3JkIGlzIHF1b3RlZFxuICAgICAgaWYgKHRva2VuLlBPUyA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLk5OUSB8fFxuICAgICAgICAgIHRva2VuLlBPUyA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLkNEKSB7XG4gICAgICAgIHRva2VuLm5vcm1hbGl6ZWRXb3JkID0gd29yZDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBub3JtYWxpemVkV29yZCA9IHdvcmQ7XG4gICAgICAgIC8vIC0tLSBzdHJpcCBwdW5jdHVhdGlvblxuICAgICAgICBub3JtYWxpemVkV29yZCA9IG5vcm1hbGl6ZWRXb3JkLnJlcGxhY2UoL1xcLnxcXD98XFwhfC9nLCcnKTtcbiAgICAgICAgLy8gLS0tIGdldCByaWQgb2YgcG9zc2Vzc2l2ZSBlbmRpbmdcbiAgICAgICAgYmVmb3JlID0gbm9ybWFsaXplZFdvcmQ7XG4gICAgICAgIG5vcm1hbGl6ZWRXb3JkID0gbm9ybWFsaXplZFdvcmQucmVwbGFjZSgvJ3N8JyQvLCcnKTtcbiAgICAgICAgLy8gSGV1cmlzdGljOiBJZiB0aGUgd29yZCBoYWQgYSBwb3NzZXNzaXZlIGVuZGluZywgaXQgaGFzIHRvIGJlIGEgcG9zc2Vzc2l2ZSBub3VuIG9mIHNvbWUgc29ydCAgICAgIFxuICAgICAgICBpZiAoYmVmb3JlICE9PSBub3JtYWxpemVkV29yZCkge1xuICAgICAgICAgIGlmIChnZXRNYWpvclBPUyh0b2tlbi5QT1MpICE9PSBNYWpvclBhcnRzT2ZTcGVlY2guTk9VTikge1xuICAgICAgICAgICAgdG9rZW4uUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLk5OO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0b2tlbi5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5QT1NTRVNTSVZFKTtcbiAgICAgICAgfVxuICAgICAgICAvLyAtLS0gY29udmVydCB0byBsb3dlcmNhc2VcbiAgICAgICAgYmVmb3JlID0gbm9ybWFsaXplZFdvcmQ7XG4gICAgICAgIG5vcm1hbGl6ZWRXb3JkID0gbm9ybWFsaXplZFdvcmQudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgLy8gSGV1cmlzdGljOiBpZiB0aGUgd29yZCBpcyBub3QgdGhlIGZpcnN0IHdvcmQgaW4gdGhlIHNlbnRlbmNlIGFuZCBpdCBoYWQgY2FwaXRhbGl6YXRpb24sIHRoZW4gaXQgaXMgcHJvYmFibHkgYSBwcm9wZXIgbm91blxuICAgICAgICBpZiAoYmVmb3JlICE9PSBub3JtYWxpemVkV29yZCAmJiBpICE9PSAwKSB7XG4gICAgICAgICAgdG9rZW4uUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLk5OUDtcbiAgICAgICAgICB0b2tlbi5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5QUk9QRVIpOyAgICAgXG4gICAgICAgIH1cbiAgICAgICAgLy8gLS0tIGlmIHRoZSB3b3JkIGlzIGEgKG5vdCBwcm9wZXIpIG5vdW4gb3IgdmVyYiwgc2luZ3VsYXJpemVcbiAgICAgICAgaWYgKChnZXRNYWpvclBPUyh0b2tlbi5QT1MpID09PSBNYWpvclBhcnRzT2ZTcGVlY2guTk9VTiB8fCBnZXRNYWpvclBPUyh0b2tlbi5QT1MpID09PSBNYWpvclBhcnRzT2ZTcGVlY2guVkVSQikgJiYgIWhhc1Byb3BlcnR5KHRva2VuLFByb3BlcnRpZXMuUFJPUEVSKSkge1xuICAgICAgICAgIGJlZm9yZSA9IG5vcm1hbGl6ZWRXb3JkO1xuICAgICAgICAgIG5vcm1hbGl6ZWRXb3JkID0gc2luZ3VsYXJpemUobm9ybWFsaXplZFdvcmQpO1xuICAgICAgICAgIC8vIEhldXJpc3RpYzogSWYgdGhlIHdvcmQgY2hhbmdlZCBhZnRlciBzaW5ndWxhcml6aW5nIGl0LCB0aGVuIGl0IHdhcyBwbHVyYWwgdG8gYmVnaW4gd2l0aFxuICAgICAgICAgIGlmIChiZWZvcmUgIT09IG5vcm1hbGl6ZWRXb3JkKSB7XG4gICAgICAgICAgICB0b2tlbi5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5QTFVSQUwpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSAgICAgIFxuICAgICAgICB0b2tlbi5ub3JtYWxpemVkV29yZCA9IG5vcm1hbGl6ZWRXb3JkO1xuICAgICAgfVxuXG4gICAgICAgICAgIFxuICAgICAgLy8gSGV1cmlzdGljOiBTcGVjaWFsIGNhc2UgXCJpblwiIGNsYXNzaWZpZWQgYXMgYW4gYWRqZWN0aXZlLiBlLmcuIFwidGhlIGluIGNyb3dkXCIuIFRoaXMgaXMgYW4gdW5jb21tb24gdXNhZ2VcbiAgICAgIGlmICh0b2tlbi5ub3JtYWxpemVkV29yZCA9PT0gXCJpblwiICYmIGdldE1ham9yUE9TKHRva2VuLlBPUykgPT09IE1ham9yUGFydHNPZlNwZWVjaC5BREpFQ1RJVkUpIFxuICAgICAge1xuICAgICAgICB0b2tlbi5QT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guSU47XG4gICAgICB9XG5cbiAgICAgIC8vIEhldXJpc3RpYzogU3BlY2lhbCBjYXNlIHdvcmRzIHdpdGggbm8gYW1iaWd1b3VzIFBPUyB0aGF0IE5MUEMgbWlzY2xhc3NpZmllc1xuICAgICAgc3dpdGNoICh0b2tlbi5ub3JtYWxpemVkV29yZCkge1xuICAgICAgICBjYXNlIFwib2ZcIjpcbiAgICAgICAgICB0b2tlbi5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5CQUNLUkVMQVRJT05TSElQKTsgXG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJwZXJcIjpcbiAgICAgICAgICB0b2tlbi5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5CQUNLUkVMQVRJT05TSElQKTsgXG4gICAgICAgICAgdG9rZW4ucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuR1JPVVBJTkcpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiYWxsXCI6XG4gICAgICAgICAgdG9rZW4uUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLlBEVDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImhhZFwiOlxuICAgICAgICAgIHRva2VuLlBPUyA9IE1pbm9yUGFydHNPZlNwZWVjaC5WQkQ7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJoYXNcIjpcbiAgICAgICAgICB0b2tlbi5QT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guVkJaO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiaXNcIjogXG4gICAgICAgICAgdG9rZW4uUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLkNQO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwid2FzXCI6XG4gICAgICAgICAgdG9rZW4uUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLkNQO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiYXNcIjogXG4gICAgICAgICAgdG9rZW4uUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLkNQO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwid2VyZVwiOlxuICAgICAgICAgIHRva2VuLlBPUyA9IE1pbm9yUGFydHNPZlNwZWVjaC5DUDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcImJlXCI6XG4gICAgICAgICAgdG9rZW4uUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLkNQO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiZG9cIjpcbiAgICAgICAgICB0b2tlbi5QT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guVkJQO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwibm9cIjpcbiAgICAgICAgICB0b2tlbi5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5ORUdBVEVTKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIm5laXRoZXJcIjpcbiAgICAgICAgICB0b2tlbi5QT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guQ0M7XG4gICAgICAgICAgdG9rZW4ucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuTkVHQVRFUyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJub3JcIjpcbiAgICAgICAgICB0b2tlbi5QT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guQ0M7XG4gICAgICAgICAgdG9rZW4ucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuTkVHQVRFUyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJleGNlcHRcIjpcbiAgICAgICAgICB0b2tlbi5QT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guQ0M7XG4gICAgICAgICAgdG9rZW4ucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuTkVHQVRFUyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJ3aXRob3V0XCI6XG4gICAgICAgICAgdG9rZW4uUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLkNDO1xuICAgICAgICAgIHRva2VuLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLk5FR0FURVMpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwibm90XCI6XG4gICAgICAgICAgdG9rZW4uUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLkNDO1xuICAgICAgICAgIHRva2VuLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLk5FR0FURVMpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiYXZlcmFnZVwiOlxuICAgICAgICAgIHRva2VuLlBPUyA9IE1pbm9yUGFydHNPZlNwZWVjaC5OTjtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIm1lYW5cIjpcbiAgICAgICAgICB0b2tlbi5QT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guTk47XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJ0aGVpclwiOlxuICAgICAgICAgIHRva2VuLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLlBMVVJBTCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJtb3N0XCI6XG4gICAgICAgICAgdG9rZW4uUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLkpKUztcbiAgICAgICAgICB0b2tlbi5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5TVVBFUkxBVElWRSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJiZXN0XCI6XG4gICAgICAgICAgdG9rZW4uUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLkpKUztcbiAgICAgICAgICB0b2tlbi5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5TVVBFUkxBVElWRSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJ3aWxsXCI6XG4gICAgICAgICAgLy8gJ3dpbGwnIGNhbiBiZSBhIG5vdW5cbiAgICAgICAgICBpZiAoZ2V0TWFqb3JQT1ModG9rZW4uUE9TKSAhPT0gTWFqb3JQYXJ0c09mU3BlZWNoLk5PVU4pIHtcbiAgICAgICAgICAgIHRva2VuLlBPUyA9IE1pbm9yUGFydHNPZlNwZWVjaC5NRDtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCJ5ZWFyc1wiOlxuICAgICAgICAgIHRva2VuLlBPUyA9IE1pbm9yUGFydHNPZlNwZWVjaC5OTjtcbiAgICAgICAgICB0b2tlbi5ub3JtYWxpemVkV29yZCA9IFwieWVhclwiO1xuICAgICAgICAgIHRva2VuLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLlBMVVJBTCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFNwZWNpYWwgY2FzZSBzeW1ib2xzXG4gICAgICBzd2l0Y2ggKHRva2VuLm5vcm1hbGl6ZWRXb3JkKSB7XG4gICAgICAgIGNhc2UgXCI+XCI6IFxuICAgICAgICAgIHRva2VuLlBPUyA9IE1pbm9yUGFydHNPZlNwZWVjaC5HVDtcbiAgICAgICAgICB0b2tlbi5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5DT01QQVJBVElWRSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCI+PVwiOiBcbiAgICAgICAgICB0b2tlbi5QT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guR1RFO1xuICAgICAgICAgIHRva2VuLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLkNPTVBBUkFUSVZFKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIjxcIjpcbiAgICAgICAgICB0b2tlbi5QT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guTFQ7XG4gICAgICAgICAgdG9rZW4ucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuQ09NUEFSQVRJVkUpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiPD1cIjpcbiAgICAgICAgICB0b2tlbi5QT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guTFRFO1xuICAgICAgICAgIHRva2VuLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLkNPTVBBUkFUSVZFKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIj1cIjpcbiAgICAgICAgICB0b2tlbi5QT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guRVE7XG4gICAgICAgICAgdG9rZW4ucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuQ09NUEFSQVRJVkUpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFwiIT1cIjpcbiAgICAgICAgICB0b2tlbi5QT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guTkVRO1xuICAgICAgICAgIHRva2VuLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLkNPTVBBUkFUSVZFKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIitcIjpcbiAgICAgICAgICB0b2tlbi5QT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guUExVUztcbiAgICAgICAgICB0b2tlbi5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5PUEVSQVRPUik7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCItXCI6XG4gICAgICAgICAgdG9rZW4uUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLk1JTlVTO1xuICAgICAgICAgIHRva2VuLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLk9QRVJBVE9SKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIipcIjpcbiAgICAgICAgICB0b2tlbi5QT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guTVVMO1xuICAgICAgICAgIHRva2VuLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLk9QRVJBVE9SKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIi9cIjpcbiAgICAgICAgICB0b2tlbi5QT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guRElWO1xuICAgICAgICAgIHRva2VuLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLk9QRVJBVE9SKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIixcIjpcbiAgICAgICAgICB0b2tlbi5QT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guU0VQO1xuICAgICAgICAgIHRva2VuLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLlNFUEFSQVRPUik7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgXCI7XCI6XG4gICAgICAgICAgdG9rZW4uUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLlNFUDtcbiAgICAgICAgICB0b2tlbi5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5TRVBBUkFUT1IpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgICAgdG9rZW4ucHJvcGVydGllcyA9IHRva2VuLnByb3BlcnRpZXMuZmlsdGVyKG9ubHlVbmlxdWUpO1xuICAgICAgcmV0dXJuIHRva2VuO1xuICAgIH0pO1xuICAgIFxuICAgIC8vIENvcnJlY3Qgd2gtIHRva2Vuc1xuICAgIGZvciAobGV0IHRva2VuIG9mIHRva2Vucykge1xuICAgICAgaWYgKHRva2VuLm5vcm1hbGl6ZWRXb3JkID09PSBcInRoYXRcIiAgICAgfHwgXG4gICAgICAgICAgdG9rZW4ubm9ybWFsaXplZFdvcmQgPT09IFwid2hhdGV2ZXJcIiB8fFxuICAgICAgICAgIHRva2VuLm5vcm1hbGl6ZWRXb3JkID09PSBcIndoaWNoXCIpIHtcbiAgICAgICAgLy8gZGV0ZXJtaW5lcnMgYmVjb21lIHdoLSBkZXRlcm1pbmVyc1xuICAgICAgICBpZiAodG9rZW4uUE9TID09PSBNaW5vclBhcnRzT2ZTcGVlY2guRFQpIHtcbiAgICAgICAgICB0b2tlbi5QT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guV0RUO1xuICAgICAgICB9XG4gICAgICAgIC8vIHByb25vdW5zIGJlY29tZSB3aC0gcHJvbm91bnNcbiAgICAgICAgZWxzZSBpZiAodG9rZW4uUE9TID09PSBNaW5vclBhcnRzT2ZTcGVlY2guUFJQIHx8IHRva2VuLlBPUyA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLlBQKSB7XG4gICAgICAgICAgdG9rZW4uUE9TID0gTWlub3JQYXJ0c09mU3BlZWNoLldQO1xuICAgICAgICB9XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgLy8gd2hvIGFuZCB3aG9tIGFyZSB3aC0gcHJvbm91bnNcbiAgICAgIGlmICh0b2tlbi5ub3JtYWxpemVkV29yZCA9PT0gXCJ3aG9cIiAgfHwgXG4gICAgICAgICAgdG9rZW4ubm9ybWFsaXplZFdvcmQgPT09IFwid2hhdFwiIHx8XG4gICAgICAgICAgdG9rZW4ubm9ybWFsaXplZFdvcmQgPT09IFwid2hvbVwiKSB7XG4gICAgICAgIHRva2VuLlBPUyA9IE1pbm9yUGFydHNPZlNwZWVjaC5XUDtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICAvLyB3aG9zZSBpcyB0aGUgb25seSB3aC0gcG9zc2Vzc2l2ZSBwcm9ub3VuXG4gICAgICBpZiAodG9rZW4ubm9ybWFsaXplZFdvcmQgPT09IFwid2hvc2VcIikge1xuICAgICAgICB0b2tlbi5QT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guV1BPO1xuICAgICAgICB0b2tlbi5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5QT1NTRVNTSVZFKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICAvLyBhZHZlcmJzIGJlY29tZSB3aC0gYWR2ZXJic1xuICAgICAgaWYgKHRva2VuLm5vcm1hbGl6ZWRXb3JkID09PSBcImhvd1wiICAgICAgfHxcbiAgICAgICAgICB0b2tlbi5ub3JtYWxpemVkV29yZCA9PT0gXCJ3aGVuXCIgICAgIHx8XG4gICAgICAgICAgdG9rZW4ubm9ybWFsaXplZFdvcmQgPT09IFwiaG93ZXZlclwiICB8fCBcbiAgICAgICAgICB0b2tlbi5ub3JtYWxpemVkV29yZCA9PT0gXCJ3aGVuZXZlclwiIHx8XG4gICAgICAgICAgdG9rZW4ubm9ybWFsaXplZFdvcmQgPT09IFwid2hlcmVcIiAgICB8fFxuICAgICAgICAgIHRva2VuLm5vcm1hbGl6ZWRXb3JkID09PSBcIndoeVwiKSB7XG4gICAgICAgIHRva2VuLlBPUyA9IE1pbm9yUGFydHNPZlNwZWVjaC5XUkI7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBTZW50ZW5jZS1sZXZlbCBQT1MgY29ycmVjdGlvbnNcbiAgICAvLyBIZXVyaXN0aWM6IElmIHRoZXJlIGFyZSBubyB2ZXJicyBpbiB0aGUgc2VudGVuY2UsIHRoZXJlIGNhbiBiZSBubyBhZHZlcmJzLiBUdXJuIHRoZW0gaW50byBhZGplY3RpdmVzXG4gICAgbGV0IHZlcmJzID0gdG9rZW5zLmZpbHRlcigodG9rZW46IFRva2VuKSA9PiBnZXRNYWpvclBPUyh0b2tlbi5QT1MpID09PSBNYWpvclBhcnRzT2ZTcGVlY2guVkVSQiApO1xuICAgIGlmICh2ZXJicy5sZW5ndGggPT09IDApIHtcbiAgICAgIGxldCBhZHZlcmJzOiBBcnJheTxUb2tlbj4gPSB0b2tlbnMuZmlsdGVyKCh0b2tlbjogVG9rZW4pID0+IGdldE1ham9yUE9TKHRva2VuLlBPUykgPT09IE1ham9yUGFydHNPZlNwZWVjaC5BRFZFUkIpO1xuICAgICAgYWR2ZXJicy5tYXAoKGFkdmVyYjogVG9rZW4pID0+IGFkdmVyYlRvQWRqZWN0aXZlKGFkdmVyYikpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBIZXVyaXN0aWM6IEFkdmVyYnMgYXJlIGxvY2F0ZWQgY2xvc2UgdG8gdmVyYnNcbiAgICAgIC8vIEdldCB0aGUgZGlzdGFuY2UgZnJvbSBlYWNoIGFkdmVyYiB0byB0aGUgY2xvc2VzdCB2ZXJiIGFzIGEgcGVyY2VudGFnZSBvZiB0aGUgbGVuZ3RoIG9mIHRoZSBzZW50ZW5jZS5cbiAgICAgIGxldCBhZHZlcmJzOiBBcnJheTxUb2tlbj4gPSB0b2tlbnMuZmlsdGVyKCh0b2tlbjogVG9rZW4pID0+IGdldE1ham9yUE9TKHRva2VuLlBPUykgPT09IE1ham9yUGFydHNPZlNwZWVjaC5BRFZFUkIpO1xuICAgICAgYWR2ZXJicy5tYXAoKGFkdmVyYjogVG9rZW4pID0+IHtcbiAgICAgICAgICBsZXQgY2xvc2VzdFZlcmIgPSB0b2tlbnMubGVuZ3RoO1xuICAgICAgICAgIHZlcmJzLm1hcCgodmVyYjogVG9rZW4pID0+IHtcbiAgICAgICAgICAgIGxldCBkaXN0ID0gTWF0aC5hYnMoYWR2ZXJiLml4IC0gdmVyYi5peCk7XG4gICAgICAgICAgICBpZiAoZGlzdCA8IGNsb3Nlc3RWZXJiKSB7XG4gICAgICAgICAgICAgIGNsb3Nlc3RWZXJiID0gZGlzdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICBsZXQgZGlzdFJhdGlvID0gY2xvc2VzdFZlcmIvdG9rZW5zLmxlbmd0aDtcbiAgICAgICAgICAvLyBUaHJlc2hvbGQgdGhlIGRpc3RhbmNlIGFuIGFkdmVyYiBjYW4gYmUgZnJvbSB0aGUgdmVyYlxuICAgICAgICAgIC8vIGlmIGl0IGlzIHRvbyBmYXIsIG1ha2UgaXQgYW4gYWRqZWN0aXZlIGluc3RlYWRcbiAgICAgICAgICBpZiAoZGlzdFJhdGlvID4gLjI1KSB7XG4gICAgICAgICAgICBhZHZlcmJUb0FkamVjdGl2ZShhZHZlcmIpO1xuICAgICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICBsZXQgcm9vdFRva2VuID0ge1xuICAgICAgaXg6IDAsIFxuICAgICAgb3JpZ2luYWxXb3JkOiB0b2tlbnMubWFwKCh0b2tlbikgPT4gdG9rZW4ub3JpZ2luYWxXb3JkKS5qb2luKFwiIFwiKSwgXG4gICAgICBub3JtYWxpemVkV29yZDogdG9rZW5zLm1hcCgodG9rZW4pID0+IHRva2VuLm5vcm1hbGl6ZWRXb3JkKS5qb2luKFwiIFwiKSwgXG4gICAgICBQT1M6IE1pbm9yUGFydHNPZlNwZWVjaC5ST09ULFxuICAgICAgcHJvcGVydGllczogW1Byb3BlcnRpZXMuUk9PVF0sIFxuICAgIH07XG4gICAgXG4gICAgdG9rZW5zID0gW3Jvb3RUb2tlbl0uY29uY2F0KHRva2Vucyk7XG4gICAgXG4gICAgLy8gTGluayB0b2tlbnMgdG8gZWFjaG90aGVyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b2tlbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCB0b2tlbiA9IHRva2Vuc1tpXTtcbiAgICAgIHRva2VuLnByZXYgPSB0b2tlbnNbaSAtIDFdO1xuICAgICAgdG9rZW4ubmV4dCA9IHRva2Vuc1tpICsgMV07XG4gICAgfVxuICAgIFxuICAgIGxvZyh0b2tlbkFycmF5VG9TdHJpbmcodG9rZW5zKSk7XG4gICAgXG4gICAgcmV0dXJuIHRva2Vucztcbn1cblxuZnVuY3Rpb24gYWR2ZXJiVG9BZGplY3RpdmUodG9rZW46IFRva2VuKTogVG9rZW4ge1xuICBsZXQgd29yZCA9IHRva2VuLm5vcm1hbGl6ZWRXb3JkO1xuICAvLyBIZXVyaXN0aWM6IFdvcmRzIHRoYXQgZW5kIGluIC1lc3QgYXJlIHN1cGVybGF0aXZlXG4gIGlmICh3b3JkLnN1YnN0cih3b3JkLmxlbmd0aC0zLHdvcmQubGVuZ3RoKSA9PT0gXCJlc3RcIikge1xuICAgIHRva2VuLlBPUyA9IE1pbm9yUGFydHNPZlNwZWVjaC5KSlM7XG4gICAgdG9rZW4ucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuU1VQRVJMQVRJVkUpO1xuICAvLyBIZXVyaXN0aWM6IFdvcmRzIHRoYXQgZW5kIGluIC1lciBhcmUgY29tYXByYXRpdmVcbiAgfSBlbHNlIGlmICh3b3JkLnN1YnN0cih3b3JkLmxlbmd0aC0yLHdvcmQubGVuZ3RoKSA9PT0gXCJlclwiKXtcbiAgICB0b2tlbi5QT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guSkpSO1xuICAgIHRva2VuLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLkNPTVBBUkFUSVZFKTtcbiAgfSBlbHNlIHtcbiAgICB0b2tlbi5QT1MgPSBNaW5vclBhcnRzT2ZTcGVlY2guSko7XG4gIH0gIFxuICByZXR1cm4gdG9rZW47XG59XG5cbmZ1bmN0aW9uIGdldE1ham9yUE9TKG1pbm9yUGFydE9mU3BlZWNoOiBNaW5vclBhcnRzT2ZTcGVlY2gpOiBNYWpvclBhcnRzT2ZTcGVlY2gge1xuICAvLyBST09UXG4gIGlmIChtaW5vclBhcnRPZlNwZWVjaCA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLlJPT1QpIHtcbiAgICByZXR1cm4gTWFqb3JQYXJ0c09mU3BlZWNoLlJPT1Q7XG4gIH1cbiAgLy8gVmVyYlxuICBpZiAobWlub3JQYXJ0T2ZTcGVlY2ggPT09IE1pbm9yUGFydHNPZlNwZWVjaC5WQiAgfHxcbiAgICAgIG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guVkJEIHx8XG4gICAgICBtaW5vclBhcnRPZlNwZWVjaCA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLlZCTiB8fFxuICAgICAgbWlub3JQYXJ0T2ZTcGVlY2ggPT09IE1pbm9yUGFydHNPZlNwZWVjaC5WQlAgfHxcbiAgICAgIG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guVkJaIHx8XG4gICAgICBtaW5vclBhcnRPZlNwZWVjaCA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLlZCRiB8fFxuICAgICAgbWlub3JQYXJ0T2ZTcGVlY2ggPT09IE1pbm9yUGFydHNPZlNwZWVjaC5WQkcpIHtcbiAgICAgICAgcmV0dXJuIE1ham9yUGFydHNPZlNwZWVjaC5WRVJCO1xuICB9XG4gIC8vIEFkamVjdGl2ZVxuICBpZiAobWlub3JQYXJ0T2ZTcGVlY2ggPT09IE1pbm9yUGFydHNPZlNwZWVjaC5KSiAgfHxcbiAgICAgIG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guSkpSIHx8XG4gICAgICBtaW5vclBhcnRPZlNwZWVjaCA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLkpKUykge1xuICAgICAgICByZXR1cm4gTWFqb3JQYXJ0c09mU3BlZWNoLkFESkVDVElWRTtcbiAgfVxuICAvLyBBZGp2ZXJiXG4gIGlmIChtaW5vclBhcnRPZlNwZWVjaCA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLlJCICB8fFxuICAgICAgbWlub3JQYXJ0T2ZTcGVlY2ggPT09IE1pbm9yUGFydHNPZlNwZWVjaC5SQlIgfHxcbiAgICAgIG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guUkJTKSB7XG4gICAgICAgIHJldHVybiBNYWpvclBhcnRzT2ZTcGVlY2guQURWRVJCO1xuICB9XG4gIC8vIE5vdW5cbiAgaWYgKG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guTk4gICB8fFxuICAgICAgbWlub3JQYXJ0T2ZTcGVlY2ggPT09IE1pbm9yUGFydHNPZlNwZWVjaC5OTkEgIHx8XG4gICAgICBtaW5vclBhcnRPZlNwZWVjaCA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLk5OUEEgfHxcbiAgICAgIG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guTk5BQiB8fFxuICAgICAgbWlub3JQYXJ0T2ZTcGVlY2ggPT09IE1pbm9yUGFydHNPZlNwZWVjaC5OTlAgIHx8XG4gICAgICBtaW5vclBhcnRPZlNwZWVjaCA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLk5OUFMgfHxcbiAgICAgIG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guTk5TICB8fFxuICAgICAgbWlub3JQYXJ0T2ZTcGVlY2ggPT09IE1pbm9yUGFydHNPZlNwZWVjaC5OTlEgIHx8XG4gICAgICBtaW5vclBhcnRPZlNwZWVjaCA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLk5OTyAgfHxcbiAgICAgIG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guTkcgICB8fFxuICAgICAgbWlub3JQYXJ0T2ZTcGVlY2ggPT09IE1pbm9yUGFydHNPZlNwZWVjaC5QUlAgIHx8XG4gICAgICBtaW5vclBhcnRPZlNwZWVjaCA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLlBQKSB7XG4gICAgICAgIHJldHVybiBNYWpvclBhcnRzT2ZTcGVlY2guTk9VTjtcbiAgfVxuICAvLyBWYWx1ZVxuICBpZiAobWlub3JQYXJ0T2ZTcGVlY2ggPT09IE1pbm9yUGFydHNPZlNwZWVjaC5DRCB8fFxuICAgICAgbWlub3JQYXJ0T2ZTcGVlY2ggPT09IE1pbm9yUGFydHNPZlNwZWVjaC5EQSB8fFxuICAgICAgbWlub3JQYXJ0T2ZTcGVlY2ggPT09IE1pbm9yUGFydHNPZlNwZWVjaC5OVSkge1xuICAgICAgICByZXR1cm4gTWFqb3JQYXJ0c09mU3BlZWNoLlZBTFVFO1xuICB9XG4gIC8vIEdsdWVcbiAgaWYgKG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guRlcgIHx8XG4gICAgICBtaW5vclBhcnRPZlNwZWVjaCA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLklOICB8fFxuICAgICAgbWlub3JQYXJ0T2ZTcGVlY2ggPT09IE1pbm9yUGFydHNPZlNwZWVjaC5DUCAgfHxcbiAgICAgIG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guTUQgIHx8XG4gICAgICBtaW5vclBhcnRPZlNwZWVjaCA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLkNDICB8fFxuICAgICAgbWlub3JQYXJ0T2ZTcGVlY2ggPT09IE1pbm9yUGFydHNPZlNwZWVjaC5QRFQgfHxcbiAgICAgIG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guRFQgIHx8XG4gICAgICBtaW5vclBhcnRPZlNwZWVjaCA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLlVIICB8fFxuICAgICAgbWlub3JQYXJ0T2ZTcGVlY2ggPT09IE1pbm9yUGFydHNPZlNwZWVjaC5FWCkge1xuICAgICAgICByZXR1cm4gTWFqb3JQYXJ0c09mU3BlZWNoLkdMVUU7XG4gIH0gIFxuICAvLyBTeW1ib2xcbiAgaWYgKG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guTFQgICAgfHxcbiAgICAgIG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guR1QgICAgfHxcbiAgICAgIG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guR1RFICAgfHxcbiAgICAgIG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guTFRFICAgfHxcbiAgICAgIG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guRVEgICAgfHxcbiAgICAgIG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guTkVRICAgfHxcbiAgICAgIG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guUExVUyAgfHxcbiAgICAgIG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guTUlOVVMgfHxcbiAgICAgIG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guRElWICAgfHxcbiAgICAgIG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guTVVMICAgfHxcbiAgICAgIG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guU0VQKSB7XG4gICAgICAgIHJldHVybiBNYWpvclBhcnRzT2ZTcGVlY2guU1lNQk9MO1xuICB9XG4gIC8vIFdoLVdvcmRcbiAgaWYgKG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guV0RUIHx8XG4gICAgICBtaW5vclBhcnRPZlNwZWVjaCA9PT0gTWlub3JQYXJ0c09mU3BlZWNoLldQICB8fFxuICAgICAgbWlub3JQYXJ0T2ZTcGVlY2ggPT09IE1pbm9yUGFydHNPZlNwZWVjaC5XUE8gfHxcbiAgICAgIG1pbm9yUGFydE9mU3BlZWNoID09PSBNaW5vclBhcnRzT2ZTcGVlY2guV1JCKSB7XG4gICAgICAgIHJldHVybiBNYWpvclBhcnRzT2ZTcGVlY2guV0hXT1JEO1xuICB9XG59XG5cbi8vIFdyYXAgcGx1cmFsaXplIHRvIHNwZWNpYWwgY2FzZSBjZXJ0YWluIHdvcmRzIGl0IGdldHMgd3JvbmdcbmZ1bmN0aW9uIHNpbmd1bGFyaXplKHdvcmQ6IHN0cmluZyk6IHN0cmluZyB7XG4gIGxldCBzcGVjaWFsQ2FzZXMgPSBbXCJoaXNcIiwgXCJ0aW1lc1wiLCBcImhhc1wiLCBcImRvd25zdGFpcnNcIiwgXCJ1bml0ZWQgc3RhdGVzXCIsIFwiaXRzXCJdO1xuICBmb3IgKGxldCBzcGVjaWFsQ2FzZSBvZiBzcGVjaWFsQ2FzZXMpIHtcbiAgICBpZiAoc3BlY2lhbENhc2UgPT09IHdvcmQpIHtcbiAgICAgIHJldHVybiB3b3JkO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcGx1cmFsaXplKHdvcmQsIDEpO1xufVxuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBUcmVlIGZ1bmN0aW9uc1xuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5pbnRlcmZhY2UgTm9kZSB7XG4gIGl4OiBudW1iZXIsXG4gIG5hbWU6IHN0cmluZyxcbiAgcGFyZW50OiBOb2RlLFxuICBjaGlsZHJlbjogQXJyYXk8Tm9kZT4sXG4gIGVudGl0eT86IEVudGl0eSxcbiAgY29sbGVjdGlvbj86IENvbGxlY3Rpb24sXG4gIGF0dHJpYnV0ZT86IEF0dHJpYnV0ZSxcbiAgZnhuPzogQnVpbHRJbkZ1bmN0aW9uLFxuICBjb25zdGl0dWVudHM/OiBBcnJheTxOb2RlPixcbiAgdG9rZW46IFRva2VuLFxuICBmb3VuZDogYm9vbGVhbixcbiAgcHJvcGVydGllczogQXJyYXk8UHJvcGVydGllcz4sXG4gIGhhc1Byb3BlcnR5KFByb3BlcnRpZXMpOiBib29sZWFuO1xuICB0b1N0cmluZyhudW1iZXI/OiBudW1iZXIpOiBzdHJpbmc7XG4gIG5leHQoKTogTm9kZTtcbiAgcHJldigpOiBOb2RlO1xuICBhZGRDaGlsZChub2RlOiBOb2RlKTogdm9pZDtcbn1cblxuZnVuY3Rpb24gY2xvbmVOb2RlKG5vZGU6IE5vZGUpOiBOb2RlIHtcbiAgbGV0IHRva2VuID0gY2xvbmVUb2tlbihub2RlLnRva2VuKTtcbiAgbGV0IGNsb25lTm9kZSA9IG5ld05vZGUodG9rZW4pO1xuICBjbG9uZU5vZGUuZW50aXR5ID0gbm9kZS5lbnRpdHk7XG4gIGNsb25lTm9kZS5jb2xsZWN0aW9uID0gbm9kZS5jb2xsZWN0aW9uO1xuICBjbG9uZU5vZGUuYXR0cmlidXRlID0gbm9kZS5hdHRyaWJ1dGU7XG4gIGNsb25lTm9kZS5meG4gPSBub2RlLmZ4bjtcbiAgY2xvbmVOb2RlLmZvdW5kID0gbm9kZS5mb3VuZDtcbiAgbm9kZS5wcm9wZXJ0aWVzLm1hcCgocHJvcGVydHkpID0+IGNsb25lTm9kZS5wcm9wZXJ0aWVzLnB1c2gocHJvcGVydHkpKTtcbiAgcmV0dXJuIGNsb25lTm9kZTtcbn1cblxuZnVuY3Rpb24gbmV3Tm9kZSh0b2tlbjogVG9rZW4pOiBOb2RlIHtcbiAgbGV0IG5vZGU6IE5vZGUgPSB7XG4gICAgaXg6IHRva2VuLml4LFxuICAgIG5hbWU6IHRva2VuLm5vcm1hbGl6ZWRXb3JkLFxuICAgIHBhcmVudDogdW5kZWZpbmVkLFxuICAgIGNoaWxkcmVuOiBbXSxcbiAgICB0b2tlbjogdG9rZW4sIFxuICAgIHByb3BlcnRpZXM6IHRva2VuLnByb3BlcnRpZXMsXG4gICAgZm91bmQ6IGZhbHNlLFxuICAgIGhhc1Byb3BlcnR5OiBoYXNQcm9wZXJ0eSxcbiAgICB0b1N0cmluZzogbm9kZVRvU3RyaW5nLFxuICAgIG5leHQ6IG5leHROb2RlLFxuICAgIHByZXY6IHByZXZpb3VzTm9kZSxcbiAgICBhZGRDaGlsZDogYWRkQ2hpbGQsXG4gIH07XG4gIHRva2VuLm5vZGUgPSBub2RlO1xuICBmdW5jdGlvbiBoYXNQcm9wZXJ0eShwcm9wZXJ0eTogUHJvcGVydGllcyk6IGJvb2xlYW4ge1xuICBsZXQgZm91bmQgPSBub2RlLnByb3BlcnRpZXMuaW5kZXhPZihwcm9wZXJ0eSk7XG4gIGlmIChmb3VuZCAhPT0gLTEpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIGZ1bmN0aW9uIG5leHROb2RlKCk6IE5vZGUge1xuICAgIGxldCB0b2tlbiA9IG5vZGUudG9rZW47XG4gICAgbGV0IG5leHRUb2tlbiA9IHRva2VuLm5leHQ7XG4gICAgaWYgKG5leHRUb2tlbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gbmV4dFRva2VuLm5vZGU7XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbiAgZnVuY3Rpb24gcHJldmlvdXNOb2RlKCk6IE5vZGUge1xuICAgIGxldCB0b2tlbiA9IG5vZGUudG9rZW47XG4gICAgbGV0IHByZXZUb2tlbiA9IHRva2VuLnByZXY7XG4gICAgaWYgKHByZXZUb2tlbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gcHJldlRva2VuLm5vZGU7XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbiAgZnVuY3Rpb24gYWRkQ2hpbGQobmV3Q2hpbGQ6IE5vZGUpOiB2b2lkIHtcbiAgICBub2RlLmNoaWxkcmVuLnB1c2gobmV3Q2hpbGQpO1xuICAgIG5ld0NoaWxkLnBhcmVudCA9IG5vZGU7XG4gIH1cbiAgZnVuY3Rpb24gbm9kZVRvU3RyaW5nKGRlcHRoPzogbnVtYmVyKTogc3RyaW5nIHtcbiAgICBpZiAoZGVwdGggPT09IHVuZGVmaW5lZCkge1xuICAgICAgZGVwdGggPSAwO1xuICAgIH1cbiAgICBsZXQgY2hpbGRyZW5TdHJpbmdzID0gbm9kZS5jaGlsZHJlbi5tYXAoKGNoaWxkTm9kZSkgPT4gY2hpbGROb2RlLnRvU3RyaW5nKGRlcHRoKzEpKS5qb2luKFwiXFxuXCIpO1xuICAgIGxldCBjaGlsZHJlbiA9IGNoaWxkcmVuU3RyaW5ncy5sZW5ndGggPiAwID8gXCJcXG5cIiArIGNoaWxkcmVuU3RyaW5ncyA6IFwiXCI7XG4gICAgbGV0IGluZGVudCA9IEFycmF5KGRlcHRoKzEpLmpvaW4oXCIgXCIpO1xuICAgIGxldCBpbmRleCA9IG5vZGUuaXggPT09IHVuZGVmaW5lZCA/IFwiKyBcIiA6IGAke25vZGUuaXh9OiBgO1xuICAgIGxldCBwcm9wZXJ0aWVzID0gbm9kZS5wcm9wZXJ0aWVzLmxlbmd0aCA9PT0gMCA/IFwiXCIgOiBgKCR7bm9kZS5wcm9wZXJ0aWVzLm1hcCgocHJvcGVydHk6IFByb3BlcnRpZXMpID0+IFByb3BlcnRpZXNbcHJvcGVydHldKS5qb2luKFwifFwiKX0pYDtcbiAgICBsZXQgYXR0cmlidXRlID0gbm9kZS5hdHRyaWJ1dGUgPT09IHVuZGVmaW5lZCA/IFwiXCIgOiBgWyR7bm9kZS5hdHRyaWJ1dGUudmFyaWFibGV9ICgke25vZGUuYXR0cmlidXRlLnZhbHVlfSldIGA7XG4gICAgbGV0IGVudGl0eSA9IG5vZGUuZW50aXR5ID09PSB1bmRlZmluZWQgPyBcIlwiIDogYFske25vZGUuZW50aXR5LmRpc3BsYXlOYW1lfV0gYDtcbiAgICBsZXQgY29sbGVjdGlvbiA9IG5vZGUuY29sbGVjdGlvbiA9PT0gdW5kZWZpbmVkID8gXCJcIiA6IGBbJHtub2RlLmNvbGxlY3Rpb24uZGlzcGxheU5hbWV9XSBgO1xuICAgIGxldCBmeG4gPSBub2RlLmZ4biA9PT0gdW5kZWZpbmVkID8gXCJcIiA6IGBbJHtub2RlLmZ4bi5uYW1lfV0gYDtcbiAgICBsZXQgbmVnYXRlZCA9IG5vZGUuaGFzUHJvcGVydHkoUHJvcGVydGllcy5ORUdBVEVTKSA/IFwiIVwiIDogXCJcIjtcbiAgICBsZXQgZm91bmQgPSBub2RlLmZvdW5kID8gXCIqXCIgOiBcIiBcIjtcbiAgICBsZXQgZW50aXR5T3JQcm9wZXJ0aWVzID0gZm91bmQgPT09IFwiIFwiID8gYCR7cHJvcGVydGllc31gIDogYCR7bmVnYXRlZH0ke2Z4bn0ke2VudGl0eX0ke2NvbGxlY3Rpb259JHthdHRyaWJ1dGV9YDtcbiAgICBwcm9wZXJ0aWVzID0gcHJvcGVydGllcy5sZW5ndGggPT09IDIgPyBcIlwiIDogcHJvcGVydGllcztcbiAgICBsZXQgbm9kZVN0cmluZyA9IGB8JHtmb3VuZH0ke2luZGVudH0ke2luZGV4fSR7bm9kZS5uYW1lfSAke2VudGl0eU9yUHJvcGVydGllc30ke2NoaWxkcmVufWA7IFxuICAgIHJldHVybiBub2RlU3RyaW5nO1xuICB9XG4gIHJldHVybiBub2RlOyAgXG59XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBWYXJpb3VzIG5vZGUgbWFuaXB1bGF0aW9uIGZ1bmN0aW9uc1xuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuLy8gUmVtb3ZlcyB0aGUgbm9kZSBhbmQgaXRzIGNoaWxkcmVuIGZyb20gdGhlIHRyZWUsIFxuLy8gYW5kIG1ha2VzIGl0IGEgY2hpbGQgb2YgdGhlIHRhcmdldCBub2RlXG5mdW5jdGlvbiByZXJvb3Qobm9kZTogTm9kZSwgdGFyZ2V0OiBOb2RlKTogdm9pZCB7XG4gIG5vZGUucGFyZW50LmNoaWxkcmVuLnNwbGljZShub2RlLnBhcmVudC5jaGlsZHJlbi5pbmRleE9mKG5vZGUpLDEpOyAgXG4gIHRhcmdldC5hZGRDaGlsZChub2RlKTtcbn1cblxuLy8gUmVtb3ZlcyBhIG5vZGUgZnJvbSB0aGUgdHJlZVxuLy8gVGhlIG5vZGUncyBjaGlsZHJlbiBnZXQgYWRkZWQgdG8gaXRzIHBhcmVudFxuLy8gcmV0dXJucyB0aGUgbm9kZSBvciB1bmRlZmluZWQgaWYgdGhlIG9wZXJhdGlvbiBmYWlsZWRcbmZ1bmN0aW9uIHJlbW92ZU5vZGUobm9kZTogTm9kZSk6IE5vZGUge1xuICBpZiAobm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLlJPT1QpKSB7XG4gICAgcmV0dXJuIG5vZGU7XG4gIH1cbiAgaWYgKG5vZGUucGFyZW50ID09PSB1bmRlZmluZWQgJiYgbm9kZS5jaGlsZHJlbi5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gbm9kZTtcbiAgfVxuICBsZXQgcGFyZW50OiBOb2RlID0gbm9kZS5wYXJlbnQ7XG4gIGxldCBjaGlsZHJlbjogQXJyYXk8Tm9kZT4gPSBub2RlLmNoaWxkcmVuO1xuICAvLyBSZXdpcmVcbiAgcGFyZW50LmNoaWxkcmVuID0gcGFyZW50LmNoaWxkcmVuLmNvbmNhdChjaGlsZHJlbik7XG4gIHBhcmVudC5jaGlsZHJlbi5zb3J0KChhLGIpID0+IGEuaXggLSBiLml4KTtcbiAgY2hpbGRyZW4ubWFwKChjaGlsZCkgPT4gY2hpbGQucGFyZW50ID0gcGFyZW50KTtcbiAgLy8gR2V0IHJpZCBvZiByZWZlcmVuY2VzIG9uIGN1cnJlbnQgbm9kZVxuICBwYXJlbnQuY2hpbGRyZW4uc3BsaWNlKHBhcmVudC5jaGlsZHJlbi5pbmRleE9mKG5vZGUpLDEpO1xuICBub2RlLnBhcmVudCA9IHVuZGVmaW5lZDtcbiAgbm9kZS5jaGlsZHJlbiA9IFtdO1xuICByZXR1cm4gbm9kZTtcbn1cblxuXG4vLyBSZXR1cm5zIHRoZSBmaXJzdCBhbmNlc3RvciBub2RlIHRoYXQgaGFzIGJlZW4gZm91bmRcbmZ1bmN0aW9uIHByZXZpb3VzbHlNYXRjaGVkKG5vZGU6IE5vZGUsIGlnbm9yZUZ1bmN0aW9ucz86IGJvb2xlYW4pOiBOb2RlIHtcbiAgaWYgKGlnbm9yZUZ1bmN0aW9ucyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgaWdub3JlRnVuY3Rpb25zID0gZmFsc2U7XG4gIH1cbiAgaWYgKG5vZGUucGFyZW50ID09PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9IGVsc2UgaWYgKCFpZ25vcmVGdW5jdGlvbnMgJiYgbm9kZS5wYXJlbnQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5GVU5DVElPTikgJiYgIW5vZGUucGFyZW50Lmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuQ09OSlVOQ1RJT04pKSAge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH0gZWxzZSBpZiAobm9kZS5wYXJlbnQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5FTlRJVFkpIHx8XG4gICAgICAgICAgICAgbm9kZS5wYXJlbnQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5BVFRSSUJVVEUpIHx8XG4gICAgICAgICAgICAgbm9kZS5wYXJlbnQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5DT0xMRUNUSU9OKSkge1xuICAgIHJldHVybiBub2RlLnBhcmVudDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcHJldmlvdXNseU1hdGNoZWQobm9kZS5wYXJlbnQsaWdub3JlRnVuY3Rpb25zKTtcbiAgfVxufVxuXG4vLyBSZXR1cm5zIHRoZSBmaXJzdCBhbmNlc3RvciBub2RlIHRoYXQgaGFzIGJlZW4gZm91bmRcbmZ1bmN0aW9uIHByZXZpb3VzbHlNYXRjaGVkRW50aXR5T3JDb2xsZWN0aW9uKG5vZGU6IE5vZGUsIGlnbm9yZUZ1bmN0aW9ucz86IGJvb2xlYW4pOiBOb2RlIHtcbiAgaWYgKGlnbm9yZUZ1bmN0aW9ucyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgaWdub3JlRnVuY3Rpb25zID0gZmFsc2U7XG4gIH1cbiAgaWYgKG5vZGUucGFyZW50ID09PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9IGVsc2UgaWYgKCFpZ25vcmVGdW5jdGlvbnMgJiYgbm9kZS5wYXJlbnQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5GVU5DVElPTikgJiYgIW5vZGUucGFyZW50Lmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuQ09OSlVOQ1RJT04pKSAge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH0gZWxzZSBpZiAobm9kZS5wYXJlbnQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5FTlRJVFkpIHx8XG4gICAgICAgICAgICAgbm9kZS5wYXJlbnQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5DT0xMRUNUSU9OKSkge1xuICAgIHJldHVybiBub2RlLnBhcmVudDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcHJldmlvdXNseU1hdGNoZWRFbnRpdHlPckNvbGxlY3Rpb24obm9kZS5wYXJlbnQsaWdub3JlRnVuY3Rpb25zKTtcbiAgfVxufVxuXG4vLyBJbnNlcnRzIGEgbm9kZSBhZnRlciB0aGUgdGFyZ2V0LCBtb3ZpbmcgYWxsIG9mIHRoZVxuLy8gdGFyZ2V0J3MgY2hpbGRyZW4gdG8gdGhlIG5vZGVcbi8vIEJlZm9yZTogW1RhcmdldF0gLT4gW0NoaWxkcmVuXVxuLy8gQWZ0ZXI6ICBbVGFyZ2V0XSAtPiBbTm9kZV0gLT4gW0NoaWxkcmVuXVxuZnVuY3Rpb24gaW5zZXJ0QWZ0ZXJOb2RlKG5vZGU6IE5vZGUsIHRhcmdldDogTm9kZSk6IHZvaWQge1xuICBub2RlLnBhcmVudCA9IHRhcmdldDtcbiAgbm9kZS5jaGlsZHJlbiA9IHRhcmdldC5jaGlsZHJlbjtcbiAgdGFyZ2V0LmNoaWxkcmVuLm1hcCgobikgPT4gbi5wYXJlbnQgPSBub2RlKTtcbiAgdGFyZ2V0LmNoaWxkcmVuID0gW25vZGVdO1xufVxuXG4vLyBGaW5kIGFsbCBsZWFmIG5vZGVzIHN0ZW1taW5nIGZyb20gYSBnaXZlbiBub2RlXG5mdW5jdGlvbiBmaW5kTGVhZk5vZGVzKG5vZGU6IE5vZGUpOiBBcnJheTxOb2RlPiB7XG4gIGlmKG5vZGUuY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIFtub2RlXTtcbiAgfVxuICBlbHNlIHtcbiAgICBsZXQgZm91bmRMZWFmcyA9IG5vZGUuY2hpbGRyZW4ubWFwKGZpbmRMZWFmTm9kZXMpO1xuICAgIGxldCBmbGF0TGVhZnMgPSBmbGF0dGVuTmVzdGVkQXJyYXkoZm91bmRMZWFmcyk7XG4gICAgcmV0dXJuIGZsYXRMZWFmcztcbiAgfVxufSBcblxuLypmdW5jdGlvbiBtb3ZlTm9kZShub2RlOiBOb2RlLCB0YXJnZXQ6IE5vZGUpOiB2b2lkIHtcbiAgaWYgKG5vZGUuaGFzUHJvcGVydHkoUHJvcGVydGllcy5ST09UKSkge1xuICAgIHJldHVybjtcbiAgfVxuICBsZXQgcGFyZW50ID0gbm9kZS5wYXJlbnQ7XG4gIHBhcmVudC5jaGlsZHJlbi5zcGxpY2UocGFyZW50LmNoaWxkcmVuLmluZGV4T2Yobm9kZSksMSk7XG4gIHBhcmVudC5jaGlsZHJlbiA9IHBhcmVudC5jaGlsZHJlbi5jb25jYXQobm9kZS5jaGlsZHJlbik7XG4gIG5vZGUuY2hpbGRyZW4ubWFwKChjaGlsZCkgPT4gY2hpbGQucGFyZW50ID0gcGFyZW50KTtcbiAgbm9kZS5jaGlsZHJlbiA9IFtdO1xuICBub2RlLnBhcmVudCA9IHRhcmdldDtcbiAgdGFyZ2V0LmNoaWxkcmVuLnB1c2gobm9kZSk7XG59Ki9cblxuLy8gRmluZHMgYSBwYXJlbnQgbm9kZSB3aXRoIHRoZSBzcGVjaWZpZWQgcHJvcGVydHksIFxuLy8gcmV0dXJucyB1bmRlZmluZWQgaWYgbm8gbm9kZSB3YXMgZm91bmRcbmZ1bmN0aW9uIGZpbmRQYXJlbnRXaXRoUHJvcGVydHkobm9kZTogTm9kZSwgcHJvcGVydHk6IFByb3BlcnRpZXMpOiBOb2RlIHtcbiAgaWYgKG5vZGUuaGFzUHJvcGVydHkoUHJvcGVydGllcy5ST09UKSkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbiAgaWYgKG5vZGUucGFyZW50Lmhhc1Byb3BlcnR5KHByb3BlcnR5KSkge1xuICAgIHJldHVybiBub2RlLnBhcmVudDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gZmluZFBhcmVudFdpdGhQcm9wZXJ0eShub2RlLnBhcmVudCxwcm9wZXJ0eSk7XG4gIH0gXG59XG5cbi8vIEZpbmRzIGEgcGFyZW50IG5vZGUgd2l0aCB0aGUgc3BlY2lmaWVkIHByb3BlcnR5LCBcbi8vIHJldHVybnMgdW5kZWZpbmVkIGlmIG5vIG5vZGUgd2FzIGZvdW5kXG5mdW5jdGlvbiBmaW5kQ2hpbGRXaXRoUHJvcGVydHkobm9kZTogTm9kZSwgcHJvcGVydHk6IFByb3BlcnRpZXMpOiBOb2RlIHtcbiAgaWYgKG5vZGUuY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuICBpZiAobm9kZS5oYXNQcm9wZXJ0eShwcm9wZXJ0eSkpIHtcbiAgICByZXR1cm4gbm9kZTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgY2hpbGRyZW5XaXRoUHJvcGVydHkgPSBub2RlLmNoaWxkcmVuLmZpbHRlcigoY2hpbGQpID0+IGNoaWxkLmhhc1Byb3BlcnR5KHByb3BlcnR5KSk7XG4gICAgaWYgKGNoaWxkcmVuV2l0aFByb3BlcnR5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBjaGlsZHJlbldpdGhQcm9wZXJ0eVswXTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IHJlc3VsdHMgPSBub2RlLmNoaWxkcmVuLm1hcCgoY2hpbGQpID0+IGZpbmRDaGlsZFdpdGhQcm9wZXJ0eShjaGlsZCxwcm9wZXJ0eSkpLmZpbHRlcigocmVzdWx0KSA9PiByZXN1bHQgIT09IHVuZGVmaW5lZCk7XG4gICAgICBpZiAocmVzdWx0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJldHVybiByZXN1bHRzWzBdO1xuICAgICAgfVxuICAgIH1cbiAgfSBcbn1cblxuLy8gRmluZHMgYSBwYXJlbnQgbm9kZSB3aXRoIHRoZSBzcGVjaWZpZWQgUE9TLCBcbi8vIHJldHVybnMgdW5kZWZpbmVkIGlmIG5vIG5vZGUgd2FzIGZvdW5kXG5mdW5jdGlvbiBmaW5kUGFyZW50V2l0aFBPUyhub2RlOiBOb2RlLCBtYWpvclBPUzogTWFqb3JQYXJ0c09mU3BlZWNoKTogTm9kZSB7XG4gIGlmIChnZXRNYWpvclBPUyhub2RlLnRva2VuLlBPUykgPT09IE1ham9yUGFydHNPZlNwZWVjaC5ST09UKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuICBpZiAoZ2V0TWFqb3JQT1Mobm9kZS5wYXJlbnQudG9rZW4uUE9TKSA9PT0gbWFqb3JQT1MpIHtcbiAgICByZXR1cm4gbm9kZS5wYXJlbnQ7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGZpbmRQYXJlbnRXaXRoUE9TKG5vZGUucGFyZW50LG1ham9yUE9TKTtcbiAgfSBcbn1cblxuLypcbi8vIFNldHMgbm9kZSB0byBiZSBhIHNpYmxpbmcgb2YgaXRzIHBhcmVudFxuLy8gQmVmb3JlOiBbR3JhbmRwYXJlbnRdIC0+IFtQYXJlbnRdIC0+IFtOb2RlXSBcbi8vIEFmdGVyOiAgW0dyYW5kcGFyZW50XSAtPiBbUGFyZW50XVxuLy8gICAgICAgICAgICAgICAgICAgICAgIC0+IFtOb2RlXVxuZnVuY3Rpb24gcHJvbW90ZU5vZGUobm9kZTogTm9kZSk6IHZvaWQge1xuICBpZiAobm9kZS5wYXJlbnQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5ST09UKSkge1xuICAgIHJldHVybjtcbiAgfVxuICBsZXQgbmV3U2libGluZyA9IG5vZGUucGFyZW50O1xuICBsZXQgbmV3UGFyZW50ID0gbmV3U2libGluZy5wYXJlbnQ7XG4gIC8vIFNldCBwYXJlbnRcbiAgbm9kZS5wYXJlbnQgPSBuZXdQYXJlbnQ7XG4gIC8vIFJlbW92ZSBub2RlIGZyb20gcGFyZW50J3MgY2hpbGRyZW5cbiAgbmV3U2libGluZy5jaGlsZHJlbi5zcGxpY2UobmV3U2libGluZy5jaGlsZHJlbi5pbmRleE9mKG5vZGUpLDEpO1xuICAvLyBBZGQgbm9kZSB0byBuZXcgcGFyZW50J3MgY2hpbGRyZW5cbiAgbmV3UGFyZW50LmNoaWxkcmVuLnB1c2gobm9kZSk7XG59Ki9cblxuLy8gTWFrZXMgdGhlIG5vZGUncyBwYXJlbnQgYSBjaGlsZCBvZiB0aGUgbm9kZS5cbi8vIFRoZSBub2RlJ3MgZ3JhbmRwYXJlbnQgaXMgdGhlbiB0aGUgbm9kZSdzIHBhcmVudFxuLy8gQmVmb3JlOiBbR3JhbmRwYXJlbnRdIC0+IFtQYXJlbnRdIC0+IFtOb2RlXVxuLy8gQWZ0ZXI6IFtHcmFuZHBhcmVuXSAtPiBbTm9kZV0gLT4gW1BhcmVudF1cbmZ1bmN0aW9uIG1ha2VQYXJlbnRDaGlsZChub2RlOiBOb2RlKTogdm9pZCB7XG4gIGxldCBwYXJlbnQgPSBub2RlLnBhcmVudDtcbiAgLy8gRG8gbm90IHN3YXAgd2l0aCByb290XG4gIGlmIChwYXJlbnQuaGFzUHJvcGVydHkoUHJvcGVydGllcy5ST09UKSkge1xuICAgIHJldHVybjtcbiAgfVxuICAvLyBTZXQgcGFyZW50c1xuICBub2RlLnBhcmVudCA9IHBhcmVudC5wYXJlbnRcbiAgcGFyZW50LnBhcmVudCA9IG5vZGU7XG4gIC8vIFJlbW92ZSBub2RlIGFzIGEgY2hpbGQgZnJvbSBwYXJlbnRcbiAgcGFyZW50LmNoaWxkcmVuLnNwbGljZShwYXJlbnQuY2hpbGRyZW4uaW5kZXhPZihub2RlKSwxKTtcbiAgLy8gU2V0IGNoaWxkcmVuXG4gIG5vZGUuY2hpbGRyZW4gPSBub2RlLmNoaWxkcmVuLmNvbmNhdChwYXJlbnQpO1xuICBub2RlLnBhcmVudC5jaGlsZHJlbi5wdXNoKG5vZGUpO1xuICBub2RlLnBhcmVudC5jaGlsZHJlbi5zcGxpY2Uobm9kZS5wYXJlbnQuY2hpbGRyZW4uaW5kZXhPZihwYXJlbnQpLDEpO1xufVxuXG5cbi8vIFN3YXBzIGEgbm9kZSB3aXRoIGl0cyBwYXJlbnQuIFRoZSBub2RlJ3MgcGFyZW50XG4vLyBpcyB0aGVuIHRoZSBwYXJlbnQncyBwYXJlbnQsIGFuZCBpdHMgY2hpbGQgaXMgdGhlIHBhcmVudC5cbi8vIFRoZSBwYXJlbnQgZ2V0cyB0aGUgbm9kZSdzIGNoaWxkcmVuXG5mdW5jdGlvbiBzd2FwV2l0aFBhcmVudChub2RlOiBOb2RlKTogdm9pZCB7XG4gIGxldCBwYXJlbnQgPSBub2RlLnBhcmVudDtcbiAgbGV0IHBwYXJlbnQgPSBwYXJlbnQucGFyZW50O1xuICBpZiAocGFyZW50Lmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuUk9PVCkpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgcGFyZW50LnBhcmVudCA9IG5vZGU7XG4gIHBhcmVudC5jaGlsZHJlbiA9IG5vZGUuY2hpbGRyZW47XG4gIHBwYXJlbnQuY2hpbGRyZW4uc3BsaWNlKHBwYXJlbnQuY2hpbGRyZW4uaW5kZXhPZihwYXJlbnQpLDEpO1xuICBub2RlLnBhcmVudCA9IHBwYXJlbnQ7XG4gIG5vZGUuY2hpbGRyZW4gPSBbcGFyZW50XTtcbiAgcHBhcmVudC5jaGlsZHJlbi5wdXNoKG5vZGUpO1xufVxuXG5leHBvcnQgZW51bSBGdW5jdGlvblR5cGVzIHtcbiAgRklMVEVSLFxuICBBR0dSRUdBVEUsXG4gIEJPT0xFQU4sXG4gIENBTENVTEFURSxcbn1cblxuaW50ZXJmYWNlIEJ1aWx0SW5GdW5jdGlvbiB7XG4gIG5hbWU6IHN0cmluZyxcbiAgdHlwZTogRnVuY3Rpb25UeXBlcyxcbiAgYXR0cmlidXRlPzogc3RyaW5nLFxuICBmaWVsZHM6IEFycmF5PHN0cmluZz4sXG4gIHByb2plY3Q6IGJvb2xlYW4sXG4gIG5lZ2F0ZWQ/OiBib29sZWFuLFxuICBub2RlPzogTm9kZSxcbn1cblxuaW50ZXJmYWNlIENvbnRleHQge1xuICBlbnRpdGllczogQXJyYXk8RW50aXR5PixcbiAgY29sbGVjdGlvbnM6IEFycmF5PENvbGxlY3Rpb24+LFxuICBhdHRyaWJ1dGVzOiBBcnJheTxBdHRyaWJ1dGU+LFxuICBmeG5zOiBBcnJheTxCdWlsdEluRnVuY3Rpb24+LFxuICBncm91cGluZ3M6IEFycmF5PE5vZGU+LFxuICByZWxhdGlvbnNoaXBzOiBBcnJheTxSZWxhdGlvbnNoaXA+LFxuICBtYXliZUVudGl0aWVzOiBBcnJheTxOb2RlPixcbiAgbWF5YmVBdHRyaWJ1dGVzOiBBcnJheTxOb2RlPixcbiAgbWF5YmVDb2xsZWN0aW9uczogQXJyYXk8Tm9kZT4sXG4gIG1heWJlRnVuY3Rpb25zOiBBcnJheTxOb2RlPixcbiAgbWF5YmVBcmd1bWVudHM6IEFycmF5PE5vZGU+LFxufVxuXG5mdW5jdGlvbiBuZXdDb250ZXh0KCk6IENvbnRleHQge1xuICByZXR1cm4ge1xuICAgIGVudGl0aWVzOiBbXSxcbiAgICBjb2xsZWN0aW9uczogW10sXG4gICAgYXR0cmlidXRlczogW10sXG4gICAgZnhuczogW10sXG4gICAgZ3JvdXBpbmdzOiBbXSxcbiAgICByZWxhdGlvbnNoaXBzOiBbXSxcbiAgICBtYXliZUVudGl0aWVzOiBbXSxcbiAgICBtYXliZUF0dHJpYnV0ZXM6IFtdLFxuICAgIG1heWJlQ29sbGVjdGlvbnM6IFtdLFxuICAgIG1heWJlRnVuY3Rpb25zOiBbXSxcbiAgICBtYXliZUFyZ3VtZW50czogW10sXG4gIH07XG59XG5cbmZ1bmN0aW9uIHdvcmRUb0Z1bmN0aW9uKHdvcmQ6IHN0cmluZyk6IEJ1aWx0SW5GdW5jdGlvbiB7XG4gIHN3aXRjaCAod29yZCkge1xuICAgIGNhc2UgXCJ0YWxsZXJcIjpcbiAgICAgIHJldHVybiB7bmFtZTogXCI+XCIsIHR5cGU6IEZ1bmN0aW9uVHlwZXMuRklMVEVSLCBhdHRyaWJ1dGU6IFwiaGVpZ2h0XCIsIGZpZWxkczogW1wiYVwiLCBcImJcIl0sIHByb2plY3Q6IGZhbHNlfTtcbiAgICBjYXNlIFwic2hvcnRlclwiOlxuICAgICAgcmV0dXJuIHtuYW1lOiBcIjxcIiwgdHlwZTogRnVuY3Rpb25UeXBlcy5GSUxURVIsIGF0dHJpYnV0ZTogXCJsZW5ndGhcIiwgZmllbGRzOiBbXCJhXCIsIFwiYlwiXSwgcHJvamVjdDogZmFsc2V9O1xuICAgIGNhc2UgXCJsb25nZXJcIjpcbiAgICAgIHJldHVybiB7bmFtZTogXCI+XCIsIHR5cGU6IEZ1bmN0aW9uVHlwZXMuRklMVEVSLCBhdHRyaWJ1dGU6IFwibGVuZ3RoXCIsIGZpZWxkczogW1wiYVwiLCBcImJcIl0sIHByb2plY3Q6IGZhbHNlfTtcbiAgICBjYXNlIFwieW91bmdlclwiOlxuICAgICAgcmV0dXJuIHtuYW1lOiBcIjxcIiwgdHlwZTogRnVuY3Rpb25UeXBlcy5GSUxURVIsIGF0dHJpYnV0ZTogXCJhZ2VcIiwgZmllbGRzOiBbXCJhXCIsIFwiYlwiXSwgcHJvamVjdDogZmFsc2V9O1xuICAgIGNhc2UgXCImXCI6XG4gICAgY2FzZSBcImFuZFwiOlxuICAgICAgcmV0dXJuIHtuYW1lOiBcImFuZFwiLCB0eXBlOiBGdW5jdGlvblR5cGVzLkJPT0xFQU4sIGZpZWxkczogW10sIHByb2plY3Q6IGZhbHNlfTtcbiAgICBjYXNlIFwib3JcIjpcbiAgICAgIHJldHVybiB7bmFtZTogXCJvclwiLCB0eXBlOiBGdW5jdGlvblR5cGVzLkJPT0xFQU4sIGZpZWxkczogW10sIHByb2plY3Q6IGZhbHNlfTtcbiAgICBjYXNlIFwidG90YWxcIjpcbiAgICBjYXNlIFwic3VtXCI6XG4gICAgICByZXR1cm4ge25hbWU6IFwic3VtXCIsIHR5cGU6IEZ1bmN0aW9uVHlwZXMuQUdHUkVHQVRFLCBmaWVsZHM6IFtcInN1bVwiLCBcInZhbHVlXCJdLCBwcm9qZWN0OiB0cnVlfTtcbiAgICBjYXNlIFwiYXZlcmFnZVwiOlxuICAgIGNhc2UgXCJhdmdcIjpcbiAgICBjYXNlIFwibWVhblwiOlxuICAgICAgcmV0dXJuIHtuYW1lOiBcImF2ZXJhZ2VcIiwgdHlwZTogRnVuY3Rpb25UeXBlcy5BR0dSRUdBVEUsIGZpZWxkczogW1wiYXZlcmFnZVwiLCBcInZhbHVlXCJdLCBwcm9qZWN0OiB0cnVlfTtcbiAgICBjYXNlIFwicGx1c1wiOlxuICAgIGNhc2UgXCJhZGRcIjpcbiAgICBjYXNlIFwiK1wiOlxuICAgICAgcmV0dXJuIHtuYW1lOiBcIitcIiwgdHlwZTogRnVuY3Rpb25UeXBlcy5DQUxDVUxBVEUsIGZpZWxkczogW1wicmVzdWx0XCIsIFwiYVwiLCBcImJcIl0sIHByb2plY3Q6IHRydWV9O1xuICAgIGNhc2UgXCJzdWJ0cmFjdFwiOlxuICAgIGNhc2UgXCJtaW51c1wiOlxuICAgIGNhc2UgXCItXCI6XG4gICAgICByZXR1cm4ge25hbWU6IFwiLVwiLCB0eXBlOiBGdW5jdGlvblR5cGVzLkNBTENVTEFURSwgZmllbGRzOiBbXCJyZXN1bHRcIiwgXCJhXCIsIFwiYlwiXSwgcHJvamVjdDogdHJ1ZX07XG4gICAgY2FzZSBcInRpbWVzXCI6XG4gICAgY2FzZSBcIm11bHRpcGx5XCI6XG4gICAgY2FzZSBcIm11bHRpcGxpZWRcIjpcbiAgICBjYXNlIFwiKlwiOlxuICAgICAgcmV0dXJuIHtuYW1lOiBcIipcIiwgdHlwZTogRnVuY3Rpb25UeXBlcy5DQUxDVUxBVEUsIGZpZWxkczogW1wicmVzdWx0XCIsIFwiYVwiLCBcImJcIl0sIHByb2plY3Q6IHRydWV9O1xuICAgIGNhc2UgXCJkaXZpZGVcIjpcbiAgICBjYXNlIFwiZGl2aWRlZFwiOlxuICAgIGNhc2UgXCIvXCI6XG4gICAgICByZXR1cm4ge25hbWU6IFwiL1wiLCB0eXBlOiBGdW5jdGlvblR5cGVzLkNBTENVTEFURSwgZmllbGRzOiBbXCJyZXN1bHRcIiwgXCJhXCIsIFwiYlwiXSwgcHJvamVjdDogdHJ1ZX07XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cbn1cblxuZnVuY3Rpb24gZm9ybVRyZWUodG9rZW5zOiBBcnJheTxUb2tlbj4pIHsgIFxuICBsZXQgdHJlZTogTm9kZTtcbiAgbGV0IHN1YnN1bWVkTm9kZXM6IEFycmF5PE5vZGU+ID0gW107XG5cbiAgLy8gVHVybiB0b2tlbnMgaW50byBub2Rlc1xuICBsZXQgbm9kZXMgPSB0b2tlbnMuZmlsdGVyKCh0b2tlbikgPT4gdG9rZW4ubm9kZSA9PT0gdW5kZWZpbmVkKS5tYXAobmV3Tm9kZSk7XG4gIFxuICAvLyBCdWlsZCBuZ3JhbXNcbiAgLy8gQFRPRE8gQnVpbGQgbmdyYW1zIGJ5IGxhcmdlc3QgdG8gc21hbGxlc3Qgc28gSSBkb24ndCBoYXZlIHRvIHNvcnQgYXQgdGhlIGVuZFxuICAvLyBASEFDSyBhbHNvIHRoaXMgZmVlbHMgaGFja3ksIGFsdGhvdWdoIGl0IHNlZW1zIHJpZ2h0LiBNYXliZSB0aGVyZSBpcyBhIGJldHRlciB3YXlcbiAgbGV0IG4gPSA0O1xuICBsZXQgbmdyYW1zOiBBcnJheTxBcnJheTxOb2RlPj4gPSBbXTtcbiAgbGV0IGlub2RlO1xuICBmb3IgKGxldCBpID0gMTsgaSA8IG5vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgbGV0IGluc2lkZUdyYW1zOiBBcnJheTxBcnJheTxOb2RlPj4gPSBbXTtcbiAgICBmb3IgKGxldCBqID0gMDsgaiA8IG47IGorKykge1xuICAgICAgaW5vZGUgPSBub2Rlc1tpK2pdO1xuICAgICAgaWYgKGlub2RlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBpZiAoaW5zaWRlR3JhbXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGZvciAobGV0IGsgPSBqOyBrIDwgTWF0aC5taW4obixub2Rlcy5sZW5ndGggLSBpKTsgaysrKSB7XG4gICAgICAgICAgaW5zaWRlR3JhbXMucHVzaChbaW5vZGVdKVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmb3IgKGxldCBrID0gajsgayA8IE1hdGgubWluKG4sbm9kZXMubGVuZ3RoIC0gaSk7IGsrKykge1xuICAgICAgICAgIGxldCBpZ3JhbSA9IGluc2lkZUdyYW1zW2tdO1xuICAgICAgICAgIGlncmFtLnB1c2goaW5vZGUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIG5ncmFtcyA9IG5ncmFtcy5jb25jYXQoaW5zaWRlR3JhbXMpXG4gIH1cbiAgLy8gU29ydCB0aGUgbmdyYW1zIGJ5IGxlbmd0aFxuICBuZ3JhbXMuc29ydCgoYixhKSA9PiBhLmxlbmd0aCAtIGIubGVuZ3RoKTtcbiAgLy8gQ2hlY2sgZWFjaCBuZ3JhbSBmb3IgYSBkaXNwbGF5IG5hbWUgICAgICBcbiAgbGV0IG1hdGNoZWROZ3JhbXM6IEFycmF5PEFycmF5PE5vZGU+PiA9IFtdO1xuICBmb3IgKGxldCBuZ3JhbSBvZiBuZ3JhbXMpIHtcbiAgICBsZXQgYWxsRm91bmQgPSBuZ3JhbS5ldmVyeSgobm9kZSkgPT4gbm9kZS5mb3VuZCk7XG4gICAgaWYgKGFsbEZvdW5kICE9PSB0cnVlKSB7XG4gICAgICBsZXQgZGlzcGxheU5hbWUgPSBuZ3JhbS5tYXAoKG5vZGUpPT5ub2RlLm5hbWUpLmpvaW4oXCIgXCIpO1xuICAgICAgbG9nKGRpc3BsYXlOYW1lKVxuICAgICAgbGV0IGZvdW5kTmFtZSA9IGV2ZS5maW5kT25lKFwiZGlzcGxheSBuYW1lXCIseyBuYW1lOiBkaXNwbGF5TmFtZSB9KTtcbiAgICAgIGxvZyhmb3VuZE5hbWUpXG4gICAgICAvLyBJZiB0aGUgZGlzcGxheSBuYW1lIGlzIGluIHRoZSBzeXN0ZW0sIG1hcmsgYWxsIHRoZSBub2RlcyBhcyBmb3VuZCBcbiAgICAgIGlmIChmb3VuZE5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBuZ3JhbS5tYXAoKG5vZGUpID0+IG5vZGUuZm91bmQgPSB0cnVlKTtcbiAgICAgICAgbWF0Y2hlZE5ncmFtcy5wdXNoKG5ncmFtKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLy8gVHVybiBuZ3JhbXMgaW50byBjb21wb3VuZCBub2Rlc1xuICBmb3IgKGxldCBuZ3JhbSBvZiBtYXRjaGVkTmdyYW1zKSB7XG4gICAgLy8gRG9uJ3QgZG8gYW55dGhpbmcgZm9yIDEtZ3JhbXNcbiAgICBpZiAobmdyYW0ubGVuZ3RoID09PSAxKSB7XG4gICAgICBuZ3JhbVswXS5mb3VuZCA9IGZhbHNlXG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgbG9nKG5ncmFtKVxuICAgIGxldCBkaXNwbGF5TmFtZSA9IG5ncmFtLm1hcCgobm9kZSk9Pm5vZGUubmFtZSkuam9pbihcIiBcIik7XG4gICAgbGV0IGxhc3RHcmFtID0gbmdyYW1bbmdyYW0ubGVuZ3RoIC0gMV07XG4gICAgbGV0IGNvbXBvdW5kVG9rZW4gPSBuZXdUb2tlbihkaXNwbGF5TmFtZSk7XG4gICAgbGV0IGNvbXBvdW5kTm9kZSA9IG5ld05vZGUoY29tcG91bmRUb2tlbik7XG4gICAgY29tcG91bmROb2RlLmNvbnN0aXR1ZW50cyA9IG5ncmFtO1xuICAgIGNvbXBvdW5kTm9kZS5peCA9IGxhc3RHcmFtLml4O1xuICAgIC8vIEluaGVyaXQgcHJvcGVydGllcyBmcm9tIHRoZSBub2Rlc1xuICAgIGNvbXBvdW5kTm9kZS5wcm9wZXJ0aWVzID0gbGFzdEdyYW0ucHJvcGVydGllczsgICAgXG4gICAgLy8gSW5zZXJ0IGNvbXBvdW5kIG5vZGUgYW5kIHJlbW92ZSBjb25zdGl0dWVudCBub2Rlc1xuICAgIG5vZGVzLnNwbGljZShub2Rlcy5pbmRleE9mKG5ncmFtWzBdKSxuZ3JhbS5sZW5ndGgsY29tcG91bmROb2RlKTtcbiAgfVxuXG4gIC8vIERvIGEgcXVpY2sgcGFzcyB0byBpZGVudGlmeSBmdW5jdGlvbnNcbiAgdG9rZW5zLm1hcCgodG9rZW4pID0+IHtcbiAgICBsZXQgbm9kZSA9IHRva2VuLm5vZGU7XG4gICAgbGV0IGZ4biA9IHdvcmRUb0Z1bmN0aW9uKG5vZGUubmFtZSk7XG4gICAgaWYgKGZ4biAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBub2RlLmZ4biA9IGZ4bjtcbiAgICAgIGZ4bi5ub2RlID0gbm9kZTtcbiAgICAgIG5vZGUucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuRlVOQ1RJT04pO1xuICAgICAgaWYgKG5vZGUuZnhuLnR5cGUgPT09IEZ1bmN0aW9uVHlwZXMuQUdHUkVHQVRFKSB7XG4gICAgICAgIG5vZGUucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuQUdHUkVHQVRFKTsgIFxuICAgICAgfSBlbHNlIGlmIChub2RlLmZ4bi50eXBlID09PSBGdW5jdGlvblR5cGVzLkNBTENVTEFURSkge1xuICAgICAgICBub2RlLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLkNBTENVTEFURSk7XG4gICAgICB9XG4gICAgfSAgICBcbiAgfSk7XG4gIFxuICAvLyBMaW5rIG5vZGVzIGVuZCB0byBlbmRcbiAgbm9kZXMubWFwKCh0aGlzTm9kZSxpKSA9PiB7XG4gICAgbGV0IG5leHROb2RlID0gbm9kZXNbaSArIDFdO1xuICAgIGlmIChuZXh0Tm9kZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzTm9kZS5mb3VuZCA9IGZhbHNlO1xuICAgICAgdGhpc05vZGUuYWRkQ2hpbGQobmV4dE5vZGUpOyAgXG4gICAgfVxuICB9KVxuXG4gIC8vIEF0IHRoaXMgcG9pbnQgd2Ugc2hvdWxkIG9ubHkgaGF2ZSBhIHNpbmdsZSByb290LlxuICBub2RlcyA9IG5vZGVzLmZpbHRlcigobm9kZSkgPT4gbm9kZS5wYXJlbnQgPT09IHVuZGVmaW5lZCk7XG4gIHRyZWUgPSBub2Rlcy5wb3AoKTtcbiAgXG4gIGZ1bmN0aW9uIHJlc29sdmVFbnRpdGllcyhub2RlOiBOb2RlLCBjb250ZXh0OiBDb250ZXh0KTogQ29udGV4dCB7XG4gICAgbGV0IHJlbGF0aW9uc2hpcDogUmVsYXRpb25zaGlwO1xuICAgIFxuICAgIGxvb3AwOlxuICAgIHdoaWxlIChub2RlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGNvbnRleHQubWF5YmVBdHRyaWJ1dGVzID0gY29udGV4dC5tYXliZUF0dHJpYnV0ZXMuZmlsdGVyKChtYXliZUF0dHIpID0+ICFtYXliZUF0dHIuZm91bmQpO1xuICAgICAgbG9nKFwiLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXCIpO1xuICAgICAgbG9nKG5vZGUpO1xuICAgICAgXG4gICAgICAvLyBIYW5kbGUgbm9kZXMgdGhhdCB3ZSBwcmV2aW91c2x5IGZvdW5kIGJ1dCBuZWVkIHRvIGdldCBob29rZWQgdXAgdG8gYSBmdW5jdGlvblxuICAgICAgaWYgKG5vZGUuZm91bmQgJiYgbm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkFUVFJJQlVURSkgJiYgbm9kZS5jaGlsZHJlbi5sZW5ndGggPT09IDAgJiYgY29udGV4dC5tYXliZUFyZ3VtZW50cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgbG9nKFwiSGFuZGxpbmcgbWlzc2luZyBhdHRyaWJ1dGVcIilcbiAgICAgICAgICBsZXQgYXJndW1lbnQgPSBjb250ZXh0Lm1heWJlQXJndW1lbnRzLnNoaWZ0KCk7XG4gICAgICAgICAgaWYgKG5vZGUucGFyZW50Lmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuRU5USVRZKSB8fCBub2RlLnBhcmVudC5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkNPTExFQ1RJT04pKSB7XG4gICAgICAgICAgICBsZXQgcGFyZW50ID0gcmVtb3ZlTm9kZShub2RlLnBhcmVudCk7XG4gICAgICAgICAgICBhcmd1bWVudC5hZGRDaGlsZChwYXJlbnQpO1xuICAgICAgICAgICAgcmVtb3ZlTm9kZShub2RlKTtcbiAgICAgICAgICAgIHBhcmVudC5hZGRDaGlsZChub2RlKTtcbiAgICAgICAgICAgIGFyZ3VtZW50LmZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmIChwYXJlbnQuY29sbGVjdGlvbikge1xuICAgICAgICAgICAgICBwYXJlbnQuY29sbGVjdGlvbi5wcm9qZWN0ID0gZmFsc2U7ICBcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHBhcmVudC5lbnRpdHkucHJvamVjdCA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhazsgICAgXG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFNraXAgY2VydGFpbiBub2Rlc1xuICAgICAgaWYgKG5vZGUuZm91bmQgfHxcbiAgICAgICAgICBub2RlLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuSU1QTElDSVQpIHx8XG4gICAgICAgICAgbm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLlJPT1QpKSB7XG4gICAgICAgIGxvZyhcIlNraXBwaW5nLi4uXCIpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gUmVtb3ZlIGNlcnRhaW4gbm9kZXNcbiAgICAgIGlmICghbm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkZVTkNUSU9OKSkge1xuICAgICAgICBpZiAobm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLlNFUEFSQVRPUikgfHxcbiAgICAgICAgICAgIGdldE1ham9yUE9TKG5vZGUudG9rZW4uUE9TKSA9PT0gTWFqb3JQYXJ0c09mU3BlZWNoLldIV09SRCB8fFxuICAgICAgICAgICAgZ2V0TWFqb3JQT1Mobm9kZS50b2tlbi5QT1MpID09PSBNYWpvclBhcnRzT2ZTcGVlY2guR0xVRSkge1xuICAgICAgICAgIGxvZyhgUmVtb3Zpbmcgbm9kZSBcIiR7bm9kZS5uYW1lfVwiYCk7XG4gICAgICAgICAgbm9kZSA9IG5vZGUuY2hpbGRyZW5bMF07XG4gICAgICAgICAgaWYgKG5vZGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbGV0IHJOb2RlID0gcmVtb3ZlTm9kZShub2RlLnBhcmVudCk7XG4gICAgICAgICAgICBpZiAock5vZGUuaGFzUHJvcGVydHkoUHJvcGVydGllcy5HUk9VUElORykpIHtcbiAgICAgICAgICAgICAgbm9kZS5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5HUk9VUElORyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAock5vZGUuaGFzUHJvcGVydHkoUHJvcGVydGllcy5ORUdBVEVTKSkge1xuICAgICAgICAgICAgICBub2RlLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLk5FR0FURVMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBIYW5kbGUgcXVhbnRpdGllc1xuICAgICAgaWYgKG5vZGUuaGFzUHJvcGVydHkoUHJvcGVydGllcy5RVUFOVElUWSkpIHtcbiAgICAgICAgbG9nKFwiSGFuZGxpbmcgcXVhbnRpdHkuLi5cIilcbiAgICAgICAgaWYgKGlzTnVtZXJpYyhub2RlLm5hbWUpID09PSBmYWxzZSkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIC8vIENyZWF0ZSBhbiBhdHRyaWJ1dGUgZm9yIHRoZSBxdWFudGl0eSBcbiAgICAgICAgbGV0IHF1YW50aXR5QXR0cmlidXRlOiBBdHRyaWJ1dGUgPSB7XG4gICAgICAgICAgaWQ6IG5vZGUubmFtZSxcbiAgICAgICAgICBkaXNwbGF5TmFtZTogbm9kZS5uYW1lLFxuICAgICAgICAgIHZhbHVlOiBgJHtub2RlLm5hbWV9YCxcbiAgICAgICAgICB2YXJpYWJsZTogYCR7bm9kZS5uYW1lfWAsXG4gICAgICAgICAgbm9kZTogbm9kZSxcbiAgICAgICAgICBwcm9qZWN0OiBmYWxzZSxcbiAgICAgICAgfVxuICAgICAgICBub2RlLmF0dHJpYnV0ZSA9IHF1YW50aXR5QXR0cmlidXRlO1xuICAgICAgICBub2RlLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLkFUVFJJQlVURSk7XG4gICAgICAgIG5vZGUuZm91bmQgPSB0cnVlO1xuICAgICAgICAvLyBJZiB0aGVyZSBpcyBhIG1heWJlQXJndW1lbnQsIGF0dGFjaCB0aGUgcXVhbnRpdHkgdG8gaXRcbiAgICAgICAgaWYgKGNvbnRleHQubWF5YmVBcmd1bWVudHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGxldCBhcmd1bWVudCA9IGNvbnRleHQubWF5YmVBcmd1bWVudHMuc2hpZnQoKTtcbiAgICAgICAgICBsZXQgcU5vZGUgPSBub2RlO1xuICAgICAgICAgIG5vZGUgPSBxTm9kZS5jaGlsZHJlblswXTtcbiAgICAgICAgICByZW1vdmVOb2RlKHFOb2RlKTtcbiAgICAgICAgICBhcmd1bWVudC5hZGRDaGlsZChxTm9kZSk7IFxuICAgICAgICAgIGFyZ3VtZW50LmZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gSGFuZGxlIGZ1bmN0aW9uc1xuICAgICAgaWYgKG5vZGUuaGFzUHJvcGVydHkoUHJvcGVydGllcy5GVU5DVElPTikpIHtcbiAgICAgICAgbG9nKFwiSGFuZGxpbmcgZnVuY3Rpb24uLi5cIilcbiAgICAgICAgXG4gICAgICAgIC8vIEhhbmRsZSBjb21wYXJhdGl2ZSBmdW5jdGlvbnNcbiAgICAgICAgaWYgKG5vZGUuaGFzUHJvcGVydHkoUHJvcGVydGllcy5DT01QQVJBVElWRSkpIHtcbiAgICAgICAgICBsZXQgYXR0cmlidXRlID0gbm9kZS5meG4uYXR0cmlidXRlO1xuICAgICAgICAgIGxldCBjb21wQXR0clRva2VuID0gbmV3VG9rZW4obm9kZS5meG4uYXR0cmlidXRlKTtcbiAgICAgICAgICBjb21wQXR0clRva2VuLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLklNUExJQ0lUKTtcbiAgICAgICAgICBsZXQgY29tcEF0dHJOb2RlID0gbmV3Tm9kZShjb21wQXR0clRva2VuKTtcbiAgICAgICAgICBjb21wQXR0ck5vZGUuZnhuID0gbm9kZS5meG47XG4gICAgICAgICAgLy8gQWRkIHR3byBhcmd1bWVudCBub2Rlc1xuICAgICAgICAgIGxldCBhcmd1bWVudFRva2VuQSA9IG5ld1Rva2VuKFwiYVwiKTtcbiAgICAgICAgICBsZXQgYXJndW1lbnROb2RlQSA9IG5ld05vZGUoYXJndW1lbnRUb2tlbkEpO1xuICAgICAgICAgIGFyZ3VtZW50Tm9kZUEucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuSU1QTElDSVQpO1xuICAgICAgICAgIGFyZ3VtZW50Tm9kZUEucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuSU5QVVQpO1xuICAgICAgICAgIG5vZGUuYWRkQ2hpbGQoYXJndW1lbnROb2RlQSk7XG4gICAgICAgICAgY29udGV4dC5tYXliZUFyZ3VtZW50cy5wdXNoKGFyZ3VtZW50Tm9kZUEpO1xuICAgICAgICAgIGxldCBhcmd1bWVudFRva2VuQiA9IG5ld1Rva2VuKFwiYlwiKTtcbiAgICAgICAgICBsZXQgYXJndW1lbnROb2RlQiA9IG5ld05vZGUoYXJndW1lbnRUb2tlbkIpO1xuICAgICAgICAgIGFyZ3VtZW50Tm9kZUIucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuSU1QTElDSVQpO1xuICAgICAgICAgIGFyZ3VtZW50Tm9kZUIucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuSU5QVVQpO1xuICAgICAgICAgIG5vZGUuYWRkQ2hpbGQoYXJndW1lbnROb2RlQik7XG4gICAgICAgICAgY29udGV4dC5tYXliZUFyZ3VtZW50cy5wdXNoKGFyZ3VtZW50Tm9kZUIpO1xuXG4gICAgICAgICAgLy8gRmluZCBhIG5vZGUgZm9yIHRoZSBMSFMgb2YgdGhlIGNvbWFwYXJpc29uXG4gICAgICAgICAgbGV0IG1hdGNoZWROb2RlID0gcHJldmlvdXNseU1hdGNoZWQobm9kZSk7XG4gICAgICAgICAgbGV0IGNvbXBBdHRyTm9kZTEgPSBjbG9uZU5vZGUoY29tcEF0dHJOb2RlKTtcbiAgICAgICAgICByZWxhdGlvbnNoaXAgPSBmaW5kUmVsYXRpb25zaGlwKG1hdGNoZWROb2RlLGNvbXBBdHRyTm9kZTEsY29udGV4dCk7XG4gICAgICAgICAgaWYgKHJlbGF0aW9uc2hpcC50eXBlID09PSBSZWxhdGlvbnNoaXBUeXBlcy5ESVJFQ1QpIHtcbiAgICAgICAgICAgIHJlbW92ZU5vZGUobWF0Y2hlZE5vZGUpO1xuICAgICAgICAgICAgbWF0Y2hlZE5vZGUuYWRkQ2hpbGQoY29tcEF0dHJOb2RlMSk7XG4gICAgICAgICAgICBjb21wQXR0ck5vZGUxLmF0dHJpYnV0ZS5wcm9qZWN0ID0gZmFsc2U7XG4gICAgICAgICAgICBhcmd1bWVudE5vZGVBLmFkZENoaWxkKG1hdGNoZWROb2RlKTtcbiAgICAgICAgICAgIGFyZ3VtZW50Tm9kZUEuZm91bmQgPSB0cnVlO1xuICAgICAgICAgICAgY29udGV4dC5tYXliZUFyZ3VtZW50cy5zaGlmdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBQdXNoIHRoZSBSSFMgYXR0cmlidXRlIG9udG8gdGhlIGNvbnRleHQgYW5kIGNvbnRpbnVlIHNlYXJjaGluZ1xuICAgICAgICAgIGNvbnRleHQubWF5YmVBdHRyaWJ1dGVzLnB1c2goY29tcEF0dHJOb2RlKTtcbiAgICAgICAgICBub2RlLmZvdW5kID0gdHJ1ZTtcbiAgICAgICAgLy8gSGFuZGxlIGFnZ3JlZ2F0ZXNcbiAgICAgICAgfSBlbHNlIGlmIChub2RlLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuQUdHUkVHQVRFKSkge1xuICAgICAgICAgIC8vIEFkZCBhbiBvdXRwdXQgdG9rZW5cbiAgICAgICAgICBsZXQgb3V0cHV0VG9rZW4gPSBuZXdUb2tlbihcIm91dHB1dFwiKTtcbiAgICAgICAgICBsZXQgb3V0cHV0Tm9kZSA9IG5ld05vZGUob3V0cHV0VG9rZW4pO1xuICAgICAgICAgIG91dHB1dE5vZGUuZm91bmQgPSB0cnVlO1xuICAgICAgICAgIG91dHB1dE5vZGUucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuSU1QTElDSVQpO1xuICAgICAgICAgIG91dHB1dE5vZGUucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuT1VUUFVUKTtcbiAgICAgICAgICBsZXQgb3V0cHV0QXR0cmlidXRlOiBBdHRyaWJ1dGUgPSB7XG4gICAgICAgICAgICBpZDogb3V0cHV0Tm9kZS5uYW1lLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6IG91dHB1dE5vZGUubmFtZSxcbiAgICAgICAgICAgIHZhbHVlOiBgJHtub2RlLmZ4bi5uYW1lfXwke291dHB1dE5vZGUubmFtZX1gLFxuICAgICAgICAgICAgdmFyaWFibGU6IGAke25vZGUuZnhuLm5hbWV9fCR7b3V0cHV0Tm9kZS5uYW1lfWAsXG4gICAgICAgICAgICBub2RlOiBvdXRwdXROb2RlLFxuICAgICAgICAgICAgcHJvamVjdDogdHJ1ZSxcbiAgICAgICAgICB9XG4gICAgICAgICAgb3V0cHV0Tm9kZS5hdHRyaWJ1dGUgPSBvdXRwdXRBdHRyaWJ1dGU7ICAgICAgICAgIFxuICAgICAgICAgIG5vZGUuYWRkQ2hpbGQob3V0cHV0Tm9kZSk7XG4gICAgICAgICAgLy8gQWRkIGFuIGlucHV0IG5vZGVcbiAgICAgICAgICBsZXQgYXJndW1lbnRUb2tlbiA9IG5ld1Rva2VuKFwiaW5wdXRcIik7XG4gICAgICAgICAgbGV0IGFyZ3VtZW50Tm9kZSA9IG5ld05vZGUoYXJndW1lbnRUb2tlbik7XG4gICAgICAgICAgYXJndW1lbnROb2RlLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLklNUExJQ0lUKTtcbiAgICAgICAgICBhcmd1bWVudE5vZGUucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuSU5QVVQpO1xuICAgICAgICAgIG5vZGUuYWRkQ2hpbGQoYXJndW1lbnROb2RlKTtcbiAgICAgICAgICBjb250ZXh0Lm1heWJlQXJndW1lbnRzLnB1c2goYXJndW1lbnROb2RlKTtcbiAgICAgICAgICBub2RlLmZvdW5kID0gdHJ1ZTtcbiAgICAgICAgLy8gSGFuZGxlIGNhbGN1bGF0aW9uc1xuICAgICAgICB9IGVsc2UgaWYgKG5vZGUuaGFzUHJvcGVydHkoUHJvcGVydGllcy5DQUxDVUxBVEUpKSB7XG4gICAgICAgICAgLy8gQ3JlYXRlIGEgcmVzdWx0IG5vZGVcbiAgICAgICAgICBsZXQgcmVzdWx0VG9rZW4gPSBuZXdUb2tlbihub2RlLmZ4bi5maWVsZHNbMF0pO1xuICAgICAgICAgIGxldCByZXN1bHROb2RlID0gbmV3Tm9kZShyZXN1bHRUb2tlbik7XG4gICAgICAgICAgcmVzdWx0Tm9kZS5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5PVVRQVVQpO1xuICAgICAgICAgIHJlc3VsdE5vZGUucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuSU1QTElDSVQpO1xuICAgICAgICAgIGxldCByZXN1bHRBdHRyaWJ1dGU6IEF0dHJpYnV0ZSA9IHtcbiAgICAgICAgICAgIGlkOiByZXN1bHROb2RlLm5hbWUsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogcmVzdWx0Tm9kZS5uYW1lLFxuICAgICAgICAgICAgdmFsdWU6IGAke25vZGUuZnhuLm5hbWV9fCR7cmVzdWx0Tm9kZS5uYW1lfWAsXG4gICAgICAgICAgICB2YXJpYWJsZTogYCR7bm9kZS5meG4ubmFtZX18JHtyZXN1bHROb2RlLm5hbWV9YCxcbiAgICAgICAgICAgIG5vZGU6IHJlc3VsdE5vZGUsXG4gICAgICAgICAgICBwcm9qZWN0OiB0cnVlLFxuICAgICAgICAgIH1cbiAgICAgICAgICByZXN1bHROb2RlLmF0dHJpYnV0ZSA9IHJlc3VsdEF0dHJpYnV0ZTsgICAgICAgICAgXG4gICAgICAgICAgbm9kZS5hZGRDaGlsZChyZXN1bHROb2RlKTtcbiAgICAgICAgICByZXN1bHROb2RlLmZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAvLyBBZGQgdHdvIGFyZ3VtZW50IG5vZGVzXG4gICAgICAgICAgbGV0IGFyZ3VtZW50VG9rZW5BID0gbmV3VG9rZW4oXCJhXCIpO1xuICAgICAgICAgIGxldCBhcmd1bWVudE5vZGVBID0gbmV3Tm9kZShhcmd1bWVudFRva2VuQSk7XG4gICAgICAgICAgYXJndW1lbnROb2RlQS5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5JTVBMSUNJVCk7XG4gICAgICAgICAgYXJndW1lbnROb2RlQS5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5JTlBVVCk7XG4gICAgICAgICAgbm9kZS5hZGRDaGlsZChhcmd1bWVudE5vZGVBKTtcbiAgICAgICAgICBsZXQgYXJndW1lbnRUb2tlbkIgPSBuZXdUb2tlbihcImJcIik7XG4gICAgICAgICAgbGV0IGFyZ3VtZW50Tm9kZUIgPSBuZXdOb2RlKGFyZ3VtZW50VG9rZW5CKTtcbiAgICAgICAgICBhcmd1bWVudE5vZGVCLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLklNUExJQ0lUKTtcbiAgICAgICAgICBhcmd1bWVudE5vZGVCLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLklOUFVUKTtcbiAgICAgICAgICBub2RlLmFkZENoaWxkKGFyZ3VtZW50Tm9kZUIpO1xuICAgICAgICAgIC8vIElmIHdlIGFscmVhZHkgZm91bmQgYSBudW1lcmljYWwgYXR0cmlidXRlLCByZXdpcmUgaXRcbiAgICAgICAgICBsZXQgZm91bmRRdWFudGl0eSA9IGZpbmRQYXJlbnRXaXRoUHJvcGVydHkobm9kZSwgUHJvcGVydGllcy5RVUFOVElUWSk7XG4gICAgICAgICAgaWYgKGZvdW5kUXVhbnRpdHkgIT09IHVuZGVmaW5lZCAmJiBmb3VuZFF1YW50aXR5LmZvdW5kID09PSB0cnVlKSB7XG4gICAgICAgICAgICByZW1vdmVOb2RlKGZvdW5kUXVhbnRpdHkpO1xuICAgICAgICAgICAgYXJndW1lbnROb2RlQS5hZGRDaGlsZChmb3VuZFF1YW50aXR5KTtcbiAgICAgICAgICAgIGFyZ3VtZW50Tm9kZUEuZm91bmQgPSB0cnVlO1xuICAgICAgICAgICAgZm91bmRRdWFudGl0eS5hdHRyaWJ1dGUucHJvamVjdCA9IGZhbHNlO1xuICAgICAgICAgICAgLy8gSWYgdGhlIG5vZGUgaGFzIGFuIGVudGl0eSwgcmV3aXJlIGl0IGFzIGEgY2hpbGQgb2YgdGhlIGZ1bmN0aW9uXG4gICAgICAgICAgICBpZiAoZm91bmRRdWFudGl0eS5hdHRyaWJ1dGUuZW50aXR5KSB7XG4gICAgICAgICAgICAgIGZvdW5kUXVhbnRpdHkuYXR0cmlidXRlLmVudGl0eS5wcm9qZWN0ID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnRleHQubWF5YmVBcmd1bWVudHMucHVzaChhcmd1bWVudE5vZGVBKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29udGV4dC5tYXliZUFyZ3VtZW50cy5wdXNoKGFyZ3VtZW50Tm9kZUIpO1xuICAgICAgICAgIG5vZGUuZm91bmQgPSB0cnVlO1xuICAgICAgICB9IGVsc2UgaWYgKG5vZGUuaGFzUHJvcGVydHkoUHJvcGVydGllcy5DT05KVU5DVElPTikpIHtcbiAgICAgICAgICBub2RlLmZvdW5kID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBjb250ZXh0LmZ4bnMucHVzaChub2RlLmZ4bik7XG4gICAgICAgIGxvZyh0cmVlLnRvU3RyaW5nKCkpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gSGFuZGxlIHByb25vdW5zXG4gICAgICBpZiAobm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLlBST05PVU4pKSB7XG4gICAgICAgIGxvZyhcIkhhbmRsaW5nIHByb25vdW4uLi5cIilcbiAgICAgICAgbGV0IG1hdGNoZWROb2RlID0gcHJldmlvdXNseU1hdGNoZWRFbnRpdHlPckNvbGxlY3Rpb24obm9kZSwgdHJ1ZSk7XG4gICAgICAgIGlmIChtYXRjaGVkTm9kZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgaWYgKG1hdGNoZWROb2RlLmNvbGxlY3Rpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgbm9kZS5jb2xsZWN0aW9uID0gbWF0Y2hlZE5vZGUuY29sbGVjdGlvbjtcbiAgICAgICAgICAgIG5vZGUucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuQ09MTEVDVElPTik7XG4gICAgICAgICAgICBub2RlLmZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgIGxvZyhgRm91bmQ6ICR7bWF0Y2hlZE5vZGUubmFtZX1gKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH0gZWxzZSBpZiAobWF0Y2hlZE5vZGUuZW50aXR5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIG5vZGUuZW50aXR5ID0gbWF0Y2hlZE5vZGUuZW50aXR5XG4gICAgICAgICAgICBub2RlLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLkVOVElUWSk7XG4gICAgICAgICAgICBub2RlLmZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgIGxvZyhgRm91bmQ6ICR7bWF0Y2hlZE5vZGUubmFtZX1gKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBsb2coXCJObyBwcm9ub3VuIG1hdGNoIGZvdW5kXCIpO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gRmluZCB0aGUgcmVsYXRpb25zaGlwIGJldHdlZW4gcGFyZW50IGFuZCBjaGlsZCBub2Rlc1xuICAgICAgLy8gUHJldmlvdXNseSBtYXRjaGVkIG5vZGVcbiAgICAgIGxldCBtYXRjaGVkTm9kZSA9IHByZXZpb3VzbHlNYXRjaGVkKG5vZGUpO1xuICAgICAgaWYgKG1hdGNoZWROb2RlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgbG9nKGBNYXRjaCBpbiBjb250ZXh0IG9mIHByZXZpb3VzbHkgbWF0Y2hlZCBub2RlIFwiJHttYXRjaGVkTm9kZS5uYW1lfVwiYCk7XG4gICAgICAgIC8vIEZpbmQgcmVsYXRpb25zaGlwIGJldHdlZW4gcHJldmlvdXNseSBtYXRjaGVkIG5vZGUgYW5kIHRoaXMgb25lXG4gICAgICAgIGlmIChtYXRjaGVkTm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLlBPU1NFU1NJVkUpKSB7XG4gICAgICAgICAgaWYgKG1hdGNoZWROb2RlLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuRU5USVRZKSkge1xuICAgICAgICAgICAgbGV0IGZvdW5kID0gZmluZEVudGl0eUF0dHJpYnV0ZShub2RlLCBtYXRjaGVkTm9kZS5lbnRpdHksIGNvbnRleHQpO1xuICAgICAgICAgICAgaWYgKGZvdW5kID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgIHJlbGF0aW9uc2hpcCA9IHt0eXBlOiBSZWxhdGlvbnNoaXBUeXBlcy5ESVJFQ1R9O1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZmluZENvbGxlY3Rpb25PckVudGl0eShub2RlLCBjb250ZXh0KTsgIFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZWxhdGlvbnNoaXAgPSBmaW5kUmVsYXRpb25zaGlwKG1hdGNoZWROb2RlLCBub2RlLCBjb250ZXh0KTsgIFxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmaW5kQ29sbGVjdGlvbk9yRW50aXR5KG5vZGUsIGNvbnRleHQpO1xuICAgICAgICAgIHJlbGF0aW9uc2hpcCA9IGZpbmRSZWxhdGlvbnNoaXAobWF0Y2hlZE5vZGUsIG5vZGUsIGNvbnRleHQpO1xuICAgICAgICB9XG4gICAgICAvLyBOb3RoaW5nIGhhcyBiZWVuIG1hdGNoZWQsIHRyeSB0byBtYXRjaCBhZ2FpbnN0IGFueSBtYXliZSBhdHRyaWJ1dGVzXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmaW5kQ29sbGVjdGlvbk9yRW50aXR5KG5vZGUsIGNvbnRleHQpO1xuICAgICAgICBmb3IgKGxldCBtYXliZUF0dHIgb2YgY29udGV4dC5tYXliZUF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICBsb2coXCJNYXRjaGluZyBwcmV2aW91c2x5IHVubWF0Y2hlZCBub2Rlcy4uLlwiKTtcbiAgICAgICAgICByZWxhdGlvbnNoaXAgPSBmaW5kUmVsYXRpb25zaGlwKG1heWJlQXR0ciwgbm9kZSwgY29udGV4dCk7XG4gICAgICAgICAgLy8gUmV3aXJlIGZvdW5kIGF0dHJpYnV0ZXNcbiAgICAgICAgICBpZiAobWF5YmVBdHRyLmZvdW5kID09PSB0cnVlKSB7XG4gICAgICAgICAgICByZW1vdmVOb2RlKG1heWJlQXR0cik7XG4gICAgICAgICAgICAvLyBJZiB0aGUgYXR0ciB3YXMgYW4gaW1wbGljaXQgYXR0cmlidXRlIGRlcml2ZWQgZnJvbSBhIGZ1bmN0aW9uLFxuICAgICAgICAgICAgLy8gbW92ZSB0aGUgbm9kZSB0byBiZSBhIGNoaWxkIG9mIHRoZSBmdW5jdGlvbiBhbmQgcmVyb290IHRoZSByZXN0IG9mIHRoZSBxdWVyeVxuICAgICAgICAgICAgaWYgKG1heWJlQXR0ci5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLklNUExJQ0lUKSkge1xuICAgICAgICAgICAgICBtYXliZUF0dHIuYXR0cmlidXRlLnByb2plY3QgPSBmYWxzZTtcbiAgICAgICAgICAgICAgbGV0IHRoaXNOb2RlID0gbm9kZTtcbiAgICAgICAgICAgICAgbm9kZSA9IG5vZGUuY2hpbGRyZW5bMF07XG4gICAgICAgICAgICAgIGlmIChub2RlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICByZXJvb3Qobm9kZSxmaW5kUGFyZW50V2l0aFByb3BlcnR5KG5vZGUsUHJvcGVydGllcy5ST09UKSk7ICAgXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgdGhpc05vZGUuYWRkQ2hpbGQobWF5YmVBdHRyKTtcbiAgICAgICAgICAgICAgaWYgKGNvbnRleHQubWF5YmVBcmd1bWVudHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGxldCBmeG5BcmdOb2RlID0gY29udGV4dC5tYXliZUFyZ3VtZW50cy5zaGlmdCgpO1xuICAgICAgICAgICAgICAgIHJlcm9vdCh0aGlzTm9kZSwgZnhuQXJnTm9kZSk7XG4gICAgICAgICAgICAgICAgZnhuQXJnTm9kZS5mb3VuZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgY29udGludWUgbG9vcDA7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIG5vZGUuYWRkQ2hpbGQobWF5YmVBdHRyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIFJld2lyZSBub2RlIHRvIHJlZmxlY3QgYW4gYXJndW1lbnQgb2YgYSBmdW5jdGlvblxuICAgICAgaWYgKG5vZGUuaGFzUHJvcGVydHkoUHJvcGVydGllcy5BVFRSSUJVVEUpICYmIGNvbnRleHQubWF5YmVBcmd1bWVudHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGxldCBhcmd1bWVudCA9IGNvbnRleHQubWF5YmVBcmd1bWVudHMuc2hpZnQoKTtcbiAgICAgICAgICBsZXQgcU5vZGUgPSBub2RlO1xuICAgICAgICAgIG5vZGUgPSBxTm9kZS5jaGlsZHJlblswXTtcbiAgICAgICAgICByZW1vdmVOb2RlKHFOb2RlKTtcbiAgICAgICAgICBhcmd1bWVudC5hZGRDaGlsZChxTm9kZSk7IFxuICAgICAgICAgIGFyZ3VtZW50LmZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICBpZiAocU5vZGUuYXR0cmlidXRlLmVudGl0eSkge1xuICAgICAgICAgICAgcU5vZGUuYXR0cmlidXRlLmVudGl0eS5wcm9qZWN0ID0gZmFsc2U7ICBcbiAgICAgICAgICB9XG4gICAgICAgICAgY29udGludWU7ICBcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gUmV3aXJlIG5vZGVzIHRvIHJlZmxlY3QgZm91bmQgcmVsYXRpb25zaGlwXG4gICAgICBpZiAocmVsYXRpb25zaGlwICE9PSB1bmRlZmluZWQgJiYgcmVsYXRpb25zaGlwLnR5cGUgIT09IFJlbGF0aW9uc2hpcFR5cGVzLk5PTkUpIHtcbiAgICAgICAgLy8gRm9yIGEgZGlyZWN0IHJlbGF0aW9uc2hpcCwgbW92ZSB0aGUgZm91bmQgbm9kZSB0byB0aGUgZW50aXR5L2NvbGxlY3Rpb25cbiAgICAgICAgaWYgKHJlbGF0aW9uc2hpcC50eXBlID09PSBSZWxhdGlvbnNoaXBUeXBlcy5ESVJFQ1QpIHtcbiAgICAgICAgICBpZiAobm9kZS5hdHRyaWJ1dGUpIHtcbiAgICAgICAgICAgIGxldCB0YXJnZXROb2RlOiBOb2RlO1xuICAgICAgICAgICAgaWYgKG5vZGUuYXR0cmlidXRlLmNvbGxlY3Rpb24gJiYgbm9kZS5wYXJlbnQgIT09IG5vZGUuYXR0cmlidXRlLmNvbGxlY3Rpb24ubm9kZSkge1xuICAgICAgICAgICAgICB0YXJnZXROb2RlID0gbm9kZS5hdHRyaWJ1dGUuY29sbGVjdGlvbi5ub2RlO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChub2RlLmF0dHJpYnV0ZS5lbnRpdHkgJiYgbm9kZS5wYXJlbnQgIT09IG5vZGUuYXR0cmlidXRlLmVudGl0eS5ub2RlKSB7XG4gICAgICAgICAgICAgIHRhcmdldE5vZGUgPSBub2RlLmF0dHJpYnV0ZS5lbnRpdHkubm9kZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0YXJnZXROb2RlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgbGV0IHJOb2RlID0gbm9kZTtcbiAgICAgICAgICAgICAgbm9kZSA9IG5vZGUuY2hpbGRyZW5bMF07XG4gICAgICAgICAgICAgIHJlbW92ZU5vZGUock5vZGUpO1xuICAgICAgICAgICAgICB0YXJnZXROb2RlLmFkZENoaWxkKHJOb2RlKTtcbiAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAvLyBGb3IgYSBvbmUtaG9wIHJlbGF0aW9uc2hpcCwgd2UgbmVlZCB0byBpbnNlcnQgdGhlIGxpbmtpbmcgbm9kZVxuICAgICAgICB9IGVsc2UgaWYgKHJlbGF0aW9uc2hpcC50eXBlID09PSBSZWxhdGlvbnNoaXBUeXBlcy5PTkVIT1ApIHtcbiAgICAgICAgICBsb2cocmVsYXRpb25zaGlwKVxuICAgICAgICAgIGlmIChyZWxhdGlvbnNoaXAubm9kZXNbMF0uY29sbGVjdGlvbikge1xuICAgICAgICAgICAgbGV0IGNvbGxlY3Rpb24gPSByZWxhdGlvbnNoaXAubm9kZXNbMF0uY29sbGVjdGlvbjtcbiAgICAgICAgICAgIGxldCBsaW5rSUQgPSByZWxhdGlvbnNoaXAubGlua3NbMF07XG4gICAgICAgICAgICBsZXQgbkNvbGxlY3Rpb24gPSBmaW5kRXZlQ29sbGVjdGlvbihsaW5rSUQpO1xuICAgICAgICAgICAgaWYgKG5Db2xsZWN0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IGxpbmsgbm9kZVxuICAgICAgICAgICAgICBsZXQgdG9rZW4gPSBuZXdUb2tlbihuQ29sbGVjdGlvbi5kaXNwbGF5TmFtZSk7XG4gICAgICAgICAgICAgIGxldCBuTm9kZSA9IG5ld05vZGUodG9rZW4pO1xuICAgICAgICAgICAgICBpbnNlcnRBZnRlck5vZGUobk5vZGUsY29sbGVjdGlvbi5ub2RlKTtcbiAgICAgICAgICAgICAgbk5vZGUuY29sbGVjdGlvbiA9IG5Db2xsZWN0aW9uO1xuICAgICAgICAgICAgICBuQ29sbGVjdGlvbi5ub2RlID0gbk5vZGU7XG4gICAgICAgICAgICAgIGNvbnRleHQuY29sbGVjdGlvbnMucHVzaChuQ29sbGVjdGlvbik7XG4gICAgICAgICAgICAgIC8vIEJ1aWxkIGEgY29sbGVjdGlvbiBhdHRyaWJ1dGUgdG8gbGluayB3aXRoIHBhcmVudFxuICAgICAgICAgICAgICBsZXQgY29sbGVjdGlvbkF0dHJpYnV0ZTogQXR0cmlidXRlID0ge1xuICAgICAgICAgICAgICAgICAgaWQ6IGNvbGxlY3Rpb24uZGlzcGxheU5hbWUsXG4gICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogY29sbGVjdGlvbi5kaXNwbGF5TmFtZSxcbiAgICAgICAgICAgICAgICAgIGNvbGxlY3Rpb246IG5Db2xsZWN0aW9uLFxuICAgICAgICAgICAgICAgICAgdmFsdWU6IGAke2NvbGxlY3Rpb24uZGlzcGxheU5hbWV9YCxcbiAgICAgICAgICAgICAgICAgIHZhcmlhYmxlOiBgJHtjb2xsZWN0aW9uLmRpc3BsYXlOYW1lfWAsXG4gICAgICAgICAgICAgICAgICBub2RlOiBuTm9kZSxcbiAgICAgICAgICAgICAgICAgIHByb2plY3Q6IGZhbHNlLFxuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICBuTm9kZS5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5JTVBMSUNJVCk7XG4gICAgICAgICAgICAgIG5Ob2RlLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLkFUVFJJQlVURSk7XG4gICAgICAgICAgICAgIG5Ob2RlLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLkNPTExFQ1RJT04pO1xuICAgICAgICAgICAgICBuTm9kZS5hdHRyaWJ1dGUgPSBjb2xsZWN0aW9uQXR0cmlidXRlO1xuICAgICAgICAgICAgICBjb250ZXh0LmF0dHJpYnV0ZXMucHVzaChjb2xsZWN0aW9uQXR0cmlidXRlKTtcbiAgICAgICAgICAgICAgbk5vZGUuZm91bmQgPSB0cnVlO1xuICAgICAgICAgICAgICBuTm9kZS5jaGlsZHJlblswXS5hdHRyaWJ1dGUuY29sbGVjdGlvbiA9IG5Db2xsZWN0aW9uO1xuICAgICAgICAgICAgfSAgICAgXG4gICAgICAgICAgfSBlbHNlIGlmIChyZWxhdGlvbnNoaXAubm9kZXNbMF0uZW50aXR5KSB7XG4gICAgICAgICAgICBsZXQgZW50aXR5ID0gcmVsYXRpb25zaGlwLm5vZGVzWzBdLmVudGl0eTtcbiAgICAgICAgICAgIGxldCBsaW5rSUQgPSByZWxhdGlvbnNoaXAubGlua3NbMF07XG4gICAgICAgICAgICBsZXQgbkNvbGxlY3Rpb24gPSBmaW5kRXZlQ29sbGVjdGlvbihsaW5rSUQpO1xuICAgICAgICAgICAgaWYgKG5Db2xsZWN0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgLy8gQ3JlYXRlIGEgbmV3IGxpbmsgbm9kZVxuICAgICAgICAgICAgICBsZXQgdG9rZW4gPSBuZXdUb2tlbihuQ29sbGVjdGlvbi5kaXNwbGF5TmFtZSk7XG4gICAgICAgICAgICAgIGxldCBuTm9kZSA9IG5ld05vZGUodG9rZW4pO1xuICAgICAgICAgICAgICBpbnNlcnRBZnRlck5vZGUobk5vZGUsZW50aXR5Lm5vZGUpO1xuICAgICAgICAgICAgICBuTm9kZS5jb2xsZWN0aW9uID0gbkNvbGxlY3Rpb247XG4gICAgICAgICAgICAgIG5Db2xsZWN0aW9uLm5vZGUgPSBuTm9kZTtcbiAgICAgICAgICAgICAgbk5vZGUucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuSU1QTElDSVQpO1xuICAgICAgICAgICAgICBuTm9kZS5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5BVFRSSUJVVEUpO1xuICAgICAgICAgICAgICBuTm9kZS5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5DT0xMRUNUSU9OKTtcbiAgICAgICAgICAgICAgbk5vZGUuZm91bmQgPSB0cnVlO1xuICAgICAgICAgICAgICBjb250ZXh0LmNvbGxlY3Rpb25zLnB1c2gobkNvbGxlY3Rpb24pO1xuICAgICAgICAgICAgICAvLyBCdWlsZCBhIGNvbGxlY3Rpb24gYXR0cmlidXRlIHRvIGxpbmsgd2l0aCBwYXJlbnRcbiAgICAgICAgICAgICAgbGV0IGNvbGxlY3Rpb25BdHRyaWJ1dGU6IEF0dHJpYnV0ZSA9IHtcbiAgICAgICAgICAgICAgICAgIGlkOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgICAgICBkaXNwbGF5TmFtZTogbkNvbGxlY3Rpb24uZGlzcGxheU5hbWUsXG4gICAgICAgICAgICAgICAgICBjb2xsZWN0aW9uOiBuQ29sbGVjdGlvbixcbiAgICAgICAgICAgICAgICAgIHZhbHVlOiBgJHtlbnRpdHkuaWR9YCxcbiAgICAgICAgICAgICAgICAgIHZhcmlhYmxlOiBgJHtlbnRpdHkuZGlzcGxheU5hbWV9YCxcbiAgICAgICAgICAgICAgICAgIG5vZGU6IG5Ob2RlLFxuICAgICAgICAgICAgICAgICAgcHJvamVjdDogZmFsc2UsXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIG5Ob2RlLmF0dHJpYnV0ZSA9IGNvbGxlY3Rpb25BdHRyaWJ1dGU7XG4gICAgICAgICAgICAgIGNvbnRleHQuYXR0cmlidXRlcy5wdXNoKGNvbGxlY3Rpb25BdHRyaWJ1dGUpO1xuICAgICAgICAgICAgICBuTm9kZS5jaGlsZHJlblswXS5hdHRyaWJ1dGUuY29sbGVjdGlvbiA9IG5Db2xsZWN0aW9uO1xuICAgICAgICAgICAgfSAgICAgXG4gICAgICAgICAgfVxuICAgICAgICAvLyBGb3IgYW4gaW50ZXJzZWN0aW9uLCBzZXQgdGhlIGNvcnJlY3QgdmFyaWFibGVzIG9uIGNvbGxlY3Rpb25zXG4gICAgICAgIH0gZWxzZSBpZiAocmVsYXRpb25zaGlwLnR5cGUgPT09IFJlbGF0aW9uc2hpcFR5cGVzLklOVEVSU0VDVElPTikge1xuICAgICAgICAgIGxldCBbbm9kZUEsIG5vZGVCXSA9IHJlbGF0aW9uc2hpcC5ub2RlcztcbiAgICAgICAgICBub2RlQS5jb2xsZWN0aW9uLnZhcmlhYmxlID0gbm9kZUIuY29sbGVjdGlvbi52YXJpYWJsZTtcbiAgICAgICAgICBub2RlQi5jb2xsZWN0aW9uLnByb2plY3QgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBJZiBubyBjb2xsZWN0aW9uIG9yIGVudGl0eSBoYXMgYmVlbiBmb3VuZCwgZG8gc29tZSB3b3JrIGRlcGVuZGluZyBvbiB0aGUgbm9kZVxuICAgICAgaWYgKG5vZGUuZm91bmQgPT09IGZhbHNlICYmICFub2RlLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuSU1QTElDSVQpKSB7XG4gICAgICAgIGxvZyhcIk5vdCBmb3VuZFwiKTtcbiAgICAgICAgbG9nKGNvbnRleHQpXG4gICAgICAgIGNvbnRleHQubWF5YmVBdHRyaWJ1dGVzLnB1c2gobm9kZSk7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICB9XG4gICAgXG4gICAgLy8gUmVzb2x2ZSBlbnRpdGllcyBmb3IgdGhlIGNoaWxkcmVuXG4gICAgaWYgKG5vZGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgbm9kZS5jaGlsZHJlbi5tYXAoKGNoaWxkKSA9PiByZXNvbHZlRW50aXRpZXMoY2hpbGQsY29udGV4dCkpO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gY29udGV4dDtcbiAgfVxuXG4gIGxvZyh0cmVlLnRvU3RyaW5nKCkpO1xuICBsb2coXCJSZXNvbHZpbmcgZW50aXRpZXMuLi5cIik7XG4gIGxldCBjb250ZXh0ID0gbmV3Q29udGV4dCgpO1xuICByZXNvbHZlRW50aXRpZXModHJlZSxjb250ZXh0KTtcbiAgbG9nKFwiRW50aXRpZXMgcmVzb2x2ZWQhXCIpO1xuXG4gIC8vIFJld2lyZSBncm91cGluZ3MgYW5kIGFnZ3JlZ2F0ZXNcbiAgLy8gQFRPRE8gRG8gdGhpcyBpbiBhIHJld2lyZSBzdGVwXG4gIGxldCBhZ2dyZWdhdGUgPSBmaW5kQ2hpbGRXaXRoUHJvcGVydHkodHJlZSwgUHJvcGVydGllcy5BR0dSRUdBVEUpO1xuICBpZiAoYWdncmVnYXRlICE9PSB1bmRlZmluZWQpIHtcbiAgICBsZXQgZ3JvdXBpbmcgPSBmaW5kQ2hpbGRXaXRoUHJvcGVydHkoYWdncmVnYXRlLCBQcm9wZXJ0aWVzLkdST1VQSU5HKTtcbiAgICAgIGlmIChncm91cGluZyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICByZW1vdmVOb2RlKGdyb3VwaW5nKTtcbiAgICAgIGluc2VydEFmdGVyTm9kZShncm91cGluZyxhZ2dyZWdhdGUucGFyZW50KTtcbiAgICB9ICBcbiAgfVxuICBcbiAgLy8gU29ydCBjaGlsZHJlbiB0byBwcmVzZXJ2ZSBhcmd1bWVudCBvcmRlciBpbiBmdW5jdGlvbnNcbiAgZnVuY3Rpb24gc29ydENoaWxkcmVuKG5vZGU6IE5vZGUpOiB2b2lkIHtcbiAgICBub2RlLmNoaWxkcmVuLnNvcnQoKGEsYikgPT4gYS5peCAtIGIuaXgpO1xuICAgIG5vZGUuY2hpbGRyZW4ubWFwKHNvcnRDaGlsZHJlbik7XG4gIH1cbiAgc29ydENoaWxkcmVuKHRyZWUpO1xuICBcbiAgLy8gTWFyayByb290IGFzIGZvdW5kXG4gIHRyZWUuZm91bmQgPSB0cnVlO1xuICBsb2codHJlZS50b1N0cmluZygpKTtcbiAgcmV0dXJuIHt0cmVlOiB0cmVlLCBjb250ZXh0OiBjb250ZXh0fTtcbn1cblxuLy8gRUFWIEZ1bmN0aW9uc1xuXG5pbnRlcmZhY2UgRW50aXR5IHtcbiAgaWQ6IHN0cmluZyxcbiAgZGlzcGxheU5hbWU6IHN0cmluZyxcbiAgY29udGVudDogc3RyaW5nLFxuICB2YXJpYWJsZTogc3RyaW5nLFxuICBlbnRpdHlBdHRyaWJ1dGU6IGJvb2xlYW4sXG4gIG5vZGU/OiBOb2RlLFxuICBwcm9qZWN0OiBib29sZWFuLFxufVxuXG5mdW5jdGlvbiBjbG9uZUVudGl0eShlbnRpdHk6IEVudGl0eSk6IEVudGl0eSB7XG4gIGxldCBjbG9uZTogRW50aXR5ID0ge1xuICAgIGlkOiBlbnRpdHkuaWQsXG4gICAgZGlzcGxheU5hbWU6IGVudGl0eS5kaXNwbGF5TmFtZSxcbiAgICBjb250ZW50OiBlbnRpdHkuY29udGVudCxcbiAgICBub2RlOiBlbnRpdHkubm9kZSxcbiAgICBlbnRpdHlBdHRyaWJ1dGU6IGVudGl0eS5lbnRpdHlBdHRyaWJ1dGUsXG4gICAgdmFyaWFibGU6IGVudGl0eS52YXJpYWJsZSxcbiAgICBwcm9qZWN0OiBlbnRpdHkucHJvamVjdCxcbiAgfVxuICByZXR1cm4gY2xvbmU7XG59XG5cbmludGVyZmFjZSBDb2xsZWN0aW9uIHtcbiAgaWQ6IHN0cmluZyxcbiAgZGlzcGxheU5hbWU6IHN0cmluZyxcbiAgY291bnQ6IG51bWJlcixcbiAgbm9kZT86IE5vZGUsXG4gIHZhcmlhYmxlOiBzdHJpbmcsXG4gIHByb2plY3Q6IGJvb2xlYW4sXG59XG5cbmZ1bmN0aW9uIGNsb25lQ29sbGVjdGlvbihjb2xsZWN0aW9uOiBDb2xsZWN0aW9uKTogQ29sbGVjdGlvbiB7XG4gIGxldCBjbG9uZTogQ29sbGVjdGlvbiA9IHtcbiAgICBpZDogY29sbGVjdGlvbi5pZCxcbiAgICBkaXNwbGF5TmFtZTogY29sbGVjdGlvbi5kaXNwbGF5TmFtZSxcbiAgICBjb3VudDogY29sbGVjdGlvbi5jb3VudCxcbiAgICBub2RlOiBjb2xsZWN0aW9uLm5vZGUsXG4gICAgdmFyaWFibGU6IGNvbGxlY3Rpb24udmFyaWFibGUsXG4gICAgcHJvamVjdDogY29sbGVjdGlvbi5wcm9qZWN0LFxuICB9XG4gIHJldHVybiBjbG9uZTtcbn1cblxuaW50ZXJmYWNlIEF0dHJpYnV0ZSB7XG4gIGlkOiBzdHJpbmcsXG4gIGRpc3BsYXlOYW1lOiBzdHJpbmcsXG4gIGVudGl0eT86IEVudGl0eSxcbiAgY29sbGVjdGlvbj86IENvbGxlY3Rpb24sXG4gIHZhbHVlOiBzdHJpbmcgfCBudW1iZXJcbiAgdmFyaWFibGU6IHN0cmluZyxcbiAgbm9kZT86IE5vZGUsXG4gIHByb2plY3Q6IGJvb2xlYW4sXG59XG5cbi8vIFJldHVybnMgdGhlIGVudGl0eSB3aXRoIHRoZSBnaXZlbiBkaXNwbGF5IG5hbWUuXG4vLyBJZiB0aGUgZW50aXR5IGlzIG5vdCBmb3VuZCwgcmV0dXJucyB1bmRlZmluZWRcbi8vIFR3byBlcnJvciBtb2RlcyBoZXJlOiBcbi8vIDEpIHRoZSBuYW1lIGlzIG5vdCBmb3VuZCBpbiBcImRpc3BsYXkgbmFtZVwiXG4vLyAyKSB0aGUgbmFtZSBpcyBmb3VuZCBpbiBcImRpc3BsYXkgbmFtZVwiIGJ1dCBub3QgZm91bmQgaW4gXCJlbnRpdHlcIlxuLy8gY2FuIDIpIGV2ZXIgaGFwcGVuP1xuLy8gUmV0dXJucyB0aGUgY29sbGVjdGlvbiB3aXRoIHRoZSBnaXZlbiBkaXNwbGF5IG5hbWUuXG5leHBvcnQgZnVuY3Rpb24gZmluZEV2ZUVudGl0eShzZWFyY2g6IHN0cmluZyk6IEVudGl0eSB7XG4gIGxvZyhcIlNlYXJjaGluZyBmb3IgZW50aXR5OiBcIiArIHNlYXJjaCk7XG4gIGxldCBmb3VuZEVudGl0eTtcbiAgbGV0IG5hbWU6IHN0cmluZztcbiAgLy8gVHJ5IHRvIGZpbmQgYnkgZGlzcGxheSBuYW1lIGZpcnN0XG4gIGxldCBkaXNwbGF5ID0gZXZlLmZpbmRPbmUoXCJkaXNwbGF5IG5hbWVcIix7IG5hbWU6IHNlYXJjaCB9KTtcbiAgaWYgKGRpc3BsYXkgIT09IHVuZGVmaW5lZCkge1xuICAgIGZvdW5kRW50aXR5ID0gZXZlLmZpbmRPbmUoXCJlbnRpdHlcIiwgeyBlbnRpdHk6IGRpc3BsYXkuaWQgfSk7XG4gICAgbmFtZSA9IHNlYXJjaDtcbiAgLy8gSWYgd2UgZGlkbid0IGZpbmQgaXQgdGhhdCB3YXksIHRyeSBhZ2FpbiBieSBJRFxuICB9IGVsc2Uge1xuICAgIGZvdW5kRW50aXR5ID0gZXZlLmZpbmRPbmUoXCJlbnRpdHlcIiwgeyBlbnRpdHk6IHNlYXJjaCB9KTtcbiAgfVxuICAvLyBCdWlsZCB0aGUgZW50aXR5XG4gIGlmIChmb3VuZEVudGl0eSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgaWYgKG5hbWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgZGlzcGxheSA9IGV2ZS5maW5kT25lKFwiZGlzcGxheSBuYW1lXCIseyBpZDogc2VhcmNoIH0pO1xuICAgICAgbmFtZSA9IGRpc3BsYXkubmFtZTsgIFxuICAgIH1cbiAgICBsZXQgZW50aXR5OiBFbnRpdHkgPSB7XG4gICAgICBpZDogZm91bmRFbnRpdHkuZW50aXR5LFxuICAgICAgZGlzcGxheU5hbWU6IG5hbWUsXG4gICAgICBjb250ZW50OiBmb3VuZEVudGl0eS5jb250ZW50LFxuICAgICAgdmFyaWFibGU6IGZvdW5kRW50aXR5LmVudGl0eSxcbiAgICAgIGVudGl0eUF0dHJpYnV0ZTogZmFsc2UsXG4gICAgICBwcm9qZWN0OiB0cnVlLFxuICAgIH0gICAgXG4gICAgbG9nKFwiIEZvdW5kOiBcIiArIG5hbWUpO1xuICAgIHJldHVybiBlbnRpdHk7XG4gIH0gZWxzZSB7XG4gICAgbG9nKFwiIE5vdCBmb3VuZDogXCIgKyBzZWFyY2gpO1xuICAgIHJldHVybiB1bmRlZmluZWQ7ICBcbiAgfVxufVxuLy8gUmV0dXJucyB0aGUgY29sbGVjdGlvbiB3aXRoIHRoZSBnaXZlbiBkaXNwbGF5IG5hbWUuXG5mdW5jdGlvbiBmaW5kRXZlQ29sbGVjdGlvbihzZWFyY2g6IHN0cmluZyk6IENvbGxlY3Rpb24ge1xuICBsb2coXCJTZWFyY2hpbmcgZm9yIGNvbGxlY3Rpb246IFwiICsgc2VhcmNoKTtcbiAgbGV0IGZvdW5kQ29sbGVjdGlvbjtcbiAgbGV0IG5hbWU6IHN0cmluZztcbiAgLy8gVHJ5IHRvIGZpbmQgYnkgZGlzcGxheSBuYW1lIGZpcnN0XG4gIGxldCBkaXNwbGF5ID0gZXZlLmZpbmRPbmUoXCJkaXNwbGF5IG5hbWVcIix7IG5hbWU6IHNlYXJjaCB9KTtcbiAgaWYgKGRpc3BsYXkgIT09IHVuZGVmaW5lZCkge1xuICAgIGZvdW5kQ29sbGVjdGlvbiA9IGV2ZS5maW5kT25lKFwiY29sbGVjdGlvblwiLCB7IGNvbGxlY3Rpb246IGRpc3BsYXkuaWQgfSk7XG4gICAgbmFtZSA9IHNlYXJjaDtcbiAgLy8gSWYgd2UgZGlkbid0IGZpbmQgaXQgdGhhdCB3YXksIHRyeSBhZ2FpbiBieSBJRFxuICB9IGVsc2Uge1xuICAgIGZvdW5kQ29sbGVjdGlvbiA9IGV2ZS5maW5kT25lKFwiY29sbGVjdGlvblwiLCB7IGNvbGxlY3Rpb246IHNlYXJjaCB9KTtcbiAgfVxuICAvLyBCdWlsZCB0aGUgY29sbGVjdGlvblxuICBpZiAoZm91bmRDb2xsZWN0aW9uICE9PSB1bmRlZmluZWQpIHtcbiAgICBpZiAobmFtZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBkaXNwbGF5ID0gZXZlLmZpbmRPbmUoXCJkaXNwbGF5IG5hbWVcIix7IGlkOiBzZWFyY2ggfSk7XG4gICAgICBuYW1lID0gZGlzcGxheS5uYW1lOyAgXG4gICAgfVxuICAgIGxldCBjb2xsZWN0aW9uOiBDb2xsZWN0aW9uID0ge1xuICAgICAgaWQ6IGZvdW5kQ29sbGVjdGlvbi5jb2xsZWN0aW9uLFxuICAgICAgZGlzcGxheU5hbWU6IG5hbWUsXG4gICAgICBjb3VudDogZm91bmRDb2xsZWN0aW9uLmNvdW50LFxuICAgICAgdmFyaWFibGU6IG5hbWUsXG4gICAgICBwcm9qZWN0OiB0cnVlLFxuICAgIH1cbiAgICBsb2coXCIgRm91bmQ6IFwiICsgbmFtZSk7XG4gICAgcmV0dXJuIGNvbGxlY3Rpb247XG4gIH0gZWxzZSB7XG4gICAgbG9nKFwiIE5vdCBmb3VuZDogXCIgKyBzZWFyY2gpO1xuICAgIHJldHVybiB1bmRlZmluZWQ7ICBcbiAgfVxufVxuXG4vLyBSZXR1cm5zIHRoZSBhdHRyaWJ1dGUgd2l0aCB0aGUgZ2l2ZW4gZGlzcGxheSBuYW1lIGF0dGFjaGVkIHRvIHRoZSBnaXZlbiBlbnRpdHlcbi8vIElmIHRoZSBlbnRpdHkgZG9lcyBub3QgaGF2ZSB0aGF0IGF0dHJpYnV0ZSwgb3IgdGhlIGVudGl0eSBkb2VzIG5vdCBleGlzdCwgcmV0dXJucyB1bmRlZmluZWRcbmZ1bmN0aW9uIGZpbmRFdmVBdHRyaWJ1dGUobmFtZTogc3RyaW5nLCBlbnRpdHk6IEVudGl0eSk6IEF0dHJpYnV0ZSB7XG4gIGxvZyhcIlNlYXJjaGluZyBmb3IgYXR0cmlidXRlOiBcIiArIG5hbWUpO1xuICBsb2coXCIgRW50aXR5OiBcIiArIGVudGl0eS5kaXNwbGF5TmFtZSk7XG4gIGxldCBmb3VuZEF0dHJpYnV0ZSA9IGV2ZS5maW5kT25lKFwiZW50aXR5IGVhdnNcIiwgeyBlbnRpdHk6IGVudGl0eS5pZCwgYXR0cmlidXRlOiBuYW1lIH0pO1xuICBpZiAoZm91bmRBdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCkge1xuICAgIGxldCBhdHRyaWJ1dGU6IEF0dHJpYnV0ZSA9IHtcbiAgICAgIGlkOiBmb3VuZEF0dHJpYnV0ZS5hdHRyaWJ1dGUsXG4gICAgICBkaXNwbGF5TmFtZTogbmFtZSxcbiAgICAgIGVudGl0eTogZW50aXR5LFxuICAgICAgdmFsdWU6IGZvdW5kQXR0cmlidXRlLnZhbHVlLFxuICAgICAgdmFyaWFibGU6IGAke2VudGl0eS5kaXNwbGF5TmFtZX18JHtuYW1lfWAucmVwbGFjZSgvIC9nLCcnKSxcbiAgICAgIHByb2plY3Q6IHRydWUsXG4gICAgfVxuICAgIGxvZyhgIEZvdW5kOiAke25hbWV9ICR7YXR0cmlidXRlLnZhcmlhYmxlfSA9PiAke2F0dHJpYnV0ZS52YWx1ZX1gKTtcbiAgICBsb2coYXR0cmlidXRlKTtcbiAgICByZXR1cm4gYXR0cmlidXRlO1xuICB9XG4gIGxvZyhcIiBOb3QgZm91bmQ6IFwiICsgbmFtZSk7XG4gIHJldHVybiB1bmRlZmluZWQ7XG59XG5cbmVudW0gUmVsYXRpb25zaGlwVHlwZXMge1xuICBOT05FLFxuICBESVJFQ1QsXG4gIE9ORUhPUCxcbiAgVFdPSE9QLFxuICBJTlRFUlNFQ1RJT04sXG59XG5cbmludGVyZmFjZSBSZWxhdGlvbnNoaXAge1xuICBsaW5rcz86IEFycmF5PHN0cmluZz4sXG4gIHR5cGU6IFJlbGF0aW9uc2hpcFR5cGVzLFxuICBub2Rlcz86IEFycmF5PE5vZGU+LFxufVxuXG5mdW5jdGlvbiBmaW5kUmVsYXRpb25zaGlwKG5vZGVBOiBOb2RlLCBub2RlQjogTm9kZSwgY29udGV4dDogQ29udGV4dCk6IFJlbGF0aW9uc2hpcCB7XG4gIGlmIChub2RlQS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLlFVQU5USVRZKSB8fCBub2RlQi5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLlFVQU5USVRZKSkge1xuICAgIGxvZyAoXCJRdWFudGl0aWVzIGhhdmUgbm8gcmVsYXRpb25zaGlwIHRvIGFueXRoaW5nIGVsc2UgaW4gdGhlIHN5c3RlbVwiKTtcbiAgICByZXR1cm4ge3R5cGU6IFJlbGF0aW9uc2hpcFR5cGVzLk5PTkV9OyBcbiAgfVxuICBsb2coYEZpbmRpbmcgcmVsYXRpb25zaGlwIGJldHdlZW4gXCIke25vZGVBLm5hbWV9XCIgYW5kIFwiJHtub2RlQi5uYW1lfVwiYCk7XG4gIGxldCByZWxhdGlvbnNoaXA6IFJlbGF0aW9uc2hpcDtcbiAgLy8gSWYgYm90aCBub2RlcyBhcmUgQ29sbGVjdGlvbnMsIGZpbmQgdGhlaXIgcmVsYXRpb25zaGlwXG4gIGlmIChub2RlQS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkNPTExFQ1RJT04pICYmIG5vZGVCLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuQ09MTEVDVElPTikpIHtcbiAgICByZWxhdGlvbnNoaXAgPSBmaW5kQ29sbGVjdGlvblRvQ29sbGVjdGlvblJlbGF0aW9uc2hpcChub2RlQS5jb2xsZWN0aW9uLCBub2RlQi5jb2xsZWN0aW9uKTtcbiAgLy8gSWYgb25lIG5vZGUgaXMgYSBDb2xsZWN0aW9uLCBhbmQgdGhlIG90aGVyIG5vZGUgaXMgbmVpdGhlciBhIGNvbGxlY3Rpb24gbm9yIGFuIGVudGl0eVxuICB9IGVsc2UgaWYgKG5vZGVBLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuQ09MTEVDVElPTikgJiYgIShub2RlQi5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkNPTExFQ1RJT04pIHx8bm9kZUIuaGFzUHJvcGVydHkoUHJvcGVydGllcy5FTlRJVFkpKSkge1xuICAgIHJlbGF0aW9uc2hpcCA9IGZpbmRDb2xsZWN0aW9uVG9BdHRyUmVsYXRpb25zaGlwKG5vZGVBLmNvbGxlY3Rpb24sIG5vZGVCLCBjb250ZXh0KTtcbiAgfSBlbHNlIGlmIChub2RlQi5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkNPTExFQ1RJT04pICYmICEobm9kZUEuaGFzUHJvcGVydHkoUHJvcGVydGllcy5DT0xMRUNUSU9OKSB8fCBub2RlQS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkVOVElUWSkpKSB7XG4gICAgcmVsYXRpb25zaGlwID0gZmluZENvbGxlY3Rpb25Ub0F0dHJSZWxhdGlvbnNoaXAobm9kZUIuY29sbGVjdGlvbiwgbm9kZUEsIGNvbnRleHQpO1xuICAvLyBJZiBvbmUgbm9kZSBpcyBhbiBlbnRpdHkgYW5kIHRoZSBvdGhlciBpcyBhIGNvbGxlY3Rpb24gXG4gIH0gZWxzZSBpZiAobm9kZUEuaGFzUHJvcGVydHkoUHJvcGVydGllcy5DT0xMRUNUSU9OKSAmJiBub2RlQi5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkVOVElUWSkpIHtcbiAgICByZWxhdGlvbnNoaXAgPSBmaW5kQ29sbGVjdGlvblRvRW50UmVsYXRpb25zaGlwKG5vZGVBLmNvbGxlY3Rpb24sIG5vZGVCLmVudGl0eSk7XG4gIH0gZWxzZSBpZiAobm9kZUIuaGFzUHJvcGVydHkoUHJvcGVydGllcy5DT0xMRUNUSU9OKSAmJiBub2RlQS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkVOVElUWSkpIHtcbiAgICByZWxhdGlvbnNoaXAgPSBmaW5kQ29sbGVjdGlvblRvRW50UmVsYXRpb25zaGlwKG5vZGVCLmNvbGxlY3Rpb24sIG5vZGVBLmVudGl0eSk7XG4gIC8vIElmIG9uZSBub2RlIGlzIGFuIEVudGl0eSwgYW5kIHRoZSBvdGhlciBub2RlIGlzIG5laXRoZXIgYSBjb2xsZWN0aW9uIG5vciBhbiBlbnRpdHlcbiAgfSBlbHNlIGlmIChub2RlQS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkVOVElUWSkgJiYgIShub2RlQi5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkNPTExFQ1RJT04pIHx8IG5vZGVCLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuRU5USVRZKSkpIHtcbiAgICByZWxhdGlvbnNoaXAgPSBmaW5kRW50VG9BdHRyUmVsYXRpb25zaGlwKG5vZGVBLmVudGl0eSwgbm9kZUIsIGNvbnRleHQpO1xuICB9IGVsc2UgaWYgKG5vZGVCLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuRU5USVRZKSAmJiAhKG5vZGVBLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuQ09MTEVDVElPTikgfHwgbm9kZUEuaGFzUHJvcGVydHkoUHJvcGVydGllcy5FTlRJVFkpKSkge1xuICAgIHJlbGF0aW9uc2hpcCA9IGZpbmRFbnRUb0F0dHJSZWxhdGlvbnNoaXAobm9kZUIuZW50aXR5LCBub2RlQSwgY29udGV4dCk7XG4gLy8gSWYgb25lIG5vZGUgaXMgYW4gQXR0cmlidXRlLCBhbmQgdGhlIG90aGVyIG5vZGUgaXMgbmVpdGhlciBhIGNvbGxlY3Rpb24gbm9yIGFuIGVudGl0eVxuICB9IGVsc2UgaWYgKG5vZGVBLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuQVRUUklCVVRFKSAmJiAhKG5vZGVCLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuQ09MTEVDVElPTikgfHwgbm9kZUIuaGFzUHJvcGVydHkoUHJvcGVydGllcy5FTlRJVFkpKSkge1xuICAgIHJlbGF0aW9uc2hpcCA9IGZpbmRFbnRUb0F0dHJSZWxhdGlvbnNoaXAobm9kZUEuYXR0cmlidXRlLmVudGl0eSwgbm9kZUIsIGNvbnRleHQpO1xuICB9IGVsc2UgaWYgKG5vZGVCLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuQVRUUklCVVRFKSAmJiAhKG5vZGVBLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuQ09MTEVDVElPTikgfHwgbm9kZUEuaGFzUHJvcGVydHkoUHJvcGVydGllcy5FTlRJVFkpKSkge1xuICAgIHJlbGF0aW9uc2hpcCA9IGZpbmRFbnRUb0F0dHJSZWxhdGlvbnNoaXAobm9kZUIuYXR0cmlidXRlLmVudGl0eSwgbm9kZUEsIGNvbnRleHQpO1xuICB9XG4gIC8vIElmIHdlIGZvdW5kIGEgcmVsYXRpb25zaGlwLCBhZGQgaXQgdG8gdGhlIGNvbnRleHRcbiAgaWYgKHJlbGF0aW9uc2hpcCAhPT0gdW5kZWZpbmVkICYmIHJlbGF0aW9uc2hpcC50eXBlICE9PSBSZWxhdGlvbnNoaXBUeXBlcy5OT05FKSB7XG4gICAgY29udGV4dC5yZWxhdGlvbnNoaXBzLnB1c2gocmVsYXRpb25zaGlwKTtcbiAgICByZXR1cm4gcmVsYXRpb25zaGlwOyBcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4ge3R5cGU6IFJlbGF0aW9uc2hpcFR5cGVzLk5PTkV9OyAgXG4gIH1cbn1cblxuLy8gZS5nLiBcIm1lZXRpbmdzIGpvaG4gd2FzIGluXCJcbmZ1bmN0aW9uIGZpbmRDb2xsZWN0aW9uVG9FbnRSZWxhdGlvbnNoaXAoY29sbDogQ29sbGVjdGlvbiwgZW50OiBFbnRpdHkpOiBSZWxhdGlvbnNoaXAge1xuICBsb2coYEZpbmRpbmcgQ29sbCAtPiBFbnQgcmVsYXRpb25zaGlwIGJldHdlZW4gXCIke2NvbGwuZGlzcGxheU5hbWV9XCIgYW5kIFwiJHtlbnQuZGlzcGxheU5hbWV9XCIuLi5gKTtcbiAgLyppZiAoY29sbCA9PT0gXCJjb2xsZWN0aW9uc1wiKSB7XG4gICAgaWYgKGV2ZS5maW5kT25lKFwiY29sbGVjdGlvbiBlbnRpdGllc1wiLCB7IGVudGl0eTogZW50LmlkIH0pKSB7XG4gICAgICByZXR1cm4geyB0eXBlOiBSZWxhdGlvbnNoaXBUeXBlcy5ESVJFQ1QgfTtcbiAgICB9XG4gIH0qL1xuICBpZiAoZXZlLmZpbmRPbmUoXCJjb2xsZWN0aW9uIGVudGl0aWVzXCIsIHsgY29sbGVjdGlvbjogY29sbC5pZCwgZW50aXR5OiBlbnQuaWQgfSkpIHtcbiAgICBsb2coXCJGb3VuZCBEaXJlY3QgcmVsYXRpb25zaGlwXCIpXG4gICAgcmV0dXJuIHsgdHlwZTogUmVsYXRpb25zaGlwVHlwZXMuRElSRUNUIH07XG4gIH1cbiAgXG4gIGxldCByZWxhdGlvbnNoaXAgPSBldmUucXVlcnkoYGApXG4gICAgLnNlbGVjdChcImNvbGxlY3Rpb24gZW50aXRpZXNcIiwgeyBjb2xsZWN0aW9uOiBjb2xsLmlkIH0sIFwiY29sbGVjdGlvblwiKVxuICAgIC5zZWxlY3QoXCJkaXJlY3Rpb25sZXNzIGxpbmtzXCIsIHsgZW50aXR5OiBbXCJjb2xsZWN0aW9uXCIsIFwiZW50aXR5XCJdLCBsaW5rOiBlbnQuaWQgfSwgXCJsaW5rc1wiKVxuICAgIC5leGVjKCk7XG4gIGlmIChyZWxhdGlvbnNoaXAudW5wcm9qZWN0ZWQubGVuZ3RoKSB7XG4gICAgbG9nKFwiRm91bmQgT25lLUhvcCBSZWxhdGlvbnNoaXBcIik7XG4gICAgcmV0dXJuIHsgdHlwZTogUmVsYXRpb25zaGlwVHlwZXMuT05FSE9QIH07XG4gIH0vKlxuICAvLyBlLmcuIGV2ZW50cyB3aXRoIGNocmlzIGdyYW5nZXIgKGV2ZW50cyAtPiBtZWV0aW5ncyAtPiBjaHJpcyBncmFuZ2VyKVxuICBsZXQgcmVsYXRpb25zaGlwczIgPSBldmUucXVlcnkoYGApXG4gICAgLnNlbGVjdChcImNvbGxlY3Rpb24gZW50aXRpZXNcIiwgeyBjb2xsZWN0aW9uOiBjb2xsIH0sIFwiY29sbGVjdGlvblwiKVxuICAgIC5zZWxlY3QoXCJkaXJlY3Rpb25sZXNzIGxpbmtzXCIsIHsgZW50aXR5OiBbXCJjb2xsZWN0aW9uXCIsIFwiZW50aXR5XCJdIH0sIFwibGlua3NcIilcbiAgICAuc2VsZWN0KFwiZGlyZWN0aW9ubGVzcyBsaW5rc1wiLCB7IGVudGl0eTogW1wibGlua3NcIiwgXCJsaW5rXCJdLCBsaW5rOiBlbnQgfSwgXCJsaW5rczJcIilcbiAgICAuZXhlYygpO1xuICBpZiAocmVsYXRpb25zaGlwczIudW5wcm9qZWN0ZWQubGVuZ3RoKSB7XG4gICAgbGV0IGVudGl0aWVzID0gZXh0cmFjdEZyb21VbnByb2plY3RlZChyZWxhdGlvbnNoaXBzMi51bnByb2plY3RlZCwgMSwgMyk7XG4gICAgcmV0dXJuIHsgdHlwZTogUmVsYXRpb25zaGlwVHlwZXMuVFdPSE9QIH07XG4gIH0qL1xuICBsb2coXCJObyByZWxhdGlvbnNoaXAgZm91bmQgOihcIik7XG4gIHJldHVybiB7IHR5cGU6IFJlbGF0aW9uc2hpcFR5cGVzLk5PTkUgfTtcbn1cblxuZnVuY3Rpb24gZmluZEVudFRvQXR0clJlbGF0aW9uc2hpcChlbnRpdHk6IEVudGl0eSwgYXR0cjogTm9kZSwgY29udGV4dDogQ29udGV4dCk6IFJlbGF0aW9uc2hpcCB7XG4gIGxvZyhgRmluZGluZyBFbnQgLT4gQXR0ciByZWxhdGlvbnNoaXAgYmV0d2VlbiBcIiR7ZW50aXR5LmRpc3BsYXlOYW1lfVwiIGFuZCBcIiR7YXR0ci5uYW1lfVwiLi4uYCk7XG4gIC8vIENoZWNrIGZvciBhIGRpcmVjdCByZWxhdGlvbnNoaXBcbiAgLy8gZS5nLiBcIkpvc2gncyBhZ2VcIlxuICBsZXQgZm91bmQgPSBmaW5kRW50aXR5QXR0cmlidXRlKGF0dHIsZW50aXR5LGNvbnRleHQpO1xuICBpZiAoZm91bmQgPT09IHRydWUpIHtcbiAgICByZXR1cm4geyB0eXBlOiBSZWxhdGlvbnNoaXBUeXBlcy5ESVJFQ1QgfTtcbiAgfVxuICAvLyBDaGVjayBmb3IgYSBvbmUtaG9wIHJlbGF0aW9uc2hpcFxuICAvLyBlLmcuIFwiU2FsYXJpZXMgaW4gZW5naW5lZXJpbmdcIlxuICBsZXQgcmVsYXRpb25zaGlwID0gZXZlLnF1ZXJ5KGBgKVxuICAgIC5zZWxlY3QoXCJkaXJlY3Rpb25sZXNzIGxpbmtzXCIsIHsgZW50aXR5OiBlbnRpdHkuaWQgfSwgXCJsaW5rc1wiKVxuICAgIC5zZWxlY3QoXCJlbnRpdHkgZWF2c1wiLCB7IGVudGl0eTogW1wibGlua3NcIiwgXCJsaW5rXCJdLCBhdHRyaWJ1dGU6IGF0dHIubmFtZSB9LCBcImVhdlwiKVxuICAgIC5leGVjKCk7XG4gIGlmIChyZWxhdGlvbnNoaXAudW5wcm9qZWN0ZWQubGVuZ3RoKSB7XG4gICAgbG9nKFwiRm91bmQgT25lLUhvcCBSZWxhdGlvbnNoaXBcIik7XG4gICAgbG9nKHJlbGF0aW9uc2hpcCk7XG4gICAgLy8gRmluZCB0aGUgb25lLWhvcCBsaW5rXG4gICAgbGV0IGVudGl0aWVzID0gZXh0cmFjdEZyb21VbnByb2plY3RlZChyZWxhdGlvbnNoaXAudW5wcm9qZWN0ZWQsIDAsIDIpO1xuICAgIGxldCBjb2xsZWN0aW9ucyA9IGZpbmRDb21tb25Db2xsZWN0aW9ucyhlbnRpdGllcylcbiAgICBsZXQgbGlua0lEO1xuICAgIGlmIChjb2xsZWN0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAvLyBASEFDSyBDaG9vc2UgdGhlIGNvcnJlY3QgY29sbGVjdGlvbiBpbiBhIHNtYXJ0IHdheS4gXG4gICAgICAvLyBMYXJnZXN0IGNvbGxlY3Rpb24gb3RoZXIgdGhhbiBlbnRpdHkgb3IgdGVzdGRhdGE/XG4gICAgICBsaW5rSUQgPSBjb2xsZWN0aW9uc1swXTsgIFxuICAgIH1cbiAgICBsZXQgZW50aXR5QXR0cmlidXRlOiBBdHRyaWJ1dGUgPSB7XG4gICAgICBpZDogYXR0ci5uYW1lLFxuICAgICAgZGlzcGxheU5hbWU6IGF0dHIubmFtZSxcbiAgICAgIHZhbHVlOiBgJHtlbnRpdHkuZGlzcGxheU5hbWV9fCR7YXR0ci5uYW1lfWAsXG4gICAgICB2YXJpYWJsZTogYCR7ZW50aXR5LmRpc3BsYXlOYW1lfXwke2F0dHIubmFtZX1gLFxuICAgICAgbm9kZTogYXR0cixcbiAgICAgIHByb2plY3Q6IHRydWUsXG4gICAgfVxuICAgIGF0dHIuYXR0cmlidXRlID0gZW50aXR5QXR0cmlidXRlO1xuICAgIGNvbnRleHQuYXR0cmlidXRlcy5wdXNoKGVudGl0eUF0dHJpYnV0ZSk7XG4gICAgYXR0ci5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5BVFRSSUJVVEUpO1xuICAgIGF0dHIuZm91bmQgPSB0cnVlO1xuICAgIHJldHVybiB7bGlua3M6IFtsaW5rSURdLCB0eXBlOiBSZWxhdGlvbnNoaXBUeXBlcy5PTkVIT1AsIG5vZGVzOiBbZW50aXR5Lm5vZGUsIGF0dHJdfTtcbiAgfVxuICAvKlxuICBsZXQgcmVsYXRpb25zaGlwczIgPSBldmUucXVlcnkoYGApXG4gICAgLnNlbGVjdChcImRpcmVjdGlvbmxlc3MgbGlua3NcIiwgeyBlbnRpdHk6IGVudGl0eS5pZCB9LCBcImxpbmtzXCIpXG4gICAgLnNlbGVjdChcImRpcmVjdGlvbmxlc3MgbGlua3NcIiwgeyBlbnRpdHk6IFtcImxpbmtzXCIsIFwibGlua1wiXSB9LCBcImxpbmtzMlwiKVxuICAgIC5zZWxlY3QoXCJlbnRpdHkgZWF2c1wiLCB7IGVudGl0eTogW1wibGlua3MyXCIsIFwibGlua1wiXSwgYXR0cmlidXRlOiBhdHRyIH0sIFwiZWF2XCIpXG4gICAgLmV4ZWMoKTtcbiAgaWYgKHJlbGF0aW9uc2hpcHMyLnVucHJvamVjdGVkLmxlbmd0aCkge1xuICAgIGxldCBlbnRpdGllcyA9IGV4dHJhY3RGcm9tVW5wcm9qZWN0ZWQocmVsYXRpb25zaGlwczIudW5wcm9qZWN0ZWQsIDAsIDMpO1xuICAgIGxldCBlbnRpdGllczIgPSBleHRyYWN0RnJvbVVucHJvamVjdGVkKHJlbGF0aW9uc2hpcHMyLnVucHJvamVjdGVkLCAxLCAzKTtcbiAgICAvL3JldHVybiB7IGRpc3RhbmNlOiAyLCB0eXBlOiBSZWxhdGlvbnNoaXBUeXBlcy5FTlRJVFlfQVRUUklCVVRFLCBub2RlczogW2ZpbmRDb21tb25Db2xsZWN0aW9ucyhlbnRpdGllcyksIGZpbmRDb21tb25Db2xsZWN0aW9ucyhlbnRpdGllczIpXSB9O1xuICB9Ki9cbiAgbG9nKFwiTm8gcmVsYXRpb25zaGlwIGZvdW5kIDooXCIpO1xuICByZXR1cm4geyB0eXBlOiBSZWxhdGlvbnNoaXBUeXBlcy5OT05FIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmaW5kQ29sbGVjdGlvblRvQ29sbGVjdGlvblJlbGF0aW9uc2hpcChjb2xsQTogQ29sbGVjdGlvbiwgY29sbEI6IENvbGxlY3Rpb24pOiBSZWxhdGlvbnNoaXAgeyAgXG4gIGxvZyhgRmluZGluZyBDb2xsIC0+IENvbGwgcmVsYXRpb25zaGlwIGJldHdlZW4gXCIke2NvbGxBLmRpc3BsYXlOYW1lfVwiIGFuZCBcIiR7Y29sbEIuZGlzcGxheU5hbWV9XCIuLi5gKTtcbiAgLy8gYXJlIHRoZXJlIHRoaW5ncyBpbiBib3RoIHNldHM/XG4gIGxldCBpbnRlcnNlY3Rpb24gPSBldmUucXVlcnkoYCR7Y29sbEEuZGlzcGxheU5hbWV9LT4ke2NvbGxCLmRpc3BsYXlOYW1lfWApXG4gICAgLnNlbGVjdChcImNvbGxlY3Rpb24gZW50aXRpZXNcIiwgeyBjb2xsZWN0aW9uOiBjb2xsQS5pZCB9LCBcImNvbGxBXCIpXG4gICAgLnNlbGVjdChcImNvbGxlY3Rpb24gZW50aXRpZXNcIiwgeyBjb2xsZWN0aW9uOiBjb2xsQi5pZCwgZW50aXR5OiBbXCJjb2xsQVwiLCBcImVudGl0eVwiXSB9LCBcImNvbGxCXCIpXG4gICAgLmV4ZWMoKTtcbiAgLy8gaXMgdGhlcmUgYSByZWxhdGlvbnNoaXAgYmV0d2VlbiB0aGluZ3MgaW4gYm90aCBzZXRzXG4gIGxldCByZWxhdGlvbnNoaXBzID0gZXZlLnF1ZXJ5KGByZWxhdGlvbnNoaXBzIGJldHdlZW4gJHtjb2xsQS5kaXNwbGF5TmFtZX0gYW5kICR7Y29sbEIuZGlzcGxheU5hbWV9YClcbiAgICAuc2VsZWN0KFwiY29sbGVjdGlvbiBlbnRpdGllc1wiLCB7IGNvbGxlY3Rpb246IGNvbGxBLmlkIH0sIFwiY29sbEFcIilcbiAgICAuc2VsZWN0KFwiZGlyZWN0aW9ubGVzcyBsaW5rc1wiLCB7IGVudGl0eTogW1wiY29sbEFcIiwgXCJlbnRpdHlcIl0gfSwgXCJsaW5rc1wiKVxuICAgIC5zZWxlY3QoXCJjb2xsZWN0aW9uIGVudGl0aWVzXCIsIHsgY29sbGVjdGlvbjogY29sbEIuaWQsIGVudGl0eTogW1wibGlua3NcIiwgXCJsaW5rXCJdIH0sIFwiY29sbEJcIilcbiAgICAuZ3JvdXAoW1tcImxpbmtzXCIsIFwibGlua1wiXV0pXG4gICAgLmFnZ3JlZ2F0ZShcImNvdW50XCIsIHt9LCBcImNvdW50XCIpXG4gICAgLnByb2plY3QoeyB0eXBlOiBbXCJsaW5rc1wiLCBcImxpbmtcIl0sIGNvdW50OiBbXCJjb3VudFwiLCBcImNvdW50XCJdIH0pXG4gICAgLmV4ZWMoKTtcbiAgbGV0IG1heFJlbCA9IHsgY291bnQ6IDAgfTtcbiAgZm9yIChsZXQgcmVzdWx0IG9mIHJlbGF0aW9uc2hpcHMucmVzdWx0cykge1xuICAgIGlmIChyZXN1bHQuY291bnQgPiBtYXhSZWwuY291bnQpIG1heFJlbCA9IHJlc3VsdDtcbiAgfVxuXG4gIC8vIHdlIGRpdmlkZSBieSB0d28gYmVjYXVzZSB1bnByb2plY3RlZCByZXN1bHRzIHBhY2sgcm93cyBuZXh0IHRvIGVhY2hvdGhlclxuICAvLyBhbmQgd2UgaGF2ZSB0d28gc2VsZWN0cy5cbiAgbGV0IGludGVyc2VjdGlvblNpemUgPSBpbnRlcnNlY3Rpb24udW5wcm9qZWN0ZWQubGVuZ3RoIC8gMjtcbiAgICBcbiAgaWYgKG1heFJlbC5jb3VudCA+IGludGVyc2VjdGlvblNpemUpIHtcbiAgICAvLyBAVE9ET1xuICAgIHJldHVybiB7dHlwZTogUmVsYXRpb25zaGlwVHlwZXMuTk9ORX07XG4gIH0gZWxzZSBpZiAoaW50ZXJzZWN0aW9uU2l6ZSA+IG1heFJlbC5jb3VudCkge1xuICAgIHJldHVybiB7dHlwZTogUmVsYXRpb25zaGlwVHlwZXMuSU5URVJTRUNUSU9OLCBub2RlczogW2NvbGxBLm5vZGUsIGNvbGxCLm5vZGVdfTtcbiAgfSBlbHNlIGlmIChtYXhSZWwuY291bnQgPT09IDAgJiYgaW50ZXJzZWN0aW9uU2l6ZSA9PT0gMCkge1xuICAgIHJldHVybiB7dHlwZTogUmVsYXRpb25zaGlwVHlwZXMuTk9ORX07XG4gIH0gZWxzZSB7XG4gICAgLy8gQFRPRE9cbiAgICByZXR1cm4ge3R5cGU6IFJlbGF0aW9uc2hpcFR5cGVzLk5PTkV9O1xuICB9XG59XG5cbmZ1bmN0aW9uIGZpbmRDb2xsZWN0aW9uVG9BdHRyUmVsYXRpb25zaGlwKGNvbGw6IENvbGxlY3Rpb24sIGF0dHI6IE5vZGUsIGNvbnRleHQ6IENvbnRleHQpOiBSZWxhdGlvbnNoaXAge1xuICAvLyBGaW5kcyBhIGRpcmVjdCByZWxhdGlvbnNoaXAgYmV0d2VlbiBjb2xsZWN0aW9uIGFuZCBhdHRyaWJ1dGVcbiAgLy8gZS5nLiBcInBldHMnIGxlbmd0aHNcIlwiID0+IHBldCAtPiBsZW5ndGhcbiAgbG9nKGBGaW5kaW5nIENvbGwgLT4gQXR0ciByZWxhdGlvbnNoaXAgYmV0d2VlbiBcIiR7Y29sbC5kaXNwbGF5TmFtZX1cIiBhbmQgXCIke2F0dHIubmFtZX1cIi4uLmApO1xuICBsZXQgcmVsYXRpb25zaGlwID0gZXZlLnF1ZXJ5KGBgKVxuICAgIC5zZWxlY3QoXCJjb2xsZWN0aW9uIGVudGl0aWVzXCIsIHsgY29sbGVjdGlvbjogY29sbC5pZCB9LCBcImNvbGxlY3Rpb25cIilcbiAgICAuc2VsZWN0KFwiZW50aXR5IGVhdnNcIiwgeyBlbnRpdHk6IFtcImNvbGxlY3Rpb25cIiwgXCJlbnRpdHlcIl0sIGF0dHJpYnV0ZTogYXR0ci5uYW1lIH0sIFwiZWF2XCIpXG4gICAgLmV4ZWMoKTtcbiAgaWYgKHJlbGF0aW9uc2hpcC51bnByb2plY3RlZC5sZW5ndGggPiAwKSB7ICAgIFxuICAgIGxvZyhcIkZvdW5kIERpcmVjdCBSZWxhdGlvbnNoaXBcIik7XG4gICAgbGV0IGNvbGxlY3Rpb25BdHRyaWJ1dGU6IEF0dHJpYnV0ZSA9IHtcbiAgICAgIGlkOiBhdHRyLm5hbWUsXG4gICAgICBkaXNwbGF5TmFtZTogYXR0ci5uYW1lLFxuICAgICAgY29sbGVjdGlvbjogY29sbCxcbiAgICAgIHZhbHVlOiBgJHtjb2xsLmRpc3BsYXlOYW1lfXwke2F0dHIubmFtZX1gLFxuICAgICAgdmFyaWFibGU6IGAke2NvbGwuZGlzcGxheU5hbWV9fCR7YXR0ci5uYW1lfWAsXG4gICAgICBub2RlOiBhdHRyLFxuICAgICAgcHJvamVjdDogdHJ1ZSxcbiAgICB9XG4gICAgYXR0ci5hdHRyaWJ1dGUgPSBjb2xsZWN0aW9uQXR0cmlidXRlO1xuICAgIGNvbnRleHQuYXR0cmlidXRlcy5wdXNoKGNvbGxlY3Rpb25BdHRyaWJ1dGUpO1xuICAgIGF0dHIucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuQVRUUklCVVRFKTtcbiAgICBhdHRyLmZvdW5kID0gdHJ1ZTtcbiAgICByZXR1cm4ge3R5cGU6IFJlbGF0aW9uc2hpcFR5cGVzLkRJUkVDVCwgbm9kZXM6IFtjb2xsLm5vZGUsIGF0dHJdfTtcbiAgfVxuICAvLyBGaW5kcyBhIG9uZSBob3AgcmVsYXRpb25zaGlwXG4gIC8vIGUuZy4gXCJkZXBhcnRtZW50IHNhbGFyaWVzXCIgPT4gZGVwYXJ0bWVudCAtPiBlbXBsb3llZSAtPiBzYWxhcnlcbiAgcmVsYXRpb25zaGlwID0gZXZlLnF1ZXJ5KGBgKVxuICAgIC5zZWxlY3QoXCJjb2xsZWN0aW9uIGVudGl0aWVzXCIsIHsgY29sbGVjdGlvbjogY29sbC5pZCB9LCBcImNvbGxlY3Rpb25cIilcbiAgICAuc2VsZWN0KFwiZGlyZWN0aW9ubGVzcyBsaW5rc1wiLCB7IGVudGl0eTogW1wiY29sbGVjdGlvblwiLCBcImVudGl0eVwiXSB9LCBcImxpbmtzXCIpXG4gICAgLnNlbGVjdChcImVudGl0eSBlYXZzXCIsIHsgZW50aXR5OiBbXCJsaW5rc1wiLCBcImxpbmtcIl0sIGF0dHJpYnV0ZTogYXR0ci5uYW1lIH0sIFwiZWF2XCIpXG4gICAgLmV4ZWMoKTtcbiAgaWYgKHJlbGF0aW9uc2hpcC51bnByb2plY3RlZC5sZW5ndGggPiAwKSB7XG4gICAgbG9nKFwiRm91bmQgT25lLUhvcCBSZWxhdGlvbnNoaXBcIik7XG4gICAgbG9nKHJlbGF0aW9uc2hpcClcbiAgICAvLyBGaW5kIHRoZSBvbmUtaG9wIGxpbmtcbiAgICBsZXQgZW50aXRpZXMgPSBleHRyYWN0RnJvbVVucHJvamVjdGVkKHJlbGF0aW9uc2hpcC51bnByb2plY3RlZCwgMSwgMyk7XG4gICAgbGV0IGNvbGxlY3Rpb25zID0gZmluZENvbW1vbkNvbGxlY3Rpb25zKGVudGl0aWVzKVxuICAgIGxldCBsaW5rSUQ7XG4gICAgaWYgKGNvbGxlY3Rpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgIC8vIEBIQUNLIENob29zZSB0aGUgY29ycmVjdCBjb2xsZWN0aW9uIGluIGEgc21hcnQgd2F5LiBcbiAgICAgIC8vIExhcmdlc3QgY29sbGVjdGlvbiBvdGhlciB0aGFuIGVudGl0eSBvciB0ZXN0ZGF0YT9cbiAgICAgIGxpbmtJRCA9IGNvbGxlY3Rpb25zWzBdOyAgXG4gICAgfVxuICAgIC8vIEJ1aWxkIGFuIGF0dHJpYnV0ZSBmb3IgdGhlIG5vZGVcbiAgICBsZXQgYXR0cmlidXRlOiBBdHRyaWJ1dGUgPSB7XG4gICAgICAgIGlkOiBhdHRyLm5hbWUsXG4gICAgICAgIGRpc3BsYXlOYW1lOiBhdHRyLm5hbWUsXG4gICAgICAgIGNvbGxlY3Rpb246IGNvbGwsXG4gICAgICAgIHZhbHVlOiBgJHtjb2xsLmRpc3BsYXlOYW1lfXwke2F0dHIubmFtZX1gLFxuICAgICAgICB2YXJpYWJsZTogYCR7Y29sbC5kaXNwbGF5TmFtZX18JHthdHRyLm5hbWV9YCxcbiAgICAgICAgbm9kZTogYXR0cixcbiAgICAgICAgcHJvamVjdDogdHJ1ZSxcbiAgICB9O1xuICAgIGF0dHIuYXR0cmlidXRlID0gYXR0cmlidXRlO1xuICAgIGNvbnRleHQuYXR0cmlidXRlcy5wdXNoKGF0dHJpYnV0ZSk7XG4gICAgYXR0ci5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5BVFRSSUJVVEUpO1xuICAgIGF0dHIuZm91bmQgPSB0cnVlO1xuICAgIHJldHVybiB7bGlua3M6IFtsaW5rSURdLCB0eXBlOiBSZWxhdGlvbnNoaXBUeXBlcy5PTkVIT1AsIG5vZGVzOiBbY29sbC5ub2RlLCBhdHRyXX07XG4gIH1cbiAgLy8gTm90IHN1cmUgaWYgdGhpcyBvbmUgd29ya3MuLi4gdXNpbmcgdGhlIGVudGl0eSB0YWJsZSwgYSAyIGhvcCBsaW5rIGNhblxuICAvLyBiZSBmb3VuZCBhbG1vc3QgYW55d2hlcmUsIHlpZWxkaW5nIHJlc3VsdHMgbGlrZVxuICAvLyBlLmcuIFwiUGV0cyBoZWlnaHRzXCIgPT4gcGV0cyAtPiBzbmFrZSAtPiBlbnRpdHkgLT4gY29yZXkgLT4gaGVpZ2h0XG4gIC8qcmVsYXRpb25zaGlwID0gZXZlLnF1ZXJ5KGBgKVxuICAgIC5zZWxlY3QoXCJjb2xsZWN0aW9uIGVudGl0aWVzXCIsIHsgY29sbGVjdGlvbjogY29sbC5pZCB9LCBcImNvbGxlY3Rpb25cIilcbiAgICAuc2VsZWN0KFwiZGlyZWN0aW9ubGVzcyBsaW5rc1wiLCB7IGVudGl0eTogW1wiY29sbGVjdGlvblwiLCBcImVudGl0eVwiXSB9LCBcImxpbmtzXCIpXG4gICAgLnNlbGVjdChcImRpcmVjdGlvbmxlc3MgbGlua3NcIiwgeyBlbnRpdHk6IFtcImxpbmtzXCIsIFwibGlua1wiXSB9LCBcImxpbmtzMlwiKVxuICAgIC5zZWxlY3QoXCJlbnRpdHkgZWF2c1wiLCB7IGVudGl0eTogW1wibGlua3MyXCIsIFwibGlua1wiXSwgYXR0cmlidXRlOiBhdHRyIH0sIFwiZWF2XCIpXG4gICAgLmV4ZWMoKTtcbiAgaWYgKHJlbGF0aW9uc2hpcC51bnByb2plY3RlZC5sZW5ndGggPiAwKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0qL1xuICBsb2coXCJObyByZWxhdGlvbnNoaXAgZm91bmQgOihcIik7XG4gIHJldHVybiB7dHlwZTogUmVsYXRpb25zaGlwVHlwZXMuTk9ORX07XG59XG5cbi8vIEV4dHJhY3RzIGVudGl0aWVzIGZyb20gdW5wcm9qZWN0ZWQgcmVzdWx0c1xuZnVuY3Rpb24gZXh0cmFjdEZyb21VbnByb2plY3RlZChjb2xsLCBpeDogbnVtYmVyLCBzaXplOiBudW1iZXIpIHtcbiAgbGV0IHJlc3VsdHMgPSBbXTtcbiAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IGNvbGwubGVuZ3RoOyBpIDwgbGVuOyBpICs9IHNpemUpIHtcbiAgICByZXN1bHRzLnB1c2goY29sbFtpICsgaXhdW1wibGlua1wiXSk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdHM7XG59XG5cbi8vIEZpbmQgY29sbGVjdGlvbnMgdGhhdCBlbnRpdGllcyBoYXZlIGluIGNvbW1vblxuZnVuY3Rpb24gZmluZENvbW1vbkNvbGxlY3Rpb25zKGVudGl0aWVzOiBBcnJheTxzdHJpbmc+KTogQXJyYXk8c3RyaW5nPiB7XG4gIGxldCBpbnRlcnNlY3Rpb24gPSBlbnRpdHlUb2NvbGxlY3Rpb25zQXJyYXkoZW50aXRpZXNbMF0pO1xuICBpbnRlcnNlY3Rpb24uc29ydCgpO1xuICBmb3IgKGxldCBlbnRJZCBvZiBlbnRpdGllcy5zbGljZSgxKSkge1xuICAgIGxldCBjdXIgPSBlbnRpdHlUb2NvbGxlY3Rpb25zQXJyYXkoZW50SWQpO1xuICAgIGN1ci5zb3J0KCk7XG4gICAgYXJyYXlJbnRlcnNlY3QoaW50ZXJzZWN0aW9uLCBjdXIpO1xuICB9XG4gIGludGVyc2VjdGlvbi5zb3J0KChhLCBiKSA9PiB7XG4gICAgcmV0dXJuIGV2ZS5maW5kT25lKFwiY29sbGVjdGlvblwiLCB7IGNvbGxlY3Rpb246IGEgfSlbXCJjb3VudFwiXSAtIGV2ZS5maW5kT25lKFwiY29sbGVjdGlvblwiLCB7IGNvbGxlY3Rpb246IGIgfSlbXCJjb3VudFwiXTtcbiAgfSk7XG4gIHJldHVybiBpbnRlcnNlY3Rpb247XG59XG5cbmZ1bmN0aW9uIGVudGl0eVRvY29sbGVjdGlvbnNBcnJheShlbnRpdHk6IHN0cmluZyk6IEFycmF5PHN0cmluZz4ge1xuICBsZXQgZW50aXRpZXMgPSBldmUuZmluZChcImNvbGxlY3Rpb24gZW50aXRpZXNcIiwgeyBlbnRpdHkgfSk7XG4gIHJldHVybiBlbnRpdGllcy5tYXAoKGEpID0+IGFbXCJjb2xsZWN0aW9uXCJdKTtcbn1cblxuZnVuY3Rpb24gZmluZENvbGxlY3Rpb25BdHRyaWJ1dGUobm9kZTogTm9kZSwgY29sbGVjdGlvbjogQ29sbGVjdGlvbiwgY29udGV4dDogQ29udGV4dCwgcmVsYXRpb25zaGlwOiBSZWxhdGlvbnNoaXApOiBib29sZWFuIHtcbiAgXG4gIC8vIFRoZSBhdHRyaWJ1dGUgaXMgYW4gYXR0cmlidXRlIG9mIG1lbWJlcnMgb2YgdGhlIGNvbGxlY3Rpb25cbiAgaWYgKHJlbGF0aW9uc2hpcC50eXBlID09PSBSZWxhdGlvbnNoaXBUeXBlcy5ESVJFQ1QpIHtcbiAgICBsZXQgY29sbGVjdGlvbkF0dHJpYnV0ZTogQXR0cmlidXRlID0ge1xuICAgICAgaWQ6IG5vZGUubmFtZSxcbiAgICAgIGRpc3BsYXlOYW1lOiBub2RlLm5hbWUsXG4gICAgICBjb2xsZWN0aW9uOiBjb2xsZWN0aW9uLFxuICAgICAgdmFsdWU6IGAke2NvbGxlY3Rpb24uZGlzcGxheU5hbWV9fCR7bm9kZS5uYW1lfWAsXG4gICAgICB2YXJpYWJsZTogYCR7Y29sbGVjdGlvbi5kaXNwbGF5TmFtZX18JHtub2RlLm5hbWV9YCxcbiAgICAgIG5vZGU6IG5vZGUsXG4gICAgICBwcm9qZWN0OiB0cnVlLFxuICAgIH1cbiAgICBub2RlLmF0dHJpYnV0ZSA9IGNvbGxlY3Rpb25BdHRyaWJ1dGU7XG4gICAgY29udGV4dC5hdHRyaWJ1dGVzLnB1c2goY29sbGVjdGlvbkF0dHJpYnV0ZSk7XG4gICAgbm9kZS5mb3VuZCA9IHRydWU7XG4gICAgcmV0dXJuIHRydWU7XG4gIC8vIFRoZSBhdHRyaWJ1dGUgaXMgYW4gYXR0cmlidXRlIG9mIG1lbWJlcnMgb2YgYSBjb2xsZWN0aW9uIHdoaWNoIGFyZVxuICAvLyBhbHNvIG1lbWJlcnMgb2YgdGhpcyBjb2xsZWN0aW9uXG4gIH0gZWxzZSBpZiAocmVsYXRpb25zaGlwLnR5cGUgPT09IFJlbGF0aW9uc2hpcFR5cGVzLk9ORUhPUCkge1xuICAgIGxldCBsaW5rSUQgPSByZWxhdGlvbnNoaXAubGlua3NbMF07XG4gICAgbGV0IG5Db2xsZWN0aW9uID0gZmluZEV2ZUNvbGxlY3Rpb24obGlua0lEKTtcbiAgICBpZiAobkNvbGxlY3Rpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgLy8gQ3JlYXRlIGEgbmV3IGxpbmsgbm9kZVxuICAgICAgbGV0IHRva2VuOiBUb2tlbiA9IHtcbiAgICAgICAgaXg6IDAsIFxuICAgICAgICBvcmlnaW5hbFdvcmQ6IG5Db2xsZWN0aW9uLmRpc3BsYXlOYW1lLCBcbiAgICAgICAgbm9ybWFsaXplZFdvcmQ6IG5Db2xsZWN0aW9uLmRpc3BsYXlOYW1lLCBcbiAgICAgICAgUE9TOiBNaW5vclBhcnRzT2ZTcGVlY2guTk4sXG4gICAgICAgIHByb3BlcnRpZXM6IFtdLCBcbiAgICAgIH07XG4gICAgICBsZXQgbk5vZGUgPSBuZXdOb2RlKHRva2VuKTtcbiAgICAgIGluc2VydEFmdGVyTm9kZShuTm9kZSxjb2xsZWN0aW9uLm5vZGUpO1xuICAgICAgbk5vZGUuY29sbGVjdGlvbiA9IG5Db2xsZWN0aW9uO1xuICAgICAgbkNvbGxlY3Rpb24ubm9kZSA9IG5Ob2RlO1xuICAgICAgY29udGV4dC5jb2xsZWN0aW9ucy5wdXNoKG5Db2xsZWN0aW9uKTtcbiAgICAgIC8vIEJ1aWxkIGEgY29sbGVjdGlvbiBhdHRyaWJ1dGUgdG8gbGluayB3aXRoIHBhcmVudFxuICAgICAgbGV0IGNvbGxlY3Rpb25BdHRyaWJ1dGU6IEF0dHJpYnV0ZSA9IHtcbiAgICAgICAgaWQ6IGNvbGxlY3Rpb24uZGlzcGxheU5hbWUsXG4gICAgICAgIGRpc3BsYXlOYW1lOiBjb2xsZWN0aW9uLmRpc3BsYXlOYW1lLFxuICAgICAgICBjb2xsZWN0aW9uOiBuQ29sbGVjdGlvbixcbiAgICAgICAgdmFsdWU6IGAke2NvbGxlY3Rpb24uZGlzcGxheU5hbWV9YCxcbiAgICAgICAgdmFyaWFibGU6IGAke2NvbGxlY3Rpb24uZGlzcGxheU5hbWV9YCxcbiAgICAgICAgbm9kZTogbk5vZGUsXG4gICAgICAgIHByb2plY3Q6IGZhbHNlLFxuICAgICAgfVxuICAgICAgbk5vZGUuYXR0cmlidXRlID0gY29sbGVjdGlvbkF0dHJpYnV0ZTtcbiAgICAgIGNvbnRleHQuYXR0cmlidXRlcy5wdXNoKGNvbGxlY3Rpb25BdHRyaWJ1dGUpO1xuICAgICAgbk5vZGUuZm91bmQgPSB0cnVlO1xuICAgICAgLy8gQnVpbGQgYW4gYXR0cmlidXRlIGZvciB0aGUgcmVmZXJlbmNlZCBub2RlXG4gICAgICBsZXQgYXR0cmlidXRlOiBBdHRyaWJ1dGUgPSB7XG4gICAgICAgIGlkOiBub2RlLm5hbWUsXG4gICAgICAgIGRpc3BsYXlOYW1lOiBub2RlLm5hbWUsXG4gICAgICAgIGNvbGxlY3Rpb246IG5Db2xsZWN0aW9uLFxuICAgICAgICB2YWx1ZTogYCR7bkNvbGxlY3Rpb24uZGlzcGxheU5hbWV9fCR7bm9kZS5uYW1lfWAsXG4gICAgICAgIHZhcmlhYmxlOiBgJHtuQ29sbGVjdGlvbi5kaXNwbGF5TmFtZX18JHtub2RlLm5hbWV9YCxcbiAgICAgICAgbm9kZTogbm9kZSxcbiAgICAgICAgcHJvamVjdDogdHJ1ZSxcbiAgICAgIH1cbiAgICAgIG5vZGUuYXR0cmlidXRlID0gYXR0cmlidXRlO1xuICAgICAgY29udGV4dC5hdHRyaWJ1dGVzLnB1c2goYXR0cmlidXRlKTtcbiAgICAgIG5vZGUuZm91bmQgPSB0cnVlOyBcbiAgICAgIHJldHVybiB0cnVlOyAgICAgICAgICAgICBcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IGVudGl0eSA9IGZpbmRFdmVFbnRpdHkobGlua0lEKTtcbiAgICAgIGlmIChlbnRpdHkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAvLyBAVE9ETyBoYW5kbGUgZW50aXRpZXNcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBmaW5kRW50aXR5QXR0cmlidXRlKG5vZGU6IE5vZGUsIGVudGl0eTogRW50aXR5LCBjb250ZXh0OiBDb250ZXh0KTogYm9vbGVhbiB7XG4gIGxldCBhdHRyaWJ1dGUgPSBmaW5kRXZlQXR0cmlidXRlKG5vZGUubmFtZSxlbnRpdHkpO1xuICBpZiAoYXR0cmlidXRlICE9PSB1bmRlZmluZWQpIHtcbiAgICBpZiAoaXNOdW1lcmljKGF0dHJpYnV0ZS52YWx1ZSkpIHtcbiAgICAgIG5vZGUucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuUVVBTlRJVFkpO1xuICAgIH1cbiAgICBjb250ZXh0LmF0dHJpYnV0ZXMucHVzaChhdHRyaWJ1dGUpO1xuICAgIG5vZGUuYXR0cmlidXRlID0gYXR0cmlidXRlO1xuICAgIG5vZGUucHJvcGVydGllcy5wdXNoKFByb3BlcnRpZXMuQVRUUklCVVRFKTtcbiAgICBhdHRyaWJ1dGUubm9kZSA9IG5vZGU7XG4gICAgLy8gSWYgdGhlIG5vZGUgaXMgcG9zc2Vzc2l2ZSwgY2hlY2sgdG8gc2VlIGlmIGl0IGlzIGFuIGVudGl0eVxuICAgIGlmIChub2RlLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuUE9TU0VTU0lWRSkgfHwgbm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkJBQ0tSRUxBVElPTlNISVApKSB7XG4gICAgICBsZXQgZW50aXR5ID0gZmluZEV2ZUVudGl0eShgJHthdHRyaWJ1dGUudmFsdWV9YCk7XG4gICAgICBpZiAoZW50aXR5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgbm9kZS5lbnRpdHkgPSBlbnRpdHk7XG4gICAgICAgIGVudGl0eS52YXJpYWJsZSA9IGF0dHJpYnV0ZS52YXJpYWJsZTtcbiAgICAgICAgZW50aXR5LmVudGl0eUF0dHJpYnV0ZSA9IHRydWU7XG4gICAgICAgIGVudGl0eS5ub2RlID0gbm9kZTtcbiAgICAgICAgbm9kZS5wYXJlbnQuZW50aXR5LnByb2plY3QgPSBmYWxzZTtcbiAgICAgICAgYXR0cmlidXRlLnByb2plY3QgPSBmYWxzZTtcbiAgICAgICAgY29udGV4dC5lbnRpdGllcy5wdXNoKGVudGl0eSk7IFxuICAgICAgICBub2RlLnByb3BlcnRpZXMucHVzaChQcm9wZXJ0aWVzLkVOVElUWSk7XG4gICAgICB9XG4gICAgfVxuICAgIG5vZGUuZm91bmQgPSB0cnVlO1xuICAgIGxldCBlbnRpdHlOb2RlID0gZW50aXR5Lm5vZGU7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG4vLyBzZWFyY2hlcyBmb3IgYSBjb2xsZWN0aW9uIGZpcnN0LCB0aGVuIHRyaWVzIHRvIGZpbmQgYW4gZW50aXR5XG5mdW5jdGlvbiBmaW5kQ29sbGVjdGlvbk9yRW50aXR5KG5vZGU6IE5vZGUsIGNvbnRleHQ6IENvbnRleHQpOiBib29sZWFuIHtcbiAgbGV0IGZvdW5kQ29sbGVjdGlvbiA9IGZpbmRDb2xsZWN0aW9uKG5vZGUsY29udGV4dCk7XG4gIGlmIChmb3VuZENvbGxlY3Rpb24gPT09IHRydWUpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgZm91bmRFbnRpdHkgPSBmaW5kRW50aXR5KG5vZGUsY29udGV4dCk7XG4gICAgaWYgKGZvdW5kRW50aXR5ID09PSB0cnVlKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG4vLyBzZWFyY2hlcyBmb3IgYSBjb2xsZWN0aW9uIGZpcnN0LCB0aGVuIHRyaWVzIHRvIGZpbmQgYW4gZW50aXR5XG5mdW5jdGlvbiBmaW5kRW50aXR5T3JDb2xsZWN0aW9uKG5vZGU6IE5vZGUsIGNvbnRleHQ6IENvbnRleHQpOiBib29sZWFuIHtcbiAgbGV0IGZvdW5kRW50aXR5ID0gZmluZEVudGl0eShub2RlLGNvbnRleHQpO1xuICBpZiAoZm91bmRFbnRpdHkgPT09IHRydWUpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgZm91bmRDb2xsZWN0aW9uID0gZmluZENvbGxlY3Rpb24obm9kZSxjb250ZXh0KTtcbiAgICBpZiAoZm91bmRDb2xsZWN0aW9uID09PSB0cnVlKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiBmaW5kQ29sbGVjdGlvbihub2RlOiBOb2RlLCBjb250ZXh0OiBDb250ZXh0KTogYm9vbGVhbiB7XG4gIGxldCBjb2xsZWN0aW9uID0gZmluZEV2ZUNvbGxlY3Rpb24obm9kZS5uYW1lKTtcbiAgaWYgKGNvbGxlY3Rpb24gIT09IHVuZGVmaW5lZCkge1xuICAgIGNvbnRleHQuY29sbGVjdGlvbnMucHVzaChjb2xsZWN0aW9uKTtcbiAgICBjb2xsZWN0aW9uLm5vZGUgPSBub2RlO1xuICAgIG5vZGUuY29sbGVjdGlvbiA9IGNvbGxlY3Rpb247XG4gICAgbm9kZS5mb3VuZCA9IHRydWU7XG4gICAgbm9kZS5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5DT0xMRUNUSU9OKVxuICAgIGlmIChub2RlLmhhc1Byb3BlcnR5KFByb3BlcnRpZXMuR1JPVVBJTkcpKSB7XG4gICAgICBjb250ZXh0Lmdyb3VwaW5ncy5wdXNoKG5vZGUpO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICByZXR1cm4gZmFsc2U7XG59XG5cbmZ1bmN0aW9uIGZpbmRFbnRpdHkobm9kZTogTm9kZSwgY29udGV4dDogQ29udGV4dCk6IGJvb2xlYW4ge1xuICBsZXQgZW50aXR5ID0gZmluZEV2ZUVudGl0eShub2RlLm5hbWUpO1xuICBpZiAoZW50aXR5ICE9PSB1bmRlZmluZWQpIHtcbiAgICBjb250ZXh0LmVudGl0aWVzLnB1c2goZW50aXR5KTtcbiAgICBlbnRpdHkubm9kZSA9IG5vZGU7XG4gICAgbm9kZS5lbnRpdHkgPSBlbnRpdHk7XG4gICAgbm9kZS5mb3VuZCA9IHRydWU7XG4gICAgbm9kZS5wcm9wZXJ0aWVzLnB1c2goUHJvcGVydGllcy5FTlRJVFkpXG4gICAgaWYgKG5vZGUuaGFzUHJvcGVydHkoUHJvcGVydGllcy5HUk9VUElORykpIHtcbiAgICAgIGNvbnRleHQuZ3JvdXBpbmdzLnB1c2gobm9kZSk7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gUXVlcnkgZnVuY3Rpb25zXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmludGVyZmFjZSBGaWVsZCB7XG4gIG5hbWU6IHN0cmluZyxcbiAgdmFsdWU6IHN0cmluZyB8IG51bWJlcixcbiAgdmFyaWFibGU6IGJvb2xlYW4sXG59XG5cbmludGVyZmFjZSBUZXJtIHtcbiAgdHlwZTogc3RyaW5nLFxuICB0YWJsZT86IHN0cmluZyxcbiAgZmllbGRzOiBBcnJheTxGaWVsZD5cbiAgcHJvamVjdD86IEFycmF5PHN0cmluZz4sXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUXVlcnkge1xuICB0eXBlOiBzdHJpbmcsXG4gIHRlcm1zOiBBcnJheTxUZXJtPixcbiAgc3VicXVlcmllczogQXJyYXk8UXVlcnk+LFxuICBwcm9qZWN0czogQXJyYXk8VGVybT4sXG4gIHRvU3RyaW5nKG51bWJlcj86IG51bWJlcik6IHN0cmluZztcbn1cblxuXG5mdW5jdGlvbiBuZWdhdGVUZXJtKHRlcm06IFRlcm0pOiBRdWVyeSB7XG4gIGxldCBuZWdhdGUgPSBuZXdRdWVyeShbdGVybV0pO1xuICBuZWdhdGUudHlwZSA9IFwibmVnYXRlXCI7XG4gIHJldHVybiBuZWdhdGU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBuZXdRdWVyeSh0ZXJtcz86IEFycmF5PFRlcm0+LCBzdWJxdWVyaWVzPzogQXJyYXk8UXVlcnk+LCBwcm9qZWN0cz86IEFycmF5PFRlcm0+KTogUXVlcnkge1xuICBpZiAodGVybXMgPT09IHVuZGVmaW5lZCkge1xuICAgIHRlcm1zID0gW107XG4gIH1cbiAgaWYgKHN1YnF1ZXJpZXMgPT09IHVuZGVmaW5lZCkge1xuICAgIHN1YnF1ZXJpZXMgPSBbXTtcbiAgfVxuICBpZiAocHJvamVjdHMgPT09IHVuZGVmaW5lZCkge1xuICAgIHByb2plY3RzID0gW107XG4gIH1cbiAgLy8gRGVkdXBlIHRlcm1zXG4gIGxldCB0ZXJtU3RyaW5ncyA9IHRlcm1zLm1hcCh0ZXJtVG9TdHJpbmcpO1xuICBsZXQgdW5pcXVlVGVybXM6IEFycmF5PGJvb2xlYW4+ID0gdGVybVN0cmluZ3MubWFwKCh2YWx1ZSwgaW5kZXgsIHNlbGYpID0+IHtcbiAgICByZXR1cm4gc2VsZi5pbmRleE9mKHZhbHVlKSA9PT0gaW5kZXg7XG4gIH0pOyBcbiAgdGVybXMgPSB0ZXJtcy5maWx0ZXIoKHRlcm0sIGluZGV4KSA9PiB1bmlxdWVUZXJtc1tpbmRleF0pO1xuICBsZXQgcXVlcnk6IFF1ZXJ5ID0ge1xuICAgIHR5cGU6IFwicXVlcnlcIixcbiAgICB0ZXJtczogdGVybXMsXG4gICAgc3VicXVlcmllczogc3VicXVlcmllcyxcbiAgICBwcm9qZWN0czogcHJvamVjdHMsXG4gICAgdG9TdHJpbmc6IHF1ZXJ5VG9TdHJpbmcsXG4gIH1cbiAgZnVuY3Rpb24gcXVlcnlUb1N0cmluZyhkZXB0aD86IG51bWJlcik6IHN0cmluZyB7XG4gICAgaWYgKHF1ZXJ5LnRlcm1zLmxlbmd0aCA9PT0gMCAmJiBxdWVyeS5wcm9qZWN0cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cbiAgICBpZiAoZGVwdGggPT09IHVuZGVmaW5lZCkge1xuICAgICAgZGVwdGggPSAwO1xuICAgIH1cbiAgICBsZXQgaW5kZW50ID0gQXJyYXkoZGVwdGgrMSkuam9pbihcIlxcdFwiKTtcbiAgICBsZXQgcXVlcnlTdHJpbmcgPSBpbmRlbnQgKyBcIihcIjtcbiAgICAvLyBNYXAgZWFjaCB0ZXJtL3N1YnF1ZXJ5L3Byb2plY3QgdG8gYSBzdHJpbmdcbiAgICBsZXQgdHlwZVN0cmluZyA9IHF1ZXJ5LnR5cGU7XG4gICAgbGV0IHRlcm1TdHJpbmcgPSBxdWVyeS50ZXJtcy5tYXAoKHRlcm0pID0+IHRlcm1Ub1N0cmluZyh0ZXJtLGRlcHRoKzEpKS5qb2luKFwiXFxuXCIpO1xuICAgIGxldCBzdWJxdWVyaWVzU3RyaW5nID0gcXVlcnkuc3VicXVlcmllcy5tYXAoKHF1ZXJ5KSA9PiBxdWVyeS50b1N0cmluZyhkZXB0aCArIDEpKS5qb2luKFwiXFxuXCIpO1xuICAgIGxldCBwcm9qZWN0c1N0cmluZyA9IHF1ZXJ5LnByb2plY3RzLm1hcCgodGVybSkgPT4gdGVybVRvU3RyaW5nKHRlcm0sZGVwdGgrMSkpLmpvaW4oXCJcXG5cIik7XG4gICAgLy8gTm93IGNvbXBvc2UgdGhlIHF1ZXJ5IHN0cmluZ1xuICAgIHF1ZXJ5U3RyaW5nICs9IHR5cGVTdHJpbmc7XG4gICAgcXVlcnlTdHJpbmcgKz0gdGVybVN0cmluZyA9PT0gXCJcIiA/IFwiXCIgOiBcIlxcblwiICsgdGVybVN0cmluZztcbiAgICBxdWVyeVN0cmluZyArPSBzdWJxdWVyaWVzU3RyaW5nID09PSBcIlwiID8gXCJcIiA6IFwiXFxuXCIgKyBzdWJxdWVyaWVzU3RyaW5nO1xuICAgIHF1ZXJ5U3RyaW5nICs9IHByb2plY3RzU3RyaW5nID09PSBcIlwiID8gXCJcIiA6IFwiXFxuXCIgKyBwcm9qZWN0c1N0cmluZztcbiAgICAvLyBDbG9zZSBvdXQgdGhlIHF1ZXJ5XG4gICAgcXVlcnlTdHJpbmcgKz0gXCJcXG5cIiArIGluZGVudCArIFwiKVwiO1xuICAgIHJldHVybiBxdWVyeVN0cmluZztcbiAgfVxuICBmdW5jdGlvbiB0ZXJtVG9TdHJpbmcodGVybTogVGVybSwgZGVwdGg/OiBudW1iZXIpOiBzdHJpbmcge1xuICAgIGlmIChkZXB0aCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBkZXB0aCA9IDA7XG4gICAgfVxuICAgIGxldCBpbmRlbnQgPSBBcnJheShkZXB0aCsxKS5qb2luKFwiXFx0XCIpO1xuICAgIGxldCB0ZXJtU3RyaW5nID0gaW5kZW50ICsgXCIoXCI7XG4gICAgdGVybVN0cmluZyArPSBgJHt0ZXJtLnR5cGV9IGA7XG4gICAgdGVybVN0cmluZyArPSBgJHt0ZXJtLnRhYmxlID09PSB1bmRlZmluZWQgPyBcIlwiIDogYFwiJHt0ZXJtLnRhYmxlfVwiIGB9YDtcbiAgICB0ZXJtU3RyaW5nICs9IHRlcm0uZmllbGRzLm1hcCgoZmllbGQpID0+IGA6JHtmaWVsZC5uYW1lfSAke2ZpZWxkLnZhcmlhYmxlID8gZmllbGQudmFsdWUgOiBgXCIke2ZpZWxkLnZhbHVlfVwiYH1gKS5qb2luKFwiIFwiKTtcbiAgICB0ZXJtU3RyaW5nICs9IFwiKVwiO1xuICAgIHJldHVybiB0ZXJtU3RyaW5nO1xuICB9XG4gIHJldHVybiBxdWVyeTtcbn1cblxuXG5mdW5jdGlvbiBmb3JtUXVlcnkobm9kZTogTm9kZSk6IFF1ZXJ5IHtcbiAgbGV0IHF1ZXJ5OiBRdWVyeSA9IG5ld1F1ZXJ5KCk7XG4gIGxldCBwcm9qZWN0RmllbGRzOiBBcnJheTxGaWVsZD4gPSBbXTtcbiAgXG4gIC8vIEhhbmRsZSB0aGUgY2hpbGQgbm9kZXNcbiAgXG4gIGxldCBjaGlsZFF1ZXJpZXMgPSBub2RlLmNoaWxkcmVuLm1hcChmb3JtUXVlcnkpO1xuICAvLyBTdWJzdW1lIGNoaWxkIHF1ZXJpZXNcbiAgbGV0IGNvbWJpbmVkUHJvamVjdEZpZWxkczogQXJyYXk8RmllbGQ+ID0gW107XG4gIGZvciAobGV0IGNRdWVyeSBvZiBjaGlsZFF1ZXJpZXMpIHtcbiAgICBxdWVyeS50ZXJtcyA9IHF1ZXJ5LnRlcm1zLmNvbmNhdChjUXVlcnkudGVybXMpO1xuICAgIHF1ZXJ5LnN1YnF1ZXJpZXMgPSBxdWVyeS5zdWJxdWVyaWVzLmNvbmNhdChjUXVlcnkuc3VicXVlcmllcyk7XG4gICAgLy8gQ29tYmluZSB1bm5hbWVkIHByb2plY3RzXG4gICAgZm9yIChsZXQgcHJvamVjdCBvZiBjUXVlcnkucHJvamVjdHMpIHtcbiAgICAgIGlmIChwcm9qZWN0LnRhYmxlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29tYmluZWRQcm9qZWN0RmllbGRzID0gY29tYmluZWRQcm9qZWN0RmllbGRzLmNvbmNhdChwcm9qZWN0LmZpZWxkcyk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGlmIChjb21iaW5lZFByb2plY3RGaWVsZHMubGVuZ3RoID4gMCkge1xuICAgIGxldCBwcm9qZWN0ID0ge1xuICAgICAgdHlwZTogXCJwcm9qZWN0IVwiLFxuICAgICAgZmllbGRzOiBjb21iaW5lZFByb2plY3RGaWVsZHMsXG4gICAgfVxuICAgIHF1ZXJ5LnByb2plY3RzLnB1c2gocHJvamVjdCk7XG4gIH1cbiAgLy8gSWYgdGhlIG5vZGUgaXMgYSBncm91cGluZyBub2RlLCBzdHVmZiB0aGUgcXVlcnkgaW50byBhIHN1YnF1ZXJ5XG4gIC8vIGFuZCB0YWtlIGl0cyBwcm9qZWN0c1xuICBpZiAobm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLkdST1VQSU5HKSkge1xuICAgIGxldCBzdWJxdWVyeSA9IHF1ZXJ5O1xuICAgIHF1ZXJ5ID0gbmV3UXVlcnkoKTtcbiAgICBxdWVyeS5wcm9qZWN0cyA9IHF1ZXJ5LnByb2plY3RzLmNvbmNhdChzdWJxdWVyeS5wcm9qZWN0cyk7XG4gICAgc3VicXVlcnkucHJvamVjdHMgPSBbXTtcbiAgICBxdWVyeS5zdWJxdWVyaWVzLnB1c2goc3VicXVlcnkpO1xuICB9XG4gIFxuICAvLyBIYW5kbGUgdGhlIGN1cnJlbnQgbm9kZVxuICBcbiAgLy8gSnVzdCByZXR1cm4gYXQgdGhlIHJvb3RcbiAgaWYgKG5vZGUuaGFzUHJvcGVydHkoUHJvcGVydGllcy5ST09UKSkge1xuICAgIC8vIFJldmVyc2UgdGhlIG9yZGVyIG9mIGZpZWxkcyBpbiB0aGUgcHJvamVjdHNcbiAgICBmb3IgKGxldCBwcm9qZWN0IG9mIHF1ZXJ5LnByb2plY3RzKSB7XG4gICAgICBwcm9qZWN0LmZpZWxkcyA9IHByb2plY3QuZmllbGRzLnJldmVyc2UoKTtcbiAgICB9XG4gICAgcmV0dXJuIHF1ZXJ5O1xuICB9XG4gIC8vIEhhbmRsZSBmdW5jdGlvbnMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBpZiAobm9kZS5meG4gIT09IHVuZGVmaW5lZCkge1xuICAgIC8vIFNraXAgZnVuY3Rpb25zIHdpdGggbm8gYXJndW1lbnRzXG4gICAgaWYgKG5vZGUuZnhuLmZpZWxkcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBxdWVyeTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ29sbGVjdGlvbiBhbGwgaW5wdXQgYW5kIG91dHB1dCBub2RlcyB3aGljaCB3ZXJlIGZvdW5kXG4gICAgbGV0IG5lc3RlZEFyZ3MgPSBub2RlLmNoaWxkcmVuLmZpbHRlcigoY2hpbGQpID0+IChjaGlsZC5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLklOUFVUKSB8fCBjaGlsZC5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLk9VVFBVVCkpIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJiYgY2hpbGQuZm91bmQgPT09IHRydWUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcChmaW5kTGVhZk5vZGVzKTtcbiAgICBsZXQgYXJncyA9IGZsYXR0ZW5OZXN0ZWRBcnJheShuZXN0ZWRBcmdzKTtcblxuICAgIC8vIElmIHdlIGhhdmUgdGhlIHJpZ2h0IG51bWJlciBvZiBhcmd1bWVudHMsIHByb2NlZWRcbiAgICAvLyBAVE9ETyBzdXJmYWNlIGFuIGVycm9yIGlmIHRoZSBhcmd1bWVudHMgYXJlIHdyb25nXG4gICAgbGV0IG91dHB1dDtcbiAgICBpZiAoYXJncy5sZW5ndGggPT09IG5vZGUuZnhuLmZpZWxkcy5sZW5ndGgpIHtcbiAgICAgIGxldCBmaWVsZHM6IEFycmF5PEZpZWxkPiA9IGFyZ3MubWFwKChhcmcsaSkgPT4ge1xuICAgICAgICByZXR1cm4ge25hbWU6IGAke25vZGUuZnhuLmZpZWxkc1tpXX1gLCBcbiAgICAgICAgICAgICAgIHZhbHVlOiBgJHthcmcuYXR0cmlidXRlLnZhcmlhYmxlfWAsIFxuICAgICAgICAgICAgdmFyaWFibGU6IHRydWV9O1xuICAgICAgfSk7XG4gICAgICBsZXQgdGVybTogVGVybSA9IHtcbiAgICAgICAgdHlwZTogXCJzZWxlY3RcIixcbiAgICAgICAgdGFibGU6IG5vZGUuZnhuLm5hbWUsXG4gICAgICAgIGZpZWxkczogZmllbGRzLFxuICAgICAgfVxuICAgICAgLy8gSWYgYW4gYWdncmVnYXRlIGlzIGdyb3VwZWQsIHdlIGhhdmUgdG8gcHVzaCB0aGUgYWdncmVnYXRlIGludG8gYSBzdWJxdWVyeVxuICAgICAgaWYgKG5vZGUuZnhuLnR5cGUgPT09IEZ1bmN0aW9uVHlwZXMuQUdHUkVHQVRFICYmIHF1ZXJ5LnN1YnF1ZXJpZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBsZXQgc3VicXVlcnkgPSBxdWVyeS5zdWJxdWVyaWVzWzBdO1xuICAgICAgICBpZiAoc3VicXVlcnkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHN1YnF1ZXJ5LnRlcm1zLnB1c2godGVybSk7XG4gICAgICAgIH0gXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBxdWVyeS50ZXJtcy5wdXNoKHRlcm0pOyAgXG4gICAgICB9XG4gICAgICAvLyBwcm9qZWN0IG91dHB1dCBpZiBuZWNlc3NhcnlcbiAgICAgIGlmIChub2RlLmZ4bi5wcm9qZWN0ID09PSB0cnVlKSB7XG4gICAgICAgIGxldCBvdXRwdXRGaWVsZHM6IEFycmF5PEZpZWxkPiA9IGFyZ3MuZmlsdGVyKChhcmcpID0+IGFyZy5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLk9VVFBVVCkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5tYXAoKGFyZykgPT4ge3JldHVybiB7bmFtZTogYCR7bm9kZS5meG4ubmFtZX1gLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBgJHthcmcuYXR0cmlidXRlLnZhcmlhYmxlfWAsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhYmxlOiB0cnVlfX0pO1xuICAgICAgICBwcm9qZWN0RmllbGRzID0gcHJvamVjdEZpZWxkcy5jb25jYXQob3V0cHV0RmllbGRzKTtcbiAgICAgICAgcXVlcnkucHJvamVjdHMgPSBbXTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgLy8gSGFuZGxlIGF0dHJpYnV0ZXMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBpZiAobm9kZS5hdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCkge1xuICAgIGxldCBhdHRyID0gbm9kZS5hdHRyaWJ1dGU7XG4gICAgbGV0IGVudGl0eSA9IGF0dHIuZW50aXR5O1xuICAgIGxldCBjb2xsZWN0aW9uID0gYXR0ci5jb2xsZWN0aW9uO1xuICAgIGxldCBmaWVsZHM6IEFycmF5PEZpZWxkPiA9IFtdO1xuICAgIGxldCBlbnRpdHlGaWVsZDogRmllbGQ7XG4gICAgLy8gRW50aXR5XG4gICAgaWYgKGVudGl0eSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBlbnRpdHlGaWVsZCA9IHtuYW1lOiBcImVudGl0eVwiLCBcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGAke2F0dHIuZW50aXR5LmVudGl0eUF0dHJpYnV0ZSA/IGF0dHIuZW50aXR5LnZhcmlhYmxlIDogYXR0ci5lbnRpdHkuaWR9YCwgXG4gICAgICAgICAgICAgICAgIHZhcmlhYmxlOiBhdHRyLmVudGl0eS5lbnRpdHlBdHRyaWJ1dGV9O1xuICAgIH0gZWxzZSBpZiAoY29sbGVjdGlvbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBlbnRpdHlGaWVsZCA9IHtuYW1lOiBcImVudGl0eVwiLCBcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGAke2F0dHIuY29sbGVjdGlvbi5kaXNwbGF5TmFtZX1gLCBcbiAgICAgICAgICAgICAgICAgdmFyaWFibGU6IHRydWV9O1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gcXVlcnk7XG4gICAgfVxuICAgIGZpZWxkcy5wdXNoKGVudGl0eUZpZWxkKTtcbiAgICAvLyBBdHRyaWJ1dGVcbiAgICBpZiAoYXR0ci5pZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBsZXQgYXR0ckZpZWxkOiBGaWVsZCA9IHtuYW1lOiBcImF0dHJpYnV0ZVwiLCBcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBhdHRyLmlkLCBcbiAgICAgICAgICAgICAgICAgICAgdmFyaWFibGU6IGZhbHNlfTtcbiAgICAgIGZpZWxkcy5wdXNoKGF0dHJGaWVsZCk7XG4gICAgfVxuICAgIC8vIFZhbHVlXG4gICAgbGV0IHZhbHVlRmllbGQ6IEZpZWxkID0ge25hbWU6IFwidmFsdWVcIiwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGF0dHIuaWQgPT09IHVuZGVmaW5lZCA/IGF0dHIudmFsdWUgOiBhdHRyLnZhcmlhYmxlLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZTogYXR0ci5pZCAhPT0gdW5kZWZpbmVkfTtcbiAgICBmaWVsZHMucHVzaCh2YWx1ZUZpZWxkKTtcbiAgICBsZXQgdGVybTogVGVybSA9IHtcbiAgICAgIHR5cGU6IFwic2VsZWN0XCIsXG4gICAgICB0YWJsZTogXCJlbnRpdHkgZWF2c1wiLFxuICAgICAgZmllbGRzOiBmaWVsZHMsXG4gICAgfVxuICAgIHF1ZXJ5LnRlcm1zLnB1c2godGVybSk7XG4gICAgLy8gcHJvamVjdCBpZiBuZWNlc3NhcnlcbiAgICBpZiAobm9kZS5hdHRyaWJ1dGUucHJvamVjdCA9PT0gdHJ1ZSAmJiAhbm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLk5FR0FURVMpKSB7XG4gICAgICBsZXQgYXR0cmlidXRlRmllbGQ6IEZpZWxkID0ge25hbWU6IGAke25vZGUuYXR0cmlidXRlLmlkfWAgLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbm9kZS5hdHRyaWJ1dGUudmFyaWFibGUsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhYmxlOiB0cnVlfTtcbiAgICAgIHByb2plY3RGaWVsZHMucHVzaChhdHRyaWJ1dGVGaWVsZCk7XG4gICAgfVxuICB9XG4gIC8vIEhhbmRsZSBjb2xsZWN0aW9ucyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGlmIChub2RlLmNvbGxlY3Rpb24gIT09IHVuZGVmaW5lZCAmJiAhbm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLlBST05PVU4pKSB7XG4gICAgbGV0IGVudGl0eUZpZWxkOiBGaWVsZCA9IHtuYW1lOiBcImVudGl0eVwiLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IG5vZGUuY29sbGVjdGlvbi52YXJpYWJsZSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhYmxlOiB0cnVlfTtcbiAgICBsZXQgY29sbGVjdGlvbkZpZWxkOiBGaWVsZCA9IHtuYW1lOiBcImNvbGxlY3Rpb25cIiwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogbm9kZS5jb2xsZWN0aW9uLmlkLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhYmxlOiBmYWxzZX07XG4gICAgbGV0IHRlcm06IFRlcm0gPSB7XG4gICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgdGFibGU6IFwiaXMgYSBhdHRyaWJ1dGVzXCIsXG4gICAgICBmaWVsZHM6IFtlbnRpdHlGaWVsZCwgY29sbGVjdGlvbkZpZWxkXSxcbiAgICB9XG4gICAgcXVlcnkudGVybXMucHVzaCh0ZXJtKTtcbiAgICAvLyBwcm9qZWN0IGlmIG5lY2Vzc2FyeVxuICAgIGlmIChub2RlLmNvbGxlY3Rpb24ucHJvamVjdCA9PT0gdHJ1ZSAmJiAhbm9kZS5oYXNQcm9wZXJ0eShQcm9wZXJ0aWVzLk5FR0FURVMpKSB7XG4gICAgICBsZXQgY29sbGVjdGlvbkZpZWxkOiBGaWVsZCA9IHtuYW1lOiBgJHtub2RlLmNvbGxlY3Rpb24uZGlzcGxheU5hbWUucmVwbGFjZShuZXcgUmVnRXhwKFwiIFwiLCAnZycpLFwiXCIpfWAsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogYCR7bm9kZS5jb2xsZWN0aW9uLnZhcmlhYmxlfWAsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXJpYWJsZTogdHJ1ZX07XG4gICAgICBwcm9qZWN0RmllbGRzLnB1c2goY29sbGVjdGlvbkZpZWxkKTtcbiAgICB9XG4gIH1cbiAgLy8gSGFuZGxlIGVudGl0aWVzIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgaWYgKG5vZGUuZW50aXR5ICE9PSB1bmRlZmluZWQgJiYgIW5vZGUuaGFzUHJvcGVydHkoUHJvcGVydGllcy5QUk9OT1VOKSkge1xuICAgIC8vIHByb2plY3QgaWYgbmVjZXNzYXJ5XG4gICAgaWYgKG5vZGUuZW50aXR5LnByb2plY3QgPT09IHRydWUpIHtcbiAgICAgIGxldCBlbnRpdHlGaWVsZDogRmllbGQgPSB7bmFtZTogYCR7bm9kZS5lbnRpdHkuZGlzcGxheU5hbWUucmVwbGFjZShuZXcgUmVnRXhwKFwiIFwiLCAnZycpLFwiXCIpfWAsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiBgJHtub2RlLmVudGl0eS5lbnRpdHlBdHRyaWJ1dGUgPyBub2RlLmVudGl0eS52YXJpYWJsZSA6IG5vZGUuZW50aXR5LmlkfWAsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhYmxlOiBub2RlLmVudGl0eS5lbnRpdHlBdHRyaWJ1dGV9O1xuICAgICAgcHJvamVjdEZpZWxkcy5wdXNoKGVudGl0eUZpZWxkKTsgIFxuICAgIH1cbiAgfVxuICBsZXQgcHJvamVjdCA9IHtcbiAgICB0eXBlOiBcInByb2plY3QhXCIsXG4gICAgZmllbGRzOiBwcm9qZWN0RmllbGRzLCBcbiAgfVxuICBcbiAgaWYgKG5vZGUuaGFzUHJvcGVydHkoUHJvcGVydGllcy5ORUdBVEVTKSkge1xuICAgIGxldCBuZWdhdGVkVGVybSA9IHF1ZXJ5LnRlcm1zLnBvcCgpO1xuICAgIGxldCBuZWdhdGVkUXVlcnkgPSBuZWdhdGVUZXJtKG5lZ2F0ZWRUZXJtKTtcbiAgICBxdWVyeS5zdWJxdWVyaWVzLnB1c2gobmVnYXRlZFF1ZXJ5KTtcbiAgfVxuICBcbiAgcXVlcnkucHJvamVjdHMucHVzaChwcm9qZWN0KTtcbiAgcmV0dXJuIHF1ZXJ5O1xufVxuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBEZWJ1ZyB1dGlsaXR5IGZ1bmN0aW9uc1xuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBcbmxldCBkaXZpZGVyID0gXCItLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVwiO1xuXG5leHBvcnQgbGV0IGRlYnVnID0gZmFsc2U7XG5cbmZ1bmN0aW9uIGxvZyh4OiBhbnkpIHtcbiAgaWYgKGRlYnVnKSB7XG4gICAgY29uc29sZS5sb2coeCk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG5vZGVBcnJheVRvU3RyaW5nKG5vZGVzOiBBcnJheTxOb2RlPik6IHN0cmluZyB7XG4gIGxldCBub2RlQXJyYXlTdHJpbmcgPSBub2Rlcy5tYXAoKG5vZGUpID0+IG5vZGUudG9TdHJpbmcoKSkuam9pbihcIlxcblwiICsgZGl2aWRlciArIFwiXFxuXCIpOyAgXG4gIHJldHVybiBkaXZpZGVyICsgXCJcXG5cIiArIG5vZGVBcnJheVN0cmluZyArIFwiXFxuXCIgKyBkaXZpZGVyO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdG9rZW5Ub1N0cmluZyh0b2tlbjogVG9rZW4pOiBzdHJpbmcge1xuICBsZXQgcHJvcGVydGllcyA9IGAoJHt0b2tlbi5wcm9wZXJ0aWVzLm1hcCgocHJvcGVydHk6IFByb3BlcnRpZXMpID0+IFByb3BlcnRpZXNbcHJvcGVydHldKS5qb2luKFwifFwiKX0pYDtcbiAgcHJvcGVydGllcyA9IHByb3BlcnRpZXMubGVuZ3RoID09PSAyID8gXCJcIiA6IHByb3BlcnRpZXM7XG4gIGxldCB0b2tlblNwYW4gPSB0b2tlbi5zdGFydCA9PT0gdW5kZWZpbmVkID8gXCIgXCIgOiBgIFske3Rva2VuLnN0YXJ0fS0ke3Rva2VuLmVuZH1dIGA7XG4gIGxldCB0b2tlblN0cmluZyA9IGAke3Rva2VuLml4fTogJHt0b2tlbi5vcmlnaW5hbFdvcmR9IHwgJHt0b2tlbi5ub3JtYWxpemVkV29yZH0gfCAke01ham9yUGFydHNPZlNwZWVjaFtnZXRNYWpvclBPUyh0b2tlbi5QT1MpXX0gfCAke01pbm9yUGFydHNPZlNwZWVjaFt0b2tlbi5QT1NdfSB8ICR7cHJvcGVydGllc31gIDtcbiAgcmV0dXJuIHRva2VuU3RyaW5nO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdG9rZW5BcnJheVRvU3RyaW5nKHRva2VuczogQXJyYXk8VG9rZW4+KTogc3RyaW5nIHtcbiAgbGV0IHRva2VuQXJyYXlTdHJpbmcgPSB0b2tlbnMubWFwKCh0b2tlbikgPT4gdG9rZW5Ub1N0cmluZyh0b2tlbikpLmpvaW4oXCJcXG5cIik7XG4gIHJldHVybiBkaXZpZGVyICsgXCJcXG5cIiArIHRva2VuQXJyYXlTdHJpbmcgKyBcIlxcblwiICsgZGl2aWRlcjtcbn1cblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gVXRpbGl0eSBmdW5jdGlvbnNcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZnVuY3Rpb24gZmxhdHRlbk5lc3RlZEFycmF5KG5lc3RlZEFycmF5OiBBcnJheTxBcnJheTxhbnk+Pik6IEFycmF5PGFueT4ge1xuICBsZXQgZmxhdHRlbmVkOiBBcnJheTxhbnk+ID0gW10uY29uY2F0LmFwcGx5KFtdLG5lc3RlZEFycmF5KTtcbiAgcmV0dXJuIGZsYXR0ZW5lZDtcbn1cblxuZnVuY3Rpb24gb25seVVuaXF1ZSh2YWx1ZSwgaW5kZXgsIHNlbGYpIHsgXG4gIHJldHVybiBzZWxmLmluZGV4T2YodmFsdWUpID09PSBpbmRleDtcbn1cblxuZnVuY3Rpb24gYXJyYXlJbnRlcnNlY3QoYSwgYikge1xuICBsZXQgYWkgPSAwO1xuICBsZXQgYmkgPSAwO1xuICBsZXQgcmVzdWx0ID0gW107XG4gIHdoaWxlIChhaSA8IGEubGVuZ3RoICYmIGJpIDwgYi5sZW5ndGgpIHtcbiAgICBpZiAoYVthaV0gPCBiW2JpXSkgYWkrKztcbiAgICBlbHNlIGlmIChhW2FpXSA+IGJbYmldKSBiaSsrO1xuICAgIGVsc2Uge1xuICAgICAgcmVzdWx0LnB1c2goYVthaV0pO1xuICAgICAgYWkrKztcbiAgICAgIGJpKys7XG4gICAgfVxuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIGlzTnVtZXJpYyhuOiBhbnkpOiBib29sZWFuIHtcbiAgcmV0dXJuICFpc05hTihwYXJzZUZsb2F0KG4pKSAmJiBpc0Zpbml0ZShuKTtcbn1cblxuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmRlY2xhcmUgdmFyIGV4cG9ydHM7XG53aW5kb3dbXCJOTFFQXCJdID0gZXhwb3J0czsiLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwibWljcm9SZWFjdC50c1wiIC8+XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vdmVuZG9yL21hcmtlZC5kLnRzXCIgLz5cbmltcG9ydCAqIGFzIG1pY3JvUmVhY3QgZnJvbSBcIi4vbWljcm9SZWFjdFwiO1xuaW1wb3J0ICogYXMgcnVudGltZSBmcm9tIFwiLi9ydW50aW1lXCI7XG5pbXBvcnQge1VJUmVuZGVyZXJ9IGZyb20gXCIuL3VpUmVuZGVyZXJcIjtcbmltcG9ydCB7RU5WLCBERUJVRywgdXVpZH0gZnJvbSBcIi4vdXRpbHNcIjtcblxuXG5leHBvcnQgdmFyIHN5bmNlZFRhYmxlcyA9IFtcInNvdXJjZWQgZWF2XCIsIFwidmlld1wiLCBcImFjdGlvblwiLCBcImFjdGlvbiBzb3VyY2VcIiwgXCJhY3Rpb24gbWFwcGluZ1wiLCBcImFjdGlvbiBtYXBwaW5nIGNvbnN0YW50XCIsIFwiYWN0aW9uIG1hcHBpbmcgc29ydGVkXCIsIFwiYWN0aW9uIG1hcHBpbmcgbGltaXRcIl07XG5leHBvcnQgdmFyIGV2ZUxvY2FsU3RvcmFnZUtleSA9IFwiZXZlXCI7XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBSZW5kZXJlclxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxudmFyIHBlcmZTdGF0cztcbnZhciBwZXJmU3RhdHNVaTtcbnZhciB1cGRhdGVTdGF0ID0gMDtcbmV4cG9ydCB2YXIgcmVuZGVyZXI7XG5leHBvcnQgdmFyIHVpUmVuZGVyZXI7XG5mdW5jdGlvbiBpbml0UmVuZGVyZXIoKSB7XG4gIHJlbmRlcmVyID0gbmV3IG1pY3JvUmVhY3QuUmVuZGVyZXIoKTtcbiAgdWlSZW5kZXJlciA9IG5ldyBVSVJlbmRlcmVyKGV2ZSk7XG4gIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQocmVuZGVyZXIuY29udGVudCk7XG4gIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicmVzaXplXCIsIHJlbmRlcik7XG4gIHBlcmZTdGF0c1VpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgcGVyZlN0YXRzVWkuaWQgPSBcInBlcmZTdGF0c1wiO1xuICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHBlcmZTdGF0c1VpKTtcbn1cblxuaWYoRU5WID09PSBcImJyb3dzZXJcIikgdmFyIHBlcmZvcm1hbmNlID0gd2luZG93W1wicGVyZm9ybWFuY2VcIl0gfHwgeyBub3c6ICgpID0+IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkgfVxuXG5leHBvcnQgdmFyIHJlbmRlclJvb3RzID0ge307XG5leHBvcnQgZnVuY3Rpb24gcmVuZGVyKCkge1xuICBpZighcmVuZGVyZXIgfHwgcmVuZGVyZXIucXVldWVkKSByZXR1cm47XG4gIHJlbmRlcmVyLnF1ZXVlZCA9IHRydWU7XG4gIHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbigpIHtcbiAgICBsZXQgc3RhdHM6YW55ID0ge307XG4gICAgbGV0IHN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG5cbiAgICBsZXQgdHJlZXMgPSBbXTtcbiAgICBmb3IgKHZhciByb290IGluIHJlbmRlclJvb3RzKSB7XG4gICAgICB0cmVlcy5wdXNoKHJlbmRlclJvb3RzW3Jvb3RdKCkpO1xuICAgIH1cblxuICAgIHN0YXRzLnJvb3QgPSAocGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydCkudG9GaXhlZCgyKTtcbiAgICBpZiAoK3N0YXRzLnJvb3QgPiAxMCkgY29uc29sZS5pbmZvKFwiU2xvdyByb290OiBcIiArIHN0YXRzLnJvb3QpO1xuXG4gICAgc3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICBsZXQgZHluYW1pY1VJID0gZXZlLmZpbmQoXCJzeXN0ZW0gdWlcIikubWFwKCh1aSkgPT4gdWlbXCJ0ZW1wbGF0ZVwiXSk7XG4gICAgaWYoREVCVUcgJiYgREVCVUcuVUlfQ09NUElMRSkge1xuICAgICAgY29uc29sZS5pbmZvKFwiY29tcGlsaW5nXCIsIGR5bmFtaWNVSSk7XG4gICAgICBjb25zb2xlLmluZm8oXCIqXCIsIHVpUmVuZGVyZXIuY29tcGlsZShkeW5hbWljVUkpKTtcbiAgICB9XG4gICAgdHJlZXMucHVzaC5hcHBseSh0cmVlcywgdWlSZW5kZXJlci5jb21waWxlKGR5bmFtaWNVSSkpO1xuICAgIHN0YXRzLnVpQ29tcGlsZSA9IChwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0KS50b0ZpeGVkKDIpO1xuICAgIGlmICgrc3RhdHMudWlDb21waWxlID4gMTApIGNvbnNvbGUuaW5mbyhcIlNsb3cgdWkgY29tcGlsZTogXCIgKyBzdGF0cy51aUNvbXBpbGUpO1xuXG4gICAgc3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICByZW5kZXJlci5yZW5kZXIodHJlZXMpO1xuICAgIHN0YXRzLnJlbmRlciA9IChwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0KS50b0ZpeGVkKDIpO1xuICAgIHN0YXRzLnVwZGF0ZSA9IHVwZGF0ZVN0YXQudG9GaXhlZCgyKTtcblxuICAgIHBlcmZTdGF0c1VpLnRleHRDb250ZW50ID0gXCJcIjtcbiAgICBwZXJmU3RhdHNVaS50ZXh0Q29udGVudCArPSBgcm9vdDogJHtzdGF0cy5yb290fWA7XG4gICAgcGVyZlN0YXRzVWkudGV4dENvbnRlbnQgKz0gYCB8IHVpIGNvbXBpbGU6ICR7c3RhdHMudWlDb21waWxlfWA7XG4gICAgcGVyZlN0YXRzVWkudGV4dENvbnRlbnQgKz0gYCB8IHJlbmRlcjogJHtzdGF0cy5yZW5kZXJ9YDtcbiAgICBwZXJmU3RhdHNVaS50ZXh0Q29udGVudCArPSBgIHwgdXBkYXRlOiAke3N0YXRzLnVwZGF0ZX1gO1xuICAgIHBlcmZTdGF0cyA9IHN0YXRzO1xuXG4gICAgcmVuZGVyZXIucXVldWVkID0gZmFsc2U7XG4gIH0pO1xufVxuXG52YXIgc3RvcmVRdWV1ZWQgPSBmYWxzZTtcbmZ1bmN0aW9uIHN0b3JlTG9jYWxseSgpIHtcbiAgaWYoc3RvcmVRdWV1ZWQpIHJldHVybjtcbiAgc3RvcmVRdWV1ZWQgPSB0cnVlO1xuICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICBsZXQgc2VyaWFsaXplZCA9IGV2ZS5zZXJpYWxpemUodHJ1ZSk7XG4gICAgaWYgKGV2ZUxvY2FsU3RvcmFnZUtleSA9PT0gXCJldmVcIikge1xuICAgICAgZm9yIChsZXQgc3luY2VkIG9mIHN5bmNlZFRhYmxlcykge1xuICAgICAgICBkZWxldGUgc2VyaWFsaXplZFtzeW5jZWRdO1xuICAgICAgfVxuICAgIH1cbiAgICBkZWxldGUgc2VyaWFsaXplZFtcInByb3ZlbmFuY2VcIl07XG4gICAgbG9jYWxTdG9yYWdlW2V2ZUxvY2FsU3RvcmFnZUtleV0gPSBKU09OLnN0cmluZ2lmeShzZXJpYWxpemVkKTtcbiAgICBzdG9yZVF1ZXVlZCA9IGZhbHNlO1xuICB9LCAxMDAwKTtcbn1cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIERpc3BhdGNoXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5sZXQgZGlzcGF0Y2hlcyA9IHt9O1xuXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlKGV2ZW50LCBmdW5jKSB7XG4gIGlmIChkaXNwYXRjaGVzW2V2ZW50XSkge1xuICAgIGNvbnNvbGUuZXJyb3IoYE92ZXJ3cml0aW5nIGhhbmRsZXIgZm9yICcke2V2ZW50fSdgKTtcbiAgfVxuICBkaXNwYXRjaGVzW2V2ZW50XSA9IGZ1bmM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkaXNwYXRjaChldmVudD86IHN0cmluZywgaW5mbz86IHsgW2tleTogc3RyaW5nXTogYW55IH0sIGRpc3BhdGNoSW5mbz8pIHtcbiAgbGV0IHJlc3VsdCA9IGRpc3BhdGNoSW5mbztcbiAgaWYgKCFyZXN1bHQpIHtcbiAgICByZXN1bHQgPSBldmUuZGlmZigpO1xuICAgIHJlc3VsdC5tZXRhLnJlbmRlciA9IHRydWU7XG4gICAgcmVzdWx0Lm1ldGEuc3RvcmUgPSB0cnVlO1xuICB9XG4gIHJlc3VsdC5kaXNwYXRjaCA9IChldmVudCwgaW5mbykgPT4ge1xuICAgIHJldHVybiBkaXNwYXRjaChldmVudCwgaW5mbywgcmVzdWx0KTtcbiAgfTtcbiAgcmVzdWx0LmNvbW1pdCA9ICgpID0+IHtcbiAgICB2YXIgc3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAvLyByZXN1bHQucmVtb3ZlKFwiYnVpbHRpbiBlbnRpdHlcIiwge2VudGl0eTogXCJyZW5kZXIgcGVyZm9ybWFuY2Ugc3RhdGlzdGljc1wifSk7XG4gICAgLy8gcmVzdWx0LmFkZChcImJ1aWx0aW4gZW50aXR5XCIsIHtlbnRpdHk6IFwicmVuZGVyIHBlcmZvcm1hbmNlIHN0YXRpc3RpY3NcIiwgY29udGVudDogYFxuICAgIC8vICMgUmVuZGVyIHBlcmZvcm1hbmNlIHN0YXRpc3RpY3MgKHtpcyBhOiBzeXN0ZW19KVxuICAgIC8vIHJvb3Q6IHtyb290OiAke3BlcmZTdGF0cy5yb290fX1cbiAgICAvLyB1aSBjb21waWxlOiB7dWkgY29tcGlsZTogJHtwZXJmU3RhdHMudWlDb21waWxlfX1cbiAgICAvLyByZW5kZXI6IHtyZW5kZXI6ICR7cGVyZlN0YXRzLnJlbmRlcn19XG4gICAgLy8gdXBkYXRlOiB7dXBkYXRlOiAke3BlcmZTdGF0cy51cGRhdGV9fVxuICAgIC8vIEhvcnJpYmxlIGhhY2ssIGRpc3JlZ2FyZCB0aGlzOiB7cGVyZiBzdGF0czogcmVuZGVyIHBlcmZvcm1hbmNlIHN0YXRpc3RpY3N9XG4gICAgLy8gYH0pO1xuICAgIGlmKCFydW50aW1lLklOQ1JFTUVOVEFMKSB7XG4gICAgICBldmUuYXBwbHlEaWZmKHJlc3VsdCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGV2ZS5hcHBseURpZmZJbmNyZW1lbnRhbChyZXN1bHQpO1xuICAgIH1cbiAgICBpZiAocmVzdWx0Lm1ldGEucmVuZGVyKSB7XG4gICAgICByZW5kZXIoKTtcbiAgICB9XG4gICAgaWYgKHJlc3VsdC5tZXRhLnN0b3JlKSB7XG4gICAgICBzdG9yZUxvY2FsbHkoKTtcbiAgICAgIGlmIChldmVMb2NhbFN0b3JhZ2VLZXkgPT09IFwiZXZlXCIpIHtcbiAgICAgICAgc2VuZENoYW5nZVNldChyZXN1bHQpO1xuICAgICAgfVxuICAgIH1cbiAgICB1cGRhdGVTdGF0ID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydDtcbiAgfVxuICBpZighZXZlbnQpIHJldHVybiByZXN1bHQ7XG4gIGxldCBmdW5jID0gZGlzcGF0Y2hlc1tldmVudF07XG4gIGlmICghZnVuYykge1xuICAgIGNvbnNvbGUuZXJyb3IoYE5vIGRpc3BhdGNoZXMgZm9yICcke2V2ZW50fScgd2l0aCAke0pTT04uc3RyaW5naWZ5KGluZm8pIH1gKTtcbiAgfSBlbHNlIHtcbiAgICBmdW5jKHJlc3VsdCwgaW5mbyk7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdFxufVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gU3RhdGVcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmV4cG9ydCB2YXIgZXZlID0gcnVudGltZS5pbmRleGVyKCk7XG5leHBvcnQgdmFyIGluaXRpYWxpemVycyA9IHt9O1xuZXhwb3J0IHZhciBhY3RpdmVTZWFyY2hlcyA9IHt9O1xuXG5leHBvcnQgZnVuY3Rpb24gaW5pdChuYW1lLCBmdW5jKSB7XG4gIGluaXRpYWxpemVyc1tuYW1lXSA9IGZ1bmM7XG59XG5cbmZ1bmN0aW9uIGV4ZWN1dGVJbml0aWFsaXplcnMoKSB7XG4gIGZvciAobGV0IGluaXROYW1lIGluIGluaXRpYWxpemVycykge1xuICAgIGluaXRpYWxpemVyc1tpbml0TmFtZV0oKTtcbiAgfVxufVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gV2Vic29ja2V0XG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG52YXIgbWUgPSB1dWlkKCk7XG5pZih0aGlzLmxvY2FsU3RvcmFnZSkge1xuICBpZihsb2NhbFN0b3JhZ2VbXCJtZVwiXSkgbWUgPSBsb2NhbFN0b3JhZ2VbXCJtZVwiXTtcbiAgZWxzZSBsb2NhbFN0b3JhZ2VbXCJtZVwiXSA9IG1lO1xufVxuXG5leHBvcnQgdmFyIHNvY2tldDtcbmZ1bmN0aW9uIGNvbm5lY3RUb1NlcnZlcigpIHtcbiAgc29ja2V0ID0gbmV3IFdlYlNvY2tldChgd3M6Ly8ke3dpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSB8fCBcImxvY2FsaG9zdFwifTo4MDgwYCk7XG4gIHNvY2tldC5vbmVycm9yID0gKCkgPT4ge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gY29ubmVjdCB0byBzZXJ2ZXIsIGZhbGxpbmcgYmFjayB0byBsb2NhbCBzdG9yYWdlXCIpO1xuICAgIGV2ZUxvY2FsU3RvcmFnZUtleSA9IFwibG9jYWwtZXZlXCI7XG4gICAgZXhlY3V0ZUluaXRpYWxpemVycygpO1xuICAgIHJlbmRlcigpO1xuICB9XG4gIHNvY2tldC5vbm9wZW4gPSAoKSA9PiB7XG4gICAgc2VuZFNlcnZlcihcImNvbm5lY3RcIiwgbWUpO1xuICB9XG4gIHNvY2tldC5vbm1lc3NhZ2UgPSAoZGF0YSkgPT4ge1xuICAgIGxldCBwYXJzZWQgPSBKU09OLnBhcnNlKGRhdGEuZGF0YSk7XG4gICAgY29uc29sZS5sb2coXCJXUyBNRVNTQUdFOlwiLCBwYXJzZWQpO1xuXG4gICAgaWYgKHBhcnNlZC5raW5kID09PSBcImxvYWRcIikge1xuICAgICAgLy8gZXZlLmxvYWQocGFyc2VkLmRhdGEpO1xuICAgICAgZXhlY3V0ZUluaXRpYWxpemVycygpO1xuICAgICAgcmVuZGVyKCk7XG4gICAgfSBlbHNlIGlmIChwYXJzZWQua2luZCA9PT0gXCJjaGFuZ2VzZXRcIikge1xuICAgICAgbGV0IGRpZmYgPSBldmUuZGlmZigpO1xuICAgICAgZGlmZi50YWJsZXMgPSBwYXJzZWQuZGF0YTtcbiAgICAgIGV2ZS5hcHBseURpZmYoZGlmZik7XG4gICAgICByZW5kZXIoKTtcbiAgICB9XG4gIH07XG59XG5cbmZ1bmN0aW9uIHNlbmRTZXJ2ZXIobWVzc2FnZUtpbmQsIGRhdGEpIHtcbiAgaWYgKCFzb2NrZXQpIHJldHVybjtcbiAgc29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkoeyBraW5kOiBtZXNzYWdlS2luZCwgbWUsIHRpbWU6IChuZXcgRGF0ZSkuZ2V0VGltZSgpLCBkYXRhIH0pKTtcbn1cblxuZnVuY3Rpb24gc2VuZENoYW5nZVNldChjaGFuZ2VzZXQpIHtcbiAgaWYgKCFzb2NrZXQpIHJldHVybjtcbiAgbGV0IGNoYW5nZXMgPSB7fTtcbiAgbGV0IHNlbmQgPSBmYWxzZTtcbiAgZm9yIChsZXQgdGFibGUgb2Ygc3luY2VkVGFibGVzKSB7XG4gICAgaWYgKGNoYW5nZXNldC50YWJsZXNbdGFibGVdKSB7XG4gICAgICBzZW5kID0gdHJ1ZTtcbiAgICAgIGNoYW5nZXNbdGFibGVdID0gY2hhbmdlc2V0LnRhYmxlc1t0YWJsZV07XG4gICAgfVxuICB9XG4gIGlmIChzZW5kKSBzZW5kU2VydmVyKFwiY2hhbmdlc2V0XCIsIGNoYW5nZXMpO1xufVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gR29cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5pZihFTlYgPT09IFwiYnJvd3NlclwiKSB7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgaW5pdFJlbmRlcmVyKCk7XG4gICAgLy8gY29ubmVjdFRvU2VydmVyKCk7XG4gICAgZXZlTG9jYWxTdG9yYWdlS2V5ID0gXCJsb2NhbC1ldmVcIjtcbiAgICBleGVjdXRlSW5pdGlhbGl6ZXJzKCk7XG4gICAgcmVuZGVyKCk7XG4gIH0pO1xufVxuXG5pbml0KFwibG9hZCBkYXRhXCIsZnVuY3Rpb24oKSB7XG4gIGxldCBzdG9yZWQgPSBsb2NhbFN0b3JhZ2VbZXZlTG9jYWxTdG9yYWdlS2V5XTtcbiAgaWYoc3RvcmVkKSB7XG4gICAgZXZlLmxvYWQoc3RvcmVkKTtcbiAgfVxufSk7XG5cbmRlY2xhcmUgdmFyIGV4cG9ydHM7XG5pZihFTlYgPT09IFwiYnJvd3NlclwiKSB3aW5kb3dbXCJhcHBcIl0gPSBleHBvcnRzO1xuIiwiaW1wb3J0IHt1bnBhZCwgdGl0bGVjYXNlLCBidWlsdGluSWR9IGZyb20gXCIuL3V0aWxzXCJcbmltcG9ydCAqIGFzIHJ1bnRpbWUgZnJvbSBcIi4vcnVudGltZVwiXG5pbXBvcnQgKiBhcyBhcHAgZnJvbSBcIi4vYXBwXCJcbmltcG9ydCB7ZXZlfSBmcm9tIFwiLi9hcHBcIlxuaW1wb3J0IHtVSUVsZW0sIHBhcnNlRFNMLCBBcnRpZmFjdHN9IGZyb20gXCIuL3BhcnNlclwiXG5pbXBvcnQge1VJfSBmcm9tIFwiLi91aVJlbmRlcmVyXCJcblxuZXhwb3J0IHZhciBpeGVyID0gZXZlO1xuZGVjbGFyZSB2YXIgdXVpZDtcblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gVXRpbGl0aWVzXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbi8vIGV4cG9ydCBmdW5jdGlvbiBVSUZyb21EU0woc3RyOnN0cmluZyk6VUkge1xuLy8gICBmdW5jdGlvbiBwcm9jZXNzRWxlbShkYXRhOlVJRWxlbSk6VUkge1xuLy8gICAgIGxldCBlbGVtID0gbmV3IFVJKGRhdGEuaWQgfHwgdXVpZCgpKTtcbi8vICAgICBpZihkYXRhLmJpbmRpbmcpIGVsZW0uYmluZChkYXRhLmJpbmRpbmdLaW5kID09PSBcInF1ZXJ5XCIgPyBwYXJzZURTTChkYXRhLmJpbmRpbmcpO1xuLy8gICAgIGlmKGRhdGEuZW1iZWRkZWQpIGVsZW0uZW1iZWQoZGF0YS5lbWJlZGRlZCk7XG4vLyAgICAgaWYoZGF0YS5hdHRyaWJ1dGVzKSBlbGVtLmF0dHJpYnV0ZXMoZGF0YS5hdHRyaWJ1dGVzKTtcbi8vICAgICBpZihkYXRhLmV2ZW50cykgZWxlbS5ldmVudHMoZGF0YS5ldmVudHMpO1xuLy8gICAgIGlmKGRhdGEuY2hpbGRyZW4pIHtcbi8vICAgICAgIGZvcihsZXQgY2hpbGQgb2YgZGF0YS5jaGlsZHJlbikgZWxlbS5jaGlsZChwcm9jZXNzRWxlbShjaGlsZCkpO1xuLy8gICAgIH1cbi8vICAgICByZXR1cm4gZWxlbTtcbi8vICAgfVxuLy8gICByZXR1cm4gcHJvY2Vzc0VsZW0ocGFyc2VVSShzdHIpKTtcbi8vIH1cblxuY2xhc3MgQlNQaGFzZSB7XG4gIHByb3RlY3RlZCBfdmlld3M6e1t2aWV3OnN0cmluZ106IHN0cmluZ30gPSB7fTtcbiAgcHJvdGVjdGVkIF92aWV3RmllbGRzOntbdmlldzpzdHJpbmddOiBzdHJpbmdbXX0gPSB7fTtcbiAgcHJvdGVjdGVkIF9lbnRpdGllczpzdHJpbmdbXSA9IFtdO1xuICBwcm90ZWN0ZWQgX3Vpczp7W3VpOnN0cmluZ106IFVJfSA9IHt9O1xuICBwcm90ZWN0ZWQgX3F1ZXJpZXM6e1txdWVyeTpzdHJpbmddOiBydW50aW1lLlF1ZXJ5fSA9IHt9O1xuICBwcm90ZWN0ZWQgX25hbWVzOntbbmFtZTpzdHJpbmddOiBzdHJpbmd9ID0ge307XG5cbiAgY29uc3RydWN0b3IocHVibGljIGl4ZXI6cnVudGltZS5JbmRleGVyLCBwdWJsaWMgY2hhbmdlc2V0ID0gaXhlci5kaWZmKCkpIHt9XG5cbiAgdmlld0tpbmQodmlldzpzdHJpbmcpIHtcbiAgICByZXR1cm4gdGhpcy5fdmlld3Nbdmlld107XG4gIH1cbiAgdmlld0ZpZWxkcyh2aWV3OnN0cmluZykge1xuICAgIHJldHVybiB0aGlzLl92aWV3RmllbGRzW3ZpZXddO1xuICB9XG4gIGFwcGx5KG51a2VFeGlzdGluZz86Ym9vbGVhbikge1xuICAgIGZvcihsZXQgdmlldyBpbiB0aGlzLl92aWV3cykge1xuICAgICAgaWYodGhpcy5fdmlld3Nbdmlld10gPT09IFwidGFibGVcIikgaXhlci5hZGRUYWJsZSh2aWV3LCB0aGlzLl92aWV3RmllbGRzW3ZpZXddKTtcbiAgICB9XG4gICAgaWYobnVrZUV4aXN0aW5nKSB7XG4gICAgICBmb3IobGV0IHZpZXcgaW4gdGhpcy5fdmlld3MpIHtcbiAgICAgICAgaWYodGhpcy5fdmlld3Nbdmlld10gIT09IFwidGFibGVcIikgdGhpcy5jaGFuZ2VzZXQubWVyZ2UocnVudGltZS5RdWVyeS5yZW1vdmUodmlldywgdGhpcy5peGVyKSk7XG4gICAgICB9XG4gICAgICBmb3IobGV0IGVudGl0eSBvZiB0aGlzLl9lbnRpdGllcykgdGhpcy5jaGFuZ2VzZXQucmVtb3ZlKFwiYnVpbHRpbiBlbnRpdHlcIiwge2VudGl0eX0pO1xuICAgICAgZm9yKGxldCB1aSBpbiB0aGlzLl91aXMpIHRoaXMuY2hhbmdlc2V0Lm1lcmdlKFVJLnJlbW92ZSh1aSwgdGhpcy5peGVyKSk7XG4gICAgfVxuICAgIGl4ZXIuYXBwbHlEaWZmKHRoaXMuY2hhbmdlc2V0KTtcbiAgfVxuXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gTWFjcm9zXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgYWRkRmFjdCh0YWJsZTpzdHJpbmcsIGZhY3Q6e30pIHtcbiAgICB0aGlzLmNoYW5nZXNldC5hZGQodGFibGUsIGZhY3QpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYWRkRW50aXR5KGVudGl0eTpzdHJpbmcsIG5hbWU6c3RyaW5nLCBraW5kczpzdHJpbmdbXSwgYXR0cmlidXRlcz86e30sIGV4dHJhQ29udGVudD86c3RyaW5nKSB7XG4gICAgZW50aXR5ID0gYnVpbHRpbklkKGVudGl0eSk7XG4gICAgdGhpcy5fbmFtZXNbbmFtZV0gPSBlbnRpdHk7XG4gICAgdGhpcy5fZW50aXRpZXMucHVzaChlbnRpdHkpO1xuICAgIHRoaXMuYWRkRmFjdChcImRpc3BsYXkgbmFtZVwiLCB7aWQ6IGVudGl0eSwgbmFtZTogbmFtZX0pO1xuICAgIGxldCBpc0FzID0gW107XG4gICAgZm9yKGxldCBraW5kIG9mIGtpbmRzKSB7XG4gICAgICBsZXQgc291cmNlSWQgPSBgJHtlbnRpdHl9LGlzIGEsJHtraW5kfWA7XG4gICAgICBpc0FzLnB1c2goYHske2tpbmR9fHJlcD1saW5rOyBlYXYgc291cmNlID0gJHtzb3VyY2VJZH19YCk7XG4gICAgICBsZXQgY29sbEVudGl0eSA9IGJ1aWx0aW5JZChraW5kKTtcbiAgICAgIHRoaXMuYWRkRmFjdChcImRpc3BsYXkgbmFtZVwiLCB7aWQ6IGNvbGxFbnRpdHksIG5hbWU6IGtpbmR9KTtcbiAgICAgIHRoaXMuYWRkRmFjdChcInNvdXJjZWQgZWF2XCIsIHtlbnRpdHksIGF0dHJpYnV0ZTogXCJpcyBhXCIsIHZhbHVlOiBjb2xsRW50aXR5LCBzb3VyY2U6IHNvdXJjZUlkfSlcbiAgICB9XG4gICAgbGV0IGNvbGxlY3Rpb25zVGV4dCA9IFwiXCI7XG4gICAgaWYoaXNBcy5sZW5ndGgpXG4gICAgICBjb2xsZWN0aW9uc1RleHQgPSBgJHt0aXRsZWNhc2UobmFtZSl9IGlzIGEgJHtpc0FzLnNsaWNlKDAsIC0xKS5qb2luKFwiLCBcIil9ICR7aXNBcy5sZW5ndGggPiAxID8gXCJhbmRcIiA6IFwiXCJ9ICR7aXNBc1tpc0FzLmxlbmd0aCAtIDFdfS5gO1xuICAgIGxldCBjb250ZW50ID0gdW5wYWQoNikgYFxuICAgICAgIyR7bmFtZX1cbiAgICAgICR7Y29sbGVjdGlvbnNUZXh0fVxuICAgIGA7XG4gICAgaWYoYXR0cmlidXRlcykge1xuICAgICAgY29udGVudCArPSBcIlxcbiMjQXR0cmlidXRlc1xcblwiO1xuICAgICAgZm9yKGxldCBhdHRyIGluIGF0dHJpYnV0ZXMpIHtcbiAgICAgICAgbGV0IHNvdXJjZUlkID0gYCR7ZW50aXR5fSwke2F0dHJ9LCR7YXR0cmlidXRlc1thdHRyXX1gO1xuICAgICAgICBsZXQgcXVlcnkgPSBgJHtuYW1lfSdzICR7YXR0cn1gO1xuICAgICAgICBsZXQgcXVlcnlJZCA9IHF1ZXJ5LnJlcGxhY2UoXCIgXCIsIFwiLVwiKTtcbiAgICAgICAgY29udGVudCArPSBgJHthdHRyfTogeyR7cXVlcnl9fHJlcD1DU1Y7IGZpZWxkPSR7YXR0cn07IGVhdiBzb3VyY2UgPSAke3NvdXJjZUlkfX1cXG5gO1xuICAgICAgICBsZXQgdmFsdWUgPSB0aGlzLl9uYW1lc1thdHRyaWJ1dGVzW2F0dHJdXSB8fCBhdHRyaWJ1dGVzW2F0dHJdO1xuICAgICAgICB0aGlzLmFkZEZhY3QoXCJzb3VyY2VkIGVhdlwiLCB7ZW50aXR5LCBhdHRyaWJ1dGU6IGF0dHIsIHZhbHVlLCBzb3VyY2U6IHNvdXJjZUlkfSk7XG4gICAgICAgIGxldCBhcnRpZmFjdHMgPSBwYXJzZURTTChgKHF1ZXJ5IDokJHZpZXcgXCIke3F1ZXJ5SWR9XCJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoZW50aXR5LWVhdnMgOmVudGl0eSBcIiR7ZW50aXR5fVwiIDphdHRyaWJ1dGUgXCIke2F0dHJ9XCIgOnZhbHVlIHYpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHByb2plY3QhIDplbnRpdHkgXCIke2VudGl0eX1cIiA6JHthdHRyfSB2KSlgKTtcbiAgICAgICAgdGhpcy5hZGRBcnRpZmFjdHMoYXJ0aWZhY3RzKTtcbiAgICAgICAgdGhpcy5hZGRGYWN0KFwicXVlcnkgdG8gaWRcIiwge3F1ZXJ5LCBpZDogcXVlcnlJZH0pO1xuICAgICAgfVxuICAgIH1cbiAgICBpZihleHRyYUNvbnRlbnQpIGNvbnRlbnQgKz0gXCJcXG5cIiArIGV4dHJhQ29udGVudDtcbiAgICBsZXQgcGFnZSA9IGAke2VudGl0eX18cm9vdGA7XG4gICAgdGhpcy5hZGRGYWN0KFwicGFnZSBjb250ZW50XCIsIHtwYWdlLCBjb250ZW50fSk7XG4gICAgdGhpcy5hZGRGYWN0KFwiZW50aXR5IHBhZ2VcIiwge2VudGl0eSwgcGFnZX0pO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYWRkVmlldyh2aWV3OnN0cmluZywga2luZDpzdHJpbmcsIGZpZWxkczpzdHJpbmdbXSkge1xuICAgIHRoaXMuX3ZpZXdzW3ZpZXddID0ga2luZDtcbiAgICB0aGlzLl92aWV3RmllbGRzW3ZpZXddID0gZmllbGRzO1xuICAgIHRoaXMuYWRkRmFjdChcInZpZXdcIiwge3ZpZXcsIGtpbmQ6IGtpbmR9KTtcbiAgICBmb3IobGV0IGZpZWxkIG9mIGZpZWxkcykgdGhpcy5hZGRGYWN0KFwiZmllbGRcIiwge3ZpZXcsIGZpZWxkfSk7XG4gICAgbGV0IGVudGl0eSA9IGAke3ZpZXd9IHZpZXdgO1xuICAgIHRoaXMuYWRkRW50aXR5KGVudGl0eSwgZW50aXR5LCBbXCJzeXN0ZW1cIiwga2luZF0sIHVuZGVmaW5lZCwgdW5wYWQoNikgYFxuICAgICAgIyMgRmllbGRzXG4gICAgICAke2ZpZWxkcy5tYXAoKGZpZWxkKSA9PiBgKiAke2ZpZWxkfWApLmpvaW4oXCJcXG4gICAgICBcIil9XG4gICAgYCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBhZGRUYWJsZSh2aWV3OnN0cmluZywgZmllbGRzOnN0cmluZ1tdKSB7XG4gICAgdGhpcy5hZGRWaWV3KHZpZXcsIFwidGFibGVcIiwgZmllbGRzKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGFkZFVuaW9uKHZpZXc6c3RyaW5nLCBmaWVsZHM6c3RyaW5nW10sIGJ1aWx0aW46Ym9vbGVhbiA9IHRydWUpIHtcbiAgICB0aGlzLmFkZFZpZXcodmlldywgXCJ1bmlvblwiLCBmaWVsZHMpO1xuICAgIGlmKGJ1aWx0aW4pIHtcbiAgICAgIGxldCB0YWJsZSA9IGBidWlsdGluICR7dmlld31gO1xuICAgICAgdGhpcy5hZGRUYWJsZSh0YWJsZSwgZmllbGRzKTtcbiAgICAgIHRoaXMuYWRkVW5pb25NZW1iZXIodmlldywgdGFibGUpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYWRkVW5pb25NZW1iZXIodW5pb246c3RyaW5nLCBtZW1iZXI6IHN0cmluZywgbWFwcGluZz86e30pIHtcbiAgICAvLyBhcHBseSB0aGUgbmF0dXJhbCBtYXBwaW5nLlxuICAgIGlmKCFtYXBwaW5nKSB7XG4gICAgICBpZih0aGlzLnZpZXdLaW5kKHVuaW9uKSAhPT0gXCJ1bmlvblwiKSB0aHJvdyBuZXcgRXJyb3IoYFVuaW9uICcke3VuaW9ufScgbXVzdCBiZSBhZGRlZCBiZWZvcmUgYWRkaW5nIG1lbWJlcnNgKTtcbiAgICAgIG1hcHBpbmcgPSB7fTtcbiAgICAgIGZvcihsZXQgZmllbGQgb2YgdGhpcy52aWV3RmllbGRzKHVuaW9uKSkgbWFwcGluZ1tmaWVsZF0gPSBmaWVsZDtcbiAgICB9XG4gICAgbGV0IGFjdGlvbiA9IGAke3VuaW9ufSA8LS0gJHttZW1iZXJ9IDwtLSAke0pTT04uc3RyaW5naWZ5KG1hcHBpbmcpfWA7XG4gICAgdGhpcy5hZGRGYWN0KFwiYWN0aW9uXCIsIHt2aWV3OiB1bmlvbiwgYWN0aW9uLCBraW5kOiBcInVuaW9uXCIsIGl4OiAwfSlcbiAgICAgIC5hZGRGYWN0KFwiYWN0aW9uIHNvdXJjZVwiLCB7YWN0aW9uLCBcInNvdXJjZSB2aWV3XCI6IG1lbWJlcn0pO1xuXG4gICAgZm9yKGxldCBmaWVsZCBpbiBtYXBwaW5nKSB7XG4gICAgICBsZXQgbWFwcGVkID0gbWFwcGluZ1tmaWVsZF07XG4gICAgICBpZihtYXBwZWQuY29uc3RydWN0b3IgPT09IEFycmF5KSB7XG4gICAgICAgIHRoaXMuYWRkRmFjdChcImFjdGlvbiBtYXBwaW5nIGNvbnN0YW50XCIsIHthY3Rpb24sIGZyb206IGZpZWxkLCBcInZhbHVlXCI6IG1hcHBlZFswXX0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5hZGRGYWN0KFwiYWN0aW9uIG1hcHBpbmdcIiwge2FjdGlvbiwgZnJvbTogZmllbGQsIFwidG8gc291cmNlXCI6IG1lbWJlciwgXCJ0byBmaWVsZFwiOiBtYXBwZWR9KTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBhZGRRdWVyeSh2aWV3OnN0cmluZywgcXVlcnk6cnVudGltZS5RdWVyeSkge1xuICAgIHF1ZXJ5Lm5hbWUgPSB2aWV3O1xuICAgIHRoaXMuX3F1ZXJpZXNbdmlld10gPSBxdWVyeTtcbiAgICB0aGlzLmFkZFZpZXcodmlldywgXCJxdWVyeVwiLCBPYmplY3Qua2V5cyhxdWVyeS5wcm9qZWN0aW9uTWFwIHx8IHt9KSk7XG4gICAgdGhpcy5jaGFuZ2VzZXQubWVyZ2UocXVlcnkuY2hhbmdlc2V0KHRoaXMuaXhlcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgYWRkQXJ0aWZhY3RzKGFydGlmYWN0czpBcnRpZmFjdHMpIHtcbiAgICBsZXQgdmlld3MgPSBhcnRpZmFjdHMudmlld3M7XG4gICAgZm9yKGxldCB2aWV3IGluIGFydGlmYWN0cy52aWV3cykge1xuICAgICAgdGhpcy5fdmlld3Nbdmlld10gPSBcInF1ZXJ5XCI7XG4gICAgfVxuICAgIGZvcihsZXQgaWQgaW4gdmlld3MpIHRoaXMuY2hhbmdlc2V0Lm1lcmdlKHZpZXdzW2lkXS5jaGFuZ2VzZXQoZXZlKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBhZGRVSShpZDpzdHJpbmcsIHVpOlVJKSB7XG4gICAgdWkuaWQgPSBpZDtcbiAgICB0aGlzLl91aXNbaWRdID0gdWk7XG4gICAgdGhpcy5hZGRFbnRpdHkoaWQsIGlkLCBbXCJzeXN0ZW1cIiwgXCJ1aVwiXSk7XG4gICAgdGhpcy5jaGFuZ2VzZXQubWVyZ2UodWkuY2hhbmdlc2V0KHRoaXMuaXhlcikpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbn1cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gUnVudGltZSBTZXR1cFxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5hcHAuaW5pdChcImJvb3RzdHJhcFwiLCBmdW5jdGlvbiBib290c3RyYXAoKSB7XG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gRW50aXR5IFN5c3RlbVxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGxldCBwaGFzZSA9IG5ldyBCU1BoYXNlKGV2ZSk7XG4gIHBoYXNlLmFkZFRhYmxlKFwibWFudWFsIGVudGl0eVwiLCBbXCJlbnRpdHlcIiwgXCJjb250ZW50XCJdKTtcbiAgcGhhc2UuYWRkVGFibGUoXCJzb3VyY2VkIGVhdlwiLCBbXCJlbnRpdHlcIiwgXCJhdHRyaWJ1dGVcIiwgXCJ2YWx1ZVwiLCBcInNvdXJjZVwiXSk7XG4gIHBoYXNlLmFkZFRhYmxlKFwicGFnZSBjb250ZW50XCIsIFtcInBhZ2VcIiwgXCJjb250ZW50XCJdKTtcbiAgcGhhc2UuYWRkVGFibGUoXCJlbnRpdHkgcGFnZVwiLCBbXCJlbnRpdHlcIiwgXCJwYWdlXCJdKTtcbiAgcGhhc2UuYWRkVGFibGUoXCJhY3Rpb24gZW50aXR5XCIsIFtcImVudGl0eVwiLCBcImNvbnRlbnRcIiwgXCJzb3VyY2VcIl0pO1xuICBwaGFzZVxuICAgIC5hZGRFbnRpdHkoXCJlbnRpdHlcIiwgXCJlbnRpdHlcIiwgW1wic3lzdGVtXCJdKVxuICAgIC5hZGRFbnRpdHkoXCJjb2xsZWN0aW9uXCIsIFwiY29sbGVjdGlvblwiLCBbXCJzeXN0ZW1cIl0pXG4gICAgLmFkZEVudGl0eShcInN5c3RlbVwiLCBcInN5c3RlbVwiLCBbXCJzeXN0ZW1cIiwgXCJjb2xsZWN0aW9uXCJdKVxuICAgIC5hZGRFbnRpdHkoXCJ1bmlvblwiLCBcInVuaW9uXCIsIFtcInN5c3RlbVwiLCBcImNvbGxlY3Rpb25cIl0pXG4gICAgLmFkZEVudGl0eShcInF1ZXJ5XCIsIFwicXVlcnlcIiwgW1wic3lzdGVtXCIsIFwiY29sbGVjdGlvblwiXSlcbiAgICAuYWRkRW50aXR5KFwidGFibGVcIiwgXCJ0YWJsZVwiLCBbXCJzeXN0ZW1cIiwgXCJjb2xsZWN0aW9uXCJdKVxuICAgIC5hZGRFbnRpdHkoXCJ1aVwiLCBcInVpXCIsIFtcInN5c3RlbVwiLCBcImNvbGxlY3Rpb25cIl0pXG4gICAgLmFkZEVudGl0eShcImhvbWVcIiwgXCJob21lXCIsIFtcInN5c3RlbVwiXSwgdW5kZWZpbmVkLCB1bnBhZCg2KSBgXG4gICAgICB7ZW50aXR5fHJlcCA9IGRpcmVjdG9yeX1cbiAgICBgKTtcblxuICBwaGFzZS5hZGRVbmlvbihcImVudGl0eSBlYXZzXCIsIFtcImVudGl0eVwiLCBcImF0dHJpYnV0ZVwiLCBcInZhbHVlXCJdLCB0cnVlKVxuICAgIC5hZGRVbmlvbk1lbWJlcihcImVudGl0eSBlYXZzXCIsIFwiZ2VuZXJhdGVkIGVhdlwiLCB7ZW50aXR5OiBcImVudGl0eVwiLCBhdHRyaWJ1dGU6IFwiYXR0cmlidXRlXCIsIHZhbHVlOiBcInZhbHVlXCJ9KVxuICAgIC5hZGRVbmlvbk1lbWJlcihcImVudGl0eSBlYXZzXCIsIFwic291cmNlZCBlYXZcIiwge2VudGl0eTogXCJlbnRpdHlcIiwgYXR0cmlidXRlOiBcImF0dHJpYnV0ZVwiLCB2YWx1ZTogXCJ2YWx1ZVwifSlcbiAgICAvLyB0aGlzIGlzIGEgc3RvcmVkIHVuaW9uIHRoYXQgaXMgdXNlZCBieSB0aGUgYWRkIGVhdiBhY3Rpb24gdG8gdGFrZSBxdWVyeSByZXN1bHRzIGFuZFxuICAgIC8vIHB1c2ggdGhlbSBpbnRvIGVhdnMsIGUuZy4gc3VtIHNhbGFyaWVzIHBlciBkZXBhcnRtZW50IC0+IFt0b3RhbCBzYWxhcnkgPSAqXVxuICAgIC5hZGRVbmlvbk1lbWJlcihcImVudGl0eSBlYXZzXCIsIFwiYWRkZWQgZWF2c1wiKTtcblxuICBwaGFzZS5hZGRVbmlvbihcImVudGl0eSBsaW5rc1wiLCBbXCJlbnRpdHlcIiwgXCJsaW5rXCIsIFwidHlwZVwiXSlcbiAgICAuYWRkVW5pb25NZW1iZXIoXCJlbnRpdHkgbGlua3NcIiwgXCJlYXYgZW50aXR5IGxpbmtzXCIpXG4gICAgLmFkZFVuaW9uTWVtYmVyKFwiZW50aXR5IGxpbmtzXCIsIFwiaXMgYSBhdHRyaWJ1dGVzXCIsIHtlbnRpdHk6IFwiZW50aXR5XCIsIGxpbms6IFwiY29sbGVjdGlvblwiLCB0eXBlOiBbXCJpcyBhXCJdfSk7XG5cbiAgcGhhc2UuYWRkVW5pb24oXCJkaXJlY3Rpb25sZXNzIGxpbmtzXCIsIFtcImVudGl0eVwiLCBcImxpbmtcIl0pXG4gICAgLmFkZFVuaW9uTWVtYmVyKFwiZGlyZWN0aW9ubGVzcyBsaW5rc1wiLCBcImVudGl0eSBsaW5rc1wiKVxuICAgIC5hZGRVbmlvbk1lbWJlcihcImRpcmVjdGlvbmxlc3MgbGlua3NcIiwgXCJlbnRpdHkgbGlua3NcIiwge2VudGl0eTogXCJsaW5rXCIsIGxpbms6IFwiZW50aXR5XCJ9KTtcblxuICBwaGFzZS5hZGRVbmlvbihcImNvbGxlY3Rpb24gZW50aXRpZXNcIiwgW1wiZW50aXR5XCIsIFwiY29sbGVjdGlvblwiXSlcbiAgICAuYWRkVW5pb25NZW1iZXIoXCJjb2xsZWN0aW9uIGVudGl0aWVzXCIsIFwiaXMgYSBhdHRyaWJ1dGVzXCIpO1xuXG4gIHBoYXNlLmFkZEFydGlmYWN0cyhwYXJzZURTTChgXG4gICAgKHF1ZXJ5IDokJHZpZXcgXCJiczogZW50aXR5XCJcbiAgICAgIChlbnRpdHktcGFnZSA6ZW50aXR5IGVudGl0eSA6cGFnZSBwYWdlKVxuICAgICAgKHBhZ2UtY29udGVudCA6cGFnZSBwYWdlIDpjb250ZW50IGNvbnRlbnQpXG4gICAgICAocHJvamVjdCEgXCJlbnRpdHlcIiA6ZW50aXR5IGVudGl0eSA6Y29udGVudCBjb250ZW50KSlcbiAgYCkpO1xuXG4gIHBoYXNlLmFkZEFydGlmYWN0cyhwYXJzZURTTChgXG4gICAgKHF1ZXJ5IDokJHZpZXcgXCJiczogdW5tb2RpZmllZCBhZGRlZCBiaXRzXCJcbiAgICAgIChhZGRlZC1iaXRzIDplbnRpdHkgZW50aXR5IDpjb250ZW50IGNvbnRlbnQpXG4gICAgICAobmVnYXRlIChtYW51YWwtZW50aXR5IDplbnRpdHkgZW50aXR5KSlcbiAgICAgIChwcm9qZWN0ISBcInVubW9kaWZpZWQgYWRkZWQgYml0c1wiIDplbnRpdHkgZW50aXR5IDpjb250ZW50IGNvbnRlbnQpKVxuICBgKSk7XG5cbiAgcGhhc2UuYWRkQXJ0aWZhY3RzKHBhcnNlRFNMKGBcbiAgICAocXVlcnkgOiQkdmlldyBcImJzOiBpcyBhIGF0dHJpYnV0ZXNcIlxuICAgICAgKGVudGl0eS1lYXZzIDphdHRyaWJ1dGUgXCJpcyBhXCIgOmVudGl0eSBlbnRpdHkgOnZhbHVlIHZhbHVlKVxuICAgICAgKHByb2plY3QhIFwiaXMgYSBhdHRyaWJ1dGVzXCIgOmNvbGxlY3Rpb24gdmFsdWUgOmVudGl0eSBlbnRpdHkpKVxuICBgKSk7XG5cbiAgLy8gQEhBQ0s6IHRoaXMgdmlldyBpcyByZXF1aXJlZCBiZWNhdXNlIHlvdSBjYW4ndCBjdXJyZW50bHkgam9pbiBhIHNlbGVjdCBvbiB0aGUgcmVzdWx0IG9mIGEgZnVuY3Rpb24uXG4gIC8vIHNvIHdlIGNyZWF0ZSBhIHZlcnNpb24gb2YgdGhlIGVhdnMgdGFibGUgdGhhdCBhbHJlYWR5IGhhcyBldmVyeXRoaW5nIGxvd2VyY2FzZWQuXG4gIHBoYXNlLmFkZEFydGlmYWN0cyhwYXJzZURTTChgXG4gICAgKHF1ZXJ5IDokJHZpZXcgXCJiczogbG93ZXJjYXNlIGVhdnNcIlxuICAgICAgKGVudGl0eS1lYXZzIDplbnRpdHkgZW50aXR5IDphdHRyaWJ1dGUgYXR0cmlidXRlIDp2YWx1ZSB2YWx1ZSlcbiAgICAgIChsb3dlcmNhc2UgOnRleHQgdmFsdWUgOnJlc3VsdCBsb3dlcmNhc2VkKVxuICAgICAgKHByb2plY3QhIFwibG93ZXJjYXNlIGVhdnNcIiA6ZW50aXR5IGVudGl0eSA6YXR0cmlidXRlIGF0dHJpYnV0ZSA6dmFsdWUgbG93ZXJjYXNlZCkpXG4gIGApKTtcblxuICBwaGFzZS5hZGRBcnRpZmFjdHMocGFyc2VEU0woYFxuICAgIChxdWVyeSA6JCR2aWV3IFwiYnM6IGVhdiBlbnRpdHkgbGlua3NcIlxuICAgICAgKGVudGl0eS1lYXZzIDplbnRpdHkgZW50aXR5IDphdHRyaWJ1dGUgYXR0cmlidXRlIDp2YWx1ZSB2YWx1ZSlcbiAgICAgIChlbnRpdHkgOmVudGl0eSB2YWx1ZSlcbiAgICAgIChwcm9qZWN0ISBcImVhdiBlbnRpdHkgbGlua3NcIiA6ZW50aXR5IGVudGl0eSA6dHlwZSBhdHRyaWJ1dGUgOmxpbmsgdmFsdWUpKVxuICBgKSk7XG5cbiAgcGhhc2UuYWRkQXJ0aWZhY3RzKHBhcnNlRFNMKGBcbiAgICAocXVlcnkgOiQkdmlldyBcImJzOiBjb2xsZWN0aW9uXCJcbiAgICAgIChpcy1hLWF0dHJpYnV0ZXMgOmNvbGxlY3Rpb24gZW50aXR5KVxuICAgICAgKHF1ZXJ5IDokJHZpZXcgXCJiczogY29sbGVjdGlvbiBjb3VudFwiXG4gICAgICAgIChpcy1hLWF0dHJpYnV0ZXMgOmNvbGxlY3Rpb24gZW50aXR5IDplbnRpdHkgY2hpbGQpXG4gICAgICAgIChjb3VudCA6Y291bnQgY2hpbGRDb3VudCkpXG4gICAgICAocHJvamVjdCEgXCJjb2xsZWN0aW9uXCIgOmNvbGxlY3Rpb24gZW50aXR5IDpjb3VudCBjaGlsZENvdW50KSlcbiAgYCkpO1xuXG4gIHBoYXNlLmFkZEVudGl0eShcImVudGl0eVwiLCBcImVudGl0eVwiLCBbXCJzeXN0ZW1cIl0pO1xuICBwaGFzZS5hZGRFbnRpdHkoXCJjb2xsZWN0aW9uXCIsIFwiY29sbGVjdGlvblwiLCBbXCJzeXN0ZW1cIl0pO1xuICBwaGFzZS5hZGRBcnRpZmFjdHMocGFyc2VEU0wodW5wYWQoNCkgYFxuICAgIChxdWVyeSA6JCR2aWV3IFwiYnM6IGVudGl0eSBlYXZzIGZyb20gZW50aXRpZXNcIlxuICAgICAgKGVudGl0eSA6ZW50aXR5IGVudGl0eSlcbiAgICAgIChwcm9qZWN0ISBcImVudGl0eSBlYXZzXCIgOmVudGl0eSBlbnRpdHkgOmF0dHJpYnV0ZSBcImlzIGFcIiA6dmFsdWUgXCIke2J1aWx0aW5JZChcImVudGl0eVwiKX1cIikpXG4gIGApKTtcbiAgcGhhc2UuYWRkQXJ0aWZhY3RzKHBhcnNlRFNMKHVucGFkKDQpIGBcbiAgICAocXVlcnkgOiQkdmlldyBcImJzOiBlbnRpdHkgZWF2cyBmcm9tIGNvbGxlY3Rpb25zXCJcbiAgICAgIChpcy1hLWF0dHJpYnV0ZXMgOmNvbGxlY3Rpb24gY29sbClcbiAgICAgIChwcm9qZWN0ISBcImVudGl0eSBlYXZzXCIgOmVudGl0eSBjb2xsIDphdHRyaWJ1dGUgXCJpcyBhXCIgOnZhbHVlIFwiJHtidWlsdGluSWQoXCJjb2xsZWN0aW9uXCIpfVwiKSlcbiAgYCkpO1xuLyogIHBoYXNlLmFkZEFydGlmYWN0cyhwYXJzZURTTCh1bnBhZCg0KSBgXG4gICAgKHF1ZXJ5XG4gICAgICAoZW50aXR5IDplbnRpdHkgZW50aXR5KVxuICAgICAgKG5lZ2F0ZSAocXVlcnlcbiAgICAgICAgKGRpcmVjdGlvbmxlc3MtbGlua3MgOmVudGl0eSBlbnRpdHkgOmxpbmsgbGluaylcbiAgICAgICAgKCE9IGxpbmsgXCJBVVRPR0VORVJBVEVEIGVudGl0eSBUSElTIFNIT1VMRE4nVCBTSE9XIFVQIEFOWVdIRVJFXCIpXG4gICAgICAgICghPSBsaW5rIFwiQVVUT0dFTkVSQVRFRCBvcnBoYW5lZCBUSElTIFNIT1VMRE4nVCBTSE9XIFVQIEFOWVdIRVJFXCIpXG4gICAgICAgICkpXG4gICAgICAocHJvamVjdCEgXCJlbnRpdHkgZWF2c1wiIDplbnRpdHkgY29sbCA6YXR0cmlidXRlIFwiaXMgYVwiIDp2YWx1ZSBcIkFVVE9HRU5FUkFURUQgY29sbGVjdGlvbiBUSElTIFNIT1VMRE4nVCBTSE9XIFVQIEFOWVdIRVJFXCIpKVxuYCkpOyovXG5cbiAgcGhhc2UuYWRkVGFibGUoXCJ1aSBwYW5lXCIsIFtcInBhbmVcIiwgXCJjb250YWluc1wiLCBcImtpbmRcIl0pO1xuICBpZihldmUuZmluZChcInVpIHBhbmVcIikubGVuZ3RoID09PSAwKSBwaGFzZS5hZGRGYWN0KFwidWkgcGFuZVwiLCB7cGFuZTogXCJwMVwiLCBjb250YWluczogXCJwZXRcIiwga2luZDogMH0pO1xuICBwaGFzZS5hcHBseSh0cnVlKTtcblxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIFVJXG4gIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgcGhhc2UgPSBuZXcgQlNQaGFzZShldmUpO1xuXG4gIC8vIEBGSVhNRTogVGhlc2Ugc2hvdWxkIHByb2JhYmx5IGJlIHVuaW9uaXplZC5cbiAgZnVuY3Rpb24gcmVzb2x2ZSh0YWJsZSwgZmllbGRzKSB7XG4gICAgcmV0dXJuIGZpZWxkcy5tYXAoKGZpZWxkKSA9PiBgJHt0YWJsZX06ICR7ZmllbGR9YCk7XG4gIH1cbiAgcGhhc2UuYWRkVGFibGUoXCJ1aSB0ZW1wbGF0ZVwiLCByZXNvbHZlKFwidWkgdGVtcGxhdGVcIiwgW1widGVtcGxhdGVcIiwgXCJwYXJlbnRcIiwgXCJpeFwiXSkpO1xuICBwaGFzZS5hZGRUYWJsZShcInVpIHRlbXBsYXRlIGJpbmRpbmdcIiwgcmVzb2x2ZShcInVpIHRlbXBsYXRlIGJpbmRpbmdcIiwgW1widGVtcGxhdGVcIiwgXCJxdWVyeVwiXSkpO1xuICBwaGFzZS5hZGRUYWJsZShcInVpIGVtYmVkXCIsIHJlc29sdmUoXCJ1aSBlbWJlZFwiLCBbXCJlbWJlZFwiLCBcInRlbXBsYXRlXCIsIFwicGFyZW50XCIsIFwiaXhcIl0pKTtcbiAgcGhhc2UuYWRkVGFibGUoXCJ1aSBlbWJlZCBzY29wZVwiLCByZXNvbHZlKFwidWkgZW1iZWQgc2NvcGVcIiwgW1wiZW1iZWRcIiwgXCJrZXlcIiwgXCJ2YWx1ZVwiXSkpO1xuICBwaGFzZS5hZGRUYWJsZShcInVpIGVtYmVkIHNjb3BlIGJpbmRpbmdcIiwgcmVzb2x2ZShcInVpIGVtYmVkIHNjb3BlIGJpbmRpbmdcIiwgW1wiZW1iZWRcIiwgXCJrZXlcIiwgXCJzb3VyY2VcIiwgXCJhbGlhc1wiXSkpO1xuICBwaGFzZS5hZGRUYWJsZShcInVpIGF0dHJpYnV0ZVwiLCByZXNvbHZlKFwidWkgYXR0cmlidXRlXCIsIFtcInRlbXBsYXRlXCIsIFwicHJvcGVydHlcIiwgXCJ2YWx1ZVwiXSkpO1xuICBwaGFzZS5hZGRUYWJsZShcInVpIGF0dHJpYnV0ZSBiaW5kaW5nXCIsIHJlc29sdmUoXCJ1aSBhdHRyaWJ1dGUgYmluZGluZ1wiLCBbXCJ0ZW1wbGF0ZVwiLCBcInByb3BlcnR5XCIsIFwic291cmNlXCIsIFwiYWxpYXNcIl0pKTtcbiAgcGhhc2UuYWRkVGFibGUoXCJ1aSBldmVudFwiLCByZXNvbHZlKFwidWkgZXZlbnRcIiwgW1widGVtcGxhdGVcIiwgXCJldmVudFwiXSkpO1xuICBwaGFzZS5hZGRUYWJsZShcInVpIGV2ZW50IHN0YXRlXCIsIHJlc29sdmUoXCJ1aSBldmVudCBzdGF0ZVwiLCBbXCJ0ZW1wbGF0ZVwiLCBcImV2ZW50XCIsIFwia2V5XCIsIFwidmFsdWVcIl0pKTtcbiAgcGhhc2UuYWRkVGFibGUoXCJ1aSBldmVudCBzdGF0ZSBiaW5kaW5nXCIsIHJlc29sdmUoXCJ1aSBldmVudCBzdGF0ZSBiaW5kaW5nXCIsIFtcInRlbXBsYXRlXCIsIFwiZXZlbnRcIiwgXCJrZXlcIiwgXCJzb3VyY2VcIiwgXCJhbGlhc1wiXSkpO1xuXG4gIHBoYXNlLmFkZFRhYmxlKFwic3lzdGVtIHVpXCIsIFtcInRlbXBsYXRlXCJdKTtcblxuICBwaGFzZS5hcHBseSh0cnVlKTtcblxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIFRlc3RpbmdcbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBwaGFzZSA9IG5ldyBCU1BoYXNlKGV2ZSk7XG4gIGxldCB0ZXN0RGF0YSA9IHtcbiAgICBcInRlc3QgZGF0YVwiOiBbXSxcbiAgICBwZXQ6IFtdLFxuICAgIGV4b3RpYzogW10sXG4gICAgZGFuZ2Vyb3VzOiBbXSxcbiAgICBjYXQ6IFtcInBldFwiXSxcbiAgICBkb2c6IFtcInBldFwiXSxcbiAgICBmaXNoOiBbXCJwZXRcIl0sXG4gICAgc25ha2U6IFtcInBldFwiLCBcImV4b3RpY1wiXSxcbiAgICBrb2FsYTogW1wicGV0XCIsIFwiZXhvdGljXCJdLFxuICAgIHNsb3RoOiBbXCJwZXRcIiwgXCJleG90aWNcIl0sXG4gICAga2FuZ2Fyb286IFtcImV4b3RpY1wiXSxcbiAgICBnaXJhZmZlOiBbXCJleG90aWNcIl0sXG4gICAgZ29yaWxsYTogW1wiZXhvdGljXCIsIFwiZGFuZ2Vyb3VzXCJdLFxuXG4gICAgY29tcGFueTogW10sXG4gICAga29kb3dhOiBbXCJjb21wYW55XCJdLFxuXG4gICAgZGVwYXJ0bWVudDogW10sXG4gICAgZW5naW5lZXJpbmc6IFtcImRlcGFydG1lbnRcIl0sXG4gICAgb3BlcmF0aW9uczogW1wiZGVwYXJ0bWVudFwiXSxcbiAgICBtYWdpYzogW1wiZGVwYXJ0bWVudFwiXSxcblxuICAgIGVtcGxveWVlOiBbXSxcbiAgICBqb3NoOiBbXCJlbXBsb3llZVwiXSxcbiAgICBjb3JleTogW1wiZW1wbG95ZWVcIl0sXG4gICAgY2hyaXM6IFtcImVtcGxveWVlXCJdLFxuICAgIHJvYjogW1wiZW1wbG95ZWVcIl0sXG4gICAgZXJpYzogW1wiZW1wbG95ZWVcIl0sXG4gIH07XG4gIGxldCB0ZXN0QXR0cnMgPSB7XG4gICAgY2F0OiB7bGVuZ3RoOiA0fSxcbiAgICBkb2c6IHtsZW5ndGg6IDN9LFxuICAgIGZpc2g6IHtsZW5ndGg6IDF9LFxuICAgIHNuYWtlOiB7bGVuZ3RoOiA0fSxcbiAgICBrb2FsYToge2xlbmd0aDogM30sXG4gICAgc2xvdGg6IHtsZW5ndGg6IDN9LFxuICAgIGVuZ2luZWVyaW5nOiB7Y29tcGFueTogXCJrb2Rvd2FcIn0sXG4gICAgb3BlcmF0aW9uczoge2NvbXBhbnk6IFwia29kb3dhXCJ9LFxuICAgIG1hZ2ljOiB7Y29tcGFueTogXCJrb2Rvd2FcIn0sXG5cbiAgICBqb3NoOiB7ZGVwYXJ0bWVudDogXCJlbmdpbmVlcmluZ1wiLCBzYWxhcnk6IDd9LFxuICAgIGNvcmV5OiB7ZGVwYXJ0bWVudDogXCJlbmdpbmVlcmluZ1wiLCBzYWxhcnk6IDEwfSxcbiAgICBjaHJpczoge2RlcGFydG1lbnQ6IFwiZW5naW5lZXJpbmdcIiwgc2FsYXJ5OiAxMH0sXG4gICAgZXJpYzoge2RlcGFydG1lbnQ6IFwiZW5naW5lZXJpbmdcIiwgc2FsYXJ5OiA3fSxcbiAgICByb2I6IHtkZXBhcnRtZW50OiBcIm9wZXJhdGlvbnNcIiwgc2FsYXJ5OiAxMH0sXG4gIH07XG4gIGZvcihsZXQgZW50aXR5IGluIHRlc3REYXRhKSBwaGFzZS5hZGRFbnRpdHkoZW50aXR5LCBlbnRpdHksIFtcInRlc3QgZGF0YVwiXS5jb25jYXQodGVzdERhdGFbZW50aXR5XSksIHRlc3RBdHRyc1tlbnRpdHldLCBcIlwiKTtcblxuICAvLyBwaGFzZS5hZGRUYWJsZShcImRlcGFydG1lbnRcIiwgW1wiZGVwYXJ0bWVudFwiXSlcbiAgLy8gICAuYWRkRmFjdChcImRlcGFydG1lbnRcIiwge2RlcGFydG1lbnQ6IFwiZW5naW5lZXJpbmdcIn0pXG4gIC8vICAgLmFkZEZhY3QoXCJkZXBhcnRtZW50XCIsIHtkZXBhcnRtZW50OiBcIm9wZXJhdGlvbnNcIn0pXG4gIC8vICAgLmFkZEZhY3QoXCJkZXBhcnRtZW50XCIsIHtkZXBhcnRtZW50OiBcIm1hZ2ljXCJ9KTtcbiAgLy8gcGhhc2UuYWRkVGFibGUoXCJlbXBsb3llZVwiLCBbXCJkZXBhcnRtZW50XCIsIFwiZW1wbG95ZWVcIiwgXCJzYWxhcnlcIl0pXG4gIC8vICAgLmFkZEZhY3QoXCJlbXBsb3llZVwiLCB7ZGVwYXJ0bWVudDogXCJlbmdpbmVlcmluZ1wiLCBlbXBsb3llZTogXCJqb3NoXCIsIHNhbGFyeTogMTB9KVxuICAvLyAgIC5hZGRGYWN0KFwiZW1wbG95ZWVcIiwge2RlcGFydG1lbnQ6IFwiZW5naW5lZXJpbmdcIiwgZW1wbG95ZWU6IFwiY29yZXlcIiwgc2FsYXJ5OiAxMX0pXG4gIC8vICAgLmFkZEZhY3QoXCJlbXBsb3llZVwiLCB7ZGVwYXJ0bWVudDogXCJlbmdpbmVlcmluZ1wiLCBlbXBsb3llZTogXCJjaHJpc1wiLCBzYWxhcnk6IDd9KVxuICAvLyAgIC5hZGRGYWN0KFwiZW1wbG95ZWVcIiwge2RlcGFydG1lbnQ6IFwib3BlcmF0aW9uc1wiLCBlbXBsb3llZTogXCJyb2JcIiwgc2FsYXJ5OiA3fSk7XG5cbiAgcGhhc2UuYXBwbHkodHJ1ZSk7XG4gIHdpbmRvd1tcInBcIl0gPSBwaGFzZTtcbn0pO1xuXG5kZWNsYXJlIHZhciBleHBvcnRzO1xud2luZG93W1wiYm9vdHN0cmFwXCJdID0gZXhwb3J0cztcbiIsImltcG9ydCB7c3JhbmQsIHNodWZmbGUsIHNvcnRCeUZpZWxkfSBmcm9tIFwiLi91dGlsc1wiO1xuaW1wb3J0IHtFbGVtZW50LCBIYW5kbGVyfSBmcm9tIFwiLi9taWNyb1JlYWN0XCI7XG5cbmZ1bmN0aW9uIHN1bShsaXN0Om51bWJlcltdKTpudW1iZXIge1xuICBsZXQgdG90YWwgPSAwO1xuICBmb3IobGV0IG51bSBvZiBsaXN0KSB0b3RhbCArPSBudW07XG4gIHJldHVybiB0b3RhbDtcbn1cblxuZnVuY3Rpb24gdmVjbXVsKGE6bnVtYmVyW10sIGI6bnVtYmVyW10pOm51bWJlcltdIHtcbiAgaWYoIWEgfHwgIWIgfHwgYS5sZW5ndGggIT09IGIubGVuZ3RoKSB0aHJvdyBuZXcgRXJyb3IoXCJMaXN0cyBtdXN0IGJlIHNhbWUgbGVuZ3RoXCIpO1xuICBsZXQgcmVzdWx0ID0gW107XG4gIGZvcihsZXQgaSA9IDAsIGxlbiA9IGEubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHJlc3VsdFtpXSA9IGFbaV0gKiBiW2ldO1xuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1hc29ucnlMYXlvdXQgeyBzaXplOiBudW1iZXIsIGZyZXE/OiBudW1iZXIsIGdyb3VwZWQ/OiBudW1iZXIsIGM6IHN0cmluZywgZm9ybWF0PzooZWxlbTpNYXNvbnJ5VGlsZUVsZW0pID0+IE1hc29ucnlUaWxlRWxlbSB9XG5pbnRlcmZhY2UgTWFzb25yeVRpbGVFbGVtIGV4dGVuZHMgRWxlbWVudCB7IHNpemU/OiBudW1iZXIsIGxheW91dD86IE1hc29ucnlMYXlvdXQgfVxuaW50ZXJmYWNlIE1hc29ucnlFbGVtIGV4dGVuZHMgRWxlbWVudCB7IHNlZWQ/OiBudW1iZXIsIHJvd1NpemU/OiBudW1iZXIsIGNoaWxkcmVuOiBNYXNvbnJ5VGlsZUVsZW1bXSwgbGF5b3V0cz86TWFzb25yeUxheW91dFtdLCBzdHlsZXM/OnN0cmluZ1tdIH1cblxubGV0IF9sYXlvdXRzOk1hc29ucnlMYXlvdXRbXSA9IFtcbiAge3NpemU6IDQsIGM6IFwiYmlnXCJ9LFxuICB7c2l6ZTogMiwgYzogXCJkZXRhaWxlZFwifSxcbiAge3NpemU6IDEsIGM6IFwibm9ybWFsXCIsIGdyb3VwZWQ6IDJ9LFxuXTtcbmV4cG9ydCBmdW5jdGlvbiBtYXNvbnJ5KGVsZW06TWFzb25yeUVsZW0pOkVsZW1lbnQge1xuICBsZXQge3NlZWQgPSAwLCByb3dTaXplID0gOCwgbGF5b3V0cyA9IF9sYXlvdXRzLCBzdHlsZXMgPSB1bmRlZmluZWQsIGNoaWxkcmVufSA9IGVsZW07XG4gIGxldCByYW5kID0gc3JhbmQoc2VlZCk7ICBcbiAgbGF5b3V0cy5zb3J0KHNvcnRCeUZpZWxkKFwic2l6ZVwiKSk7XG5cbiAgLy8gQXNzaWduIG5vdGlvbmFsIHRpbGVzIGFuIGluaXRpYWwgc2l6ZSBiYXNlZCBvbiB0aGUgdmlzdWFsIGZyZXF1ZW5jeSBvZiBlYWNoIGxheW91dFxuICBsZXQgaXggPSAwO1xuICBsZXQgdGlsZXNQZXJMYXlvdXQgPSBbXTtcbiAgbGV0IHRvdGFsTGF5b3V0RnJlcSA9IDA7XG4gIGxldCBzaXplcyA9IFtdO1xuICBmb3IobGV0IGxheW91dCBvZiBsYXlvdXRzKSB7XG4gICAgbGF5b3V0LmZyZXEgPSBsYXlvdXQuZnJlcSB8fCAxIC8gbGF5b3V0LnNpemU7XG4gICAgdG90YWxMYXlvdXRGcmVxICs9IGxheW91dC5mcmVxO1xuICB9XG4gIGZvcihsZXQgbGF5b3V0IG9mIGxheW91dHMpIHtcbiAgICBzaXplc1tpeF0gPSBsYXlvdXQuc2l6ZTtcbiAgICB0aWxlc1BlckxheW91dFtpeCsrXSA9IE1hdGgucm91bmQobGF5b3V0LmZyZXEgLyB0b3RhbExheW91dEZyZXEgKiBjaGlsZHJlbi5sZW5ndGgpO1xuICB9XG5cbiAgLy8gRW5zdXJlIGV2ZXJ5IG5vdGlvbmFsIHRpbGUgaGFzIGFuIGFzc2lnbmVkIHNpemUgKHRvIGZpeCByb3VuZGluZyBlcnJvcnMpXG4gIGxldCB0b3RhbDtcbiAgbGV0IHRyeUl4ID0gMDtcbiAgd2hpbGUoKHRvdGFsID0gc3VtKHRpbGVzUGVyTGF5b3V0KSkgIT09IGNoaWxkcmVuLmxlbmd0aCkge1xuICAgIGlmKHN1bSh0aWxlc1BlckxheW91dCkgPiBjaGlsZHJlbi5sZW5ndGgpIHRpbGVzUGVyTGF5b3V0W3RpbGVzUGVyTGF5b3V0Lmxlbmd0aCAtIDFdIC09IDE7XG4gICAgZWxzZSBpZihzdW0odGlsZXNQZXJMYXlvdXQpIDwgY2hpbGRyZW4ubGVuZ3RoKSB0aWxlc1BlckxheW91dFt0aWxlc1BlckxheW91dC5sZW5ndGggLSAxXSArPSAxO1xuICB9XG5cbiAgLy8gT3B0aW1pemUgZGlzdHJpYnV0aW9uIG9mIG5vdGlvbmFsIHRpbGVzIHRvIG1heGltYWxseSBmaWxsIHJvd3NcbiAgdHJ5SXggPSAwLCBpeCA9IDA7XG4gIGxldCBtaW5TaXplID0gbGF5b3V0c1tsYXlvdXRzLmxlbmd0aCAtIDFdLnNpemU7XG4gIHdoaWxlKHRydWUpIHtcbiAgICBsZXQgZmlsbGVkU2l6ZSA9IHN1bSh2ZWNtdWwodGlsZXNQZXJMYXlvdXQsIHNpemVzKSk7XG4gICAgbGV0IHJvd0NvdW50ID0gTWF0aC5jZWlsKGZpbGxlZFNpemUgLyByb3dTaXplKTtcbiAgICBsZXQgZGVsdGEgPSByb3dTaXplICogcm93Q291bnQgLSBmaWxsZWRTaXplO1xuICAgIGlmKGRlbHRhIDw9IDAgfHwgdHJ5SXgrKyA+IDEwMDApIGJyZWFrO1xuICAgIC8vIFNpbmNlIHdlJ2xsIGJlIHNoaWZ0aW5nIG9uZSBvZiB0aGUgc21hbGxlc3QgbGF5b3V0IHRpbGVzIHRvIGEgYmlnZ2VyIHNpemUsIHdlIG9mZnNldCBieSB0aGF0IHNpemVcbiAgICBpZihpeCA9PT0gbGF5b3V0cy5sZW5ndGggLSAxKSBpeCA9IDA7XG4gICAgaWYoZGVsdGEgPj0gbGF5b3V0c1tpeF0uc2l6ZSAtIG1pblNpemUpIHtcbiAgICAgIHRpbGVzUGVyTGF5b3V0W2xheW91dHMubGVuZ3RoIC0gMV0tLTtcbiAgICAgIHRpbGVzUGVyTGF5b3V0W2l4XSsrO1xuICAgIH0gZWxzZSBpZihpeCA9PT0gbGF5b3V0cy5sZW5ndGggLSAyKSB7XG4gICAgICAvLyBUaGUgc2Vjb25kIHNtYWxsZXN0IHNpemUgd2FzIHN0aWxsIHRvbyBsYXJnZSwgd2UncmUgZG9uZS5cbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBpeCsrO1xuICB9XG5cbiAgLy8gQXNzaWduIGRpc2NyZXRlIHRpbGVzIHRvIHNpemVzIGJhc2VkIG9uIHRoZWlyIHJlbGF0aXZlIHNpemUgb3JkZXJpbmdcbiAgY2hpbGRyZW4uc29ydChzb3J0QnlGaWVsZChcInNpemVcIikpO1xuICBsZXQgdGlsZXMgPSBbXSwgbGF5b3V0SXggPSAwLCB0aWxlSXggPSAwO1xuICBmb3IobGV0IGNvdW50IG9mIHRpbGVzUGVyTGF5b3V0KSB7XG4gICAgbGV0IGxheW91dCA9IGxheW91dHNbbGF5b3V0SXgrK107XG4gICAgaWYoIWxheW91dC5ncm91cGVkKSB7XG4gICAgICBmb3IobGV0IGl4ID0gdGlsZUl4OyAgaXggPCB0aWxlSXggKyBjb3VudDsgaXgrKykge1xuICAgICAgICBsZXQgdGlsZSA9IGNoaWxkcmVuW2l4XTtcbiAgICAgICAgdGlsZS5jID0gYHRpbGUgJHt0aWxlLmMgfHwgXCJcIn0gJHtsYXlvdXQuYyB8fCBcIlwifWA7XG4gICAgICAgIGlmKHN0eWxlcykgdGlsZS5jICs9IFwiIFwiICsgc3R5bGVzW3RpbGVJeCAlIHN0eWxlcy5sZW5ndGhdO1xuICAgICAgICBpZihsYXlvdXQuZm9ybWF0KSB0aWxlID0gbGF5b3V0LmZvcm1hdCh0aWxlKTtcbiAgICAgICAgdGlsZXMucHVzaCh7YzogYGdyb3VwICR7bGF5b3V0LmMgfHwgXCJcIn1gLCBsYXlvdXQsIHNpemU6IGxheW91dC5zaXplLCBjaGlsZHJlbjogW3RpbGVdfSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEdyb3VwZWQgbGF5b3V0cyBhcmUgZ3JvdXBlZCBhdCB0aGlzIHN0YWdlIHRvIGtlZXAgdGhlIGxheW91dCBwcm9jZXNzIDEtZGltZW5zaW9uYWxcbiAgICAgIGxldCBhZGRlZCA9IDA7O1xuICAgICAgZm9yKGxldCBpeCA9IHRpbGVJeDsgIGl4IDwgdGlsZUl4ICsgY291bnQ7IGl4ICs9IGxheW91dC5ncm91cGVkKSB7XG4gICAgICAgIGxldCBncm91cCA9IHtjOiBgZ3JvdXAgJHtsYXlvdXQuYyB8fCBcIlwifWAsIGxheW91dCwgc2l6ZTogbGF5b3V0LnNpemUgKiBsYXlvdXQuZ3JvdXBlZCwgY2hpbGRyZW46IFtdfTtcbiAgICAgICAgZm9yKGxldCBwYXJ0SXggPSAwOyBwYXJ0SXggPCBsYXlvdXQuZ3JvdXBlZCAmJiBhZGRlZCA8IGNvdW50OyBwYXJ0SXgrKykge1xuICAgICAgICAgIGxldCB0aWxlID0gY2hpbGRyZW5baXggKyBwYXJ0SXhdO1xuICAgICAgICAgIHRpbGUuYyA9IGB0aWxlICR7dGlsZS5jIHx8IFwiXCJ9ICR7bGF5b3V0LmMgfHwgXCJcIn1gO1xuICAgICAgICAgIGlmKHN0eWxlcykgdGlsZS5jICs9IFwiIFwiICsgc3R5bGVzWyh0aWxlSXggKyBwYXJ0SXgpICUgc3R5bGVzLmxlbmd0aF07XG4gICAgICAgICAgaWYobGF5b3V0LmZvcm1hdCkgdGlsZSA9IGxheW91dC5mb3JtYXQodGlsZSk7XG4gICAgICAgICAgZ3JvdXAuY2hpbGRyZW4ucHVzaCh0aWxlKTtcbiAgICAgICAgICBhZGRlZCsrO1xuICAgICAgICB9XG4gICAgICAgIHRpbGVzLnB1c2goZ3JvdXApO1xuICAgICAgfVxuICAgIH1cbiAgICB0aWxlSXggKz0gY291bnQ7XG4gIH1cblxuICAvLyBAVE9ETzogUHVsbCB0aWxlcyBmcm9tIGJhZywgZGlzdHJpYnV0aW5nIHRoZW0gZXZlbmx5IGludG8gcm93c1xuICBsZXQgZmlsbGVkU2l6ZSA9IHN1bSh2ZWNtdWwodGlsZXNQZXJMYXlvdXQsIHNpemVzKSk7XG4gIGxldCByb3dDb3VudCA9IE1hdGguY2VpbChmaWxsZWRTaXplIC8gcm93U2l6ZSk7XG4gIGxldCByb3dzID0gW107XG4gIGZvcihsZXQgaXggPSAwOyBpeCA8IHJvd0NvdW50OyBpeCsrKSByb3dzLnB1c2goe2M6IFwibWFzb25yeS1yb3dcIiwgY2hpbGRyZW46IFtdLCBzaXplOiAwfSk7XG4gIHRyeUl4ID0gMDtcbiAgbGV0IHJvd0l4ID0gMDtcbiAgZm9yKGxldCB0aWxlIG9mIHRpbGVzKSB7XG4gICAgbGV0IHNpemUgPSB0aWxlLmxheW91dC5zaXplICogKHRpbGUubGF5b3V0Lmdyb3VwZWQgfHwgMSk7XG4gICAgbGV0IHBsYWNlZCA9IGZhbHNlO1xuICAgIGxldCBhdHRlbXB0cyA9IDA7XG4gICAgd2hpbGUoIXBsYWNlZCkge1xuICAgICAgbGV0IHJvdyA9IHJvd3Nbcm93SXhdO1xuICAgICAgaWYocm93LnNpemUgKyBzaXplIDw9IHJvd1NpemUpIHtcbiAgICAgICAgcm93LnNpemUgKz0gc2l6ZTtcbiAgICAgICAgcm93LmNoaWxkcmVuLnB1c2godGlsZSk7XG4gICAgICAgIHBsYWNlZCA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIHJvd0l4Kys7XG4gICAgICBpZihyb3dJeCA+PSByb3dDb3VudCkgcm93SXggPSAwO1xuICAgICAgYXR0ZW1wdHMrKztcbiAgICAgIGlmKGF0dGVtcHRzID09PSByb3dDb3VudCkgYnJlYWs7XG4gICAgfVxuICAgIGlmKCFwbGFjZWQpIGNvbnNvbGUuZXJyb3IoXCJDb3VsZCBub3QgcGxhY2UgdGlsZVwiLCB0aWxlKTtcbiAgfVxuICBpeCA9IDA7XG4gIC8vIFNodWZmbGUgdGhlIHJvdyBjb250ZW50cyBhbmQgdGhlIHNldCBvZiByb3dzIGZvciBwbGVhc2luZyBpcnJlZ3VsYXJpdHlcbiAgZm9yKGxldCByb3cgb2Ygcm93cykgc2h1ZmZsZShyb3cuY2hpbGRyZW4sIHJhbmQpO1xuICBzaHVmZmxlKHJvd3MsIHJhbmQpO1xuXG4gIGVsZW0uYyA9IGBtYXNvbnJ5ICR7ZWxlbS5jIHx8IFwiXCJ9YDtcbiAgZWxlbS5jaGlsZHJlbiA9IHJvd3M7XG4gIHJldHVybiBlbGVtO1xufVxuIiwiZGVjbGFyZSB2YXIgVmVsb2NpdHk7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSGFuZGxlcjxUIGV4dGVuZHMgRXZlbnQ+IHtcbiAgKGV2dDpULCBlbGVtOkVsZW1lbnQpOiB2b2lkXG59XG5leHBvcnQgaW50ZXJmYWNlIFJlbmRlckhhbmRsZXIge1xuICAobm9kZTpIVE1MRWxlbWVudCwgZWxlbTpFbGVtZW50KTogdm9pZFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEVsZW1lbnQge1xuICB0PzpzdHJpbmdcbiAgYz86c3RyaW5nXG4gIGlkPzpzdHJpbmdcbiAgcGFyZW50PzpzdHJpbmdcbiAgY2hpbGRyZW4/OkVsZW1lbnRbXVxuICBpeD86bnVtYmVyXG4gIGtleT86c3RyaW5nXG4gIGRpcnR5Pzpib29sZWFuXG4gIHNlbWFudGljPzpzdHJpbmdcbiAgdHdlZW4/OiBhbnlcbiAgZW50ZXI/OiBhbnlcbiAgbGVhdmU/OiBhbnlcbiAgZGVidWc/OmFueVxuXG4gIC8vIENvbnRlbnRcbiAgY29udGVudEVkaXRhYmxlPzpib29sZWFuXG4gIGNoZWNrZWQ/OmJvb2xlYW5cbiAgZHJhZ2dhYmxlPzpib29sZWFuXG4gIGhyZWY/OnN0cmluZ1xuICBzcmM/OnN0cmluZ1xuICBkYXRhPzphbnlcbiAgZG93bmxvYWQ/OnN0cmluZ1xuICBhbGxvd2Z1bGxzY3JlZW4/OmJvb2xlYW5cbiAgcGxhY2Vob2xkZXI/OnN0cmluZ1xuICBzZWxlY3RlZD86Ym9vbGVhblxuICB0YWJpbmRleD86bnVtYmVyXG4gIHRleHQ/OnN0cmluZ1xuICBzdHJpY3RUZXh0PzogYm9vbGVhblxuICB0eXBlPzpzdHJpbmdcbiAgdmFsdWU/OnN0cmluZ1xuICBkYW5nZXJvdXNseVNldElubmVySFRNTD86c3RyaW5nXG5cbiAgc3R5bGU/OiBzdHJpbmcsXG5cbiAgLy8gU3R5bGVzIChTdHJ1Y3R1cmUpXG4gIGZsZXg/Om51bWJlcnxzdHJpbmdcbiAgbGVmdD86bnVtYmVyfHN0cmluZ1xuICB0b3A/Om51bWJlcnxzdHJpbmdcbiAgd2lkdGg/Om51bWJlcnxzdHJpbmdcbiAgaGVpZ2h0PzpudW1iZXJ8c3RyaW5nXG4gIHRleHRBbGlnbj86c3RyaW5nXG4gIHRyYW5zZm9ybT86c3RyaW5nXG4gIHZlcnRpY2FsQWxpZ24/OnN0cmluZ1xuICB6SW5kZXg/Om51bWJlclxuXG4gIC8vIFN0eWxlcyAoQWVzdGhldGljKVxuICBiYWNrZ3JvdW5kQ29sb3I/OnN0cmluZ1xuICBiYWNrZ3JvdW5kSW1hZ2U/OnN0cmluZ1xuICBib3JkZXI/OnN0cmluZ1xuICBib3JkZXJDb2xvcj86c3RyaW5nXG4gIGJvcmRlcldpZHRoPzpudW1iZXJ8c3RyaW5nXG4gIGJvcmRlclJhZGl1cz86bnVtYmVyfHN0cmluZ1xuICBjb2xvcj86c3RyaW5nXG4gIGNvbHNwYW4/Om51bWJlclxuICBmb250RmFtaWx5PzpzdHJpbmdcbiAgZm9udFNpemU/OnN0cmluZ1xuXG4gIG9wYWNpdHk/Om51bWJlclxuXG4gIC8vIFN2Z1xuICBzdmc/OmJvb2xlYW5cbiAgeD86bnVtYmVyfHN0cmluZ1xuICB5PzpudW1iZXJ8c3RyaW5nXG4gIGR4PzpudW1iZXJ8c3RyaW5nXG4gIGR5PzpudW1iZXJ8c3RyaW5nXG4gIGN4PzpudW1iZXJ8c3RyaW5nXG4gIGN5PzpudW1iZXJ8c3RyaW5nXG4gIHI/Om51bWJlcnxzdHJpbmdcbiAgZD86bnVtYmVyfHN0cmluZ1xuICBmaWxsPzpzdHJpbmdcbiAgc3Ryb2tlPzpzdHJpbmdcbiAgc3Ryb2tlV2lkdGg/OnN0cmluZ1xuICBzdGFydE9mZnNldD86bnVtYmVyfHN0cmluZ1xuICB0ZXh0QW5jaG9yPzpzdHJpbmdcbiAgdmlld0JveD86c3RyaW5nXG4gIHhsaW5raHJlZj86c3RyaW5nXG5cbiAgLy8gRXZlbnRzXG4gIGRibGNsaWNrPzpIYW5kbGVyPE1vdXNlRXZlbnQ+XG4gIGNsaWNrPzpIYW5kbGVyPE1vdXNlRXZlbnQ+XG4gIGNvbnRleHRtZW51PzpIYW5kbGVyPE1vdXNlRXZlbnQ+XG4gIG1vdXNlZG93bj86SGFuZGxlcjxNb3VzZUV2ZW50PlxuICBtb3VzZW1vdmU/OkhhbmRsZXI8TW91c2VFdmVudD5cbiAgbW91c2V1cD86SGFuZGxlcjxNb3VzZUV2ZW50PlxuICBtb3VzZW92ZXI/OkhhbmRsZXI8TW91c2VFdmVudD5cbiAgbW91c2VvdXQ/OkhhbmRsZXI8TW91c2VFdmVudD5cbiAgbW91c2VsZWF2ZT86SGFuZGxlcjxNb3VzZUV2ZW50PlxuICBtb3VzZXdoZWVsPzpIYW5kbGVyPE1vdXNlRXZlbnQ+XG4gIGRyYWdvdmVyPzpIYW5kbGVyPE1vdXNlRXZlbnQ+XG4gIGRyYWdzdGFydD86SGFuZGxlcjxNb3VzZUV2ZW50PlxuICBkcmFnZW5kPzpIYW5kbGVyPE1vdXNlRXZlbnQ+XG4gIGRyYWc/OkhhbmRsZXI8TW91c2VFdmVudD5cbiAgZHJvcD86SGFuZGxlcjxNb3VzZUV2ZW50PlxuICBzY3JvbGw/OkhhbmRsZXI8TW91c2VFdmVudD5cbiAgZm9jdXM/OkhhbmRsZXI8Rm9jdXNFdmVudD5cbiAgYmx1cj86SGFuZGxlcjxGb2N1c0V2ZW50PlxuICBpbnB1dD86SGFuZGxlcjxFdmVudD5cbiAgY2hhbmdlPzpIYW5kbGVyPEV2ZW50PlxuICBrZXl1cD86SGFuZGxlcjxLZXlib2FyZEV2ZW50PlxuICBrZXlkb3duPzpIYW5kbGVyPEtleWJvYXJkRXZlbnQ+XG5cbiAgcG9zdFJlbmRlcj86UmVuZGVySGFuZGxlclxuXG4gIFthdHRyOnN0cmluZ106IGFueVxufVxuXG5mdW5jdGlvbiBub3coKSB7XG4gIGlmKHdpbmRvdy5wZXJmb3JtYW5jZSkge1xuICAgIHJldHVybiB3aW5kb3cucGVyZm9ybWFuY2Uubm93KCk7XG4gIH1cbiAgcmV0dXJuIChuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7XG59XG5cbmZ1bmN0aW9uIHNoYWxsb3dFcXVhbHMoYSwgYikge1xuICBpZihhID09PSBiKSByZXR1cm4gdHJ1ZTtcbiAgaWYoIWEgfHwgIWIpIHJldHVybiBmYWxzZTtcbiAgZm9yKHZhciBrIGluIGEpIHtcbiAgICBpZihhW2tdICE9PSBiW2tdKSByZXR1cm4gZmFsc2U7XG4gIH1cbiAgZm9yKHZhciBrIGluIGIpIHtcbiAgICBpZihiW2tdICE9PSBhW2tdKSByZXR1cm4gZmFsc2U7XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59XG5cbmZ1bmN0aW9uIHBvc3RBbmltYXRpb25SZW1vdmUoZWxlbWVudHMpIHtcbiAgZm9yKGxldCBlbGVtIG9mIGVsZW1lbnRzKSB7XG4gICAgaWYoZWxlbS5wYXJlbnROb2RlKSBlbGVtLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWxlbSk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFJlbmRlcmVyIHtcbiAgLy8gQFRPRE86IEEgbW9yZSBwZXJmb3JtYW50IGltcGxlbWVudGF0aW9uIHdvdWxkIGhhdmUgYSB3YXkgb2YgcmVuZGVyaW5nIHN1YnRyZWVzIGFuZCBqdXN0IGhhdmUgYSBsYW1iZGEgUmVuZGVyZXIgdG8gY29tcGlsZSBpbnRvXG4gIHN0YXRpYyBfY29tcGlsZVJlbmRlcmVyOntbaWQ6c3RyaW5nXTogUmVuZGVyZXJ9ID0ge307XG4gIHN0YXRpYyBjb21waWxlKGVsZW06RWxlbWVudCkge1xuICAgIGlmKCFlbGVtLmlkKSB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgY29tcGlsZSBlbGVtZW50IHdpdGggaWQgXCIgKyBlbGVtLmlkKTtcbiAgICBsZXQgcmVuZGVyZXIgPSBSZW5kZXJlci5fY29tcGlsZVJlbmRlcmVyW2VsZW0uaWRdO1xuICAgIGlmKCFyZW5kZXJlcikgcmVuZGVyZXIgPSBSZW5kZXJlci5fY29tcGlsZVJlbmRlcmVyW2VsZW0uaWRdID0gbmV3IFJlbmRlcmVyKCk7XG4gICAgcmVuZGVyZXIucmVuZGVyKFtlbGVtXSk7XG4gICAgcmV0dXJuIHJlbmRlcmVyLmVsZW1lbnRDYWNoZVtlbGVtLmlkXTtcbiAgfVxuICBcbiAgY29udGVudDogSFRNTEVsZW1lbnQ7XG4gIGVsZW1lbnRDYWNoZToge1tpZDpzdHJpbmddOiBIVE1MRWxlbWVudH07XG4gIHByZXZUcmVlOntbaWQ6c3RyaW5nXTogRWxlbWVudH07XG4gIHRyZWU6e1tpZDpzdHJpbmddOiBFbGVtZW50fTtcbiAgcG9zdFJlbmRlcnM6IEVsZW1lbnRbXTtcbiAgbGFzdERpZmY6IHthZGRzOiBzdHJpbmdbXSwgdXBkYXRlczoge319O1xuICBxdWV1ZWQ6IGJvb2xlYW47XG4gIGhhbmRsZUV2ZW50OiAoYW55KTtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5jb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICB0aGlzLmNvbnRlbnQuY2xhc3NOYW1lID0gXCJfX3Jvb3RcIjtcbiAgICB0aGlzLmVsZW1lbnRDYWNoZSA9IHsgXCJfX3Jvb3RcIjogdGhpcy5jb250ZW50IH07XG4gICAgdGhpcy5wcmV2VHJlZSA9IHt9O1xuICAgIHRoaXMudHJlZSA9IHt9O1xuICAgIHRoaXMucG9zdFJlbmRlcnMgPSBbXTtcbiAgICB0aGlzLmxhc3REaWZmID0ge2FkZHM6IFtdLCB1cGRhdGVzOiB7fX07XG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIHRoaXMuaGFuZGxlRXZlbnQgPSBmdW5jdGlvbiBoYW5kbGVFdmVudChlOiBFdmVudCkge1xuICAgICAgdmFyIGlkID0gKGUuY3VycmVudFRhcmdldCB8fCBlLnRhcmdldClbXCJfaWRcIl07XG4gICAgICB2YXIgZWxlbSA9IHNlbGYudHJlZVtpZF07XG4gICAgICBpZiAoIWVsZW0pIHJldHVybjtcbiAgICAgIHZhciBoYW5kbGVyID0gZWxlbVtlLnR5cGVdO1xuICAgICAgaWYgKGhhbmRsZXIpIHsgaGFuZGxlcihlLCBlbGVtKTsgfVxuICAgIH07XG4gIH1cbiAgcmVzZXQoKSB7XG4gICAgdGhpcy5wcmV2VHJlZSA9IHRoaXMudHJlZTtcbiAgICB0aGlzLnRyZWUgPSB7fTtcbiAgICB0aGlzLnBvc3RSZW5kZXJzID0gW107XG4gIH1cblxuICBkb21pZnkoKSB7XG4gICAgdmFyIGZha2VQcmV2OkVsZW1lbnQgPSB7fTsgLy9jcmVhdGUgYW4gZW1wdHkgb2JqZWN0IG9uY2UgaW5zdGVhZCBvZiBldmVyeSBpbnN0YW5jZSBvZiB0aGUgbG9vcFxuICAgIHZhciBlbGVtZW50cyA9IHRoaXMudHJlZTtcbiAgICB2YXIgcHJldkVsZW1lbnRzID0gdGhpcy5wcmV2VHJlZTtcbiAgICB2YXIgZGlmZiA9IHRoaXMubGFzdERpZmY7XG4gICAgdmFyIGFkZHMgPSBkaWZmLmFkZHM7XG4gICAgdmFyIHVwZGF0ZXMgPSBkaWZmLnVwZGF0ZXM7XG4gICAgdmFyIGVsZW1LZXlzID0gT2JqZWN0LmtleXModXBkYXRlcyk7XG4gICAgdmFyIGVsZW1lbnRDYWNoZSA9IHRoaXMuZWxlbWVudENhY2hlO1xuICAgIHZhciB0ZW1wVHdlZW46YW55ID0ge307XG5cbiAgICAvL0NyZWF0ZSBhbGwgdGhlIG5ldyBlbGVtZW50cyB0byBlbnN1cmUgdGhhdCB0aGV5J3JlIHRoZXJlIHdoZW4gdGhleSBuZWVkIHRvIGJlXG4gICAgLy9wYXJlbnRlZFxuICAgIGZvcih2YXIgaSA9IDAsIGxlbiA9IGFkZHMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIHZhciBpZCA9IGFkZHNbaV07XG4gICAgICB2YXIgY3VyID0gZWxlbWVudHNbaWRdO1xuICAgICAgdmFyIGRpdjogYW55O1xuICAgICAgaWYgKGN1ci5zdmcpIHtcbiAgICAgICAgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKFwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiwgY3VyLnQgfHwgXCJyZWN0XCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChjdXIudCB8fCBcImRpdlwiKTtcbiAgICAgIH1cbiAgICAgIGRpdi5faWQgPSBpZDtcbiAgICAgIGVsZW1lbnRDYWNoZVtpZF0gPSBkaXY7XG4gICAgICBpZihjdXIuZW50ZXIpIHtcbiAgICAgICAgaWYoY3VyLmVudGVyLmRlbGF5KSB7XG4gICAgICAgICAgY3VyLmVudGVyLmRpc3BsYXkgPSBcImF1dG9cIjtcbiAgICAgICAgICBkaXYuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgICB9XG5cbiAgICAgICAgVmVsb2NpdHkoZGl2LCBjdXIuZW50ZXIsIGN1ci5lbnRlcik7XG5cbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IodmFyIGkgPSAwLCBsZW4gPSBlbGVtS2V5cy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgdmFyIGlkID0gZWxlbUtleXNbaV07XG4gICAgICB2YXIgY3VyID0gZWxlbWVudHNbaWRdO1xuICAgICAgdmFyIHByZXYgPSBwcmV2RWxlbWVudHNbaWRdIHx8IGZha2VQcmV2O1xuICAgICAgdmFyIHR5cGUgPSB1cGRhdGVzW2lkXTtcbiAgICAgIHZhciBkaXY7XG4gICAgICBpZih0eXBlID09PSBcInJlcGxhY2VkXCIpIHtcbiAgICAgICAgdmFyIG1lID0gZWxlbWVudENhY2hlW2lkXTtcbiAgICAgICAgaWYgKG1lLnBhcmVudE5vZGUpIG1lLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobWUpO1xuICAgICAgICBpZiAoY3VyLnN2Zykge1xuICAgICAgICAgIGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhcImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCIsIGN1ci50IHx8IFwicmVjdFwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGN1ci50IHx8IFwiZGl2XCIpO1xuICAgICAgICB9XG4gICAgICAgIHByZXYgPSBmYWtlUHJldjtcbiAgICAgICAgZGl2Ll9pZCA9IGlkO1xuICAgICAgICBlbGVtZW50Q2FjaGVbaWRdID0gZGl2O1xuICAgICAgfSBlbHNlIGlmICh0eXBlID09PSBcInJlbW92ZWRcIikge1xuICAgICAgICAvL05PVEU6IEJhdGNoaW5nIHRoZSByZW1vdmVzIHN1Y2ggdGhhdCB5b3Ugb25seSByZW1vdmUgdGhlIHBhcmVudFxuICAgICAgICAvL2RpZG4ndCBhY3R1YWxseSBtYWtlIHRoaXMgZmFzdGVyIHN1cnByaXNpbmdseS4gR2l2ZW4gdGhhdCB0aGlzXG4gICAgICAgIC8vc3RyYXRlZ3kgaXMgbXVjaCBzaW1wbGVyIGFuZCB0aGVyZSdzIG5vIG5vdGljYWJsZSBwZXJmIGRpZmZlcmVuY2VcbiAgICAgICAgLy93ZSdsbCBqdXN0IGRvIHRoZSBkdW1iIHRoaW5nIGFuZCByZW1vdmUgYWxsIHRoZSBjaGlsZHJlbiBvbmUgYnkgb25lLlxuICAgICAgICB2YXIgbWUgPSBlbGVtZW50Q2FjaGVbaWRdXG4gICAgICAgIGlmKHByZXYubGVhdmUpIHtcbiAgICAgICAgICBwcmV2LmxlYXZlLmNvbXBsZXRlID0gcG9zdEFuaW1hdGlvblJlbW92ZTtcbiAgICAgICAgICBpZihwcmV2LmxlYXZlLmFic29sdXRlKSB7XG4gICAgICAgICAgICBtZS5zdHlsZS5wb3NpdGlvbiA9IFwiYWJzb2x1dGVcIjtcbiAgICAgICAgICB9XG4gICAgICAgICAgVmVsb2NpdHkobWUsIHByZXYubGVhdmUsIHByZXYubGVhdmUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYobWUucGFyZW50Tm9kZSkgbWUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChtZSk7XG4gICAgICAgIGVsZW1lbnRDYWNoZVtpZF0gPSBudWxsO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRpdiA9IGVsZW1lbnRDYWNoZVtpZF07XG4gICAgICB9XG5cbiAgICAgIHZhciBzdHlsZSA9IGRpdi5zdHlsZTtcbiAgICAgIGlmKGN1ci5jICE9PSBwcmV2LmMpIGRpdi5jbGFzc05hbWUgPSBjdXIuYztcbiAgICAgIGlmKGN1ci5kcmFnZ2FibGUgIT09IHByZXYuZHJhZ2dhYmxlKSBkaXYuZHJhZ2dhYmxlID0gY3VyLmRyYWdnYWJsZSA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IFwidHJ1ZVwiO1xuICAgICAgaWYoY3VyLmNvbnRlbnRFZGl0YWJsZSAhPT0gcHJldi5jb250ZW50RWRpdGFibGUpIGRpdi5jb250ZW50RWRpdGFibGUgPSBjdXIuY29udGVudEVkaXRhYmxlICE9PSB1bmRlZmluZWQgPyBKU09OLnN0cmluZ2lmeShjdXIuY29udGVudEVkaXRhYmxlKSA6IFwiaW5oZXJpdFwiO1xuICAgICAgaWYoY3VyLmNvbHNwYW4gIT09IHByZXYuY29sc3BhbikgZGl2LmNvbFNwYW4gPSBjdXIuY29sc3BhbjtcbiAgICAgIGlmKGN1ci5wbGFjZWhvbGRlciAhPT0gcHJldi5wbGFjZWhvbGRlcikgZGl2LnBsYWNlaG9sZGVyID0gY3VyLnBsYWNlaG9sZGVyO1xuICAgICAgaWYoY3VyLnNlbGVjdGVkICE9PSBwcmV2LnNlbGVjdGVkKSBkaXYuc2VsZWN0ZWQgPSBjdXIuc2VsZWN0ZWQ7XG4gICAgICBpZihjdXIudmFsdWUgIT09IHByZXYudmFsdWUpIGRpdi52YWx1ZSA9IGN1ci52YWx1ZTtcbiAgICAgIGlmKGN1ci50ID09PSBcImlucHV0XCIgJiYgY3VyLnR5cGUgIT09IHByZXYudHlwZSkgZGl2LnR5cGUgPSBjdXIudHlwZTtcbiAgICAgIGlmKGN1ci50ID09PSBcImlucHV0XCIgJiYgY3VyLmNoZWNrZWQgIT09IHByZXYuY2hlY2tlZCkgZGl2LmNoZWNrZWQgPSBjdXIuY2hlY2tlZDtcbiAgICAgIGlmKChjdXIudGV4dCAhPT0gcHJldi50ZXh0IHx8IGN1ci5zdHJpY3RUZXh0KSAmJiBkaXYudGV4dENvbnRlbnQgIT09IGN1ci50ZXh0KSBkaXYudGV4dENvbnRlbnQgPSBjdXIudGV4dCA9PT0gdW5kZWZpbmVkID8gXCJcIiA6IGN1ci50ZXh0O1xuICAgICAgaWYoY3VyLnRhYmluZGV4ICE9PSBwcmV2LnRhYmluZGV4KSBkaXYuc2V0QXR0cmlidXRlKFwidGFiaW5kZXhcIiwgY3VyLnRhYmluZGV4KTtcbiAgICAgIGlmKGN1ci5ocmVmICE9PSBwcmV2LmhyZWYpIGRpdi5zZXRBdHRyaWJ1dGUoXCJocmVmXCIsIGN1ci5ocmVmKTtcbiAgICAgIGlmKGN1ci5zcmMgIT09IHByZXYuc3JjKSBkaXYuc2V0QXR0cmlidXRlKFwic3JjXCIsIGN1ci5zcmMpO1xuICAgICAgaWYoY3VyLmRhdGEgIT09IHByZXYuZGF0YSkgZGl2LnNldEF0dHJpYnV0ZShcImRhdGFcIiwgY3VyLmRhdGEpO1xuICAgICAgaWYoY3VyLmRvd25sb2FkICE9PSBwcmV2LmRvd25sb2FkKSBkaXYuc2V0QXR0cmlidXRlKFwiZG93bmxvYWRcIiwgY3VyLmRvd25sb2FkKTtcbiAgICAgIGlmKGN1ci5hbGxvd2Z1bGxzY3JlZW4gIT09IHByZXYuYWxsb3dmdWxsc2NyZWVuKSBkaXYuc2V0QXR0cmlidXRlKFwiYWxsb3dmdWxsc2NyZWVuXCIsIGN1ci5hbGxvd2Z1bGxzY3JlZW4pO1xuXG4gICAgICAvLyBhbmltYXRlYWJsZSBwcm9wZXJ0aWVzXG4gICAgICB2YXIgdHdlZW4gPSBjdXIudHdlZW4gfHwgdGVtcFR3ZWVuO1xuICAgICAgaWYoY3VyLmZsZXggIT09IHByZXYuZmxleCkge1xuICAgICAgICBpZih0d2Vlbi5mbGV4KSB0ZW1wVHdlZW4uZmxleCA9IGN1ci5mbGV4O1xuICAgICAgICBlbHNlIHN0eWxlLmZsZXggPSBjdXIuZmxleCA9PT0gdW5kZWZpbmVkID8gXCJcIiA6IGN1ci5mbGV4O1xuICAgICAgfVxuICAgICAgaWYoY3VyLmxlZnQgIT09IHByZXYubGVmdCkge1xuICAgICAgICAgIGlmKHR3ZWVuLmxlZnQpIHRlbXBUd2Vlbi5sZWZ0ID0gY3VyLmxlZnQ7XG4gICAgICAgICAgZWxzZSBzdHlsZS5sZWZ0ID0gY3VyLmxlZnQgPT09IHVuZGVmaW5lZCA/IFwiXCIgOiBjdXIubGVmdDtcbiAgICAgIH1cbiAgICAgIGlmKGN1ci50b3AgIT09IHByZXYudG9wKSB7XG4gICAgICAgIGlmKHR3ZWVuLnRvcCkgdGVtcFR3ZWVuLnRvcCA9IGN1ci50b3A7XG4gICAgICAgIGVsc2Ugc3R5bGUudG9wID0gY3VyLnRvcCA9PT0gdW5kZWZpbmVkID8gXCJcIiA6IGN1ci50b3A7XG4gICAgICB9XG4gICAgICBpZihjdXIuaGVpZ2h0ICE9PSBwcmV2LmhlaWdodCkge1xuICAgICAgICBpZih0d2Vlbi5oZWlnaHQpIHRlbXBUd2Vlbi5oZWlnaHQgPSBjdXIuaGVpZ2h0O1xuICAgICAgICBlbHNlIHN0eWxlLmhlaWdodCA9IGN1ci5oZWlnaHQgPT09IHVuZGVmaW5lZCA/IFwiYXV0b1wiIDogY3VyLmhlaWdodDtcbiAgICAgIH1cbiAgICAgIGlmKGN1ci53aWR0aCAhPT0gcHJldi53aWR0aCkge1xuICAgICAgICBpZih0d2Vlbi53aWR0aCkgdGVtcFR3ZWVuLndpZHRoID0gY3VyLndpZHRoO1xuICAgICAgICBlbHNlIHN0eWxlLndpZHRoID0gY3VyLndpZHRoID09PSB1bmRlZmluZWQgPyBcImF1dG9cIiA6IGN1ci53aWR0aDtcbiAgICAgIH1cbiAgICAgIGlmKGN1ci56SW5kZXggIT09IHByZXYuekluZGV4KSB7XG4gICAgICAgIGlmKHR3ZWVuLnpJbmRleCkgdGVtcFR3ZWVuLnpJbmRleCA9IGN1ci56SW5kZXg7XG4gICAgICAgIGVsc2Ugc3R5bGUuekluZGV4ID0gY3VyLnpJbmRleDtcbiAgICAgIH1cbiAgICAgIGlmKGN1ci5iYWNrZ3JvdW5kQ29sb3IgIT09IHByZXYuYmFja2dyb3VuZENvbG9yKSB7XG4gICAgICAgIGlmKHR3ZWVuLmJhY2tncm91bmRDb2xvcikgdGVtcFR3ZWVuLmJhY2tncm91bmRDb2xvciA9IGN1ci5iYWNrZ3JvdW5kQ29sb3I7XG4gICAgICAgIGVsc2Ugc3R5bGUuYmFja2dyb3VuZENvbG9yID0gY3VyLmJhY2tncm91bmRDb2xvciB8fCBcInRyYW5zcGFyZW50XCI7XG4gICAgICB9XG4gICAgICBpZihjdXIuYm9yZGVyQ29sb3IgIT09IHByZXYuYm9yZGVyQ29sb3IpIHtcbiAgICAgICAgaWYodHdlZW4uYm9yZGVyQ29sb3IpIHRlbXBUd2Vlbi5ib3JkZXJDb2xvciA9IGN1ci5ib3JkZXJDb2xvcjtcbiAgICAgICAgZWxzZSBzdHlsZS5ib3JkZXJDb2xvciA9IGN1ci5ib3JkZXJDb2xvciB8fCBcIm5vbmVcIjtcbiAgICAgIH1cbiAgICAgIGlmKGN1ci5ib3JkZXJXaWR0aCAhPT0gcHJldi5ib3JkZXJXaWR0aCkge1xuICAgICAgICBpZih0d2Vlbi5ib3JkZXJXaWR0aCkgdGVtcFR3ZWVuLmJvcmRlcldpZHRoID0gY3VyLmJvcmRlcldpZHRoO1xuICAgICAgICBlbHNlIHN0eWxlLmJvcmRlcldpZHRoID0gY3VyLmJvcmRlcldpZHRoIHx8IDA7XG4gICAgICB9XG4gICAgICBpZihjdXIuYm9yZGVyUmFkaXVzICE9PSBwcmV2LmJvcmRlclJhZGl1cykge1xuICAgICAgICBpZih0d2Vlbi5ib3JkZXJSYWRpdXMpIHRlbXBUd2Vlbi5ib3JkZXJSYWRpdXMgPSBjdXIuYm9yZGVyUmFkaXVzO1xuICAgICAgICBlbHNlIHN0eWxlLmJvcmRlclJhZGl1cyA9IChjdXIuYm9yZGVyUmFkaXVzIHx8IDApICsgXCJweFwiO1xuICAgICAgfVxuICAgICAgaWYoY3VyLm9wYWNpdHkgIT09IHByZXYub3BhY2l0eSkge1xuICAgICAgICBpZih0d2Vlbi5vcGFjaXR5KSB0ZW1wVHdlZW4ub3BhY2l0eSA9IGN1ci5vcGFjaXR5O1xuICAgICAgICBlbHNlIHN0eWxlLm9wYWNpdHkgPSBjdXIub3BhY2l0eSA9PT0gdW5kZWZpbmVkID8gMSA6IGN1ci5vcGFjaXR5O1xuICAgICAgfVxuICAgICAgaWYoY3VyLmZvbnRTaXplICE9PSBwcmV2LmZvbnRTaXplKSB7XG4gICAgICAgIGlmKHR3ZWVuLmZvbnRTaXplKSB0ZW1wVHdlZW4uZm9udFNpemUgPSBjdXIuZm9udFNpemU7XG4gICAgICAgIGVsc2Ugc3R5bGUuZm9udFNpemUgPSBjdXIuZm9udFNpemU7XG4gICAgICB9XG4gICAgICBpZihjdXIuY29sb3IgIT09IHByZXYuY29sb3IpIHtcbiAgICAgICAgaWYodHdlZW4uY29sb3IpIHRlbXBUd2Vlbi5jb2xvciA9IGN1ci5jb2xvcjtcbiAgICAgICAgZWxzZSBzdHlsZS5jb2xvciA9IGN1ci5jb2xvciB8fCBcImluaGVyaXRcIjtcbiAgICAgIH1cblxuICAgICAgbGV0IGFuaW1LZXlzID0gT2JqZWN0LmtleXModGVtcFR3ZWVuKTtcbiAgICAgIGlmKGFuaW1LZXlzLmxlbmd0aCkge1xuICAgICAgICBWZWxvY2l0eShkaXYsIHRlbXBUd2VlbiwgdHdlZW4pO1xuICAgICAgICB0ZW1wVHdlZW4gPSB7fTtcbiAgICAgIH1cblxuICAgICAgLy8gbm9uLWFuaW1hdGlvbiBzdHlsZSBwcm9wZXJ0aWVzXG4gICAgICBpZihjdXIuYmFja2dyb3VuZEltYWdlICE9PSBwcmV2LmJhY2tncm91bmRJbWFnZSkgc3R5bGUuYmFja2dyb3VuZEltYWdlID0gYHVybCgnJHtjdXIuYmFja2dyb3VuZEltYWdlfScpYDtcbiAgICAgIGlmKGN1ci5ib3JkZXIgIT09IHByZXYuYm9yZGVyKSBzdHlsZS5ib3JkZXIgPSBjdXIuYm9yZGVyIHx8IFwibm9uZVwiO1xuICAgICAgaWYoY3VyLnRleHRBbGlnbiAhPT0gcHJldi50ZXh0QWxpZ24pIHtcbiAgICAgICAgc3R5bGUuYWxpZ25JdGVtcyA9IGN1ci50ZXh0QWxpZ247XG4gICAgICAgIGlmKGN1ci50ZXh0QWxpZ24gPT09IFwiY2VudGVyXCIpIHtcbiAgICAgICAgICBzdHlsZS50ZXh0QWxpZ24gPSBcImNlbnRlclwiO1xuICAgICAgICB9IGVsc2UgaWYoY3VyLnRleHRBbGlnbiA9PT0gXCJmbGV4LWVuZFwiKSB7XG4gICAgICAgICAgc3R5bGUudGV4dEFsaWduID0gXCJyaWdodFwiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHN0eWxlLnRleHRBbGlnbiA9IFwibGVmdFwiO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZihjdXIudmVydGljYWxBbGlnbiAhPT0gcHJldi52ZXJ0aWNhbEFsaWduKSBzdHlsZS5qdXN0aWZ5Q29udGVudCA9IGN1ci52ZXJ0aWNhbEFsaWduO1xuICAgICAgaWYoY3VyLmZvbnRGYW1pbHkgIT09IHByZXYuZm9udEZhbWlseSkgc3R5bGUuZm9udEZhbWlseSA9IGN1ci5mb250RmFtaWx5IHx8IFwiaW5oZXJpdFwiO1xuICAgICAgaWYoY3VyLnRyYW5zZm9ybSAhPT0gcHJldi50cmFuc2Zvcm0pIHN0eWxlLnRyYW5zZm9ybSA9IGN1ci50cmFuc2Zvcm0gfHwgXCJub25lXCI7XG4gICAgICBpZihjdXIuc3R5bGUgIT09IHByZXYuc3R5bGUpIGRpdi5zZXRBdHRyaWJ1dGUoXCJzdHlsZVwiLCBjdXIuc3R5bGUpO1xuXG4gICAgICBpZihjdXIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwgIT09IHByZXYuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwpIGRpdi5pbm5lckhUTUwgPSBjdXIuZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUw7XG5cbiAgICAgIC8vIGRlYnVnL3Byb2dyYW1tYXRpYyBwcm9wZXJ0aWVzXG4gICAgICBpZihjdXIuc2VtYW50aWMgIT09IHByZXYuc2VtYW50aWMpIGRpdi5zZXRBdHRyaWJ1dGUoXCJkYXRhLXNlbWFudGljXCIsIGN1ci5zZW1hbnRpYyk7XG4gICAgICBpZihjdXIuZGVidWcgIT09IHByZXYuZGVidWcpIGRpdi5zZXRBdHRyaWJ1dGUoXCJkYXRhLWRlYnVnXCIsIGN1ci5kZWJ1Zyk7XG5cbiAgICAgIC8vIFNWRyBwcm9wZXJ0aWVzXG4gICAgICBpZihjdXIuc3ZnKSB7XG4gICAgICAgIGlmKGN1ci5maWxsICE9PSBwcmV2LmZpbGwpIGRpdi5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcImZpbGxcIiwgY3VyLmZpbGwpO1xuICAgICAgICBpZihjdXIuc3Ryb2tlICE9PSBwcmV2LnN0cm9rZSkgZGl2LnNldEF0dHJpYnV0ZU5TKG51bGwsIFwic3Ryb2tlXCIsIGN1ci5zdHJva2UpO1xuICAgICAgICBpZihjdXIuc3Ryb2tlV2lkdGggIT09IHByZXYuc3Ryb2tlV2lkdGgpIGRpdi5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcInN0cm9rZS13aWR0aFwiLCBjdXIuc3Ryb2tlV2lkdGgpO1xuICAgICAgICBpZihjdXIuZCAhPT0gcHJldi5kKSBkaXYuc2V0QXR0cmlidXRlTlMobnVsbCwgXCJkXCIsIGN1ci5kKTtcbiAgICAgICAgaWYoY3VyLmMgIT09IHByZXYuYykgZGl2LnNldEF0dHJpYnV0ZU5TKG51bGwsIFwiY2xhc3NcIiwgY3VyLmMpO1xuICAgICAgICBpZihjdXIueCAhPT0gcHJldi54KSAgZGl2LnNldEF0dHJpYnV0ZU5TKG51bGwsIFwieFwiLCBjdXIueCk7XG4gICAgICAgIGlmKGN1ci55ICE9PSBwcmV2LnkpIGRpdi5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcInlcIiwgY3VyLnkpO1xuICAgICAgICBpZihjdXIuZHggIT09IHByZXYuZHgpICBkaXYuc2V0QXR0cmlidXRlTlMobnVsbCwgXCJkeFwiLCBjdXIuZHgpO1xuICAgICAgICBpZihjdXIuZHkgIT09IHByZXYuZHkpIGRpdi5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcImR5XCIsIGN1ci5keSk7XG4gICAgICAgIGlmKGN1ci5jeCAhPT0gcHJldi5jeCkgIGRpdi5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcImN4XCIsIGN1ci5jeCk7XG4gICAgICAgIGlmKGN1ci5jeSAhPT0gcHJldi5jeSkgZGl2LnNldEF0dHJpYnV0ZU5TKG51bGwsIFwiY3lcIiwgY3VyLmN5KTtcbiAgICAgICAgaWYoY3VyLnIgIT09IHByZXYucikgZGl2LnNldEF0dHJpYnV0ZU5TKG51bGwsIFwiclwiLCBjdXIucik7XG4gICAgICAgIGlmKGN1ci5oZWlnaHQgIT09IHByZXYuaGVpZ2h0KSBkaXYuc2V0QXR0cmlidXRlTlMobnVsbCwgXCJoZWlnaHRcIiwgY3VyLmhlaWdodCk7XG4gICAgICAgIGlmKGN1ci53aWR0aCAhPT0gcHJldi53aWR0aCkgIGRpdi5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcIndpZHRoXCIsIGN1ci53aWR0aCk7XG4gICAgICAgIGlmKGN1ci54bGlua2hyZWYgIT09IHByZXYueGxpbmtocmVmKSAgZGl2LnNldEF0dHJpYnV0ZU5TKCdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rJywgXCJocmVmXCIsIGN1ci54bGlua2hyZWYpO1xuICAgICAgICBpZihjdXIuc3RhcnRPZmZzZXQgIT09IHByZXYuc3RhcnRPZmZzZXQpIGRpdi5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcInN0YXJ0T2Zmc2V0XCIsIGN1ci5zdGFydE9mZnNldCk7XG4gICAgICAgIGlmKGN1ci5pZCAhPT0gcHJldi5pZCkgZGl2LnNldEF0dHJpYnV0ZU5TKG51bGwsIFwiaWRcIiwgY3VyLmlkKTtcbiAgICAgICAgaWYoY3VyLnZpZXdCb3ggIT09IHByZXYudmlld0JveCkgZGl2LnNldEF0dHJpYnV0ZU5TKG51bGwsIFwidmlld0JveFwiLCBjdXIudmlld0JveCk7XG4gICAgICAgIGlmKGN1ci50cmFuc2Zvcm0gIT09IHByZXYudHJhbnNmb3JtKSBkaXYuc2V0QXR0cmlidXRlTlMobnVsbCwgXCJ0cmFuc2Zvcm1cIiwgY3VyLnRyYW5zZm9ybSk7XG4gICAgICAgIGlmKGN1ci5kcmFnZ2FibGUgIT09IHByZXYuZHJhZ2dhYmxlKSBkaXYuc2V0QXR0cmlidXRlTlMobnVsbCwgXCJkcmFnZ2FibGVcIiwgY3VyLmRyYWdnYWJsZSk7XG4gICAgICAgIGlmKGN1ci50ZXh0QW5jaG9yICE9PSBwcmV2LnRleHRBbmNob3IpIGRpdi5zZXRBdHRyaWJ1dGVOUyhudWxsLCBcInRleHQtYW5jaG9yXCIsIGN1ci50ZXh0QW5jaG9yKTtcbiAgICAgIH1cblxuICAgICAgLy9ldmVudHNcbiAgICAgIGlmKGN1ci5kYmxjbGljayAhPT0gcHJldi5kYmxjbGljaykgZGl2Lm9uZGJsY2xpY2sgPSBjdXIuZGJsY2xpY2sgIT09IHVuZGVmaW5lZCA/IHRoaXMuaGFuZGxlRXZlbnQgOiB1bmRlZmluZWQ7XG4gICAgICBpZihjdXIuY2xpY2sgIT09IHByZXYuY2xpY2spIGRpdi5vbmNsaWNrID0gY3VyLmNsaWNrICE9PSB1bmRlZmluZWQgPyB0aGlzLmhhbmRsZUV2ZW50IDogdW5kZWZpbmVkO1xuICAgICAgaWYoY3VyLmNvbnRleHRtZW51ICE9PSBwcmV2LmNvbnRleHRtZW51KSBkaXYub25jb250ZXh0bWVudSA9IGN1ci5jb250ZXh0bWVudSAhPT0gdW5kZWZpbmVkID8gdGhpcy5oYW5kbGVFdmVudCA6IHVuZGVmaW5lZDtcbiAgICAgIGlmKGN1ci5tb3VzZWRvd24gIT09IHByZXYubW91c2Vkb3duKSBkaXYub25tb3VzZWRvd24gPSBjdXIubW91c2Vkb3duICE9PSB1bmRlZmluZWQgPyB0aGlzLmhhbmRsZUV2ZW50IDogdW5kZWZpbmVkO1xuICAgICAgaWYoY3VyLm1vdXNlbW92ZSAhPT0gcHJldi5tb3VzZW1vdmUpIGRpdi5vbm1vdXNlbW92ZSA9IGN1ci5tb3VzZW1vdmUgIT09IHVuZGVmaW5lZCA/IHRoaXMuaGFuZGxlRXZlbnQgOiB1bmRlZmluZWQ7XG4gICAgICBpZihjdXIubW91c2V1cCAhPT0gcHJldi5tb3VzZXVwKSBkaXYub25tb3VzZXVwID0gY3VyLm1vdXNldXAgIT09IHVuZGVmaW5lZCA/IHRoaXMuaGFuZGxlRXZlbnQgOiB1bmRlZmluZWQ7XG4gICAgICBpZihjdXIubW91c2VvdmVyICE9PSBwcmV2Lm1vdXNlb3ZlcikgZGl2Lm9ubW91c2VvdmVyID0gY3VyLm1vdXNlb3ZlciAhPT0gdW5kZWZpbmVkID8gdGhpcy5oYW5kbGVFdmVudCA6IHVuZGVmaW5lZDtcbiAgICAgIGlmKGN1ci5tb3VzZW91dCAhPT0gcHJldi5tb3VzZW91dCkgZGl2Lm9ubW91c2VvdXQgPSBjdXIubW91c2VvdXQgIT09IHVuZGVmaW5lZCA/IHRoaXMuaGFuZGxlRXZlbnQgOiB1bmRlZmluZWQ7XG4gICAgICBpZihjdXIubW91c2VsZWF2ZSAhPT0gcHJldi5tb3VzZWxlYXZlKSBkaXYub25tb3VzZWxlYXZlID0gY3VyLm1vdXNlbGVhdmUgIT09IHVuZGVmaW5lZCA/IHRoaXMuaGFuZGxlRXZlbnQgOiB1bmRlZmluZWQ7XG4gICAgICBpZihjdXIubW91c2V3aGVlbCAhPT0gcHJldi5tb3VzZXdoZWVsKSBkaXYub25tb3VzZWhlZWwgPSBjdXIubW91c2V3aGVlbCAhPT0gdW5kZWZpbmVkID8gdGhpcy5oYW5kbGVFdmVudCA6IHVuZGVmaW5lZDtcbiAgICAgIGlmKGN1ci5kcmFnb3ZlciAhPT0gcHJldi5kcmFnb3ZlcikgZGl2Lm9uZHJhZ292ZXIgPSBjdXIuZHJhZ292ZXIgIT09IHVuZGVmaW5lZCA/IHRoaXMuaGFuZGxlRXZlbnQgOiB1bmRlZmluZWQ7XG4gICAgICBpZihjdXIuZHJhZ3N0YXJ0ICE9PSBwcmV2LmRyYWdzdGFydCkgZGl2Lm9uZHJhZ3N0YXJ0ID0gY3VyLmRyYWdzdGFydCAhPT0gdW5kZWZpbmVkID8gdGhpcy5oYW5kbGVFdmVudCA6IHVuZGVmaW5lZDtcbiAgICAgIGlmKGN1ci5kcmFnZW5kICE9PSBwcmV2LmRyYWdlbmQpIGRpdi5vbmRyYWdlbmQgPSBjdXIuZHJhZ2VuZCAhPT0gdW5kZWZpbmVkID8gdGhpcy5oYW5kbGVFdmVudCA6IHVuZGVmaW5lZDtcbiAgICAgIGlmKGN1ci5kcmFnICE9PSBwcmV2LmRyYWcpIGRpdi5vbmRyYWcgPSBjdXIuZHJhZyAhPT0gdW5kZWZpbmVkID8gdGhpcy5oYW5kbGVFdmVudCA6IHVuZGVmaW5lZDtcbiAgICAgIGlmKGN1ci5kcm9wICE9PSBwcmV2LmRyb3ApIGRpdi5vbmRyb3AgPSBjdXIuZHJvcCAhPT0gdW5kZWZpbmVkID8gdGhpcy5oYW5kbGVFdmVudCA6IHVuZGVmaW5lZDtcbiAgICAgIGlmKGN1ci5zY3JvbGwgIT09IHByZXYuc2Nyb2xsKSBkaXYub25zY3JvbGwgPSBjdXIuc2Nyb2xsICE9PSB1bmRlZmluZWQgPyB0aGlzLmhhbmRsZUV2ZW50IDogdW5kZWZpbmVkO1xuICAgICAgaWYoY3VyLmZvY3VzICE9PSBwcmV2LmZvY3VzKSBkaXYub25mb2N1cyA9IGN1ci5mb2N1cyAhPT0gdW5kZWZpbmVkID8gdGhpcy5oYW5kbGVFdmVudCA6IHVuZGVmaW5lZDtcbiAgICAgIGlmKGN1ci5ibHVyICE9PSBwcmV2LmJsdXIpIGRpdi5vbmJsdXIgPSBjdXIuYmx1ciAhPT0gdW5kZWZpbmVkID8gdGhpcy5oYW5kbGVFdmVudCA6IHVuZGVmaW5lZDtcbiAgICAgIGlmKGN1ci5pbnB1dCAhPT0gcHJldi5pbnB1dCkgZGl2Lm9uaW5wdXQgPSBjdXIuaW5wdXQgIT09IHVuZGVmaW5lZCA/IHRoaXMuaGFuZGxlRXZlbnQgOiB1bmRlZmluZWQ7XG4gICAgICBpZihjdXIuY2hhbmdlICE9PSBwcmV2LmNoYW5nZSkgZGl2Lm9uY2hhbmdlID0gY3VyLmNoYW5nZSAhPT0gdW5kZWZpbmVkID8gdGhpcy5oYW5kbGVFdmVudCA6IHVuZGVmaW5lZDtcbiAgICAgIGlmKGN1ci5rZXl1cCAhPT0gcHJldi5rZXl1cCkgZGl2Lm9ua2V5dXAgPSBjdXIua2V5dXAgIT09IHVuZGVmaW5lZCA/IHRoaXMuaGFuZGxlRXZlbnQgOiB1bmRlZmluZWQ7XG4gICAgICBpZihjdXIua2V5ZG93biAhPT0gcHJldi5rZXlkb3duKSBkaXYub25rZXlkb3duID0gY3VyLmtleWRvd24gIT09IHVuZGVmaW5lZCA/IHRoaXMuaGFuZGxlRXZlbnQgOiB1bmRlZmluZWQ7XG5cbiAgICAgIGlmKHR5cGUgPT09IFwiYWRkZWRcIiB8fCB0eXBlID09PSBcInJlcGxhY2VkXCIgfHwgdHlwZSA9PT0gXCJtb3ZlZFwiKSB7XG4gICAgICAgIHZhciBwYXJlbnRFbCA9IGVsZW1lbnRDYWNoZVtjdXIucGFyZW50XTtcbiAgICAgICAgaWYocGFyZW50RWwpIHtcbiAgICAgICAgICBpZihjdXIuaXggPj0gcGFyZW50RWwuY2hpbGRyZW4ubGVuZ3RoKSB7XG4gICAgICAgICAgICBwYXJlbnRFbC5hcHBlbmRDaGlsZChkaXYpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBwYXJlbnRFbC5pbnNlcnRCZWZvcmUoZGl2LCBwYXJlbnRFbC5jaGlsZHJlbltjdXIuaXhdKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBkaWZmKCkge1xuICAgIHZhciBhID0gdGhpcy5wcmV2VHJlZTtcbiAgICB2YXIgYiA9IHRoaXMudHJlZTtcbiAgICB2YXIgYXMgPSBPYmplY3Qua2V5cyhhKTtcbiAgICB2YXIgYnMgPSBPYmplY3Qua2V5cyhiKTtcbiAgICB2YXIgdXBkYXRlZCA9IHt9O1xuICAgIHZhciBhZGRzID0gW107XG4gICAgZm9yKHZhciBpID0gMCwgbGVuID0gYXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIHZhciBpZCA9IGFzW2ldO1xuICAgICAgdmFyIGN1ckEgPSBhW2lkXTtcbiAgICAgIHZhciBjdXJCID0gYltpZF07XG4gICAgICBpZihjdXJCID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdXBkYXRlZFtpZF0gPSBcInJlbW92ZWRcIjtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZihjdXJBLnQgIT09IGN1ckIudCkge1xuICAgICAgICB1cGRhdGVkW2lkXSA9IFwicmVwbGFjZWRcIjtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZihjdXJBLml4ICE9PSBjdXJCLml4IHx8IGN1ckEucGFyZW50ICE9PSBjdXJCLnBhcmVudCkge1xuICAgICAgICB1cGRhdGVkW2lkXSA9IFwibW92ZWRcIjtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGlmKCFjdXJCLmRpcnR5XG4gICAgICAgICAgJiYgY3VyQS5jID09PSBjdXJCLmNcbiAgICAgICAgICAmJiBjdXJBLmtleSA9PT0gY3VyQi5rZXlcbiAgICAgICAgICAmJiBjdXJBLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MID09PSBjdXJCLmRhbmdlcm91c2x5U2V0SW5uZXJIVE1MXG4gICAgICAgICAgJiYgY3VyQS50YWJpbmRleCA9PT0gY3VyQi50YWJpbmRleFxuICAgICAgICAgICYmIGN1ckEuaHJlZiA9PT0gY3VyQi5ocmVmXG4gICAgICAgICAgJiYgY3VyQS5zcmMgPT09IGN1ckIuc3JjXG4gICAgICAgICAgJiYgY3VyQS5kYXRhID09PSBjdXJCLmRhdGFcbiAgICAgICAgICAmJiBjdXJBLmRvd25sb2FkID09PSBjdXJCLmRvd25sb2FkXG4gICAgICAgICAgJiYgY3VyQS5hbGxvd2Z1bGxzY3JlZW4gPT09IGN1ckIuYWxsb3dmdWxsc2NyZWVuXG4gICAgICAgICAgJiYgY3VyQS5wbGFjZWhvbGRlciA9PT0gY3VyQi5wbGFjZWhvbGRlclxuICAgICAgICAgICYmIGN1ckEuc2VsZWN0ZWQgPT09IGN1ckIuc2VsZWN0ZWRcbiAgICAgICAgICAmJiBjdXJBLmRyYWdnYWJsZSA9PT0gY3VyQi5kcmFnZ2FibGVcbiAgICAgICAgICAmJiBjdXJBLmNvbnRlbnRFZGl0YWJsZSA9PT0gY3VyQi5jb250ZW50RWRpdGFibGVcbiAgICAgICAgICAmJiBjdXJBLnZhbHVlID09PSBjdXJCLnZhbHVlXG4gICAgICAgICAgJiYgY3VyQS50eXBlID09PSBjdXJCLnR5cGVcbiAgICAgICAgICAmJiBjdXJBLmNoZWNrZWQgPT09IGN1ckIuY2hlY2tlZFxuICAgICAgICAgICYmIGN1ckEudGV4dCA9PT0gY3VyQi50ZXh0XG4gICAgICAgICAgJiYgY3VyQS50b3AgPT09IGN1ckIudG9wXG4gICAgICAgICAgJiYgY3VyQS5mbGV4ID09PSBjdXJCLmZsZXhcbiAgICAgICAgICAmJiBjdXJBLmxlZnQgPT09IGN1ckIubGVmdFxuICAgICAgICAgICYmIGN1ckEud2lkdGggPT09IGN1ckIud2lkdGhcbiAgICAgICAgICAmJiBjdXJBLmhlaWdodCA9PT0gY3VyQi5oZWlnaHRcbiAgICAgICAgICAmJiBjdXJBLnpJbmRleCA9PT0gY3VyQi56SW5kZXhcbiAgICAgICAgICAmJiBjdXJBLmJhY2tncm91bmRDb2xvciA9PT0gY3VyQi5iYWNrZ3JvdW5kQ29sb3JcbiAgICAgICAgICAmJiBjdXJBLmJhY2tncm91bmRJbWFnZSA9PT0gY3VyQi5iYWNrZ3JvdW5kSW1hZ2VcbiAgICAgICAgICAmJiBjdXJBLmNvbG9yID09PSBjdXJCLmNvbG9yXG4gICAgICAgICAgJiYgY3VyQS5jb2xzcGFuID09PSBjdXJCLmNvbHNwYW5cbiAgICAgICAgICAmJiBjdXJBLmJvcmRlciA9PT0gY3VyQi5ib3JkZXJcbiAgICAgICAgICAmJiBjdXJBLmJvcmRlckNvbG9yID09PSBjdXJCLmJvcmRlckNvbG9yXG4gICAgICAgICAgJiYgY3VyQS5ib3JkZXJXaWR0aCA9PT0gY3VyQi5ib3JkZXJXaWR0aFxuICAgICAgICAgICYmIGN1ckEuYm9yZGVyUmFkaXVzID09PSBjdXJCLmJvcmRlclJhZGl1c1xuICAgICAgICAgICYmIGN1ckEub3BhY2l0eSA9PT0gY3VyQi5vcGFjaXR5XG4gICAgICAgICAgJiYgY3VyQS5mb250RmFtaWx5ID09PSBjdXJCLmZvbnRGYW1pbHlcbiAgICAgICAgICAmJiBjdXJBLmZvbnRTaXplID09PSBjdXJCLmZvbnRTaXplXG4gICAgICAgICAgJiYgY3VyQS50ZXh0QWxpZ24gPT09IGN1ckIudGV4dEFsaWduXG4gICAgICAgICAgJiYgY3VyQS50cmFuc2Zvcm0gPT09IGN1ckIudHJhbnNmb3JtXG4gICAgICAgICAgJiYgY3VyQS52ZXJ0aWNhbEFsaWduID09PSBjdXJCLnZlcnRpY2FsQWxpZ25cbiAgICAgICAgICAmJiBjdXJBLnNlbWFudGljID09PSBjdXJCLnNlbWFudGljXG4gICAgICAgICAgJiYgY3VyQS5kZWJ1ZyA9PT0gY3VyQi5kZWJ1Z1xuICAgICAgICAgICYmIGN1ckEuc3R5bGUgPT09IGN1ckIuc3R5bGVcbiAgICAgICAgICAmJiAoY3VyQi5zdmcgPT09IHVuZGVmaW5lZCB8fCAoXG4gICAgICAgICAgICAgIGN1ckEueCA9PT0gY3VyQi54XG4gICAgICAgICAgICAgICYmIGN1ckEueSA9PT0gY3VyQi55XG4gICAgICAgICAgICAgICYmIGN1ckEuZHggPT09IGN1ckIuZHhcbiAgICAgICAgICAgICAgJiYgY3VyQS5keSA9PT0gY3VyQi5keVxuICAgICAgICAgICAgICAmJiBjdXJBLmN4ID09PSBjdXJCLmN4XG4gICAgICAgICAgICAgICYmIGN1ckEuY3kgPT09IGN1ckIuY3lcbiAgICAgICAgICAgICAgJiYgY3VyQS5yID09PSBjdXJCLnJcbiAgICAgICAgICAgICAgJiYgY3VyQS5kID09PSBjdXJCLmRcbiAgICAgICAgICAgICAgJiYgY3VyQS5maWxsID09PSBjdXJCLmZpbGxcbiAgICAgICAgICAgICAgJiYgY3VyQS5zdHJva2UgPT09IGN1ckIuc3Ryb2tlXG4gICAgICAgICAgICAgICYmIGN1ckEuc3Ryb2tlV2lkdGggPT09IGN1ckIuc3Ryb2tlV2lkdGhcbiAgICAgICAgICAgICAgJiYgY3VyQS5zdGFydE9mZnNldCA9PT0gY3VyQi5zdGFydE9mZnNldFxuICAgICAgICAgICAgICAmJiBjdXJBLnRleHRBbmNob3IgPT09IGN1ckIudGV4dEFuY2hvclxuICAgICAgICAgICAgICAmJiBjdXJBLnZpZXdCb3ggPT09IGN1ckIudmlld0JveFxuICAgICAgICAgICAgICAmJiBjdXJBLnhsaW5raHJlZiA9PT0gY3VyQi54bGlua2hyZWYpKVxuICAgICAgICAgICAgICApIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICB1cGRhdGVkW2lkXSA9IFwidXBkYXRlZFwiO1xuICAgIH1cbiAgICBmb3IodmFyIGkgPSAwLCBsZW4gPSBicy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgdmFyIGlkID0gYnNbaV07XG4gICAgICB2YXIgY3VyQSA9IGFbaWRdO1xuICAgICAgaWYoY3VyQSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGFkZHMucHVzaChpZCk7XG4gICAgICAgIHVwZGF0ZWRbaWRdID0gXCJhZGRlZFwiO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5sYXN0RGlmZiA9IHthZGRzOiBhZGRzLCB1cGRhdGVzOiB1cGRhdGVkfTtcbiAgICByZXR1cm4gdGhpcy5sYXN0RGlmZjtcbiAgfVxuXG4gIHByZXBhcmUocm9vdDpFbGVtZW50KSB7XG4gICAgdmFyIGVsZW1MZW4gPSAxO1xuICAgIHZhciB0cmVlID0gdGhpcy50cmVlO1xuICAgIHZhciBlbGVtZW50cyA9IFtyb290XTtcbiAgICB2YXIgZWxlbTpFbGVtZW50O1xuICAgIGZvcih2YXIgZWxlbUl4ID0gMDsgZWxlbUl4IDwgZWxlbUxlbjsgZWxlbUl4KyspIHtcbiAgICAgIGVsZW0gPSBlbGVtZW50c1tlbGVtSXhdO1xuICAgICAgaWYoZWxlbS5wYXJlbnQgPT09IHVuZGVmaW5lZCkgZWxlbS5wYXJlbnQgPSBcIl9fcm9vdFwiO1xuICAgICAgaWYoZWxlbS5pZCA9PT0gdW5kZWZpbmVkKSBlbGVtLmlkID0gXCJfX3Jvb3RfX1wiICsgZWxlbUl4O1xuICAgICAgdHJlZVtlbGVtLmlkXSA9IGVsZW07XG4gICAgICBpZihlbGVtLnBvc3RSZW5kZXIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aGlzLnBvc3RSZW5kZXJzLnB1c2goZWxlbSk7XG4gICAgICB9XG4gICAgICB2YXIgY2hpbGRyZW4gPSBlbGVtLmNoaWxkcmVuO1xuICAgICAgaWYoY2hpbGRyZW4gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBmb3IodmFyIGNoaWxkSXggPSAwLCBsZW4gPSBjaGlsZHJlbi5sZW5ndGg7IGNoaWxkSXggPCBsZW47IGNoaWxkSXgrKykge1xuICAgICAgICAgIHZhciBjaGlsZCA9IGNoaWxkcmVuW2NoaWxkSXhdO1xuICAgICAgICAgIGlmKGNoaWxkID09PSB1bmRlZmluZWQpIGNvbnRpbnVlO1xuICAgICAgICAgIGlmKGNoaWxkLmlkID09PSB1bmRlZmluZWQpIHsgY2hpbGQuaWQgPSBlbGVtLmlkICsgXCJfX1wiICsgY2hpbGRJeDsgfVxuICAgICAgICAgIGlmKGNoaWxkLml4ID09PSB1bmRlZmluZWQpIHsgY2hpbGQuaXggPSBjaGlsZEl4OyB9XG4gICAgICAgICAgaWYoY2hpbGQucGFyZW50ID09PSB1bmRlZmluZWQpIHsgY2hpbGQucGFyZW50ID0gZWxlbS5pZDsgfVxuICAgICAgICAgIGVsZW1lbnRzLnB1c2goY2hpbGQpO1xuICAgICAgICAgIGVsZW1MZW4rKztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJlZTtcbiAgfVxuXG4gIHBvc3REb21pZnkoKSB7XG4gICAgdmFyIHBvc3RSZW5kZXJzID0gdGhpcy5wb3N0UmVuZGVycztcbiAgICB2YXIgZGlmZiA9IHRoaXMubGFzdERpZmYudXBkYXRlcztcbiAgICB2YXIgZWxlbWVudENhY2hlID0gdGhpcy5lbGVtZW50Q2FjaGU7XG4gICAgZm9yKHZhciBpID0gMCwgbGVuID0gcG9zdFJlbmRlcnMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgIHZhciBlbGVtID0gcG9zdFJlbmRlcnNbaV07XG4gICAgICB2YXIgaWQgPSBlbGVtLmlkO1xuICAgICAgaWYoZGlmZltpZF0gPT09IFwidXBkYXRlZFwiIHx8IGRpZmZbaWRdID09PSBcImFkZGVkXCIgfHwgZGlmZltpZF0gPT09IFwicmVwbGFjZWRcIiB8fCBlbGVtLmRpcnR5IHx8IGRpZmZbaWRdID09PSBcIm1vdmVkXCIpIHtcbiAgICAgICAgZWxlbS5wb3N0UmVuZGVyKGVsZW1lbnRDYWNoZVtlbGVtLmlkXSwgZWxlbSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmVuZGVyKGVsZW1zOkVsZW1lbnRbXSkge1xuICAgICAgdGhpcy5yZXNldCgpO1xuICAgIC8vIFdlIHNvcnQgZWxlbWVudHMgYnkgZGVwdGggdG8gYWxsb3cgdGhlbSB0byBiZSBzZWxmIHJlZmVyZW50aWFsLlxuICAgIGVsZW1zLnNvcnQoKGEsIGIpID0+IChhLnBhcmVudCA/IGEucGFyZW50LnNwbGl0KFwiX19cIikubGVuZ3RoIDogMCkgLSAoYi5wYXJlbnQgPyBiLnBhcmVudC5zcGxpdChcIl9fXCIpLmxlbmd0aCA6IDApKTtcbiAgICBsZXQgc3RhcnQgPSBub3coKTtcbiAgICBmb3IobGV0IGVsZW0gb2YgZWxlbXMpIHtcbiAgICAgIGxldCBwb3N0ID0gdGhpcy5wcmVwYXJlKGVsZW0pO1xuXG4gICAgfVxuICAgIGxldCBwcmVwYXJlID0gbm93KCk7XG4gICAgbGV0IGQgPSB0aGlzLmRpZmYoKTtcbiAgICBsZXQgZGlmZiA9IG5vdygpO1xuICAgIHRoaXMuZG9taWZ5KCk7XG4gICAgbGV0IGRvbWlmeSA9IG5vdygpO1xuICAgIHRoaXMucG9zdERvbWlmeSgpO1xuICAgIGxldCBwb3N0RG9taWZ5ID0gbm93KCk7XG4gICAgbGV0IHRpbWUgPSBub3coKSAtIHN0YXJ0O1xuICAgIGlmKHRpbWUgPiA1KSB7XG4gICAgICBjb25zb2xlLmxvZyhcInNsb3cgcmVuZGVyICg+IDVtcyk6IFwiLCB0aW1lLCB7XG4gICAgICAgIHByZXBhcmU6IHByZXBhcmUgLSBzdGFydCxcbiAgICAgICAgZGlmZjogZGlmZiAtIHByZXBhcmUsXG4gICAgICAgIGRvbWlmeTogZG9taWZ5IC0gZGlmZixcbiAgICAgICAgcG9zdERvbWlmeTogcG9zdERvbWlmeSAtIGRvbWlmeVxuICAgICAgfSk7XG4gICAgfVxuICB9XG59XG4iLCJpbXBvcnQge0VOViwgREVCVUcsIHV1aWQsIHVucGFkLCB1bmRlcmxpbmUsIGNvZXJjZUlucHV0fSBmcm9tIFwiLi91dGlsc1wiXG5pbXBvcnQgKiBhcyBydW50aW1lIGZyb20gXCIuL3J1bnRpbWVcIlxuaW1wb3J0IHtldmV9IGZyb20gXCIuL2FwcFwiXG5pbXBvcnQge3JlcGVhdH0gZnJvbSBcIi4vdXRpbHNcIlxuXG5jbGFzcyBQYXJzZUVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICBuYW1lOiBzdHJpbmcgPSBcIlBhcnNlIEVycm9yXCI7XG5cbiAgY29uc3RydWN0b3IocHVibGljIG1lc3NhZ2U6c3RyaW5nLCBwdWJsaWMgbGluZTpzdHJpbmcsIHB1YmxpYyBsaW5lSXg/Om51bWJlciwgcHVibGljIGNoYXJJeDpudW1iZXIgPSAwLCBwdWJsaWMgbGVuZ3RoOm51bWJlciA9IGxpbmUgJiYgKGxpbmUubGVuZ3RoIC0gY2hhckl4KSkge1xuICAgIHN1cGVyKG1lc3NhZ2UpO1xuICB9XG4gIHRvU3RyaW5nKCkge1xuICAgIHJldHVybiB1bnBhZCg2KSBgXG4gICAgICAke3RoaXMubmFtZX06ICR7dGhpcy5tZXNzYWdlfVxuICAgICAgJHt0aGlzLmxpbmVJeCAhPT0gdW5kZWZpbmVkID8gYE9uIGxpbmUgJHt0aGlzLmxpbmVJeCArIDF9OiR7dGhpcy5jaGFySXh9YCA6IFwiXCJ9XG4gICAgICAke3RoaXMubGluZX1cbiAgICAgICR7dW5kZXJsaW5lKHRoaXMuY2hhckl4LCB0aGlzLmxlbmd0aCl9XG4gICAgYDtcbiAgfVxufVxuXG5mdW5jdGlvbiByZWFkV2hpbGUoc3RyOnN0cmluZywgcGF0dGVybjpSZWdFeHAsIHN0YXJ0SXg6bnVtYmVyKTpzdHJpbmcge1xuICBsZXQgZW5kSXggPSBzdGFydEl4O1xuICB3aGlsZShzdHJbZW5kSXhdICE9PSB1bmRlZmluZWQgJiYgc3RyW2VuZEl4XS5tYXRjaChwYXR0ZXJuKSkgZW5kSXgrKztcbiAgcmV0dXJuIHN0ci5zbGljZShzdGFydEl4LCBlbmRJeCk7XG59XG5cbmZ1bmN0aW9uIHJlYWRVbnRpbChzdHI6c3RyaW5nLCBzZW50aW5lbDpzdHJpbmcsIHN0YXJ0SXg6bnVtYmVyKTpzdHJpbmc7XG5mdW5jdGlvbiByZWFkVW50aWwoc3RyOnN0cmluZywgc2VudGluZWw6c3RyaW5nLCBzdGFydEl4Om51bWJlciwgdW5zYXRpc2ZpZWRFcnI6IEVycm9yKTpzdHJpbmd8RXJyb3I7XG5mdW5jdGlvbiByZWFkVW50aWwoc3RyOnN0cmluZywgc2VudGluZWw6c3RyaW5nLCBzdGFydEl4Om51bWJlciwgdW5zYXRpc2ZpZWRFcnI/OiBFcnJvcik6YW55IHtcbiAgbGV0IGVuZEl4ID0gc3RyLmluZGV4T2Yoc2VudGluZWwsIHN0YXJ0SXgpO1xuICBpZihlbmRJeCA9PT0gLTEpIHtcbiAgICBpZih1bnNhdGlzZmllZEVycikgcmV0dXJuIHVuc2F0aXNmaWVkRXJyO1xuICAgIHJldHVybiBzdHIuc2xpY2Uoc3RhcnRJeCk7XG4gIH1cbiAgcmV0dXJuIHN0ci5zbGljZShzdGFydEl4LCBlbmRJeCk7XG59XG5cbmZ1bmN0aW9uIHJlYWRVbnRpbEFueShzdHI6c3RyaW5nLCBzZW50aW5lbHM6c3RyaW5nW10sIHN0YXJ0SXg6bnVtYmVyKTpzdHJpbmc7XG5mdW5jdGlvbiByZWFkVW50aWxBbnkoc3RyOnN0cmluZywgc2VudGluZWxzOnN0cmluZ1tdLCBzdGFydEl4Om51bWJlciwgdW5zYXRpc2ZpZWRFcnI6IEVycm9yKTpzdHJpbmd8RXJyb3I7XG5mdW5jdGlvbiByZWFkVW50aWxBbnkoc3RyOnN0cmluZywgc2VudGluZWxzOnN0cmluZ1tdLCBzdGFydEl4Om51bWJlciwgdW5zYXRpc2ZpZWRFcnI/OiBFcnJvcik6YW55IHtcbiAgbGV0IGVuZEl4ID0gLTE7XG4gIGZvcihsZXQgc2VudGluZWwgb2Ygc2VudGluZWxzKSB7XG4gICAgbGV0IGl4ID0gc3RyLmluZGV4T2Yoc2VudGluZWwsIHN0YXJ0SXgpO1xuICAgIGlmKGl4ID09PSAtMSB8fCBlbmRJeCAhPT0gLTEgJiYgaXggPiBlbmRJeCkgY29udGludWU7XG4gICAgZW5kSXggPSBpeDtcbiAgfVxuICBpZihlbmRJeCA9PT0gLTEpIHtcbiAgICBpZih1bnNhdGlzZmllZEVycikgcmV0dXJuIHVuc2F0aXNmaWVkRXJyO1xuICAgIHJldHVybiBzdHIuc2xpY2Uoc3RhcnRJeCk7XG4gIH1cbiAgcmV0dXJuIHN0ci5zbGljZShzdGFydEl4LCBlbmRJeCk7XG59XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIFVJIERTTCBQYXJzZXJcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmV4cG9ydCBpbnRlcmZhY2UgVUlFbGVtIHtcbiAgaWQ/OiBzdHJpbmdcbiAgY2hpbGRyZW4/OiBVSUVsZW1bXVxuICBlbWJlZGRlZD86IHt9IC8vIFVuZGVmaW5lZCBvciB0aGUgcmVzdHJpY3RlZCBzY29wZSBvZiB0aGUgZW1iZWRkZWQgY2hpbGQuXG4gIGJpbmRpbmc/OiBzdHJpbmdcbiAgYmluZGluZ0tpbmQ/OiBzdHJpbmdcbiAgYXR0cmlidXRlcz86IHt9XG4gIGV2ZW50cz86IHtbZXZlbnQ6c3RyaW5nXToge319XG59XG5cbi8vIGV4cG9ydCBmdW5jdGlvbiBwYXJzZVVJKHN0cjpzdHJpbmcpOlVJRWxlbSB7XG4vLyAgIGxldCByb290OlVJRWxlbSA9IHt9O1xuLy8gICBsZXQgZXJyb3JzID0gW107XG4vLyAgIGxldCBsaW5lSXggPSAwO1xuLy8gICBsZXQgbGluZXMgPSBzdHIuc3BsaXQoXCJcXG5cIik7XG4vLyAgIGxldCBzdGFjazp7aW5kZW50OiBudW1iZXIsIGVsZW06IFVJRWxlbX1bXSA9IFt7aW5kZW50OiAtMiwgZWxlbTogcm9vdH1dO1xuLy8gICAvLyBARklYTUU6IENodW5rIGludG8gZWxlbWVudCBjaHVua3MgaW5zdGVhZCBvZiBsaW5lcyB0byBlbmFibGUgaW4tYXJndW1lbnQgY29udGludWF0aW9uLlxuLy8gICBmb3IobGV0IGxpbmUgb2YgbGluZXMpIHtcbi8vICAgICBsZXQgY2hhckl4ID0gMDtcbi8vICAgICB3aGlsZShsaW5lW2NoYXJJeF0gPT09IFwiIFwiKSBjaGFySXgrKztcbi8vICAgICBsZXQgaW5kZW50ID0gY2hhckl4O1xuLy8gICAgIGlmKGxpbmVbY2hhckl4XSA9PT0gdW5kZWZpbmVkKSAgY29udGludWU7XG4vLyAgICAgbGV0IHBhcmVudDpVSUVsZW07XG4vLyAgICAgZm9yKGxldCBzdGFja0l4ID0gc3RhY2subGVuZ3RoIC0gMTsgc3RhY2tJeCA+PSAwOyBzdGFja0l4LS0pIHtcbi8vICAgICAgIGlmKGluZGVudCA+IHN0YWNrW3N0YWNrSXhdLmluZGVudCkge1xuLy8gICAgICAgICBwYXJlbnQgPSBzdGFja1tzdGFja0l4XS5lbGVtO1xuLy8gICAgICAgICBicmVhaztcbi8vICAgICAgIH0gZWxzZSBzdGFjay5wb3AoKTtcbi8vICAgICB9XG4vLyAgICAgbGV0IGtleXdvcmQgPSByZWFkVW50aWwobGluZSwgXCIgXCIsIGNoYXJJeCk7XG4vLyAgICAgY2hhckl4ICs9IGtleXdvcmQubGVuZ3RoO1xuXG4vLyAgICAgaWYoa2V5d29yZFswXSA9PT0gXCJ+XCIgfHwga2V5d29yZFswXSA9PT0gXCIlXCIpIHsgLy8gSGFuZGxlIGJpbmRpbmdcbi8vICAgICAgIGNoYXJJeCAtPSBrZXl3b3JkLmxlbmd0aCAtIDE7XG4vLyAgICAgICBsZXQga2luZCA9IGtleXdvcmRbMF0gPT09IFwiflwiID8gXCJwbGFuXCIgOiBcInF1ZXJ5XCI7XG4vLyAgICAgICBpZighcGFyZW50LmJpbmRpbmcpIHtcbi8vICAgICAgICAgcGFyZW50LmJpbmRpbmcgPSBsaW5lLnNsaWNlKGNoYXJJeCk7XG4vLyAgICAgICAgIHBhcmVudC5iaW5kaW5nS2luZCA9IGtpbmQ7XG4vLyAgICAgICB9IGVsc2UgaWYoa2luZCA9PT0gcGFyZW50LmJpbmRpbmdLaW5kKSBwYXJlbnQuYmluZGluZyArPSBcIlxcblwiICsgbGluZS5zbGljZShjaGFySXgpO1xuLy8gICAgICAgZWxzZSB7XG4vLyAgICAgICAgIGVycm9ycy5wdXNoKG5ldyBQYXJzZUVycm9yKGBVSSBtdXN0IGJlIGJvdW5kIHRvIGEgc2luZ2xlIHR5cGUgb2YgcXVlcnkuYCwgbGluZSwgbGluZUl4KSk7XG4vLyAgICAgICAgIGNvbnRpbnVlO1xuLy8gICAgICAgfVxuLy8gICAgICAgY2hhckl4ID0gbGluZS5sZW5ndGg7XG5cbi8vICAgICB9IGVsc2UgaWYoa2V5d29yZFswXSA9PT0gXCJAXCIpIHsgLy8gSGFuZGxlIGV2ZW50XG4vLyAgICAgICBjaGFySXggLT0ga2V5d29yZC5sZW5ndGggLSAxO1xuLy8gICAgICAgbGV0IGVycjtcbi8vICAgICAgIHdoaWxlKGxpbmVbY2hhckl4XSA9PT0gXCIgXCIpIGNoYXJJeCsrO1xuLy8gICAgICAgbGV0IGxhc3RJeCA9IGNoYXJJeDtcbi8vICAgICAgIGxldCBldmVudFJhdyA9IHJlYWRVbnRpbChsaW5lLCBcIntcIiwgY2hhckl4KTtcbi8vICAgICAgIGNoYXJJeCArPSBldmVudFJhdy5sZW5ndGg7XG4vLyAgICAgICBsZXQgZXZlbnQgPSBldmVudFJhdy50cmltKCk7XG5cbi8vICAgICAgIGlmKCFldmVudCkgZXJyID0gbmV3IFBhcnNlRXJyb3IoYFVJIGV2ZW50IG11c3Qgc3BlY2lmeSBhIHZhbGlkIGV2ZW50IG5hbWVgLCBsaW5lLCBsaW5lSXgsIGxhc3RJeCwgZXZlbnRSYXcubGVuZ3RoKTtcbi8vICAgICAgIGxldCBzdGF0ZTtcbi8vICAgICAgIFtzdGF0ZSwgY2hhckl4XSA9IGdldE1hcEFyZ3MobGluZSwgbGluZUl4LCBjaGFySXgpO1xuLy8gICAgICAgaWYoc3RhdGUgaW5zdGFuY2VvZiBFcnJvciAmJiAhZXJyKSBlcnIgPSBzdGF0ZTtcbi8vICAgICAgIGlmKGVycikge1xuLy8gICAgICAgICBlcnJvcnMucHVzaChlcnIpO1xuLy8gICAgICAgICBsaW5lSXgrKztcbi8vICAgICAgICAgY29udGludWU7XG4vLyAgICAgICB9XG5cbi8vICAgICAgIGlmKCFwYXJlbnQuZXZlbnRzKSBwYXJlbnQuZXZlbnRzID0ge307XG4vLyAgICAgICBwYXJlbnQuZXZlbnRzW2V2ZW50XSA9IHN0YXRlO1xuXG4vLyAgICAgfSBlbHNlIGlmKGtleXdvcmRbMF0gPT09IFwiPlwiKSB7IC8vIEhhbmRsZSBlbWJlZFxuLy8gICAgICAgY2hhckl4IC09IGtleXdvcmQubGVuZ3RoIC0gMTtcbi8vICAgICAgIGxldCBlcnI7XG4vLyAgICAgICB3aGlsZShsaW5lW2NoYXJJeF0gPT09IFwiIFwiKSBjaGFySXgrKztcbi8vICAgICAgIGxldCBsYXN0SXggPSBjaGFySXg7XG4vLyAgICAgICBsZXQgZW1iZWRJZFJhdyA9IHJlYWRVbnRpbChsaW5lLCBcIntcIiwgY2hhckl4KTtcbi8vICAgICAgIGNoYXJJeCArPSBlbWJlZElkUmF3Lmxlbmd0aDtcbi8vICAgICAgIGxldCBlbWJlZElkID0gZW1iZWRJZFJhdy50cmltKCk7XG5cbi8vICAgICAgIGlmKCFlbWJlZElkKSBlcnIgPSBuZXcgUGFyc2VFcnJvcihgVUkgZW1iZWQgbXVzdCBzcGVjaWZ5IGEgdmFsaWQgZWxlbWVudCBpZGAsIGxpbmUsIGxpbmVJeCwgbGFzdEl4LCBlbWJlZElkUmF3Lmxlbmd0aCk7XG4vLyAgICAgICBsZXQgc2NvcGU7XG4vLyAgICAgICBbc2NvcGUgPSB7fSwgY2hhckl4XSA9IGdldE1hcEFyZ3MobGluZSwgbGluZUl4LCBjaGFySXgpO1xuLy8gICAgICAgaWYoc2NvcGUgaW5zdGFuY2VvZiBFcnJvciAmJiAhZXJyKSBlcnIgPSBzY29wZTtcbi8vICAgICAgIGlmKGVycikge1xuLy8gICAgICAgICBlcnJvcnMucHVzaChlcnIpO1xuLy8gICAgICAgICBsaW5lSXgrKztcbi8vICAgICAgICAgY29udGludWU7XG4vLyAgICAgICB9XG5cbi8vICAgICAgIGxldCBlbGVtID0ge2VtYmVkZGVkOiBzY29wZSwgaWQ6IGVtYmVkSWR9O1xuLy8gICAgICAgaWYoIXBhcmVudC5jaGlsZHJlbikgcGFyZW50LmNoaWxkcmVuID0gW107XG4vLyAgICAgICBwYXJlbnQuY2hpbGRyZW4ucHVzaChlbGVtKTtcbi8vICAgICAgIHN0YWNrLnB1c2goe2luZGVudCwgZWxlbX0pO1xuXG4vLyAgICAgfSBlbHNlIHsgLy8gSGFuZGxlIGVsZW1lbnRcbi8vICAgICAgIGxldCBlcnI7XG4vLyAgICAgICBpZigha2V5d29yZCkgZXJyID0gbmV3IFBhcnNlRXJyb3IoYFVJIGVsZW1lbnQgbXVzdCBzcGVjaWZ5IGEgdmFsaWQgdGFnIG5hbWVgLCBsaW5lLCBsaW5lSXgsIGNoYXJJeCwgMCk7XG4vLyAgICAgICB3aGlsZShsaW5lW2NoYXJJeF0gPT09IFwiIFwiKSBjaGFySXgrKztcbi8vICAgICAgIGxldCBjbGFzc2VzUmF3ID0gcmVhZFVudGlsKGxpbmUsIFwie1wiLCBjaGFySXgpO1xuLy8gICAgICAgY2hhckl4ICs9IGNsYXNzZXNSYXcubGVuZ3RoO1xuLy8gICAgICAgbGV0IGNsYXNzZXMgPSBjbGFzc2VzUmF3LnRyaW0oKTtcblxuLy8gICAgICAgbGV0IGF0dHJpYnV0ZXM7XG4vLyAgICAgICBbYXR0cmlidXRlcyA9IHt9LCBjaGFySXhdID0gZ2V0TWFwQXJncyhsaW5lLCBsaW5lSXgsIGNoYXJJeCk7XG4vLyAgICAgICBpZihhdHRyaWJ1dGVzIGluc3RhbmNlb2YgRXJyb3IgJiYgIWVycikgZXJyID0gYXR0cmlidXRlcztcbi8vICAgICAgIGlmKGVycikge1xuLy8gICAgICAgICBlcnJvcnMucHVzaChlcnIpO1xuLy8gICAgICAgICBsaW5lSXgrKztcbi8vICAgICAgICAgY29udGludWU7XG4vLyAgICAgICB9XG4vLyAgICAgICBhdHRyaWJ1dGVzW1widFwiXSA9IGtleXdvcmQ7XG4vLyAgICAgICBpZihjbGFzc2VzKSBhdHRyaWJ1dGVzW1wiY1wiXSA9IGNsYXNzZXM7XG4vLyAgICAgICBsZXQgZWxlbTpVSUVsZW0gPSB7aWQ6IGF0dHJpYnV0ZXNbXCJpZFwiXSwgYXR0cmlidXRlc307XG4vLyAgICAgICBpZighcGFyZW50LmNoaWxkcmVuKSBwYXJlbnQuY2hpbGRyZW4gPSBbXTtcbi8vICAgICAgIHBhcmVudC5jaGlsZHJlbi5wdXNoKGVsZW0pO1xuLy8gICAgICAgc3RhY2sucHVzaCh7aW5kZW50LCBlbGVtfSk7XG4vLyAgICAgfVxuXG4vLyAgICAgbGluZUl4Kys7XG4vLyAgIH1cblxuLy8gICBpZihlcnJvcnMubGVuZ3RoKSB7XG4vLyAgICAgZm9yKGxldCBlcnIgb2YgZXJyb3JzKSB7XG4vLyAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4vLyAgICAgfVxuLy8gICB9XG4vLyAgIHJldHVybiByb290O1xuLy8gfVxuXG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIEV2ZSBEU0wgUGFyc2VyXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5lbnVtIFRPS0VOX1RZUEUgeyBFWFBSLCBJREVOVElGSUVSLCBLRVlXT1JELCBTVFJJTkcsIExJVEVSQUwgfTtcbmV4cG9ydCBjbGFzcyBUb2tlbiB7XG4gIHN0YXRpYyBUWVBFID0gVE9LRU5fVFlQRTtcbiAgc3RhdGljIGlkZW50aWZpZXIodmFsdWU6c3RyaW5nLCBsaW5lSXg/OiBudW1iZXIsIGNoYXJJeD86IG51bWJlcikge1xuICAgIHJldHVybiBuZXcgVG9rZW4oVG9rZW4uVFlQRS5JREVOVElGSUVSLCB2YWx1ZSwgbGluZUl4LCBjaGFySXgpO1xuICB9XG4gIHN0YXRpYyBrZXl3b3JkKHZhbHVlOnN0cmluZywgbGluZUl4PzogbnVtYmVyLCBjaGFySXg/OiBudW1iZXIpIHtcbiAgICByZXR1cm4gbmV3IFRva2VuKFRva2VuLlRZUEUuS0VZV09SRCwgdmFsdWUsIGxpbmVJeCwgY2hhckl4KTtcbiAgfVxuICBzdGF0aWMgc3RyaW5nKHZhbHVlOnN0cmluZywgbGluZUl4PzogbnVtYmVyLCBjaGFySXg/OiBudW1iZXIpIHtcbiAgICByZXR1cm4gbmV3IFRva2VuKFRva2VuLlRZUEUuU1RSSU5HLCB2YWx1ZSwgbGluZUl4LCBjaGFySXgpO1xuICB9XG4gIHN0YXRpYyBsaXRlcmFsKHZhbHVlOmFueSwgbGluZUl4PzogbnVtYmVyLCBjaGFySXg/OiBudW1iZXIpIHtcbiAgICByZXR1cm4gbmV3IFRva2VuKFRva2VuLlRZUEUuTElURVJBTCwgdmFsdWUsIGxpbmVJeCwgY2hhckl4KTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyB0eXBlPzogVE9LRU5fVFlQRSwgcHVibGljIHZhbHVlPzogYW55LCBwdWJsaWMgbGluZUl4PzogbnVtYmVyLCBwdWJsaWMgY2hhckl4PzogbnVtYmVyKSB7fVxuICB0b1N0cmluZygpIHtcbiAgICBpZih0aGlzLnR5cGUgPT09IFRva2VuLlRZUEUuS0VZV09SRCkgcmV0dXJuIGA6JHt0aGlzLnZhbHVlfWA7XG4gICAgZWxzZSBpZih0aGlzLnR5cGUgPT09IFRva2VuLlRZUEUuU1RSSU5HKSByZXR1cm4gYFwiJHt0aGlzLnZhbHVlfVwiYDtcbiAgICBlbHNlIHJldHVybiB0aGlzLnZhbHVlLnRvU3RyaW5nKCk7XG4gIH1cbn1cblxuZXhwb3J0IGNsYXNzIFNleHByIHtcbiAgc3RhdGljIGxpc3QodmFsdWU6KFRva2VufFNleHByKVtdID0gW10sIGxpbmVJeD86IG51bWJlciwgY2hhckl4PzogbnVtYmVyLCBzeW50YXg/OiBib29sZWFuKSB7XG4gICAgdmFsdWUgPSB2YWx1ZS5zbGljZSgpO1xuICAgIHZhbHVlLnVuc2hpZnQoVG9rZW4uaWRlbnRpZmllcihcImxpc3RcIiwgbGluZUl4LCBjaGFySXggPyBjaGFySXggKyAxIDogdW5kZWZpbmVkKSk7XG4gICAgcmV0dXJuIG5ldyBTZXhwcih2YWx1ZSwgbGluZUl4LCBjaGFySXgsIHN5bnRheCA/IFwibGlzdFwiIDogdW5kZWZpbmVkKTtcbiAgfVxuICBzdGF0aWMgaGFzaCh2YWx1ZTooVG9rZW58U2V4cHIpW10gPSBbXSwgbGluZUl4PzogbnVtYmVyLCBjaGFySXg/OiBudW1iZXIsIHN5bnRheD86IGJvb2xlYW4pIHtcbiAgICB2YWx1ZSA9IHZhbHVlLnNsaWNlKCk7XG4gICAgdmFsdWUudW5zaGlmdChUb2tlbi5pZGVudGlmaWVyKFwiaGFzaFwiLCBsaW5lSXgsIGNoYXJJeCA/IGNoYXJJeCArIDEgOiB1bmRlZmluZWQpKTtcbiAgICByZXR1cm4gbmV3IFNleHByKHZhbHVlLCBsaW5lSXgsIGNoYXJJeCwgc3ludGF4ID8gXCJoYXNoXCIgOiB1bmRlZmluZWQpO1xuICB9XG4gIHN0YXRpYyBhc1NleHBycyh2YWx1ZXM6KFRva2VufFNleHByKVtdKTpTZXhwcltdIHtcbiAgICBmb3IobGV0IHJhdyBvZiB2YWx1ZXMpIHtcbiAgICAgaWYoIShyYXcgaW5zdGFuY2VvZiBTZXhwcikpIHRocm93IG5ldyBQYXJzZUVycm9yKGBBbGwgdG9wIGxldmVsIGVudHJpZXMgbXVzdCBiZSBleHByZXNzaW9ucyAoZ290ICR7cmF3fSlgLCB1bmRlZmluZWQsIHJhdy5saW5lSXgsIHJhdy5jaGFySXgpO1xuICAgICAgZWxzZSB7XG4gICAgICAgIGxldCBvcCA9IHJhdy5vcGVyYXRvcjtcbiAgICAgICAgaWYob3AudHlwZSAhPT0gVG9rZW4uVFlQRS5JREVOVElGSUVSKVxuICAgICAgICAgIHRocm93IG5ldyBQYXJzZUVycm9yKGBBbGwgZXhwcmVzc2lvbnMgbXVzdCBiZWdpbiB3aXRoIGFuIGlkZW50aWZpZXJgLCB1bmRlZmluZWQsIHJhdy5saW5lSXgsIHJhdy5jaGFySXgpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gPFNleHByW10+dmFsdWVzO1xuICB9XG5cbiAgcHVibGljIHR5cGUgPSBUb2tlbi5UWVBFLkVYUFI7XG4gIHB1YmxpYyB2YWx1ZTooVG9rZW58U2V4cHIpW107XG5cbiAgY29uc3RydWN0b3IodmFsPzogKFRva2VufFNleHByKVtdLCBwdWJsaWMgbGluZUl4PzogbnVtYmVyLCBwdWJsaWMgY2hhckl4PzogbnVtYmVyLCBwdWJsaWMgc3ludGF4ID0gXCJleHByXCIpIHtcbiAgICBpZih2YWwpIHRoaXMudmFsdWUgPSB2YWwuc2xpY2UoKTtcbiAgfVxuICB0b1N0cmluZygpIHtcbiAgICBsZXQgY29udGVudCA9IHRoaXMudmFsdWUgJiYgdGhpcy52YWx1ZS5tYXAoKHRva2VuKSA9PiB0b2tlbi50b1N0cmluZygpKS5qb2luKFwiIFwiKTtcbiAgICBsZXQgYXJnc0NvbnRlbnQgPSB0aGlzLnZhbHVlICYmIHRoaXMuYXJndW1lbnRzLm1hcCgodG9rZW4pID0+IHRva2VuLnRvU3RyaW5nKCkpLmpvaW4oXCIgXCIpO1xuICAgIGlmKHRoaXMuc3ludGF4ID09PSBcImhhc2hcIikgcmV0dXJuIGB7JHthcmdzQ29udGVudH19YDtcbiAgICBlbHNlIGlmKHRoaXMuc3ludGF4ID09PSBcImxpc3RcIikgcmV0dXJuIGBbJHthcmdzQ29udGVudH1dYDtcbiAgICBlbHNlIHJldHVybiBgKCR7Y29udGVudH0pYDtcbiAgfVxuXG4gIHB1c2godmFsOlRva2VufFNleHByKSB7XG4gICAgdGhpcy52YWx1ZSA9IHRoaXMudmFsdWUgfHwgW107XG4gICAgcmV0dXJuIHRoaXMudmFsdWUucHVzaCh2YWwpO1xuICB9XG4gIG50aChuLCB2YWw/OlRva2VufFNleHByKSB7XG4gICAgaWYodmFsKSB7XG4gICAgICB0aGlzLnZhbHVlID0gdGhpcy52YWx1ZSB8fCBbXTtcbiAgICAgIHJldHVybiB0aGlzLnZhbHVlW25dID0gdmFsO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy52YWx1ZSAmJiB0aGlzLnZhbHVlW25dO1xuICB9XG4gIGdldCBvcGVyYXRvcigpIHtcbiAgICByZXR1cm4gdGhpcy52YWx1ZSAmJiB0aGlzLnZhbHVlWzBdO1xuICB9XG4gIHNldCBvcGVyYXRvcihvcDogVG9rZW58U2V4cHIpIHtcbiAgICB0aGlzLnZhbHVlID0gdGhpcy52YWx1ZSB8fCBbXTtcbiAgICB0aGlzLnZhbHVlWzBdID0gb3A7XG4gIH1cbiAgZ2V0IGFyZ3VtZW50cygpIHtcbiAgICByZXR1cm4gdGhpcy52YWx1ZSAmJiB0aGlzLnZhbHVlLnNsaWNlKDEpO1xuICB9XG4gIHNldCBhcmd1bWVudHMoYXJnczogKFRva2VufFNleHByKVtdKSB7XG4gICAgdGhpcy52YWx1ZSA9IHRoaXMudmFsdWUgfHwgW107XG4gICAgdGhpcy52YWx1ZS5sZW5ndGggPSAxO1xuICAgIHRoaXMudmFsdWUucHVzaC5hcHBseSh0aGlzLnZhbHVlLCBhcmdzKTtcbiAgfVxuICBnZXQgbGVuZ3RoKCkge1xuICAgIHJldHVybiB0aGlzLnZhbHVlICYmIHRoaXMudmFsdWUubGVuZ3RoO1xuICB9XG59XG5cbmNvbnN0IFRPS0VOX1RPX1RZUEUgPSB7XG4gIFwiKFwiOiBcImV4cHJcIixcbiAgXCIpXCI6IFwiZXhwclwiLFxuICBcIltcIjogXCJsaXN0XCIsXG4gIFwiXVwiOiBcImxpc3RcIixcbiAgXCJ7XCI6IFwiaGFzaFwiLFxuICBcIn1cIjogXCJoYXNoXCJcbn07XG5cbmxldCBoeWdpZW5pY1N5bWJvbENvdW50ZXIgPSAwO1xuXG5leHBvcnQgZnVuY3Rpb24gcmVhZFNleHBycyh0ZXh0OnN0cmluZyk6U2V4cHIge1xuICBsZXQgcm9vdCA9IFNleHByLmxpc3QoKTtcbiAgbGV0IHRva2VuOlRva2VuO1xuICBsZXQgc2V4cHI6U2V4cHIgPSByb290O1xuICBsZXQgc2V4cHJzOlNleHByW10gPSBbcm9vdF07XG5cbiAgbGV0IGxpbmVzID0gdGV4dC5zcGxpdChcIlxcblwiKTtcbiAgbGV0IGxpbmVJeCA9IDA7XG4gIGxldCBtb2RlOnN0cmluZztcbiAgZm9yKGxldCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgbGV0IGxpbmUgPSBsaW5lc1tsaW5lSXhdO1xuICAgIGxldCBjaGFySXggPSAwO1xuXG4gICAgaWYobW9kZSA9PT0gXCJzdHJpbmdcIikgdG9rZW4udmFsdWUgKz0gXCJcXG5cIjtcblxuICAgIHdoaWxlKGNoYXJJeCA8IGxpbmUubGVuZ3RoKSB7XG4gICAgICBpZihtb2RlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIGlmKGxpbmVbY2hhckl4XSA9PT0gXCJcXFwiXCIgJiYgbGluZVtjaGFySXggLSAxXSAhPT0gXCJcXFxcXCIpIHtcbiAgICAgICAgICBzZXhwci5wdXNoKHRva2VuKTtcbiAgICAgICAgICB0b2tlbiA9IG1vZGUgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgY2hhckl4Kys7XG5cbiAgICAgICAgfSBlbHNlIHRva2VuLnZhbHVlICs9IGxpbmVbY2hhckl4KytdO1xuXG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICBsZXQgcGFkZGluZyA9IHJlYWRXaGlsZShsaW5lLCAvXFxzLywgY2hhckl4KTtcbiAgICAgIGNoYXJJeCArPSBwYWRkaW5nLmxlbmd0aDtcbiAgICAgIGlmKHBhZGRpbmcubGVuZ3RoKSB7XG4gICAgICAgIGlmKHRva2VuKSBzZXhwci5wdXNoKHRva2VuKTtcbiAgICAgICAgdG9rZW4gPSB1bmRlZmluZWQ7XG4gICAgICB9XG4gICAgICBpZihjaGFySXggPj0gbGluZS5sZW5ndGgpIGNvbnRpbnVlO1xuXG4gICAgICBpZihsaW5lW2NoYXJJeF0gPT09IFwiO1wiKSB7XG4gICAgICAgIGNoYXJJeCA9IGxpbmUubGVuZ3RoO1xuXG4gICAgICB9IGVsc2UgaWYobGluZVtjaGFySXhdID09PSBcIlxcXCJcIikge1xuICAgICAgICBpZighc2V4cHIubGVuZ3RoKSB0aHJvdyBuZXcgUGFyc2VFcnJvcihgTGl0ZXJhbCBtdXN0IGJlIGFuIGFyZ3VtZW50IGluIGEgc2V4cHIuYCwgbGluZSwgbGluZUl4LCBjaGFySXgpO1xuICAgICAgICBtb2RlID0gXCJzdHJpbmdcIjtcbiAgICAgICAgdG9rZW4gPSBUb2tlbi5zdHJpbmcoXCJcIiwgbGluZUl4LCBjaGFySXgpO1xuICAgICAgICBjaGFySXgrKztcblxuICAgICAgfSBlbHNlIGlmKGxpbmVbY2hhckl4XSA9PT0gXCI6XCIpIHtcbiAgICAgICAgaWYoIXNleHByLmxlbmd0aCkgdGhyb3cgbmV3IFBhcnNlRXJyb3IoYExpdGVyYWwgbXVzdCBiZSBhbiBhcmd1bWVudCBpbiBhIHNleHByLmAsIGxpbmUsIGxpbmVJeCwgY2hhckl4KTtcbiAgICAgICAgbGV0IGtleXdvcmQgPSByZWFkVW50aWxBbnkobGluZSwgW1wiIFwiLCBcIilcIiwgXCJdXCIsIFwifVwiXSwgKytjaGFySXgpO1xuICAgICAgICBzZXhwci5wdXNoKFRva2VuLmtleXdvcmQoa2V5d29yZCwgbGluZUl4LCBjaGFySXggLSAxKSk7XG4gICAgICAgIGNoYXJJeCArPSBrZXl3b3JkLmxlbmd0aDtcblxuICAgICAgfSBlbHNlIGlmKGxpbmVbY2hhckl4XSA9PT0gXCIoXCIgfHwgbGluZVtjaGFySXhdID09PSBcIltcIiB8fCBsaW5lW2NoYXJJeF0gPT09IFwie1wiKSB7XG4gICAgICAgIGlmKHRva2VuKSB0aHJvdyBuZXcgUGFyc2VFcnJvcihgU2V4cHIgYXJndW1lbnRzIG11c3QgYmUgc3BhY2Ugc2VwYXJhdGVkLmAsIGxpbmUsIGxpbmVJeCwgY2hhckl4KTtcbiAgICAgICAgbGV0IHR5cGUgPSBUT0tFTl9UT19UWVBFW2xpbmVbY2hhckl4XV07XG4gICAgICAgIGlmKHR5cGUgPT09IFwiaGFzaFwiKSBzZXhwciA9IFNleHByLmhhc2godW5kZWZpbmVkLCBsaW5lSXgsIGNoYXJJeCk7XG4gICAgICAgIGVsc2UgaWYodHlwZSA9PT0gXCJsaXN0XCIpIHNleHByID0gU2V4cHIubGlzdCh1bmRlZmluZWQsIGxpbmVJeCwgY2hhckl4KTtcbiAgICAgICAgZWxzZSBzZXhwciA9IG5ldyBTZXhwcih1bmRlZmluZWQsIGxpbmVJeCwgY2hhckl4KTtcbiAgICAgICAgc2V4cHIuc3ludGF4ID0gdHlwZTtcbiAgICAgICAgc2V4cHJzLnB1c2goc2V4cHIpO1xuICAgICAgICBjaGFySXgrKztcblxuICAgICAgfSBlbHNlIGlmKGxpbmVbY2hhckl4XSA9PT0gXCIpXCIgfHwgbGluZVtjaGFySXhdID09PSBcIl1cIiB8fCBsaW5lW2NoYXJJeF0gPT09IFwifVwiKSB7XG4gICAgICAgIGxldCBjaGlsZCA9IHNleHBycy5wb3AoKTtcbiAgICAgICAgbGV0IHR5cGUgPSBUT0tFTl9UT19UWVBFW2xpbmVbY2hhckl4XV07XG4gICAgICAgIGlmKGNoaWxkLnN5bnRheCAhPT0gdHlwZSkgdGhyb3cgbmV3IFBhcnNlRXJyb3IoYE11c3QgdGVybWluYXRlICR7Y2hpbGQuc3ludGF4fSBiZWZvcmUgdGVybWluYXRpbmcgJHt0eXBlfWAsIGxpbmUsIGxpbmVJeCwgY2hhckl4KTtcbiAgICAgICAgc2V4cHIgPSBzZXhwcnNbc2V4cHJzLmxlbmd0aCAtIDFdO1xuICAgICAgICBpZighc2V4cHIpIHRocm93IG5ldyBQYXJzZUVycm9yKGBUb28gbWFueSBjbG9zaW5nIHBhcmVuc2AsIGxpbmUsIGxpbmVJeCwgY2hhckl4KTtcbiAgICAgICAgc2V4cHIucHVzaChjaGlsZCk7XG4gICAgICAgIGNoYXJJeCsrO1xuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgbGl0ZXJhbCA9IHJlYWRVbnRpbEFueShsaW5lLCBbXCIgXCIsIFwiKVwiLCBcIl1cIiwgXCJ9XCJdLCBjaGFySXgpO1xuICAgICAgICBsZXQgbGVuZ3RoID0gbGl0ZXJhbC5sZW5ndGg7XG4gICAgICAgIGxpdGVyYWwgPSBjb2VyY2VJbnB1dChsaXRlcmFsKTtcbiAgICAgICAgbGV0IHR5cGUgPSB0eXBlb2YgbGl0ZXJhbCA9PT0gXCJzdHJpbmdcIiA/IFwiaWRlbnRpZmllclwiIDogXCJsaXRlcmFsXCI7XG4gICAgICAgIGlmKCFzZXhwci5sZW5ndGggJiYgdHlwZSAhPT0gXCJpZGVudGlmaWVyXCIpIHRocm93IG5ldyBQYXJzZUVycm9yKGBFeHByIG11c3QgYmVnaW4gd2l0aCBpZGVudGlmaWVyLmAsIGxpbmUsIGxpbmVJeCwgY2hhckl4KTtcbiAgICAgICAgaWYodHlwZSA9PT0gXCJpZGVudGlmaWVyXCIpIHtcbiAgICAgICAgICBsZXQgZG90SXggPSBsaXRlcmFsLmluZGV4T2YoXCIuXCIpO1xuICAgICAgICAgIGlmKGRvdEl4ICE9PSAtMSkge1xuICAgICAgICAgICAgbGV0IGNoaWxkOlNleHByID0gbmV3IFNleHByKFtcbiAgICAgICAgICAgICAgVG9rZW4uaWRlbnRpZmllcihcImdldFwiLCBsaW5lSXgsIGNoYXJJeCArIDEpLFxuICAgICAgICAgICAgICBUb2tlbi5pZGVudGlmaWVyKGxpdGVyYWwuc2xpY2UoMCwgZG90SXgpLCBsaW5lSXgsIGNoYXJJeCArIDMpLFxuICAgICAgICAgICAgICBUb2tlbi5zdHJpbmcobGl0ZXJhbC5zbGljZShkb3RJeCArIDEpLCBsaW5lSXgsIGNoYXJJeCArIDUgKyBkb3RJeClcbiAgICAgICAgICAgIF0sIGxpbmVJeCwgY2hhckl4KTtcbiAgICAgICAgICAgIHNleHByLnB1c2goY2hpbGQpO1xuXG4gICAgICAgICAgfSBlbHNlIHNleHByLnB1c2goVG9rZW4uaWRlbnRpZmllcihsaXRlcmFsLCBsaW5lSXgsIGNoYXJJeCkpO1xuXG4gICAgICAgIH0gZWxzZSBzZXhwci5wdXNoKFRva2VuLmxpdGVyYWwobGl0ZXJhbCwgbGluZUl4LCBjaGFySXgpKTtcbiAgICAgICAgY2hhckl4ICs9IGxlbmd0aDtcbiAgICAgIH1cbiAgICB9XG4gICAgbGluZUl4Kys7XG4gIH1cbiAgaWYodG9rZW4pIHRocm93IG5ldyBQYXJzZUVycm9yKGBVbnRlcm1pbmF0ZWQgJHtUT0tFTl9UWVBFW3Rva2VuLnR5cGVdfSB0b2tlbmAsIGxpbmVzW2xpbmVJeCAtIDFdLCBsaW5lSXggLSAxKTtcbiAgbGV0IGxhc3RJeCA9IGxpbmVzLmxlbmd0aCAtIDE7XG4gIGlmKHNleHBycy5sZW5ndGggPiAxKSB0aHJvdyBuZXcgUGFyc2VFcnJvcihgVG9vIGZldyBjbG9zaW5nIHBhcmVuc2AsIGxpbmVzW2xhc3RJeF0sIGxhc3RJeCwgbGluZXNbbGFzdEl4XS5sZW5ndGgpO1xuXG4gIHJldHVybiByb290O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbWFjcm9leHBhbmREU0woc2V4cHI6U2V4cHIpOlNleHByIHtcbiAgLy8gQFRPRE86IEltcGxlbWVudCBtZS5cbiAgbGV0IG9wID0gc2V4cHIub3BlcmF0b3I7XG4gIGlmKG9wLnZhbHVlID09PSBcImVhdlwiKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQFRPRE86IEltcGxlbWVudCBtZSFcIik7XG5cbiAgfSBlbHNlIGlmKG9wLnZhbHVlID09PSBcIm9uZS1vZlwiKSB7XG4gICAgLy8gKG9uZS1vZiAocXVlcnkgLi4uYm9keSkgKHF1ZXJ5IC4uLmJvZHkpIC4uLikgPT5cbiAgICAvLyAodW5pb25cbiAgICAvLyAgIChkZWYgcTEgKHF1ZXJ5IC4uLmJvZHkxKSlcbiAgICAvLyAgIChkZWYgcTIgKHF1ZXJ5IChuZWdhdGUgcTEpIC4uLmJvZHkyKSkpXG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQFRPRE86IEltcGxlbWVudCBtZSFcIik7XG5cbiAgfSBlbHNlIGlmKG9wLnZhbHVlID09PSBcIm5lZ2F0ZVwiKSB7XG4gICAgaWYoc2V4cHIubGVuZ3RoID4gMikgdGhyb3cgbmV3IFBhcnNlRXJyb3IoYE5lZ2F0ZSBvbmx5IHRha2VzIGEgc2luZ2xlIGJvZHlgLCB1bmRlZmluZWQsIHNleHByLmxpbmVJeCwgc2V4cHIuY2hhckl4KTtcbiAgICBsZXQgc2VsZWN0ID0gbWFjcm9leHBhbmREU0woU2V4cHIuYXNTZXhwcnMoc2V4cHIuYXJndW1lbnRzKVswXSk7XG4gICAgc2VsZWN0LnB1c2goVG9rZW4ua2V5d29yZChcIiQkbmVnYXRlZFwiKSk7XG4gICAgc2VsZWN0LnB1c2goVG9rZW4ubGl0ZXJhbCh0cnVlKSk7XG4gICAgcmV0dXJuIHNlbGVjdDtcblxuICB9IGVsc2UgaWYoW1wiaGFzaFwiLCBcImxpc3RcIiwgXCJnZXRcIiwgXCJkZWZcIiwgXCJxdWVyeVwiLCBcInVuaW9uXCIsIFwic2VsZWN0XCIsIFwibWVtYmVyXCIsIFwicHJvamVjdCFcIiwgXCJpbnNlcnQhXCIsIFwicmVtb3ZlIVwiLCBcImxvYWQhXCJdLmluZGV4T2Yob3AudmFsdWUpID09PSAtMSkge1xuICAgIC8vIChmb28tYmFyIDphIDUpID0+IChzZWxlY3QgXCJmb28gYmFyXCIgOmEgNSlcbiAgICBsZXQgc291cmNlID0gb3A7XG4gICAgc291cmNlLnR5cGUgPSBUb2tlbi5UWVBFLlNUUklORztcbiAgICBzb3VyY2UudmFsdWUgPSBzb3VyY2UudmFsdWUucmVwbGFjZSgvKC4/KS0oLikvZywgXCIkMSAkMlwiKTtcbiAgICBsZXQgYXJncyA9IHNleHByLmFyZ3VtZW50cztcbiAgICBhcmdzLnVuc2hpZnQoc291cmNlKTtcbiAgICBzZXhwci5hcmd1bWVudHMgPSBhcmdzO1xuICAgIHNleHByLm9wZXJhdG9yID0gVG9rZW4uaWRlbnRpZmllcihcInNlbGVjdFwiKTtcbiAgfVxuICByZXR1cm4gc2V4cHI7XG59XG5lbnVtIFZBTFVFIHsgTlVMTCwgU0NBTEFSLCBTRVQsIFZJRVcgfTtcbmV4cG9ydCB0eXBlIEFydGlmYWN0cyA9IHtjaGFuZ2VzZXQ/OiBydW50aW1lLkRpZmYsIHZpZXdzOiB7W3F1ZXJ5OnN0cmluZ106IHJ1bnRpbWUuUXVlcnl8cnVudGltZS5Vbmlvbn19O1xudHlwZSBWYXJpYWJsZSA9IHtuYW1lOiBzdHJpbmcsIHR5cGU6IFZBTFVFLCBzdGF0aWM/OiBib29sZWFuLCB2YWx1ZT86IGFueSwgcHJvamVjdGlvbj86IHN0cmluZywgY29uc3RyYWludHM6IFtzdHJpbmcsIHN0cmluZ11bXX07XG50eXBlIFZhcmlhYmxlQ29udGV4dCA9IFZhcmlhYmxlW107XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZURTTCh0ZXh0OnN0cmluZyk6QXJ0aWZhY3RzIHtcbiAgbGV0IGFydGlmYWN0czpBcnRpZmFjdHMgPSB7dmlld3M6IHt9fTtcbiAgbGV0IGxpbmVzID0gdGV4dC5zcGxpdChcIlxcblwiKTtcbiAgbGV0IHJvb3QgPSByZWFkU2V4cHJzKHRleHQpO1xuXG4gIGZvcihsZXQgcmF3IG9mIFNleHByLmFzU2V4cHJzKHJvb3QuYXJndW1lbnRzKSkgcGFyc2VEU0xTZXhwcihyYXcsIGFydGlmYWN0cyk7XG4gIHJldHVybiBhcnRpZmFjdHM7XG59XG5cbnR5cGUgU2V4cHJSZXN1bHQgPSB7dHlwZTpWQUxVRSwgdmFsdWU/OmFueSwgcHJvamVjdGVkPzphbnksIGNvbnRleHQ/OmFueSwgbWFwcGluZ3M/OmFueSwgYWdncmVnYXRlZD86Ym9vbGVhbn07XG5mdW5jdGlvbiBwYXJzZURTTFNleHByKHJhdzpTZXhwciwgYXJ0aWZhY3RzOkFydGlmYWN0cywgY29udGV4dD86VmFyaWFibGVDb250ZXh0LCBwYXJlbnQ/OnJ1bnRpbWUuUXVlcnl8cnVudGltZS5VbmlvbiwgcmVzdWx0VmFyaWFibGU/OnN0cmluZyk6U2V4cHJSZXN1bHQge1xuICBpZihwYXJlbnQgaW5zdGFuY2VvZiBydW50aW1lLlF1ZXJ5KSB2YXIgcXVlcnkgPSBwYXJlbnQ7XG4gIGVsc2UgdmFyIHVuaW9uID0gPHJ1bnRpbWUuVW5pb24+cGFyZW50O1xuICBsZXQgc2V4cHIgPSBtYWNyb2V4cGFuZERTTChyYXcpO1xuICBsZXQgb3AgPSBzZXhwci5vcGVyYXRvcjtcbiAgaWYob3AudHlwZSAhPT0gVG9rZW4uVFlQRS5JREVOVElGSUVSKVxuICAgIHRocm93IG5ldyBQYXJzZUVycm9yKGBFdmFsdWF0ZWQgc2V4cHIgbXVzdCBiZWdpbiB3aXRoIGFuIGlkZW50aWZpZXIgKCcke29wfScgaXMgYSAke1Rva2VuLlRZUEVbb3AudHlwZV19KWAsIFwiXCIsIHJhdy5saW5lSXgsIHJhdy5jaGFySXgpO1xuXG4gIGlmKG9wLnZhbHVlID09PSBcImxpc3RcIikge1xuICAgIGxldCB7JCRib2R5fSA9IHBhcnNlQXJndW1lbnRzKHNleHByLCB1bmRlZmluZWQsIFwiJCRib2R5XCIpO1xuICAgIHJldHVybiB7dHlwZTogVkFMVUUuU0NBTEFSLCB2YWx1ZTogKDxhbnk+JCRib2R5KS5tYXAoKHRva2VuLCBpeCkgPT4gcmVzb2x2ZVRva2VuVmFsdWUoYGxpc3QgaXRlbSAke2l4fWAsIHRva2VuLCBjb250ZXh0KSl9O1xuICB9XG4gIGlmKG9wLnZhbHVlID09PSBcImhhc2hcIikge1xuICAgIGxldCBhcmdzID0gcGFyc2VBcmd1bWVudHMoc2V4cHIpO1xuICAgIGZvcihsZXQgYXJnIGluIGFyZ3MpIGFyZ3NbYXJnXSA9IHJlc29sdmVUb2tlblZhbHVlKGBoYXNoIGl0ZW0gJHthcmd9YCwgYXJnc1thcmddLCBjb250ZXh0KTtcbiAgICByZXR1cm4ge3R5cGU6IFZBTFVFLlNFVCwgdmFsdWU6IGFyZ3N9O1xuICB9XG5cbiAgaWYob3AudmFsdWUgPT09IFwiaW5zZXJ0IVwiKSB7XG4gICAgICBsZXQgY2hhbmdlc2V0ID0gYXJ0aWZhY3RzLmNoYW5nZXNldCB8fCBldmUuZGlmZigpO1xuICAgICAgZm9yKGxldCBhcmcgb2Ygc2V4cHIuYXJndW1lbnRzKSB7XG4gICAgICAgICAgbGV0IHRhYmxlID0gYXJnLnZhbHVlWzBdO1xuICAgICAgICAgIGxldCBmYWN0ID0ge307XG4gICAgICAgICAgZm9yKGxldCBpeCA9IDE7IGl4IDwgYXJnLnZhbHVlLmxlbmd0aDsgaXggKz0gMikge1xuICAgICAgICAgICAgICBsZXQga2V5ID0gYXJnLnZhbHVlW2l4XTtcbiAgICAgICAgICAgICAgbGV0IHZhbHVlID0gYXJnLnZhbHVlW2l4KzFdO1xuICAgICAgICAgICAgICBmYWN0W2tleS52YWx1ZV0gPSB2YWx1ZS52YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2hhbmdlc2V0LmFkZCh0YWJsZS52YWx1ZSwgZmFjdCk7XG4gICAgICB9XG4gICAgICBhcnRpZmFjdHMuY2hhbmdlc2V0ID0gY2hhbmdlc2V0O1xuICAgICAgcmV0dXJuO1xuICB9XG5cbiAgaWYob3AudmFsdWUgPT09IFwicmVtb3ZlIVwiKSB7XG4gICAgICBsZXQgY2hhbmdlc2V0ID0gYXJ0aWZhY3RzLmNoYW5nZXNldCB8fCBldmUuZGlmZigpO1xuICAgICAgZm9yKGxldCBhcmcgb2Ygc2V4cHIuYXJndW1lbnRzKSB7XG4gICAgICAgICAgbGV0IHRhYmxlID0gYXJnLnZhbHVlWzBdO1xuICAgICAgICAgIGxldCBmYWN0ID0ge307XG4gICAgICAgICAgZm9yKGxldCBpeCA9IDE7IGl4IDwgYXJnLnZhbHVlLmxlbmd0aDsgaXggKz0gMikge1xuICAgICAgICAgICAgICBsZXQga2V5ID0gYXJnLnZhbHVlW2l4XTtcbiAgICAgICAgICAgICAgbGV0IHZhbHVlID0gYXJnLnZhbHVlW2l4KzFdO1xuICAgICAgICAgICAgICBmYWN0W2tleS52YWx1ZV0gPSB2YWx1ZS52YWx1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY2hhbmdlc2V0LnJlbW92ZSh0YWJsZS52YWx1ZSwgZmFjdCk7XG4gICAgICB9XG4gICAgICBhcnRpZmFjdHMuY2hhbmdlc2V0ID0gY2hhbmdlc2V0O1xuICAgICAgcmV0dXJuO1xuICB9XG5cbiAgaWYob3AudmFsdWUgPT09IFwibG9hZCFcIikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiKGxvYWQhIC4uKSBoYXMgbm90IGJlZW4gaW1wbGVtZW50ZWQgeWV0XCIpO1xuICB9XG5cbiAgaWYob3AudmFsdWUgPT09IFwicXVlcnlcIikge1xuICAgIGxldCBuZXVlQ29udGV4dDpWYXJpYWJsZUNvbnRleHQgPSBbXTtcbiAgICBsZXQgeyQkdmlldywgJCRuZWdhdGVkLCAkJGJvZHl9ID0gcGFyc2VBcmd1bWVudHMoc2V4cHIsIHVuZGVmaW5lZCwgXCIkJGJvZHlcIik7XG4gICAgbGV0IHF1ZXJ5SWQgPSAkJHZpZXcgPyByZXNvbHZlVG9rZW5WYWx1ZShcInZpZXdcIiwgJCR2aWV3LCBjb250ZXh0LCBWQUxVRS5TQ0FMQVIpIDogdXVpZCgpO1xuICAgIGxldCBuZXVlID0gbmV3IHJ1bnRpbWUuUXVlcnkoZXZlLCBxdWVyeUlkKTtcbiAgICBuZXVlW1wiZGlzcGxheU5hbWVcIl0gPSBzZXhwci50b1N0cmluZygpO1xuICAgIGlmKERFQlVHLmluc3RydW1lbnRRdWVyeSkgaW5zdHJ1bWVudFF1ZXJ5KG5ldWUsIERFQlVHLmluc3RydW1lbnRRdWVyeSk7XG4gICAgYXJ0aWZhY3RzLnZpZXdzW3F1ZXJ5SWRdID0gbmV1ZTtcbiAgICBsZXQgYWdncmVnYXRlZCA9IGZhbHNlO1xuICAgIGZvcihsZXQgcmF3IG9mIFNleHByLmFzU2V4cHJzKDxhbnk+JCRib2R5KSkge1xuICAgICAgbGV0IHN0YXRlID0gcGFyc2VEU0xTZXhwcihyYXcsIGFydGlmYWN0cywgbmV1ZUNvbnRleHQsIG5ldWUpO1xuICAgICAgaWYoc3RhdGUgJiYgc3RhdGUuYWdncmVnYXRlZCkgYWdncmVnYXRlZCA9IHRydWU7XG4gICAgfVxuXG4gICAgbGV0IHByb2plY3Rpb25NYXAgPSBuZXVlLnByb2plY3Rpb25NYXA7XG4gICAgbGV0IHByb2plY3RlZCA9IHRydWU7XG4gICAgaWYoIXByb2plY3Rpb25NYXApIHtcbiAgICAgIHByb2plY3Rpb25NYXAgPSB7fTtcbiAgICAgIHByb2plY3RlZCA9IGZhbHNlO1xuICAgICAgZm9yKGxldCB2YXJpYWJsZSBvZiBuZXVlQ29udGV4dCkgcHJvamVjdGlvbk1hcFt2YXJpYWJsZS5uYW1lXSA9IHZhcmlhYmxlLnZhbHVlO1xuICAgIH1cbiAgICBpZihPYmplY3Qua2V5cyhwcm9qZWN0aW9uTWFwKS5sZW5ndGgpIG5ldWUucHJvamVjdChwcm9qZWN0aW9uTWFwKTtcblxuICAgIC8vIEpvaW4gc3VicXVlcnkgdG8gcGFyZW50LlxuICAgIGlmKHBhcmVudCkge1xuICAgICAgbGV0IHNlbGVjdCA9IG5ldyBTZXhwcihbVG9rZW4uaWRlbnRpZmllcihxdWVyeSA/IFwic2VsZWN0XCIgOiBcIm1lbWJlclwiKSwgVG9rZW4uc3RyaW5nKHF1ZXJ5SWQpXSwgcmF3LmxpbmVJeCwgcmF3LmNoYXJJeCk7XG4gICAgICBsZXQgZ3JvdXBzID0gW107XG5cbiAgICAgIGZvcihsZXQgdmFyaWFibGUgb2YgbmV1ZUNvbnRleHQpIHtcbiAgICAgICAgaWYocHJvamVjdGVkICYmICF2YXJpYWJsZS5wcm9qZWN0aW9uKSBjb250aW51ZTtcbiAgICAgICAgbGV0IGZpZWxkID0gdmFyaWFibGUucHJvamVjdGlvbiB8fCB2YXJpYWJsZS5uYW1lO1xuICAgICAgICBzZWxlY3QucHVzaChUb2tlbi5rZXl3b3JkKGZpZWxkKSk7XG4gICAgICAgIGlmKHF1ZXJ5KSBzZWxlY3QucHVzaChUb2tlbi5pZGVudGlmaWVyKHZhcmlhYmxlLm5hbWUpKTtcbiAgICAgICAgZWxzZSBzZWxlY3QucHVzaChTZXhwci5saXN0KFtUb2tlbi5zdHJpbmcoZmllbGQpXSkpO1xuXG4gICAgICAgIGlmKGNvbnRleHQpIHtcbiAgICAgICAgICBmb3IobGV0IHBhcmVudFZhciBvZiBjb250ZXh0KSB7XG4gICAgICAgICAgICBpZihwYXJlbnRWYXIubmFtZSA9PT0gdmFyaWFibGUubmFtZSkgZ3JvdXBzLnB1c2godmFyaWFibGUudmFsdWUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZigkJG5lZ2F0ZWQpIHtcbiAgICAgICAgc2VsZWN0LnB1c2goVG9rZW4ua2V5d29yZChcIiQkbmVnYXRlZFwiKSk7XG4gICAgICAgIHNlbGVjdC5wdXNoKCQkbmVnYXRlZCk7XG4gICAgICB9XG4gICAgICBpZihncm91cHMubGVuZ3RoICYmIGFnZ3JlZ2F0ZWQpIG5ldWUuZ3JvdXAoZ3JvdXBzKTtcbiAgICAgIHBhcnNlRFNMU2V4cHIoc2VsZWN0LCBhcnRpZmFjdHMsIGNvbnRleHQsIHBhcmVudCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHt2YWx1ZTogcXVlcnlJZCwgdHlwZTogVkFMVUUuVklFVywgcHJvamVjdGVkLCBjb250ZXh0OiBuZXVlQ29udGV4dH07XG4gIH1cblxuICBpZihvcC52YWx1ZSA9PT0gXCJ1bmlvblwiKSB7XG4gICAgbGV0IHskJHZpZXcsICQkYm9keSwgJCRuZWdhdGVkfSA9IHBhcnNlQXJndW1lbnRzKHNleHByLCB1bmRlZmluZWQsIFwiJCRib2R5XCIpO1xuICAgIGxldCB1bmlvbklkID0gJCR2aWV3ID8gcmVzb2x2ZVRva2VuVmFsdWUoXCJ2aWV3XCIsICQkdmlldywgY29udGV4dCwgVkFMVUUuU0NBTEFSKSA6IHV1aWQoKTtcbiAgICBsZXQgbmV1ZSA9IG5ldyBydW50aW1lLlVuaW9uKGV2ZSwgdW5pb25JZCk7XG4gICAgaWYoREVCVUcuaW5zdHJ1bWVudFF1ZXJ5KSBpbnN0cnVtZW50UXVlcnkobmV1ZSwgREVCVUcuaW5zdHJ1bWVudFF1ZXJ5KTtcbiAgICBhcnRpZmFjdHMudmlld3NbdW5pb25JZF0gPSBuZXVlO1xuICAgIGxldCBtYXBwaW5ncyA9IHt9O1xuICAgIGZvcihsZXQgcmF3IG9mIFNleHByLmFzU2V4cHJzKDxhbnk+JCRib2R5KSkge1xuICAgICAgbGV0IGNoaWxkID0gbWFjcm9leHBhbmREU0wocmF3KTtcbiAgICAgIGlmKGNoaWxkLm9wZXJhdG9yLnZhbHVlICE9PSBcInF1ZXJ5XCIgJiYgY2hpbGQub3BlcmF0b3IudmFsdWUgIT09IFwidW5pb25cIilcbiAgICAgICAgdGhyb3cgbmV3IFBhcnNlRXJyb3IoXCJVbmlvbnMgbWF5IG9ubHkgY29udGFpbiBxdWVyaWVzXCIsIFwiXCIsIHJhdy5saW5lSXgsIHJhdy5jaGFySXgpO1xuICAgICAgbGV0IHJlcyA9IHBhcnNlRFNMU2V4cHIoY2hpbGQsIGFydGlmYWN0cywgY29udGV4dCwgbmV1ZSk7XG4gICAgICBmb3IobGV0IHZhcmlhYmxlIG9mIHJlcy5jb250ZXh0KSB7XG4gICAgICAgIGlmKHJlcy5wcm9qZWN0ZWQgJiYgIXZhcmlhYmxlLnByb2plY3Rpb24pIGNvbnRpbnVlO1xuICAgICAgICBsZXQgZmllbGQgPSB2YXJpYWJsZS5wcm9qZWN0aW9uIHx8IHZhcmlhYmxlLm5hbWU7XG4gICAgICAgIGlmKCFtYXBwaW5nc1tmaWVsZF0pIG1hcHBpbmdzW2ZpZWxkXSA9IHt9O1xuICAgICAgICBtYXBwaW5nc1tmaWVsZF1bdmFyaWFibGUubmFtZV0gPSB0cnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEpvaW4gc3VidW5pb24gdG8gcGFyZW50XG4gICAgaWYocGFyZW50KSB7XG4gICAgICBsZXQgc2VsZWN0ID0gbmV3IFNleHByKFtUb2tlbi5pZGVudGlmaWVyKHF1ZXJ5ID8gXCJzZWxlY3RcIiA6IFwibWVtYmVyXCIpLCBUb2tlbi5zdHJpbmcodW5pb25JZCldLCByYXcubGluZUl4LCByYXcuY2hhckl4KTtcbiAgICAgICBmb3IobGV0IGZpZWxkIGluIG1hcHBpbmdzKSB7XG4gICAgICAgICBsZXQgbWFwcGluZ1ZhcmlhYmxlcyA9IE9iamVjdC5rZXlzKG1hcHBpbmdzW2ZpZWxkXSk7XG4gICAgICAgICBpZihtYXBwaW5nVmFyaWFibGVzLmxlbmd0aCA+IDEpXG4gICAgICAgICAgdGhyb3cgbmV3IFBhcnNlRXJyb3IoXG4gICAgICAgICAgICBgQWxsIHZhcmlhYmxlcyBwcm9qZWN0ZWQgdG8gYSBzaW5nbGUgdW5pb24gZmllbGQgbXVzdCBoYXZlIHRoZSBzYW1lIG5hbWUuIEZpZWxkICcke2ZpZWxkfScgaGFzICR7bWFwcGluZ1ZhcmlhYmxlcy5sZW5ndGh9IGZpZWxkcyAoJHttYXBwaW5nVmFyaWFibGVzLmpvaW4oXCIsIFwiKX0pYCwgXCJcIiwgcmF3LmxpbmVJeCwgcmF3LmNoYXJJeCk7XG4gICAgICAgIHNlbGVjdC5wdXNoKFRva2VuLmtleXdvcmQoZmllbGQpKTtcbiAgICAgICAgc2VsZWN0LnB1c2goVG9rZW4uaWRlbnRpZmllcihtYXBwaW5nVmFyaWFibGVzWzBdKSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKFwidW5pb24gc2VsZWN0XCIsIHNlbGVjdC50b1N0cmluZygpKTtcbiAgICAgIHBhcnNlRFNMU2V4cHIoc2VsZWN0LCBhcnRpZmFjdHMsIGNvbnRleHQsIHBhcmVudCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHt0eXBlOiBWQUxVRS5WSUVXLCB2YWx1ZTogdW5pb25JZCwgbWFwcGluZ3N9O1xuICB9XG5cbiAgaWYob3AudmFsdWUgPT09IFwibWVtYmVyXCIpIHtcbiAgICBpZighdW5pb24pIHRocm93IG5ldyBQYXJzZUVycm9yKGBDYW5ub3QgYWRkIG1lbWJlciB0byBub24tdW5pb24gcGFyZW50YCwgXCJcIiwgcmF3LmxpbmVJeCwgcmF3LmNoYXJJeCk7XG4gICAgbGV0IGFyZ3MgPSBwYXJzZUFyZ3VtZW50cyhzZXhwciwgW1wiJCR2aWV3XCJdKTtcbiAgICBsZXQgeyQkdmlldywgJCRuZWdhdGVkfSA9IGFyZ3M7XG4gICAgbGV0IHZpZXcgPSByZXNvbHZlVG9rZW5WYWx1ZShcInZpZXdcIiwgJCR2aWV3LCBjb250ZXh0LCBWQUxVRS5TQ0FMQVIpO1xuICAgIGlmKHZpZXcgPT09IHVuZGVmaW5lZCkgdGhyb3cgbmV3IFBhcnNlRXJyb3IoXCJNdXN0IHNwZWNpZnkgYSB2aWV3IHRvIGJlIHVuaW9uZWRcIiwgXCJcIiwgcmF3LmxpbmVJeCwgcmF3LmNoYXJJeCk7XG5cbiAgICBsZXQgam9pbiA9IHt9O1xuICAgIGZvcihsZXQgYXJnIGluIGFyZ3MpIHtcbiAgICAgIGlmKGFyZyA9PT0gXCIkJHZpZXdcIiB8fCBhcmcgPT09IFwiJCRuZWdhdGVkXCIpIGNvbnRpbnVlO1xuICAgICAgam9pblthcmddID0gcmVzb2x2ZVRva2VuVmFsdWUoXCJtZW1iZXIgZmllbGRcIiwgYXJnc1thcmddLCBjb250ZXh0KTtcbiAgICB9XG4gICAgaWYocnVudGltZS5RdWVyeUZ1bmN0aW9uc1t2aWV3XSkgdGhyb3cgbmV3IFBhcnNlRXJyb3IoYENhbm5vdCB1bmlvbiBwcmltaXRpdmUgdmlldyAnJHt2aWV3fSdgLCBcIlwiLCByYXcubGluZUl4LCByYXcuY2hhckl4KTtcbiAgICB1bmlvbi51bmlvbih2aWV3LCBqb2luKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZighcGFyZW50KSB0aHJvdyBuZXcgUGFyc2VFcnJvcihgTm9uLXF1ZXJ5IG9yIHVuaW9uIHNleHBycyBtdXN0IGJlIGNvbnRhaW5lZCB3aXRoaW4gYSBxdWVyeSBvciB1bmlvbmAsIFwiXCIsIHJhdy5saW5lSXgsIHJhdy5jaGFySXgpO1xuXG4gIGlmKG9wLnZhbHVlID09PSBcInNlbGVjdFwiKSB7XG4gICAgaWYoIXF1ZXJ5KSB0aHJvdyBuZXcgUGFyc2VFcnJvcihgQ2Fubm90IGFkZCBzZWxlY3QgdG8gbm9uLXF1ZXJ5IHBhcmVudGAsIFwiXCIsIHJhdy5saW5lSXgsIHJhdy5jaGFySXgpO1xuICAgIGxldCBzZWxlY3RJZCA9IHV1aWQoKTtcbiAgICBsZXQgJCR2aWV3ID0gZ2V0QXJndW1lbnQoc2V4cHIsIFwiJCR2aWV3XCIsIFtcIiQkdmlld1wiXSk7XG4gICAgbGV0IHZpZXcgPSByZXNvbHZlVG9rZW5WYWx1ZShcInZpZXdcIiwgJCR2aWV3LCBjb250ZXh0LCBWQUxVRS5TQ0FMQVIpO1xuICAgIGlmKHZpZXcgPT09IHVuZGVmaW5lZCkgdGhyb3cgbmV3IFBhcnNlRXJyb3IoXCJNdXN0IHNwZWNpZnkgYSB2aWV3IHRvIGJlIHNlbGVjdGVkXCIsIFwiXCIsIHJhdy5saW5lSXgsIHJhdy5jaGFySXgpO1xuICAgIGxldCBwcmltaXRpdmUgPSBydW50aW1lLlF1ZXJ5RnVuY3Rpb25zW3ZpZXddXG4gICAgLy9AVE9ETzogTW92ZSB0aGlzIHRvIGFuIGV2ZSB0YWJsZSB0byBhbGxvdyB1c2VyIGRlZmluZWQgZGVmYXVsdHNcbiAgICBsZXQgYXJncyA9IHBhcnNlQXJndW1lbnRzKHNleHByLCBbXCIkJHZpZXdcIl0uY29uY2F0KGdldERlZmF1bHRzKHZpZXcpKSk7XG4gICAgbGV0IHskJG5lZ2F0ZWR9ID0gYXJncztcblxuICAgIGxldCBqb2luID0ge307XG4gICAgZm9yKGxldCBhcmcgaW4gYXJncykge1xuICAgICAgbGV0IHZhbHVlID0gYXJnc1thcmddO1xuICAgICAgbGV0IHZhcmlhYmxlO1xuICAgICAgaWYoYXJnID09PSBcIiQkdmlld1wiIHx8IGFyZyA9PT0gXCIkJG5lZ2F0ZWRcIikgY29udGludWU7XG5cbiAgICAgIGlmKHZhbHVlIGluc3RhbmNlb2YgVG9rZW4gJiYgdmFsdWUudHlwZSAhPT0gVG9rZW4uVFlQRS5JREVOVElGSUVSKSB7XG4gICAgICAgIGpvaW5bYXJnXSA9IGFyZ3NbYXJnXS52YWx1ZTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGlmKHZhbHVlIGluc3RhbmNlb2YgU2V4cHIpIHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IHBhcnNlRFNMU2V4cHIodmFsdWUsIGFydGlmYWN0cywgY29udGV4dCwgcGFyZW50LCBgJCR0ZW1wLSR7aHlnaWVuaWNTeW1ib2xDb3VudGVyKyt9LSR7YXJnfWApO1xuICAgICAgICBpZighcmVzdWx0IHx8IHJlc3VsdC50eXBlID09PSBWQUxVRS5OVUxMKSB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBzZXQgcGFyYW1ldGVyICcke2FyZ30nIHRvIG51bGwgdmFsdWUgJyR7dmFsdWUudG9TdHJpbmcoKX0nYCk7XG4gICAgICAgIGlmKHJlc3VsdC50eXBlID09PSBWQUxVRS5WSUVXKSB7XG4gICAgICAgICAgbGV0IHZpZXcgPSByZXN1bHQudmFsdWU7XG4gICAgICAgICAgbGV0IHJlc3VsdEZpZWxkID0gZ2V0UmVzdWx0KHZpZXcpO1xuICAgICAgICAgIGlmKCFyZXN1bHRGaWVsZCkgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3Qgc2V0IHBhcmFtZXRlciAnJHthcmd9JyB0byBzZWxlY3Qgd2l0aG91dCBkZWZhdWx0IHJlc3VsdCBmaWVsZGApO1xuICAgICAgICAgIGZvcihsZXQgY3VyVmFyIG9mIGNvbnRleHQpIHtcbiAgICAgICAgICAgIGZvcihsZXQgY29uc3RyYWludCBvZiBjdXJWYXIuY29uc3RyYWludHMpIHtcbiAgICAgICAgICAgICAgaWYoY29uc3RyYWludFswXSA9PT0gdmlldyAmJiBjb25zdHJhaW50WzFdID09PSByZXN1bHRGaWVsZCkge1xuICAgICAgICAgICAgICAgIHZhcmlhYmxlID0gY3VyVmFyO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgdmFyaWFibGUgPSBnZXREU0xWYXJpYWJsZSh2YWx1ZS52YWx1ZSwgY29udGV4dCk7XG5cbiAgICAgIGlmKHZhcmlhYmxlKSB7XG4gICAgICAgIGpvaW5bYXJnXSA9IHZhcmlhYmxlLnZhbHVlO1xuICAgICAgICB2YXJpYWJsZS5jb25zdHJhaW50cy5wdXNoKFt2aWV3LCBhcmddKTtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYoJCRuZWdhdGVkICYmICQkbmVnYXRlZC52YWx1ZSlcbiAgICAgICAgdGhyb3cgbmV3IFBhcnNlRXJyb3IoYENhbm5vdCBiaW5kIGZpZWxkIGluIG5lZ2F0ZWQgc2VsZWN0IHRvIHVuZGVmaW5lZCB2YXJpYWJsZSAnJHt2YWx1ZS52YWx1ZX0nYCwgXCJcIiwgcmF3LmxpbmVJeCwgcmF3LmNoYXJJeCk7XG4gICAgICBlbHNlIGNvbnRleHQucHVzaCh7bmFtZTogdmFsdWUudmFsdWUsIHR5cGU6IFZBTFVFLlNDQUxBUiwgdmFsdWU6IFtzZWxlY3RJZCwgYXJnXSwgY29uc3RyYWludHM6IFtbdmlldywgYXJnXV19KTsgLy8gQFRPRE86IGRvZXMgdGhpcyBub3QgbmVlZCB0byBhZGQgdG8gdGhlIGpvaW4gbWFwP1xuICAgIH1cblxuICAgIGxldCByZXN1bHRGaWVsZCA9IGdldFJlc3VsdCh2aWV3KTtcbiAgICBpZihyZXN1bHRWYXJpYWJsZSAmJiByZXN1bHRGaWVsZCAmJiAham9pbltyZXN1bHRGaWVsZF0pIHtcbiAgICAgIGpvaW5bcmVzdWx0RmllbGRdID0gW3NlbGVjdElkLCByZXN1bHRGaWVsZF07XG4gICAgICBjb250ZXh0LnB1c2goe25hbWU6IHJlc3VsdFZhcmlhYmxlLCB0eXBlOiBWQUxVRS5TQ0FMQVIsIHZhbHVlOiBbc2VsZWN0SWQsIHJlc3VsdEZpZWxkXSwgY29uc3RyYWludHM6IFtbdmlldywgcmVzdWx0RmllbGRdXX0pO1xuICAgIH1cblxuICAgIGlmKHByaW1pdGl2ZSkge1xuICAgICAgaWYoJCRuZWdhdGVkKSB7XG4gICAgICAgIGlmKHByaW1pdGl2ZS5pbnZlcnNlKSB2aWV3ID0gcHJpbWl0aXZlLmludmVyc2U7XG4gICAgICAgIGVsc2UgdGhyb3cgbmV3IFBhcnNlRXJyb3IoYENhbm5vdCBpbnZlcnQgcHJpbWl0aXZlIGNhbGN1bGF0aW9uICcke3ZpZXd9J2AsIFwiXCIsIHJhdy5saW5lSXgsIHJhdy5jaGFySXgpO1xuICAgICAgfVxuICAgICAgaWYocHJpbWl0aXZlLmFnZ3JlZ2F0ZSkgcXVlcnkuYWdncmVnYXRlKHZpZXcsIGpvaW4sIHNlbGVjdElkKTtcbiAgICAgIGVsc2UgcXVlcnkuY2FsY3VsYXRlKHZpZXcsIGpvaW4sIHNlbGVjdElkKTtcbiAgICB9IGVsc2UgaWYoJCRuZWdhdGVkKSBxdWVyeS5kZXNlbGVjdCh2aWV3LCBqb2luKTtcbiAgICBlbHNlIHF1ZXJ5LnNlbGVjdCh2aWV3LCBqb2luLCBzZWxlY3RJZCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGU6IFZBTFVFLlZJRVcsXG4gICAgICB2YWx1ZTogdmlldyxcbiAgICAgIGFnZ3JlZ2F0ZWQ6IHByaW1pdGl2ZSAmJiBwcmltaXRpdmUuYWdncmVnYXRlXG4gICAgfTtcbiAgfVxuXG4gIGlmKG9wLnZhbHVlID09PSBcInByb2plY3QhXCIpIHtcbiAgICBsZXQgYXJncyA9IHBhcnNlQXJndW1lbnRzKHNleHByLCBbXCIkJHZpZXdcIl0pO1xuICAgIGxldCB7JCR2aWV3LCAkJG5lZ2F0ZWR9ID0gYXJncztcblxuICAgIGxldCBwcm9qZWN0aW9uTWFwID0ge307XG4gICAgZm9yKGxldCBhcmcgaW4gYXJncykge1xuICAgICAgbGV0IHZhbHVlID0gYXJnc1thcmddO1xuICAgICAgaWYoYXJnID09PSBcIiQkdmlld1wiIHx8IGFyZyA9PT0gXCIkJG5lZ2F0ZWRcIikgY29udGludWU7XG4gICAgICBpZih2YWx1ZS50eXBlICE9PSBUb2tlbi5UWVBFLklERU5USUZJRVIpIHtcbiAgICAgICAgcHJvamVjdGlvbk1hcFthcmddID0gYXJnc1thcmddLnZhbHVlO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgbGV0IHZhcmlhYmxlID0gZ2V0RFNMVmFyaWFibGUodmFsdWUudmFsdWUsIGNvbnRleHQpO1xuICAgICAgaWYodmFyaWFibGUpIHtcbiAgICAgICAgaWYodmFyaWFibGUuc3RhdGljKSBwcm9qZWN0aW9uTWFwW2FyZ10gPSB2YXJpYWJsZS52YWx1ZTtcbiAgICAgICAgZWxzZSBpZighJCR2aWV3KSB7XG4gICAgICAgICAgdmFyaWFibGUucHJvamVjdGlvbiA9IGFyZztcbiAgICAgICAgICBwcm9qZWN0aW9uTWFwW2FyZ10gPSB2YXJpYWJsZS52YWx1ZTtcbiAgICAgICAgfSBlbHNlIHByb2plY3Rpb25NYXBbYXJnXSA9IFt2YXJpYWJsZS5uYW1lXTtcbiAgICAgIH0gZWxzZSB0aHJvdyBuZXcgUGFyc2VFcnJvcihgQ2Fubm90IGJpbmQgcHJvamVjdGVkIGZpZWxkIHRvIHVuZGVmaW5lZCB2YXJpYWJsZSAnJHt2YWx1ZS52YWx1ZX0nYCwgXCJcIiwgcmF3LmxpbmVJeCwgcmF3LmNoYXJJeCk7XG4gICAgfVxuXG4gICAgbGV0IHZpZXcgPSByZXNvbHZlVG9rZW5WYWx1ZShcInZpZXdcIiwgJCR2aWV3LCBjb250ZXh0LCBWQUxVRS5TQ0FMQVIpO1xuICAgIGlmKHZpZXcgPT09IHVuZGVmaW5lZCkge1xuICAgICAgaWYocXVlcnkucHJvamVjdGlvbk1hcCkgdGhyb3cgbmV3IFBhcnNlRXJyb3IoXCJRdWVyeSBjYW4gb25seSBzZWxmLXByb2plY3Qgb25jZVwiLCBcIlwiLCByYXcubGluZUl4LCByYXcuY2hhckl4KTtcbiAgICAgIGlmKCQkbmVnYXRlZCAmJiAkJG5lZ2F0ZWQudmFsdWUpIHRocm93IG5ldyBQYXJzZUVycm9yKGBDYW5ub3QgbmVnYXRlIHNlbGYtcHJvamVjdGlvbmAsIFwiXCIsIHJhdy5saW5lSXgsIHJhdy5jaGFySXgpO1xuICAgICAgLy8gUHJvamVjdCBzZWxmXG4gICAgICBxdWVyeS5wcm9qZWN0KHByb2plY3Rpb25NYXApO1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgdW5pb24gPSA8cnVudGltZS5Vbmlvbj5hcnRpZmFjdHMudmlld3Nbdmlld10gfHwgbmV3IHJ1bnRpbWUuVW5pb24oZXZlLCB2aWV3KTtcbiAgICAgIGlmKERFQlVHLmluc3RydW1lbnRRdWVyeSAmJiAhYXJ0aWZhY3RzLnZpZXdzW3ZpZXddKSBpbnN0cnVtZW50UXVlcnkodW5pb24sIERFQlVHLmluc3RydW1lbnRRdWVyeSk7XG4gICAgICBhcnRpZmFjdHMudmlld3Nbdmlld10gPSB1bmlvbjtcblxuICAgICAgLy8gaWYoJCRuZWdhdGVkICYmICQkbmVnYXRlZC52YWx1ZSkgdW5pb24udW51bmlvbihxdWVyeUlkLCBwcm9qZWN0aW9uTWFwKTtcbiAgICAgIGlmKCQkbmVnYXRlZCAmJiAkJG5lZ2F0ZWQudmFsdWUpXG4gICAgICAgIHRocm93IG5ldyBQYXJzZUVycm9yKGBVbmlvbiBwcm9qZWN0aW9ucyBtYXkgbm90IGJlIG5lZ2F0ZWQgaW4gdGhlIGN1cnJlbnQgcnVudGltZWAsIFwiXCIsIHJhdy5saW5lSXgsIHJhdy5jaGFySXgpO1xuICAgICAgZWxzZSB1bmlvbi51bmlvbihxdWVyeS5uYW1lLCBwcm9qZWN0aW9uTWFwKTtcbiAgICB9XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgdGhyb3cgbmV3IFBhcnNlRXJyb3IoYFVua25vd24gRFNMIG9wZXJhdG9yICcke29wLnZhbHVlfSdgLCBcIlwiLCByYXcubGluZUl4LCByYXcuY2hhckl4KTtcbn1cblxuZnVuY3Rpb24gcmVzb2x2ZVRva2VuVmFsdWUobmFtZTpzdHJpbmcsIHRva2VuOlRva2VufFNleHByLCBjb250ZXh0OlZhcmlhYmxlQ29udGV4dCwgdHlwZT86VkFMVUUpIHtcbiAgaWYoIXRva2VuKSByZXR1cm47XG4gIGlmKHRva2VuIGluc3RhbmNlb2YgU2V4cHIpIHJldHVybiBwYXJzZURTTFNleHByKHRva2VuLCB1bmRlZmluZWQsIGNvbnRleHQpO1xuICBpZih0b2tlbiBpbnN0YW5jZW9mIFRva2VuICYmIHRva2VuLnR5cGUgPT09IFRva2VuLlRZUEUuSURFTlRJRklFUikge1xuICAgIGxldCB2YXJpYWJsZSA9IGdldERTTFZhcmlhYmxlKHRva2VuLnZhbHVlLCBjb250ZXh0LCBWQUxVRS5TQ0FMQVIpO1xuICAgIGlmKCF2YXJpYWJsZSkgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgYmluZCAke25hbWV9IHRvIHVuZGVmaW5lZCB2YXJpYWJsZSAnJHt0b2tlbi52YWx1ZX0nYCk7XG4gICAgaWYoIXZhcmlhYmxlLnN0YXRpYykgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgYmluZCAke25hbWV9IHRvIGR5bmFtaWMgdmFyaWFibGUgJyR7dG9rZW4udmFsdWV9J2ApO1xuICAgIHJldHVybiB2YXJpYWJsZS52YWx1ZTtcbiAgfVxuICByZXR1cm4gdG9rZW4udmFsdWU7XG59XG5cbmZ1bmN0aW9uIGdldERTTFZhcmlhYmxlKG5hbWU6c3RyaW5nLCBjb250ZXh0OlZhcmlhYmxlQ29udGV4dCwgdHlwZT86VkFMVUUpOlZhcmlhYmxlIHtcbiAgaWYoIWNvbnRleHQpIHJldHVybjtcbiAgZm9yKGxldCB2YXJpYWJsZSBvZiBjb250ZXh0KSB7XG4gICAgaWYodmFyaWFibGUubmFtZSA9PT0gbmFtZSkge1xuICAgICAgaWYodmFyaWFibGUuc3RhdGljID09PSBmYWxzZSkgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3Qgc3RhdGljYWxseSBsb29rIHVwIGR5bmFtaWMgdmFyaWFibGUgJyR7bmFtZX0nYCk7XG4gICAgICBpZih0eXBlICE9PSB1bmRlZmluZWQgJiYgdmFyaWFibGUudHlwZSAhPT0gdHlwZSlcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFeHBlY3RlZCB2YXJpYWJsZSAnJHtuYW1lfScgdG8gaGF2ZSB0eXBlICcke3R5cGV9JywgYnV0IGluc3RlYWQgaGFzIHR5cGUgJyR7dmFyaWFibGUudHlwZX0nYCk7XG4gICAgICByZXR1cm4gdmFyaWFibGU7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGdldERlZmF1bHRzKHZpZXc6c3RyaW5nKTpzdHJpbmdbXSB7XG4gIHJldHVybiAocnVudGltZS5RdWVyeUZ1bmN0aW9uc1t2aWV3XSAmJiBydW50aW1lLlF1ZXJ5RnVuY3Rpb25zW3ZpZXddLnBhcmFtcykgfHwgW107XG59XG5mdW5jdGlvbiBnZXRSZXN1bHQodmlldzpzdHJpbmcpOnN0cmluZyB7XG4gIHJldHVybiBydW50aW1lLlF1ZXJ5RnVuY3Rpb25zW3ZpZXddICYmIHJ1bnRpbWUuUXVlcnlGdW5jdGlvbnNbdmlld10ucmVzdWx0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QXJndW1lbnQocm9vdDpTZXhwciwgcGFyYW06c3RyaW5nLCBkZWZhdWx0cz86IHN0cmluZ1tdKTpUb2tlbnxTZXhwciB7XG4gIGxldCBpeCA9IDE7XG4gIGxldCBkZWZhdWx0SXggPSAwO1xuICBmb3IobGV0IGl4ID0gMSwgY3VyID0gcm9vdC5udGgoaXgpOyBpeCA8IHJvb3QubGVuZ3RoOyBpeCsrKSB7XG4gICAgaWYoY3VyLnR5cGUgPT09IFRva2VuLlRZUEUuS0VZV09SRCkge1xuICAgICAgaWYoY3VyLnZhbHVlID09PSBwYXJhbSkgcmV0dXJuIHJvb3QubnRoKGl4ICsgMSk7XG4gICAgICBlbHNlIGl4ICsgMTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYoZGVmYXVsdHMgJiYgZGVmYXVsdEl4IDwgZGVmYXVsdHMubGVuZ3RoKSB7XG4gICAgICAgIGxldCBrZXl3b3JkID0gZGVmYXVsdHNbZGVmYXVsdEl4KytdO1xuICAgICAgICBpZihrZXl3b3JkID09PSBwYXJhbSkgcmV0dXJuIGN1cjtcbiAgICAgICAgZWxzZSBpeCArIDE7XG4gICAgICB9XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFBhcmFtICcke3BhcmFtfScgbm90IGluIHNleHByICR7cm9vdC50b1N0cmluZygpfWApO1xuICAgIH1cbiAgfVxuICB0aHJvdyBuZXcgRXJyb3IoYFBhcmFtICcke3BhcmFtfScgbm90IGluIHNleHByICR7cm9vdC50b1N0cmluZygpfWApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFyc2VBcmd1bWVudHMocm9vdDpTZXhwciwgZGVmYXVsdHM/OnN0cmluZ1tdLCByZXN0PzpzdHJpbmcpOntba2V5d29yZDpzdHJpbmddOiBUb2tlbnxTZXhwcn0ge1xuICBsZXQgYXJnczphbnkgPSB7fTtcbiAgbGV0IGRlZmF1bHRJeCA9IDA7XG4gIGxldCBrZXl3b3JkO1xuICBsZXQga3dhcmcgPSBmYWxzZTtcbiAgZm9yKGxldCByYXcgb2Ygcm9vdC5hcmd1bWVudHMpIHtcbiAgICBpZihyYXcudHlwZSA9PT0gVG9rZW4uVFlQRS5LRVlXT1JEKSB7XG4gICAgICBpZihrZXl3b3JkKSB0aHJvdyBuZXcgRXJyb3IoYEtleXdvcmRzIG1heSBub3QgYmUgdmFsdWVzICcke3Jhd30nYCk7XG4gICAgICBlbHNlIGtleXdvcmQgPSByYXcudmFsdWU7XG4gICAgfSBlbHNlIGlmKGtleXdvcmQpIHtcbiAgICAgIGlmKGFyZ3Nba2V5d29yZF0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBhcmdzW2tleXdvcmRdID0gcmF3O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYoIShhcmdzW2tleXdvcmRdIGluc3RhbmNlb2YgQXJyYXkpKSBhcmdzW2tleXdvcmRdID0gW2FyZ3Nba2V5d29yZF1dO1xuICAgICAgICBhcmdzW2tleXdvcmRdLnB1c2gocmF3KTtcbiAgICAgIH1cbiAgICAgIGtleXdvcmQgPSB1bmRlZmluZWQ7XG4gICAgICBkZWZhdWx0SXggPSBkZWZhdWx0cyA/IGRlZmF1bHRzLmxlbmd0aCA6IDA7XG4gICAgICBrd2FyZyA9IHRydWU7XG4gICAgfSBlbHNlIGlmKGRlZmF1bHRzICYmIGRlZmF1bHRJeCA8IGRlZmF1bHRzLmxlbmd0aCkge1xuICAgICAgYXJnc1tkZWZhdWx0c1tkZWZhdWx0SXgrK11dID0gcmF3O1xuICAgIH0gZWxzZSBpZihyZXN0KSB7XG4gICAgICBhcmdzW3Jlc3RdID0gYXJnc1tyZXN0XSB8fCBbXTtcbiAgICAgIGFyZ3NbcmVzdF0ucHVzaChyYXcpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZihrd2FyZykgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IHNwZWNpZnkgYW4gYXJnIGFmdGVyIGEga3dhcmdcIik7XG4gICAgICBlbHNlIGlmKGRlZmF1bHRJeCkgdGhyb3cgbmV3IEVycm9yKGBUb28gbWFueSBhcmdzLCBleHBlY3RlZDogJHtkZWZhdWx0cy5sZW5ndGh9LCBnb3Q6ICR7ZGVmYXVsdEl4ICsgMX1gKTtcbiAgICAgIGVsc2UgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IHNwZWNpZnkgYW4gYXJnIHdpdGhvdXQgZGVmYXVsdCBrZXlzIHNwZWNpZmllZFwiKTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gYXJncztcbn1cblxuZGVjbGFyZSB2YXIgZXhwb3J0cztcbmlmKEVOViA9PT0gXCJicm93c2VyXCIpIHdpbmRvd1tcInBhcnNlclwiXSA9IGV4cG9ydHM7XG5cbmV4cG9ydCBmdW5jdGlvbiBpbnN0cnVtZW50UXVlcnkocTphbnksIGluc3RydW1lbnQ/OkZ1bmN0aW9ufGJvb2xlYW4pIHtcbiAgbGV0IGluc3RydW1lbnRhdGlvbjpGdW5jdGlvbiA9IDxGdW5jdGlvbj5pbnN0cnVtZW50O1xuICBpZighaW5zdHJ1bWVudCB8fCBpbnN0cnVtZW50ID09PSB0cnVlKSBpbnN0cnVtZW50YXRpb24gPSAoZm4sIGFyZ3MpID0+IGNvbnNvbGUubG9nKFwiKlwiLCBmbiwgXCI6XCIsIGFyZ3MpO1xuICBsZXQga2V5cyA9IFtdO1xuICBmb3IobGV0IGtleSBpbiBxKSBrZXlzLnB1c2goa2V5KTtcbiAga2V5cy5mb3JFYWNoKChmbikgPT4ge1xuICAgIGlmKCFxLmNvbnN0cnVjdG9yLnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eShmbikgfHwgdHlwZW9mIHFbZm5dICE9PSBcImZ1bmN0aW9uXCIpIHJldHVybjtcbiAgICB2YXIgb2xkID0gcVtmbl07XG4gICAgcVtmbl0gPSBmdW5jdGlvbigpIHtcbiAgICAgIGluc3RydW1lbnRhdGlvbihmbiwgYXJndW1lbnRzKTtcbiAgICAgIHJldHVybiBvbGQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gcTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFzRGlmZihpeGVyLCBhcnRpZmFjdHM6QXJ0aWZhY3RzKSB7XG4gIGxldCB2aWV3cyA9IGFydGlmYWN0cy52aWV3cztcbiAgbGV0IGRpZmYgPSBpeGVyLmRpZmYoKTtcbiAgZm9yKGxldCBpZCBpbiB2aWV3cykgZGlmZi5tZXJnZSh2aWV3c1tpZF0uY2hhbmdlc2V0KGV2ZSkpO1xuICByZXR1cm4gZGlmZjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFwcGx5QXNEaWZmcyhhcnRpZmFjdHM6QXJ0aWZhY3RzKSB7XG4gIGxldCB2aWV3cyA9IGFydGlmYWN0cy52aWV3cztcbiAgZm9yKGxldCBpZCBpbiB2aWV3cykgZXZlLmFwcGx5RGlmZih2aWV3c1tpZF0uY2hhbmdlc2V0KGV2ZSkpO1xuICBjb25zb2xlLmxvZyhcIkFwcGxpZWQgZGlmZnMgZm9yOlwiKTtcbiAgZm9yKGxldCBpZCBpbiB2aWV3cykgY29uc29sZS5sb2coXCIgICogXCIsIHZpZXdzW2lkXSBpbnN0YW5jZW9mIHJ1bnRpbWUuUXVlcnkgPyBcIlF1ZXJ5XCIgOiBcIlVuaW9uXCIsIHZpZXdzW2lkXS5uYW1lKTtcbiAgcmV0dXJuIGFydGlmYWN0cztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxvZ0FydGlmYWN0cyhhcnRpZmFjdHM6QXJ0aWZhY3RzKSB7XG4gIGZvcihsZXQgdmlldyBpbiBhcnRpZmFjdHMudmlld3MpIGNvbnNvbGUubG9nKHZpZXcsIFwiXFxuXCIsIGV2ZS5maW5kKHZpZXcpKTtcbn1cbiIsImltcG9ydCAqIGFzIGFwcCBmcm9tIFwiLi9hcHBcIjtcbmltcG9ydCB7UmVuZGVyZXJ9IGZyb20gXCIuL21pY3JvUmVhY3RcIjtcbmltcG9ydCB7Y29weSwgbWVyZ2VPYmplY3R9IGZyb20gXCIuL3V0aWxzXCI7XG5pbXBvcnQgKiBhcyBDb2RlTWlycm9yIGZyb20gXCJjb2RlbWlycm9yXCI7XG5pbXBvcnQgKiBhcyBtYXJrZWQgZnJvbSBcIm1hcmtlZC1hc3RcIjtcblxucmVxdWlyZShcImNvZGVtaXJyb3IvbW9kZS9nZm0vZ2ZtXCIpO1xucmVxdWlyZShcImNvZGVtaXJyb3IvbW9kZS9jbG9qdXJlL2Nsb2p1cmVcIik7XG5cbmRlY2xhcmUgdmFyIHV1aWQ7XG5cbmZ1bmN0aW9uIHJlcGxhY2VBbGwoc3RyLCBmaW5kLCByZXBsYWNlKSB7XG4gIGxldCByZWdleCA9IG5ldyBSZWdFeHAoZmluZC5yZXBsYWNlKC9bLVxcL1xcXFxeJCorPy4oKXxbXFxde31dL2csICdcXFxcJCYnKSwgJ2cnKTtcbiAgcmV0dXJuIHN0ci5yZXBsYWNlKHJlZ2V4LCByZXBsYWNlKTtcbn1cblxuZnVuY3Rpb24gd3JhcFdpdGhNYXJrZG93bihjbSwgd3JhcHBpbmcpIHtcbiAgY20ub3BlcmF0aW9uKCgpID0+IHtcbiAgICBsZXQgZnJvbSA9IGNtLmdldEN1cnNvcihcImZyb21cIik7XG4gICAgLy8gaWYgdGhlcmUncyBzb21ldGhpbmcgc2VsZWN0ZWQgd3JhcCBpdFxuICAgIGlmIChjbS5zb21ldGhpbmdTZWxlY3RlZCgpKSB7XG4gICAgICBsZXQgc2VsZWN0ZWQgPSBjbS5nZXRTZWxlY3Rpb24oKTtcbiAgICAgIGxldCBjbGVhbmVkID0gcmVwbGFjZUFsbChzZWxlY3RlZCwgd3JhcHBpbmcsIFwiXCIpO1xuICAgICAgaWYgKHNlbGVjdGVkLnN1YnN0cmluZygwLCB3cmFwcGluZy5sZW5ndGgpID09PSB3cmFwcGluZ1xuICAgICAgICAmJiBzZWxlY3RlZC5zdWJzdHJpbmcoc2VsZWN0ZWQubGVuZ3RoIC0gd3JhcHBpbmcubGVuZ3RoKSA9PT0gd3JhcHBpbmcpIHtcbiAgICAgICAgY20ucmVwbGFjZVJhbmdlKGNsZWFuZWQsIGZyb20sIGNtLmdldEN1cnNvcihcInRvXCIpKTtcbiAgICAgICAgY20uc2V0U2VsZWN0aW9uKGZyb20sIGNtLmdldEN1cnNvcihcImZyb21cIikpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbGV0IHN0ciA9IGAke3dyYXBwaW5nfSR7Y2xlYW5lZH0ke3dyYXBwaW5nfWA7XG4gICAgICAgIGNtLnJlcGxhY2VSYW5nZShzdHIsIGZyb20sIGNtLmdldEN1cnNvcihcInRvXCIpKTtcbiAgICAgICAgY20uc2V0U2VsZWN0aW9uKGZyb20sIGNtLmdldEN1cnNvcihcImZyb21cIikpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBjbS5yZXBsYWNlUmFuZ2UoYCR7d3JhcHBpbmd9JHt3cmFwcGluZ31gLCBmcm9tKTtcbiAgICAgIGxldCBuZXdMb2NhdGlvbiA9IHsgbGluZTogZnJvbS5saW5lLCBjaDogZnJvbS5jaCArIHdyYXBwaW5nLmxlbmd0aCB9O1xuICAgICAgY20uc2V0Q3Vyc29yKG5ld0xvY2F0aW9uKTtcbiAgICB9XG4gIH0pXG59XG5cbmZ1bmN0aW9uIHByZWZpeFdpdGhNYXJrZG93bihjbSwgcHJlZml4KSB7XG4gIGNtLm9wZXJhdGlvbigoKSA9PiB7XG4gICAgbGV0IGZyb20gPSBjbS5nZXRDdXJzb3IoXCJmcm9tXCIpO1xuICAgIGxldCB0byA9IGNtLmdldEN1cnNvcihcInRvXCIpO1xuICAgIGxldCB0b1ByZWZpeCA9IFtdO1xuICAgIGZvcihsZXQgbGluZUl4ID0gZnJvbS5saW5lOyBsaW5lSXggPD0gdG8ubGluZTsgbGluZUl4KyspIHtcbiAgICAgIHZhciBjdXJyZW50UHJlZml4ID0gY20uZ2V0UmFuZ2Uoe2xpbmU6IGxpbmVJeCwgY2g6IDB9LCB7bGluZTogbGluZUl4LCBjaDogcHJlZml4Lmxlbmd0aH0pO1xuICAgICAgaWYoY3VycmVudFByZWZpeCAhPT0gcHJlZml4ICYmIGN1cnJlbnRQcmVmaXggIT09IFwiXCIpIHtcbiAgICAgICAgdG9QcmVmaXgucHVzaChsaW5lSXgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIGlmIGV2ZXJ5dGhpbmcgaW4gdGhlIHNlbGVjdGlvbiBoYXMgYmVlbiBwcmVmaXhlZCwgdGhlbiB3ZSBuZWVkIHRvIHVucHJlZml4XG4gICAgaWYodG9QcmVmaXgubGVuZ3RoID09PSAwKSB7XG4gICAgIGZvcihsZXQgbGluZUl4ID0gZnJvbS5saW5lOyBsaW5lSXggPD0gdG8ubGluZTsgbGluZUl4KyspIHtcbiAgICAgICBjbS5yZXBsYWNlUmFuZ2UoXCJcIiwge2xpbmU6IGxpbmVJeCwgY2g6IDB9LCB7bGluZTogbGluZUl4LCBjaDogcHJlZml4Lmxlbmd0aH0pO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBmb3IobGV0IGxpbmVJeCBvZiB0b1ByZWZpeCkge1xuICAgICAgICBjbS5yZXBsYWNlUmFuZ2UocHJlZml4LCB7bGluZTogbGluZUl4LCBjaDogMH0pO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG59XG5cbnZhciBkZWZhdWx0S2V5cyA9IHtcbiAgXCJDbWQtQlwiOiAoY20pID0+IHtcbiAgICB3cmFwV2l0aE1hcmtkb3duKGNtLCBcIioqXCIpO1xuICB9LFxuICBcIkNtZC1JXCI6IChjbSkgPT4ge1xuICAgIHdyYXBXaXRoTWFya2Rvd24oY20sIFwiX1wiKTtcbiAgfSxcbn07XG5cbmV4cG9ydCBjbGFzcyBSaWNoVGV4dEVkaXRvciB7XG5cbiAgY21JbnN0YW5jZTogQ29kZU1pcnJvci5FZGl0b3I7XG4gIG1hcmtzOiB7fTtcbiAgdGltZW91dDtcbiAgbWV0YTogYW55O1xuICAvL2Zvcm1hdCBiYXJcbiAgZm9ybWF0QmFyRGVsYXkgPSAxMDA7XG4gIHNob3dpbmdGb3JtYXRCYXIgPSBmYWxzZTtcbiAgZm9ybWF0QmFyRWxlbWVudDpFbGVtZW50ID0gbnVsbDtcbiAgLy8gZXZlbnRzXG4gIG9uVXBkYXRlOiAobWV0YTogYW55LCBjb250ZW50OiBzdHJpbmcpID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3Iobm9kZSwgb3B0aW9ucykge1xuICAgIHRoaXMubWFya3MgPSB7fTtcbiAgICB0aGlzLm1ldGEgPSB7fTtcbiAgICBsZXQgZXh0cmFLZXlzID0gbWVyZ2VPYmplY3QoY29weShkZWZhdWx0S2V5cyksIG9wdGlvbnMua2V5cyB8fCB7fSk7XG4gICAgdGhpcy5jbUluc3RhbmNlID0gPENvZGVNaXJyb3IuRWRpdG9yPkNvZGVNaXJyb3Iobm9kZSwge1xuICAgICAgbW9kZTogXCJldmVcIixcbiAgICAgIGxpbmVXcmFwcGluZzogdHJ1ZSxcbiAgICAgIGF1dG9DbG9zZUJyYWNrZXRzOiB0cnVlLFxuICAgICAgdmlld3BvcnRNYXJnaW46IEluZmluaXR5LFxuICAgICAgZXh0cmFLZXlzXG4gICAgfSk7XG4gICAgbGV0IGNtID0gdGhpcy5jbUluc3RhbmNlO1xuXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgIGNtLm9uKFwiY2hhbmdlc1wiLCAoY20sIGNoYW5nZXMpID0+IHtcbiAgICAgIHNlbGYub25DaGFuZ2VzKGNtLCBjaGFuZ2VzKTtcbiAgICAgIGlmIChzZWxmLm9uVXBkYXRlKSB7XG4gICAgICAgIHNlbGYub25VcGRhdGUoc2VsZi5tZXRhLCBjbS5nZXRWYWx1ZSgpKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBjbS5vbihcImN1cnNvckFjdGl2aXR5XCIsIChjbSkgPT4geyBzZWxmLm9uQ3Vyc29yQWN0aXZpdHkoY20pIH0pO1xuICAgIGNtLm9uKFwibW91c2Vkb3duXCIsIChjbSwgZSkgPT4geyBzZWxmLm9uTW91c2VEb3duKGNtLCBlKSB9KTtcbiAgICBjbS5nZXRXcmFwcGVyRWxlbWVudCgpLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZXVwXCIsIChlKSA9PiB7XG4gICAgICBzZWxmLm9uTW91c2VVcChjbSwgZSk7XG4gICAgfSk7XG4gIH1cblxuICBzaG93Rm9ybWF0QmFyKCkge1xuICAgIC8vQCBUT0RPOiByZS1lbmFibGUgdGhlIGZvcm1hdCBiYXJcbiAgICByZXR1cm47XG4gICAgdGhpcy5zaG93aW5nRm9ybWF0QmFyID0gdHJ1ZTtcbiAgICB2YXIgcmVuZGVyZXIgPSBuZXcgUmVuZGVyZXIoKTtcbiAgICB2YXIgY20gPSB0aGlzLmNtSW5zdGFuY2U7XG4gICAgbGV0IGhlYWQgPSBjbS5nZXRDdXJzb3IoXCJoZWFkXCIpO1xuICAgIGxldCBmcm9tID0gY20uZ2V0Q3Vyc29yKFwiZnJvbVwiKTtcbiAgICBsZXQgdG8gPSBjbS5nZXRDdXJzb3IoXCJ0b1wiKTtcbiAgICBsZXQgc3RhcnQgPSBjbS5jdXJzb3JDb29yZHMoaGVhZCwgXCJsb2NhbFwiKTtcbiAgICBsZXQgdG9wID0gc3RhcnQuYm90dG9tICsgNTtcbiAgICBpZigoaGVhZC5saW5lID09PSBmcm9tLmxpbmUgJiYgaGVhZC5jaCA9PT0gZnJvbS5jaClcbiAgICAgICB8fCAoY20uY3Vyc29yQ29vcmRzKGZyb20sIFwibG9jYWxcIikudG9wID09PSBjbS5jdXJzb3JDb29yZHModG8sIFwibG9jYWxcIikudG9wKSkge1xuICAgICAgdG9wID0gc3RhcnQudG9wIC0gNDA7XG4gICAgfVxuICAgIGxldCBiYXJTaXplID0gMzAwIC8gMjtcbiAgICB2YXIgaXRlbSA9IHtjOiBcImZvcm1hdEJhclwiLCBzdHlsZTogYHBvc2l0aW9uOmFic29sdXRlOyBsZWZ0OiAke3N0YXJ0LmxlZnQgLSBiYXJTaXplfXB4OyB0b3A6JHt0b3B9cHg7YCwgY2hpbGRyZW46IFtcbiAgICAgIHtjOiBcImJ1dHRvbiBcIiwgdGV4dDogXCJIMVwiLCBjbGljazogKCkgPT4geyBwcmVmaXhXaXRoTWFya2Rvd24oY20sIFwiIyBcIik7IH19LFxuICAgICAge2M6IFwiYnV0dG9uIFwiLCB0ZXh0OiBcIkgyXCIsIGNsaWNrOiAoKSA9PiB7IHByZWZpeFdpdGhNYXJrZG93bihjbSwgXCIjIyBcIik7IH19LFxuICAgICAge2M6IFwic2VwXCJ9LFxuICAgICAge2M6IFwiYnV0dG9uIGJvbGRcIiwgdGV4dDogXCJCXCIsIGNsaWNrOiAoKSA9PiB7IHdyYXBXaXRoTWFya2Rvd24oY20sIFwiKipcIik7IH19LFxuICAgICAge2M6IFwiYnV0dG9uIGl0YWxpY1wiLCB0ZXh0OiBcIklcIiwgY2xpY2s6ICgpID0+IHsgd3JhcFdpdGhNYXJrZG93bihjbSwgXCJfXCIpOyB9fSxcbiAgICAgIHtjOiBcInNlcFwifSxcbiAgICAgIHtjOiBcImJ1dHRvbiBcIiwgdGV4dDogXCItXCIsIGNsaWNrOiAoKSA9PiB7IHByZWZpeFdpdGhNYXJrZG93bihjbSwgXCItIFwiKTsgfX0sXG4gICAgICB7YzogXCJidXR0b24gXCIsIHRleHQ6IFwiMS5cIiwgY2xpY2s6ICgpID0+IHsgcHJlZml4V2l0aE1hcmtkb3duKGNtLCBcIjEuIFwiKTsgfX0sXG4gICAgICB7YzogXCJidXR0b24gXCIsIHRleHQ6IFwiWyBdXCIsIGNsaWNrOiAoKSA9PiB7IHByZWZpeFdpdGhNYXJrZG93bihjbSwgXCJbIF0gXCIpOyB9fSxcbiAgICAgIHtjOiBcInNlcFwifSxcbiAgICAgIHtjOiBcImJ1dHRvbiBcIiwgdGV4dDogXCJsaW5rXCJ9LFxuICAgIF19O1xuICAgIHJlbmRlcmVyLnJlbmRlcihbaXRlbV0pO1xuICAgIGxldCBlbGVtID0gPEVsZW1lbnQ+cmVuZGVyZXIuY29udGVudC5maXJzdENoaWxkO1xuICAgIHRoaXMuZm9ybWF0QmFyRWxlbWVudCA9IGVsZW07XG4gICAgY20uZ2V0V3JhcHBlckVsZW1lbnQoKS5hcHBlbmRDaGlsZChlbGVtKTtcbiAgICAvLyB0aGlzLmNtSW5zdGFuY2UuYWRkV2lkZ2V0KHBvcywgZWxlbSk7XG4gIH1cblxuICBoaWRlRm9ybWF0QmFyKCkge1xuICAgIHRoaXMuc2hvd2luZ0Zvcm1hdEJhciA9IGZhbHNlO1xuICAgIHRoaXMuZm9ybWF0QmFyRWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZm9ybWF0QmFyRWxlbWVudCk7XG4gICAgdGhpcy5mb3JtYXRCYXJFbGVtZW50ID0gbnVsbDtcbiAgfVxuXG4gIG9uQ2hhbmdlcyhjbSwgY2hhbmdlcykge1xuICAgIGxldCBzZWxmID0gdGhpcztcbiAgfVxuXG4gIG9uQ3Vyc29yQWN0aXZpdHkoY20pIHtcbiAgICBpZih0aGlzLnNob3dpbmdGb3JtYXRCYXIgJiYgIWNtLnNvbWV0aGluZ1NlbGVjdGVkKCkpIHtcbiAgICAgIHRoaXMuaGlkZUZvcm1hdEJhcigpO1xuICAgIH1cbiAgfVxuXG4gIG9uTW91c2VVcChjbSwgZSkge1xuICAgIGlmKCF0aGlzLnNob3dpbmdGb3JtYXRCYXIpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVvdXQpO1xuICAgICAgdGhpcy50aW1lb3V0ID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGlmIChjbS5zb21ldGhpbmdTZWxlY3RlZCgpKSB7XG4gICAgICAgICAgc2VsZi5zaG93Rm9ybWF0QmFyKCk7XG4gICAgICAgIH1cbiAgICAgIH0sIHRoaXMuZm9ybWF0QmFyRGVsYXkpO1xuICAgIH1cbiAgfVxuXG4gIG9uTW91c2VEb3duKGNtLCBlKSB7XG4gICAgbGV0IGN1cnNvciA9IGNtLmNvb3Jkc0NoYXIoeyBsZWZ0OiBlLmNsaWVudFgsIHRvcDogZS5jbGllbnRZIH0pO1xuICAgIGxldCBwb3MgPSBjbS5pbmRleEZyb21Qb3MoY3Vyc29yKTtcbiAgICBsZXQgbWFya3MgPSBjbS5maW5kTWFya3NBdChjdXJzb3IpO1xuICB9XG5cbiAgYWRkTWFyayhwYW5lSWQsIGNlbGwsIGZyb20sIHRvLCBtYXJrPykge1xuICAgIGxldCBjbTphbnkgPSB0aGlzLmNtSW5zdGFuY2U7XG4gICAgbGV0IGNlbGxJZCA9IGNlbGwuaWQ7XG4gICAgbGV0IGRvbTtcbiAgICBpZighbWFyaykge1xuICAgICAgZG9tID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIGRvbS5pZCA9IGAke3BhbmVJZH18JHtjZWxsSWR9fGNvbnRhaW5lcmA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRvbSA9IG1hcmsucmVwbGFjZWRXaXRoO1xuICAgICAgbWFyay5jbGVhcigpO1xuICAgIH1cbiAgICBsZXQgbmV3TWFyayA9IGNtLm1hcmtUZXh0KGNtLnBvc0Zyb21JbmRleChmcm9tKSwgY20ucG9zRnJvbUluZGV4KHRvKSwge3JlcGxhY2VkV2l0aDogZG9tfSk7XG4gICAgbmV3TWFyay5jZWxsID0gY2VsbDtcbiAgICBkb21bXCJtYXJrXCJdID0gbmV3TWFyaztcbiAgICB0aGlzLm1hcmtzW2NlbGxJZF0gPSBuZXdNYXJrO1xuICB9XG5cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUVkaXRvcihub2RlLCBlbGVtKSB7XG4gIGxldCBvcHRpb25zID0gZWxlbS5vcHRpb25zIHx8IHt9O1xuICBsZXQgZWRpdG9yID0gbm9kZS5lZGl0b3I7XG4gIGxldCBjbTphbnk7XG4gIGlmICghZWRpdG9yKSB7XG4gICAgZWRpdG9yID0gbm9kZS5lZGl0b3IgPSBuZXcgUmljaFRleHRFZGl0b3Iobm9kZSwgb3B0aW9ucyk7XG4gICAgY20gPSBub2RlLmVkaXRvci5jbUluc3RhbmNlO1xuICAgIGlmKCFvcHRpb25zLm5vRm9jdXMpIHtcbiAgICAgIGNtLmZvY3VzKCk7XG4gICAgfVxuICAgIGNtLnJlZnJlc2goKTsgLy8gQEZJWE1FOiBUaGlzIGFsc28gbmVlZHMgdG8gYmUgY2FsbGVkIGFueSB0aW1lIGl0IGlzIGhpZGRlbiBhbmQgYWRkZWQgYWdhaW4uXG4gIH0gZWxzZSB7XG4gICAgY20gPSBub2RlLmVkaXRvci5jbUluc3RhbmNlO1xuICB9XG4gIGVkaXRvci5vblVwZGF0ZSA9IGVsZW0ub25VcGRhdGU7XG4gIGVkaXRvci5tZXRhID0gZWxlbS5tZXRhIHx8IGVkaXRvci5tZXRhO1xuICBsZXQgZG9jID0gY20uZ2V0RG9jKCk7XG4gIGlmIChkb2MuZ2V0VmFsdWUoKSAhPT0gZWxlbS52YWx1ZSkge1xuICAgIGRvYy5zZXRWYWx1ZShlbGVtLnZhbHVlIHx8IFwiXCIpO1xuICAgIGRvYy5jbGVhckhpc3RvcnkoKTtcbiAgICBkb2Muc2V0Q3Vyc29yKHtsaW5lOiAxLCBjaDogMH0pO1xuICB9XG4gIGlmKGVsZW0uY2VsbHMpIHtcbiAgICBjbS5vcGVyYXRpb24oKCkgPT4ge1xuICAgICAgbGV0IGNlbGxJZHMgPSB7fTtcbiAgICAgIGZvcihsZXQgY2VsbCBvZiBlbGVtLmNlbGxzKSB7XG4gICAgICAgIGNlbGxJZHNbY2VsbC5pZF0gPSB0cnVlO1xuICAgICAgICBsZXQgbWFyayA9IGVkaXRvci5tYXJrc1tjZWxsLmlkXTtcbiAgICAgICAgbGV0IGFkZCA9IGZhbHNlO1xuICAgICAgICBpZighbWFyaykge1xuICAgICAgICAgIGFkZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbGV0IGZvdW5kID0gbWFyay5maW5kKCk7XG4gICAgICAgICAgaWYoIWZvdW5kKSB7XG4gICAgICAgICAgICBhZGQgPSB0cnVlO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBpZiB0aGUgbWFyayBkb2Vzbid0IGNvbnRhaW4gdGhlIGNvcnJlY3QgdGV4dCwgd2UgbmVlZCB0byBudWtlIGl0LlxuICAgICAgICAgICAgbGV0IHtmcm9tLCB0b30gPSBmb3VuZDtcbiAgICAgICAgICAgIGlmKGNtLmdldFJhbmdlKGZyb20sIHRvKSAhPT0gY2VsbC52YWx1ZSB8fCBjZWxsLnN0YXJ0ICE9PSBjbS5pbmRleEZyb21Qb3MoZnJvbSkpIHtcbiAgICAgICAgICAgICAgYWRkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYoYWRkKSB7XG4gICAgICAgICAgZWRpdG9yLmFkZE1hcmsoZWxlbVtcIm1ldGFcIl0ucGFuZUlkLCBjZWxsLCBjZWxsLnN0YXJ0LCBjZWxsLnN0YXJ0ICsgY2VsbC5sZW5ndGgsIG1hcmspO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmb3IobGV0IG1hcmtJZCBpbiBlZGl0b3IubWFya3MpIHtcbiAgICAgICAgaWYoIWNlbGxJZHNbbWFya0lkXSkge1xuICAgICAgICAgIGVkaXRvci5tYXJrc1ttYXJrSWRdLmNsZWFyKCk7XG4gICAgICAgICAgZGVsZXRlIGVkaXRvci5tYXJrc1ttYXJrSWRdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH1cbn1cblxuXG5Db2RlTWlycm9yLmRlZmluZU1vZGUoXCJldmVcIiwgZnVuY3Rpb24oKSB7XG4gIHJldHVybiB7XG4gICAgc3RhcnRTdGF0ZTogKCkgPT4ge1xuICAgICAgcmV0dXJuIHt9O1xuICAgIH0sXG4gICAgdG9rZW46IGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHtcbiAgICAgIGlmKHN0cmVhbS5zb2woKSAmJiBzdHJlYW0ucGVlaygpID09PSBcIiNcIikge1xuICAgICAgICBzdGF0ZS5oZWFkZXIgPSB0cnVlO1xuICAgICAgICBzdHJlYW0uZWF0V2hpbGUoXCIjXCIpO1xuICAgICAgICBzdGF0ZS5oZWFkZXJOdW0gPSBzdHJlYW0uY3VycmVudCgpLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIGBoZWFkZXItaW5kaWNhdG9yIGhlYWRlci1pbmRpY2F0b3ItJHtzdGF0ZS5oZWFkZXJOdW19YDtcbiAgICAgIH0gZWxzZSBpZihzdGF0ZS5oZWFkZXIpIHtcbiAgICAgICAgc3RyZWFtLnNraXBUb0VuZCgpO1xuICAgICAgICBzdGF0ZS5oZWFkZXIgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuIGBoZWFkZXIgaGVhZGVyLSR7c3RhdGUuaGVhZGVyTnVtfWA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdGF0ZS5oZWFkZXIgPSBmYWxzZTtcbiAgICAgICAgc3RyZWFtLnNraXBUb0VuZCgpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcbn0pO1xuXG5Db2RlTWlycm9yLmRlZmluZU1JTUUoXCJ0ZXh0L3gtZXZlXCIsIFwiZXZlXCIpO1xuIiwiaW1wb3J0IHtFTlYsIHV1aWR9IGZyb20gXCIuL3V0aWxzXCI7XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBSdW50aW1lXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZGVjbGFyZSB2YXIgZXhwb3J0cztcbmxldCBydW50aW1lID0gZXhwb3J0cztcblxuZXhwb3J0IHZhciBNQVhfTlVNQkVSID0gOTAwNzE5OTI1NDc0MDk5MTtcbmV4cG9ydCB2YXIgSU5DUkVNRU5UQUwgPSBmYWxzZTtcblxuZnVuY3Rpb24gb2JqZWN0c0lkZW50aWNhbChhOntba2V5OnN0cmluZ106IGFueX0sIGI6e1trZXk6c3RyaW5nXTogYW55fSk6Ym9vbGVhbiB7XG4gIHZhciBhS2V5cyA9IE9iamVjdC5rZXlzKGEpO1xuICBmb3IodmFyIGtleSBvZiBhS2V5cykge1xuICAgIC8vVE9ETzogaGFuZGxlIG5vbi1zY2FsYXIgdmFsdWVzXG4gICAgaWYoYVtrZXldICE9PSBiW2tleV0pIHJldHVybiBmYWxzZTtcbiAgfVxuICByZXR1cm4gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gaW5kZXhPZkZhY3QoaGF5c3RhY2ssIG5lZWRsZSkge1xuICBsZXQgaXggPSAwO1xuICBmb3IobGV0IGZhY3Qgb2YgaGF5c3RhY2spIHtcbiAgICBpZihmYWN0Ll9faWQgPT09IG5lZWRsZS5fX2lkKSB7XG4gICAgICByZXR1cm4gaXg7XG4gICAgfVxuICAgIGl4Kys7XG4gIH1cbiAgcmV0dXJuIC0xO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVtb3ZlRmFjdChoYXlzdGFjaywgbmVlZGxlKSB7XG4gIGxldCBpeCA9IGluZGV4T2ZGYWN0KGhheXN0YWNrLCBuZWVkbGUpO1xuICBpZihpeCA+IC0xKSBoYXlzdGFjay5zcGxpY2UoaXgsIDEpO1xuICByZXR1cm4gaGF5c3RhY2s7XG59XG5cbmZ1bmN0aW9uIGRpZmZBZGRzQW5kUmVtb3ZlcyhhZGRzLCByZW1vdmVzKSB7XG4gIGxldCBsb2NhbEhhc2ggPSB7fTtcbiAgbGV0IGhhc2hUb0ZhY3QgPSB7fTtcbiAgbGV0IGhhc2hlcyA9IFtdO1xuICBmb3IobGV0IGFkZCBvZiBhZGRzKSB7XG4gICAgbGV0IGhhc2ggPSBhZGQuX19pZDtcbiAgICBpZihsb2NhbEhhc2hbaGFzaF0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgbG9jYWxIYXNoW2hhc2hdID0gMTtcbiAgICAgIGhhc2hUb0ZhY3RbaGFzaF0gPSBhZGQ7XG4gICAgICBoYXNoZXMucHVzaChoYXNoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgbG9jYWxIYXNoW2hhc2hdKys7XG4gICAgfVxuICAgIGFkZC5fX2lkID0gaGFzaDtcbiAgfVxuICBmb3IobGV0IHJlbW92ZSBvZiByZW1vdmVzKSB7XG4gICAgbGV0IGhhc2ggPSByZW1vdmUuX19pZDtcbiAgICBpZihsb2NhbEhhc2hbaGFzaF0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgbG9jYWxIYXNoW2hhc2hdID0gLTE7XG4gICAgICBoYXNoVG9GYWN0W2hhc2hdID0gcmVtb3ZlO1xuICAgICAgaGFzaGVzLnB1c2goaGFzaCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxvY2FsSGFzaFtoYXNoXS0tO1xuICAgIH1cbiAgICByZW1vdmUuX19pZCA9IGhhc2g7XG4gIH1cbiAgbGV0IHJlYWxBZGRzID0gW107XG4gIGxldCByZWFsUmVtb3ZlcyA9IFtdO1xuICBmb3IobGV0IGhhc2ggb2YgaGFzaGVzKSB7XG4gICAgbGV0IGNvdW50ID0gbG9jYWxIYXNoW2hhc2hdO1xuICAgIGlmKGNvdW50ID4gMCkge1xuICAgICAgbGV0IGZhY3QgPSBoYXNoVG9GYWN0W2hhc2hdO1xuICAgICAgcmVhbEFkZHMucHVzaChmYWN0KTtcbiAgICB9IGVsc2UgaWYoY291bnQgPCAwKSB7XG4gICAgICBsZXQgZmFjdCA9IGhhc2hUb0ZhY3RbaGFzaF07XG4gICAgICByZWFsUmVtb3Zlcy5wdXNoKGZhY3QpO1xuICAgIH1cbiAgfVxuICByZXR1cm4ge2FkZHM6cmVhbEFkZHMsIHJlbW92ZXM6cmVhbFJlbW92ZXN9O1xufVxuXG5mdW5jdGlvbiBnZW5lcmF0ZUVxdWFsaXR5Rm4oa2V5cykge1xuICByZXR1cm4gbmV3IEZ1bmN0aW9uKFwiYVwiLCBcImJcIiwgIGByZXR1cm4gJHtrZXlzLm1hcChmdW5jdGlvbihrZXksIGl4KSB7XG4gICAgaWYoa2V5LmNvbnN0cnVjdG9yID09PSBBcnJheSkge1xuICAgICAgcmV0dXJuIGBhWycke2tleVswXX0nXVsnJHtrZXlbMV19J10gPT09IGJbJyR7a2V5WzBdfSddWycke2tleVsxXX0nXWA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBgYVtcIiR7a2V5fVwiXSA9PT0gYltcIiR7a2V5fVwiXWA7XG4gICAgfVxuICB9KS5qb2luKFwiICYmIFwiKX07YClcbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVTdHJpbmdGbihrZXlzKSB7XG4gIGxldCBrZXlTdHJpbmdzID0gW107XG4gIGZvcihsZXQga2V5IG9mIGtleXMpIHtcbiAgICBpZihrZXkuY29uc3RydWN0b3IgPT09IEFycmF5KSB7XG4gICAgICBrZXlTdHJpbmdzLnB1c2goYGFbJyR7a2V5WzBdfSddWycke2tleVsxXX0nXWApO1xuICAgIH0gZWxzZSB7XG4gICAgICBrZXlTdHJpbmdzLnB1c2goYGFbJyR7a2V5fSddYCk7XG4gICAgfVxuICB9XG4gIGxldCBmaW5hbCA9IGtleVN0cmluZ3Muam9pbignICsgXCJ8XCIgKyAnKTtcbiAgcmV0dXJuIG5ldyBGdW5jdGlvbihcImFcIiwgIGByZXR1cm4gJHtmaW5hbH07YCk7XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlVW5wcm9qZWN0ZWRTb3J0ZXJDb2RlKHVucHJvamVjdGVkU2l6ZSwgc29ydHMpIHtcbiAgbGV0IGNvbmRpdGlvbnMgPSBbXTtcbiAgbGV0IHBhdGggPSBbXTtcbiAgbGV0IGRpc3RhbmNlID0gdW5wcm9qZWN0ZWRTaXplO1xuICBmb3IobGV0IHNvcnQgb2Ygc29ydHMpIHtcbiAgICBsZXQgY29uZGl0aW9uID0gXCJcIjtcbiAgICBmb3IobGV0IHByZXYgb2YgcGF0aCkge1xuICAgICAgbGV0IFt0YWJsZSwga2V5XSA9IHByZXY7XG4gICAgICBjb25kaXRpb24gKz0gYHVucHJvamVjdGVkW2otJHtkaXN0YW5jZSAtIHRhYmxlfV1bJyR7a2V5fSddID09PSBpdGVtJHt0YWJsZX1bJyR7a2V5fSddICYmIGA7XG4gICAgfVxuICAgIGxldCBbdGFibGUsIGtleSwgZGlyXSA9IHNvcnQ7XG4gICAgbGV0IG9wID0gXCI+XCI7XG4gICAgaWYoZGlyID09PSBcImRlc2NlbmRpbmdcIikge1xuICAgICAgb3AgPSBcIjxcIjtcbiAgICB9XG4gICAgY29uZGl0aW9uICs9IGB1bnByb2plY3RlZFtqLSR7ZGlzdGFuY2UgLSB0YWJsZX1dWycke2tleX0nXSAke29wfSBpdGVtJHt0YWJsZX1bJyR7a2V5fSddYDtcbiAgICBjb25kaXRpb25zLnB1c2goY29uZGl0aW9uKTtcbiAgICBwYXRoLnB1c2goc29ydCk7XG4gIH1cbiAgbGV0IGl0ZW1zID0gW107XG4gIGxldCByZXBvc2l0aW9uZWQgPSBbXTtcbiAgbGV0IGl0ZW1Bc3NpZ25tZW50cyA9IFtdO1xuICBmb3IobGV0IGl4ID0gMDsgaXggPCBkaXN0YW5jZTsgaXgrKykge1xuICAgIGl0ZW1zLnB1c2goYGl0ZW0ke2l4fSA9IHVucHJvamVjdGVkW2orJHtpeH1dYCk7XG4gICAgcmVwb3NpdGlvbmVkLnB1c2goYHVucHJvamVjdGVkW2orJHtpeH1dID0gdW5wcm9qZWN0ZWRbaiAtICR7ZGlzdGFuY2UgLSBpeH1dYCk7XG4gICAgaXRlbUFzc2lnbm1lbnRzLnB1c2goKGB1bnByb2plY3RlZFtqKyR7aXh9XSA9IGl0ZW0ke2l4fWApKTtcbiAgfVxuICByZXR1cm4gYGZvciAodmFyIGkgPSAwLCBsZW4gPSB1bnByb2plY3RlZC5sZW5ndGg7IGkgPCBsZW47IGkgKz0gJHtkaXN0YW5jZX0pIHtcbiAgICAgIHZhciBqID0gaSwgJHtpdGVtcy5qb2luKFwiLCBcIil9O1xuICAgICAgZm9yKDsgaiA+ICR7ZGlzdGFuY2UgLSAxfSAmJiAoJHtjb25kaXRpb25zLmpvaW4oXCIgfHwgXCIpfSk7IGogLT0gJHtkaXN0YW5jZX0pIHtcbiAgICAgICAgJHtyZXBvc2l0aW9uZWQuam9pbihcIjtcXG5cIil9XG4gICAgICB9XG4gICAgICAke2l0ZW1Bc3NpZ25tZW50cy5qb2luKFwiO1xcblwiKX1cbiAgfWA7XG59XG5cbmZ1bmN0aW9uIGdlbmVyYXRlQ29sbGVjdG9yKGtleXMpIHtcbiAgbGV0IGNvZGUgPSBgdmFyIHJ1bnRpbWUgPSB0aGlzO1xcbmA7XG4gIGxldCBpeCA9IDA7XG4gIGxldCBjaGVja3MgPSBcIlwiO1xuICBsZXQgcmVtb3ZlcyA9IFwidmFyIGN1ciA9IGluZGV4XCI7XG4gIGZvcihsZXQga2V5IG9mIGtleXMpIHtcbiAgICBpZihrZXkuY29uc3RydWN0b3IgPT09IEFycmF5KSB7XG4gICAgICByZW1vdmVzICs9IGBbcmVtb3ZlWycke2tleVswXX0nXVsnJHtrZXlbMV19J11dYDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVtb3ZlcyArPSBgW3JlbW92ZVsnJHtrZXl9J11dYDtcbiAgICB9XG4gIH1cbiAgcmVtb3ZlcyArPSBcIjtcXG5ydW50aW1lLnJlbW92ZUZhY3QoY3VyLCByZW1vdmUpO1wiO1xuICBmb3IobGV0IGtleSBvZiBrZXlzKSB7XG4gICAgaXgrKztcbiAgICBpZihrZXkuY29uc3RydWN0b3IgPT09IEFycmF5KSB7XG4gICAgICBjaGVja3MgKz0gYHZhbHVlID0gYWRkWycke2tleVswXX0nXVsnJHtrZXlbMV19J11cXG5gO1xuICAgIH0gZWxzZSB7XG4gICAgICBjaGVja3MgKz0gYHZhbHVlID0gYWRkWycke2tleX0nXVxcbmA7XG4gICAgfVxuICAgIGxldCBwYXRoID0gYGN1cnNvclt2YWx1ZV1gO1xuICAgIGNoZWNrcyArPSBgaWYoISR7cGF0aH0pICR7cGF0aH0gPSBgO1xuICAgIGlmKGl4ID09PSBrZXlzLmxlbmd0aCkge1xuICAgICAgY2hlY2tzICs9IFwiW11cXG5cIjtcbiAgICB9IGVsc2Uge1xuICAgICAgY2hlY2tzICs9IFwie31cXG5cIjtcbiAgICB9XG4gICAgY2hlY2tzICs9IGBjdXJzb3IgPSAke3BhdGh9XFxuYDtcbiAgfVxuICBjb2RlICs9IGBcbmZvcih2YXIgaXggPSAwLCBsZW4gPSByZW1vdmVzLmxlbmd0aDsgaXggPCBsZW47IGl4KyspIHtcbnZhciByZW1vdmUgPSByZW1vdmVzW2l4XTtcbiR7cmVtb3Zlc31cbn1cbmZvcih2YXIgaXggPSAwLCBsZW4gPSBhZGRzLmxlbmd0aDsgaXggPCBsZW47IGl4KyspIHtcbnZhciBhZGQgPSBhZGRzW2l4XTtcbnZhciBjdXJzb3IgPSBpbmRleDtcbnZhciB2YWx1ZTtcbiR7Y2hlY2tzfSAgY3Vyc29yLnB1c2goYWRkKTtcbn1cbnJldHVybiBpbmRleDtgXG4gIHJldHVybiAobmV3IEZ1bmN0aW9uKFwiaW5kZXhcIiwgXCJhZGRzXCIsIFwicmVtb3Zlc1wiLCBjb2RlKSkuYmluZChydW50aW1lKTtcbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVDb2xsZWN0b3IyKGtleXMpIHtcbiAgbGV0IGhhc2hQYXJ0cyA9IFtdO1xuICBmb3IobGV0IGtleSBvZiBrZXlzKSB7XG4gICAgaWYoa2V5LmNvbnN0cnVjdG9yID09PSBBcnJheSkge1xuICAgICAgaGFzaFBhcnRzLnB1c2goYGFkZFsnJHtrZXlbMF19J11bJyR7a2V5WzFdfSddYCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGhhc2hQYXJ0cy5wdXNoKGBhZGRbJyR7a2V5fSddYCk7XG4gICAgfVxuICB9XG4gIGxldCBjb2RlID0gYFxuICAgIHZhciBpeENhY2hlID0gY2FjaGUuaXg7XG4gICAgdmFyIGlkQ2FjaGUgPSBjYWNoZS5pZDtcbiAgICBmb3IodmFyIGl4ID0gMCwgbGVuID0gcmVtb3Zlcy5sZW5ndGg7IGl4IDwgbGVuOyBpeCsrKSB7XG4gICAgICB2YXIgcmVtb3ZlID0gcmVtb3Zlc1tpeF07XG4gICAgICB2YXIgaWQgPSByZW1vdmUuX19pZDtcbiAgICAgIHZhciBrZXkgPSBpZENhY2hlW2lkXTtcbiAgICAgIHZhciBmYWN0SXggPSBpeENhY2hlW2lkXTtcbiAgICAgIHZhciBmYWN0cyA9IGluZGV4W2tleV07XG4gICAgICAvL3N3YXAgdGhlIGxhc3QgZmFjdCB3aXRoIHRoaXMgb25lIHRvIHByZXZlbnQgaG9sZXNcbiAgICAgIHZhciBsYXN0RmFjdCA9IGZhY3RzLnBvcCgpO1xuICAgICAgaWYobGFzdEZhY3QgJiYgbGFzdEZhY3QuX19pZCAhPT0gcmVtb3ZlLl9faWQpIHtcbiAgICAgICAgZmFjdHNbZmFjdEl4XSA9IGxhc3RGYWN0O1xuICAgICAgICBpeENhY2hlW2xhc3RGYWN0Ll9faWRdID0gZmFjdEl4O1xuICAgICAgfSBlbHNlIGlmKGZhY3RzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBkZWxldGUgaW5kZXhba2V5XTtcbiAgICAgIH1cbiAgICAgIGRlbGV0ZSBpZENhY2hlW2lkXTtcbiAgICAgIGRlbGV0ZSBpeENhY2hlW2lkXTtcbiAgICB9XG4gICAgZm9yKHZhciBpeCA9IDAsIGxlbiA9IGFkZHMubGVuZ3RoOyBpeCA8IGxlbjsgaXgrKykge1xuICAgICAgdmFyIGFkZCA9IGFkZHNbaXhdO1xuICAgICAgdmFyIGlkID0gYWRkLl9faWQ7XG4gICAgICB2YXIga2V5ID0gaWRDYWNoZVtpZF0gPSAke2hhc2hQYXJ0cy5qb2luKFwiICsgJ3wnICsgXCIpfTtcbiAgICAgIGlmKGluZGV4W2tleV0gPT09IHVuZGVmaW5lZCkgaW5kZXhba2V5XSA9IFtdO1xuICAgICAgdmFyIGFyciA9IGluZGV4W2tleV07XG4gICAgICBpeENhY2hlW2lkXSA9IGFyci5sZW5ndGg7XG4gICAgICBhcnIucHVzaChhZGQpO1xuICAgIH1cbiAgICByZXR1cm4gaW5kZXg7YDtcbiAgICByZXR1cm4gbmV3IEZ1bmN0aW9uKFwiaW5kZXhcIiwgXCJhZGRzXCIsIFwicmVtb3Zlc1wiLCBcImNhY2hlXCIsIGNvZGUpO1xufVxuXG5mdW5jdGlvbiBtZXJnZUFycmF5cyhhcywgYnMpIHtcbiAgbGV0IGl4ID0gYXMubGVuZ3RoO1xuICBsZXQgc3RhcnQgPSBpeDtcbiAgZm9yKGxldCBiIG9mIGJzKSB7XG4gICAgYXNbaXhdID0gYnNbaXggLSBzdGFydF07XG4gICAgaXgrKztcbiAgfVxuICByZXR1cm4gYXM7XG59XG5cbmV4cG9ydCBjbGFzcyBEaWZmIHtcbiAgdGFibGVzO1xuICBsZW5ndGg7XG4gIGl4ZXI7XG4gIG1ldGE7XG4gIGNvbnN0cnVjdG9yKGl4ZXIpIHtcbiAgICB0aGlzLml4ZXIgPSBpeGVyO1xuICAgIHRoaXMudGFibGVzID0ge307XG4gICAgdGhpcy5sZW5ndGggPSAwO1xuICAgIHRoaXMubWV0YSA9IHt9O1xuICB9XG4gIGVuc3VyZVRhYmxlKHRhYmxlKSB7XG4gICAgbGV0IHRhYmxlRGlmZiA9IHRoaXMudGFibGVzW3RhYmxlXTtcbiAgICBpZighdGFibGVEaWZmKSB7XG4gICAgICB0YWJsZURpZmYgPSB0aGlzLnRhYmxlc1t0YWJsZV0gPSB7YWRkczogW10sIHJlbW92ZXM6IFtdfTtcbiAgICB9XG4gICAgcmV0dXJuIHRhYmxlRGlmZjtcbiAgfVxuICBhZGQodGFibGUsIG9iaikge1xuICAgIGxldCB0YWJsZURpZmYgPSB0aGlzLmVuc3VyZVRhYmxlKHRhYmxlKTtcbiAgICB0aGlzLmxlbmd0aCsrO1xuICAgIHRhYmxlRGlmZi5hZGRzLnB1c2gob2JqKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBhZGRNYW55KHRhYmxlLCBvYmpzKSB7XG4gICAgbGV0IHRhYmxlRGlmZiA9IHRoaXMuZW5zdXJlVGFibGUodGFibGUpO1xuICAgIHRoaXMubGVuZ3RoICs9IG9ianMubGVuZ3RoO1xuICAgIG1lcmdlQXJyYXlzKHRhYmxlRGlmZi5hZGRzLCBvYmpzKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICByZW1vdmVGYWN0cyh0YWJsZSwgb2Jqcykge1xuICAgIGxldCB0YWJsZURpZmYgPSB0aGlzLmVuc3VyZVRhYmxlKHRhYmxlKTtcbiAgICB0aGlzLmxlbmd0aCArPSBvYmpzLmxlbmd0aDtcbiAgICBtZXJnZUFycmF5cyh0YWJsZURpZmYucmVtb3Zlcywgb2Jqcyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgcmVtb3ZlKHRhYmxlLCBxdWVyeT8pIHtcbiAgICBsZXQgdGFibGVEaWZmID0gdGhpcy5lbnN1cmVUYWJsZSh0YWJsZSk7XG4gICAgbGV0IGZvdW5kID0gdGhpcy5peGVyLmZpbmQodGFibGUsIHF1ZXJ5KTtcbiAgICB0aGlzLmxlbmd0aCArPSBmb3VuZC5sZW5ndGg7XG4gICAgbWVyZ2VBcnJheXModGFibGVEaWZmLnJlbW92ZXMsIGZvdW5kKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBtZXJnZShkaWZmKSB7XG4gICAgZm9yKGxldCB0YWJsZSBpbiBkaWZmLnRhYmxlcykge1xuICAgICAgbGV0IHRhYmxlRGlmZiA9IGRpZmYudGFibGVzW3RhYmxlXTtcbiAgICAgIHRoaXMuYWRkTWFueSh0YWJsZSwgdGFibGVEaWZmLmFkZHMpO1xuICAgICAgdGhpcy5yZW1vdmVGYWN0cyh0YWJsZSwgdGFibGVEaWZmLnJlbW92ZXMpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICByZXZlcnNlKCkge1xuICAgIGxldCByZXZlcnNlZCA9IG5ldyBEaWZmKHRoaXMuaXhlcik7XG4gICAgZm9yKGxldCB0YWJsZSBpbiB0aGlzLnRhYmxlcykge1xuICAgICAgbGV0IGRpZmYgPSB0aGlzLnRhYmxlc1t0YWJsZV07XG4gICAgICByZXZlcnNlZC5hZGRNYW55KHRhYmxlLCBkaWZmLnJlbW92ZXMpO1xuICAgICAgcmV2ZXJzZWQucmVtb3ZlRmFjdHModGFibGUsIGRpZmYuYWRkcyk7XG4gICAgfVxuICAgIHJldHVybiByZXZlcnNlZDtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgSW5kZXhlciB7XG4gIHRhYmxlcztcbiAgZ2xvYmFsQ291bnQ7XG4gIGVkYlRhYmxlcztcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy50YWJsZXMgPSB7fTtcbiAgICB0aGlzLmdsb2JhbENvdW50ID0gMDtcbiAgICB0aGlzLmVkYlRhYmxlcyA9IHt9O1xuICB9XG4gIGFkZFRhYmxlKG5hbWUsIGtleXMgPSBbXSkge1xuICAgIGxldCB0YWJsZSA9IHRoaXMudGFibGVzW25hbWVdO1xuICAgIGtleXMgPSBrZXlzLmZpbHRlcigoa2V5KSA9PiBrZXkgIT09IFwiX19pZFwiKTtcbiAgICBpZih0YWJsZSAmJiBrZXlzLmxlbmd0aCkge1xuICAgICAgdGFibGUuZmllbGRzID0ga2V5cztcbiAgICAgIHRhYmxlLnN0cmluZ2lmeSA9IGdlbmVyYXRlU3RyaW5nRm4oa2V5cyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRhYmxlID0gdGhpcy50YWJsZXNbbmFtZV0gPSB7dGFibGU6IFtdLCBoYXNoVG9JeDoge30sIGZhY3RIYXNoOiB7fSwgaW5kZXhlczoge30sIHRyaWdnZXJzOiB7fSwgZmllbGRzOiBrZXlzLCBzdHJpbmdpZnk6IGdlbmVyYXRlU3RyaW5nRm4oa2V5cyksIGtleUxvb2t1cDoge319O1xuICAgICAgdGhpcy5lZGJUYWJsZXNbbmFtZV0gPSB0cnVlO1xuICAgIH1cbiAgICBmb3IobGV0IGtleSBvZiBrZXlzKSB7XG4gICAgICBpZihrZXkuY29uc3RydWN0b3IgPT09IEFycmF5KSB7XG4gICAgICAgIHRhYmxlLmtleUxvb2t1cFtrZXlbMF1dID0ga2V5O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGFibGUua2V5TG9va3VwW2tleV0gPSBrZXk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0YWJsZTtcbiAgfVxuICBjbGVhclRhYmxlKG5hbWUpIHtcbiAgICBsZXQgdGFibGUgPSB0aGlzLnRhYmxlc1tuYW1lXTtcbiAgICBpZighdGFibGUpIHJldHVybjtcblxuICAgIHRhYmxlLnRhYmxlID0gW107XG4gICAgdGFibGUuZmFjdEhhc2ggPSB7fTtcbiAgICBmb3IobGV0IGluZGV4TmFtZSBpbiB0YWJsZS5pbmRleGVzKSB7XG4gICAgICB0YWJsZS5pbmRleGVzW2luZGV4TmFtZV0uaW5kZXggPSB7fTtcbiAgICAgIHRhYmxlLmluZGV4ZXNbaW5kZXhOYW1lXS5jYWNoZSA9IHtpZDoge30sIGl4OiB7fX07XG4gICAgfVxuICB9XG4gIHVwZGF0ZVRhYmxlKHRhYmxlSWQsIGFkZHMsIHJlbW92ZXMpIHtcbiAgICBsZXQgdGFibGUgPSB0aGlzLnRhYmxlc1t0YWJsZUlkXTtcbiAgICBpZighdGFibGUgfHwgIXRhYmxlLmZpZWxkcy5sZW5ndGgpIHtcbiAgICAgIGxldCBleGFtcGxlID0gYWRkc1swXSB8fCByZW1vdmVzWzBdO1xuICAgICAgdGFibGUgPSB0aGlzLmFkZFRhYmxlKHRhYmxlSWQsIE9iamVjdC5rZXlzKGV4YW1wbGUpKTtcbiAgICB9XG4gICAgbGV0IHN0cmluZ2lmeSA9IHRhYmxlLnN0cmluZ2lmeTtcbiAgICBsZXQgZmFjdHMgPSB0YWJsZS50YWJsZTtcbiAgICBsZXQgZmFjdEhhc2ggPSB0YWJsZS5mYWN0SGFzaDtcbiAgICBsZXQgaGFzaFRvSXggPSB0YWJsZS5oYXNoVG9JeDtcbiAgICBsZXQgbG9jYWxIYXNoID0ge307XG4gICAgbGV0IGhhc2hUb0ZhY3QgPSB7fTtcbiAgICBsZXQgaGFzaGVzID0gW107XG4gICAgZm9yKGxldCBhZGQgb2YgYWRkcykge1xuICAgICAgbGV0IGhhc2ggPSBhZGQuX19pZCB8fCBzdHJpbmdpZnkoYWRkKTtcbiAgICAgIGlmKGxvY2FsSGFzaFtoYXNoXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGxvY2FsSGFzaFtoYXNoXSA9IDE7XG4gICAgICAgIGhhc2hUb0ZhY3RbaGFzaF0gPSBhZGQ7XG4gICAgICAgIGhhc2hlcy5wdXNoKGhhc2gpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbG9jYWxIYXNoW2hhc2hdKys7XG4gICAgICB9XG4gICAgICBhZGQuX19pZCA9IGhhc2g7XG4gICAgfVxuICAgIGZvcihsZXQgcmVtb3ZlIG9mIHJlbW92ZXMpIHtcbiAgICAgIGxldCBoYXNoID0gcmVtb3ZlLl9faWQgfHwgc3RyaW5naWZ5KHJlbW92ZSk7XG4gICAgICBpZihsb2NhbEhhc2hbaGFzaF0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBsb2NhbEhhc2hbaGFzaF0gPSAtMTtcbiAgICAgICAgaGFzaFRvRmFjdFtoYXNoXSA9IHJlbW92ZTtcbiAgICAgICAgaGFzaGVzLnB1c2goaGFzaCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsb2NhbEhhc2hbaGFzaF0tLTtcbiAgICAgIH1cbiAgICAgIHJlbW92ZS5fX2lkID0gaGFzaDtcbiAgICB9XG4gICAgbGV0IHJlYWxBZGRzID0gW107XG4gICAgbGV0IHJlYWxSZW1vdmVzID0gW107XG4gICAgZm9yKGxldCBoYXNoIG9mIGhhc2hlcykge1xuICAgICAgbGV0IGNvdW50ID0gbG9jYWxIYXNoW2hhc2hdO1xuICAgICAgaWYoY291bnQgPiAwICYmICFmYWN0SGFzaFtoYXNoXSkge1xuICAgICAgICBsZXQgZmFjdCA9IGhhc2hUb0ZhY3RbaGFzaF07XG4gICAgICAgIHJlYWxBZGRzLnB1c2goZmFjdCk7XG4gICAgICAgIGZhY3RzLnB1c2goZmFjdCk7XG4gICAgICAgIGZhY3RIYXNoW2hhc2hdID0gZmFjdDtcbiAgICAgICAgaGFzaFRvSXhbaGFzaF0gPSBmYWN0cy5sZW5ndGggLSAxO1xuICAgICAgfSBlbHNlIGlmKGNvdW50IDwgMCAmJiBmYWN0SGFzaFtoYXNoXSkge1xuICAgICAgICBsZXQgZmFjdCA9IGhhc2hUb0ZhY3RbaGFzaF07XG4gICAgICAgIGxldCBpeCA9IGhhc2hUb0l4W2hhc2hdO1xuICAgICAgICAvL3N3YXAgdGhlIGxhc3QgZmFjdCB3aXRoIHRoaXMgb25lIHRvIHByZXZlbnQgaG9sZXNcbiAgICAgICAgbGV0IGxhc3RGYWN0ID0gZmFjdHMucG9wKCk7XG4gICAgICAgIGlmKGxhc3RGYWN0ICYmIGxhc3RGYWN0Ll9faWQgIT09IGZhY3QuX19pZCkge1xuICAgICAgICAgIGZhY3RzW2l4XSA9IGxhc3RGYWN0O1xuICAgICAgICAgIGhhc2hUb0l4W2xhc3RGYWN0Ll9faWRdID0gaXg7XG4gICAgICAgIH1cbiAgICAgICAgcmVhbFJlbW92ZXMucHVzaChmYWN0KTtcbiAgICAgICAgZGVsZXRlIGZhY3RIYXNoW2hhc2hdO1xuICAgICAgICBkZWxldGUgaGFzaFRvSXhbaGFzaF07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7YWRkczpyZWFsQWRkcywgcmVtb3ZlczpyZWFsUmVtb3Zlc307XG4gIH1cblxuICBjb2xsZWN0b3Ioa2V5cykge1xuICAgIHJldHVybiB7XG4gICAgICBpbmRleDoge30sXG4gICAgICBjYWNoZToge2lkOiB7fSwgaXg6IHt9fSxcbiAgICAgIGhhc2hlcjogZ2VuZXJhdGVTdHJpbmdGbihrZXlzKSxcbiAgICAgIGNvbGxlY3Q6IGdlbmVyYXRlQ29sbGVjdG9yMihrZXlzKSxcbiAgICB9XG4gIH1cbiAgZmFjdFRvSW5kZXgodGFibGUsIGZhY3QpIHtcbiAgICBsZXQga2V5cyA9IE9iamVjdC5rZXlzKGZhY3QpO1xuICAgIGlmKCFrZXlzLmxlbmd0aCkgcmV0dXJuIHRhYmxlLnRhYmxlLnNsaWNlKCk7XG4gICAgbGV0IGluZGV4ID0gdGhpcy5pbmRleCh0YWJsZSwga2V5cyk7XG4gICAgbGV0IHJlc3VsdCA9IGluZGV4LmluZGV4W2luZGV4Lmhhc2hlcihmYWN0KV07XG4gICAgaWYocmVzdWx0KSB7XG4gICAgICByZXR1cm4gcmVzdWx0LnNsaWNlKCk7XG4gICAgfVxuICAgIHJldHVybiBbXTtcbiAgfVxuICBleGVjRGlmZihkaWZmOiBEaWZmKToge3RyaWdnZXJzOiBhbnksIHJlYWxEaWZmczogYW55fSB7XG4gICAgbGV0IHRyaWdnZXJzID0ge307XG4gICAgbGV0IHJlYWxEaWZmcyA9IHt9O1xuICAgIGxldCB0YWJsZUlkcyA9IE9iamVjdC5rZXlzKGRpZmYudGFibGVzKTtcbiAgICBmb3IobGV0IHRhYmxlSWQgb2YgdGFibGVJZHMpIHtcbiAgICAgIGxldCB0YWJsZURpZmYgPSBkaWZmLnRhYmxlc1t0YWJsZUlkXTtcbiAgICAgIGlmKHRhYmxlRGlmZi5hZGRzLmxlbmd0aCA9PT0gMCAmJiB0YWJsZURpZmYucmVtb3Zlcy5sZW5ndGggPT09IDApIGNvbnRpbnVlO1xuICAgICAgbGV0IHJlYWxEaWZmID0gdGhpcy51cGRhdGVUYWJsZSh0YWJsZUlkLCB0YWJsZURpZmYuYWRkcywgdGFibGVEaWZmLnJlbW92ZXMpO1xuICAgICAgLy8gZ28gdGhyb3VnaCBhbGwgdGhlIGluZGV4ZXMgYW5kIHVwZGF0ZSB0aGVtLlxuICAgICAgbGV0IHRhYmxlID0gdGhpcy50YWJsZXNbdGFibGVJZF07XG4gICAgICBsZXQgaW5kZXhlcyA9IE9iamVjdC5rZXlzKHRhYmxlLmluZGV4ZXMpO1xuICAgICAgZm9yKGxldCBpbmRleE5hbWUgb2YgaW5kZXhlcykge1xuICAgICAgICBsZXQgaW5kZXggPSB0YWJsZS5pbmRleGVzW2luZGV4TmFtZV07XG4gICAgICAgIGluZGV4LmNvbGxlY3QoaW5kZXguaW5kZXgsIHJlYWxEaWZmLmFkZHMsIHJlYWxEaWZmLnJlbW92ZXMsIGluZGV4LmNhY2hlKTtcbiAgICAgIH1cbiAgICAgIGxldCBjdXJUcmlnZ2VycyA9IE9iamVjdC5rZXlzKHRhYmxlLnRyaWdnZXJzKTtcbiAgICAgIGZvcihsZXQgdHJpZ2dlck5hbWUgb2YgY3VyVHJpZ2dlcnMpIHtcbiAgICAgICAgbGV0IHRyaWdnZXIgPSB0YWJsZS50cmlnZ2Vyc1t0cmlnZ2VyTmFtZV07XG4gICAgICAgIHRyaWdnZXJzW3RyaWdnZXJOYW1lXSA9IHRyaWdnZXI7XG4gICAgICB9XG4gICAgICByZWFsRGlmZnNbdGFibGVJZF0gPSByZWFsRGlmZjtcbiAgICB9XG4gICAgcmV0dXJuIHt0cmlnZ2VycywgcmVhbERpZmZzfTtcbiAgfVxuICBleGVjVHJpZ2dlcih0cmlnZ2VyKSB7XG4gICAgbGV0IHRhYmxlID0gdGhpcy50YWJsZSh0cmlnZ2VyLm5hbWUpXG4gICAgLy8gc2luY2Ugdmlld3MgbWlnaHQgYmUgY2hhbmdlZCBkdXJpbmcgdGhlIHRyaWdnZXJpbmcgcHJvY2Vzcywgd2Ugd2FudCB0byBmYXZvclxuICAgIC8vIGp1c3QgdXNpbmcgdGhlIHZpZXcgaXRzZWxmIGFzIHRoZSB0cmlnZ2VyIGlmIGl0IGlzIG9uZS4gT3RoZXJ3aXNlLCB3ZSB1c2UgdGhlXG4gICAgLy8gdHJpZ2dlcidzIGV4ZWMgZnVuY3Rpb24uIFRoaXMgZW5zdXJlcyB0aGF0IGlmIGEgdmlldyBpcyByZWNvbXBpbGVkIGFuZCBhZGRlZFxuICAgIC8vIHRoYXQgYW55IGFscmVhZHkgcXVldWVkIHRyaWdnZXJzIHdpbGwgdXNlIHRoZSB1cGRhdGVkIHZlcnNpb24gb2YgdGhlIHZpZXcgaW5zdGVhZFxuICAgIC8vIG9mIHRoZSBvbGQgcXVldWVkIG9uZS5cbiAgICBsZXQge3Jlc3VsdHMgPSB1bmRlZmluZWQsIHVucHJvamVjdGVkID0gdW5kZWZpbmVkfSA9ICh0YWJsZS52aWV3ID8gdGFibGUudmlldy5leGVjKCkgOiB0cmlnZ2VyLmV4ZWModGhpcykpIHx8IHt9O1xuICAgIGlmKCFyZXN1bHRzKSByZXR1cm47XG4gICAgbGV0IHByZXZSZXN1bHRzID0gdGFibGUuZmFjdEhhc2g7XG4gICAgbGV0IHByZXZIYXNoZXMgPSBPYmplY3Qua2V5cyhwcmV2UmVzdWx0cyk7XG4gICAgdGFibGUudW5wcm9qZWN0ZWQgPSB1bnByb2plY3RlZDtcbiAgICBpZihyZXN1bHRzKSB7XG4gICAgICBsZXQgZGlmZiA9IG5ldyBEaWZmKHRoaXMpO1xuICAgICAgdGhpcy5jbGVhclRhYmxlKHRyaWdnZXIubmFtZSk7XG4gICAgICBkaWZmLmFkZE1hbnkodHJpZ2dlci5uYW1lLCByZXN1bHRzKTtcbiAgICAgIGxldCB7dHJpZ2dlcnN9ID0gdGhpcy5leGVjRGlmZihkaWZmKTtcbiAgICAgIGxldCBuZXdIYXNoZXMgPSB0YWJsZS5mYWN0SGFzaDtcbiAgICAgIGlmKHByZXZIYXNoZXMubGVuZ3RoID09PSBPYmplY3Qua2V5cyhuZXdIYXNoZXMpLmxlbmd0aCkge1xuICAgICAgICBsZXQgc2FtZSA9IHRydWU7XG4gICAgICAgIGZvcihsZXQgaGFzaCBvZiBwcmV2SGFzaGVzKSB7XG4gICAgICAgICAgaWYoIW5ld0hhc2hlc1toYXNoXSkge1xuICAgICAgICAgICAgc2FtZSA9IGZhbHNlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzYW1lID8gdW5kZWZpbmVkIDogdHJpZ2dlcnM7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdHJpZ2dlcnM7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybjtcbiAgfVxuICB0cmFuc2l0aXZlbHlDbGVhclRyaWdnZXJzKHN0YXJ0aW5nVHJpZ2dlcnMpIHtcbiAgICBsZXQgY2xlYXJlZCA9IHt9O1xuICAgIGxldCByZW1haW5pbmcgPSBPYmplY3Qua2V5cyhzdGFydGluZ1RyaWdnZXJzKTtcblxuICAgIGZvcihsZXQgaXggPSAwOyBpeCA8IHJlbWFpbmluZy5sZW5ndGg7IGl4KyspIHtcbiAgICAgIGxldCB0cmlnZ2VyID0gcmVtYWluaW5nW2l4XTtcbiAgICAgIGlmKGNsZWFyZWRbdHJpZ2dlcl0pIGNvbnRpbnVlO1xuICAgICAgdGhpcy5jbGVhclRhYmxlKHRyaWdnZXIpO1xuICAgICAgY2xlYXJlZFt0cmlnZ2VyXSA9IHRydWU7XG4gICAgICByZW1haW5pbmcucHVzaC5hcHBseShyZW1haW5pbmcsIE9iamVjdC5rZXlzKHRoaXMudGFibGUodHJpZ2dlcikudHJpZ2dlcnMpKTtcbiAgICAgIC8vIGNvbnNvbGUubG9nKFwiQ0xFQVJFRDogXCIsIHRyaWdnZXIpO1xuICAgIH1cbiAgICByZXR1cm4gY2xlYXJlZDtcbiAgfVxuICBleGVjVHJpZ2dlcnModHJpZ2dlcnMpIHtcbiAgICBsZXQgbmV3VHJpZ2dlcnMgPSB7fTtcbiAgICBsZXQgcmV0cmlnZ2VyID0gZmFsc2U7XG4gICAgZm9yKGxldCB0cmlnZ2VyTmFtZSBpbiB0cmlnZ2Vycykge1xuICAgICAgLy8gY29uc29sZS5sb2coXCJDYWxsaW5nOlwiLCB0cmlnZ2VyTmFtZSk7XG4gICAgICBsZXQgdHJpZ2dlciA9IHRyaWdnZXJzW3RyaWdnZXJOYW1lXTtcbiAgICAgIGxldCBuZXh0Um91bmQgPSB0aGlzLmV4ZWNUcmlnZ2VyKHRyaWdnZXIpO1xuICAgICAgaWYobmV4dFJvdW5kKSB7XG4gICAgICAgIHJldHJpZ2dlciA9IHRydWU7XG4gICAgICAgIGZvcihsZXQgdHJpZ2dlciBpbiBuZXh0Um91bmQpIHtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIlF1ZXVpbmc6XCIsIHRyaWdnZXIpO1xuICAgICAgICAgIG5ld1RyaWdnZXJzW3RyaWdnZXJdID0gbmV4dFJvdW5kW3RyaWdnZXJdO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIGlmKHJldHJpZ2dlcikge1xuICAgICAgcmV0dXJuIG5ld1RyaWdnZXJzO1xuICAgIH1cbiAgfVxuICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBJbmRleGVyIFB1YmxpYyBBUElcbiAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgc2VyaWFsaXplKGFzT2JqZWN0Pykge1xuICAgIGxldCBkdW1wID0ge307XG4gICAgZm9yKGxldCB0YWJsZU5hbWUgaW4gdGhpcy50YWJsZXMpIHtcbiAgICAgIGxldCB0YWJsZSA9IHRoaXMudGFibGVzW3RhYmxlTmFtZV07XG4gICAgICBpZighdGFibGUuaXNWaWV3KSB7XG4gICAgICAgIGR1bXBbdGFibGVOYW1lXSA9IHRhYmxlLnRhYmxlO1xuICAgICAgfVxuICAgIH1cbiAgICBpZihhc09iamVjdCkge1xuICAgICAgcmV0dXJuIGR1bXA7XG4gICAgfVxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShkdW1wKTtcbiAgfVxuICBsb2FkKHNlcmlhbGl6ZWQpIHtcbiAgICBsZXQgZHVtcCA9IEpTT04ucGFyc2Uoc2VyaWFsaXplZCk7XG4gICAgbGV0IGRpZmYgPSB0aGlzLmRpZmYoKTtcbiAgICBmb3IobGV0IHRhYmxlTmFtZSBpbiBkdW1wKSB7XG4gICAgICBkaWZmLmFkZE1hbnkodGFibGVOYW1lLCBkdW1wW3RhYmxlTmFtZV0pO1xuICAgIH1cbiAgICBpZihJTkNSRU1FTlRBTCkge1xuICAgICAgdGhpcy5hcHBseURpZmZJbmNyZW1lbnRhbChkaWZmKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5hcHBseURpZmYoZGlmZik7XG4gICAgfVxuICB9XG4gIGRpZmYoKSB7XG4gICAgcmV0dXJuIG5ldyBEaWZmKHRoaXMpO1xuICB9XG4gIGFwcGx5RGlmZihkaWZmOkRpZmYpIHtcbiAgICBpZihJTkNSRU1FTlRBTCkge1xuICAgICAgcmV0dXJuIHRoaXMuYXBwbHlEaWZmSW5jcmVtZW50YWwoZGlmZik7XG4gICAgfVxuICAgIGxldCB7dHJpZ2dlcnMsIHJlYWxEaWZmc30gPSB0aGlzLmV4ZWNEaWZmKGRpZmYpO1xuICAgIGxldCBjbGVhcmVkO1xuICAgIGxldCByb3VuZCA9IDA7XG4gICAgaWYodHJpZ2dlcnMpIGNsZWFyZWQgPSB0aGlzLnRyYW5zaXRpdmVseUNsZWFyVHJpZ2dlcnModHJpZ2dlcnMpO1xuICAgIHdoaWxlKHRyaWdnZXJzKSB7XG4gICAgICBmb3IobGV0IHRyaWdnZXIgaW4gdHJpZ2dlcnMpIHtcbiAgICAgICAgY2xlYXJlZFt0cmlnZ2VyXSA9IGZhbHNlO1xuICAgICAgfVxuICAgICAgLy8gY29uc29sZS5ncm91cChgUk9VTkQgJHtyb3VuZH1gKTtcbiAgICAgIHRyaWdnZXJzID0gdGhpcy5leGVjVHJpZ2dlcnModHJpZ2dlcnMpO1xuICAgICAgcm91bmQrKztcbiAgICAgIC8vIGNvbnNvbGUuZ3JvdXBFbmQoKTtcbiAgICB9XG4gICAgZm9yKGxldCB0cmlnZ2VyIG9mIE9iamVjdC5rZXlzKGNsZWFyZWQpKSB7XG4gICAgICBpZighY2xlYXJlZFt0cmlnZ2VyXSkgY29udGludWU7XG4gICAgICBsZXQgdmlldyA9IHRoaXMudGFibGUodHJpZ2dlcikudmlldztcbiAgICAgIGlmKHZpZXcpIHtcbiAgICAgICAgdGhpcy5leGVjVHJpZ2dlcih2aWV3KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgdGFibGUodGFibGVJZCkge1xuICAgIGxldCB0YWJsZSA9IHRoaXMudGFibGVzW3RhYmxlSWRdO1xuICAgIGlmKHRhYmxlKSByZXR1cm4gdGFibGU7XG4gICAgcmV0dXJuIHRoaXMuYWRkVGFibGUodGFibGVJZCk7XG4gIH1cbiAgaW5kZXgodGFibGVPcklkOnN0cmluZ3x7fSwga2V5czphbnlbXSkge1xuICAgIGxldCB0YWJsZTtcbiAgICBpZih0eXBlb2YgdGFibGVPcklkID09PSBcInN0cmluZ1wiKSB0YWJsZSA9IHRoaXMudGFibGUodGFibGVPcklkKTtcbiAgICBlbHNlIHRhYmxlID0gdGFibGVPcklkO1xuICAgIGtleXMuc29ydCgpO1xuICAgIGxldCBpbmRleE5hbWUgPSBrZXlzLmZpbHRlcigoa2V5KSA9PiBrZXkgIT09IFwiX19pZFwiKS5qb2luKFwifFwiKTtcbiAgICBsZXQgaW5kZXggPSB0YWJsZS5pbmRleGVzW2luZGV4TmFtZV07XG4gICAgaWYoIWluZGV4KSB7XG4gICAgICBsZXQgdGFibGVLZXlzID0gW107XG4gICAgICBmb3IobGV0IGtleSBvZiBrZXlzKSB7XG4gICAgICAgIHRhYmxlS2V5cy5wdXNoKHRhYmxlLmtleUxvb2t1cFtrZXldIHx8IGtleSk7XG4gICAgICB9XG4gICAgICBpbmRleCA9IHRhYmxlLmluZGV4ZXNbaW5kZXhOYW1lXSA9IHRoaXMuY29sbGVjdG9yKHRhYmxlS2V5cyk7XG4gICAgICBpbmRleC5jb2xsZWN0KGluZGV4LmluZGV4LCB0YWJsZS50YWJsZSwgW10sIGluZGV4LmNhY2hlKTtcbiAgICB9XG4gICAgcmV0dXJuIGluZGV4O1xuICB9XG4gIGZpbmQodGFibGVJZCwgcXVlcnk/KSB7XG4gICAgbGV0IHRhYmxlID0gdGhpcy50YWJsZXNbdGFibGVJZF07XG4gICAgaWYoIXRhYmxlKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfSBlbHNlIGlmKCFxdWVyeSkge1xuICAgICAgcmV0dXJuIHRhYmxlLnRhYmxlLnNsaWNlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLmZhY3RUb0luZGV4KHRhYmxlLCBxdWVyeSk7XG4gICAgfVxuICB9XG4gIGZpbmRPbmUodGFibGVJZCwgcXVlcnk/KSB7XG4gICAgcmV0dXJuIHRoaXMuZmluZCh0YWJsZUlkLCBxdWVyeSlbMF07XG4gIH1cbiAgcXVlcnkobmFtZSA9IFwidW5rbm93blwiKSB7XG4gICAgcmV0dXJuIG5ldyBRdWVyeSh0aGlzLCBuYW1lKTtcbiAgfVxuICB1bmlvbihuYW1lKSB7XG4gICAgcmV0dXJuIG5ldyBVbmlvbih0aGlzLCBuYW1lKTtcbiAgfVxuICB0cmlnZ2VyKG5hbWU6c3RyaW5nLCB0YWJsZTpzdHJpbmd8c3RyaW5nW10sIGV4ZWM6KGl4ZXI6SW5kZXhlcikgPT4gdm9pZCwgZXhlY0luY3JlbWVudGFsPzooY2hhbmdlczphbnkpID0+IGFueSkge1xuICAgIGxldCB0YWJsZXMgPSAodHlwZW9mIHRhYmxlID09PSBcInN0cmluZ1wiKSA/IFt0YWJsZV0gOiB0YWJsZTtcbiAgICBsZXQgdHJpZ2dlciA9IHtuYW1lLCB0YWJsZXMsIGV4ZWMsIGV4ZWNJbmNyZW1lbnRhbH07XG4gICAgZm9yKGxldCB0YWJsZUlkIG9mIHRhYmxlcykge1xuICAgICAgbGV0IHRhYmxlID0gdGhpcy50YWJsZSh0YWJsZUlkKTtcbiAgICAgIHRhYmxlLnRyaWdnZXJzW25hbWVdID0gdHJpZ2dlcjtcbiAgICB9XG4gICAgaWYoIUlOQ1JFTUVOVEFMKSB7XG4gICAgICBsZXQgbmV4dFJvdW5kID0gdGhpcy5leGVjVHJpZ2dlcih0cmlnZ2VyKTtcbiAgICAgIHdoaWxlKG5leHRSb3VuZCkge1xuICAgICAgICBuZXh0Um91bmQgPSB0aGlzLmV4ZWNUcmlnZ2VycyhuZXh0Um91bmQpO1xuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYoIXRhYmxlcy5sZW5ndGgpIHsgcmV0dXJuIGV4ZWModGhpcyk7IH1cbiAgICAgIGxldCBpbml0aWFsID0ge1t0YWJsZXNbMF1dOiB7YWRkczogdGhpcy50YWJsZXNbdGFibGVzWzBdXS50YWJsZSwgcmVtb3ZlczogW119fTtcbiAgICAgIGxldCB7dHJpZ2dlcnMsIGNoYW5nZXN9ID0gdGhpcy5leGVjVHJpZ2dlckluY3JlbWVudGFsKHRyaWdnZXIsIGluaXRpYWwpO1xuICAgICAgd2hpbGUodHJpZ2dlcnMpIHtcbiAgICAgICAgbGV0IHJlc3VsdHMgPSB0aGlzLmV4ZWNUcmlnZ2Vyc0luY3JlbWVudGFsKHRyaWdnZXJzLCBjaGFuZ2VzKTtcbiAgICAgICAgaWYoIXJlc3VsdHMpIGJyZWFrXG4gICAgICAgIHRyaWdnZXJzID0gcmVzdWx0cy50cmlnZ2VycztcbiAgICAgICAgY2hhbmdlcyA9IHJlc3VsdHMuY2hhbmdlcztcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBhc1ZpZXcocXVlcnk6UXVlcnl8VW5pb24pIHtcbiAgICBsZXQgbmFtZSA9IHF1ZXJ5Lm5hbWU7XG4gICAgaWYodGhpcy50YWJsZXNbbmFtZV0pIHtcbiAgICAgIHRoaXMucmVtb3ZlVmlldyhuYW1lKTtcbiAgICB9XG4gICAgbGV0IHZpZXcgPSB0aGlzLnRhYmxlKG5hbWUpO1xuICAgIHRoaXMuZWRiVGFibGVzW25hbWVdID0gZmFsc2U7XG4gICAgdmlldy52aWV3ID0gcXVlcnk7XG4gICAgdmlldy5pc1ZpZXcgPSB0cnVlO1xuICAgIHRoaXMudHJpZ2dlcihuYW1lLCBxdWVyeS50YWJsZXMsIHF1ZXJ5LmV4ZWMuYmluZChxdWVyeSksIHF1ZXJ5LmV4ZWNJbmNyZW1lbnRhbC5iaW5kKHF1ZXJ5KSk7XG4gIH1cbiAgcmVtb3ZlVmlldyhpZDpzdHJpbmcpIHtcbiAgICBmb3IobGV0IHRhYmxlIG9mIHRoaXMudGFibGVzKSB7XG4gICAgICBkZWxldGUgdGFibGUudHJpZ2dlcnNbaWRdO1xuICAgIH1cbiAgfVxuICB0b3RhbEZhY3RzKCkge1xuICAgIGxldCB0b3RhbCA9IDA7XG4gICAgZm9yKGxldCB0YWJsZU5hbWUgaW4gdGhpcy50YWJsZXMpIHtcbiAgICAgIHRvdGFsICs9IHRoaXMudGFibGVzW3RhYmxlTmFtZV0udGFibGUubGVuZ3RoO1xuICAgIH1cbiAgICByZXR1cm4gdG90YWw7XG4gIH1cbiAgZmFjdHNQZXJUYWJsZSgpIHtcbiAgICBsZXQgaW5mbyA9IHt9O1xuICAgIGZvcihsZXQgdGFibGVOYW1lIGluIHRoaXMudGFibGVzKSB7XG4gICAgICBpbmZvW3RhYmxlTmFtZV0gPSB0aGlzLnRhYmxlc1t0YWJsZU5hbWVdLnRhYmxlLmxlbmd0aDtcbiAgICB9XG4gICAgcmV0dXJuIGluZm87XG4gIH1cblxuICBhcHBseURpZmZJbmNyZW1lbnRhbChkaWZmOkRpZmYpIHtcbiAgICBpZihkaWZmLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xuICAgIC8vIGNvbnNvbGUubG9nKFwiRElGRiBTSVpFOiBcIiwgZGlmZi5sZW5ndGgsIGRpZmYpO1xuXHRcdGxldCB7dHJpZ2dlcnMsIHJlYWxEaWZmc30gPSB0aGlzLmV4ZWNEaWZmKGRpZmYpO1xuXHRcdGxldCByb3VuZCA9IDA7XG4gICAgbGV0IGNoYW5nZXMgPSByZWFsRGlmZnM7XG5cdFx0d2hpbGUodHJpZ2dlcnMpIHtcblx0XHQgIC8vIGNvbnNvbGUuZ3JvdXAoYFJPVU5EICR7cm91bmR9YCk7XG4gICAgICAvLyBjb25zb2xlLmxvZyhcIkNIQU5HRVM6IFwiLCBjaGFuZ2VzKTtcblx0XHQgIGxldCByZXN1bHRzID0gdGhpcy5leGVjVHJpZ2dlcnNJbmNyZW1lbnRhbCh0cmlnZ2VycywgY2hhbmdlcyk7XG4gICAgICAvLyBjb25zb2xlLmdyb3VwRW5kKCk7XG4gICAgICBpZighcmVzdWx0cykgYnJlYWtcbiAgICAgIHRyaWdnZXJzID0gcmVzdWx0cy50cmlnZ2VycztcbiAgICAgIGNoYW5nZXMgPSByZXN1bHRzLmNoYW5nZXNcblx0XHQgIHJvdW5kKys7XG5cdFx0fVxuXHR9XG5cbiAgZXhlY1RyaWdnZXJJbmNyZW1lbnRhbCh0cmlnZ2VyLCBjaGFuZ2VzKTphbnkge1xuICAgIGxldCB0YWJsZSA9IHRoaXMudGFibGUodHJpZ2dlci5uYW1lKTtcbiAgICBsZXQgYWRkcywgcHJvdmVuYW5jZSwgcmVtb3ZlcywgaW5mbztcbiAgICBpZih0cmlnZ2VyLmV4ZWNJbmNyZW1lbnRhbCkge1xuICAgICAgaW5mbyA9IHRyaWdnZXIuZXhlY0luY3JlbWVudGFsKGNoYW5nZXMsIHRhYmxlKSB8fCB7fTtcbiAgICAgIGFkZHMgPSBpbmZvLmFkZHM7XG4gICAgICByZW1vdmVzID0gaW5mby5yZW1vdmVzO1xuICAgIH0gZWxzZSB7XG4gICAgICB0cmlnZ2VyLmV4ZWMoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgbGV0IGRpZmYgPSBuZXcgcnVudGltZS5EaWZmKHRoaXMpO1xuICAgIGlmKGFkZHMubGVuZ3RoKSB7XG4gICAgICBkaWZmLmFkZE1hbnkodHJpZ2dlci5uYW1lLCBhZGRzKTtcbiAgICB9XG4gICAgaWYocmVtb3Zlcy5sZW5ndGgpIHtcbiAgICAgIGRpZmYucmVtb3ZlRmFjdHModHJpZ2dlci5uYW1lLCByZW1vdmVzKTtcbiAgICB9XG4gICAgbGV0IHVwZGF0ZWQgPSB0aGlzLmV4ZWNEaWZmKGRpZmYpO1xuICAgIGxldCB7cmVhbERpZmZzfSA9IHVwZGF0ZWQ7XG4gICAgaWYocmVhbERpZmZzW3RyaWdnZXIubmFtZV0gJiYgKHJlYWxEaWZmc1t0cmlnZ2VyLm5hbWVdLmFkZHMubGVuZ3RoIHx8IHJlYWxEaWZmc1t0cmlnZ2VyLm5hbWVdLnJlbW92ZXMpKSB7XG4gICAgICByZXR1cm4ge2NoYW5nZXM6IHJlYWxEaWZmc1t0cmlnZ2VyLm5hbWVdLCB0cmlnZ2VyczogdXBkYXRlZC50cmlnZ2Vyc307XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9XG4gIH1cblxuICBleGVjVHJpZ2dlcnNJbmNyZW1lbnRhbCh0cmlnZ2VycywgY2hhbmdlcykge1xuICAgIGxldCBuZXdUcmlnZ2VycyA9IHt9O1xuICAgIGxldCBuZXh0Q2hhbmdlcyA9IHt9O1xuICAgIGxldCByZXRyaWdnZXIgPSBmYWxzZTtcbiAgICBsZXQgdHJpZ2dlcktleXMgPSBPYmplY3Qua2V5cyh0cmlnZ2Vycyk7XG4gICAgZm9yKGxldCB0cmlnZ2VyTmFtZSBvZiB0cmlnZ2VyS2V5cykge1xuICAgICAgLy8gY29uc29sZS5sb2coXCJDYWxsaW5nOlwiLCB0cmlnZ2VyTmFtZSk7XG4gICAgICBsZXQgdHJpZ2dlciA9IHRyaWdnZXJzW3RyaWdnZXJOYW1lXTtcbiAgICAgIGxldCBuZXh0Um91bmQgPSB0aGlzLmV4ZWNUcmlnZ2VySW5jcmVtZW50YWwodHJpZ2dlciwgY2hhbmdlcyk7XG4gICAgICBpZihuZXh0Um91bmQgJiYgbmV4dFJvdW5kLmNoYW5nZXMpIHtcbiAgICAgICAgbmV4dENoYW5nZXNbdHJpZ2dlck5hbWVdID0gbmV4dFJvdW5kLmNoYW5nZXM7XG4gICAgICAgIGlmKG5leHRSb3VuZC50cmlnZ2Vycykge1xuXG4gICAgICAgICAgbGV0IG5leHRSb3VuZEtleXMgPSBPYmplY3Qua2V5cyhuZXh0Um91bmQudHJpZ2dlcnMpO1xuICAgICAgICAgIGZvcihsZXQgdHJpZ2dlciBvZiBuZXh0Um91bmRLZXlzKSB7XG4gICAgICAgICAgICBpZih0cmlnZ2VyICYmIG5leHRSb3VuZC50cmlnZ2Vyc1t0cmlnZ2VyXSkge1xuICAgICAgICAgICAgICByZXRyaWdnZXIgPSB0cnVlO1xuICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIlF1ZXVpbmc6XCIsIHRyaWdnZXIpO1xuICAgICAgICAgICAgICBuZXdUcmlnZ2Vyc1t0cmlnZ2VyXSA9IG5leHRSb3VuZC50cmlnZ2Vyc1t0cmlnZ2VyXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgaWYocmV0cmlnZ2VyKSB7XG4gICAgICByZXR1cm4ge2NoYW5nZXM6IG5leHRDaGFuZ2VzLCB0cmlnZ2VyczogbmV3VHJpZ2dlcnN9O1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gYWRkUHJvdmVuYW5jZVRhYmxlKGl4ZXIpIHtcbiAgbGV0IHRhYmxlID0gaXhlci5hZGRUYWJsZShcInByb3ZlbmFuY2VcIiwgW1widGFibGVcIiwgW1wicm93XCIsIFwiX19pZFwiXSwgXCJyb3cgaW5zdGFuY2VcIiwgXCJzb3VyY2VcIiwgW1wic291cmNlIHJvd1wiLCBcIl9faWRcIl1dKTtcbiAgLy8gZ2VuZXJhdGUgc29tZSBpbmRleGVzIHRoYXQgd2Uga25vdyB3ZSdyZSBnb2luZyB0byBuZWVkIHVwZnJvbnRcbiAgaXhlci5pbmRleChcInByb3ZlbmFuY2VcIiwgW1widGFibGVcIiwgXCJyb3dcIl0pO1xuICBpeGVyLmluZGV4KFwicHJvdmVuYW5jZVwiLCBbXCJ0YWJsZVwiLCBcInJvdyBpbnN0YW5jZVwiXSk7XG4gIGl4ZXIuaW5kZXgoXCJwcm92ZW5hbmNlXCIsIFtcInRhYmxlXCIsIFwic291cmNlXCIsIFwic291cmNlIHJvd1wiXSk7XG4gIGl4ZXIuaW5kZXgoXCJwcm92ZW5hbmNlXCIsIFtcInRhYmxlXCJdKTtcbiAgcmV0dXJuIGl4ZXI7XG59XG5cbmZ1bmN0aW9uIG1hcHBpbmdUb0RpZmYoZGlmZiwgYWN0aW9uLCBtYXBwaW5nLCBhbGlhc2VzLCByZXZlcnNlTG9va3VwKSB7XG4gIGZvcihsZXQgZnJvbSBpbiBtYXBwaW5nKSB7XG4gICAgbGV0IHRvID0gbWFwcGluZ1tmcm9tXTtcbiAgICBpZih0by5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHtcbiAgICAgIGxldCBzb3VyY2UgPSB0b1swXTtcbiAgICAgIGlmKHR5cGVvZiBzb3VyY2UgPT09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgc291cmNlID0gYWxpYXNlc1tyZXZlcnNlTG9va3VwW3NvdXJjZV1dO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc291cmNlID0gYWxpYXNlc1tzb3VyY2VdO1xuICAgICAgfVxuICAgICAgZGlmZi5hZGQoXCJhY3Rpb24gbWFwcGluZ1wiLCB7YWN0aW9uLCBmcm9tLCBcInRvIHNvdXJjZVwiOiBzb3VyY2UsIFwidG8gZmllbGRcIjogdG9bMV19KTtcbiAgICB9IGVsc2Uge1xuICAgICAgZGlmZi5hZGQoXCJhY3Rpb24gbWFwcGluZyBjb25zdGFudFwiLCB7YWN0aW9uLCBmcm9tLCB2YWx1ZTogdG99KTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGRpZmY7XG59XG5cbmV4cG9ydCB2YXIgUXVlcnlGdW5jdGlvbnMgPSB7fVxudmFyIFNUUklQX0NPTU1FTlRTID0gLygoXFwvXFwvLiokKXwoXFwvXFwqW1xcc1xcU10qP1xcKlxcLykpL21nO1xudmFyIEFSR1VNRU5UX05BTUVTID0gLyhbXlxccyxdKykvZztcbmZ1bmN0aW9uIGdldFBhcmFtTmFtZXMoZnVuYykge1xuICB2YXIgZm5TdHIgPSBmdW5jLnRvU3RyaW5nKCkucmVwbGFjZShTVFJJUF9DT01NRU5UUywgJycpO1xuICB2YXIgcmVzdWx0ID0gZm5TdHIuc2xpY2UoZm5TdHIuaW5kZXhPZignKCcpKzEsIGZuU3RyLmluZGV4T2YoJyknKSkubWF0Y2goQVJHVU1FTlRfTkFNRVMpO1xuICBpZihyZXN1bHQgPT09IG51bGwpXG4gICAgcmVzdWx0ID0gW107XG4gIHJldHVybiByZXN1bHQ7XG59XG5leHBvcnQgZnVuY3Rpb24gZGVmaW5lKG5hbWUsIG9wdHMsIGZ1bmMpIHtcbiAgbGV0IHBhcmFtcyA9IGdldFBhcmFtTmFtZXMoZnVuYyk7XG4gIG9wdHMubmFtZSA9IG5hbWU7XG4gIG9wdHMucGFyYW1zID0gcGFyYW1zO1xuICBvcHRzLmZ1bmMgPSBmdW5jO1xuICBRdWVyeUZ1bmN0aW9uc1tuYW1lXSA9IG9wdHM7XG59XG5cbmV4cG9ydCBjbGFzcyBRdWVyeSB7XG4gIHRhYmxlcztcbiAgam9pbnM7XG4gIGRpcnR5O1xuICBjb21waWxlZDtcbiAgaXhlcjtcbiAgYWxpYXNlcztcbiAgZnVuY3M7XG4gIG5hbWU7XG4gIHByb2plY3Rpb25NYXA7XG4gIGxpbWl0SW5mbztcbiAgZ3JvdXBzO1xuICBzb3J0cztcbiAgYWdncmVnYXRlcztcbiAgdW5wcm9qZWN0ZWRTaXplO1xuICBoYXNPcmRpbmFsO1xuICBpbmNyZW1lbnRhbFJvd0ZpbmRlcjtcblxuICBzdGF0aWMgcmVtb3ZlKHZpZXc6IHN0cmluZywgaXhlcjpJbmRleGVyKSB7XG4gICAgbGV0IGRpZmYgPSBpeGVyLmRpZmYoKTtcbiAgICBkaWZmLnJlbW92ZShcInZpZXdcIiwge3ZpZXd9KTtcbiAgICBmb3IobGV0IGFjdGlvbkl0ZW0gb2YgaXhlci5maW5kKFwiYWN0aW9uXCIsIHt2aWV3fSkpIHtcbiAgICAgIGxldCBhY3Rpb24gPSBhY3Rpb25JdGVtLmFjdGlvbjtcbiAgICAgIGRpZmYucmVtb3ZlKFwiYWN0aW9uXCIsIHthY3Rpb259KTtcbiAgICAgIGRpZmYucmVtb3ZlKFwiYWN0aW9uIHNvdXJjZVwiLCB7YWN0aW9ufSk7XG4gICAgICBkaWZmLnJlbW92ZShcImFjdGlvbiBtYXBwaW5nXCIsIHthY3Rpb259KTtcbiAgICAgIGRpZmYucmVtb3ZlKFwiYWN0aW9uIG1hcHBpbmcgY29uc3RhbnRcIiwge2FjdGlvbn0pO1xuICAgICAgZGlmZi5yZW1vdmUoXCJhY3Rpb24gbWFwcGluZyBzb3J0ZWRcIiwge2FjdGlvbn0pO1xuICAgICAgZGlmZi5yZW1vdmUoXCJhY3Rpb24gbWFwcGluZyBsaW1pdFwiLCB7YWN0aW9ufSk7XG4gICAgfVxuICAgIHJldHVybiBkaWZmO1xuICB9XG5cbiAgY29uc3RydWN0b3IoaXhlciwgbmFtZSA9IFwidW5rbm93blwiKSB7XG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB0aGlzLml4ZXIgPSBpeGVyO1xuICAgIHRoaXMuZGlydHkgPSB0cnVlO1xuICAgIHRoaXMudGFibGVzID0gW107XG4gICAgdGhpcy5qb2lucyA9IFtdO1xuICAgIHRoaXMuYWxpYXNlcyA9IHt9O1xuICAgIHRoaXMuZnVuY3MgPSBbXTtcbiAgICB0aGlzLmFnZ3JlZ2F0ZXMgPSBbXTtcbiAgICB0aGlzLnVucHJvamVjdGVkU2l6ZSA9IDA7XG4gICAgdGhpcy5oYXNPcmRpbmFsID0gZmFsc2U7XG4gIH1cbiAgY2hhbmdlc2V0KGl4ZXI6SW5kZXhlcikge1xuICAgIGxldCBkaWZmID0gaXhlci5kaWZmKCk7XG4gICAgbGV0IGFsaWFzZXMgPSB7fTtcbiAgICBsZXQgcmV2ZXJzZUxvb2t1cCA9IHt9O1xuICAgIGZvcihsZXQgYWxpYXMgaW4gdGhpcy5hbGlhc2VzKSB7XG4gICAgICByZXZlcnNlTG9va3VwW3RoaXMuYWxpYXNlc1thbGlhc11dID0gYWxpYXM7XG4gICAgfVxuICAgIGxldCB2aWV3ID0gdGhpcy5uYW1lO1xuICAgIGRpZmYuYWRkKFwidmlld1wiLCB7dmlldywga2luZDogXCJxdWVyeVwifSk7XG4gICAgLy9qb2luc1xuICAgIGZvcihsZXQgam9pbiBvZiB0aGlzLmpvaW5zKSB7XG4gICAgICBsZXQgYWN0aW9uID0gdXVpZCgpO1xuICAgICAgYWxpYXNlc1tqb2luLmFzXSA9IGFjdGlvbjtcbiAgICAgIGlmKCFqb2luLm5lZ2F0ZWQpIHtcbiAgICAgICAgZGlmZi5hZGQoXCJhY3Rpb25cIiwge3ZpZXcsIGFjdGlvbiwga2luZDogXCJzZWxlY3RcIiwgaXg6IGpvaW4uaXh9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRpZmYuYWRkKFwiYWN0aW9uXCIsIHt2aWV3LCBhY3Rpb24sIGtpbmQ6IFwiZGVzZWxlY3RcIiwgaXg6IGpvaW4uaXh9KTtcbiAgICAgIH1cbiAgICAgIGRpZmYuYWRkKFwiYWN0aW9uIHNvdXJjZVwiLCB7YWN0aW9uLCBcInNvdXJjZSB2aWV3XCI6IGpvaW4udGFibGV9KTtcbiAgICAgIG1hcHBpbmdUb0RpZmYoZGlmZiwgYWN0aW9uLCBqb2luLmpvaW4sIGFsaWFzZXMsIHJldmVyc2VMb29rdXApO1xuICAgIH1cbiAgICAvL2Z1bmN0aW9uc1xuICAgIGZvcihsZXQgZnVuYyBvZiB0aGlzLmZ1bmNzKSB7XG4gICAgICBsZXQgYWN0aW9uID0gdXVpZCgpO1xuICAgICAgYWxpYXNlc1tmdW5jLmFzXSA9IGFjdGlvbjtcbiAgICAgIGRpZmYuYWRkKFwiYWN0aW9uXCIsIHt2aWV3LCBhY3Rpb24sIGtpbmQ6IFwiY2FsY3VsYXRlXCIsIGl4OiBmdW5jLml4fSk7XG4gICAgICBkaWZmLmFkZChcImFjdGlvbiBzb3VyY2VcIiwge2FjdGlvbiwgXCJzb3VyY2Ugdmlld1wiOiBmdW5jLm5hbWV9KTtcbiAgICAgIG1hcHBpbmdUb0RpZmYoZGlmZiwgYWN0aW9uLCBmdW5jLmFyZ3MsIGFsaWFzZXMsIHJldmVyc2VMb29rdXApO1xuICAgIH1cbiAgICAvL2FnZ3JlZ2F0ZXNcbiAgICBmb3IobGV0IGFnZyBvZiB0aGlzLmFnZ3JlZ2F0ZXMpIHtcbiAgICAgIGxldCBhY3Rpb24gPSB1dWlkKCk7XG4gICAgICBhbGlhc2VzW2FnZy5hc10gPSBhY3Rpb247XG4gICAgICBkaWZmLmFkZChcImFjdGlvblwiLCB7dmlldywgYWN0aW9uLCBraW5kOiBcImFnZ3JlZ2F0ZVwiLCBpeDogYWdnLml4fSk7XG4gICAgICBkaWZmLmFkZChcImFjdGlvbiBzb3VyY2VcIiwge2FjdGlvbiwgXCJzb3VyY2Ugdmlld1wiOiBhZ2cubmFtZX0pO1xuICAgICAgbWFwcGluZ1RvRGlmZihkaWZmLCBhY3Rpb24sIGFnZy5hcmdzLCBhbGlhc2VzLCByZXZlcnNlTG9va3VwKTtcbiAgICB9XG4gICAgLy9zb3J0XG4gICAgaWYodGhpcy5zb3J0cykge1xuICAgICAgbGV0IGFjdGlvbiA9IHV1aWQoKTtcbiAgICAgIGRpZmYuYWRkKFwiYWN0aW9uXCIsIHt2aWV3LCBhY3Rpb24sIGtpbmQ6IFwic29ydFwiLCBpeDogTUFYX05VTUJFUn0pO1xuICAgICAgbGV0IGl4ID0gMDtcbiAgICAgIGZvcihsZXQgc29ydCBvZiB0aGlzLnNvcnRzKSB7XG4gICAgICAgIGxldCBbc291cmNlLCBmaWVsZCwgZGlyZWN0aW9uXSA9IHNvcnQ7XG4gICAgICAgIGlmKHR5cGVvZiBzb3VyY2UgPT09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgICBzb3VyY2UgPSBhbGlhc2VzW3JldmVyc2VMb29rdXBbc291cmNlXV07XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc291cmNlID0gYWxpYXNlc1tzb3VyY2VdO1xuICAgICAgICB9XG4gICAgICAgIGRpZmYuYWRkKFwiYWN0aW9uIG1hcHBpbmcgc29ydGVkXCIsIHthY3Rpb24sIGl4LCBzb3VyY2UsIGZpZWxkLCBkaXJlY3Rpb259KTtcbiAgICAgICAgaXgrKztcbiAgICAgIH1cbiAgICB9XG4gICAgLy9ncm91cFxuICAgIGlmKHRoaXMuZ3JvdXBzKSB7XG4gICAgICBsZXQgYWN0aW9uID0gdXVpZCgpO1xuICAgICAgZGlmZi5hZGQoXCJhY3Rpb25cIiwge3ZpZXcsIGFjdGlvbiwga2luZDogXCJncm91cFwiLCBpeDogTUFYX05VTUJFUn0pO1xuICAgICAgbGV0IGl4ID0gMDtcbiAgICAgIGZvcihsZXQgZ3JvdXAgb2YgdGhpcy5ncm91cHMpIHtcbiAgICAgICAgbGV0IFtzb3VyY2UsIGZpZWxkXSA9IGdyb3VwO1xuICAgICAgICBpZih0eXBlb2Ygc291cmNlID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgICAgc291cmNlID0gYWxpYXNlc1tyZXZlcnNlTG9va3VwW3NvdXJjZV1dO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNvdXJjZSA9IGFsaWFzZXNbc291cmNlXTtcbiAgICAgICAgfVxuICAgICAgICBkaWZmLmFkZChcImFjdGlvbiBtYXBwaW5nIHNvcnRlZFwiLCB7YWN0aW9uLCBpeCwgc291cmNlLCBmaWVsZCwgZGlyZWN0aW9uOiBcImFzY2VuZGluZ1wifSk7XG4gICAgICAgIGl4Kys7XG4gICAgICB9XG4gICAgfVxuICAgIC8vbGltaXRcbiAgICBpZih0aGlzLmxpbWl0SW5mbykge1xuICAgICAgbGV0IGFjdGlvbiA9IHV1aWQoKTtcbiAgICAgIGRpZmYuYWRkKFwiYWN0aW9uXCIsIHt2aWV3LCBhY3Rpb24sIGtpbmQ6IFwibGltaXRcIiwgaXg6IE1BWF9OVU1CRVJ9KTtcbiAgICAgIGZvcihsZXQgbGltaXRUeXBlIGluIHRoaXMubGltaXRJbmZvKSB7XG4gICAgICAgIGRpZmYuYWRkKFwiYWN0aW9uIG1hcHBpbmcgbGltaXRcIiwge2FjdGlvbiwgXCJsaW1pdCB0eXBlXCI6IGxpbWl0VHlwZSwgdmFsdWU6IHRoaXMubGltaXRJbmZvW2xpbWl0VHlwZV19KTtcbiAgICAgIH1cbiAgICB9XG4gICAgLy9wcm9qZWN0aW9uXG4gICAgaWYodGhpcy5wcm9qZWN0aW9uTWFwKSB7XG4gICAgICBsZXQgYWN0aW9uID0gdXVpZCgpO1xuICAgICAgZGlmZi5hZGQoXCJhY3Rpb25cIiwge3ZpZXcsIGFjdGlvbiwga2luZDogXCJwcm9qZWN0XCIsIGl4OiBNQVhfTlVNQkVSfSk7XG4gICAgICBtYXBwaW5nVG9EaWZmKGRpZmYsIGFjdGlvbiwgdGhpcy5wcm9qZWN0aW9uTWFwLCBhbGlhc2VzLCByZXZlcnNlTG9va3VwKTtcbiAgICB9XG4gICAgcmV0dXJuIGRpZmY7XG4gIH1cbiAgdmFsaWRhdGVGaWVsZHModGFibGVOYW1lLCBqb2luT2JqZWN0KSB7XG4gICAgbGV0IHRhYmxlID0gdGhpcy5peGVyLnRhYmxlKHRhYmxlTmFtZSk7XG4gICAgZm9yIChsZXQgZmllbGQgaW4gam9pbk9iamVjdCkge1xuICAgICAgaWYgKHRhYmxlLmZpZWxkcy5sZW5ndGggJiYgIXRhYmxlLmtleUxvb2t1cFtmaWVsZF0pIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUYWJsZSAnJHt0YWJsZU5hbWV9JyBkb2Vzbid0IGhhdmUgYSBmaWVsZCAnJHtmaWVsZH0nLlxcblxcbkF2YWlsYWJsZSBmaWVsZHM6ICR7dGFibGUuZmllbGRzLmpvaW4oXCIsIFwiKX1gKTtcbiAgICAgIH1cbiAgICAgIGxldCBqb2luSW5mbyA9IGpvaW5PYmplY3RbZmllbGRdO1xuICAgICAgaWYoam9pbkluZm8uY29uc3RydWN0b3IgPT09IEFycmF5KSB7XG4gICAgICAgIGxldCBbam9pbk51bWJlciwgcmVmZXJlbmNlZEZpZWxkXSA9IGpvaW5JbmZvO1xuICAgICAgICBpZiAodHlwZW9mIGpvaW5OdW1iZXIgIT09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgICBqb2luTnVtYmVyID0gdGhpcy5hbGlhc2VzW2pvaW5OdW1iZXJdO1xuICAgICAgICB9XG4gICAgICAgIGxldCBqb2luID0gdGhpcy5qb2luc1tqb2luTnVtYmVyXTtcbiAgICAgICAgaWYgKGpvaW4gJiYgam9pbi5peCA9PT0gam9pbk51bWJlcikge1xuICAgICAgICAgIGxldCByZWZlcmVuY2VkVGFibGUgPSB0aGlzLml4ZXIudGFibGUoam9pbi50YWJsZSk7XG4gICAgICAgICAgaWYgKCFyZWZlcmVuY2VkVGFibGUuZmllbGRzLmxlbmd0aCkgY29udGludWU7XG4gICAgICAgICAgaWYgKCFyZWZlcmVuY2VkVGFibGUua2V5TG9va3VwW3JlZmVyZW5jZWRGaWVsZF0pIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVGFibGUgJyR7am9pbi50YWJsZX0nIGRvZXNuJ3QgaGF2ZSBhIGZpZWxkICcke3JlZmVyZW5jZWRGaWVsZH0nLlxcblxcbkF2YWlsYWJsZSBmaWVsZHM6ICR7cmVmZXJlbmNlZFRhYmxlLmZpZWxkcy5qb2luKFwiLCBcIil9YCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHNlbGVjdCh0YWJsZSwgam9pbiwgYXM/KSB7XG4gICAgdGhpcy5kaXJ0eSA9IHRydWU7XG4gICAgaWYoYXMpIHtcbiAgICAgIHRoaXMuYWxpYXNlc1thc10gPSBPYmplY3Qua2V5cyh0aGlzLmFsaWFzZXMpLmxlbmd0aDtcbiAgICB9XG4gICAgdGhpcy51bnByb2plY3RlZFNpemUrKztcbiAgICB0aGlzLnRhYmxlcy5wdXNoKHRhYmxlKTtcbiAgICB0aGlzLnZhbGlkYXRlRmllbGRzKHRhYmxlLCBqb2luKTtcbiAgICB0aGlzLmpvaW5zLnB1c2goe25lZ2F0ZWQ6IGZhbHNlLCB0YWJsZSwgam9pbiwgYXMsIGl4OiB0aGlzLmFsaWFzZXNbYXNdfSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgZGVzZWxlY3QodGFibGUsIGpvaW4pIHtcbiAgICB0aGlzLmRpcnR5ID0gdHJ1ZTtcbiAgICB0aGlzLnRhYmxlcy5wdXNoKHRhYmxlKTtcbiAgICB0aGlzLnZhbGlkYXRlRmllbGRzKHRhYmxlLCBqb2luKTtcbiAgICB0aGlzLmpvaW5zLnB1c2goe25lZ2F0ZWQ6IHRydWUsIHRhYmxlLCBqb2luLCBpeDogdGhpcy5qb2lucy5sZW5ndGggKiAxMDAwfSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgY2FsY3VsYXRlKGZ1bmNOYW1lLCBhcmdzLCBhcz8pIHtcbiAgICB0aGlzLmRpcnR5ID0gdHJ1ZTtcbiAgICBpZihhcykge1xuICAgICAgdGhpcy5hbGlhc2VzW2FzXSA9IE9iamVjdC5rZXlzKHRoaXMuYWxpYXNlcykubGVuZ3RoO1xuICAgIH1cbiAgICBpZighUXVlcnlGdW5jdGlvbnNbZnVuY05hbWVdLmZpbHRlcikge1xuICAgICAgdGhpcy51bnByb2plY3RlZFNpemUrKztcbiAgICB9XG4gICAgdGhpcy5mdW5jcy5wdXNoKHtuYW1lOiBmdW5jTmFtZSwgYXJncywgYXMsIGl4OiB0aGlzLmFsaWFzZXNbYXNdfSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgcHJvamVjdChwcm9qZWN0aW9uTWFwKSB7XG4gICAgdGhpcy5wcm9qZWN0aW9uTWFwID0gcHJvamVjdGlvbk1hcDtcbiAgICB0aGlzLnZhbGlkYXRlRmllbGRzKHVuZGVmaW5lZCwgcHJvamVjdGlvbk1hcCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgZ3JvdXAoZ3JvdXBzKSB7XG4gICAgdGhpcy5kaXJ0eSA9IHRydWU7XG4gICAgaWYoZ3JvdXBzWzBdICYmIGdyb3Vwc1swXS5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHtcbiAgICAgIHRoaXMuZ3JvdXBzID0gZ3JvdXBzO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZighdGhpcy5ncm91cHMpIHRoaXMuZ3JvdXBzID0gW107XG4gICAgICB0aGlzLmdyb3Vwcy5wdXNoKGdyb3Vwcyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIHNvcnQoc29ydHMpIHtcbiAgICB0aGlzLmRpcnR5ID0gdHJ1ZTtcbiAgICBpZihzb3J0c1swXSAmJiBzb3J0c1swXS5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHtcbiAgICAgIHRoaXMuc29ydHMgPSBzb3J0cztcbiAgICB9IGVsc2Uge1xuICAgICAgaWYoIXRoaXMuc29ydHMpIHRoaXMuc29ydHMgPSBbXTtcbiAgICAgIHRoaXMuc29ydHMucHVzaChzb3J0cyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIGxpbWl0KGxpbWl0SW5mbzphbnkpIHtcbiAgICB0aGlzLmRpcnR5ID0gdHJ1ZTtcbiAgICBpZighdGhpcy5saW1pdEluZm8pIHtcbiAgICAgIHRoaXMubGltaXRJbmZvID0ge307XG4gICAgfVxuICAgIGZvcihsZXQga2V5IGluIGxpbWl0SW5mbykge1xuICAgICAgdGhpcy5saW1pdEluZm9ba2V5XSA9IGxpbWl0SW5mb1trZXldO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBhZ2dyZWdhdGUoZnVuY05hbWUsIGFyZ3MsIGFzPykge1xuICAgIHRoaXMuZGlydHkgPSB0cnVlO1xuICAgIGlmKGFzKSB7XG4gICAgICB0aGlzLmFsaWFzZXNbYXNdID0gT2JqZWN0LmtleXModGhpcy5hbGlhc2VzKS5sZW5ndGg7XG4gICAgfVxuICAgIHRoaXMudW5wcm9qZWN0ZWRTaXplKys7XG4gICAgdGhpcy5hZ2dyZWdhdGVzLnB1c2goe25hbWU6IGZ1bmNOYW1lLCBhcmdzLCBhcywgaXg6IHRoaXMuYWxpYXNlc1thc119KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBvcmRpbmFsKCkge1xuICAgIHRoaXMuZGlydHkgPSB0cnVlO1xuICAgIHRoaXMuaGFzT3JkaW5hbCA9IHRydWU7XG4gICAgdGhpcy51bnByb2plY3RlZFNpemUrKztcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICBhcHBseUFsaWFzZXMoam9pbk1hcCkge1xuICAgIGZvcihsZXQgZmllbGQgaW4gam9pbk1hcCkge1xuICAgICAgbGV0IGpvaW5JbmZvID0gam9pbk1hcFtmaWVsZF07XG4gICAgICBpZihqb2luSW5mby5jb25zdHJ1Y3RvciAhPT0gQXJyYXkgfHwgdHlwZW9mIGpvaW5JbmZvWzBdID09PSBcIm51bWJlclwiKSBjb250aW51ZTtcbiAgICAgIGxldCBqb2luVGFibGUgPSBqb2luSW5mb1swXTtcbiAgICAgIGlmKGpvaW5UYWJsZSA9PT0gXCJvcmRpbmFsXCIpIHtcbiAgICAgICAgam9pbkluZm9bMF0gPSB0aGlzLnVucHJvamVjdGVkU2l6ZSAtIDE7XG4gICAgICB9IGVsc2UgaWYodGhpcy5hbGlhc2VzW2pvaW5UYWJsZV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBqb2luSW5mb1swXSA9IHRoaXMuYWxpYXNlc1tqb2luVGFibGVdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBhbGlhcyB1c2VkOiBcIiArIGpvaW5UYWJsZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHRvQVNUKCkge1xuICAgIGxldCBjdXJzb3IgPSB7dHlwZTogXCJxdWVyeVwiLFxuICAgICAgICAgICAgICAgICAgY2hpbGRyZW46IFtdfTtcbiAgICBsZXQgcm9vdCA9IGN1cnNvcjtcbiAgICBsZXQgcmVzdWx0cyA9IFtdO1xuICAgIC8vIGJ5IGRlZmF1bHQgdGhlIG9ubHkgdGhpbmcgd2UgcmV0dXJuIGFyZSB0aGUgdW5wcm9qZWN0ZWQgcmVzdWx0c1xuICAgIGxldCByZXR1cm5zID0gW1widW5wcm9qZWN0ZWRcIiwgXCJwcm92ZW5hbmNlXCJdO1xuXG4gICAgLy8gd2UgbmVlZCBhbiBhcnJheSB0byBzdG9yZSBvdXIgdW5wcm9qZWN0ZWQgcmVzdWx0c1xuICAgIHJvb3QuY2hpbGRyZW4ucHVzaCh7dHlwZTogXCJkZWNsYXJhdGlvblwiLCB2YXI6IFwidW5wcm9qZWN0ZWRcIiwgdmFsdWU6IFwiW11cIn0pO1xuICAgIHJvb3QuY2hpbGRyZW4ucHVzaCh7dHlwZTogXCJkZWNsYXJhdGlvblwiLCB2YXI6IFwicHJvdmVuYW5jZVwiLCB2YWx1ZTogXCJbXVwifSk7XG4gICAgcm9vdC5jaGlsZHJlbi5wdXNoKHt0eXBlOiBcImRlY2xhcmF0aW9uXCIsIHZhcjogXCJwcm9qZWN0ZWRcIiwgdmFsdWU6IFwie31cIn0pO1xuXG4gICAgLy8gcnVuIHRocm91Z2ggZWFjaCB0YWJsZSBuZXN0ZWQgaW4gdGhlIG9yZGVyIHRoZXkgd2VyZSBnaXZlbiBkb2luZyBwYWlyd2lzZVxuICAgIC8vIGpvaW5zIGFsb25nIHRoZSB3YXkuXG4gICAgZm9yKGxldCBqb2luIG9mIHRoaXMuam9pbnMpIHtcbiAgICAgIGxldCB7dGFibGUsIGl4LCBuZWdhdGVkfSA9IGpvaW47XG4gICAgICBsZXQgY3VyID0ge1xuICAgICAgICB0eXBlOiBcInNlbGVjdFwiLFxuICAgICAgICB0YWJsZSxcbiAgICAgICAgcGFzc2VkOiBpeCA9PT0gMCxcbiAgICAgICAgaXgsXG4gICAgICAgIG5lZ2F0ZWQsXG4gICAgICAgIGNoaWxkcmVuOiBbXSxcbiAgICAgICAgam9pbjogZmFsc2UsXG4gICAgICB9O1xuICAgICAgLy8gd2Ugb25seSB3YW50IHRvIGVhdCB0aGUgY29zdCBvZiBkZWFsaW5nIHdpdGggaW5kZXhlc1xuICAgICAgLy8gaWYgd2UgYXJlIGFjdHVhbGx5IGpvaW5pbmcgb24gc29tZXRoaW5nXG4gICAgICBsZXQgam9pbk1hcCA9IGpvaW4uam9pbjtcbiAgICAgIHRoaXMuYXBwbHlBbGlhc2VzKGpvaW5NYXApO1xuICAgICAgaWYoam9pbk1hcCAmJiBPYmplY3Qua2V5cyhqb2luTWFwKS5sZW5ndGggIT09IDApIHtcbiAgICAgICAgcm9vdC5jaGlsZHJlbi51bnNoaWZ0KHt0eXBlOiBcImRlY2xhcmF0aW9uXCIsIHZhcjogYHF1ZXJ5JHtpeH1gLCB2YWx1ZTogXCJ7fVwifSk7XG4gICAgICAgIGN1ci5qb2luID0gam9pbk1hcDtcbiAgICAgIH1cbiAgICAgIGN1cnNvci5jaGlsZHJlbi5wdXNoKGN1cik7XG4gICAgICBpZighbmVnYXRlZCkge1xuICAgICAgICByZXN1bHRzLnB1c2goe3R5cGU6IFwic2VsZWN0XCIsIGl4fSk7XG4gICAgICB9XG5cbiAgICAgIGN1cnNvciA9IGN1cjtcbiAgICB9XG4gICAgLy8gYXQgdGhlIGJvdHRvbSBvZiB0aGUgam9pbnMsIHdlIGNhbGN1bGF0ZSBhbGwgdGhlIGZ1bmN0aW9ucyBiYXNlZCBvbiB0aGUgdmFsdWVzXG4gICAgLy8gY29sbGVjdGVkXG4gICAgZm9yKGxldCBmdW5jIG9mIHRoaXMuZnVuY3MpIHtcbiAgICAgIGxldCB7YXJncywgbmFtZSwgaXh9ID0gZnVuYztcbiAgICAgIGxldCBmdW5jSW5mbyA9IFF1ZXJ5RnVuY3Rpb25zW25hbWVdO1xuICAgICAgdGhpcy5hcHBseUFsaWFzZXMoYXJncyk7XG4gICAgICByb290LmNoaWxkcmVuLnVuc2hpZnQoe3R5cGU6IFwiZnVuY3Rpb25EZWNsYXJhdGlvblwiLCBpeCwgaW5mbzogZnVuY0luZm99KTtcbiAgICAgIGlmKGZ1bmNJbmZvLm11bHRpIHx8IGZ1bmNJbmZvLmZpbHRlcikge1xuICAgICAgICBsZXQgbm9kZSA9IHt0eXBlOiBcImZ1bmN0aW9uQ2FsbE11bHRpUmV0dXJuXCIsIGl4LCBhcmdzLCBpbmZvOiBmdW5jSW5mbywgY2hpbGRyZW46IFtdfTtcbiAgICAgICAgY3Vyc29yLmNoaWxkcmVuLnB1c2gobm9kZSk7XG4gICAgICAgIGN1cnNvciA9IG5vZGU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjdXJzb3IuY2hpbGRyZW4ucHVzaCh7dHlwZTogXCJmdW5jdGlvbkNhbGxcIiwgaXgsIGFyZ3MsIGluZm86IGZ1bmNJbmZvLCBjaGlsZHJlbjogW119KTtcbiAgICAgIH1cbiAgICAgIGlmKCFmdW5jSW5mby5ub1JldHVybiAmJiAhZnVuY0luZm8uZmlsdGVyKSB7XG4gICAgICAgIHJlc3VsdHMucHVzaCh7dHlwZTogXCJmdW5jdGlvblwiLCBpeH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIG5vdyB0aGF0IHdlJ3JlIGF0IHRoZSBib3R0b20gb2YgdGhlIGpvaW4sIHN0b3JlIHRoZSB1bnByb2plY3RlZCByZXN1bHRcbiAgICBjdXJzb3IuY2hpbGRyZW4ucHVzaCh7dHlwZTogXCJyZXN1bHRcIiwgcmVzdWx0c30pO1xuXG4gICAgLy9BZ2dyZWdhdGlvblxuICAgIC8vc29ydCB0aGUgdW5wcm9qZWN0ZWQgcmVzdWx0cyBiYXNlZCBvbiBncm91cGluZ3MgYW5kIHRoZSBnaXZlbiBzb3J0c1xuICAgIGxldCBzb3J0cyA9IFtdO1xuICAgIGxldCBhbHJlYWR5U29ydGVkID0ge307XG4gICAgaWYodGhpcy5ncm91cHMpIHtcbiAgICAgIHRoaXMuYXBwbHlBbGlhc2VzKHRoaXMuZ3JvdXBzKTtcbiAgICAgIGZvcihsZXQgZ3JvdXAgb2YgdGhpcy5ncm91cHMpIHtcbiAgICAgICAgbGV0IFt0YWJsZSwgZmllbGRdID0gZ3JvdXA7XG4gICAgICAgIHNvcnRzLnB1c2goZ3JvdXApO1xuICAgICAgICBhbHJlYWR5U29ydGVkW2Ake3RhYmxlfXwke2ZpZWxkfWBdID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gICAgaWYodGhpcy5zb3J0cykge1xuICAgICAgdGhpcy5hcHBseUFsaWFzZXModGhpcy5zb3J0cyk7XG4gICAgICBmb3IobGV0IHNvcnQgb2YgdGhpcy5zb3J0cykge1xuICAgICAgICBsZXQgW3RhYmxlLCBmaWVsZF0gPSBzb3J0O1xuICAgICAgICBpZighYWxyZWFkeVNvcnRlZFtgJHt0YWJsZX18JHtmaWVsZH1gXSkge1xuICAgICAgICAgIHNvcnRzLnB1c2goc29ydCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIHNpemUgPSB0aGlzLnVucHJvamVjdGVkU2l6ZTtcbiAgICBpZihzb3J0cy5sZW5ndGgpIHtcbiAgICAgIHJvb3QuY2hpbGRyZW4ucHVzaCh7dHlwZTogXCJzb3J0XCIsIHNvcnRzLCBzaXplLCBjaGlsZHJlbjogW119KTtcbiAgICB9XG4gICAgLy90aGVuIHdlIG5lZWQgdG8gcnVuIHRocm91Z2ggdGhlIHNvcnRlZCBpdGVtcyBhbmQgZG8gdGhlIGFnZ3JlZ2F0ZSBhcyBhIGZvbGQuXG4gICAgaWYodGhpcy5hZ2dyZWdhdGVzLmxlbmd0aCB8fCBzb3J0cy5sZW5ndGggfHwgdGhpcy5saW1pdEluZm8gfHwgdGhpcy5oYXNPcmRpbmFsKSB7XG4gICAgICAvLyB3ZSBuZWVkIHRvIHN0b3JlIGdyb3VwIGluZm8gZm9yIHBvc3QgcHJvY2Vzc2luZyBvZiB0aGUgdW5wcm9qZWN0ZWQgcmVzdWx0c1xuICAgICAgLy8gdGhpcyB3aWxsIGluZGljYXRlIHdoYXQgZ3JvdXAgbnVtYmVyLCBpZiBhbnksIHRoYXQgZWFjaCB1bnByb2plY3RlZCByZXN1bHQgYmVsb25ncyB0b1xuICAgICAgcm9vdC5jaGlsZHJlbi51bnNoaWZ0KHt0eXBlOiBcImRlY2xhcmF0aW9uXCIsIHZhcjogXCJncm91cEluZm9cIiwgdmFsdWU6IFwiW11cIn0pO1xuICAgICAgcmV0dXJucy5wdXNoKFwiZ3JvdXBJbmZvXCIpO1xuICAgICAgbGV0IGFnZ3JlZ2F0ZUNoaWxkcmVuID0gW107XG4gICAgICBmb3IobGV0IGZ1bmMgb2YgdGhpcy5hZ2dyZWdhdGVzKSB7XG4gICAgICAgIGxldCB7YXJncywgbmFtZSwgaXh9ID0gZnVuYztcbiAgICAgICAgbGV0IGZ1bmNJbmZvID0gUXVlcnlGdW5jdGlvbnNbbmFtZV07XG4gICAgICAgIHRoaXMuYXBwbHlBbGlhc2VzKGFyZ3MpO1xuICAgICAgICByb290LmNoaWxkcmVuLnVuc2hpZnQoe3R5cGU6IFwiZnVuY3Rpb25EZWNsYXJhdGlvblwiLCBpeCwgaW5mbzogZnVuY0luZm99KTtcbiAgICAgICAgYWdncmVnYXRlQ2hpbGRyZW4ucHVzaCh7dHlwZTogXCJmdW5jdGlvbkNhbGxcIiwgaXgsIHJlc3VsdHNJeDogcmVzdWx0cy5sZW5ndGgsIGFyZ3MsIGluZm86IGZ1bmNJbmZvLCB1bnByb2plY3RlZDogdHJ1ZSwgY2hpbGRyZW46IFtdfSk7XG4gICAgICAgIHJlc3VsdHMucHVzaCh7dHlwZTogXCJwbGFjZWhvbGRlclwifSk7XG4gICAgICB9XG4gICAgICBpZih0aGlzLmhhc09yZGluYWwgPT09IHRydWUpIHtcbiAgICAgICAgYWdncmVnYXRlQ2hpbGRyZW4ucHVzaCh7dHlwZTogXCJvcmRpbmFsXCJ9KTtcbiAgICAgICAgcmVzdWx0cy5wdXNoKHt0eXBlOiBcInBsYWNlaG9sZGVyXCJ9KTtcbiAgICAgIH1cbiAgICAgIGxldCBhZ2dyZWdhdGUgPSB7dHlwZTogXCJhZ2dyZWdhdGUgbG9vcFwiLCBncm91cHM6IHRoaXMuZ3JvdXBzLCBsaW1pdDogdGhpcy5saW1pdEluZm8sIHNpemUsIGNoaWxkcmVuOiBhZ2dyZWdhdGVDaGlsZHJlbn07XG4gICAgICByb290LmNoaWxkcmVuLnB1c2goYWdncmVnYXRlKTtcbiAgICAgIGN1cnNvciA9IGFnZ3JlZ2F0ZTtcbiAgICB9XG5cblxuICAgIGlmKHRoaXMucHJvamVjdGlvbk1hcCkge1xuICAgICAgdGhpcy5hcHBseUFsaWFzZXModGhpcy5wcm9qZWN0aW9uTWFwKTtcbiAgICAgIHJvb3QuY2hpbGRyZW4udW5zaGlmdCh7dHlwZTogXCJkZWNsYXJhdGlvblwiLCB2YXI6IFwicmVzdWx0c1wiLCB2YWx1ZTogXCJbXVwifSk7XG4gICAgICBpZihJTkNSRU1FTlRBTCkge1xuICAgICAgICBjdXJzb3IuY2hpbGRyZW4ucHVzaCh7dHlwZTogXCJwcm92ZW5hbmNlXCJ9KTtcbiAgICAgIH1cbiAgICAgIGN1cnNvci5jaGlsZHJlbi5wdXNoKHt0eXBlOiBcInByb2plY3Rpb25cIiwgcHJvamVjdGlvbk1hcDogdGhpcy5wcm9qZWN0aW9uTWFwLCB1bnByb2plY3RlZDogdGhpcy5hZ2dyZWdhdGVzLmxlbmd0aH0pO1xuICAgICAgcmV0dXJucy5wdXNoKFwicmVzdWx0c1wiKTtcbiAgICB9XG5cbiAgICByb290LmNoaWxkcmVuLnB1c2goe3R5cGU6IFwicmV0dXJuXCIsIHZhcnM6IHJldHVybnN9KTtcbiAgICByZXR1cm4gcm9vdDtcbiAgfVxuICBjb21waWxlUGFyYW1TdHJpbmcoZnVuY0luZm8sIGFyZ3MsIHVucHJvamVjdGVkID0gZmFsc2UpIHtcbiAgICBsZXQgY29kZSA9IFwiXCI7XG4gICAgbGV0IHBhcmFtcyA9IGZ1bmNJbmZvLnBhcmFtcztcbiAgICBpZih1bnByb2plY3RlZCkgcGFyYW1zID0gcGFyYW1zLnNsaWNlKDEpO1xuICAgIGZvcihsZXQgcGFyYW0gb2YgcGFyYW1zKSB7XG4gICAgICBsZXQgYXJnID0gYXJnc1twYXJhbV07XG4gICAgICBsZXQgYXJnQ29kZTtcbiAgICAgIGlmKGFyZy5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHtcbiAgICAgICAgbGV0IHByb3BlcnR5ID0gXCJcIjtcbiAgICAgICAgaWYoYXJnWzFdKSB7XG4gICAgICAgICAgcHJvcGVydHkgPSBgWycke2FyZ1sxXX0nXWA7XG4gICAgICAgIH1cbiAgICAgICAgaWYoIXVucHJvamVjdGVkKSB7XG4gICAgICAgICAgYXJnQ29kZSA9IGByb3cke2FyZ1swXX0ke3Byb3BlcnR5fWA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYXJnQ29kZSA9IGB1bnByb2plY3RlZFtpeCArICR7YXJnWzBdfV0ke3Byb3BlcnR5fWA7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGFyZ0NvZGUgPSBKU09OLnN0cmluZ2lmeShhcmcpO1xuICAgICAgfVxuICAgICAgY29kZSArPSBgJHthcmdDb2RlfSwgYDtcbiAgICB9XG4gICAgcmV0dXJuIGNvZGUuc3Vic3RyaW5nKDAsY29kZS5sZW5ndGggLSAyKTtcbiAgfVxuICBjb21waWxlQVNUKHJvb3QpIHtcbiAgICBsZXQgY29kZSA9IFwiXCI7XG4gICAgbGV0IHR5cGUgPSByb290LnR5cGU7XG4gICAgc3dpdGNoKHR5cGUpIHtcbiAgICAgIGNhc2UgXCJxdWVyeVwiOlxuICAgICAgICBmb3IodmFyIGNoaWxkIG9mIHJvb3QuY2hpbGRyZW4pIHtcbiAgICAgICAgICBjb2RlICs9IHRoaXMuY29tcGlsZUFTVChjaGlsZCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiZGVjbGFyYXRpb25cIjpcbiAgICAgICAgY29kZSArPSBgdmFyICR7cm9vdC52YXJ9ID0gJHtyb290LnZhbHVlfTtcXG5gO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJmdW5jdGlvbkRlY2xhcmF0aW9uXCI6XG4gICAgICAgIGNvZGUgKz0gYHZhciBmdW5jJHtyb290Lml4fSA9IFF1ZXJ5RnVuY3Rpb25zWycke3Jvb3QuaW5mby5uYW1lfSddLmZ1bmM7XFxuYDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiZnVuY3Rpb25DYWxsXCI6XG4gICAgICAgIHZhciBpeCA9IHJvb3QuaXg7XG4gICAgICAgIHZhciBwcmV2ID0gXCJcIjtcbiAgICAgICAgaWYocm9vdC51bnByb2plY3RlZCkge1xuICAgICAgICAgIHByZXYgPSBgcm93JHtpeH1gO1xuICAgICAgICAgIGlmKHJvb3QuaW5mby5wYXJhbXMubGVuZ3RoID4gMSkgcHJldiArPSBcIixcIlxuICAgICAgICB9XG4gICAgICAgIGNvZGUgKz0gYHZhciByb3cke2l4fSA9IGZ1bmMke2l4fSgke3ByZXZ9JHt0aGlzLmNvbXBpbGVQYXJhbVN0cmluZyhyb290LmluZm8sIHJvb3QuYXJncywgcm9vdC51bnByb2plY3RlZCl9KTtcXG5gO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJmdW5jdGlvbkNhbGxNdWx0aVJldHVyblwiOlxuICAgICAgICB2YXIgaXggPSByb290Lml4O1xuICAgICAgICBjb2RlICs9IGB2YXIgcm93cyR7aXh9ID0gZnVuYyR7aXh9KCR7dGhpcy5jb21waWxlUGFyYW1TdHJpbmcocm9vdC5pbmZvLCByb290LmFyZ3MpfSk7XFxuYDtcbiAgICAgICAgY29kZSArPSBgZm9yKHZhciBmdW5jUmVzdWx0SXgke2l4fSA9IDAsIGZ1bmNMZW4ke2l4fSA9IHJvd3Mke2l4fS5sZW5ndGg7IGZ1bmNSZXN1bHRJeCR7aXh9IDwgZnVuY0xlbiR7aXh9OyBmdW5jUmVzdWx0SXgke2l4fSsrKSB7XFxuYFxuICAgICAgICBjb2RlICs9IGB2YXIgcm93JHtpeH0gPSByb3dzJHtpeH1bZnVuY1Jlc3VsdEl4JHtpeH1dO1xcbmA7XG4gICAgICAgIGZvcih2YXIgY2hpbGQgb2Ygcm9vdC5jaGlsZHJlbikge1xuICAgICAgICAgIGNvZGUgKz0gdGhpcy5jb21waWxlQVNUKGNoaWxkKTtcbiAgICAgICAgfVxuICAgICAgICBjb2RlICs9IFwifVxcblwiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJzZWxlY3RcIjpcbiAgICAgICAgdmFyIGl4ID0gcm9vdC5peDtcbiAgICAgICAgaWYocm9vdC5wYXNzZWQpIHtcbiAgICAgICAgICBjb2RlICs9IGB2YXIgcm93cyR7aXh9ID0gcm9vdFJvd3M7XFxuYDtcbiAgICAgICAgfSBlbHNlIGlmKHJvb3Quam9pbikge1xuICAgICAgICAgIGZvcihsZXQga2V5IGluIHJvb3Quam9pbikge1xuICAgICAgICAgICAgbGV0IG1hcHBpbmcgPSByb290LmpvaW5ba2V5XTtcbiAgICAgICAgICAgIGlmKG1hcHBpbmcuY29uc3RydWN0b3IgPT09IEFycmF5KSB7XG4gICAgICAgICAgICAgIGxldCBbdGFibGVJeCwgdmFsdWVdID0gbWFwcGluZztcbiAgICAgICAgICAgICAgY29kZSArPSBgcXVlcnkke2l4fVsnJHtrZXl9J10gPSByb3cke3RhYmxlSXh9Wycke3ZhbHVlfSddO1xcbmA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjb2RlICs9IGBxdWVyeSR7aXh9Wycke2tleX0nXSA9ICR7SlNPTi5zdHJpbmdpZnkobWFwcGluZyl9O1xcbmA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvZGUgKz0gYHZhciByb3dzJHtpeH0gPSBpeGVyLmZhY3RUb0luZGV4KGl4ZXIudGFibGUoJyR7cm9vdC50YWJsZX0nKSwgcXVlcnkke2l4fSk7XFxuYDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb2RlICs9IGB2YXIgcm93cyR7aXh9ID0gaXhlci50YWJsZSgnJHtyb290LnRhYmxlfScpLnRhYmxlO1xcbmA7XG4gICAgICAgIH1cbiAgICAgICAgaWYoIXJvb3QubmVnYXRlZCkge1xuICAgICAgICAgIGNvZGUgKz0gYGZvcih2YXIgcm93SXgke2l4fSA9IDAsIHJvd3NMZW4ke2l4fSA9IHJvd3Mke2l4fS5sZW5ndGg7IHJvd0l4JHtpeH0gPCByb3dzTGVuJHtpeH07IHJvd0l4JHtpeH0rKykge1xcbmBcbiAgICAgICAgICBjb2RlICs9IGB2YXIgcm93JHtpeH0gPSByb3dzJHtpeH1bcm93SXgke2l4fV07XFxuYDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb2RlICs9IGBpZighcm93cyR7aXh9Lmxlbmd0aCkge1xcbmBcbiAgICAgICAgfVxuICAgICAgICBmb3IodmFyIGNoaWxkIG9mIHJvb3QuY2hpbGRyZW4pIHtcbiAgICAgICAgICBjb2RlICs9IHRoaXMuY29tcGlsZUFTVChjaGlsZCk7XG4gICAgICAgIH1cbiAgICAgICAgY29kZSArPSBcIn1cXG5cIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwicmVzdWx0XCI6XG4gICAgICAgIHZhciByZXN1bHRzID0gW107XG4gICAgICAgIGZvcih2YXIgcmVzdWx0IG9mIHJvb3QucmVzdWx0cykge1xuICAgICAgICAgIGlmKHJlc3VsdC50eXBlID09PSBcInBsYWNlaG9sZGVyXCIpIHtcbiAgICAgICAgICAgIHJlc3VsdHMucHVzaChcInVuZGVmaW5lZFwiKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbGV0IGl4ID0gcmVzdWx0Lml4O1xuICAgICAgICAgICAgcmVzdWx0cy5wdXNoKGByb3cke2l4fWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb2RlICs9IGB1bnByb2plY3RlZC5wdXNoKCR7cmVzdWx0cy5qb2luKFwiLCBcIil9KTtcXG5gO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJzb3J0XCI6XG4gICAgICAgIGNvZGUgKz0gZ2VuZXJhdGVVbnByb2plY3RlZFNvcnRlckNvZGUocm9vdC5zaXplLCByb290LnNvcnRzKStcIlxcblwiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJhZ2dyZWdhdGUgbG9vcFwiOlxuICAgICAgICB2YXIgcHJvamVjdGlvbiA9IFwiXCI7XG4gICAgICAgIHZhciBhZ2dyZWdhdGVDYWxscyA9IFtdO1xuICAgICAgICB2YXIgYWdncmVnYXRlU3RhdGVzID0gW107XG4gICAgICAgIHZhciBhZ2dyZWdhdGVSZXNldHMgPSBbXTtcbiAgICAgICAgdmFyIHVucHJvamVjdGVkID0ge307XG4gICAgICAgIHZhciBvcmRpbmFsOnN0cmluZ3xib29sZWFuID0gZmFsc2U7XG4gICAgICAgIHZhciBwcm92ZW5hbmNlQ29kZTtcbiAgICAgICAgZm9yKGxldCBhZ2cgb2Ygcm9vdC5jaGlsZHJlbikge1xuICAgICAgICAgIGlmKGFnZy50eXBlID09PSBcImZ1bmN0aW9uQ2FsbFwiKSB7XG4gICAgICAgICAgICB1bnByb2plY3RlZFthZ2cuaXhdID0gdHJ1ZTtcbiAgICAgICAgICAgIGxldCBjb21waWxlZCA9IHRoaXMuY29tcGlsZUFTVChhZ2cpO1xuICAgICAgICAgICAgY29tcGlsZWQgKz0gYFxcbnVucHJvamVjdGVkW2l4ICsgJHthZ2cucmVzdWx0c0l4fV0gPSByb3cke2FnZy5peH07XFxuYDtcbiAgICAgICAgICAgIGFnZ3JlZ2F0ZUNhbGxzLnB1c2goY29tcGlsZWQpO1xuICAgICAgICAgICAgYWdncmVnYXRlU3RhdGVzLnB1c2goYHZhciByb3cke2FnZy5peH0gPSB7fTtgKTtcbiAgICAgICAgICAgIGFnZ3JlZ2F0ZVJlc2V0cy5wdXNoKGByb3cke2FnZy5peH0gPSB7fTtgKTtcbiAgICAgICAgICB9IGVsc2UgaWYoYWdnLnR5cGUgPT09IFwicHJvamVjdGlvblwiKSB7XG4gICAgICAgICAgICBhZ2cudW5wcm9qZWN0ZWQgPSB1bnByb2plY3RlZDtcbiAgICAgICAgICAgIHByb2plY3Rpb24gPSB0aGlzLmNvbXBpbGVBU1QoYWdnKTtcbiAgICAgICAgICB9IGVsc2UgaWYoYWdnLnR5cGUgPT09IFwib3JkaW5hbFwiKSB7XG4gICAgICAgICAgICBvcmRpbmFsID0gYHVucHJvamVjdGVkW2l4KyR7dGhpcy51bnByb2plY3RlZFNpemUgLSAxfV0gPSByZXN1bHRDb3VudDtcXG5gO1xuICAgICAgICAgIH0gZWxzZSBpZihhZ2cudHlwZSA9PT0gXCJwcm92ZW5hbmNlXCIpIHtcbiAgICAgICAgICAgIHByb3ZlbmFuY2VDb2RlID0gdGhpcy5jb21waWxlQVNUKGFnZyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHZhciBhZ2dyZWdhdGVDYWxsc0NvZGUgPSBhZ2dyZWdhdGVDYWxscy5qb2luKFwiXCIpO1xuXG4gICAgICAgIHZhciBkaWZmZXJlbnRHcm91cENoZWNrcyA9IFtdO1xuICAgICAgICB2YXIgZ3JvdXBDaGVjayA9IGBmYWxzZWA7XG4gICAgICAgIGlmKHJvb3QuZ3JvdXBzKSB7XG4gICAgICAgICAgZm9yKGxldCBncm91cCBvZiByb290Lmdyb3Vwcykge1xuICAgICAgICAgICAgbGV0IFt0YWJsZSwgZmllbGRdID0gZ3JvdXA7XG4gICAgICAgICAgICBkaWZmZXJlbnRHcm91cENoZWNrcy5wdXNoKGB1bnByb2plY3RlZFtuZXh0SXggKyAke3RhYmxlfV1bJyR7ZmllbGR9J10gIT09IHVucHJvamVjdGVkW2l4ICsgJHt0YWJsZX1dWycke2ZpZWxkfSddYCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGdyb3VwQ2hlY2sgPSBgKCR7ZGlmZmVyZW50R3JvdXBDaGVja3Muam9pbihcIiB8fCBcIil9KWA7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcmVzdWx0c0NoZWNrID0gXCJcIjtcbiAgICAgICAgaWYocm9vdC5saW1pdCAmJiByb290LmxpbWl0LnJlc3VsdHMpIHtcbiAgICAgICAgICBsZXQgbGltaXRWYWx1ZSA9IHJvb3QubGltaXQucmVzdWx0cztcbiAgICAgICAgICBsZXQgb2Zmc2V0ID0gcm9vdC5saW1pdC5vZmZzZXQ7XG4gICAgICAgICAgaWYob2Zmc2V0KSB7XG4gICAgICAgICAgICBsaW1pdFZhbHVlICs9IG9mZnNldDtcbiAgICAgICAgICAgIHByb2plY3Rpb24gPSBgaWYocmVzdWx0Q291bnQgPj0gJHtvZmZzZXR9KSB7XG4gICAgICAgICAgICAgICR7cHJvamVjdGlvbn1cbiAgICAgICAgICAgIH1gO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXN1bHRzQ2hlY2sgPSBgaWYocmVzdWx0Q291bnQgPT09ICR7bGltaXRWYWx1ZX0pIGJyZWFrO2A7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGdyb3VwTGltaXRDaGVjayA9IFwiXCI7XG4gICAgICAgIGlmKHJvb3QubGltaXQgJiYgcm9vdC5saW1pdC5wZXJHcm91cCAmJiByb290Lmdyb3Vwcykge1xuICAgICAgICAgIGxldCBsaW1pdFZhbHVlID0gcm9vdC5saW1pdC5wZXJHcm91cDtcbiAgICAgICAgICBsZXQgb2Zmc2V0ID0gcm9vdC5saW1pdC5vZmZzZXQ7XG4gICAgICAgICAgaWYob2Zmc2V0KSB7XG4gICAgICAgICAgICBsaW1pdFZhbHVlICs9IG9mZnNldDtcbiAgICAgICAgICAgIGFnZ3JlZ2F0ZUNhbGxzQ29kZSA9IGBpZihwZXJHcm91cENvdW50ID49ICR7b2Zmc2V0fSkge1xuICAgICAgICAgICAgICAke2FnZ3JlZ2F0ZUNhbGxzQ29kZX1cbiAgICAgICAgICAgIH1gO1xuICAgICAgICAgIH1cbiAgICAgICAgICBncm91cExpbWl0Q2hlY2sgPSBgaWYocGVyR3JvdXBDb3VudCA9PT0gJHtsaW1pdFZhbHVlfSkge1xuICAgICAgICAgICAgd2hpbGUoIWRpZmZlcmVudEdyb3VwKSB7XG4gICAgICAgICAgICAgIG5leHRJeCArPSAke3Jvb3Quc2l6ZX07XG4gICAgICAgICAgICAgIGlmKG5leHRJeCA+PSBsZW4pIGJyZWFrO1xuICAgICAgICAgICAgICBncm91cEluZm9bbmV4dEl4XSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgZGlmZmVyZW50R3JvdXAgPSAke2dyb3VwQ2hlY2t9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1gO1xuICAgICAgICB9XG4gICAgICAgIHZhciBncm91cERpZmZlcmVuY2UgPSBcIlwiO1xuICAgICAgICB2YXIgZ3JvdXBJbmZvID0gXCJcIjtcbiAgICAgICAgaWYodGhpcy5ncm91cHMpIHtcbiAgICAgICAgICBncm91cEluZm8gPSBcImdyb3VwSW5mb1tpeF0gPSByZXN1bHRDb3VudDtcIjtcbiAgICAgICAgICBsZXQgZ3JvdXBQcm9qZWN0aW9uID0gYCR7cHJvamVjdGlvbn1yZXN1bHRDb3VudCsrO2BcbiAgICAgICAgICBpZihyb290LmxpbWl0ICYmIHJvb3QubGltaXQub2Zmc2V0KSB7XG4gICAgICAgICAgICBncm91cFByb2plY3Rpb24gPSBgaWYocGVyR3JvdXBDb3VudCA+ICR7cm9vdC5saW1pdC5vZmZzZXR9KSB7XG4gICAgICAgICAgICAgICR7Z3JvdXBQcm9qZWN0aW9ufVxuICAgICAgICAgICAgfWA7XG4gICAgICAgICAgICBncm91cEluZm8gPSBgaWYocGVyR3JvdXBDb3VudCA+PSAke3Jvb3QubGltaXQub2Zmc2V0fSkge1xuICAgICAgICAgICAgICAke2dyb3VwSW5mb31cbiAgICAgICAgICAgIH1gO1xuICAgICAgICAgIH1cbiAgICAgICAgICBncm91cERpZmZlcmVuY2UgPSBgXG4gICAgICAgICAgcGVyR3JvdXBDb3VudCsrXG4gICAgICAgICAgdmFyIGRpZmZlcmVudEdyb3VwID0gJHtncm91cENoZWNrfTtcbiAgICAgICAgICAke2dyb3VwTGltaXRDaGVja31cbiAgICAgICAgICBpZihkaWZmZXJlbnRHcm91cCkge1xuICAgICAgICAgICAgJHtncm91cFByb2plY3Rpb259XG4gICAgICAgICAgICAke2FnZ3JlZ2F0ZVJlc2V0cy5qb2luKFwiXFxuXCIpfVxuICAgICAgICAgICAgcGVyR3JvdXBDb3VudCA9IDA7XG4gICAgICAgICAgfVxcbmA7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZ3JvdXBEaWZmZXJlbmNlID0gXCJyZXN1bHRDb3VudCsrO1xcblwiO1xuICAgICAgICAgIGdyb3VwSW5mbyA9IFwiZ3JvdXBJbmZvW2l4XSA9IDA7XCJcbiAgICAgICAgfVxuICAgICAgICAvLyBpZiB0aGVyZSBhcmUgbmVpdGhlciBhZ2dyZWdhdGVzIHRvIGNhbGN1bGF0ZSBub3IgZ3JvdXBzIHRvIGJ1aWxkLFxuICAgICAgICAvLyB0aGVuIHdlIGp1c3QgbmVlZCB0byB3b3JyeSBhYm91dCBsaW1pdGluZ1xuICAgICAgICBpZighdGhpcy5ncm91cHMgJiYgYWdncmVnYXRlQ2FsbHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgY29kZSA9IGB2YXIgaXggPSAwO1xuICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdENvdW50ID0gMDtcbiAgICAgICAgICAgICAgICAgIHZhciBsZW4gPSB1bnByb2plY3RlZC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICB3aGlsZShpeCA8IGxlbikge1xuICAgICAgICAgICAgICAgICAgICAke3Jlc3VsdHNDaGVja31cbiAgICAgICAgICAgICAgICAgICAgJHtvcmRpbmFsIHx8IFwiXCJ9XG4gICAgICAgICAgICAgICAgICAgICR7cHJvdmVuYW5jZUNvZGV9XG4gICAgICAgICAgICAgICAgICAgICR7cHJvamVjdGlvbn1cbiAgICAgICAgICAgICAgICAgICAgZ3JvdXBJbmZvW2l4XSA9IHJlc3VsdENvdW50O1xuICAgICAgICAgICAgICAgICAgICByZXN1bHRDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICBpeCArPSAke3Jvb3Quc2l6ZX07XG4gICAgICAgICAgICAgICAgICB9XFxuYDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgICBjb2RlID0gYHZhciByZXN1bHRDb3VudCA9IDA7XG4gICAgICAgICAgICAgICAgdmFyIHBlckdyb3VwQ291bnQgPSAwO1xuICAgICAgICAgICAgICAgIHZhciBpeCA9IDA7XG4gICAgICAgICAgICAgICAgdmFyIG5leHRJeCA9IDA7XG4gICAgICAgICAgICAgICAgdmFyIGxlbiA9IHVucHJvamVjdGVkLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAke2FnZ3JlZ2F0ZVN0YXRlcy5qb2luKFwiXFxuXCIpfVxuICAgICAgICAgICAgICAgIHdoaWxlKGl4IDwgbGVuKSB7XG4gICAgICAgICAgICAgICAgICAke2FnZ3JlZ2F0ZUNhbGxzQ29kZX1cbiAgICAgICAgICAgICAgICAgICR7Z3JvdXBJbmZvfVxuICAgICAgICAgICAgICAgICAgJHtvcmRpbmFsIHx8IFwiXCJ9XG4gICAgICAgICAgICAgICAgICAke3Byb3ZlbmFuY2VDb2RlfVxuICAgICAgICAgICAgICAgICAgaWYoaXggKyAke3Jvb3Quc2l6ZX0gPT09IGxlbikge1xuICAgICAgICAgICAgICAgICAgICAke3Byb2plY3Rpb259XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgbmV4dEl4ICs9ICR7cm9vdC5zaXplfTtcbiAgICAgICAgICAgICAgICAgICR7Z3JvdXBEaWZmZXJlbmNlfVxuICAgICAgICAgICAgICAgICAgJHtyZXN1bHRzQ2hlY2t9XG4gICAgICAgICAgICAgICAgICBpeCA9IG5leHRJeDtcbiAgICAgICAgICAgICAgICB9XFxuYDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwicHJvamVjdGlvblwiOlxuICAgICAgICB2YXIgcHJvamVjdGVkVmFycyA9IFtdO1xuICAgICAgICB2YXIgaWRTdHJpbmdQYXJ0cyA9IFtdO1xuICAgICAgICBmb3IobGV0IG5ld0ZpZWxkIGluIHJvb3QucHJvamVjdGlvbk1hcCkge1xuICAgICAgICAgIGxldCBtYXBwaW5nID0gcm9vdC5wcm9qZWN0aW9uTWFwW25ld0ZpZWxkXTtcbiAgICAgICAgICBsZXQgdmFsdWUgPSBcIlwiO1xuICAgICAgICAgIGlmKG1hcHBpbmcuY29uc3RydWN0b3IgPT09IEFycmF5KSB7XG4gICAgICAgICAgICBpZihtYXBwaW5nWzFdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgdmFsdWUgPSBgdW5wcm9qZWN0ZWRbaXggKyAke21hcHBpbmdbMF19XWA7XG4gICAgICAgICAgICB9IGVsc2UgaWYoIXJvb3QudW5wcm9qZWN0ZWQgfHwgcm9vdC51bnByb2plY3RlZFttYXBwaW5nWzBdXSkge1xuICAgICAgICAgICAgICB2YWx1ZSA9IGByb3cke21hcHBpbmdbMF19Wycke21hcHBpbmdbMV19J11gO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdmFsdWUgPSBgdW5wcm9qZWN0ZWRbaXggKyAke21hcHBpbmdbMF19XVsnJHttYXBwaW5nWzFdfSddYDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFsdWUgPSBKU09OLnN0cmluZ2lmeShtYXBwaW5nKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcHJvamVjdGVkVmFycy5wdXNoKGBwcm9qZWN0ZWRbJyR7bmV3RmllbGQucmVwbGFjZSgvJy9nLCBcIlxcXFwnXCIpfSddID0gJHt2YWx1ZX1gKTtcbiAgICAgICAgICBpZFN0cmluZ1BhcnRzLnB1c2godmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIGNvZGUgKz0gcHJvamVjdGVkVmFycy5qb2luKFwiO1xcblwiKSArIFwiXFxuXCI7XG4gICAgICAgIGNvZGUgKz0gYHByb2plY3RlZC5fX2lkID0gJHtpZFN0cmluZ1BhcnRzLmpvaW4oYCArIFwifFwiICsgYCl9O1xcbmA7XG4gICAgICAgIGNvZGUgKz0gYHJlc3VsdHMucHVzaChwcm9qZWN0ZWQpO1xcbmA7XG4gICAgICAgIGNvZGUgKz0gYHByb2plY3RlZCA9IHt9O1xcbmA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInByb3ZlbmFuY2VcIjpcbiAgICAgICAgdmFyIHByb3ZlbmFuY2UgPSBcInZhciBwcm92ZW5hbmNlX19pZCA9ICcnO1xcblwiO1xuICAgICAgICB2YXIgaWRzID0gW107XG4gICAgICAgIGZvcihsZXQgam9pbiBvZiB0aGlzLmpvaW5zKSB7XG4gICAgICAgICAgaWYoam9pbi5uZWdhdGVkKSBjb250aW51ZTtcbiAgICAgICAgICBwcm92ZW5hbmNlICs9IGBwcm92ZW5hbmNlX19pZCA9IHRhYmxlSWQgKyAnfCcgKyBwcm9qZWN0ZWQuX19pZCArICd8JyArIHJvd0luc3RhbmNlICsgJ3wke2pvaW4udGFibGV9fCcgKyByb3cke2pvaW4uaXh9Ll9faWQ7IFxcbmA7XG4gICAgICAgICAgcHJvdmVuYW5jZSArPSBgcHJvdmVuYW5jZS5wdXNoKHt0YWJsZTogdGFibGVJZCwgcm93OiBwcm9qZWN0ZWQsIFwicm93IGluc3RhbmNlXCI6IHJvd0luc3RhbmNlLCBzb3VyY2U6IFwiJHtqb2luLnRhYmxlfVwiLCBcInNvdXJjZSByb3dcIjogcm93JHtqb2luLml4fX0pO1xcbmA7XG4gICAgICAgICAgaWRzLnB1c2goYHJvdyR7am9pbi5peH0uX19pZGApO1xuICAgICAgICB9XG4gICAgICAgIGNvZGUgPSBgdmFyIHJvd0luc3RhbmNlID0gJHtpZHMuam9pbihcIiArICd8JyArIFwiKX07XG4gICAgICAgICR7cHJvdmVuYW5jZX1gO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJyZXR1cm5cIjpcbiAgICAgICAgdmFyIHJldHVybnMgPSBbXTtcbiAgICAgICAgZm9yKGxldCBjdXJWYXIgb2Ygcm9vdC52YXJzKSB7XG4gICAgICAgICAgcmV0dXJucy5wdXNoKGAke2N1clZhcn06ICR7Y3VyVmFyfWApO1xuICAgICAgICB9XG4gICAgICAgIGNvZGUgKz0gYHJldHVybiB7JHtyZXR1cm5zLmpvaW4oXCIsIFwiKX19O2A7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICByZXR1cm4gY29kZTtcbiAgfVxuICAvLyBnaXZlbiBhIHNldCBvZiBjaGFuZ2VzIGFuZCBhIGpvaW4gb3JkZXIsIGRldGVybWluZSB0aGUgcm9vdCBmYWN0cyB0aGF0IG5lZWRcbiAgLy8gdG8gYmUgam9pbmVkIGFnYWluIHRvIGNvdmVyIGFsbCB0aGUgYWRkc1xuICByZXZlcnNlSm9pbihqb2lucykge1xuICAgIGxldCBjaGFuZ2VkID0gam9pbnNbMF07XG4gICAgbGV0IHJldmVyc2VKb2luTWFwID0ge307XG4gICAgLy8gY29sbGVjdCBhbGwgdGhlIGNvbnN0cmFpbnRzIGFuZCByZXZlcnNlIHRoZW1cbiAgICBmb3IgKGxldCBqb2luIG9mIGpvaW5zKSB7XG4gICAgICBmb3IgKGxldCBrZXkgaW4gam9pbi5qb2luKSB7XG4gICAgICAgIGxldCBbc291cmNlLCBmaWVsZF0gPSBqb2luLmpvaW5ba2V5XTtcbiAgICAgICAgaWYgKHNvdXJjZSA8PSBjaGFuZ2VkLml4KSB7XG4gICAgICAgICAgaWYgKCFyZXZlcnNlSm9pbk1hcFtzb3VyY2VdKSB7XG4gICAgICAgICAgICByZXZlcnNlSm9pbk1hcFtzb3VyY2VdID0ge307XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmKCFyZXZlcnNlSm9pbk1hcFtzb3VyY2VdW2ZpZWxkXSkgcmV2ZXJzZUpvaW5NYXBbc291cmNlXVtmaWVsZF0gPSBbam9pbi5peCwga2V5XTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICB2YXIgcmVjdXJzZSA9IChqb2lucywgam9pbkl4KSA9PiB7XG4gICAgICB2YXIgY29kZSA9IFwiXCI7XG4gICAgICBpZiAoam9pbkl4ID49IGpvaW5zLmxlbmd0aCkge1xuICAgICAgICByZXR1cm4gXCJvdGhlcnMucHVzaChyb3cwKVwiO1xuICAgICAgfVxuICAgICAgbGV0IHt0YWJsZSwgaXgsIG5lZ2F0ZWR9ID0gam9pbnNbam9pbkl4XTtcbiAgICAgIGxldCBqb2luTWFwID0gam9pbnNbam9pbkl4XS5qb2luO1xuICAgICAgLy8gd2Ugb25seSBjYXJlIGFib3V0IHRoaXMgZ3V5IGlmIGhlJ3Mgam9pbmVkIHdpdGggYXQgbGVhc3Qgb25lIHRoaW5nXG4gICAgICBpZiAoIXJldmVyc2VKb2luTWFwW2l4XSAmJiBqb2luSXggPCBqb2lucy5sZW5ndGggLSAxKSByZXR1cm4gcmVjdXJzZShqb2lucywgam9pbkl4ICsgMSk7XG4gICAgICBlbHNlIGlmKCFyZXZlcnNlSm9pbk1hcCkgcmV0dXJuIFwiXCI7XG4gICAgICBsZXQgbWFwcGluZ3MgPSBbXTtcbiAgICAgIGZvciAobGV0IGtleSBpbiByZXZlcnNlSm9pbk1hcFtpeF0pIHtcbiAgICAgICAgbGV0IFtzb3VyY2VJeCwgZmllbGRdID0gcmV2ZXJzZUpvaW5NYXBbaXhdW2tleV07XG4gICAgICAgIGlmKHNvdXJjZUl4ID09PSBjaGFuZ2VkLml4IHx8IHJldmVyc2VKb2luTWFwW3NvdXJjZUl4XSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgbWFwcGluZ3MucHVzaChgJyR7a2V5fSc6IHJvdyR7c291cmNlSXh9Wycke2ZpZWxkfSddYCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGZvcihsZXQga2V5IGluIGpvaW5NYXApIHtcbiAgICAgICAgbGV0IHZhbHVlID0gam9pbk1hcFtrZXldO1xuICAgICAgICBpZih2YWx1ZS5jb25zdHJ1Y3RvciAhPT0gQXJyYXkpIHtcbiAgICAgICAgICBtYXBwaW5ncy5wdXNoKGAnJHtrZXl9JzogJHtKU09OLnN0cmluZ2lmeSh2YWx1ZSl9YCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChuZWdhdGVkKSB7XG4gICAgICAgIC8vQFRPRE86IGRlYWwgd2l0aCBuZWdhdGlvbjtcbiAgICAgIH1cbiAgICAgIGNvZGUgKz0gYFxuICAgICAgICAgICAgdmFyIHJvd3Mke2l4fSA9IGV2ZS5maW5kKCcke3RhYmxlfScsIHske21hcHBpbmdzLmpvaW4oXCIsIFwiKSB9fSk7XG4gICAgICAgICAgICBmb3IodmFyIHJvd3NJeCR7aXh9ID0gMCwgcm93c0xlbiR7aXh9ID0gcm93cyR7aXh9Lmxlbmd0aDsgcm93c0l4JHtpeH0gPCByb3dzTGVuJHtpeH07IHJvd3NJeCR7aXh9KyspIHtcbiAgICAgICAgICAgICAgICB2YXIgcm93JHtpeH0gPSByb3dzJHtpeH1bcm93c0l4JHtpeH1dO1xuICAgICAgICAgICAgICAgICR7cmVjdXJzZShqb2lucywgam9pbkl4ICsgMSkgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYDtcbiAgICAgIHJldHVybiBjb2RlO1xuICAgIH1cbiAgICByZXR1cm4gcmVjdXJzZShqb2lucywgMSk7XG5cdH1cbiAgY29tcGlsZUluY3JlbWVudGFsUm93RmluZGVyQ29kZSgpIHtcbiAgICAgIGxldCBjb2RlID0gXCJ2YXIgb3RoZXJzID0gW107XFxuXCI7XG4gICAgICBsZXQgcmV2ZXJzZWQgPSB0aGlzLmpvaW5zLnNsaWNlKCkucmV2ZXJzZSgpO1xuICAgICAgbGV0IGNoZWNrcyA9IFtdO1xuICAgICAgbGV0IGl4ID0gMDtcbiAgICAgIGZvciAobGV0IGpvaW4gb2YgcmV2ZXJzZWQpIHtcbiAgICAgICAgICAvLyB3ZSBkb24ndCB3YW50IHRvIGRvIHRoaXMgZm9yIHRoZSByb290XG4gICAgICAgICAgaWYgKGl4ID09PSByZXZlcnNlZC5sZW5ndGggLSAxKSBicmVhaztcbiAgICAgICAgICBjaGVja3MucHVzaChgXG5cdFx0XHRpZihjaGFuZ2VzW1wiJHtqb2luLnRhYmxlfVwiXSAmJiBjaGFuZ2VzW1wiJHtqb2luLnRhYmxlfVwiXS5hZGRzKSB7XG4gICAgICAgICAgICAgICAgdmFyIGN1ckNoYW5nZXMke2pvaW4uaXh9ID0gY2hhbmdlc1tcIiR7am9pbi50YWJsZX1cIl0uYWRkcztcbiAgICAgICAgICAgICAgICBmb3IodmFyIGNoYW5nZUl4JHtqb2luLml4fSA9IDAsIGNoYW5nZUxlbiR7am9pbi5peH0gPSBjdXJDaGFuZ2VzJHtqb2luLml4fS5sZW5ndGg7IGNoYW5nZUl4JHtqb2luLml4fSA8IGNoYW5nZUxlbiR7am9pbi5peH07IGNoYW5nZUl4JHtqb2luLml4fSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByb3cke2pvaW4uaXh9ID0gY3VyQ2hhbmdlcyR7am9pbi5peH1bY2hhbmdlSXgke2pvaW4uaXh9XTtcblx0XHRcdFx0XHQke3RoaXMucmV2ZXJzZUpvaW4ocmV2ZXJzZWQuc2xpY2UoaXgpKX1cblx0XHRcdFx0fVxuXHRcdFx0fWApO1xuICAgICAgICAgIGl4Kys7XG4gICAgICB9XG4gICAgICBjb2RlICs9IGNoZWNrcy5qb2luKFwiIGVsc2VcIik7XG4gICAgICB2YXIgbGFzdCA9IHJldmVyc2VkW2l4XTtcbiAgICAgIGNvZGUgKz0gYFxuXHRcdFx0aWYoY2hhbmdlc1tcIiR7bGFzdC50YWJsZX1cIl0gJiYgY2hhbmdlc1tcIiR7bGFzdC50YWJsZX1cIl0uYWRkcykge1xuICAgICAgICAgICAgICAgIHZhciBjdXJDaGFuZ2VzID0gY2hhbmdlc1tcIiR7bGFzdC50YWJsZX1cIl0uYWRkcztcblx0XHRcdFx0Zm9yKHZhciBjaGFuZ2VJeCA9IDAsIGNoYW5nZUxlbiA9IGN1ckNoYW5nZXMubGVuZ3RoOyBjaGFuZ2VJeCA8IGNoYW5nZUxlbjsgY2hhbmdlSXgrKykge1xuXHRcdFx0XHRcdG90aGVycy5wdXNoKGN1ckNoYW5nZXNbY2hhbmdlSXhdKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIG90aGVycztgO1xuICAgICAgcmV0dXJuIGNvZGU7XG4gIH1cbiAgaW5jcmVtZW50YWxSZW1vdmUoY2hhbmdlcykge1xuICAgIGxldCBpeGVyID0gdGhpcy5peGVyO1xuICAgIGxldCByb3dzVG9Qb3N0Q2hlY2sgPSBbXTtcbiAgICBsZXQgcHJvdmVuYW5jZURpZmYgPSB0aGlzLml4ZXIuZGlmZigpO1xuICAgIGxldCByZW1vdmVzID0gW107XG4gICAgbGV0IGluZGV4ZXMgPSBpeGVyLnRhYmxlKFwicHJvdmVuYW5jZVwiKS5pbmRleGVzO1xuICAgIGxldCBzb3VyY2VSb3dMb29rdXAgPSBpbmRleGVzW1wic291cmNlfHNvdXJjZSByb3d8dGFibGVcIl0uaW5kZXg7XG4gICAgbGV0IHJvd0luc3RhbmNlTG9va3VwID0gaW5kZXhlc1tcInJvdyBpbnN0YW5jZXx0YWJsZVwiXS5pbmRleDtcbiAgICBsZXQgdGFibGVSb3dMb29rdXAgPSBpbmRleGVzW1wicm93fHRhYmxlXCJdLmluZGV4O1xuICAgIGxldCBwcm92ZW5hbmNlUmVtb3ZlcyA9IFtdO1xuICAgIGxldCB2aXNpdGVkID0ge31cbiAgICBmb3IobGV0IGpvaW4gb2YgdGhpcy5qb2lucykge1xuICAgICAgbGV0IGNoYW5nZSA9IGNoYW5nZXNbam9pbi50YWJsZV07XG4gICAgICBpZighdmlzaXRlZFtqb2luLnRhYmxlXSAmJiBjaGFuZ2UgJiYgY2hhbmdlLnJlbW92ZXMubGVuZ3RoKSB7XG4gICAgICAgIHZpc2l0ZWRbam9pbi50YWJsZV0gPSB0cnVlO1xuICAgICAgICBmb3IobGV0IHJlbW92ZSBvZiBjaGFuZ2UucmVtb3Zlcykge1xuICAgICAgICAgIGxldCBwcm92ZW5hbmNlcyA9IHNvdXJjZVJvd0xvb2t1cFtqb2luLnRhYmxlICsgJ3wnICsgcmVtb3ZlLl9faWQgKyAnfCcgKyB0aGlzLm5hbWVdXG4gICAgICAgICAgaWYocHJvdmVuYW5jZXMpIHtcbiAgICAgICAgICAgIGZvcihsZXQgcHJvdmVuYW5jZSBvZiBwcm92ZW5hbmNlcykge1xuICAgICAgICAgICAgICBpZighdmlzaXRlZFtwcm92ZW5hbmNlW1wicm93IGluc3RhbmNlXCJdXSkge1xuICAgICAgICAgICAgICAgIHZpc2l0ZWRbcHJvdmVuYW5jZVtcInJvdyBpbnN0YW5jZVwiXV0gPSB0cnVlO1xuICAgICAgICAgICAgICAgIGxldCByZWxhdGVkUHJvdmVuYW5jZSA9IHJvd0luc3RhbmNlTG9va3VwW3Byb3ZlbmFuY2VbXCJyb3cgaW5zdGFuY2VcIl0gKyAnfCcgKyBwcm92ZW5hbmNlLnRhYmxlXTtcbiAgICAgICAgICAgICAgICBmb3IobGV0IHJlbGF0ZWQgb2YgcmVsYXRlZFByb3ZlbmFuY2UpIHtcbiAgICAgICAgICAgICAgICAgIHByb3ZlbmFuY2VSZW1vdmVzLnB1c2gocmVsYXRlZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHJvd3NUb1Bvc3RDaGVjay5wdXNoKHByb3ZlbmFuY2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBwcm92ZW5hbmNlRGlmZi5yZW1vdmVGYWN0cyhcInByb3ZlbmFuY2VcIiwgcHJvdmVuYW5jZVJlbW92ZXMpO1xuICAgIGl4ZXIuYXBwbHlEaWZmSW5jcmVtZW50YWwocHJvdmVuYW5jZURpZmYpO1xuICAgIGxldCBpc0VkYiA9IGl4ZXIuZWRiVGFibGVzO1xuICAgIGZvcihsZXQgcm93IG9mIHJvd3NUb1Bvc3RDaGVjaykge1xuICAgICAgbGV0IHN1cHBvcnRzID0gdGFibGVSb3dMb29rdXBbcm93LnJvdy5fX2lkICsgJ3wnICsgcm93LnRhYmxlXTtcbiAgICAgIGlmKCFzdXBwb3J0cyB8fCBzdXBwb3J0cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmVtb3Zlcy5wdXNoKHJvdy5yb3cpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVtb3ZlcztcbiAgfVxuICBjYW5CZUluY3JlbWVudGFsKCkge1xuICAgIGlmKHRoaXMuYWdncmVnYXRlcy5sZW5ndGgpIHJldHVybiBmYWxzZTtcbiAgICBpZih0aGlzLnNvcnRzKSByZXR1cm4gZmFsc2U7XG4gICAgaWYodGhpcy5ncm91cHMpIHJldHVybiBmYWxzZTtcbiAgICBpZih0aGlzLmxpbWl0SW5mbykgcmV0dXJuIGZhbHNlO1xuICAgIGZvcihsZXQgam9pbiBvZiB0aGlzLmpvaW5zKSB7XG4gICAgICBpZihqb2luLm5lZ2F0ZWQpIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaWYoIXRoaXMuam9pbnMubGVuZ3RoKSByZXR1cm4gZmFsc2U7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgY29tcGlsZSgpIHtcbiAgICBsZXQgYXN0ID0gdGhpcy50b0FTVCgpO1xuICAgIGxldCBjb2RlID0gdGhpcy5jb21waWxlQVNUKGFzdCk7XG4gICAgdGhpcy5jb21waWxlZCA9IG5ldyBGdW5jdGlvbihcIml4ZXJcIiwgXCJRdWVyeUZ1bmN0aW9uc1wiLCBcInRhYmxlSWRcIiwgXCJyb290Um93c1wiLCBjb2RlKTtcbiAgICBpZih0aGlzLmNhbkJlSW5jcmVtZW50YWwoKSkge1xuICAgICAgdGhpcy5pbmNyZW1lbnRhbFJvd0ZpbmRlciA9IG5ldyBGdW5jdGlvbihcImNoYW5nZXNcIiwgdGhpcy5jb21waWxlSW5jcmVtZW50YWxSb3dGaW5kZXJDb2RlKCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmluY3JlbWVudGFsUm93RmluZGVyID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgICB0aGlzLmRpcnR5ID0gZmFsc2U7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgZXhlYygpIHtcbiAgICBpZih0aGlzLmRpcnR5KSB7XG4gICAgICB0aGlzLmNvbXBpbGUoKTtcbiAgICB9XG4gICAgbGV0IHJvb3QgPSB0aGlzLmpvaW5zWzBdO1xuICAgIGxldCByb3dzO1xuICAgIGlmKHJvb3QpIHtcbiAgICAgIHJvd3MgPSB0aGlzLml4ZXIuZmluZChyb290LnRhYmxlLCByb290LmpvaW4pO1xuICAgIH0gZWxzZSB7XG4gICAgICByb3dzID0gW107XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmNvbXBpbGVkKHRoaXMuaXhlciwgUXVlcnlGdW5jdGlvbnMsIHRoaXMubmFtZSwgcm93cyk7XG4gIH1cbiAgZXhlY0luY3JlbWVudGFsKGNoYW5nZXMsIHRhYmxlKToge3Byb3ZlbmFuY2U6IGFueVtdLCBhZGRzOiBhbnlbXSwgcmVtb3ZlczogYW55W119IHtcbiAgICBpZih0aGlzLmRpcnR5KSB7XG4gICAgICB0aGlzLmNvbXBpbGUoKTtcbiAgICB9XG4gICAgaWYodGhpcy5pbmNyZW1lbnRhbFJvd0ZpbmRlcikge1xuICAgICAgbGV0IHBvdGVudGlhbFJvd3MgPSB0aGlzLmluY3JlbWVudGFsUm93RmluZGVyKGNoYW5nZXMpO1xuICAgICAgLy8gaWYgdGhlIHJvb3Qgc2VsZWN0IGhhcyBzb21lIGNvbnN0YW50IGZpbHRlcnMsIHRoZW5cbiAgICAgIC8vIHRoZSBhYm92ZSByb3dzIG5lZWQgdG8gYmUgZmlsdGVyZWQgZG93biB0byBvbmx5IHRob3NlIHRoYXRcbiAgICAgIC8vIG1hdGNoLlxuICAgICAgbGV0IHJvd3MgPSBbXTtcbiAgICAgIGxldCByb290ID0gdGhpcy5qb2luc1swXTtcbiAgICAgIGxldCByb290S2V5cyA9IE9iamVjdC5rZXlzKHJvb3Quam9pbik7XG4gICAgICBpZihyb290S2V5cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJvd0xvb3A6IGZvcihsZXQgcm93IG9mIHBvdGVudGlhbFJvd3MpIHtcbiAgICAgICAgICBmb3IobGV0IGtleSBvZiByb290S2V5cykge1xuICAgICAgICAgICAgaWYocm93W2tleV0gIT09IHJvb3Quam9pbltrZXldKSBjb250aW51ZSByb3dMb29wO1xuICAgICAgICAgIH1cbiAgICAgICAgICByb3dzLnB1c2gocm93KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcm93cyA9IHBvdGVudGlhbFJvd3M7XG4gICAgICB9XG4gICAgICBsZXQgcmVzdWx0cyA9IHRoaXMuY29tcGlsZWQodGhpcy5peGVyLCBRdWVyeUZ1bmN0aW9ucywgdGhpcy5uYW1lLCByb3dzKTtcbiAgICAgIGxldCBhZGRzID0gW107XG4gICAgICBsZXQgcHJldkhhc2hlcyA9IHRhYmxlLmZhY3RIYXNoO1xuICAgICAgbGV0IHByZXZLZXlzID0gT2JqZWN0LmtleXMocHJldkhhc2hlcyk7XG4gICAgICBsZXQgc3VnZ2VzdGVkUmVtb3ZlcyA9IHRoaXMuaW5jcmVtZW50YWxSZW1vdmUoY2hhbmdlcyk7XG4gICAgICBsZXQgcmVhbERpZmYgPSBkaWZmQWRkc0FuZFJlbW92ZXMocmVzdWx0cy5yZXN1bHRzLCBzdWdnZXN0ZWRSZW1vdmVzKTtcbiAgICAgIGZvcihsZXQgcmVzdWx0IG9mIHJlYWxEaWZmLmFkZHMpIHtcbiAgICAgICAgbGV0IGlkID0gcmVzdWx0Ll9faWQ7XG4gICAgICAgIGlmKHByZXZIYXNoZXNbaWRdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBhZGRzLnB1c2gocmVzdWx0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgbGV0IGRpZmYgPSB0aGlzLml4ZXIuZGlmZigpO1xuICAgICAgZGlmZi5hZGRNYW55KFwicHJvdmVuYW5jZVwiLCByZXN1bHRzLnByb3ZlbmFuY2UpO1xuICAgICAgdGhpcy5peGVyLmFwcGx5RGlmZkluY3JlbWVudGFsKGRpZmYpO1xuICAgICAgLy8gY29uc29sZS5sb2coXCJJTkMgUFJPViBESUZGXCIsIHRoaXMubmFtZSwgZGlmZi5sZW5ndGgpO1xuICAgICAgcmV0dXJuIHtwcm92ZW5hbmNlOiByZXN1bHRzLnByb3ZlbmFuY2UsIGFkZHMsIHJlbW92ZXM6IHJlYWxEaWZmLnJlbW92ZXN9O1xuICAgIH0gZWxzZSB7XG4gICAgICBsZXQgcmVzdWx0cyA9IHRoaXMuZXhlYygpO1xuICAgICAgbGV0IGFkZHMgPSBbXTtcbiAgICAgIGxldCByZW1vdmVzID0gW107XG4gICAgICBsZXQgcHJldkhhc2hlcyA9IHRhYmxlLmZhY3RIYXNoO1xuICAgICAgbGV0IHByZXZLZXlzID0gT2JqZWN0LmtleXMocHJldkhhc2hlcyk7XG4gICAgICBsZXQgbmV3SGFzaGVzID0ge307XG4gICAgICBmb3IobGV0IHJlc3VsdCBvZiByZXN1bHRzLnJlc3VsdHMpIHtcbiAgICAgICAgbGV0IGlkID0gcmVzdWx0Ll9faWQ7XG4gICAgICAgIG5ld0hhc2hlc1tpZF0gPSByZXN1bHQ7XG4gICAgICAgIGlmKHByZXZIYXNoZXNbaWRdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBhZGRzLnB1c2gocmVzdWx0KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZm9yKGxldCBoYXNoIG9mIHByZXZLZXlzKSB7XG4gICAgICAgIGxldCB2YWx1ZSA9IG5ld0hhc2hlc1toYXNoXTtcbiAgICAgICAgaWYodmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICByZW1vdmVzLnB1c2gocHJldkhhc2hlc1toYXNoXSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGxldCByZWFsRGlmZiA9IGRpZmZBZGRzQW5kUmVtb3ZlcyhhZGRzLCByZW1vdmVzKTtcbiAgICAgIGxldCBkaWZmID0gdGhpcy5peGVyLmRpZmYoKTtcbiAgICAgIGRpZmYucmVtb3ZlKFwicHJvdmVuYW5jZVwiLCB7dGFibGU6IHRoaXMubmFtZX0pO1xuICAgICAgZGlmZi5hZGRNYW55KFwicHJvdmVuYW5jZVwiLCByZXN1bHRzLnByb3ZlbmFuY2UpO1xuICAgICAgdGhpcy5peGVyLmFwcGx5RGlmZkluY3JlbWVudGFsKGRpZmYpO1xuICAgICAgLy8gY29uc29sZS5sb2coXCJGVUxMIFBST1YgU0laRVwiLCB0aGlzLm5hbWUsIGRpZmYubGVuZ3RoKTtcbiAgICAgIHJldHVybiB7cHJvdmVuYW5jZTogcmVzdWx0cy5wcm92ZW5hbmNlLCBhZGRzOiByZWFsRGlmZi5hZGRzLCByZW1vdmVzOiByZWFsRGlmZi5yZW1vdmVzfTtcbiAgICB9XG4gIH1cbiAgZGVidWcoKSB7XG4gICAgY29uc29sZS5sb2codGhpcy5jb21waWxlQVNUKHRoaXMudG9BU1QoKSkpO1xuICAgIGNvbnNvbGUudGltZShcImV4ZWNcIik7XG4gICAgdmFyIHJlc3VsdHMgPSB0aGlzLmV4ZWMoKTtcbiAgICBjb25zb2xlLnRpbWVFbmQoXCJleGVjXCIpO1xuICAgIGNvbnNvbGUubG9nKHJlc3VsdHMpO1xuICAgIHJldHVybiByZXN1bHRzO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBVbmlvbiB7XG4gIG5hbWU7XG4gIHRhYmxlcztcbiAgc291cmNlcztcbiAgaXNTdGF0ZWZ1bDtcbiAgaGFzaGVyO1xuICBkaXJ0eTtcbiAgcHJldjtcbiAgY29tcGlsZWQ7XG4gIGl4ZXI7XG4gIGNvbnN0cnVjdG9yKGl4ZXIsIG5hbWUgPSBcInVua25vd25cIikge1xuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgdGhpcy5peGVyID0gaXhlcjtcbiAgICB0aGlzLnRhYmxlcyA9IFtdO1xuICAgIHRoaXMuc291cmNlcyA9IFtdO1xuICAgIHRoaXMuaXNTdGF0ZWZ1bCA9IGZhbHNlO1xuICAgIHRoaXMucHJldiA9IHtyZXN1bHRzOiBbXSwgaGFzaGVzOiB7fX07XG4gICAgdGhpcy5kaXJ0eSA9IHRydWU7XG4gIH1cbiAgY2hhbmdlc2V0KGl4ZXI6SW5kZXhlcikge1xuICAgIGxldCBkaWZmID0gaXhlci5kaWZmKCk7XG4gICAgZGlmZi5hZGQoXCJ2aWV3XCIsIHt2aWV3OiB0aGlzLm5hbWUsIGtpbmQ6IFwidW5pb25cIn0pO1xuICAgIGZvcihsZXQgc291cmNlIG9mIHRoaXMuc291cmNlcykge1xuICAgICAgaWYoc291cmNlLnR5cGUgPT09IFwiK1wiKSB7XG4gICAgICAgIGxldCBhY3Rpb24gPSB1dWlkKCk7XG4gICAgICAgIGRpZmYuYWRkKFwiYWN0aW9uXCIsIHt2aWV3OiB0aGlzLm5hbWUsIGFjdGlvbiwga2luZDogXCJ1bmlvblwiLCAgaXg6IDB9KTtcbiAgICAgICAgZGlmZi5hZGQoXCJhY3Rpb24gc291cmNlXCIsIHthY3Rpb24sIFwic291cmNlIHZpZXdcIjogc291cmNlLnRhYmxlfSk7XG4gICAgICAgIGZvcihsZXQgZmllbGQgaW4gc291cmNlLm1hcHBpbmcpIHtcbiAgICAgICAgICBsZXQgbWFwcGVkID0gc291cmNlLm1hcHBpbmdbZmllbGRdO1xuICAgICAgICAgIGlmKG1hcHBlZC5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIGRpZmYuYWRkKFwiYWN0aW9uIG1hcHBpbmdcIiwge2FjdGlvbiwgZnJvbTogZmllbGQsIFwidG8gc291cmNlXCI6IHNvdXJjZS50YWJsZSwgXCJ0byBmaWVsZFwiOiBtYXBwZWRbMF19KVxuICAgICAgICAgIGVsc2UgZGlmZi5hZGQoXCJhY3Rpb24gbWFwcGluZyBjb25zdGFudFwiLCB7YWN0aW9uLCBmcm9tOiBmaWVsZCwgdmFsdWU6IG1hcHBlZH0pO1xuICAgICAgICB9XG5cbiAgICAgIH0gZWxzZSB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gc291cmNlIHR5cGU6ICcke3NvdXJjZS50eXBlfSdgKTtcbiAgICB9XG4gICAgcmV0dXJuIGRpZmY7XG4gIH1cbiAgZW5zdXJlSGFzaGVyKG1hcHBpbmcpIHtcbiAgICBpZighdGhpcy5oYXNoZXIpIHtcbiAgICAgIHRoaXMuaGFzaGVyID0gZ2VuZXJhdGVTdHJpbmdGbihPYmplY3Qua2V5cyhtYXBwaW5nKSk7XG4gICAgfVxuICB9XG4gIHVuaW9uKHRhYmxlTmFtZSwgbWFwcGluZykge1xuICAgIHRoaXMuZGlydHkgPSB0cnVlO1xuICAgIHRoaXMuZW5zdXJlSGFzaGVyKG1hcHBpbmcpO1xuICAgIHRoaXMudGFibGVzLnB1c2godGFibGVOYW1lKTtcbiAgICB0aGlzLnNvdXJjZXMucHVzaCh7dHlwZTogXCIrXCIsIHRhYmxlOiB0YWJsZU5hbWUsIG1hcHBpbmd9KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuICB0b0FTVCgpIHtcbiAgICBsZXQgcm9vdCA9IHt0eXBlOiBcInVuaW9uXCIsIGNoaWxkcmVuOiBbXX07XG4gICAgcm9vdC5jaGlsZHJlbi5wdXNoKHt0eXBlOiBcImRlY2xhcmF0aW9uXCIsIHZhcjogXCJyZXN1bHRzXCIsIHZhbHVlOiBcIltdXCJ9KTtcbiAgICByb290LmNoaWxkcmVuLnB1c2goe3R5cGU6IFwiZGVjbGFyYXRpb25cIiwgdmFyOiBcInByb3ZlbmFuY2VcIiwgdmFsdWU6IFwiW11cIn0pO1xuXG4gICAgbGV0IGhhc2hlc1ZhbHVlID0gXCJ7fVwiO1xuICAgIGlmKHRoaXMuaXNTdGF0ZWZ1bCkge1xuICAgICAgICBoYXNoZXNWYWx1ZSA9IFwicHJldkhhc2hlc1wiO1xuICAgIH1cbiAgICByb290LmNoaWxkcmVuLnB1c2goe3R5cGU6IFwiZGVjbGFyYXRpb25cIiwgdmFyOiBcImhhc2hlc1wiLCB2YWx1ZTogaGFzaGVzVmFsdWV9KTtcblxuICAgIGxldCBpeCA9IDA7XG4gICAgZm9yKGxldCBzb3VyY2Ugb2YgdGhpcy5zb3VyY2VzKSB7XG4gICAgICBsZXQgYWN0aW9uO1xuICAgICAgaWYoc291cmNlLnR5cGUgPT09IFwiK1wiKSB7XG4gICAgICAgIGFjdGlvbiA9IHt0eXBlOiBcInJlc3VsdFwiLCBpeCwgY2hpbGRyZW46IFt7dHlwZTogXCJwcm92ZW5hbmNlXCIsIHNvdXJjZSwgaXh9XX07XG4gICAgICB9XG4gICAgICByb290LmNoaWxkcmVuLnB1c2goe1xuICAgICAgICB0eXBlOiBcInNvdXJjZVwiLFxuICAgICAgICBpeCxcbiAgICAgICAgdGFibGU6IHNvdXJjZS50YWJsZSxcbiAgICAgICAgbWFwcGluZzogc291cmNlLm1hcHBpbmcsXG4gICAgICAgIGNoaWxkcmVuOiBbYWN0aW9uXSxcbiAgICAgIH0pO1xuICAgICAgaXgrKztcbiAgICB9XG4gICAgcm9vdC5jaGlsZHJlbi5wdXNoKHt0eXBlOiBcImhhc2hlc1RvUmVzdWx0c1wifSk7XG4gICAgcm9vdC5jaGlsZHJlbi5wdXNoKHt0eXBlOiBcInJldHVyblwiLCB2YXJzOiBbXCJyZXN1bHRzXCIsIFwiaGFzaGVzXCIsIFwicHJvdmVuYW5jZVwiXX0pO1xuICAgIHJldHVybiByb290O1xuICB9XG4gIGNvbXBpbGVBU1Qocm9vdCkge1xuICAgIGxldCBjb2RlID0gXCJcIjtcbiAgICBsZXQgdHlwZSA9IHJvb3QudHlwZTtcbiAgICBzd2l0Y2godHlwZSkge1xuICAgICAgY2FzZSBcInVuaW9uXCI6XG4gICAgICAgIGZvcih2YXIgY2hpbGQgb2Ygcm9vdC5jaGlsZHJlbikge1xuICAgICAgICAgIGNvZGUgKz0gdGhpcy5jb21waWxlQVNUKGNoaWxkKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJkZWNsYXJhdGlvblwiOlxuICAgICAgICBjb2RlICs9IGB2YXIgJHtyb290LnZhcn0gPSAke3Jvb3QudmFsdWV9O1xcbmA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBcInNvdXJjZVwiOlxuICAgICAgICB2YXIgaXggPSByb290Lml4O1xuICAgICAgICBsZXQgbWFwcGluZ0l0ZW1zID0gW107XG4gICAgICAgIGZvcihsZXQga2V5IGluIHJvb3QubWFwcGluZykge1xuICAgICAgICAgIGxldCBtYXBwaW5nID0gcm9vdC5tYXBwaW5nW2tleV07XG4gICAgICAgICAgbGV0IHZhbHVlO1xuICAgICAgICAgIGlmKG1hcHBpbmcuY29uc3RydWN0b3IgPT09IEFycmF5ICYmIG1hcHBpbmcubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICBsZXQgW2ZpZWxkXSA9IG1hcHBpbmc7XG4gICAgICAgICAgICB2YWx1ZSA9IGBzb3VyY2VSb3cke2l4fVsnJHtmaWVsZH0nXWA7XG4gICAgICAgICAgfSBlbHNlIGlmKG1hcHBpbmcuY29uc3RydWN0b3IgPT09IEFycmF5ICYmIG1hcHBpbmcubGVuZ3RoID09PSAyKSB7XG4gICAgICAgICAgICBsZXQgW18sIGZpZWxkXSA9IG1hcHBpbmc7XG4gICAgICAgICAgICB2YWx1ZSA9IGBzb3VyY2VSb3cke2l4fVsnJHtmaWVsZH0nXWA7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhbHVlID0gSlNPTi5zdHJpbmdpZnkobWFwcGluZyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG1hcHBpbmdJdGVtcy5wdXNoKGAnJHtrZXl9JzogJHt2YWx1ZX1gKVxuICAgICAgICB9XG4gICAgICAgIGNvZGUgKz0gYHZhciBzb3VyY2VSb3dzJHtpeH0gPSBjaGFuZ2VzWycke3Jvb3QudGFibGUucmVwbGFjZSgvJy9nLCBcIlxcXFwnXCIpfSddO1xcbmA7XG4gICAgICAgIGNvZGUgKz0gYGZvcih2YXIgcm93SXgke2l4fSA9IDAsIHJvd3NMZW4ke2l4fSA9IHNvdXJjZVJvd3Mke2l4fS5sZW5ndGg7IHJvd0l4JHtpeH0gPCByb3dzTGVuJHtpeH07IHJvd0l4JHtpeH0rKykge1xcbmBcbiAgICAgICAgY29kZSArPSBgdmFyIHNvdXJjZVJvdyR7aXh9ID0gc291cmNlUm93cyR7aXh9W3Jvd0l4JHtpeH1dO1xcbmA7XG4gICAgICAgIGNvZGUgKz0gYHZhciBtYXBwZWRSb3cke2l4fSA9IHske21hcHBpbmdJdGVtcy5qb2luKFwiLCBcIil9fTtcXG5gXG4gICAgICAgIGZvcih2YXIgY2hpbGQgb2Ygcm9vdC5jaGlsZHJlbikge1xuICAgICAgICAgIGNvZGUgKz0gdGhpcy5jb21waWxlQVNUKGNoaWxkKTtcbiAgICAgICAgfVxuICAgICAgICBjb2RlICs9IFwifVxcblwiO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJyZXN1bHRcIjpcbiAgICAgICAgdmFyIGl4ID0gcm9vdC5peDtcbiAgICAgICAgY29kZSArPSBgdmFyIGhhc2gke2l4fSA9IGhhc2hlcihtYXBwZWRSb3cke2l4fSk7XFxuYDtcbiAgICAgICAgY29kZSArPSBgbWFwcGVkUm93JHtpeH0uX19pZCA9IGhhc2gke2l4fTtcXG5gO1xuICAgICAgICBjb2RlICs9IGBoYXNoZXNbaGFzaCR7aXh9XSA9IG1hcHBlZFJvdyR7aXh9O1xcbmA7XG4gICAgICAgIGZvcih2YXIgY2hpbGQgb2Ygcm9vdC5jaGlsZHJlbikge1xuICAgICAgICAgIGNvZGUgKz0gdGhpcy5jb21waWxlQVNUKGNoaWxkKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJyZW1vdmVSZXN1bHRcIjpcbiAgICAgICAgdmFyIGl4ID0gcm9vdC5peDtcbiAgICAgICAgY29kZSArPSBgaGFzaGVzW2hhc2hlcihtYXBwZWRSb3cke2l4fSldID0gZmFsc2U7XFxuYDtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwiaGFzaGVzVG9SZXN1bHRzXCI6XG4gICAgICAgIGNvZGUgKz0gXCJ2YXIgaGFzaEtleXMgPSBPYmplY3Qua2V5cyhoYXNoZXMpO1xcblwiO1xuICAgICAgICBjb2RlICs9IFwiZm9yKHZhciBoYXNoS2V5SXggPSAwLCBoYXNoS2V5TGVuID0gaGFzaEtleXMubGVuZ3RoOyBoYXNoS2V5SXggPCBoYXNoS2V5TGVuOyBoYXNoS2V5SXgrKykge1xcblwiO1xuICAgICAgICBjb2RlICs9IFwidmFyIGN1ckhhc2hLZXkgPSBoYXNoS2V5c1toYXNoS2V5SXhdO1wiXG4gICAgICAgIGNvZGUgKz0gXCJ2YXIgdmFsdWUgPSBoYXNoZXNbY3VySGFzaEtleV07XFxuXCI7XG4gICAgICAgIGNvZGUgKz0gXCJpZih2YWx1ZSAhPT0gZmFsc2UpIHtcXG5cIjtcbiAgICAgICAgY29kZSArPSBcInZhbHVlLl9faWQgPSBjdXJIYXNoS2V5O1xcblwiO1xuICAgICAgICBjb2RlICs9IFwicmVzdWx0cy5wdXNoKHZhbHVlKTtcXG5cIjtcbiAgICAgICAgY29kZSArPSBcIn1cXG5cIjtcbiAgICAgICAgY29kZSArPSBcIn1cXG5cIjtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFwicHJvdmVuYW5jZVwiOlxuICAgICAgICB2YXIgc291cmNlID0gcm9vdC5zb3VyY2UudGFibGU7XG4gICAgICAgIHZhciBpeCA9IHJvb3QuaXg7XG4gICAgICAgIHZhciBwcm92ZW5hbmNlID0gXCJ2YXIgcHJvdmVuYW5jZV9faWQgPSAnJztcXG5cIjtcbiAgICAgICAgcHJvdmVuYW5jZSArPSBgcHJvdmVuYW5jZV9faWQgPSAnJHt0aGlzLm5hbWUucmVwbGFjZSgvJy9nLCBcIlxcXFwnXCIpfXwnICsgbWFwcGVkUm93JHtpeH0uX19pZCArICd8JyArIHJvd0luc3RhbmNlICsgJ3wke3NvdXJjZS5yZXBsYWNlKC8nL2csIFwiXFxcXCdcIil9fCcgKyBzb3VyY2VSb3cke2l4fS5fX2lkOyBcXG5gO1xuICAgICAgICBwcm92ZW5hbmNlICs9IGBwcm92ZW5hbmNlLnB1c2goe3RhYmxlOiAnJHt0aGlzLm5hbWUucmVwbGFjZSgvJy9nLCBcIlxcXFwnXCIpfScsIHJvdzogbWFwcGVkUm93JHtpeH0sIFwicm93IGluc3RhbmNlXCI6IHJvd0luc3RhbmNlLCBzb3VyY2U6IFwiJHtzb3VyY2UucmVwbGFjZSgvJy9nLCBcIlxcXFwnXCIpfVwiLCBcInNvdXJjZSByb3dcIjogc291cmNlUm93JHtpeH19KTtcXG5gO1xuICAgICAgICBjb2RlID0gYHZhciByb3dJbnN0YW5jZSA9IFwiJHtzb3VyY2UucmVwbGFjZSgvJy9nLCBcIlxcXFwnXCIpfXxcIiArIG1hcHBlZFJvdyR7aXh9Ll9faWQ7XG4gICAgICAgICR7cHJvdmVuYW5jZX1gO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgXCJyZXR1cm5cIjpcbiAgICAgICAgY29kZSArPSBgcmV0dXJuIHske3Jvb3QudmFycy5tYXAoKG5hbWUpID0+IGAke25hbWV9OiAke25hbWV9YCkuam9pbihcIiwgXCIpfX07YDtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiBjb2RlO1xuICB9XG4gIGNvbXBpbGUoKSB7XG4gICAgbGV0IGFzdCA9IHRoaXMudG9BU1QoKTtcbiAgICBsZXQgY29kZSA9IHRoaXMuY29tcGlsZUFTVChhc3QpO1xuICAgIHRoaXMuY29tcGlsZWQgPSBuZXcgRnVuY3Rpb24oXCJpeGVyXCIsIFwiaGFzaGVyXCIsIFwiY2hhbmdlc1wiLCBjb2RlKTtcbiAgICB0aGlzLmRpcnR5ID0gZmFsc2U7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgZGVidWcoKSB7XG4gICAgbGV0IGNvZGUgPSB0aGlzLmNvbXBpbGVBU1QodGhpcy50b0FTVCgpKTtcbiAgICBjb25zb2xlLmxvZyhjb2RlKTtcbiAgICByZXR1cm4gY29kZTtcbiAgfVxuICBleGVjKCkge1xuICAgIGlmKHRoaXMuZGlydHkpIHtcbiAgICAgIHRoaXMuY29tcGlsZSgpO1xuICAgIH1cbiAgICBsZXQgY2hhbmdlcyA9IHt9XG4gICAgZm9yKGxldCBzb3VyY2Ugb2YgdGhpcy5zb3VyY2VzKSB7XG4gICAgICBjaGFuZ2VzW3NvdXJjZS50YWJsZV0gPSB0aGlzLml4ZXIudGFibGUoc291cmNlLnRhYmxlKS50YWJsZTtcbiAgICB9XG4gICAgbGV0IHJlc3VsdHMgPSB0aGlzLmNvbXBpbGVkKHRoaXMuaXhlciwgdGhpcy5oYXNoZXIsIGNoYW5nZXMpO1xuICAgIHJldHVybiByZXN1bHRzO1xuICB9XG4gIGluY3JlbWVudGFsUmVtb3ZlKGNoYW5nZXMpIHtcbiAgICBsZXQgaXhlciA9IHRoaXMuaXhlcjtcbiAgICBsZXQgcm93c1RvUG9zdENoZWNrID0gW107XG4gICAgbGV0IHByb3ZlbmFuY2VEaWZmID0gdGhpcy5peGVyLmRpZmYoKTtcbiAgICBsZXQgcmVtb3ZlcyA9IFtdO1xuICAgIGxldCBpbmRleGVzID0gaXhlci50YWJsZShcInByb3ZlbmFuY2VcIikuaW5kZXhlcztcbiAgICBsZXQgc291cmNlUm93TG9va3VwID0gaW5kZXhlc1tcInNvdXJjZXxzb3VyY2Ugcm93fHRhYmxlXCJdLmluZGV4O1xuICAgIGxldCByb3dJbnN0YW5jZUxvb2t1cCA9IGluZGV4ZXNbXCJyb3cgaW5zdGFuY2V8dGFibGVcIl0uaW5kZXg7XG4gICAgbGV0IHRhYmxlUm93TG9va3VwID0gaW5kZXhlc1tcInJvd3x0YWJsZVwiXS5pbmRleDtcbiAgICBsZXQgcHJvdmVuYW5jZVJlbW92ZXMgPSBbXTtcbiAgICBsZXQgdmlzaXRlZCA9IHt9XG4gICAgZm9yKGxldCBzb3VyY2Ugb2YgdGhpcy5zb3VyY2VzKSB7XG4gICAgICBsZXQgY2hhbmdlID0gY2hhbmdlc1tzb3VyY2UudGFibGVdO1xuICAgICAgaWYoIXZpc2l0ZWRbc291cmNlLnRhYmxlXSAmJiBjaGFuZ2UgJiYgY2hhbmdlLnJlbW92ZXMubGVuZ3RoKSB7XG4gICAgICAgIHZpc2l0ZWRbc291cmNlLnRhYmxlXSA9IHRydWU7XG4gICAgICAgIGZvcihsZXQgcmVtb3ZlIG9mIGNoYW5nZS5yZW1vdmVzKSB7XG4gICAgICAgICAgbGV0IHByb3ZlbmFuY2VzID0gc291cmNlUm93TG9va3VwW3NvdXJjZS50YWJsZSArICd8JyArIHJlbW92ZS5fX2lkICsgJ3wnICsgdGhpcy5uYW1lXVxuICAgICAgICAgIGlmKHByb3ZlbmFuY2VzKSB7XG4gICAgICAgICAgICBmb3IobGV0IHByb3ZlbmFuY2Ugb2YgcHJvdmVuYW5jZXMpIHtcbiAgICAgICAgICAgICAgaWYoIXZpc2l0ZWRbcHJvdmVuYW5jZVtcInJvdyBpbnN0YW5jZVwiXV0pIHtcbiAgICAgICAgICAgICAgICB2aXNpdGVkW3Byb3ZlbmFuY2VbXCJyb3cgaW5zdGFuY2VcIl1dID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBsZXQgcmVsYXRlZFByb3ZlbmFuY2UgPSByb3dJbnN0YW5jZUxvb2t1cFtwcm92ZW5hbmNlW1wicm93IGluc3RhbmNlXCJdICsgJ3wnICsgcHJvdmVuYW5jZS50YWJsZV07XG4gICAgICAgICAgICAgICAgZm9yKGxldCByZWxhdGVkIG9mIHJlbGF0ZWRQcm92ZW5hbmNlKSB7XG4gICAgICAgICAgICAgICAgICBwcm92ZW5hbmNlUmVtb3Zlcy5wdXNoKHJlbGF0ZWQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICByb3dzVG9Qb3N0Q2hlY2sucHVzaChwcm92ZW5hbmNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcHJvdmVuYW5jZURpZmYucmVtb3ZlRmFjdHMoXCJwcm92ZW5hbmNlXCIsIHByb3ZlbmFuY2VSZW1vdmVzKTtcbiAgICBpeGVyLmFwcGx5RGlmZkluY3JlbWVudGFsKHByb3ZlbmFuY2VEaWZmKTtcbiAgICBsZXQgaXNFZGIgPSBpeGVyLmVkYlRhYmxlcztcbiAgICBmb3IobGV0IHJvdyBvZiByb3dzVG9Qb3N0Q2hlY2spIHtcbiAgICAgIGxldCBzdXBwb3J0cyA9IHRhYmxlUm93TG9va3VwW3Jvdy5yb3cuX19pZCArICd8JyArIHJvdy50YWJsZV07XG4gICAgICBpZighc3VwcG9ydHMgfHwgc3VwcG9ydHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJlbW92ZXMucHVzaChyb3cucm93KTtcbiAgICAgIH0gZWxzZSBpZih0aGlzLnNvdXJjZXMubGVuZ3RoID4gMikge1xuICAgICAgICBsZXQgc3VwcG9ydHNUb1JlbW92ZSA9IFtdO1xuICAgICAgICAvLyBvdGhlcndpc2UgaWYgdGhlcmUgYXJlIHN1cHBvcnRzLCB0aGVuIHdlIG5lZWQgdG8gd2FsayB0aGUgc3VwcG9ydFxuICAgICAgICAvLyBncmFwaCBiYWNrd2FyZHMgYW5kIG1ha2Ugc3VyZSBldmVyeSBzdXBwb3J0aW5nIHJvdyB0ZXJtaW5hdGVzIGF0IGFuXG4gICAgICAgIC8vIGVkYiB2YWx1ZS4gSWYgbm90LCB0aGVuIHRoYXQgc3VwcG9ydCBhbHNvIG5lZWRzIHRvIGJlIHJlbW92ZWRcbiAgICAgICAgZm9yKGxldCBzdXBwb3J0IG9mIHN1cHBvcnRzKSB7XG4gICAgICAgICAgLy8gaWYgdGhlIHN1cHBvcnQgaXMgYWxyZWFkeSBhbiBlZGIsIHdlJ3JlIGdvb2QgdG8gZ28uXG4gICAgICAgICAgaWYoaXNFZGJbc3VwcG9ydC5zb3VyY2VdKSBjb250aW51ZTtcbiAgICAgICAgICBpZighdGFibGVSb3dMb29rdXBbc3VwcG9ydFtcInNvdXJjZSByb3dcIl0uX19pZCArICd8JyArIHN1cHBvcnQuc291cmNlXSkge1xuICAgICAgICAgICAgc3VwcG9ydHNUb1JlbW92ZS5wdXNoKHN1cHBvcnQpO1xuICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIGdldCBhbGwgdGhlIHN1cHBvcnRzIGZvciB0aGlzIHN1cHBvcnRcbiAgICAgICAgICBsZXQgbm9kZXMgPSB0YWJsZVJvd0xvb2t1cFtzdXBwb3J0W1wic291cmNlIHJvd1wiXS5fX2lkICsgJ3wnICsgc3VwcG9ydC5zb3VyY2VdLnNsaWNlKCk7XG4gICAgICAgICAgbGV0IG5vZGVJeCA9IDA7XG4gICAgICAgICAgLy8gaXRlcmF0ZSB0aHJvdWdoIGFsbCB0aGUgbm9kZXMsIGlmIHRoZXkgaGF2ZSBmdXJ0aGVyIHN1cHBvcnRzIHRoZW5cbiAgICAgICAgICAvLyBhc3N1bWUgdGhpcyBub2RlIGlzIG9rIGFuZCBhZGQgdGhvc2Ugc3VwcG9ydHMgdG8gdGhlIGxpc3Qgb2Ygbm9kZXMgdG9cbiAgICAgICAgICAvLyBjaGVjay4gSWYgd2UgcnVuIGludG8gYSBub2RlIHdpdGggbm8gc3VwcG9ydHMgaXQgbXVzdCBlaXRoZXIgYmUgYW4gZWRiXG4gICAgICAgICAgLy8gb3IgaXQncyB1bnN1cHBvcnRlZCBhbmQgdGhpcyByb3cgaW5zdGFuY2UgbmVlZHMgdG8gYmUgcmVtb3ZlZC5cbiAgICAgICAgICB3aGlsZShub2RlSXggPCBub2Rlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGxldCBub2RlID0gbm9kZXNbbm9kZUl4XTtcbiAgICAgICAgICAgIGlmKGlzRWRiW25vZGUuc291cmNlXSkge1xuICAgICAgICAgICAgICBub2RlSXgrKztcbiAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXQgbm9kZVN1cHBvcnRzID0gdGFibGVSb3dMb29rdXBbbm9kZVtcInNvdXJjZSByb3dcIl0uX19pZCArICd8JyArIG5vZGUuc291cmNlXTtcbiAgICAgICAgICAgIGlmKCFub2RlU3VwcG9ydHMgfHwgbm9kZVN1cHBvcnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICBzdXBwb3J0c1RvUmVtb3ZlLnB1c2goc3VwcG9ydCk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZm9yKGxldCBub2RlU3VwcG9ydCBvZiBub2RlU3VwcG9ydHMpIHtcbiAgICAgICAgICAgICAgICBub2Rlcy5wdXNoKG5vZGVTdXBwb3J0KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBub2RlSXgrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYoc3VwcG9ydHNUb1JlbW92ZS5sZW5ndGgpIHtcbiAgICAgICAgICAvLyB3ZSBuZWVkIHRvIHJlbW92ZSBhbGwgdGhlIHN1cHBvcnRzXG4gICAgICAgICAgbGV0IHByb3ZlbmFuY2VSZW1vdmVzID0gW107XG4gICAgICAgICAgZm9yKGxldCBzdXBwb3J0IG9mIHN1cHBvcnRzVG9SZW1vdmUpIHtcbiAgICAgICAgICAgIGxldCByZWxhdGVkUHJvdmVuYW5jZSA9IHJvd0luc3RhbmNlTG9va3VwW3N1cHBvcnRbXCJyb3cgaW5zdGFuY2VcIl0gKyAnfCcgKyBzdXBwb3J0LnRhYmxlXTtcbiAgICAgICAgICAgIGZvcihsZXQgcmVsYXRlZCBvZiByZWxhdGVkUHJvdmVuYW5jZSkge1xuICAgICAgICAgICAgICBwcm92ZW5hbmNlUmVtb3Zlcy5wdXNoKHJlbGF0ZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBsZXQgZGlmZiA9IGl4ZXIuZGlmZigpO1xuICAgICAgICAgIGRpZmYucmVtb3ZlRmFjdHMoXCJwcm92ZW5hbmNlXCIsIHByb3ZlbmFuY2VSZW1vdmVzKTtcbiAgICAgICAgICBpeGVyLmFwcGx5RGlmZkluY3JlbWVudGFsKGRpZmYpO1xuICAgICAgICAgIC8vIG5vdyB0aGF0IGFsbCB0aGUgdW5zdXBwb3J0ZWQgcHJvdmVuYW5jZXMgaGF2ZSBiZWVuIHJlbW92ZWQsIGNoZWNrIGlmIHRoZXJlJ3MgYW55dGhpbmdcbiAgICAgICAgICAvLyBsZWZ0LlxuICAgICAgICAgIGlmKCF0YWJsZVJvd0xvb2t1cFtyb3cucm93Ll9faWQgKyAnfCcgKyByb3cudGFibGVdIHx8IHRhYmxlUm93TG9va3VwW3Jvdy5yb3cuX19pZCArICd8JyArIHJvdy50YWJsZV0ubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZW1vdmVzLnB1c2gocm93LnJvdyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZW1vdmVzO1xuICB9XG4gIGV4ZWNJbmNyZW1lbnRhbChjaGFuZ2VzLCB0YWJsZSk6IHtwcm92ZW5hbmNlOiBhbnlbXSwgYWRkczogYW55W10sIHJlbW92ZXM6IGFueVtdfSB7XG4gICAgaWYodGhpcy5kaXJ0eSkge1xuICAgICAgdGhpcy5jb21waWxlKCk7XG4gICAgfVxuXG4gICAgbGV0IHNvdXJjZUNoYW5nZXMgPSB7fVxuICAgIGZvcihsZXQgc291cmNlIG9mIHRoaXMuc291cmNlcykge1xuICAgICAgbGV0IHZhbHVlO1xuICAgICAgaWYoIWNoYW5nZXNbc291cmNlLnRhYmxlXSkge1xuICAgICAgICB2YWx1ZSA9IFtdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsdWUgPSBjaGFuZ2VzW3NvdXJjZS50YWJsZV0uYWRkcztcbiAgICAgIH1cbiAgICAgIHNvdXJjZUNoYW5nZXNbc291cmNlLnRhYmxlXSA9IHZhbHVlO1xuICAgIH1cbiAgICBsZXQgcmVzdWx0cyA9IHRoaXMuY29tcGlsZWQodGhpcy5peGVyLCB0aGlzLmhhc2hlciwgc291cmNlQ2hhbmdlcyk7XG4gICAgbGV0IGFkZHMgPSBbXTtcbiAgICBsZXQgcHJldkhhc2hlcyA9IHRhYmxlLmZhY3RIYXNoO1xuICAgIGxldCBwcmV2S2V5cyA9IE9iamVjdC5rZXlzKHByZXZIYXNoZXMpO1xuICAgIGxldCBzdWdnZXN0ZWRSZW1vdmVzID0gdGhpcy5pbmNyZW1lbnRhbFJlbW92ZShjaGFuZ2VzKTtcbiAgICBsZXQgcmVhbERpZmYgPSBkaWZmQWRkc0FuZFJlbW92ZXMocmVzdWx0cy5yZXN1bHRzLCBzdWdnZXN0ZWRSZW1vdmVzKTtcbiAgICBmb3IobGV0IHJlc3VsdCBvZiByZWFsRGlmZi5hZGRzKSB7XG4gICAgICBsZXQgaWQgPSByZXN1bHQuX19pZDtcbiAgICAgIGlmKHByZXZIYXNoZXNbaWRdID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgYWRkcy5wdXNoKHJlc3VsdCk7XG4gICAgICB9XG4gICAgfVxuICAgIGxldCBkaWZmID0gdGhpcy5peGVyLmRpZmYoKTtcbiAgICBkaWZmLmFkZE1hbnkoXCJwcm92ZW5hbmNlXCIsIHJlc3VsdHMucHJvdmVuYW5jZSk7XG4gICAgdGhpcy5peGVyLmFwcGx5RGlmZkluY3JlbWVudGFsKGRpZmYpO1xuICAgIHJldHVybiB7cHJvdmVuYW5jZTogcmVzdWx0cy5wcm92ZW5hbmNlLCBhZGRzLCByZW1vdmVzOiByZWFsRGlmZi5yZW1vdmVzfTtcbiAgfVxufVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gQnVpbHRpbiBQcmltaXRpdmVzXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5ydW50aW1lLmRlZmluZShcImNvdW50XCIsIHthZ2dyZWdhdGU6IHRydWUsIHJlc3VsdDogXCJjb3VudFwifSwgZnVuY3Rpb24ocHJldikge1xuICBpZighcHJldi5jb3VudCkge1xuICAgIHByZXYuY291bnQgPSAwO1xuICB9XG4gIHByZXYuY291bnQrKztcbiAgcmV0dXJuIHByZXY7XG59KTtcblxucnVudGltZS5kZWZpbmUoXCJzdW1cIiwge2FnZ3JlZ2F0ZTogdHJ1ZSwgcmVzdWx0OiBcInN1bVwifSwgZnVuY3Rpb24ocHJldiwgdmFsdWUpIHtcbiAgaWYoIXByZXYuc3VtKSB7XG4gICAgcHJldi5zdW0gPSAwO1xuICB9XG4gIHByZXYuc3VtICs9IHZhbHVlO1xuICByZXR1cm4gcHJldjtcbn0pO1xuXG5ydW50aW1lLmRlZmluZShcImF2ZXJhZ2VcIiwge2FnZ3JlZ2F0ZTogdHJ1ZSwgcmVzdWx0OiBcImF2ZXJhZ2VcIn0sIGZ1bmN0aW9uKHByZXYsIHZhbHVlKSB7XG4gIGlmKCFwcmV2LnN1bSkge1xuICAgIHByZXYuc3VtID0gMDtcbiAgICBwcmV2LmNvdW50ID0gMDtcbiAgfVxuICBwcmV2LmNvdW50Kys7XG4gIHByZXYuc3VtICs9IHZhbHVlO1xuICBwcmV2LmF2ZXJhZ2UgPSBwcmV2LnN1bSAvIHByZXYuY291bnQ7XG4gIHJldHVybiBwcmV2O1xufSk7XG5cbnJ1bnRpbWUuZGVmaW5lKFwibG93ZXJjYXNlXCIsIHtyZXN1bHQ6IFwibG93ZXJjYXNlXCJ9LCBmdW5jdGlvbih0ZXh0KSB7XG4gIGlmKHR5cGVvZiB0ZXh0ID09PSBcInN0cmluZ1wiKSB7XG4gICAgcmV0dXJuIHtyZXN1bHQ6IHRleHQudG9Mb3dlckNhc2UoKX07XG4gIH1cbiAgcmV0dXJuIHtyZXN1bHQ6IHRleHR9O1xufSlcblxucnVudGltZS5kZWZpbmUoXCI9XCIsIHtmaWx0ZXI6IHRydWUsIGludmVyc2U6IFwiIT1cIn0sIGZ1bmN0aW9uKGEsIGIpIHtcbiAgcmV0dXJuIGEgPT09IGIgPyBydW50aW1lLlNVQ0NFRUQgOiBydW50aW1lLkZBSUw7XG59KTtcblxucnVudGltZS5kZWZpbmUoXCIhPVwiLCB7ZmlsdGVyOiB0cnVlLCBpbnZlcnNlOiBcIj1cIn0sIGZ1bmN0aW9uKGEsIGIpIHtcbiAgcmV0dXJuIGEgIT09IGIgPyBydW50aW1lLlNVQ0NFRUQgOiBydW50aW1lLkZBSUw7XG59KTtcblxucnVudGltZS5kZWZpbmUoXCI+XCIsIHtmaWx0ZXI6IHRydWUsIGludmVyc2U6IFwiPD1cIn0sIGZ1bmN0aW9uKGEsIGIpIHtcbiAgcmV0dXJuIGEgPiBiID8gcnVudGltZS5TVUNDRUVEIDogcnVudGltZS5GQUlMO1xufSk7XG5cbnJ1bnRpbWUuZGVmaW5lKFwiPFwiLCB7ZmlsdGVyOiB0cnVlLCBpbnZlcnNlOiBcIj49XCJ9LCBmdW5jdGlvbihhLCBiKSB7XG4gIHJldHVybiBhIDwgYiA/IHJ1bnRpbWUuU1VDQ0VFRCA6IHJ1bnRpbWUuRkFJTDtcbn0pO1xuXG5ydW50aW1lLmRlZmluZShcIj49XCIsIHtmaWx0ZXI6IHRydWUsIGludmVyc2U6IFwiPFwifSwgZnVuY3Rpb24oYSwgYikge1xuICByZXR1cm4gYSA+PSBiID8gcnVudGltZS5TVUNDRUVEIDogcnVudGltZS5GQUlMO1xufSk7XG5cbnJ1bnRpbWUuZGVmaW5lKFwiPD1cIiwge2ZpbHRlcjogdHJ1ZSwgaW52ZXJzZTogXCI+XCJ9LCBmdW5jdGlvbihhLCBiKSB7XG4gIHJldHVybiBhIDw9IGIgPyBydW50aW1lLlNVQ0NFRUQgOiBydW50aW1lLkZBSUw7XG59KTtcblxucnVudGltZS5kZWZpbmUoXCIrXCIsIHtyZXN1bHQ6IFwicmVzdWx0XCJ9LCBmdW5jdGlvbihhLCBiKSB7XG4gIHJldHVybiB7cmVzdWx0OiBhICsgYn07XG59KTtcblxucnVudGltZS5kZWZpbmUoXCItXCIsIHtyZXN1bHQ6IFwicmVzdWx0XCJ9LCBmdW5jdGlvbihhLCBiKSB7XG4gIHJldHVybiB7cmVzdWx0OiBhIC0gYn07XG59KTtcblxucnVudGltZS5kZWZpbmUoXCIqXCIsIHtyZXN1bHQ6IFwicmVzdWx0XCJ9LCBmdW5jdGlvbihhLCBiKSB7XG4gIHJldHVybiB7cmVzdWx0OiBhICogYn07XG59KTtcblxucnVudGltZS5kZWZpbmUoXCIvXCIsIHtyZXN1bHQ6IFwicmVzdWx0XCJ9LCBmdW5jdGlvbihhLCBiKSB7XG4gIHJldHVybiB7cmVzdWx0OiBhIC8gYn07XG59KTtcblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIEFTVCBhbmQgY29tcGlsZXJcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbi8vIHZpZXc6IHZpZXcsIGtpbmRbdW5pb258cXVlcnl8dGFibGVdXG4vLyBhY3Rpb246IHZpZXcsIGFjdGlvbiwga2luZFtzZWxlY3R8Y2FsY3VsYXRlfHByb2plY3R8dW5pb258dW51bmlvbnxzdGF0ZWZ1bHxsaW1pdHxzb3J0fGdyb3VwfGFnZ3JlZ2F0ZV0sIGl4XG4vLyBhY3Rpb24gc291cmNlOiBhY3Rpb24sIHNvdXJjZSB2aWV3XG4vLyBhY3Rpb24gbWFwcGluZzogYWN0aW9uLCBmcm9tLCB0byBzb3VyY2UsIHRvIGZpZWxkXG4vLyBhY3Rpb24gbWFwcGluZyBjb25zdGFudDogYWN0aW9uLCBmcm9tLCB2YWx1ZVxuXG5mdW5jdGlvbiBhZGRSZWNvbXBpbGVUcmlnZ2VycyhldmUpIHtcblxuICB2YXIgcmVjb21waWxlVHJpZ2dlciA9IHtcbiAgICBleGVjOiAoaXhlcikgPT4ge1xuICAgICAgZm9yKGxldCB2aWV3IG9mIGl4ZXIuZmluZChcInZpZXdcIikpIHtcbiAgICAgICAgaWYodmlldy5raW5kID09PSBcInRhYmxlXCIpIGNvbnRpbnVlO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGxldCBxdWVyeSA9IGNvbXBpbGUoaXhlciwgdmlldy52aWV3KTtcbiAgICAgICAgICBpeGVyLmFzVmlldyhxdWVyeSk7XG4gICAgICAgIH0gY2F0Y2goZSkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJCQUQgUVVFUlkgSU4gVEhFIERCIDooXCIpO1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJWaWV3IElkOiBcIiArIHZpZXcudmlldyk7XG4gICAgICAgICAgY29uc29sZS5sb2coZS5zdGFjayk7XG4gICAgICAgICAgaXhlci5hcHBseURpZmYoUXVlcnkucmVtb3ZlKHZpZXcudmlldywgaXhlcikpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4ge307XG4gICAgfVxuICB9XG5cbiAgZXZlLmFkZFRhYmxlKFwidmlld1wiLCBbXCJ2aWV3XCIsIFwia2luZFwiXSk7XG4gIGV2ZS5hZGRUYWJsZShcImFjdGlvblwiLCBbXCJ2aWV3XCIsIFwiYWN0aW9uXCIsIFwia2luZFwiLCBcIml4XCJdKTtcbiAgZXZlLmFkZFRhYmxlKFwiYWN0aW9uIHNvdXJjZVwiLCBbXCJhY3Rpb25cIiwgXCJzb3VyY2Ugdmlld1wiXSk7XG4gIGV2ZS5hZGRUYWJsZShcImFjdGlvbiBtYXBwaW5nXCIsIFtcImFjdGlvblwiLCBcImZyb21cIiwgXCJ0byBzb3VyY2VcIiwgXCJ0byBmaWVsZFwiXSk7XG4gIGV2ZS5hZGRUYWJsZShcImFjdGlvbiBtYXBwaW5nIGNvbnN0YW50XCIsIFtcImFjdGlvblwiLCBcImZyb21cIiwgXCJ2YWx1ZVwiXSk7XG4gIGV2ZS5hZGRUYWJsZShcImFjdGlvbiBtYXBwaW5nIHNvcnRlZFwiLCBbXCJhY3Rpb25cIiwgXCJpeFwiLCBcInNvdXJjZVwiLCBcImZpZWxkXCIsIFwiZGlyZWN0aW9uXCJdKTtcbiAgZXZlLmFkZFRhYmxlKFwiYWN0aW9uIG1hcHBpbmcgbGltaXRcIiwgW1wiYWN0aW9uXCIsIFwibGltaXQgdHlwZVwiLCBcInZhbHVlXCJdKTtcblxuICBldmUudGFibGUoXCJ2aWV3XCIpLnRyaWdnZXJzW1wicmVjb21waWxlXCJdID0gcmVjb21waWxlVHJpZ2dlcjtcbiAgZXZlLnRhYmxlKFwiYWN0aW9uXCIpLnRyaWdnZXJzW1wicmVjb21waWxlXCJdID0gcmVjb21waWxlVHJpZ2dlcjtcbiAgZXZlLnRhYmxlKFwiYWN0aW9uIHNvdXJjZVwiKS50cmlnZ2Vyc1tcInJlY29tcGlsZVwiXSA9IHJlY29tcGlsZVRyaWdnZXI7XG4gIGV2ZS50YWJsZShcImFjdGlvbiBtYXBwaW5nXCIpLnRyaWdnZXJzW1wicmVjb21waWxlXCJdID0gcmVjb21waWxlVHJpZ2dlcjtcbiAgZXZlLnRhYmxlKFwiYWN0aW9uIG1hcHBpbmcgY29uc3RhbnRcIikudHJpZ2dlcnNbXCJyZWNvbXBpbGVcIl0gPSByZWNvbXBpbGVUcmlnZ2VyO1xuICBldmUudGFibGUoXCJhY3Rpb24gbWFwcGluZyBzb3J0ZWRcIikudHJpZ2dlcnNbXCJyZWNvbXBpbGVcIl0gPSByZWNvbXBpbGVUcmlnZ2VyO1xuICBldmUudGFibGUoXCJhY3Rpb24gbWFwcGluZyBsaW1pdFwiKS50cmlnZ2Vyc1tcInJlY29tcGlsZVwiXSA9IHJlY29tcGlsZVRyaWdnZXI7XG5cbiAgcmV0dXJuIGV2ZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbXBpbGUoaXhlciwgdmlld0lkKSB7XG4gIGxldCB2aWV3ID0gaXhlci5maW5kT25lKFwidmlld1wiLCB7dmlldzogdmlld0lkfSk7XG4gIGlmKCF2aWV3KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBObyB2aWV3IGZvdW5kIGZvciAke3ZpZXdJZH0uYCk7XG4gIH1cbiAgbGV0IGNvbXBpbGVkID0gaXhlclt2aWV3LmtpbmRdKHZpZXdJZCk7XG4gIGxldCBhY3Rpb25zID0gaXhlci5maW5kKFwiYWN0aW9uXCIsIHt2aWV3OiB2aWV3SWR9KTtcbiAgaWYoIWFjdGlvbnMpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFZpZXcgJHt2aWV3SWR9IGhhcyBubyBhY3Rpb25zLmApO1xuICB9XG4gIC8vIHNvcnQgYWN0aW9ucyBieSBpeFxuICBhY3Rpb25zLnNvcnQoKGEsIGIpID0+IGEuaXggLSBiLml4KTtcbiAgZm9yKGxldCBhY3Rpb24gb2YgYWN0aW9ucykge1xuICAgIGxldCBhY3Rpb25LaW5kID0gYWN0aW9uLmtpbmQ7XG4gICAgaWYoYWN0aW9uS2luZCA9PT0gXCJsaW1pdFwiKSB7XG4gICAgICBsZXQgbGltaXQgPSB7fTtcbiAgICAgIGZvcihsZXQgbGltaXRNYXBwaW5nIG9mIGl4ZXIuZmluZChcImFjdGlvbiBtYXBwaW5nIGxpbWl0XCIsIHthY3Rpb246IGFjdGlvbi5hY3Rpb259KSkge1xuICAgICAgICBsaW1pdFtsaW1pdE1hcHBpbmdbXCJsaW1pdCB0eXBlXCJdXSA9IGxpbWl0TWFwcGluZ1tcInZhbHVlXCJdO1xuICAgICAgfVxuICAgICAgY29tcGlsZWQubGltaXQobGltaXQpO1xuICAgIH0gZWxzZSBpZihhY3Rpb25LaW5kID09PSBcInNvcnRcIiB8fCBhY3Rpb25LaW5kID09PSBcImdyb3VwXCIpIHtcbiAgICAgIGxldCBzb3J0ZWQgPSBbXTtcbiAgICAgIGxldCBtYXBwaW5ncyA9IGl4ZXIuZmluZChcImFjdGlvbiBtYXBwaW5nIHNvcnRlZFwiLCB7YWN0aW9uOiBhY3Rpb24uYWN0aW9ufSk7XG4gICAgICBtYXBwaW5ncy5zb3J0KChhLCBiKSA9PiBhLml4IC0gYi5peCk7XG4gICAgICBmb3IobGV0IG1hcHBpbmcgb2YgbWFwcGluZ3MpIHtcbiAgICAgICAgc29ydGVkLnB1c2goW21hcHBpbmdbXCJzb3VyY2VcIl0sIG1hcHBpbmdbXCJmaWVsZFwiXSwgbWFwcGluZ1tcImRpcmVjdGlvblwiXV0pO1xuICAgICAgfVxuICAgICAgaWYoc29ydGVkLmxlbmd0aCkge1xuICAgICAgICBjb21waWxlZFthY3Rpb25LaW5kXShzb3J0ZWQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke2FjdGlvbktpbmR9IHdpdGhvdXQgYW55IG1hcHBpbmdzOiAke2FjdGlvbi5hY3Rpb259YClcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IG1hcHBpbmdzID0gaXhlci5maW5kKFwiYWN0aW9uIG1hcHBpbmdcIiwge2FjdGlvbjogYWN0aW9uLmFjdGlvbn0pO1xuICAgICAgbGV0IG1hcHBpbmdPYmplY3QgPSB7fTtcbiAgICAgIGZvcihsZXQgbWFwcGluZyBvZiBtYXBwaW5ncykge1xuICAgICAgICBsZXQgc291cmNlID0gbWFwcGluZ1tcInRvIHNvdXJjZVwiXTtcbiAgICAgICAgbGV0IGZpZWxkID0gbWFwcGluZ1tcInRvIGZpZWxkXCJdO1xuICAgICAgICBpZihhY3Rpb25LaW5kID09PSBcInVuaW9uXCIgfHwgYWN0aW9uS2luZCA9PT0gXCJ1bnVuaW9uXCIpIHtcbiAgICAgICAgICBtYXBwaW5nT2JqZWN0W21hcHBpbmcuZnJvbV0gPSBbZmllbGRdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG1hcHBpbmdPYmplY3RbbWFwcGluZy5mcm9tXSA9IFtzb3VyY2UsIGZpZWxkXTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgbGV0IGNvbnN0YW50cyA9IGl4ZXIuZmluZChcImFjdGlvbiBtYXBwaW5nIGNvbnN0YW50XCIsIHthY3Rpb246IGFjdGlvbi5hY3Rpb259KTtcbiAgICAgIGZvcihsZXQgY29uc3RhbnQgb2YgY29uc3RhbnRzKSB7XG4gICAgICAgIG1hcHBpbmdPYmplY3RbY29uc3RhbnQuZnJvbV0gPSBjb25zdGFudC52YWx1ZTtcbiAgICAgIH1cbiAgICAgIGxldCBzb3VyY2UgPSBpeGVyLmZpbmRPbmUoXCJhY3Rpb24gc291cmNlXCIsIHthY3Rpb246IGFjdGlvbi5hY3Rpb259KTtcbiAgICAgIGlmKCFzb3VyY2UgJiYgYWN0aW9uS2luZCAhPT0gXCJwcm9qZWN0XCIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke2FjdGlvbktpbmR9IGFjdGlvbiB3aXRob3V0IGEgc291cmNlIGluICcke3ZpZXdJZH0nYCk7XG4gICAgICB9XG4gICAgICBpZihhY3Rpb25LaW5kICE9PSBcInByb2plY3RcIikge1xuICAgICAgICBjb21waWxlZFthY3Rpb25LaW5kXShzb3VyY2VbXCJzb3VyY2Ugdmlld1wiXSwgbWFwcGluZ09iamVjdCwgYWN0aW9uLmFjdGlvbik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb21waWxlZFthY3Rpb25LaW5kXShtYXBwaW5nT2JqZWN0KTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIGNvbXBpbGVkO1xufVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gUHVibGljIEFQSVxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZXhwb3J0IGNvbnN0IFNVQ0NFRUQgPSBbe3N1Y2Nlc3M6IHRydWV9XTtcbmV4cG9ydCBjb25zdCBGQUlMID0gW107XG5cbmV4cG9ydCBmdW5jdGlvbiBpbmRleGVyKCkge1xuICBsZXQgaXhlciA9IG5ldyBJbmRleGVyKCk7XG4gIGFkZFByb3ZlbmFuY2VUYWJsZShpeGVyKTtcbiAgYWRkUmVjb21waWxlVHJpZ2dlcnMoaXhlcik7XG4gIHJldHVybiBpeGVyO1xufVxuXG5pZihFTlYgPT09IFwiYnJvd3NlclwiKSB3aW5kb3dbXCJydW50aW1lXCJdID0gZXhwb3J0cztcbiIsImRlY2xhcmUgdmFyIHBsdXJhbGl6ZTsgLy8gQFRPRE86IGltcG9ydCBtZS5cblxuaW1wb3J0IHtwYXJzZSBhcyBtYXJrZWQsIFJlbmRlcmVyIGFzIE1hcmtlZFJlbmRlcmVyfSBmcm9tIFwiLi4vdmVuZG9yL21hcmtlZFwiO1xuaW1wb3J0ICogYXMgQ29kZU1pcnJvciBmcm9tIFwiY29kZW1pcnJvclwiO1xuaW1wb3J0IHtjb3B5LCB1dWlkLCBjb2VyY2VJbnB1dCwgYnVpbHRpbklkLCBhdXRvRm9jdXMsIEtFWVMsIG1lcmdlT2JqZWN0LCBzZXRFbmRPZkNvbnRlbnRFZGl0YWJsZSwgc2x1Z2lmeSwgbG9jYXRpb24gYXMgZ2V0TG9jYXRpb259IGZyb20gXCIuL3V0aWxzXCI7XG5pbXBvcnQge0RpZmYsIFF1ZXJ5fSBmcm9tIFwiLi9ydW50aW1lXCI7XG5pbXBvcnQge2NyZWF0ZUVkaXRvcn0gZnJvbSBcIi4vcmljaFRleHRFZGl0b3JcIjtcbmltcG9ydCB7RWxlbWVudCwgSGFuZGxlciwgUmVuZGVySGFuZGxlciwgUmVuZGVyZXJ9IGZyb20gXCIuL21pY3JvUmVhY3RcIjtcbmltcG9ydCAqIGFzIHVpdGsgZnJvbSBcIi4vdWl0a1wiO1xuaW1wb3J0IHtldmUsIGV2ZUxvY2FsU3RvcmFnZUtleSwgaGFuZGxlIGFzIGFwcEhhbmRsZSwgZGlzcGF0Y2gsIGFjdGl2ZVNlYXJjaGVzLCByZW5kZXJlcn0gZnJvbSBcIi4vYXBwXCI7XG5pbXBvcnQge3BhcnNlRFNMfSBmcm9tIFwiLi9wYXJzZXJcIjtcbmltcG9ydCB7cGFyc2UgYXMgbmxwYXJzZSwgU3RhdGVGbGFncywgRnVuY3Rpb25UeXBlc30gZnJvbSBcIi4vTkxRdWVyeVBhcnNlclwiO1xuXG5cbmV4cG9ydCBlbnVtIFBBTkUgeyBGVUxMLCBXSU5ET1csIFBPUE9VVCB9O1xuZW51bSBCTE9DSyB7IFRFWFQsIFBST0pFQ1RJT04gfTtcblxuLy8gQmVjYXVzZSBodG1sNSBpcyBmdWxsIG9mIGJyb2tlbiBwcm9taXNlcyBhbmQgYnJva2VuIGRyZWFtc1xudmFyIHBvcG91dEhpc3RvcnkgPSBbXTtcblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIFN0YXRlXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZXhwb3J0IGxldCB1aVN0YXRlOntcbiAgd2lkZ2V0OiB7XG4gICAgc2VhcmNoOiB7W3BhbmVJZDpzdHJpbmddOiB7dmFsdWU6c3RyaW5nLCBwbGFuPzpib29sZWFuLCBmb2N1c2VkPzpib29sZWFuLCBzdWJtaXR0ZWQ/OnN0cmluZ319LFxuICAgIHRhYmxlOiB7W2tleTpzdHJpbmddOiB7ZmllbGQ6c3RyaW5nLCBkaXJlY3Rpb246bnVtYmVyfX0sXG4gICAgY29sbGFwc2libGU6IHtba2V5OnN0cmluZ106IHtvcGVuOmJvb2xlYW59fVxuICAgIGF0dHJpYnV0ZXM6IGFueSxcbiAgfSxcbiAgcGFuZToge1twYW5lSWQ6c3RyaW5nXToge3NldHRpbmdzOiBib29sZWFufX0sXG4gIHByb21wdDoge29wZW46IGJvb2xlYW4sIHBhbmVJZD86IHN0cmluZywgcHJvbXB0PzogKHBhbmVJZD86c3RyaW5nKSA9PiBFbGVtZW50fSxcbn0gPSB7XG4gIHdpZGdldDoge1xuICAgIHNlYXJjaDoge30sXG4gICAgdGFibGU6IHt9LFxuICAgIGNvbGxhcHNpYmxlOiB7fSxcbiAgICBhdHRyaWJ1dGVzOiB7fSxcbiAgfSxcbiAgcGFuZToge30sXG4gIHByb21wdDoge29wZW46IGZhbHNlLCBwYW5lSWQ6IHVuZGVmaW5lZCwgcHJvbXB0OiB1bmRlZmluZWR9LFxufTtcblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIFV0aWxzXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5mdW5jdGlvbiBwcmV2ZW50RGVmYXVsdChldmVudCkge1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2V0VVJMKHBhbmVJZDpzdHJpbmcsIGNvbnRhaW5zOnN0cmluZywgcmVwbGFjZT86Ym9vbGVhbikge1xuICBsZXQgbmFtZSA9IHVpdGsucmVzb2x2ZU5hbWUoY29udGFpbnMpO1xuICBpZihwYW5lSWQgIT09IFwicDFcIikgcmV0dXJuOyAvLyBAVE9ETzogTWFrZSB0aGlzIGEgY29uc3RhbnRcbiAgXG4gIGxldCB1cmw7XG4gIGlmKGNvbnRhaW5zLmxlbmd0aCA9PT0gMCkgdXJsID0gXCIjXCI7XG4gIGVsc2UgaWYobmFtZSA9PT0gY29udGFpbnMpIHVybCA9IGAjL3NlYXJjaC8ke3NsdWdpZnkoY29udGFpbnMpfWA7XG4gIGVsc2UgdXJsID0gYCMvJHtzbHVnaWZ5KG5hbWUpfS8ke3NsdWdpZnkoY29udGFpbnMpfWA7XG4gIGxldCBzdGF0ZSA9IHtwYW5lSWQsIGNvbnRhaW5zfTtcbiAgd2luZG93W1wic3RhdGVzXCJdID0gd2luZG93W1wic3RhdGVzXCJdIHx8IFtdO1xuICB3aW5kb3dbXCJzdGF0ZXNcIl0ucHVzaChzdGF0ZSk7XG5cbiAgaWYocmVwbGFjZSkgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKHN0YXRlLCBudWxsLCB1cmwpO1xuICBlbHNlIHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZShzdGF0ZSwgbnVsbCwgdXJsKTtcbn1cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIERpc3BhdGNoZXNcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5hcHBIYW5kbGUoXCJ1aSBmb2N1cyBzZWFyY2hcIiwgKGNoYW5nZXM6RGlmZiwge3BhbmVJZCwgdmFsdWV9OntwYW5lSWQ6c3RyaW5nLCB2YWx1ZTpzdHJpbmd9KSA9PiB7XG4gIGxldCBzdGF0ZSA9IHVpU3RhdGUud2lkZ2V0LnNlYXJjaFtwYW5lSWRdID0gdWlTdGF0ZS53aWRnZXQuc2VhcmNoW3BhbmVJZF0gfHwge3ZhbHVlfTtcbiAgc3RhdGUuZm9jdXNlZCA9IHRydWU7XG59KTtcbmFwcEhhbmRsZShcInVpIHNldCBzZWFyY2hcIiwgKGNoYW5nZXM6RGlmZiwge3BhbmVJZCwgdmFsdWUsIHBlZWssIHgsIHksIHBvcFN0YXRlfTp7cGFuZUlkOnN0cmluZywgdmFsdWU6c3RyaW5nLCBwZWVrOiBib29sZWFuLCB4PzogbnVtYmVyLCB5PzogbnVtYmVyLCBwb3BTdGF0ZT86IGJvb2xlYW59KSA9PiB7XG4gIHZhbHVlID0gdmFsdWUudHJpbSgpO1xuICBsZXQgZGlzcGxheXMgPSBldmUuZmluZChcImRpc3BsYXkgbmFtZVwiLCB7bmFtZTogdmFsdWV9KTtcbiAgaWYoZGlzcGxheXMubGVuZ3RoID09PSAxKSB2YWx1ZSA9IGRpc3BsYXlzWzBdLmlkO1xuICBsZXQgZmFjdDtcbiAgaWYocGFuZUlkID09PSBcInAxXCIpIHsgLy8gQFRPRE86IE1ha2UgdGhpcyBhIGNvbnN0YW50XG4gICAgcG9wb3V0SGlzdG9yeSA9IFtdO1xuICB9IGVsc2UgaWYoIXBvcFN0YXRlKSB7XG4gICAgbGV0IHBvcG91dCA9IGV2ZS5maW5kT25lKFwidWkgcGFuZVwiLCB7a2luZDogUEFORS5QT1BPVVR9KTtcbiAgICBpZihwb3BvdXQpIHtcbiAgICAgIHBvcG91dEhpc3RvcnkucHVzaChwb3BvdXQuY29udGFpbnMpOyAvLyBARklYTUU6IFRoaXMgaXMgZnJhZ2lsZVxuICAgIH1cbiAgfVxuICBcbiAgaWYoIXBlZWspIHtcbiAgICBsZXQgc3RhdGUgPSB1aVN0YXRlLndpZGdldC5zZWFyY2hbcGFuZUlkXSA9IHVpU3RhdGUud2lkZ2V0LnNlYXJjaFtwYW5lSWRdIHx8IHt2YWx1ZX07XG4gICAgc3RhdGUudmFsdWUgPSB2YWx1ZTtcbiAgICBzdGF0ZS5mb2N1c2VkID0gZmFsc2U7XG4gICAgZmFjdCA9IGNvcHkoZXZlLmZpbmRPbmUoXCJ1aSBwYW5lXCIsIHtwYW5lOiBwYW5lSWR9KSk7XG4gICAgZmFjdC5fX2lkID0gdW5kZWZpbmVkO1xuICAgIGZhY3QuY29udGFpbnMgPSB2YWx1ZTtcbiAgICBjaGFuZ2VzLnJlbW92ZShcInVpIHBhbmVcIiwge3BhbmU6IHBhbmVJZH0pO1xuICAgIGxldCBjaGlsZHJlbiA9IGV2ZS5maW5kKFwidWkgcGFuZSBwYXJlbnRcIiwge3BhcmVudDogcGFuZUlkfSk7XG4gICAgZm9yKGxldCB7cGFuZTpjaGlsZH0gb2YgY2hpbGRyZW4pIHtcbiAgICAgIGNoYW5nZXMucmVtb3ZlKFwidWkgcGFuZSBwb3NpdGlvblwiLCB7cGFuZTogY2hpbGR9KTtcbiAgICAgIGNoYW5nZXMucmVtb3ZlKFwidWkgcGFuZVwiLCB7cGFuZTogY2hpbGR9KTtcbiAgICB9XG4gICAgY2hhbmdlcy5yZW1vdmUoXCJ1aSBwYW5lIHBhcmVudFwiLCB7cGFyZW50OiBwYW5lSWR9KTtcbiAgICBpZighcG9wU3RhdGUpIHNldFVSTChwYW5lSWQsIHZhbHVlKTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgcG9wb3V0ID0gZXZlLmZpbmRPbmUoXCJ1aSBwYW5lXCIsIHtraW5kOiBQQU5FLlBPUE9VVH0pO1xuICAgIGxldCBuZXVlUGFuZUlkO1xuICAgIGlmKCFwb3BvdXQpIHtcbiAgICAgIG5ldWVQYW5lSWQgPSB1dWlkKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5ldWVQYW5lSWQgPSBwb3BvdXQucGFuZTtcbiAgICAgIGNoYW5nZXMucmVtb3ZlKFwidWkgcGFuZVwiLCB7cGFuZTogbmV1ZVBhbmVJZH0pO1xuICAgIH1cbiAgICBsZXQgc3RhdGUgPSB1aVN0YXRlLndpZGdldC5zZWFyY2hbbmV1ZVBhbmVJZF0gPSB7dmFsdWV9O1xuICAgIGZhY3QgPSB7Y29udGFpbnM6IHZhbHVlLCBwYW5lOiBuZXVlUGFuZUlkLCBraW5kOiBQQU5FLlBPUE9VVH07XG4gICAgaWYoIXBvcG91dCB8fCBwYW5lSWQgIT09IG5ldWVQYW5lSWQpIHtcbiAgICAgIGlmKHggIT09IHVuZGVmaW5lZCAmJiB5ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY2hhbmdlcy5yZW1vdmUoXCJ1aSBwYW5lIHBvc2l0aW9uXCIsIHtwYW5lOiBuZXVlUGFuZUlkfSk7XG4gICAgICAgIGNoYW5nZXMuYWRkKFwidWkgcGFuZSBwb3NpdGlvblwiLCB7cGFuZTogbmV1ZVBhbmVJZCwgeCwgeX0pO1xuICAgICAgfVxuICAgICAgY2hhbmdlcy5yZW1vdmUoXCJ1aSBwYW5lIHBhcmVudFwiLCB7cGFyZW50OiBwYW5lSWR9KTtcbiAgICAgIGNoYW5nZXMuYWRkKFwidWkgcGFuZSBwYXJlbnRcIiwge3BhbmU6IG5ldWVQYW5lSWQsIHBhcmVudDogcGFuZUlkfSk7XG4gICAgfVxuICAgIHBhbmVJZCA9IG5ldWVQYW5lSWQ7XG4gIH1cbiAgY2hhbmdlcy5hZGQoXCJ1aSBwYW5lXCIsIGZhY3QpO1xufSk7XG5cbmFwcEhhbmRsZShcInJlbW92ZSBwb3B1cFwiLCAoY2hhbmdlczpEaWZmLCB7fTp7fSkgPT4ge1xuICBsZXQgcG9wdXAgPSBldmUuZmluZE9uZShcInVpIHBhbmVcIiwge2tpbmQ6IFBBTkUuUE9QT1VUfSk7XG4gIGlmKHBvcHVwKSB7XG4gICAgbGV0IHBhbmVJZCA9IHBvcHVwLnBhbmU7XG4gICAgY2hhbmdlcy5yZW1vdmUoXCJ1aSBwYW5lXCIsIHtwYW5lOiBwYW5lSWR9KTtcbiAgICBjaGFuZ2VzLnJlbW92ZShcInVpIHBhbmUgcG9zaXRpb25cIiwge3BhbmU6IHBhbmVJZH0pO1xuICB9XG4gIHBvcG91dEhpc3RvcnkgPSBbXTtcbn0pO1xuXG5hcHBIYW5kbGUoXCJ1aSB0b2dnbGUgc2VhcmNoIHBsYW5cIiwgKGNoYW5nZXM6RGlmZiwge3BhbmVJZH06e3BhbmVJZDpzdHJpbmd9KSA9PiB7XG4gIGxldCBzdGF0ZSA9IHVpU3RhdGUud2lkZ2V0LnNlYXJjaFtwYW5lSWRdID0gdWlTdGF0ZS53aWRnZXQuc2VhcmNoW3BhbmVJZF0gfHwge3ZhbHVlOiBcIlwifTtcbiAgc3RhdGUucGxhbiA9ICFzdGF0ZS5wbGFuO1xufSk7XG5cbmFwcEhhbmRsZShcImFkZCBzb3VyY2VkIGVhdlwiLCAoY2hhbmdlczpEaWZmLCBlYXY6e2VudGl0eTpzdHJpbmcsIGF0dHJpYnV0ZTpzdHJpbmcsIHZhbHVlOnN0cmluZ3xudW1iZXIsIHNvdXJjZTpzdHJpbmd9KSA9PiB7XG4gIGlmKCFlYXYuc291cmNlKSB7XG4gICAgZWF2LnNvdXJjZSA9IHV1aWQoKTtcbiAgfVxuICBjaGFuZ2VzLmFkZChcInNvdXJjZWQgZWF2XCIsIGVhdik7XG59KTtcblxuYXBwSGFuZGxlKFwicmVtb3ZlIHNvdXJjZWQgZWF2XCIsIChjaGFuZ2VzOkRpZmYsIGVhdjp7ZW50aXR5OnN0cmluZywgc291cmNlOnN0cmluZ30pID0+IHtcbiAgICBjaGFuZ2VzLnJlbW92ZShcInNvdXJjZWQgZWF2XCIsIGVhdik7XG59KTtcbiBcbmFwcEhhbmRsZShcInVwZGF0ZSBwYWdlXCIsIChjaGFuZ2VzOkRpZmYsIHtwYWdlLCBjb250ZW50fToge3BhZ2U6IHN0cmluZywgY29udGVudDogc3RyaW5nfSkgPT4ge1xuICBjaGFuZ2VzLnJlbW92ZShcInBhZ2UgY29udGVudFwiLCB7cGFnZX0pO1xuICBjaGFuZ2VzLmFkZChcInBhZ2UgY29udGVudFwiLCB7cGFnZSwgY29udGVudH0pO1xuICBsZXQgdHJpbW1lZCA9IGNvbnRlbnQudHJpbSgpO1xuICBsZXQgZW5kSXggPSB0cmltbWVkLmluZGV4T2YoXCJcXG5cIik7XG4gIGxldCBuYW1lID0gdHJpbW1lZC5zbGljZSgxLCBlbmRJeCAhPT0gLTEgPyBlbmRJeCA6IHVuZGVmaW5lZCkudHJpbSgpO1xuICBsZXQge2VudGl0eX0gPSBldmUuZmluZE9uZShcImVudGl0eSBwYWdlXCIsIHtwYWdlfSk7XG4gIGxldCB7bmFtZTpwcmV2TmFtZSA9IHVuZGVmaW5lZH0gPSBldmUuZmluZE9uZShcImRpc3BsYXkgbmFtZVwiLCB7aWQ6IGVudGl0eX0pIHx8IHt9O1xuICBpZihuYW1lICE9PSBwcmV2TmFtZSkge1xuICAgIGNoYW5nZXMucmVtb3ZlKFwiZGlzcGxheSBuYW1lXCIsIHtpZDogZW50aXR5LCBuYW1lOiBwcmV2TmFtZX0pO1xuICAgIGNoYW5nZXMuYWRkKFwiZGlzcGxheSBuYW1lXCIsIHtpZDogZW50aXR5LCBuYW1lfSk7XG4gICAgbGV0IHBhcnRzID0gZ2V0TG9jYXRpb24oKS5zcGxpdChcIi9cIik7XG4gICAgaWYocGFydHMubGVuZ3RoID4gMiAmJiBwYXJ0c1syXS5yZXBsYWNlKC9fL2dpLCBcIiBcIikgPT09IGVudGl0eSkge1xuICAgICAgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKHdpbmRvdy5oaXN0b3J5LnN0YXRlLCBudWxsLCBgLyR7c2x1Z2lmeShuYW1lKX0vJHtzbHVnaWZ5KGVudGl0eSl9YCk7XG4gICAgfVxuICB9XG59KTtcbmFwcEhhbmRsZShcImNyZWF0ZSBlbnRpdHlcIiwgKGNoYW5nZXM6RGlmZiwge2VudGl0eSwgcGFnZSwgbmFtZSA9IFwiVW50aXRsZWRcIn0pID0+IHtcbiAgY2hhbmdlc1xuICAgIC5hZGQoXCJlbnRpdHkgcGFnZVwiLCB7ZW50aXR5LCBwYWdlfSlcbiAgICAuYWRkKFwiZGlzcGxheSBuYW1lXCIsIHtpZDogZW50aXR5LCBuYW1lfSk7XG59KTtcbmFwcEhhbmRsZShcImNyZWF0ZSBwYWdlXCIsIChjaGFuZ2VzOkRpZmYsIHtwYWdlLCBjb250ZW50ID0gdW5kZWZpbmVkfToge3BhZ2U6IHN0cmluZywgY29udGVudD86c3RyaW5nfSkgPT4ge1xuICBpZihjb250ZW50ID09PSB1bmRlZmluZWQpIGNvbnRlbnQgPSBcIlRoaXMgcGFnZSBpcyBlbXB0eS4gVHlwZSBzb21ldGhpbmcgdG8gYWRkIHNvbWUgY29udGVudCFcIjtcbiAgY2hhbmdlcy5hZGQoXCJwYWdlIGNvbnRlbnRcIiwge3BhZ2UsIGNvbnRlbnR9KTtcbn0pO1xuYXBwSGFuZGxlKFwiY3JlYXRlIHF1ZXJ5XCIsIChjaGFuZ2VzOkRpZmYsIHtpZCwgY29udGVudH0pID0+IHtcbiAgbGV0IHBhZ2UgPSB1dWlkKCk7XG4gIGNoYW5nZXNcbiAgICAuYWRkKFwicGFnZSBjb250ZW50XCIsIHtwYWdlLCBjb250ZW50OiBgIyR7Y29udGVudH0gcXVlcnlgfSlcbiAgICAuYWRkKFwiZW50aXR5IHBhZ2VcIiwge2lkLCBwYWdlfSlcbiAgICAuYWRkKFwiZGlzcGxheSBuYW1lXCIsIHtpZCwgY29udGVudH0pXG4gICAgLmFkZChcInNvdXJjZWQgZWF2XCIsIHtlbnRpdHk6IGlkLCBhdHRyaWJ1dGU6IFwiaXMgYVwiLCB2YWx1ZTogYnVpbHRpbklkKFwicXVlcnlcIil9KVxuICAgIC5hZGQoXCJzb3VyY2VkIGVhdlwiLCB7ZW50aXR5OiBpZCwgYXR0cmlidXRlOiBcImNvbnRlbnRcIiwgdmFsdWU6IGNvbnRlbnR9KTtcbiAgbGV0IGFydGlmYWN0cyA9IHBhcnNlRFNMKGNvbnRlbnQpO1xuICBpZihhcnRpZmFjdHMuY2hhbmdlc2V0KSBjaGFuZ2VzLm1lcmdlKGFydGlmYWN0cy5jaGFuZ2VzZXQpO1xuICBmb3IobGV0IHZpZXdJZCBpbiBhcnRpZmFjdHMudmlld3MpIHtcbiAgICBjaGFuZ2VzLmFkZChcInNvdXJjZWQgZWF2XCIsIHtlbnRpdHk6IGlkLCBhdHRyaWJ1dGU6IFwiYXJ0aWZhY3RcIiwgdmFsdWU6IHZpZXdJZH0pO1xuICAgIGxldCBuYW1lID0gYXJ0aWZhY3RzLnZpZXdzW3ZpZXdJZF1bXCJkaXNwbGF5TmFtZVwiXTtcbiAgICBpZighZXZlLmZpbmRPbmUoXCJkaXNwbGF5IG5hbWVcIiwge2lkOiB2aWV3SWR9KSAmJiBuYW1lKSBjaGFuZ2VzLmFkZChcImRpc3BsYXkgbmFtZVwiLCB7aWQ6IHZpZXdJZCwgbmFtZX0pO1xuICAgIGNoYW5nZXMubWVyZ2UoYXJ0aWZhY3RzLnZpZXdzW3ZpZXdJZF0uY2hhbmdlc2V0KGV2ZSkpO1xuICB9XG59KTtcblxuYXBwSGFuZGxlKFwiaW5zZXJ0IHF1ZXJ5XCIsIChjaGFuZ2VzOkRpZmYsIHtxdWVyeX0pID0+IHtcbiAgaWYoZXZlLmZpbmRPbmUoXCJxdWVyeSB0byBpZFwiLCB7cXVlcnl9KSkgcmV0dXJuO1xuICBxdWVyeSA9IHF1ZXJ5LnRyaW0oKTtcbiAgbGV0IHBhcnNlZCA9IG5scGFyc2UocXVlcnkpO1xuICBpZihwYXJzZWRbMF0uc3RhdGUgPT09IFN0YXRlRmxhZ3MuQ09NUExFVEUpIHtcbiAgICBsZXQgYXJ0aWZhY3RzID0gcGFyc2VEU0wocGFyc2VkWzBdLnF1ZXJ5LnRvU3RyaW5nKCkpO1xuICAgIGlmKGFydGlmYWN0cy5jaGFuZ2VzZXQpIGNoYW5nZXMubWVyZ2UoYXJ0aWZhY3RzLmNoYW5nZXNldCk7XG4gICAgdmFyIHJvb3RJZDtcbiAgICBmb3IobGV0IHZpZXdJZCBpbiBhcnRpZmFjdHMudmlld3MpIHtcbiAgICAgIGlmKCFyb290SWQpIHJvb3RJZCA9IHZpZXdJZDtcbiAgICAgIGxldCBuYW1lID0gYXJ0aWZhY3RzLnZpZXdzW3ZpZXdJZF1bXCJkaXNwbGF5TmFtZVwiXTtcbiAgICAgIGlmKCFldmUuZmluZE9uZShcImRpc3BsYXkgbmFtZVwiLCB7aWQ6IHZpZXdJZH0pICYmIG5hbWUpIGNoYW5nZXMuYWRkKFwiZGlzcGxheSBuYW1lXCIsIHtpZDogdmlld0lkLCBuYW1lfSk7XG4gICAgICBjaGFuZ2VzLm1lcmdlKGFydGlmYWN0cy52aWV3c1t2aWV3SWRdLmNoYW5nZXNldChldmUpKTtcbiAgICB9XG4gICAgY2hhbmdlcy5hZGQoXCJxdWVyeSB0byBpZFwiLCB7cXVlcnksIGlkOiByb290SWR9KVxuICB9XG59KTtcblxuLy8gQFRPRE86IHRoZXJlJ3MgYSBsb3Qgb2YgZHVwbGljYXRpb24gYmV0d2VlbiBpbnNlcnQgcXVlcnksIGNyZWF0ZSBxdWVyeSwgYW5kIGluc2VydCBpbXBsaWNhdGlvblxuYXBwSGFuZGxlKFwiaW5zZXJ0IGltcGxpY2F0aW9uXCIsIChjaGFuZ2VzOkRpZmYsIHtxdWVyeX0pID0+IHtcbiAgbGV0IGFydGlmYWN0cyA9IHBhcnNlRFNMKHF1ZXJ5KTtcbiAgaWYoYXJ0aWZhY3RzLmNoYW5nZXNldCkgY2hhbmdlcy5tZXJnZShhcnRpZmFjdHMuY2hhbmdlc2V0KTtcbiAgZm9yKGxldCB2aWV3SWQgaW4gYXJ0aWZhY3RzLnZpZXdzKSB7XG4gICAgbGV0IG5hbWUgPSBhcnRpZmFjdHMudmlld3Nbdmlld0lkXVtcImRpc3BsYXlOYW1lXCJdO1xuICAgIGlmKCFldmUuZmluZE9uZShcImRpc3BsYXkgbmFtZVwiLCB7aWQ6IHZpZXdJZH0pICYmIG5hbWUpIGNoYW5nZXMuYWRkKFwiZGlzcGxheSBuYW1lXCIsIHtpZDogdmlld0lkLCBuYW1lfSk7XG4gICAgY2hhbmdlcy5tZXJnZShhcnRpZmFjdHMudmlld3Nbdmlld0lkXS5jaGFuZ2VzZXQoZXZlKSk7XG4gIH1cbn0pXG5cbmFwcEhhbmRsZShcInJlbW92ZSBlbnRpdHkgYXR0cmlidXRlXCIsIChjaGFuZ2VzOkRpZmYsIHtlbnRpdHksIGF0dHJpYnV0ZSwgdmFsdWV9KSA9PiB7XG4gIGNoYW5nZXMucmVtb3ZlKFwic291cmNlZCBlYXZcIiwge2VudGl0eSwgYXR0cmlidXRlLCB2YWx1ZX0pO1xuICAvLyBARklYTUU6IE1ha2UgZW1iZWRzIGF1dG8tZ2MgdGhlbXNlbHZlcyB3aGVuIGludmFsaWRhdGVkLlxufSk7XG5hcHBIYW5kbGUoXCJ1cGRhdGUgZW50aXR5IGF0dHJpYnV0ZVwiLCAoY2hhbmdlczpEaWZmLCB7ZW50aXR5LCBhdHRyaWJ1dGUsIHByZXYsIHZhbHVlfSkgPT4ge1xuICAvLyBARklYTUU6IHByb3BlciB1bmlxdWUgc291cmNlIGlkXG4gIGxldCB7c291cmNlID0gXCI8Z2xvYmFsPlwifSA9IGV2ZS5maW5kT25lKFwic291cmNlZCBlYXZcIiwge2VudGl0eSwgYXR0cmlidXRlLCB2YWx1ZTogcHJldn0pIHx8IHt9O1xuICBpZihwcmV2ICE9PSB1bmRlZmluZWQpIGNoYW5nZXMucmVtb3ZlKFwic291cmNlZCBlYXZcIiwge2VudGl0eSwgYXR0cmlidXRlLCB2YWx1ZTogcHJldn0pO1xuICBjaGFuZ2VzLmFkZChcInNvdXJjZWQgZWF2XCIsIHtlbnRpdHksIGF0dHJpYnV0ZSwgdmFsdWUsIHNvdXJjZX0pO1xufSk7XG5hcHBIYW5kbGUoXCJyZW5hbWUgZW50aXR5IGF0dHJpYnV0ZVwiLCAoY2hhbmdlczpEaWZmLCB7ZW50aXR5LCBhdHRyaWJ1dGUsIHByZXYsIHZhbHVlfSkgPT4ge1xuICAvLyBARklYTUU6IHByb3BlciB1bmlxdWUgc291cmNlIGlkXG4gIGxldCB7c291cmNlID0gXCI8Z2xvYmFsPlwifSA9IGV2ZS5maW5kT25lKFwic291cmNlZCBlYXZcIiwge2VudGl0eSwgYXR0cmlidXRlOiBwcmV2LCB2YWx1ZX0pIHx8IHt9O1xuICBpZihwcmV2ICE9PSB1bmRlZmluZWQpIGNoYW5nZXMucmVtb3ZlKFwic291cmNlZCBlYXZcIiwge2VudGl0eSwgYXR0cmlidXRlOiBwcmV2LCB2YWx1ZX0pO1xuICBjaGFuZ2VzLmFkZChcInNvdXJjZWQgZWF2XCIsIHtlbnRpdHksIGF0dHJpYnV0ZSwgdmFsdWUsIHNvdXJjZX0pO1xufSk7XG5hcHBIYW5kbGUoXCJzb3J0IHRhYmxlXCIsIChjaGFuZ2VzOkRpZmYsIHtrZXksIGZpZWxkLCBkaXJlY3Rpb259KSA9PiB7XG4gIGxldCBzdGF0ZSA9IHVpU3RhdGUud2lkZ2V0LnRhYmxlW2tleV0gfHwge2ZpZWxkOiB1bmRlZmluZWQsIGRpcmVjdGlvbjogdW5kZWZpbmVkfTtcbiAgaWYoZmllbGQgIT09IHVuZGVmaW5lZCkgc3RhdGUuZmllbGQgPSBmaWVsZDtcbiAgaWYoZGlyZWN0aW9uICE9PSB1bmRlZmluZWQpIHN0YXRlLmRpcmVjdGlvbiA9IGRpcmVjdGlvbjtcbiAgdWlTdGF0ZS53aWRnZXQudGFibGVba2V5XSA9IHN0YXRlO1xufSk7XG5hcHBIYW5kbGUoXCJ0b2dnbGUgc2V0dGluZ3NcIiwgKGNoYW5nZXM6RGlmZiwge3BhbmVJZCwgb3BlbiA9IHVuZGVmaW5lZH0pID0+IHtcbiAgbGV0IHN0YXRlID0gdWlTdGF0ZS5wYW5lW3BhbmVJZF0gfHwge3NldHRpbmdzOiBmYWxzZX07XG4gIHN0YXRlLnNldHRpbmdzID0gb3BlbiAhPT0gdW5kZWZpbmVkID8gb3BlbiA6ICFzdGF0ZS5zZXR0aW5ncztcbiAgdWlTdGF0ZS5wYW5lW3BhbmVJZF0gPSBzdGF0ZTtcbn0pO1xuYXBwSGFuZGxlKFwidG9nZ2xlIGNvbGxhcHNlXCIsIChjaGFuZ2VzOkRpZmYsIHtjb2xsYXBzaWJsZSwgb3BlbiA9IHVuZGVmaW5lZH0pID0+IHtcbiAgbGV0IHN0YXRlID0gdWlTdGF0ZS53aWRnZXQuY29sbGFwc2libGVbY29sbGFwc2libGVdIHx8IHtvcGVuOiBmYWxzZX07XG4gIHN0YXRlLm9wZW4gPSBvcGVuICE9PSB1bmRlZmluZWQgPyBvcGVuIDogIXN0YXRlLm9wZW47XG4gIHVpU3RhdGUud2lkZ2V0LmNvbGxhcHNpYmxlW2NvbGxhcHNpYmxlXSA9IHN0YXRlO1xufSk7XG5hcHBIYW5kbGUoXCJ0b2dnbGUgcHJvbXB0XCIsIChjaGFuZ2VzOkRpZmYsIHtwcm9tcHQgPSB1bmRlZmluZWQsIHBhbmVJZCA9IHVuZGVmaW5lZCwgb3BlbiA9IHVuZGVmaW5lZH0pID0+IHtcbiAgbGV0IHN0YXRlID0gdWlTdGF0ZS5wcm9tcHQ7XG4gIGlmKHN0YXRlLnByb21wdCAhPT0gcHJvbXB0KSB7XG4gICAgc3RhdGUucHJvbXB0ID0gcHJvbXB0O1xuICAgIHN0YXRlLm9wZW4gPSBvcGVuICE9PSB1bmRlZmluZWQgPyBvcGVuIDogdHJ1ZTtcbiAgICBzdGF0ZS5wYW5lSWQgPSBwYW5lSWQ7XG4gIH0gZWxzZSB7XG4gICAgc3RhdGUub3BlbiAhPT0gdW5kZWZpbmVkID8gb3BlbiA6ICFzdGF0ZS5vcGVuO1xuICB9XG4gIHVpU3RhdGUucHJvbXB0ID0gc3RhdGU7XG59KTtcbmFwcEhhbmRsZShcInJlbW92ZSBlbnRpdHlcIiwgKGNoYW5nZXM6RGlmZiwge2VudGl0eX0pID0+IHtcbiAgY2hhbmdlcy5yZW1vdmUoXCJzb3VyY2VkIGVhdlwiLCB7ZW50aXR5fSlcbiAgICAucmVtb3ZlKFwiZGlzcGxheSBuYW1lXCIsIHtpZDogZW50aXR5fSlcbiAgICAucmVtb3ZlKFwibWFudWFsIGVhdnNcIiwge2VudGl0eX0pXG4gICAgLnJlbW92ZShcImVudGl0eSBwYWdlXCIsIHtlbnRpdHl9KTtcbn0pO1xuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gV2lraSBDb250YWluZXJzXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZXhwb3J0IGZ1bmN0aW9uIHJvb3QoKTpFbGVtZW50IHtcbiAgbGV0IHBhbmVzID0gW107XG4gIGZvcihsZXQge3BhbmU6cGFuZUlkfSBvZiBldmUuZmluZChcInVpIHBhbmVcIikpIHtcbiAgICBwYW5lcy5wdXNoKHBhbmUocGFuZUlkKSk7XG4gIH1cbiAgaWYodWlTdGF0ZS5wcm9tcHQub3BlbiAmJiB1aVN0YXRlLnByb21wdC5wcm9tcHQgJiYgIXVpU3RhdGUucHJvbXB0LnBhbmVJZCkge1xuICAgIHBhbmVzLnB1c2goe2M6IFwic2hhZGVcIiwgY2xpY2s6IGNsb3NlUHJvbXB0LCBjaGlsZHJlbjogW1xuICAgICAgdWlTdGF0ZS5wcm9tcHQucHJvbXB0KClcbiAgICBdfSk7XG4gIH1cbiAgcmV0dXJuIHtjOiBcIndpa2ktcm9vdFwiLCBpZDogXCJyb290XCIsIGNoaWxkcmVuOiBwYW5lcywgY2xpY2s6IHJlbW92ZVBvcHVwfTtcbn1cblxuLy8gQFRPRE86IEFkZCBzZWFyY2ggZnVuY3Rpb25hbGl0eSArIFBhbmUgQ2hyb21lXG5sZXQgcGFuZUNocm9tZTp7W2tpbmQ6bnVtYmVyXTogKHBhbmVJZDpzdHJpbmcsIGVudGl0eUlkOnN0cmluZykgPT4ge2M/OiBzdHJpbmcsIGhlYWRlcj86RWxlbWVudCwgZm9vdGVyPzpFbGVtZW50LCBjYXB0dXJlQ2xpY2tzPzpib29sZWFufX0gPSB7XG4gIFtQQU5FLkZVTExdOiAocGFuZUlkLCBlbnRpdHlJZCkgPT4gKHtcbiAgICBjOiBcImZ1bGxzY3JlZW5cIixcbiAgICBoZWFkZXI6IHt0OiBcImhlYWRlclwiLCBjOiBcImZsZXgtcm93XCIsIGNoaWxkcmVuOiBbXG4gICAgICB7YzogXCJsb2dvIGV2ZS1sb2dvXCIsIGRhdGE6IHtwYW5lSWR9LCBsaW5rOiBcIlwiLCBjbGljazogbmF2aWdhdGV9LFxuICAgICAgc2VhcmNoSW5wdXQocGFuZUlkLCBlbnRpdHlJZCksXG4gICAgICB7YzogXCJjb250cm9scyB2aXNpYmxlXCIsIGNoaWxkcmVuOiBbXG4gICAgICAgIHtjOiBcImlvbi1nZWFyLWEgdG9nZ2xlLXNldHRpbmdzXCIsIHN0eWxlOiBcImZvbnQtc2l6ZTogMS4zNWVtO1wiLCBwcm9tcHQ6IHBhbmVTZXR0aW5ncywgcGFuZUlkLCBjbGljazogb3BlblByb21wdH1cbiAgICAgIF19XG4gICAgXX1cbiAgfSksXG4gIFtQQU5FLlBPUE9VVF06IChwYW5lSWQsIGVudGl0eUlkKSA9PiB7XG4gICAgbGV0IHBhcmVudCA9IGV2ZS5maW5kT25lKFwidWkgcGFuZSBwYXJlbnRcIiwge3BhbmU6IHBhbmVJZH0pW1wicGFyZW50XCJdO1xuICAgIHJldHVybiB7XG4gICAgICBjOiBcIndpbmRvd1wiLFxuICAgICAgY2FwdHVyZUNsaWNrczogdHJ1ZSxcbiAgICAgIGhlYWRlcjoge3Q6IFwiaGVhZGVyXCIsIGM6IFwiXCIsIGNoaWxkcmVuOiBbXG4gICAgICAgIHt0OiBcImJ1dHRvblwiLCBjOiBcImlvbi1hbmRyb2lkLW9wZW5cIiwgY2xpY2s6IG5hdmlnYXRlUGFyZW50LCBsaW5rOiBlbnRpdHlJZCwgcGFuZUlkOiBwYW5lSWQsIHBhcmVudElkOiBwYXJlbnQsIHRleHQ6XCJcIn0sXG4gICAgICBdfSxcbiAgICB9O1xuICB9LFxuICBbUEFORS5XSU5ET1ddOiAocGFuZUlkLCBlbnRpdHlJZCkgPT4gKHtcbiAgICBjOiBcIndpbmRvd1wiLFxuICAgIGhlYWRlcjoge3Q6IFwiaGVhZGVyXCIsIGM6IFwiZmxleC1yb3dcIiwgY2hpbGRyZW46IFtcbiAgICAgIHtjOiBcImZsZXgtZ3JvdyB0aXRsZVwiLCB0ZXh0OiBlbnRpdHlJZH0sXG4gICAgICB7YzogXCJmbGV4LXJvdyBjb250cm9sc1wiLCBjaGlsZHJlbjogW1xuICAgICAgICB7YzogXCJpb24tYW5kcm9pZC1zZWFyY2hcIn0sXG4gICAgICAgIHtjOiBcImlvbi1taW51cy1yb3VuZFwifSxcbiAgICAgICAge2M6IFwiaW9uLWNsb3NlLXJvdW5kXCJ9XG4gICAgICBdfVxuICAgIF19XG4gIH0pXG59O1xuXG5mdW5jdGlvbiBvcGVuUHJvbXB0KGV2ZW50LCBlbGVtKSB7XG4gIGRpc3BhdGNoKFwidG9nZ2xlIHByb21wdFwiLCB7cHJvbXB0OiBlbGVtLnByb21wdCwgcGFuZUlkOiBlbGVtLnBhbmVJZCwgb3BlbjogdHJ1ZX0pLmNvbW1pdCgpO1xufVxuZnVuY3Rpb24gY2xvc2VQcm9tcHQoZXZlbnQsIGVsZW0pIHtcbiAgaWYoZXZlbnQudGFyZ2V0ID09PSBldmVudC5jdXJyZW50VGFyZ2V0KSB7XG4gICAgZGlzcGF0Y2goXCJ0b2dnbGUgcHJvbXB0XCIsIHtvcGVuOiBmYWxzZX0pLmNvbW1pdCgpO1xuICB9XG59XG5cbmZ1bmN0aW9uIG5hdmlnYXRlUGFyZW50KGV2ZW50LCBlbGVtKSB7XG4gIGRpc3BhdGNoKFwicmVtb3ZlIHBvcHVwXCIsIHtwYW5lSWQ6IGVsZW0ucGFuZUlkfSlcbiAgLmRpc3BhdGNoKFwidWkgc2V0IHNlYXJjaFwiLCB7cGFuZUlkOiBlbGVtLnBhcmVudElkLCB2YWx1ZTogZWxlbS5saW5rfSlcbiAgLmNvbW1pdCgpO1xufVxuXG5mdW5jdGlvbiByZW1vdmVQb3B1cChldmVudCwgZWxlbSkge1xuICBpZighZXZlbnQuZGVmYXVsdFByZXZlbnRlZCkge1xuICAgIGxldCBjaGFpbiA9IGRpc3BhdGNoKFwicmVtb3ZlIHBvcHVwXCIsIHt9KS5kaXNwYXRjaChcImNsZWFyQWN0aXZlQ2VsbHNcIiwge30pO1xuICAgIGZvcihsZXQgZW50aXR5IGluIHVpU3RhdGUud2lkZ2V0LmF0dHJpYnV0ZXMpIHtcbiAgICAgIGNoYWluLmRpc3BhdGNoKFwiY2xlYXJBY3RpdmVBdHRyaWJ1dGVcIiwge2VudGl0eX0pO1xuICAgIH1cbiAgICBjaGFpbi5jb21taXQoKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBsb2FkRnJvbUZpbGUoZXZlbnQ6RXZlbnQsIGVsZW0pIHtcbiAgbGV0IHRhcmdldCA9IDxIVE1MSW5wdXRFbGVtZW50PmV2ZW50LnRhcmdldDtcbiAgaWYoIXRhcmdldC5maWxlcy5sZW5ndGgpIHJldHVybjtcbiAgaWYodGFyZ2V0LmZpbGVzLmxlbmd0aCA+IDEpIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCBsb2FkIG11bHRpcGxlIGZpbGVzIGF0IG9uY2VcIik7XG4gIGxldCBmaWxlID0gdGFyZ2V0LmZpbGVzWzBdO1xuICBsZXQgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcbiAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uKGV2ZW50OmFueSkge1xuICAgIGxldCBzZXJpYWxpemVkID0gZXZlbnQudGFyZ2V0LnJlc3VsdDtcbiAgICBldmUubG9hZChzZXJpYWxpemVkKTtcbiAgICBkaXNwYXRjaChcInRvZ2dsZSBwcm9tcHRcIiwge3Byb21wdDogbG9hZGVkUHJvbXB0LCBvcGVuOiB0cnVlfSkuY29tbWl0KCk7XG4gIH07XG4gIHJlYWRlci5yZWFkQXNUZXh0KGZpbGUpO1xufVxuXG5mdW5jdGlvbiBkZWxldGVEYXRhYmFzZVByb21wdCgpOkVsZW1lbnQge1xuICByZXR1cm4ge2M6IFwibW9kYWwtcHJvbXB0IGRlbGV0ZS1wcm9tcHRcIiwgY2hpbGRyZW46IFtcbiAgICB7dDogXCJoZWFkZXJcIiwgYzogXCJmbGV4LXJvd1wiLCBjaGlsZHJlbjogW1xuICAgICAge3Q6IFwiaDJcIiwgdGV4dDogXCJERUxFVEUgREFUQUJBU0VcIn0sXG4gICAgICB7YzogXCJmbGV4LWdyb3dcIn0sXG4gICAgICB7YzogXCJjb250cm9sc1wiLCBjaGlsZHJlbjogW3tjOiBcImlvbi1jbG9zZS1yb3VuZFwiLCBjbGljazogY2xvc2VQcm9tcHR9XX1cbiAgICBdfSxcbiAgICB7YzogXCJpbmZvXCIsIHRleHQ6IFwiVGhpcyB3aWxsIHJlbW92ZSBhbGwgaW5mb3JtYXRpb24gY3VycmVudGx5IHN0b3JlZCBpbiBFdmUgZm9yIHlvdSBhbmQgY2Fubm90IGJlIHVuZG9uZS5cIn0sXG4gICAge2M6IFwiZmxleC1yb3dcIiwgY2hpbGRyZW46IFtcbiAgICAgIHt0OiBcImJ1dHRvblwiLCBjOiBcImRlbGV0ZS1idG5cIiwgdGV4dDogXCJERUxFVEUgRVZFUllUSElORyBGT1JFVkVSXCIsIGNsaWNrOiBudWtlRGF0YWJhc2V9LFxuICAgICAge2M6IFwiZmxleC1ncm93XCJ9LFxuICAgICAge3Q6IFwiYnV0dG9uXCIsIHRleHQ6IFwiQ2FuY2VsXCIsIGNsaWNrOiBjbG9zZVByb21wdH0sXG4gICAgXX1cbiAgXX07XG59XG5cbmZ1bmN0aW9uIG51a2VEYXRhYmFzZSgpIHtcbiAgbG9jYWxTdG9yYWdlLmNsZWFyKCk7XG4gIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbn1cblxuXG5mdW5jdGlvbiBzYXZlUHJvbXB0KCk6RWxlbWVudCB7XG4gIGxldCBzZXJpYWxpemVkID0gbG9jYWxTdG9yYWdlW2V2ZUxvY2FsU3RvcmFnZUtleV07XG4gIHJldHVybiB7YzogXCJtb2RhbC1wcm9tcHQgc2F2ZS1wcm9tcHRcIiwgY2hpbGRyZW46IFtcbiAgICB7dDogXCJoZWFkZXJcIiwgYzogXCJmbGV4LXJvd1wiLCBjaGlsZHJlbjogW1xuICAgICAge3Q6IFwiaDJcIiwgdGV4dDogXCJTYXZlIERCXCJ9LFxuICAgICAge2M6IFwiZmxleC1ncm93XCJ9LFxuICAgICAge2M6IFwiY29udHJvbHNcIiwgY2hpbGRyZW46IFt7YzogXCJpb24tY2xvc2Utcm91bmRcIiwgY2xpY2s6IGNsb3NlUHJvbXB0fV19XG4gICAgXX0sXG4gICAge3Q6IFwiYVwiLCBocmVmOiBcImRhdGE6YXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtO2NoYXJzZXQ9dXRmLTE2bGU7YmFzZTY0LFwiICsgYnRvYShzZXJpYWxpemVkKSwgZG93bmxvYWQ6IFwic2F2ZS5ldmVkYlwiLCB0ZXh0OiBcInNhdmUgdG8gZmlsZVwifVxuICBdfTtcbn1cblxuZnVuY3Rpb24gbG9hZFByb21wdCgpOkVsZW1lbnQge1xuICBsZXQgc2VyaWFsaXplZCA9IGxvY2FsU3RvcmFnZVtldmVMb2NhbFN0b3JhZ2VLZXldO1xuICByZXR1cm4ge2M6IFwibW9kYWwtcHJvbXB0IGxvYWQtcHJvbXB0XCIsIGNoaWxkcmVuOiBbXG4gICAge3Q6IFwiaGVhZGVyXCIsIGM6IFwiZmxleC1yb3dcIiwgY2hpbGRyZW46IFtcbiAgICAgIHt0OiBcImgyXCIsIHRleHQ6IFwiTG9hZCBEQlwifSxcbiAgICAgIHtjOiBcImZsZXgtZ3Jvd1wifSxcbiAgICAgIHtjOiBcImNvbnRyb2xzXCIsIGNoaWxkcmVuOiBbe2M6IFwiaW9uLWNsb3NlLXJvdW5kXCIsIGNsaWNrOiBjbG9zZVByb21wdH1dfVxuICAgIF19LFxuICAgIHt0OiBcInBcIiwgY2hpbGRyZW46IFtcbiAgICAgIHt0OiBcInNwYW5cIiwgdGV4dDogXCJXQVJOSU5HOiBUaGlzIHdpbGwgb3ZlcndyaXRlIHlvdXIgY3VycmVudCBkYXRhYmFzZS4gVGhpcyBpcyBpcnJldmVyc2libGUuIFlvdSBzaG91bGQgY29uc2lkZXIgXCJ9LFxuICAgICAge3Q6IFwiYVwiLCB0ZXh0OiBcInNhdmluZyB5b3VyIERCXCIsIHByb21wdDogc2F2ZVByb21wdCwgY2xpY2s6IG9wZW5Qcm9tcHR9LFxuICAgICAge3Q6IFwic3BhblwiLCB0ZXh0OiBcIiBmaXJzdC5cIn1cbiAgICBdfSxcbiAgICB7dDogXCJpbnB1dFwiLCB0eXBlOiBcImZpbGVcIiwgdGV4dDogXCJsb2FkIGZyb20gZmlsZVwiLCBjaGFuZ2U6IGxvYWRGcm9tRmlsZX1cbiAgXX07XG59XG5cbmZ1bmN0aW9uIGxvYWRlZFByb21wdCgpOkVsZW1lbnQge1xuICByZXR1cm4ge2M6IFwibW9kYWwtcHJvbXB0IGxvYWQtcHJvbXB0XCIsIGNoaWxkcmVuOiBbXG4gICAge3Q6IFwiaGVhZGVyXCIsIGM6IFwiZmxleC1yb3dcIiwgY2hpbGRyZW46IFtcbiAgICAgIHt0OiBcImgyXCIsIHRleHQ6IFwiTG9hZCBEQlwifSxcbiAgICAgIHtjOiBcImZsZXgtZ3Jvd1wifSxcbiAgICAgIHtjOiBcImNvbnRyb2xzXCIsIGNoaWxkcmVuOiBbe2M6IFwiaW9uLWNsb3NlLXJvdW5kXCIsIGNsaWNrOiBjbG9zZVByb21wdH1dfVxuICAgIF19LFxuICAgIHt0ZXh0OiBcIlN1Y2Nlc3NmdWxseSBsb2FkZWQgREIgZnJvbSBmaWxlXCJ9XG4gIF19O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFuZShwYW5lSWQ6c3RyaW5nKTpFbGVtZW50IHtcbiAgLy8gQEZJWE1FOiBBZGQga2luZCB0byB1aSBwYW5lc1xuICBsZXQge2NvbnRhaW5zID0gdW5kZWZpbmVkLCBraW5kID0gUEFORS5GVUxMfSA9IGV2ZS5maW5kT25lKFwidWkgcGFuZVwiLCB7cGFuZTogcGFuZUlkfSkgfHwge307XG4gIGxldCBtYWtlQ2hyb21lID0gcGFuZUNocm9tZVtraW5kXTtcbiAgaWYoIW1ha2VDaHJvbWUpIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBwYW5lIGtpbmQ6ICcke2tpbmR9JyAoJHtQQU5FW2tpbmRdfSlgKTtcbiAgbGV0IHtjOmtsYXNzLCBoZWFkZXIsIGZvb3RlciwgY2FwdHVyZUNsaWNrc30gPSBtYWtlQ2hyb21lKHBhbmVJZCwgY29udGFpbnMpO1xuICBsZXQgY29udGVudDtcbiAgbGV0IGRpc3BsYXkgPSBldmUuZmluZE9uZShcImRpc3BsYXkgbmFtZVwiLCB7bmFtZTogY29udGFpbnN9KSB8fCBldmUuZmluZE9uZShcImRpc3BsYXkgbmFtZVwiLCB7aWQ6IGNvbnRhaW5zfSk7XG5cbiAgbGV0IGNvbnRlbnRUeXBlID0gXCJlbnRpdHlcIjtcbiAgaWYoY29udGFpbnMubGVuZ3RoID09PSAwKSB7XG4gICAgY29udGVudCA9IGVudGl0eShidWlsdGluSWQoXCJob21lXCIpLCBwYW5lSWQsIGtpbmQpO1xuXG4gIH0gZWxzZSBpZihjb250YWlucy5pbmRleE9mKFwic2VhcmNoOiBcIikgPT09IDApIHtcbiAgICBjb250ZW50VHlwZSA9IFwic2VhcmNoXCI7XG4gICAgY29udGVudCA9IHNlYXJjaChjb250YWlucy5zdWJzdHJpbmcoXCJzZWFyY2g6IFwiLmxlbmd0aCksIHBhbmVJZCk7XG4gIH0gZWxzZSBpZihkaXNwbGF5KSB7XG4gICAgbGV0IG9wdGlvbnM6YW55ID0ge307XG4gICAgY29udGVudCA9IGVudGl0eShkaXNwbGF5LmlkLCBwYW5lSWQsIGtpbmQsIG9wdGlvbnMpO1xuICB9IGVsc2UgaWYoZXZlLmZpbmRPbmUoXCJxdWVyeSB0byBpZFwiLCB7cXVlcnk6IGNvbnRhaW5zfSkpIHtcbiAgICBjb250ZW50VHlwZSA9IFwic2VhcmNoXCI7XG4gICAgY29udGVudCA9IHNlYXJjaChjb250YWlucywgcGFuZUlkKTtcbiAgfSBlbHNlIGlmKGNvbnRhaW5zICE9PSBcIlwiKSB7XG4gICAgY29udGVudCA9IHtjOiBcImZsZXgtcm93IHNwYWNlZC1yb3dcIiwgY2hpbGRyZW46IFtcbiAgICAgIHt0OiBcInNwYW5cIiwgdGV4dDogYFRoZSBwYWdlICR7Y29udGFpbnN9IGRvZXMgbm90IGV4aXN0LiBXb3VsZCB5b3UgbGlrZSB0b2B9LFxuICAgICAge3Q6IFwiYVwiLCBjOiBcImxpbmsgYnRuIGFkZC1idG5cIiwgdGV4dDogXCJjcmVhdGUgaXQ/XCIsIG5hbWU6IGNvbnRhaW5zLCBwYW5lSWQsIGNsaWNrOiBjcmVhdGVQYWdlIH1cbiAgICBdfTtcbiAgfVxuXG4gIGlmKGNvbnRlbnRUeXBlID09PSBcInNlYXJjaFwiKSB7XG4gICAgdmFyIGRpc2FtYmlndWF0aW9uID0ge2lkOiBcInNlYXJjaC1kaXNhbWJpZ3VhdGlvblwiLCBjOiBcImZsZXgtcm93IHNwYWNlZC1yb3cgZGlzYW1iaWd1YXRpb25cIiwgY2hpbGRyZW46IFtcbiAgICAgIHt0ZXh0OiBcIkRpZCB5b3UgbWVhbiB0b1wifSxcbiAgICAgIHt0OiBcImFcIiwgYzogXCJsaW5rIGJ0biBhZGQtYnRuXCIsIHRleHQ6IFwiY3JlYXRlIGEgbmV3IHBhZ2VcIiwgbmFtZTogY29udGFpbnMsIHBhbmVJZCwgY2xpY2s6IGNyZWF0ZVBhZ2V9LFxuICAgICAge3RleHQ6IFwid2l0aCB0aGlzIG5hbWU/XCJ9XG4gICAgXX07XG4gIH1cblxuICBsZXQgcGFuZTpFbGVtZW50ID0ge2M6IGB3aWtpLXBhbmUgJHtrbGFzcyB8fCBcIlwifWAsIHBhbmVJZCwgY2hpbGRyZW46IFtoZWFkZXIsIGRpc2FtYmlndWF0aW9uLCBjb250ZW50LCBmb290ZXJdfTtcbiAgbGV0IHBvcyA9IGV2ZS5maW5kT25lKFwidWkgcGFuZSBwb3NpdGlvblwiLCB7cGFuZTogcGFuZUlkfSk7XG4gIGlmKHBvcykge1xuICAgIHBhbmUuc3R5bGUgPSBgbGVmdDogJHtpc05hTihwb3MueCkgPyBwb3MueCA6IHBvcy54ICsgXCJweFwifTsgdG9wOiAke2lzTmFOKHBvcy55KSA/IHBvcy55IDogKHBvcy55ICsgMjApICsgXCJweFwifTtgO1xuICB9XG4gIGlmKGNhcHR1cmVDbGlja3MpIHtcbiAgICBwYW5lLmNsaWNrID0gcHJldmVudERlZmF1bHQ7XG4gIH1cblxuICBpZih1aVN0YXRlLnByb21wdC5vcGVuICYmIHVpU3RhdGUucHJvbXB0LnBhbmVJZCA9PT0gcGFuZUlkKSB7XG4gICAgcGFuZS5jaGlsZHJlbi5wdXNoKFxuICAgICAge3N0eWxlOiBcInBvc2l0aW9uOiBhYnNvbHV0ZTsgdG9wOiAwOyBsZWZ0OiAwOyBib3R0b206IDA7IHJpZ2h0OiAwOyB6LWluZGV4OiAxMDsgYmFja2dyb3VuZDogcmdiYSgwLCAwLCAwLCAwLjApO1wiLCBwYW5lSWQsIGNsaWNrOiBjbG9zZVByb21wdH0sXG4gICAgICB1aVN0YXRlLnByb21wdC5wcm9tcHQocGFuZUlkKVxuICAgICk7XG4gIH1cbiAgcmV0dXJuIHBhbmU7XG59XG5mdW5jdGlvbiBjcmVhdGVQYWdlKGV2dDpFdmVudCwgZWxlbTpFbGVtZW50KSB7XG4gIGxldCBuYW1lID0gZWxlbVtcIm5hbWVcIl07XG4gIGxldCBlbnRpdHkgPSB1dWlkKCk7XG4gIGxldCBwYWdlID0gdXVpZCgpO1xuICBkaXNwYXRjaChcImNyZWF0ZSBwYWdlXCIsIHtwYWdlLCBjb250ZW50OiBgIyAke25hbWV9XFxuYH0pXG4gICAgLmRpc3BhdGNoKFwiY3JlYXRlIGVudGl0eVwiLCB7ZW50aXR5LCBwYWdlLCBuYW1lfSkuY29tbWl0KCk7XG59XG5cbmZ1bmN0aW9uIGRlbGV0ZUVudGl0eShldmVudCwgZWxlbSkge1xuICBsZXQgbmFtZSA9IHVpdGsucmVzb2x2ZU5hbWUoZWxlbS5lbnRpdHkpO1xuICBkaXNwYXRjaChcInJlbW92ZSBlbnRpdHlcIiwge2VudGl0eTogZWxlbS5lbnRpdHl9KS5jb21taXQoKTtcbiAgZGlzcGF0Y2goXCJ1aSBzZXQgc2VhcmNoXCIsIHtwYW5lSWQ6IGVsZW0ucGFuZUlkLCB2YWx1ZTogbmFtZX0pLmNvbW1pdCgpO1xufVxuXG5mdW5jdGlvbiBwYW5lU2V0dGluZ3MocGFuZUlkOnN0cmluZykge1xuICBsZXQgcGFuZSA9IGV2ZS5maW5kT25lKFwidWkgcGFuZVwiLCB7cGFuZTogcGFuZUlkfSk7XG4gIGxldCB7ZW50aXR5ID0gdW5kZWZpbmVkfSA9IGV2ZS5maW5kT25lKFwiZW50aXR5XCIsIHtlbnRpdHk6IHVpdGsucmVzb2x2ZUlkKHBhbmUuY29udGFpbnMpfSkgfHwge307XG4gIGxldCBpc1N5c3RlbSA9ICEhKGVudGl0eSAmJiBldmUuZmluZE9uZShcImVudGl0eSBlYXZzXCIsIHtlbnRpdHksIGF0dHJpYnV0ZTogXCJpcyBhXCIsIHZhbHVlOiBidWlsdGluSWQoXCJzeXN0ZW1cIil9KSk7XG4gIHJldHVybiB7dDogXCJ1bFwiLCBjOiBcInNldHRpbmdzXCIsIGNoaWxkcmVuOiBbXG4gICAge3Q6IFwibGlcIiwgYzogXCJzYXZlLWJ0blwiLCB0ZXh0OiBcInNhdmVcIiwgcHJvbXB0OiBzYXZlUHJvbXB0LCBjbGljazogb3BlblByb21wdH0sXG4gICAge3Q6IFwibGlcIiwgYzogXCJsb2FkLWJ0blwiLCB0ZXh0OiBcImxvYWRcIiwgcHJvbXB0OiBsb2FkUHJvbXB0LCBjbGljazogb3BlblByb21wdH0sXG4gICAgZW50aXR5ICYmICFpc1N5c3RlbSA/IHt0OiBcImxpXCIsIGM6IFwiZGVsZXRlLWJ0blwiLCB0ZXh0OiBcImRlbGV0ZSBwYWdlXCIsIGVudGl0eSwgcGFuZUlkLCBjbGljazogZGVsZXRlRW50aXR5fSA6IHVuZGVmaW5lZCxcbiAgICB7dDogXCJsaVwiLCBjOiBcImRlbGV0ZS1idG5cIiwgdGV4dDogXCJERUxFVEUgREFUQUJBU0VcIiwgcHJvbXB0OiBkZWxldGVEYXRhYmFzZVByb21wdCwgY2xpY2s6IG9wZW5Qcm9tcHR9LFxuICBdfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNlYXJjaChzZWFyY2g6c3RyaW5nLCBwYW5lSWQ6c3RyaW5nKTpFbGVtZW50IHtcbiAgbGV0IFtyYXdDb250ZW50LCByYXdQYXJhbXNdID0gc2VhcmNoLnNwbGl0KFwifFwiKTtcbiAgbGV0IHBhcnNlZFBhcmFtcyA9IGdldENlbGxQYXJhbXMocmF3Q29udGVudCwgcmF3UGFyYW1zKTtcbiAgbGV0IHtyZXN1bHRzLCBwYXJhbXMsIGNvbnRlbnR9ID0gcXVlcnlVSUluZm8oc2VhcmNoKTtcbiAgbWVyZ2VPYmplY3QocGFyYW1zLCBwYXJzZWRQYXJhbXMpO1xuICBsZXQgcmVwID0gcmVwcmVzZW50KGNvbnRlbnQsIHBhcmFtc1tcInJlcFwiXSwgcmVzdWx0cywgcGFyYW1zKTtcbiAgcmV0dXJuIHt0OiBcImNvbnRlbnRcIiwgYzogXCJ3aWtpLXNlYXJjaFwiLCBjaGlsZHJlbjogW1xuICAgIHJlcFxuICBdfTtcbn1cbmZ1bmN0aW9uIHNpemVDb2x1bW5zKG5vZGU6SFRNTEVsZW1lbnQsIGVsZW06RWxlbWVudCkge1xuICAvLyBARklYTUU6IEhvcnJpYmxlIGhhY2sgdG8gZ2V0IGFyb3VuZCByYW5kb21seSBhZGRlZCBcInVuZGVmaW5lZFwiIHRleHQgbm9kZSB0aGF0J3MgY29taW5nIGZyb20gaW4gbWljcm9yZWFjdC5cbiAgbGV0IGN1ciA9IG5vZGU7XG4gIHdoaWxlKGN1ci5wYXJlbnRFbGVtZW50KSBjdXIgPSBjdXIucGFyZW50RWxlbWVudDtcbiAgaWYoY3VyLnRhZ05hbWUgIT09IFwiSFRNTFwiKSBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGN1cik7XG5cbiAgbGV0IGNoaWxkOk5vZGUsIGl4ID0gMDtcbiAgbGV0IHdpZHRocyA9IHt9O1xuICBsZXQgY29sdW1ucyA9IDxIVE1MRWxlbWVudFtdPjxhbnk+bm9kZS5xdWVyeVNlbGVjdG9yQWxsKFwiLmNvbHVtblwiKTtcbiAgZm9yKGxldCBjb2x1bW4gb2YgY29sdW1ucykge1xuICAgIGNvbHVtbi5zdHlsZS53aWR0aCA9IFwiYXV0b1wiO1xuICAgIHdpZHRoc1tjb2x1bW5bXCJ2YWx1ZVwiXV0gPSB3aWR0aHNbY29sdW1uW1widmFsdWVcIl1dIHx8IDA7XG4gICAgaWYoY29sdW1uLm9mZnNldFdpZHRoID4gd2lkdGhzW2NvbHVtbltcInZhbHVlXCJdXSkgd2lkdGhzW2NvbHVtbltcInZhbHVlXCJdXSA9IGNvbHVtbi5vZmZzZXRXaWR0aDtcbiAgfVxuICBmb3IobGV0IGNvbHVtbiBvZiBjb2x1bW5zKSBjb2x1bW4uc3R5bGUud2lkdGggPSB3aWR0aHNbY29sdW1uW1widmFsdWVcIl1dICsgMTtcblxuICBpZihjdXIudGFnTmFtZSAhPT0gXCJIVE1MXCIpIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoY3VyKTtcbn1cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIFdpa2kgZWRpdG9yIGZ1bmN0aW9uc1xuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmZ1bmN0aW9uIHBhcnNlUGFyYW1zKHJhd1BhcmFtczpzdHJpbmcpIHtcbiAgbGV0IHBhcmFtcyA9IHt9O1xuICBpZighcmF3UGFyYW1zKSByZXR1cm4gcGFyYW1zO1xuICBmb3IobGV0IGt2IG9mIHJhd1BhcmFtcy5zcGxpdChcIjtcIikpIHtcbiAgICBsZXQgW2tleSwgdmFsdWVdID0ga3Yuc3BsaXQoXCI9XCIpO1xuICAgIGlmKCFrZXkgfHwgIWtleS50cmltKCkpIGNvbnRpbnVlO1xuICAgIGlmKCF2YWx1ZSB8fCAhdmFsdWUudHJpbSgpKSB0aHJvdyBuZXcgRXJyb3IoXCJNdXN0IHNwZWNpZnkgdmFsdWUgZm9yIGtleSAnXCIgKyBrZXkgKyBcIidcIik7XG4gICAgcGFyYW1zW2tleS50cmltKCldID0gY29lcmNlSW5wdXQodmFsdWUudHJpbSgpKTtcbiAgfVxuICByZXR1cm4gcGFyYW1zO1xufVxuZnVuY3Rpb24gc3RyaW5naWZ5UGFyYW1zKHBhcmFtczp7fSk6c3RyaW5nIHtcbiAgbGV0IHJhd1BhcmFtcyA9IFwiXCI7XG4gIGlmKCFwYXJhbXMpIHJldHVybiByYXdQYXJhbXM7XG4gIGZvcihsZXQga2V5IGluIHBhcmFtcykgcmF3UGFyYW1zICs9IGAke3Jhd1BhcmFtcy5sZW5ndGggPyBcIjsgXCIgOiBcIlwifSR7a2V5fSA9ICR7cGFyYW1zW2tleV19YDtcbiAgcmV0dXJuIHJhd1BhcmFtcztcbn1cblxuZnVuY3Rpb24gY2VsbFVJKHBhbmVJZCwgcXVlcnksIGNlbGwpOkVsZW1lbnQge1xuICBsZXQge3BhcmFtcywgcmVzdWx0cywgY29udGVudH0gPSBxdWVyeVVJSW5mbyhxdWVyeSk7XG4gIHBhcmFtc1tcInBhbmVJZFwiXSA9IHBhcmFtc1tcInBhbmVJZFwiXSB8fCBwYW5lSWQ7XG4gIHBhcmFtc1tcImNlbGxcIl0gPSBjZWxsO1xuICBwYXJhbXNbXCJjaGlsZFJlcFwiXSA9IHBhcmFtc1tcInJlcFwiXTtcbiAgcGFyYW1zW1wicmVwXCJdID0gXCJlbWJlZGRlZENlbGxcIjtcbiAgcmV0dXJuIHtjOiBgY2VsbGAsIGNoaWxkcmVuOiBbcmVwcmVzZW50KGNvbnRlbnQsIHBhcmFtc1tcInJlcFwiXSwgcmVzdWx0cywgcGFyYW1zKV19O1xufVxuXG4vLyBDcmVkaXQgdG8gaHR0cHM6Ly9tYXRoaWFzYnluZW5zLmJlL2RlbW8vdXJsLXJlZ2V4IGFuZCBAZ3J1YmVyXG5sZXQgdXJsUmVnZXggPSAvXFxiKChbXFx3LV0rOlxcL1xcLz98d3d3Wy5dKVteXFxzKCk8Pl0rKD86XFwoW1xcd1xcZF0rXFwpfChbXltcXC4sXFwtXFwvIyEkJScgXCJeKjs6e19gfigpXFwtXFxzXXxcXC8pKSkvaTtcblxuZnVuY3Rpb24gcXVlcnlVSUluZm8ocXVlcnkpIHtcbiAgbGV0IFtjb250ZW50LCByYXdQYXJhbXNdID0gcXVlcnkuc3BsaXQoXCJ8XCIpO1xuICBsZXQgZW1iZWRUeXBlO1xuICAvLyBsZXQgcGFyYW1zID0gZ2V0Q2VsbFBhcmFtcyhjb250ZW50LCByYXdQYXJhbXMpO1xuICBsZXQgcGFyYW1zID0gcGFyc2VQYXJhbXMocmF3UGFyYW1zKTtcbiAgbGV0IHJlc3VsdHM7XG4gIGlmKGV2ZS5maW5kT25lKFwiZGlzcGxheSBuYW1lXCIsIHtpZDogY29udGVudH0pIHx8IGV2ZS5maW5kT25lKFwiZGlzcGxheSBuYW1lXCIsIHtuYW1lOiBjb250ZW50fSkpIHtcbiAgICBsZXQgaWQgPSBjb250ZW50O1xuICAgIGxldCBkaXNwbGF5ID0gZXZlLmZpbmRPbmUoXCJkaXNwbGF5IG5hbWVcIiwge25hbWU6IGNvbnRlbnR9KTtcbiAgICBpZihkaXNwbGF5KSB7XG4gICAgICBpZCA9IGRpc3BsYXlbXCJpZFwiXTtcbiAgICB9XG4gICAgcmVzdWx0cyA9IHt1bnByb2plY3RlZDogW3tlbnRpdHk6IGlkfV0sIHJlc3VsdHM6IFt7ZW50aXR5OiBpZH1dfTtcbiAgfSBlbHNlIGlmKHVybFJlZ2V4LmV4ZWMoY29udGVudCkpIHtcbiAgICByZXN1bHRzID0ge3VucHJvamVjdGVkOiBbe3VybDogY29udGVudH1dLCByZXN1bHRzOiBbe3VybDogY29udGVudH1dfTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgcXVlcnlJZCA9IGV2ZS5maW5kT25lKFwicXVlcnkgdG8gaWRcIiwge3F1ZXJ5OiBjb250ZW50fSk7XG4gICAgaWYocXVlcnlJZCkge1xuICAgICAgbGV0IHF1ZXJ5UmVzdWx0cyA9IGV2ZS5maW5kKHF1ZXJ5SWQuaWQpO1xuICAgICAgbGV0IHF1ZXJ5VW5wcm9qZWN0ZWQgPSBldmUudGFibGUocXVlcnlJZC5pZCkudW5wcm9qZWN0ZWQ7XG4gICAgICBpZighcXVlcnlSZXN1bHRzLmxlbmd0aCkge1xuICAgICAgICBwYXJhbXNbXCJyZXBcIl0gPSBcImVycm9yXCI7XG4gICAgICAgIHBhcmFtc1tcIm1lc3NhZ2VcIl0gPSBcIk5vIHJlc3VsdHNcIjtcbiAgICAgICAgcmVzdWx0cyA9IHt9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0cyA9IHt1bnByb2plY3RlZDogcXVlcnlVbnByb2plY3RlZCwgcmVzdWx0czogcXVlcnlSZXN1bHRzfTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcGFyYW1zW1wicmVwXCJdID0gXCJlcnJvclwiO1xuICAgICAgcGFyYW1zW1wibWVzc2FnZVwiXSA9IFwiaW52YWxpZCBzZWFyY2hcIjtcbiAgICAgIHJlc3VsdHMgPSB7fTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHtyZXN1bHRzLCBwYXJhbXMsIGNvbnRlbnR9O1xufVxuXG5mdW5jdGlvbiBnZXRDZWxsUGFyYW1zKGNvbnRlbnQsIHJhd1BhcmFtcykge1xuICBjb250ZW50ID0gY29udGVudC50cmltKCk7XG4gIGxldCBkaXNwbGF5ID0gZXZlLmZpbmRPbmUoXCJkaXNwbGF5IG5hbWVcIiwge25hbWU6IGNvbnRlbnR9KTtcbiAgbGV0IHBhcmFtcyA9IHBhcnNlUGFyYW1zKHJhd1BhcmFtcyk7XG4gIGxldCBjb250ZW50RGlzcGxheSA9IGV2ZS5maW5kT25lKFwiZGlzcGxheSBuYW1lXCIsIHtpZDogY29udGVudH0pIHx8IGV2ZS5maW5kT25lKFwiZGlzcGxheSBuYW1lXCIsIHtuYW1lOiBjb250ZW50fSk7XG4gIGlmKGNvbnRlbnREaXNwbGF5KSB7XG4gICAgcGFyYW1zW1wicmVwXCJdID0gcGFyYW1zW1wicmVwXCJdIHx8IFwibGlua1wiO1xuICB9IGVsc2UgaWYodXJsUmVnZXguZXhlYyhjb250ZW50KSkge1xuICAgIHBhcmFtc1tcInJlcFwiXSA9IHBhcmFtc1tcInJlcFwiXSB8fCBcImV4dGVybmFsTGlua1wiO1xuICB9IGVsc2Uge1xuICAgIGlmKHBhcmFtc1tcInJlcFwiXSkgcmV0dXJuIHBhcmFtcztcblxuICAgIGxldCBwYXJzZWQgPSBubHBhcnNlKGNvbnRlbnQpO1xuICAgIGxldCBjdXJyZW50UGFyc2UgPSBwYXJzZWRbMF07XG4gICAgbGV0IGNvbnRleHQgPSBjdXJyZW50UGFyc2UuY29udGV4dDtcbiAgICBsZXQgaGFzQ29sbGVjdGlvbnMgPSBjb250ZXh0LmNvbGxlY3Rpb25zLmxlbmd0aDtcbiAgICBsZXQgZmllbGQ7XG4gICAgbGV0IHJlcDtcbiAgICBsZXQgYWdncmVnYXRlcyA9IFtdO1xuICAgIGZvcihsZXQgZnhuIG9mIGNvbnRleHQuZnhucykge1xuICAgICAgaWYoZnhuLnR5cGUgPT09IEZ1bmN0aW9uVHlwZXMuQUdHUkVHQVRFKSB7XG4gICAgICAgIGFnZ3JlZ2F0ZXMucHVzaChmeG4pO1xuICAgICAgfVxuICAgIH1cbiAgICBpZihhZ2dyZWdhdGVzLmxlbmd0aCA9PT0gMSAmJiBjb250ZXh0W1wiZ3JvdXBpbmdzXCJdLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmVwID0gXCJDU1ZcIjtcbiAgICAgIGZpZWxkID0gYWdncmVnYXRlc1swXS5uYW1lO1xuICAgIH0gZWxzZSBpZighaGFzQ29sbGVjdGlvbnMgJiYgY29udGV4dC5meG5zLmxlbmd0aCA9PT0gMSkge1xuICAgICAgcmVwID0gXCJDU1ZcIjtcbiAgICAgIGZpZWxkID0gY29udGV4dC5meG5zWzBdLm5hbWU7XG4gICAgfSBlbHNlIGlmKCFoYXNDb2xsZWN0aW9ucyAmJiBjb250ZXh0LmF0dHJpYnV0ZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICByZXAgPSBcIkNTVlwiO1xuICAgICAgZmllbGQgPSBjb250ZXh0LmF0dHJpYnV0ZXNbMF0uZGlzcGxheU5hbWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHBhcmFtc1tcInJlcFwiXSA9IFwidGFibGVcIjtcbiAgICB9XG4gICAgaWYocmVwKSB7XG4gICAgICBwYXJhbXNbXCJyZXBcIl0gPSByZXA7XG4gICAgICBwYXJhbXNbXCJmaWVsZFwiXSA9IGZpZWxkO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcGFyYW1zO1xufVxuXG52YXIgcGFuZUVkaXRvcnMgPSB7fTtcbmZ1bmN0aW9uIHdpa2lFZGl0b3Iobm9kZSwgZWxlbSkge1xuICBjcmVhdGVFZGl0b3Iobm9kZSwgZWxlbSk7XG4gIHBhbmVFZGl0b3JzW2VsZW0ubWV0YS5wYW5lSWRdID0gbm9kZS5lZGl0b3I7XG59XG5cbmZ1bmN0aW9uIHJlcGFyZW50Q2VsbChub2RlLCBlbGVtKSB7XG4gIGlmKG5vZGUucGFyZW50Tm9kZS5pZCAhPT0gZWxlbS5jb250YWluZXJJZCkge1xuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW0uY29udGFpbmVySWQpLmFwcGVuZENoaWxkKG5vZGUpO1xuICB9XG4gIG5vZGUucGFyZW50Tm9kZVtcIm1hcmtcIl0uY2hhbmdlZCgpO1xufVxuXG5mdW5jdGlvbiBmb2N1c0NlbGxFZGl0b3Iobm9kZSwgZWxlbSkge1xuICBhdXRvRm9jdXMobm9kZSwgZWxlbSk7XG4gIGlmKCFub2RlLmRpZEZvY3VzKSB7XG4gICAgbm9kZS5kaWRGb2N1cyA9IHRydWU7XG4gICAgc2V0RW5kT2ZDb250ZW50RWRpdGFibGUobm9kZSk7XG4gIH1cbn1cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZnVuY3Rpb24gY2VsbEVkaXRvcihlbnRpdHlJZCwgcGFuZUlkLCBjZWxsKTpFbGVtZW50IHtcbiAgbGV0IHRleHQgPSBhY3RpdmVDZWxsc1tjZWxsLmlkXS5xdWVyeTtcbiAgbGV0IHtvcHRpb25zLCBzZWxlY3RlZH0gPSBhdXRvY29tcGxldGVyT3B0aW9ucyhlbnRpdHlJZCwgcGFuZUlkLCBjZWxsKTtcbiAgbGV0IGF1dG9Gb2N1cyA9IHRydWU7XG4gIGlmKHRleHQubWF0Y2goL1xcJFxcJC4qXFwkXFwkLykpIHtcbiAgICB0ZXh0ID0gXCJcIjtcbiAgfVxuICBsZXQgZGlzcGxheSA9IGV2ZS5maW5kT25lKFwiZGlzcGxheSBuYW1lXCIsIHtpZDogdGV4dH0pO1xuICBpZihkaXNwbGF5KSB7XG4gICAgdGV4dCA9IGRpc3BsYXlbXCJuYW1lXCJdO1xuICB9XG4gIHJldHVybiB7Y2hpbGRyZW46IFtcbiAgICB7YzogXCJlbWJlZGRlZC1jZWxsXCIsIGNoaWxkcmVuOiBbXG4gICAgICB7YzogXCJhZG9ybm1lbnRcIiwgdGV4dDogXCI9XCJ9LFxuICAgICAge3Q6IFwic3BhblwiLCBjOlwiXCIsIGNvbnRlbnRFZGl0YWJsZTogdHJ1ZSwgdGV4dCwgY2xpY2s6IHByZXZlbnREZWZhdWx0LCBpbnB1dDogdXBkYXRlQWN0aXZlQ2VsbCwga2V5ZG93bjogZW1iZWRkZWRDZWxsS2V5cywgY2VsbCwgc2VsZWN0ZWQsIHBhbmVJZCwgcG9zdFJlbmRlcjogYXV0b0ZvY3VzID8gZm9jdXNDZWxsRWRpdG9yIDogdW5kZWZpbmVkfSxcbiAgICBdfSxcbiAgICBhdXRvY29tcGxldGVyKG9wdGlvbnMsIHBhbmVJZCwgY2VsbClcbiAgXX07XG59XG5cbmZ1bmN0aW9uIGF1dG9jb21wbGV0ZXIob3B0aW9ucywgcGFuZUlkLCBjZWxsKTogRWxlbWVudCB7XG4gIGxldCBjaGlsZHJlbiA9IFtdO1xuICBmb3IobGV0IG9wdGlvbiBvZiBvcHRpb25zKSB7XG4gICAgbGV0IGl0ZW0gPSB7YzogXCJvcHRpb25cIiwgY2hpbGRyZW46IG9wdGlvbi5jaGlsZHJlbiwgdGV4dDogb3B0aW9uLnRleHQsIHNlbGVjdGVkOiBvcHRpb24sIGNlbGwsIHBhbmVJZCwgY2xpY2s6IGV4ZWN1dGVBdXRvY29tcGxldGVyT3B0aW9uLCBrZXlkb3duOiBvcHRpb25LZXlzfTtcbiAgICBpZihvcHRpb24uc2VsZWN0ZWQpIHtcbiAgICAgIGl0ZW0uYyArPSBcIiBzZWxlY3RlZFwiO1xuICAgIH1cbiAgICBjaGlsZHJlbi5wdXNoKGl0ZW0pO1xuICB9XG4gIHJldHVybiB7YzogXCJhdXRvY29tcGxldGVyXCIsIGtleTogcGVyZm9ybWFuY2Uubm93KCkudG9TdHJpbmcoKSwgY2VsbCwgY29udGFpbmVySWQ6IGAke3BhbmVJZH18JHtjZWxsLmlkfXxjb250YWluZXJgLCBjaGlsZHJlbiwgcG9zdFJlbmRlcjogcG9zaXRpb25BdXRvY29tcGxldGVyfTtcbn1cblxuZnVuY3Rpb24gb3B0aW9uS2V5cyhldmVudCwgZWxlbSkge1xuICBpZihldmVudC5rZXlDb2RlID09PSBLRVlTLkVOVEVSKSB7XG4gICAgZXhlY3V0ZUF1dG9jb21wbGV0ZXJPcHRpb24oZXZlbnQuY3VycmVudFRhcmdldCwgZWxlbSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZXhlY3V0ZUF1dG9jb21wbGV0ZXJPcHRpb24oZXZlbnQsIGVsZW0pIHtcbiAgaWYoZXZlbnQuZGVmYXVsdFByZXZlbnRlZCkgcmV0dXJuO1xuICBsZXQge3BhbmVJZCwgY2VsbH0gPSBlbGVtO1xuICBsZXQgZWRpdG9yID0gcGFuZUVkaXRvcnNbcGFuZUlkXTtcbiAgbGV0IGNtID0gZWRpdG9yLmNtSW5zdGFuY2U7XG4gIGxldCBtYXJrID0gZWRpdG9yLm1hcmtzW2NlbGwuaWRdO1xuICBsZXQgZG9FbWJlZCA9IG1ha2VEb0VtYmVkRnVuY3Rpb24oY20sIG1hcmssIGNlbGwsIHBhbmVJZCk7XG4gIGlmKGVsZW0uc2VsZWN0ZWQgJiYgZWxlbS5zZWxlY3RlZC5hY3Rpb24pIHtcbiAgICBpZih0eXBlb2YgZWxlbS5zZWxlY3RlZC5hY3Rpb24gPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgZWxlbS5zZWxlY3RlZC5hY3Rpb24oZWxlbSwgY2VsbC5xdWVyeSwgZG9FbWJlZCk7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGF1dG9jb21wbGV0ZXJPcHRpb25zKGVudGl0eUlkLCBwYW5lSWQsIGNlbGwpIHtcbiAgbGV0IFt0ZXh0LCByYXdQYXJhbXNdID0gY2VsbC5xdWVyeS50cmltKCkuc3BsaXQoXCJ8XCIpO1xuICBpZih0ZXh0Lm1hdGNoKC9cXCRcXCQuKlxcJFxcJC8pKSB7XG4gICAgcmV0dXJuIHtvcHRpb25zOiBbXSwgc2VsZWN0ZWQ6IHt9fTtcbiAgfVxuICBsZXQgcGFyYW1zID0ge307XG4gIHRyeSB7XG4gICAgcGFyYW1zID0gZ2V0Q2VsbFBhcmFtcyh0ZXh0LCByYXdQYXJhbXMpO1xuICB9IGNhdGNoKGUpIHtcbiAgICAvLyBAVE9ETzogZXZlbnR1YWxseSBwZW9wbGUgc2hvdWxkbid0IGJlIHR5cGluZyBwYXJhbXMgaW4gaGVyZSBzbyB3ZSBzaG91bGQgcHJvYmFibHkgYmUgZG9pbmdcbiAgICAvLyBzb21ldGhpbmcgZWxzZS4gQnV0IGZvciBub3csIGlmIHlvdSdyZSBkb2luZyB0aGlzLCB5b3UncmUgc3BlY2lhbC5cbiAgfVxuICBsZXQgZGlzcGxheSA9IGV2ZS5maW5kT25lKFwiZGlzcGxheSBuYW1lXCIsIHtpZDogdGV4dH0pO1xuICBpZihkaXNwbGF5KSB7XG4gICAgdGV4dCA9IGRpc3BsYXlbXCJuYW1lXCJdO1xuICB9XG4gIGxldCBpc0VudGl0eSA9IGV2ZS5maW5kT25lKFwiZGlzcGxheSBuYW1lXCIsIHtuYW1lOiB0ZXh0fSk7XG4gIGxldCBwYXJzZWQgPSBbXTtcbiAgaWYodGV4dCAhPT0gXCJcIikge1xuICAgIHRyeSB7XG4gICAgICBwYXJzZWQgPSBubHBhcnNlKHRleHQpOyAvLyBAVE9ETzogdGhpcyBzaG91bGQgY29tZSBmcm9tIHRoZSBOTFAgcGFyc2VyIG9uY2UgaXQncyBob29rZWQgdXAuXG4gICAgfSBjYXRjaChlKSB7XG5cbiAgICB9XG4gIH1cbiAgLy8gdGhlIGF1dG9jb21wbGV0ZSBjYW4gaGF2ZSBtdWx0aXBsZSBzdGF0ZXNcbiAgbGV0IHN0YXRlID0gY2VsbC5zdGF0ZSB8fCBcInF1ZXJ5XCI7XG4gIC8vIGV2ZXJ5IG9wdGlvbiBoYXMgYSBzY29yZSBmb3IgaG93IHBlcnRpbmVudCBpdCBpc1xuICAvLyB0aGluZ3Mgd2l0aCBhIHNjb3JlIG9mIDAgd2lsbCBiZSBmaWx0ZXJlZCwgZXZlcnl0aGluZyBlbHNlXG4gIC8vIHdpbGwgYmUgc29ydGVkIGRlc2NlbmRpbmcuXG4gIGxldCBvcHRpb25zOntzY29yZTogbnVtYmVyLCBhY3Rpb246IGFueSwgdGV4dD86IHN0cmluZywgY2hpbGRyZW4/OiBFbGVtZW50W119W107XG4gIGlmKHN0YXRlID09PSBcInF1ZXJ5XCIpIHtcbiAgICBvcHRpb25zID0gcXVlcnlBdXRvY29tcGxldGVPcHRpb25zKGlzRW50aXR5LCBwYXJzZWQsIHRleHQsIHBhcmFtcywgZW50aXR5SWQpO1xuICB9IGVsc2UgaWYoc3RhdGUgPT09IFwicmVwcmVzZW50XCIpIHtcbiAgICBvcHRpb25zID0gcmVwcmVzZW50QXV0b2NvbXBsZXRlT3B0aW9ucyhpc0VudGl0eSwgcGFyc2VkLCB0ZXh0LCBwYXJhbXMsIGVudGl0eUlkKTtcbiAgfSBlbHNlIGlmKHN0YXRlID09PSBcImNyZWF0ZVwiKSB7XG4gICAgb3B0aW9ucyA9IGNyZWF0ZUF1dG9jb21wbGV0ZU9wdGlvbnMoaXNFbnRpdHksIHBhcnNlZCwgdGV4dCwgcGFyYW1zLCBlbnRpdHlJZCk7XG4gIH0gZWxzZSBpZihzdGF0ZSA9PT0gXCJkZWZpbmVcIikge1xuICAgIG9wdGlvbnMgPSBkZWZpbmVBdXRvY29tcGxldGVPcHRpb25zKGlzRW50aXR5LCBwYXJzZWQsIHRleHQsIHBhcmFtcywgZW50aXR5SWQpO1xuICB9IGVsc2UgaWYoc3RhdGUgPT09IFwibW9kaWZ5XCIpIHtcbiAgICBvcHRpb25zID0gbW9kaWZ5QXV0b2NvbXBsZXRlT3B0aW9ucyhpc0VudGl0eSwgcGFyc2VkLCB0ZXh0LCBwYXJhbXMsIGVudGl0eUlkKTtcbiAgfSBlbHNlIGlmKHN0YXRlID09PSBcInByb3BlcnR5XCIpIHtcbiAgICBvcHRpb25zID0gcHJvcGVydHlBdXRvY29tcGxldGVPcHRpb25zKGlzRW50aXR5LCBwYXJzZWQsIHRleHQsIHBhcmFtcywgZW50aXR5SWQpO1xuICB9IGVsc2UgaWYoc3RhdGUgPT09IFwiYXR0cmlidXRlcyB1aVwiKSB7XG4gICAgb3B0aW9ucyA9IGF0dHJpYnV0ZXNVSUF1dG9jb21wbGV0ZU9wdGlvbnMoaXNFbnRpdHksIHBhcnNlZCwgdGV4dCwgcGFyYW1zLCBlbnRpdHlJZCk7XG4gIH0gZWxzZSBpZihzdGF0ZSA9PT0gXCJ1cmxcIikge1xuICAgIG9wdGlvbnMgPSB1cmxBdXRvY29tcGxldGVPcHRpb25zKGlzRW50aXR5LCBwYXJzZWQsIHRleHQsIHBhcmFtcywgZW50aXR5SWQpO1xuICB9XG4gIG9wdGlvbnMgPSBvcHRpb25zLnNvcnQoKGEsIGIpID0+IGIuc2NvcmUgLSBhLnNjb3JlKTtcbiAgbGV0IHNlbGVjdGVkO1xuICBpZihvcHRpb25zLmxlbmd0aCkge1xuICAgIGxldCBzZWxlY3RlZEl4ID0gY2VsbC5zZWxlY3RlZCAlIG9wdGlvbnMubGVuZ3RoO1xuICAgIGlmKHNlbGVjdGVkSXggPCAwKSBzZWxlY3RlZEl4ID0gb3B0aW9ucy5sZW5ndGggKyBzZWxlY3RlZEl4O1xuICAgIHNlbGVjdGVkID0gb3B0aW9uc1tzZWxlY3RlZEl4XTtcbiAgICBzZWxlY3RlZC5zZWxlY3RlZCA9IHRydWU7XG4gIH1cbiAgZm9yKGxldCBvcHRpb24gb2Ygb3B0aW9ucykge1xuICAgIG9wdGlvbltcImNlbGxcIl0gPSBjZWxsO1xuICAgIG9wdGlvbltcInBhbmVJZFwiXSA9IHBhbmVJZDtcbiAgfVxuICByZXR1cm4ge29wdGlvbnMsIHNlbGVjdGVkfTtcbn1cblxuZnVuY3Rpb24gcG9zaXRpb25BdXRvY29tcGxldGVyKG5vZGUsIGVsZW0pIHtcbiAgbGV0IGNvbnRhaW5lcklkID0gZWxlbS5jb250YWluZXJJZDtcbiAgbGV0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbnRhaW5lcklkKTtcbiAgbGV0IHtib3R0b20sIGxlZnR9ID0gY29udGFpbmVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG5vZGUpO1xuICBub2RlLnN0eWxlLnRvcCA9IGJvdHRvbTtcbiAgbm9kZS5zdHlsZS5sZWZ0ID0gbGVmdDtcbn1cblxuZnVuY3Rpb24gcXVlcnlBdXRvY29tcGxldGVPcHRpb25zKGlzRW50aXR5LCBwYXJzZWQsIHRleHQsIHBhcmFtcywgZW50aXR5SWQpIHtcbiAgbGV0IHBhZ2VOYW1lID0gZXZlLmZpbmRPbmUoXCJkaXNwbGF5IG5hbWVcIiwge2lkOiBlbnRpdHlJZH0pW1wibmFtZVwiXTtcbiAgbGV0IG9wdGlvbnM6e3Njb3JlOiBudW1iZXIsIGFjdGlvbjogYW55LCB0ZXh0OiBzdHJpbmcsIFthdHRyOnN0cmluZ106IGFueX1bXSA9IFtdO1xuICBsZXQgaGFzVmFsaWRQYXJzZSA9IHBhcnNlZC5zb21lKChwYXJzZSkgPT4gcGFyc2Uuc3RhdGUgPT09IFN0YXRlRmxhZ3MuQ09NUExFVEUpO1xuICBwYXJzZWQuc29ydCgoYSwgYikgPT4gYi5zY29yZSAtIGEuc2NvcmUpO1xuICBsZXQgdG9wT3B0aW9uID0gcGFyc2VkWzBdO1xuICBsZXQgam9pbmVyID0gXCJhXCI7XG4gIGlmKHRleHQgJiYgdGV4dFswXS5tYXRjaCgvW2FlaW91XS9pKSkge1xuICAgIGpvaW5lciA9IFwiYW5cIjtcbiAgfVxuXG4gIGxldCBpc0F0dHJpYnV0ZSA9IGZhbHNlO1xuICBpZih0b3BPcHRpb24pIHtcbiAgICBsZXQgdG90YWxGb3VuZCA9IDA7XG4gICAgbGV0IHtjb250ZXh0fSA9IHRvcE9wdGlvbjtcbiAgICBmb3IobGV0IGl0ZW0gaW4gY29udGV4dCkge1xuICAgICAgdG90YWxGb3VuZCArPSBjb250ZXh0W2l0ZW1dLmxlbmd0aDtcbiAgICB9XG4gICAgbGV0IGlzRW50QXR0ciA9IHRvdGFsRm91bmQgPT09IDIgJiYgKGNvbnRleHQuZW50aXRpZXMubGVuZ3RoID09PSAxIHx8IGNvbnRleHQuY29sbGVjdGlvbnMubGVuZ3RoID09PSAxKTtcbiAgICBpZihpc0VudEF0dHIgJiYgY29udGV4dC5tYXliZUF0dHJpYnV0ZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICBvcHRpb25zLnB1c2goe3Njb3JlOiA0LCAgYWN0aW9uOiBzZXRDZWxsU3RhdGUsIHN0YXRlOiBcImRlZmluZVwiLCB0ZXh0OiBgYWRkICR7dGV4dH1gfSk7XG4gICAgICBpc0F0dHJpYnV0ZSA9IHRydWU7XG4gICAgfSBlbHNlIGlmKGlzRW50QXR0ciAmJiBjb250ZXh0LmF0dHJpYnV0ZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICBvcHRpb25zLnB1c2goe3Njb3JlOiAyLjUsICBhY3Rpb246IHNldENlbGxTdGF0ZSwgc3RhdGU6IFwibW9kaWZ5XCIsIHRleHQ6IGBtb2RpZnkgJHt0ZXh0fWB9KTtcbiAgICB9XG4gIH1cbiAgLy8gY3JlYXRlXG4gIGlmKCFpc0VudGl0eSAmJiB0ZXh0ICE9PSBcIlwiICYmIHRleHQgIT0gXCI9XCIpIHtcbiAgICBvcHRpb25zLnB1c2goe3Njb3JlOiAxLCAgYWN0aW9uOiBzZXRDZWxsU3RhdGUsIHN0YXRlOiBcImNyZWF0ZVwiLCB0ZXh0OiBgQ3JlYXRlICR7am9pbmVyfSBcIiR7dGV4dH1cIiBwYWdlYH0pO1xuICB9XG4gIC8vIGRpc2FtYmlndWF0aW9uc1xuICBpZihwYXJzZWQubGVuZ3RoID4gMSkge1xuICAgIG9wdGlvbnMucHVzaCh7c2NvcmU6IDMsIGFjdGlvbjogXCJkaXNhbWJpZ3VhdGUgc3R1ZmZcIiwgdGV4dDogXCJESVNBTUJJR1VBVEUhXCJ9KTtcbiAgfVxuICBpZighaXNFbnRpdHkgJiYgaGFzVmFsaWRQYXJzZSAmJiBwYXJhbXNbXCJyZXBcIl0pIHtcbiAgICBvcHRpb25zLnB1c2goe3Njb3JlOiA0LCBhY3Rpb246IGVtYmVkQXMsIHJlcDogcGFyYW1zW1wicmVwXCJdLCBwYXJhbXMsIHRleHQ6IGBlbWJlZCBhcyBhICR7cGFyYW1zW1wicmVwXCJdfWB9KTtcbiAgfVxuICAvLyByZXBlc2VudGF0aW9uXG4gIC8vIHdlIGNhbiBvbmx5IHJlcGVzZW50IHRoaW5ncyBpZiB3ZSd2ZSBmb3VuZCB0aGVtXG4gIGlmKGlzRW50aXR5IHx8IGhhc1ZhbGlkUGFyc2UpIHtcbiAgICAvLyBAVE9ETzogaG93IGRvIHdlIGZpZ3VyZSBvdXQgd2hhdCByZXByZXNlbnRhdGlvbnMgYWN0dWFsbHkgbWFrZSBzZW5zZSB0byBzaG93P1xuICAgIG9wdGlvbnMucHVzaCh7c2NvcmU6IDIsIGFjdGlvbjogc2V0Q2VsbFN0YXRlLCBzdGF0ZTogXCJyZXByZXNlbnRcIiwgdGV4dDogYGVtYmVkIGFzIC4uLmB9KTtcbiAgfVxuICAvLyBzZXQgYXR0cmlidXRlXG4gIGlmKHRleHQgJiYgZXZlLmZpbmRPbmUoXCJkaXNwbGF5IG5hbWVcIiwge2lkOiBlbnRpdHlJZH0pLm5hbWUgIT09IHRleHQpIHtcbiAgICBpZighaXNBdHRyaWJ1dGUpIHtcbiAgICAgIG9wdGlvbnMucHVzaCh7c2NvcmU6IDIuNSwgYWN0aW9uOiBzZXRDZWxsU3RhdGUsIHN0YXRlOiBcInByb3BlcnR5XCIsIHRleHQ6IGBhZGQgYXMgYSBwcm9wZXJ0eSBvZiAke3BhZ2VOYW1lfWB9KVxuICAgIH1cbiAgICBpZihpc0VudGl0eSkgIHtcbiAgICAgIGxldCBpc0FTY29yZSA9IDIuNTtcbiAgICAgIGlmKGV2ZS5maW5kT25lKFwiY29sbGVjdGlvblwiLCB7Y29sbGVjdGlvbjogaXNFbnRpdHkuaWR9KSkge1xuICAgICAgICBpc0FTY29yZSA9IDM7XG4gICAgICB9XG4gICAgICBvcHRpb25zLnB1c2goe3Njb3JlOiAyLjUsIGFjdGlvbjogYWRkQXR0cmlidXRlQW5kRW1iZWQsIHJlcGxhY2U6IFwiaXMgYVwiLCBlbnRpdHlJZCwgdmFsdWU6IGlzRW50aXR5LmlkLCBhdHRyaWJ1dGU6IFwicmVsYXRlZCB0b1wiLCB0ZXh0OiBgJHtwYWdlTmFtZX0gaXMgcmVsYXRlZCB0byAke3RleHR9YH0pO1xuICAgICAgb3B0aW9ucy5wdXNoKHtzY29yZTogaXNBU2NvcmUsIGFjdGlvbjogYWRkQXR0cmlidXRlQW5kRW1iZWQsIHJlcGxhY2U6IFwicmVsYXRlZCB0b1wiLCBlbnRpdHlJZCwgdmFsdWU6IGlzRW50aXR5LmlkLCBhdHRyaWJ1dGU6IFwiaXMgYVwiLCB0ZXh0OiBgJHtwYWdlTmFtZX0gaXMgJHtqb2luZXJ9ICR7dGV4dH1gfSk7XG4gICAgfVxuICB9XG5cbiAgLy8gdXJsIGVtYmVkZGluZ1xuICBpZih1cmxSZWdleC5leGVjKHRleHQpKSB7XG4gICAgb3B0aW9ucy5wdXNoKHtzY29yZTogMywgYWN0aW9uOiAgc2V0Q2VsbFN0YXRlLCBzdGF0ZTogXCJ1cmxcIiwgdGV4dDogXCJlbWJlZCB1cmwgYXMuLi5cIn0pO1xuICB9XG4gIHJldHVybiBvcHRpb25zO1xufVxuXG5mdW5jdGlvbiBhZGRBdHRyaWJ1dGVBbmRFbWJlZChlbGVtLCBzdHJWYWx1ZSwgZG9FbWJlZCkge1xuICBsZXQge2VudGl0eUlkLCB2YWx1ZSwgYXR0cmlidXRlLCByZXBsYWNlfSA9IGVsZW0uc2VsZWN0ZWQ7XG4gIGxldCBjaGFpbiA9IGRpc3BhdGNoKFwiYWRkIHNvdXJjZWQgZWF2XCIsIHtlbnRpdHk6IGVudGl0eUlkLCBhdHRyaWJ1dGUsIHZhbHVlLCBzb3VyY2U6IHV1aWQoKX0pO1xuICBpZihyZXBsYWNlKSB7XG4gICAgY2hhaW4uZGlzcGF0Y2goXCJyZW1vdmUgZW50aXR5IGF0dHJpYnV0ZVwiLCB7ZW50aXR5OiBlbnRpdHlJZCwgYXR0cmlidXRlOiByZXBsYWNlLCB2YWx1ZX0pO1xuICB9XG4gIGNoYWluLmNvbW1pdCgpO1xuICBkb0VtYmVkKGAke3ZhbHVlfXxyZXA9bGluaztgKTtcbn1cblxuZnVuY3Rpb24gc2V0Q2VsbFN0YXRlKGVsZW0sIHZhbHVlLCBkb0VtYmVkKSB7XG4gIGRpc3BhdGNoKFwic2V0Q2VsbFN0YXRlXCIsIHtpZDogZWxlbS5jZWxsLmlkLCBzdGF0ZTogZWxlbS5zZWxlY3RlZC5zdGF0ZX0pLmNvbW1pdCgpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVBdXRvY29tcGxldGVPcHRpb25zKGlzRW50aXR5LCBwYXJzZWQsIHRleHQsIHBhcmFtcywgZW50aXR5SWQpIHtcbiAgbGV0IG9wdGlvbnM6e3Njb3JlOiBudW1iZXIsIGFjdGlvbjogYW55LCB0ZXh0OiBzdHJpbmcsIFthdHRyOnN0cmluZ106IGFueX1bXSA9IFtdO1xuICBsZXQgcGFnZU5hbWUgPSBldmUuZmluZE9uZShcImRpc3BsYXkgbmFtZVwiLCB7aWQ6IGVudGl0eUlkfSlbXCJuYW1lXCJdO1xuICBsZXQgaXNDb2xsZWN0aW9uID0gaXNFbnRpdHkgPyBldmUuZmluZE9uZShcImNvbGxlY3Rpb25cIiwge2NvbGxlY3Rpb246IGlzRW50aXR5LmlkfSkgOiBmYWxzZTtcbiAgbGV0IGpvaW5lciA9IFwiYVwiO1xuICBpZih0ZXh0ICYmIHRleHRbMF0ubWF0Y2goL1thZWlvdV0vaSkpIHtcbiAgICBqb2luZXIgPSBcImFuXCI7XG4gIH1cbiAgbGV0IGlzQVNjb3JlID0gMi41O1xuICBpZihpc0NvbGxlY3Rpb24pIHtcbiAgICBpc0FTY29yZSA9IDM7XG4gIH1cbiAgb3B0aW9ucy5wdXNoKHtzY29yZTogMi41LCBhY3Rpb246IGNyZWF0ZUFuZEVtYmVkLCByZXBsYWNlOiBcImlzIGFcIiwgZW50aXR5SWQsIGF0dHJpYnV0ZTogXCJyZWxhdGVkIHRvXCIsIHRleHQ6IGAke3BhZ2VOYW1lfSBpcyByZWxhdGVkIHRvICR7dGV4dH1gfSk7XG4gIG9wdGlvbnMucHVzaCh7c2NvcmU6IGlzQVNjb3JlLCBhY3Rpb246IGNyZWF0ZUFuZEVtYmVkLCByZXBsYWNlOiBcInJlbGF0ZWQgdG9cIiwgZW50aXR5SWQsIGF0dHJpYnV0ZTogXCJpcyBhXCIsIHRleHQ6IGAke3BhZ2VOYW1lfSBpcyAke2pvaW5lcn0gJHt0ZXh0fWB9KTtcbiAgcmV0dXJuIG9wdGlvbnM7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUFuZEVtYmVkKGVsZW0sIHZhbHVlLCBkb0VtYmVkKSB7XG4gIC8vY3JlYXRlIHRoZSBwYWdlIGFuZCBlbWJlZCBhIGxpbmsgdG8gaXRcbiAgbGV0IGVudGl0eSA9IHV1aWQoKTtcbiAgbGV0IHBhZ2UgPSB1dWlkKCk7XG4gIGxldCB7ZW50aXR5SWQsIGF0dHJpYnV0ZSwgcmVwbGFjZX0gPSBlbGVtLnNlbGVjdGVkO1xuICBsZXQgY2hhaW4gPSBkaXNwYXRjaChcImNyZWF0ZSBwYWdlXCIsIHtwYWdlLCBjb250ZW50OiBgIyR7dmFsdWV9XFxuYH0pXG4gICAgICAgICAgICAgIC5kaXNwYXRjaChcImNyZWF0ZSBlbnRpdHlcIiwge2VudGl0eSwgcGFnZSwgbmFtZTogdmFsdWV9KVxuICAgICAgICAgICAgICAuZGlzcGF0Y2goXCJhZGQgc291cmNlZCBlYXZcIiwge2VudGl0eTogZW50aXR5SWQsIGF0dHJpYnV0ZSwgdmFsdWU6IGVudGl0eSwgc291cmNlOiB1dWlkKCl9KTtcbiAgaWYocmVwbGFjZSkge1xuICAgIGNoYWluLmRpc3BhdGNoKFwicmVtb3ZlIGVudGl0eSBhdHRyaWJ1dGVcIiwge2VudGl0eTogZW50aXR5SWQsIGF0dHJpYnV0ZTogcmVwbGFjZSwgdmFsdWU6IGVudGl0eX0pO1xuICB9XG4gIGNoYWluLmNvbW1pdCgpO1xuICBkb0VtYmVkKGAke3ZhbHVlfXxyZXA9bGluaztgKTtcbn1cblxuZnVuY3Rpb24gcmVwcmVzZW50QXV0b2NvbXBsZXRlT3B0aW9ucyhpc0VudGl0eSwgcGFyc2VkLCB0ZXh0LCBwYXJhbXMsIGVudGl0eUlkKSB7XG4gIGxldCBvcHRpb25zOntzY29yZTogbnVtYmVyLCBhY3Rpb246IGFueSwgdGV4dDogc3RyaW5nLCBbYXR0cjpzdHJpbmddOiBhbnl9W10gPSBbXTtcbiAgbGV0IGlzQ29sbGVjdGlvbiA9IGlzRW50aXR5ID8gZXZlLmZpbmRPbmUoXCJjb2xsZWN0aW9uXCIsIHtjb2xsZWN0aW9uOiBpc0VudGl0eS5pZH0pIDogZmFsc2U7XG4gIG9wdGlvbnMucHVzaCh7c2NvcmU6MSwgdGV4dDogXCJhIHRhYmxlXCIsIGFjdGlvbjogZW1iZWRBcywgcmVwOiBcInRhYmxlXCIsIHBhcmFtc30pO1xuICAvLyBvcHRpb25zLnB1c2goe3Njb3JlOjEsIHRleHQ6IFwiZW1iZWQgYXMgYSB2YWx1ZVwiLCBhY3Rpb246IGVtYmVkQXMsIHJlcDogXCJ2YWx1ZVwifSk7XG4gIGlmKGlzRW50aXR5KSB7XG4gICAgb3B0aW9ucy5wdXNoKHtzY29yZToxLCB0ZXh0OiBcImEgbGlua1wiLCBhY3Rpb246IGVtYmVkQXMsIHJlcDogXCJsaW5rXCIsIHBhcmFtc30pO1xuICB9XG4gIGlmKGlzQ29sbGVjdGlvbikge1xuICAgIG9wdGlvbnMucHVzaCh7c2NvcmU6MSwgdGV4dDogXCJhIGxpc3RcIiwgYWN0aW9uOiBlbWJlZEFzLCByZXA6IFwiaW5kZXhcIiwgcGFyYW1zfSk7XG4gICAgb3B0aW9ucy5wdXNoKHtzY29yZToxLCB0ZXh0OiBcImEgZGlyZWN0b3J5XCIsIGFjdGlvbjogZW1iZWRBcywgcmVwOiBcImRpcmVjdG9yeVwiLCBwYXJhbXN9KTtcbiAgfVxuICBpZihpc0VudGl0eSkge1xuICAgIG9wdGlvbnMucHVzaCh7c2NvcmU6MSwgdGV4dDogXCJhIGxpc3Qgb2YgcmVsYXRlZCBwYWdlc1wiLCBhY3Rpb246IGVtYmVkQXMsIHJlcDogXCJyZWxhdGVkXCIsIHBhcmFtc30pO1xuICAgIC8vIG9wdGlvbnMucHVzaCh7c2NvcmU6MSwgdGV4dDogXCJhIHByb3BlcnRpZXMgdGFibGVcIiwgYWN0aW9uOiBlbWJlZEFzLCByZXA6IFwiYXR0cmlidXRlc1wiLCBwYXJhbXN9KTtcbiAgfVxuICByZXR1cm4gb3B0aW9ucztcbn1cblxuZnVuY3Rpb24gdXJsQXV0b2NvbXBsZXRlT3B0aW9ucyhpc0VudGl0eSwgcGFyc2VkLCB1cmw6c3RyaW5nLCBwYXJhbXMsIGVudGl0eUlkOnN0cmluZykge1xuICAvLyBATk9URTogdXJsIG11c3QgYmUgbm9ybWFsaXplZCBiZWZvcmUgcmVhY2hpbmcgaGVyZS5cbiAgLy8gQEZJWE1FOiBOZWVkIHRvIGdldCBhIHVybCBwcm9wZXJ0eSBvbnRvIHRoZSBwYXJhbXMuIFNob3VsZCB0aGF0IGJlIGRvbmUgaGVyZT9cbiAgbGV0IGV4dCA9IHVybC5zbGljZSh1cmwubGFzdEluZGV4T2YoXCIuXCIpICsgMSkudHJpbSgpLnRvTG93ZXJDYXNlKCk7XG4gIGxldCBkb21haW4gPSB1cmwuc2xpY2UodXJsLmluZGV4T2YoXCIvL1wiKSArIDIpLnNwbGl0KFwiL1wiKVswXTtcbiAgbGV0IGlzSW1hZ2UgPSBbXCJwbmdcIiwgXCJqcGdcIiwgXCJqcGVnXCIsIFwiYm1wXCIsIFwidGlmZlwiXS5pbmRleE9mKGV4dCkgIT09IC0xO1xuICBsZXQgaXNWaWRlbyA9IChbXCJtcDRcIiwgXCJvZ3ZcIiwgXCJ3ZWJtXCIsIFwibW92XCIsIFwiYXZpXCIsIFwiZmx2XCJdLmluZGV4T2YoZXh0KSAhPT0gLTEpIHx8IChbXCJ3d3cueW91dHViZS5jb21cIiwgXCJ5b3V0dS5iZVwiXS5pbmRleE9mKGRvbWFpbikgIT09IC0xKTtcbiAgbGV0IG9wdGlvbnM6e3Njb3JlOiBudW1iZXIsIGFjdGlvbjogYW55LCB0ZXh0OiBzdHJpbmcsIFthdHRyOnN0cmluZ106IGFueX1bXSA9IFtcbiAgICB7c2NvcmU6IDIsIHRleHQ6IFwiYSBsaW5rXCIsIGFjdGlvbjogZW1iZWRBcywgcmVwOiBcImV4dGVybmFsTGlua1wiLCBwYXJhbXN9LFxuICAgIHtzY29yZTogaXNJbWFnZSA/IDMgOiAxLCB0ZXh0OiBcImFuIGltYWdlXCIsIGFjdGlvbjogZW1iZWRBcywgcmVwOiBcImV4dGVybmFsSW1hZ2VcIiwgcGFyYW1zfSxcbiAgICB7c2NvcmU6IGlzVmlkZW8gPyAzIDogMSwgdGV4dDogXCJhIHZpZGVvXCIsIGFjdGlvbjogZW1iZWRBcywgcmVwOiBcImV4dGVybmFsVmlkZW9cIiwgcGFyYW1zfSxcbiAgXTtcbiAgcmV0dXJuIG9wdGlvbnM7XG59XG5cbmZ1bmN0aW9uIGVtYmVkQXMoZWxlbSwgdmFsdWUsIGRvRW1iZWQpIHtcbiAgbGV0IFt0ZXh0XSA9IHZhbHVlLnNwbGl0KFwifFwiKTtcbiAgbGV0IHBhcmFtcyA9IGVsZW0uc2VsZWN0ZWQucGFyYW1zO1xuICBsZXQgcmF3UGFyYW1zID0gYHJlcD0ke2VsZW0uc2VsZWN0ZWQucmVwfWA7XG4gIGZvcihsZXQgcGFyYW0gaW4gcGFyYW1zKSB7XG4gICAgaWYocGFyYW0gIT09IFwicmVwXCIpIHtcbiAgICAgIHJhd1BhcmFtcyArPSBgOyAke3BhcmFtfT0ke3BhcmFtc1twYXJhbV19YDtcbiAgICB9XG4gIH1cbiAgZG9FbWJlZChgJHt0ZXh0fXwke3Jhd1BhcmFtc31gKTtcbn1cblxuZnVuY3Rpb24gcHJvcGVydHlBdXRvY29tcGxldGVPcHRpb25zKGlzRW50aXR5LCBwYXJzZWQsIHRleHQsIHBhcmFtcywgZW50aXR5SWQpIHtcbiAgbGV0IG9wdGlvbnM6e3Njb3JlOiBudW1iZXIsIGFjdGlvbjogYW55LCB0ZXh0Pzogc3RyaW5nLCBbYXR0cjpzdHJpbmddOiBhbnl9W10gPSBbXTtcbiAgbGV0IHRvcFBhcnNlID0gcGFyc2VkWzBdO1xuICBsZXQgYXNRdWVyeSA9IHRvcFBhcnNlICYmIHRvcFBhcnNlLnN0YXRlID09PSBTdGF0ZUZsYWdzLkNPTVBMRVRFO1xuICBsZXQgb3B0aW9uOmFueSA9IHtzY29yZTogMSwgYWN0aW9uOiBkZWZpbmVQcm9wZXJ0eUFuZEVtYmVkLCBlbnRpdHlJZCwgYXNRdWVyeX07XG4gIG9wdGlvbi5jaGlsZHJlbiA9IFtcbiAgICB7YzogXCJhdHRyaWJ1dGUtbmFtZVwiLCB0ZXh0OiBcInByb3BlcnR5XCJ9LFxuICAgIHtjOiBcImlubGluZS1jZWxsXCIsIGNvbnRlbnRFZGl0YWJsZTogdHJ1ZSwgc2VsZWN0ZWQ6b3B0aW9uLCBrZXlkb3duOiBkZWZpbmVLZXlzLCBwb3N0UmVuZGVyOiBhdXRvRm9jdXN9XG4gIF1cbiAgb3B0aW9ucy5wdXNoKG9wdGlvbik7XG4gIHJldHVybiBvcHRpb25zO1xufVxuXG5mdW5jdGlvbiBkZWZpbmVQcm9wZXJ0eUFuZEVtYmVkKGVsZW0sIHZhbHVlLCBkb0VtYmVkKSB7XG4gIGxldCB7c2VsZWN0ZWR9ID0gZWxlbTtcbiAgbGV0IHtlbnRpdHlJZCwgYXNRdWVyeSwgZGVmaW5lVmFsdWV9ID0gc2VsZWN0ZWQ7XG4gIGlmKGFzUXVlcnkpIHtcbiAgICB2YWx1ZSA9IGA9ICR7dmFsdWV9YDtcbiAgfVxuICBsZXQgc3VjY2VzcyA9IGhhbmRsZUF0dHJpYnV0ZURlZmluaXRpb24oZW50aXR5SWQsIGRlZmluZVZhbHVlLCB2YWx1ZSk7XG4gIGxldCBlbnRpdHlOYW1lID0gZXZlLmZpbmRPbmUoXCJkaXNwbGF5IG5hbWVcIiwge2lkOiBlbnRpdHlJZH0pLm5hbWU7XG4gIGRvRW1iZWQoYCR7ZW50aXR5TmFtZX0ncyAke2RlZmluZVZhbHVlfXxyZXA9Q1NWO2ZpZWxkPSR7ZGVmaW5lVmFsdWV9YCk7XG59XG5cbmZ1bmN0aW9uIGRlZmluZUF1dG9jb21wbGV0ZU9wdGlvbnMoaXNFbnRpdHksIHBhcnNlZCwgdGV4dCwgcGFyYW1zLCBlbnRpdHlJZCkge1xuICBsZXQgb3B0aW9uczp7c2NvcmU6IG51bWJlciwgYWN0aW9uOiBhbnksIHRleHQ/OiBzdHJpbmcsIFthdHRyOnN0cmluZ106IGFueX1bXSA9IFtdO1xuICBsZXQgdG9wUGFyc2UgPSBwYXJzZWRbMF07XG4gIGxldCBjb250ZXh0ID0gdG9wUGFyc2UuY29udGV4dDtcbiAgbGV0IGF0dHJpYnV0ZTtcbiAgaWYoY29udGV4dC5tYXliZUF0dHJpYnV0ZXNbMF0pIHtcbiAgICBhdHRyaWJ1dGUgPSBjb250ZXh0Lm1heWJlQXR0cmlidXRlc1swXS5uYW1lO1xuICB9IGVsc2Uge1xuICAgIGF0dHJpYnV0ZSA9IGNvbnRleHQuYXR0cmlidXRlc1swXS5kaXNwbGF5TmFtZTtcbiAgfVxuICBsZXQgc3ViamVjdCA9IGNvbnRleHQuZW50aXRpZXNbMF0gfHwgY29udGV4dC5jb2xsZWN0aW9uc1swXTtcbiAgbGV0IGVudGl0eSA9IHN1YmplY3QuaWQ7XG4gIGxldCBvcHRpb246YW55ID0ge3Njb3JlOiAxLCBhY3Rpb246IGRlZmluZUFuZEVtYmVkLCBhdHRyaWJ1dGUsIGVudGl0eX07XG4gIG9wdGlvbi5jaGlsZHJlbiA9IFtcbiAgICB7YzogXCJhdHRyaWJ1dGUtbmFtZVwiLCB0ZXh0OiBhdHRyaWJ1dGV9LFxuICAgIHtjOiBcImlubGluZS1jZWxsXCIsIGNvbnRlbnRFZGl0YWJsZTogdHJ1ZSwgc2VsZWN0ZWQ6b3B0aW9uLCBrZXlkb3duOiBkZWZpbmVLZXlzLCBwb3N0UmVuZGVyOiBhdXRvRm9jdXN9XG4gIF1cbiAgb3B0aW9ucy5wdXNoKG9wdGlvbik7XG4gIHJldHVybiBvcHRpb25zO1xufVxuXG5mdW5jdGlvbiBmb2N1c1NlbGVjdGVkKG5vZGUsIGVsZW0pIHtcbiAgaWYoZWxlbS5zZWxlY3RlZC5zZWxlY3RlZCAmJiBub2RlICE9PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50KXtcbiAgICBub2RlLmZvY3VzKCk7XG4gICAgc2V0RW5kT2ZDb250ZW50RWRpdGFibGUobm9kZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gc2VsZWN0T3B0aW9uSXgoZXZlbnQsIGVsZW0pIHtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgZGlzcGF0Y2goXCJtb3ZlQ2VsbEF1dG9jb21wbGV0ZVwiLCB7Y2VsbDogZWxlbS5zZWxlY3RlZC5jZWxsLCB2YWx1ZTogZWxlbS5vcHRpb25JeH0pLmNvbW1pdCgpO1xufVxuXG5mdW5jdGlvbiBtb2RpZnlBdXRvY29tcGxldGVPcHRpb25zKGlzRW50aXR5LCBwYXJzZWQsIHRleHQsIHBhcmFtcywgZW50aXR5SWQpIHtcbiAgbGV0IG9wdGlvbnM6e3Njb3JlOiBudW1iZXIsIGFjdGlvbjogYW55LCB0ZXh0Pzogc3RyaW5nLCBbYXR0cjpzdHJpbmddOiBhbnl9W10gPSBbXTtcbiAgbGV0IHRvcFBhcnNlID0gcGFyc2VkWzBdO1xuICBsZXQgY29udGV4dCA9IHRvcFBhcnNlLmNvbnRleHQ7XG4gIGxldCBhdHRyaWJ1dGUgPSBjb250ZXh0LmF0dHJpYnV0ZXNbMF0uZGlzcGxheU5hbWU7XG4gIGxldCBzdWJqZWN0ID0gY29udGV4dC5lbnRpdGllc1swXSB8fCBjb250ZXh0LmNvbGxlY3Rpb25zWzBdO1xuICBsZXQgZW50aXR5ID0gc3ViamVjdC5pZDtcbiAgbGV0IGVhdnMgPSBldmUuZmluZChcImVudGl0eSBlYXZzXCIsIHtlbnRpdHksIGF0dHJpYnV0ZX0pO1xuICBsZXQgaXggPSAwO1xuICBsZXQgc291cmNlc1NlZW4gPSB7fTtcbiAgZm9yKGxldCBlYXYgb2YgZWF2cykge1xuICAgIGxldCBvcHRpb246YW55ID0ge3Njb3JlOiAxLCBhY3Rpb246IG1vZGlmeUFuZEVtYmVkLCBlYXYsIHBhcmFtc307XG4gICAgbGV0IGdlbmVyYXRlZCA9IGV2ZS5maW5kT25lKFwiZ2VuZXJhdGVkIGVhdlwiLCB7ZW50aXR5OiBlYXYuZW50aXR5LCBhdHRyaWJ1dGU6IGVhdi5hdHRyaWJ1dGUsIHZhbHVlOiBlYXYudmFsdWV9KTtcbiAgICBsZXQgdGV4dCA9IGVhdi52YWx1ZTtcbiAgICBsZXQgc291cmNlVmlldztcbiAgICBsZXQgZGlzcGxheSA9IGV2ZS5maW5kT25lKFwiZGlzcGxheSBuYW1lXCIsIHtpZDogdGV4dH0pO1xuICAgIGlmKGdlbmVyYXRlZCkge1xuICAgICAgc291cmNlVmlldyA9IGdlbmVyYXRlZC5zb3VyY2U7XG4gICAgICBpZihzb3VyY2VzU2Vlbltzb3VyY2VWaWV3XSkgY29udGludWU7XG4gICAgICBzb3VyY2VzU2Vlbltzb3VyY2VWaWV3XSA9IHRydWU7XG4gICAgICB0ZXh0ID0gYD0gJHtldmUuZmluZE9uZShcInF1ZXJ5IHRvIGlkXCIsIHtpZDogc291cmNlVmlld30pLnF1ZXJ5fWA7XG4gICAgICBvcHRpb24uc291cmNlVmlldyA9IHNvdXJjZVZpZXc7XG4gICAgICBvcHRpb24ucXVlcnkgPSB0ZXh0O1xuICAgIH0gZWxzZSBpZihkaXNwbGF5KSB7XG4gICAgICB0ZXh0ID0gYD0gJHtkaXNwbGF5Lm5hbWV9YDtcbiAgICB9XG4gICAgb3B0aW9uLmNoaWxkcmVuID0gW1xuICAgICAge2M6IFwiYXR0cmlidXRlLW5hbWVcIiwgdGV4dDogYXR0cmlidXRlfSxcbiAgICAgIHtjOiBcImlubGluZS1jZWxsXCIsIGNvbnRlbnRFZGl0YWJsZTogdHJ1ZSwgdGV4dCwgb3B0aW9uSXg6IGl4LCBjbGljazpzZWxlY3RPcHRpb25JeCwgc2VsZWN0ZWQ6b3B0aW9uLCBrZXlkb3duOiBkZWZpbmVLZXlzLCBwb3N0UmVuZGVyOiBmb2N1c1NlbGVjdGVkfVxuICAgIF1cbiAgICBvcHRpb25zLnB1c2gob3B0aW9uKTtcbiAgICBpeCsrO1xuICB9XG4gIGxldCBvcHRpb246YW55ID0ge3Njb3JlOiAxLCBhY3Rpb246IGRlZmluZUFuZEVtYmVkLCBhdHRyaWJ1dGUsIGVudGl0eX07XG4gIG9wdGlvbi5jaGlsZHJlbiA9IFtcbiAgICB7YzogXCJhdHRyaWJ1dGUtbmFtZVwiLCB0ZXh0OiBhdHRyaWJ1dGV9LFxuICAgIHtjOiBcImlubGluZS1jZWxsXCIsIGNvbnRlbnRFZGl0YWJsZTogdHJ1ZSwgc2VsZWN0ZWQ6b3B0aW9uLCBrZXlkb3duOiBkZWZpbmVLZXlzLCBwb3N0UmVuZGVyOiBmb2N1c1NlbGVjdGVkfVxuICBdXG4gIG9wdGlvbnMucHVzaChvcHRpb24pO1xuICByZXR1cm4gb3B0aW9ucztcbn1cblxuZnVuY3Rpb24gbW9kaWZ5QW5kRW1iZWQoZWxlbSwgdGV4dCwgZG9FbWJlZCkge1xuICBsZXQge2VhdiwgZGVmaW5lVmFsdWUsIHBhcmFtcywgc291cmNlVmlldywgcXVlcnl9ID0gZWxlbS5zZWxlY3RlZDtcbiAgbGV0IHN1Y2Nlc3MgPSBzdWJtaXRBdHRyaWJ1dGUoe2N1cnJlbnRUYXJnZXQ6IHt2YWx1ZTogZGVmaW5lVmFsdWV9fSwge2Vhdiwgc291cmNlVmlldywgcXVlcnl9KTtcbiAgaWYoIXN1Y2Nlc3MpIHtcbiAgICBjb25zb2xlLmxvZyhcIkkgZG9uJ3Qga25vdyB3aGF0IHRvIGRvXCIpO1xuICB9XG4gIC8vIGlmIHlvdSBkaWRuJ3QgcmVtb3ZlIGFsbCB0aGUgYXR0cmlidXRlcywganVzdCByZS1lbWJlZCB3aGF0IHdhcyB0aGVyZVxuICBpZihldmUuZmluZE9uZShcImVudGl0eSBlYXZzXCIsIHtlbnRpdHk6IGVhdi5lbnRpdHksIGF0dHJpYnV0ZTogZWF2LmF0dHJpYnV0ZX0pKSB7XG4gICAgZG9FbWJlZChgJHt0ZXh0fXwke3N0cmluZ2lmeVBhcmFtcyhwYXJhbXMpfWApO1xuICB9IGVsc2Uge1xuICAgIC8vIG90aGVyd2lzZSB0aGVyZSdzIG5vIHBvaW50IGluIGVtYmVkZGluZyBhbiBlcnJvciBjZWxsXG4gICAgZG9FbWJlZChcIlwiKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBpbnRlcnByZXRBdHRyaWJ1dGVWYWx1ZSh2YWx1ZSk6IHtpc1ZhbHVlOiBib29sZWFuLCBwYXJzZT86YW55LCB2YWx1ZT86YW55fSB7XG4gIGxldCBjbGVhbmVkID0gdmFsdWUudHJpbSgpO1xuICBpZihjbGVhbmVkWzBdID09PSBcIj1cIikge1xuICAgIC8vcGFyc2UgaXRcbiAgICBjbGVhbmVkID0gY2xlYW5lZC5zdWJzdHJpbmcoMSkudHJpbSgpO1xuICAgIGxldCBkaXNwbGF5ID0gZXZlLmZpbmRPbmUoXCJkaXNwbGF5IG5hbWVcIiwge25hbWU6IGNsZWFuZWR9KSB8fCBldmUuZmluZE9uZShcImRpc3BsYXkgbmFtZVwiLCB7aWQ6IGNsZWFuZWR9KTtcbiAgICBpZihkaXNwbGF5KSB7XG4gICAgICByZXR1cm4ge2lzVmFsdWU6IHRydWUsIHZhbHVlOiBkaXNwbGF5LmlkfTtcbiAgICB9XG4gICAgbGV0IHBhcnNlZCA9IG5scGFyc2UoY2xlYW5lZCk7XG4gICAgcmV0dXJuIHtpc1ZhbHVlOiBmYWxzZSwgcGFyc2U6IHBhcnNlZCwgdmFsdWU6IGNsZWFuZWR9O1xuICB9IGVsc2Uge1xuICAgIHJldHVybiB7aXNWYWx1ZTogdHJ1ZSwgdmFsdWU6IGNvZXJjZUlucHV0KGNsZWFuZWQpfTtcbiAgfVxufVxuXG5mdW5jdGlvbiBoYW5kbGVBdHRyaWJ1dGVEZWZpbml0aW9uKGVudGl0eSwgYXR0cmlidXRlLCBzZWFyY2gsIGNoYWluPykge1xuICBpZighY2hhaW4pIHtcbiAgICBjaGFpbiA9IGRpc3BhdGNoKCk7XG4gIH1cbiAgbGV0IHtpc1ZhbHVlLCB2YWx1ZSwgcGFyc2V9ID0gaW50ZXJwcmV0QXR0cmlidXRlVmFsdWUoc2VhcmNoKTtcbiAgaWYoaXNWYWx1ZSkge1xuICAgIGNoYWluLmRpc3BhdGNoKFwiYWRkIHNvdXJjZWQgZWF2XCIsIHtlbnRpdHksIGF0dHJpYnV0ZSwgdmFsdWV9KS5jb21taXQoKTtcbiAgfSBlbHNlIHtcbiAgICBsZXQgcXVlcnlUZXh0ID0gdmFsdWUudHJpbSgpO1xuICAgIC8vIGFkZCB0aGUgcXVlcnlcbiAgICBkaXNwYXRjaChcImluc2VydCBxdWVyeVwiLCB7cXVlcnk6IHF1ZXJ5VGV4dH0pLmNvbW1pdCgpO1xuICAgIC8vIGNyZWF0ZSBhbm90aGVyIHF1ZXJ5IHRoYXQgcHJvamVjdHMgZWF2c1xuICAgIGxldCBxdWVyeVRvSWQgPSBldmUuZmluZE9uZShcInF1ZXJ5IHRvIGlkXCIsIHtxdWVyeTogcXVlcnlUZXh0fSk7XG4gICAgaWYoIXF1ZXJ5VG9JZCkgcmV0dXJuIGZhbHNlO1xuICAgIGxldCBpZCA9IHF1ZXJ5VG9JZC5pZDtcbiAgICBsZXQgcGFyYW1zID0gZ2V0Q2VsbFBhcmFtcyhxdWVyeVRleHQsIFwiXCIpO1xuICAgIGlmKCFwYXJhbXNbXCJmaWVsZFwiXSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gZWxzZSB7XG4gICAgICAvL2J1aWxkIGEgcXVlcnlcbiAgICAgIGxldCBlYXZQcm9qZWN0ID0gYChxdWVyeSA6JCR2aWV3IFwiJHtlbnRpdHl9fCR7YXR0cmlidXRlfXwke2lkfVwiIChzZWxlY3QgXCIke2lkfVwiIDoke3BhcmFtc1tcImZpZWxkXCJdLnJlcGxhY2UoXCIgXCIsIFwiLVwiKX0gdmFsdWUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHByb2plY3QhIFwiZ2VuZXJhdGVkIGVhdlwiIDplbnRpdHkgXCIke2VudGl0eX1cIiA6YXR0cmlidXRlIFwiJHthdHRyaWJ1dGV9XCIgOnZhbHVlIHZhbHVlIDpzb3VyY2UgXCIke2lkfVwiKSlgO1xuICAgICAgY2hhaW4uZGlzcGF0Y2goXCJpbnNlcnQgaW1wbGljYXRpb25cIiwge3F1ZXJ5OiBlYXZQcm9qZWN0fSkuY29tbWl0KCk7XG4gICAgfVxuICB9XG4gIHJldHVybiB0cnVlO1xufVxuXG5mdW5jdGlvbiBkZWZpbmVBbmRFbWJlZChlbGVtLCB0ZXh0LCBkb0VtYmVkKSB7XG4gIGxldCB7c2VsZWN0ZWR9ID0gZWxlbTtcbiAgbGV0IHtlbnRpdHksIGF0dHJpYnV0ZSwgZGVmaW5lVmFsdWV9ID0gc2VsZWN0ZWQ7XG4gIGxldCBzdWNjZXNzID0gaGFuZGxlQXR0cmlidXRlRGVmaW5pdGlvbihlbnRpdHksIGF0dHJpYnV0ZSwgZGVmaW5lVmFsdWUpO1xuICBpZihzdWNjZXNzKSB7XG4gICAgZG9FbWJlZChgJHt0ZXh0fXxyZXA9Q1NWO2ZpZWxkPSR7YXR0cmlidXRlfWApO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJDb3VsZG4ndCBmaWd1cmUgb3V0IHN1YmplY3Qgb2Y6IFwiICsgZGVmaW5lVmFsdWUpO1xuICAgIGRvRW1iZWQoYCR7dGV4dH18cmVwPWVycm9yO21lc3NhZ2U9SSBjb3VsZG4ndCBmaWd1cmUgb3V0IHRoZSBzdWJqZWN0IG9mIHRoYXQgc2VhcmNoO2ApXG4gIH1cbn1cblxuZnVuY3Rpb24gZGVmaW5lS2V5cyhldmVudCwgZWxlbSkge1xuICBsZXQgY2VsbCA9IGVsZW0uc2VsZWN0ZWQuY2VsbDtcbiAgaWYoZXZlbnQua2V5Q29kZSA9PT0gS0VZUy5FTlRFUikge1xuICAgIGVsZW0uc2VsZWN0ZWQuZGVmaW5lVmFsdWUgPSBldmVudC5jdXJyZW50VGFyZ2V0LnRleHRDb250ZW50O1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIH0gZWxzZSBpZihldmVudC5rZXlDb2RlID09PSBLRVlTLlVQKSB7XG4gICAgZGlzcGF0Y2goXCJtb3ZlQ2VsbEF1dG9jb21wbGV0ZVwiLCB7Y2VsbCwgZGlyZWN0aW9uOiAtMX0pLmNvbW1pdCgpO1xuICB9IGVsc2UgaWYoZXZlbnQua2V5Q29kZSA9PT0gS0VZUy5ET1dOKSB7XG4gICAgZGlzcGF0Y2goXCJtb3ZlQ2VsbEF1dG9jb21wbGV0ZVwiLCB7Y2VsbCwgZGlyZWN0aW9uOiAxfSkuY29tbWl0KCk7XG4gIH0gZWxzZSBpZihldmVudC5rZXlDb2RlID09PSBLRVlTLkVTQykge1xuICAgIGRpc3BhdGNoKFwiY2xlYXJBY3RpdmVDZWxsc1wiKS5jb21taXQoKTtcbiAgICBpZihlbGVtLnNlbGVjdGVkLnBhbmVJZCkge1xuICAgICAgcGFuZUVkaXRvcnNbZWxlbS5zZWxlY3RlZC5wYW5lSWRdLmNtSW5zdGFuY2UuZm9jdXMoKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGVudGl0eShlbnRpdHlJZDpzdHJpbmcsIHBhbmVJZDpzdHJpbmcsIGtpbmQ6IFBBTkUsIG9wdGlvbnM6YW55ID0ge30pOkVsZW1lbnQge1xuICBsZXQge2NvbnRlbnQgPSB1bmRlZmluZWR9ID0gZXZlLmZpbmRPbmUoXCJlbnRpdHlcIiwge2VudGl0eTogZW50aXR5SWR9KSB8fCB7fTtcbiAgaWYoY29udGVudCA9PT0gdW5kZWZpbmVkKSByZXR1cm4ge3RleHQ6IFwiQ291bGQgbm90IGZpbmQgdGhlIHJlcXVlc3RlZCBwYWdlXCJ9O1xuICBsZXQgcGFnZSA9IGV2ZS5maW5kT25lKFwiZW50aXR5IHBhZ2VcIiwge2VudGl0eTogZW50aXR5SWR9KVtcInBhZ2VcIl07XG4gIGxldCB7bmFtZX0gPSBldmUuZmluZE9uZShcImRpc3BsYXkgbmFtZVwiLCB7aWQ6IGVudGl0eUlkfSk7XG4gIGxldCBjZWxscyA9IGdldENlbGxzKGNvbnRlbnQsIHBhbmVJZCk7XG4gIGxldCBrZXlzID0ge1xuICAgIFwiQmFja3NwYWNlXCI6IChjbSkgPT4gbWF5YmVBY3RpdmF0ZUNlbGwoY20sIHBhbmVJZCksXG4gICAgXCJDbWQtRW50ZXJcIjogKGNtKSA9PiBtYXliZU5hdmlnYXRlKGNtLCBwYW5lSWQpLFxuICAgIFwiPVwiOiAoY20pID0+IGNyZWF0ZUVtYmVkUG9wb3V0KGNtLCBwYW5lSWQpXG4gIH07XG4gIGlmKGtpbmQgPT09IFBBTkUuUE9QT1VUKSB7XG4gICAga2V5c1tcIkVzY1wiXSA9ICgpID0+IHtcbiAgICAgIGRpc3BhdGNoKFwicmVtb3ZlIHBvcHVwXCIsIHt9KS5jb21taXQoKTtcbiAgICAgIGxldCBwYXJlbnQgPSBldmUuZmluZE9uZShcInVpIHBhbmUgcGFyZW50XCIsIHtwYW5lOiBwYW5lSWR9KVtcInBhcmVudFwiXTtcbiAgICAgIHBhbmVFZGl0b3JzW3BhcmVudF0uY21JbnN0YW5jZS5mb2N1cygpO1xuICAgIH07XG4gIH1cbiAgbGV0IGZpbmFsT3B0aW9ucyA9IG1lcmdlT2JqZWN0KHtrZXlzfSwgb3B0aW9ucyk7XG4gIGxldCBjZWxsSXRlbXMgPSBjZWxscy5tYXAoKGNlbGwsIGl4KSA9PiB7XG4gICAgbGV0IHVpO1xuICAgIGxldCBhY3RpdmUgPSBhY3RpdmVDZWxsc1tjZWxsLmlkXTtcbiAgICBpZihhY3RpdmUpIHtcbiAgICAgIHVpID0gY2VsbEVkaXRvcihlbnRpdHlJZCwgcGFuZUlkLCBhY3RpdmUgfHwgY2VsbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHVpID0gY2VsbFVJKHBhbmVJZCwgY2VsbC5xdWVyeSwgY2VsbCk7XG4gICAgfVxuICAgIHVpLmlkID0gYCR7cGFuZUlkfXwke2NlbGwuaWR9YDtcbiAgICB1aS5wb3N0UmVuZGVyID0gcmVwYXJlbnRDZWxsO1xuICAgIHVpW1wiY29udGFpbmVySWRcIl0gPSBgJHtwYW5lSWR9fCR7Y2VsbC5pZH18Y29udGFpbmVyYDtcbiAgICB1aVtcImNlbGxcIl0gPSBjZWxsO1xuICAgIHJldHVybiB1aTtcbiAgfSk7XG4gIGxldCBhdHRycztcbiAgaWYoa2luZCAhPT0gUEFORS5QT1BPVVQpIHtcbiAgICAvLyBhdHRycyA9IHVpdGsuYXR0cmlidXRlcyh7ZW50aXR5OiBlbnRpdHlJZCwgZGF0YToge3BhbmVJZH0sIGtleTogYCR7cGFuZUlkfXwke2VudGl0eUlkfWB9KTtcbiAgICBhdHRycyA9IGF0dHJpYnV0ZXNVSShlbnRpdHlJZCwgcGFuZUlkKTtcbiAgICBhdHRycy5jICs9IFwiIHBhZ2UtYXR0cmlidXRlc1wiO1xuICB9XG4gIHJldHVybiB7aWQ6IGAke3BhbmVJZH18JHtlbnRpdHlJZH18ZWRpdG9yYCwgdDogXCJjb250ZW50XCIsIGM6IFwid2lraS1lbnRpdHlcIiwgY2hpbGRyZW46IFtcbiAgICAvKiBUaGlzIGlzIGRpc2FibGVkIGJlY2F1c2Ugc2VhcmNoaW5nIGZvciBqdXN0IHRoZSBuYW1lIG9mIGEgc2luZ2xlIGVudGl0eSByZXNvbHZlcyB0byBhIHNpbmdsZSBmaW5kIHN0ZXAgd2hpY2ggYmxvd3MgdXAgb24gcXVlcnkgY29tcGlsYXRpb25cbiAgICAgICB7YzogXCJmbGV4LXJvdyBzcGFjZWQtcm93IGRpc2FtYmlndWF0aW9uXCIsIGNoaWxkcmVuOiBbXG4gICAgICAge3RleHQ6IFwiRGlkIHlvdSBtZWFuIHRvXCJ9LFxuICAgICAgIHt0OiBcImFcIiwgYzogXCJsaW5rIGJ0biBhZGQtYnRuXCIsIHRleHQ6IGBzZWFyY2ggZm9yICcke25hbWV9J2AsIGhyZWY6IFwiI1wiLCBuYW1lOiBzZWFyY2gsIGRhdGE6IHtwYW5lSWR9LCBsaW5rOiBgc2VhcmNoOiAke25hbWV9YCwgY2xpY2s6IG5hdmlnYXRlfSxcbiAgICAgICB7dGV4dDogXCJpbnN0ZWFkP1wifVxuICAgICAgIF19LFxuICAgICAqL1xuICAgIHtjOiBcIndpa2ktZWRpdG9yXCIsIHBvc3RSZW5kZXI6IHdpa2lFZGl0b3IsIG9uVXBkYXRlOiB1cGRhdGVQYWdlLCBtZXRhOiB7ZW50aXR5OiBlbnRpdHlJZCwgcGFnZSwgcGFuZUlkfSwgdmFsdWU6IGNvbnRlbnQsIG9wdGlvbnM6IGZpbmFsT3B0aW9ucywgY2VsbHMsIGNoaWxkcmVuOiBjZWxsSXRlbXN9LFxuICAgIGF0dHJzLFxuICBdfTtcbn1cblxuZnVuY3Rpb24gbWF5YmVBY3RpdmF0ZUNlbGwoY20sIHBhbmVJZCkge1xuICBpZighY20uc29tZXRoaW5nU2VsZWN0ZWQoKSkge1xuICAgIGxldCBwb3MgPSBjbS5nZXRDdXJzb3IoXCJmcm9tXCIpO1xuICAgIGxldCBtYXJrcyA9IGNtLmZpbmRNYXJrc0F0KHBvcyk7XG4gICAgbGV0IGNlbGw7XG4gICAgZm9yKGxldCBtYXJrIG9mIG1hcmtzKSB7XG4gICAgICBsZXQge3RvfSA9IG1hcmsuZmluZCgpO1xuICAgICAgaWYobWFyay5jZWxsICYmIHRvLmNoID09PSBwb3MuY2gpIHtcbiAgICAgICAgY2VsbCA9IG1hcmsuY2VsbDtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICAgIGlmKGNlbGwpIHtcbiAgICAgIGxldCBxdWVyeSA9IGNlbGwucXVlcnkuc3BsaXQoXCJ8XCIpWzBdO1xuICAgICAgZGlzcGF0Y2goXCJhZGRBY3RpdmVDZWxsXCIsIHtpZDogY2VsbC5pZCwgY2VsbCwgcXVlcnl9KS5jb21taXQoKTtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2UgaWYocG9zLmxpbmUgPT09IDEgJiYgcG9zLmNoID09PSAwKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9XG4gIHJldHVybiBDb2RlTWlycm9yLlBhc3M7XG59XG5cbmZ1bmN0aW9uIG1heWJlTmF2aWdhdGUoY20sIHBhbmVJZCkge1xuICBpZighY20uc29tZXRoaW5nU2VsZWN0ZWQoKSkge1xuICAgIGxldCBwb3MgPSBjbS5nZXRDdXJzb3IoXCJmcm9tXCIpO1xuICAgIGxldCBtYXJrcyA9IGNtLmZpbmRNYXJrc0F0KHBvcyk7XG4gICAgbGV0IHRvQ2xpY2s7XG4gICAgZm9yKGxldCBtYXJrIG9mIG1hcmtzKSB7XG4gICAgICBpZihtYXJrLmNlbGwpIHtcbiAgICAgICAgdG9DbGljayA9IG1hcms7XG4gICAgICB9XG4gICAgfVxuICAgIGlmKHRvQ2xpY2spIHtcbiAgICAgIC8vIEBIQUNLOiB0aGVyZSByZWFsbHkgc2hvdWxkIGJlIGEgYmV0dGVyIHdheSBmb3IgbWUgdG8gZmluZCBvdXRcbiAgICAgIC8vIGlmIHRoZXJlJ3MgYSBsaW5rIGluIHRoaXMgY2VsbCBhbmQgaWYgaXQgaXMgd2hhdCB0aGF0IGxpbmsgaXNcbiAgICAgIC8vIHRvLlxuICAgICAgbGV0IGxpbmsgPSB0b0NsaWNrLndpZGdldE5vZGUucXVlcnlTZWxlY3RvcihcIi5saW5rXCIpO1xuICAgICAgaWYobGluaykge1xuICAgICAgICBsZXQgZWxlbSA9IHJlbmRlcmVyLnRyZWVbbGluay5faWRdO1xuICAgICAgICBsZXQgY29vcmRzID0gY20uY3Vyc29yQ29vcmRzKHRydWUsIFwicGFnZVwiKTtcbiAgICAgICAgbmF2aWdhdGUoe2NsaWVudFg6IGNvb3Jkcy5sZWZ0LCBjbGllbnRZOiBjb29yZHMudG9wLCBwcmV2ZW50RGVmYXVsdDogKCk9Pnt9fSwgZWxlbSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbnZhciBhY3RpdmVDZWxscyA9IHt9O1xuXG5hcHBIYW5kbGUoXCJjbGVhckFjdGl2ZUNlbGxzXCIsIChjaGFuZ2VzLCBpbmZvKSA9PiB7XG4gIGZvcihsZXQgY2VsbCBpbiBhY3RpdmVDZWxscykge1xuICAgIGNoYW5nZXMuZGlzcGF0Y2goXCJyZW1vdmVBY3RpdmVDZWxsXCIsIGFjdGl2ZUNlbGxzW2NlbGxdKTtcbiAgfVxufSk7XG5cbmFwcEhhbmRsZShcImFkZEFjdGl2ZUNlbGxcIiwgKGNoYW5nZXMsIGluZm8pID0+IHtcbiAgY2hhbmdlcy5kaXNwYXRjaChcImNsZWFyQWN0aXZlQ2VsbHNcIiwge30pO1xuICBsZXQge2lkfSA9IGluZm87XG4gIGluZm8uc2VsZWN0ZWQgPSAwO1xuICBhY3RpdmVDZWxsc1tpZF0gPSBpbmZvO1xufSk7XG5cbmFwcEhhbmRsZShcInJlbW92ZUFjdGl2ZUNlbGxcIiwgKGNoYW5nZXMsIGluZm8pID0+IHtcbiAgbGV0IHtpZH0gPSBpbmZvO1xuICBkZWxldGUgYWN0aXZlQ2VsbHNbaWRdO1xufSk7XG5cbmFwcEhhbmRsZShcInNldENlbGxTdGF0ZVwiLCAoY2hhbmdlcywgaW5mbykgPT4ge1xuICBsZXQgYWN0aXZlID0gYWN0aXZlQ2VsbHNbaW5mby5pZF07XG4gIGFjdGl2ZS5zZWxlY3RlZCA9IDA7XG4gIGFjdGl2ZS5zdGF0ZSA9IGluZm8uc3RhdGU7XG59KTtcblxuYXBwSGFuZGxlKFwidXBkYXRlQWN0aXZlQ2VsbFwiLCAoY2hhbmdlcywgaW5mbykgPT4ge1xuICBsZXQgYWN0aXZlID0gYWN0aXZlQ2VsbHNbaW5mby5pZF07XG4gIGFjdGl2ZS5xdWVyeSA9IGluZm8ucXVlcnk7XG4gIGFjdGl2ZS5zZWxlY3RlZCA9IDA7XG4gIGFjdGl2ZS5zdGF0ZSA9IFwicXVlcnlcIjtcbn0pO1xuXG5hcHBIYW5kbGUoXCJtb3ZlQ2VsbEF1dG9jb21wbGV0ZVwiLCAoY2hhbmdlcywgaW5mbykgPT4ge1xuICBsZXQgYWN0aXZlID0gYWN0aXZlQ2VsbHNbaW5mby5jZWxsLmlkXTtcbiAgbGV0IHtkaXJlY3Rpb24sIHZhbHVlfSA9IGluZm87XG4gIGlmKHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICBhY3RpdmUuc2VsZWN0ZWQgKz0gZGlyZWN0aW9uO1xuICB9IGVsc2Uge1xuICAgIGFjdGl2ZS5zZWxlY3RlZCA9IHZhbHVlO1xuICB9XG59KTtcblxuZnVuY3Rpb24gdXBkYXRlQWN0aXZlQ2VsbChldmVudCwgZWxlbSkge1xuICBsZXQge2NlbGx9ID0gZWxlbTtcbiAgZGlzcGF0Y2goXCJ1cGRhdGVBY3RpdmVDZWxsXCIsIHtpZDogY2VsbC5pZCwgY2VsbCwgcXVlcnk6IGV2ZW50LmN1cnJlbnRUYXJnZXQudGV4dENvbnRlbnR9KS5jb21taXQoKTtcbn1cblxuZnVuY3Rpb24gYWN0aXZhdGVDZWxsKGV2ZW50LCBlbGVtKSB7XG4gIGxldCB7Y2VsbH0gPSBlbGVtO1xuICBsZXQgcXVlcnkgPSBjZWxsLnF1ZXJ5LnNwbGl0KFwifFwiKVswXTtcbiAgZGlzcGF0Y2goXCJhZGRBY3RpdmVDZWxsXCIsIHtpZDogY2VsbC5pZCwgY2VsbCwgcXVlcnl9KS5jb21taXQoKTtcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlRW1iZWRQb3BvdXQoY20sIHBhbmVJZCkge1xuICBsZXQgY29vcmRzID0gY20uY3Vyc29yQ29vcmRzKFwiaGVhZFwiLCBcInBhZ2VcIik7XG4gIC8vIGRpc3BhdGNoKFwiY3JlYXRlRW1iZWRQb3BvdXRcIiwge3BhbmVJZCwgeDogY29vcmRzLmxlZnQsIHk6IGNvb3Jkcy50b3AgLSAyMH0pLmNvbW1pdCgpO1xuICBjbS5vcGVyYXRpb24oKCkgPT4ge1xuICAgIGxldCBmcm9tID0gY20uZ2V0Q3Vyc29yKFwiZnJvbVwiKTtcbiAgICBsZXQgaWQgPSB1dWlkKCk7XG4gICAgY20ucmVwbGFjZVJhbmdlKFwiPVwiLCBmcm9tLCBjbS5nZXRDdXJzb3IoXCJ0b1wiKSk7XG4gICAgaWYoZnJvbS5saW5lID09PSAwKSByZXR1cm47XG4gICAgbGV0IHRvID0gY20ucG9zRnJvbUluZGV4KGNtLmdldEN1cnNvcihcImZyb21cIikpO1xuICAgIGxldCBmcm9tSXggPSBjbS5pbmRleEZyb21Qb3MoZnJvbSk7XG4gICAgbGV0IHRvSXggPSBjbS5pbmRleEZyb21Qb3ModG8pO1xuICAgIGxldCBjZWxsID0ge2lkLCBzdGFydDogZnJvbUl4LCBsZW5ndGg6IHRvSXggLSBmcm9tSXgsIHBsYWNlaG9sZGVyOiB0cnVlLCBxdWVyeTogXCJcIiwgcGFuZUlkfTtcbiAgICBkaXNwYXRjaChcImFkZEFjdGl2ZUNlbGxcIiwge2lkLCBxdWVyeTogXCJcIiwgY2VsbCwgcGxhY2Vob2xkZXI6IHRydWV9KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIG1ha2VEb0VtYmVkRnVuY3Rpb24oY20sIG1hcmssIGNlbGwsIHBhbmVJZCkge1xuICByZXR1cm4gKHZhbHVlKSA9PiB7XG4gICAgbGV0IHtmcm9tLCB0b30gPSBtYXJrLmZpbmQoKTtcbiAgICBpZih2YWx1ZVswXSA9PT0gXCI9XCIpIHtcbiAgICAgIHZhbHVlID0gdmFsdWUuc3Vic3RyaW5nKDEpO1xuICAgIH1cbiAgICB2YWx1ZSA9IHZhbHVlLnRyaW0oKTtcbiAgICBsZXQgW3RleHQsIHJhd1BhcmFtc10gPSB2YWx1ZS5zcGxpdChcInxcIik7XG4gICAgdGV4dCA9IHRleHQudHJpbSgpO1xuICAgIC8vIEBUT0RPOiB0aGlzIGRvZXNuJ3QgdGFrZSBkaXNhbWJpZ3VhdGlvbnMgaW50byBhY2NvdW50XG4gICAgbGV0IGRpc3BsYXkgPSBldmUuZmluZE9uZShcImRpc3BsYXkgbmFtZVwiLCB7bmFtZTogdGV4dH0pO1xuICAgIGlmKGRpc3BsYXkpIHtcbiAgICAgIHRleHQgPSBkaXNwbGF5LmlkO1xuICAgIH1cbiAgICBsZXQgcmVwbGFjZW1lbnQgPSBgeyR7dGV4dH18JHtyYXdQYXJhbXMgfHwgXCJcIn19YDtcbiAgICBpZih0ZXh0ID09PSBcIlwiKSB7XG4gICAgICByZXBsYWNlbWVudCA9IFwiXCI7XG4gICAgfVxuICAgIGlmKGNtLmdldFJhbmdlKGZyb20sIHRvKSAhPT0gcmVwbGFjZW1lbnQpIHtcbiAgICAgIGNtLnJlcGxhY2VSYW5nZShyZXBsYWNlbWVudCwgZnJvbSwgdG8pO1xuICAgIH1cbiAgICBwYW5lRWRpdG9yc1twYW5lSWRdLmNtSW5zdGFuY2UuZm9jdXMoKTtcbiAgICBsZXQgY2hhaW4gPSBkaXNwYXRjaChcInJlbW92ZUFjdGl2ZUNlbGxcIiwgY2VsbCk7XG4gICAgaWYocmVwbGFjZW1lbnQpIHtcbiAgICAgIGNoYWluLmRpc3BhdGNoKFwiaW5zZXJ0IHF1ZXJ5XCIsIHtxdWVyeTogdGV4dH0pO1xuICAgIH1cbiAgICBjaGFpbi5jb21taXQoKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBlbWJlZGRlZENlbGxLZXlzKGV2ZW50LCBlbGVtKSB7XG4gIGxldCB7cGFuZUlkLCBjZWxsfSA9IGVsZW07XG4gIGxldCB0YXJnZXQgPSBldmVudC5jdXJyZW50VGFyZ2V0O1xuICBsZXQgdmFsdWUgPSB0YXJnZXQudGV4dENvbnRlbnQ7XG4gIGxldCBlZGl0b3IgPSBwYW5lRWRpdG9yc1twYW5lSWRdO1xuICBsZXQgY20gPSBlZGl0b3IuY21JbnN0YW5jZTtcbiAgbGV0IG1hcmsgPSBlZGl0b3IubWFya3NbY2VsbC5pZF07XG4gIGlmKGV2ZW50LmtleUNvZGUgPT09IEtFWVMuQkFDS1NQQUNFICYmIHZhbHVlID09PSBcIlwiKSB7XG4gICAgbGV0IHtmcm9tLCB0b30gPSBtYXJrLmZpbmQoKTtcbiAgICBjbS5yZXBsYWNlUmFuZ2UoXCJcIiwgZnJvbSwgdG8pO1xuICAgIHBhbmVFZGl0b3JzW3BhbmVJZF0uY21JbnN0YW5jZS5mb2N1cygpO1xuICAgIGRpc3BhdGNoKFwicmVtb3ZlQWN0aXZlQ2VsbFwiLCBjZWxsKS5jb21taXQoKTtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB9IGVsc2UgaWYoZXZlbnQua2V5Q29kZSA9PT0gS0VZUy5FU0MgfHwgKGV2ZW50LmtleUNvZGUgPT09IEtFWVMuRU5URVIgJiYgdmFsdWUudHJpbSgpID09PSBcIlwiKSkge1xuICAgIGxldCB7ZnJvbSwgdG99ID0gbWFyay5maW5kKCk7XG4gICAgaWYoY2VsbC5wbGFjZWhvbGRlcikge1xuICAgICAgY20ucmVwbGFjZVJhbmdlKFwiPSBcIiwgZnJvbSwgdG8pO1xuICAgIH1cbiAgICBwYW5lRWRpdG9yc1twYW5lSWRdLmNtSW5zdGFuY2UuZm9jdXMoKTtcbiAgICBkaXNwYXRjaChcInJlbW92ZUFjdGl2ZUNlbGxcIiwgY2VsbCkuY29tbWl0KCk7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgfSBlbHNlIGlmKGV2ZW50LmtleUNvZGUgPT09IEtFWVMuRU5URVIpIHtcbiAgICBsZXQgZG9FbWJlZCA9IG1ha2VEb0VtYmVkRnVuY3Rpb24oY20sIG1hcmssIGNlbGwsIHBhbmVJZCk7XG4gICAgaWYoZWxlbS5zZWxlY3RlZCAmJiBlbGVtLnNlbGVjdGVkLmFjdGlvbikge1xuICAgICAgaWYodHlwZW9mIGVsZW0uc2VsZWN0ZWQuYWN0aW9uID09PSBcImZ1bmN0aW9uXCIpIHtcbiAgICAgICAgZWxlbS5zZWxlY3RlZC5hY3Rpb24oZWxlbSwgdmFsdWUsIGRvRW1iZWQpO1xuICAgICAgfVxuICAgIH1cbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB9IGVsc2UgaWYoZXZlbnQua2V5Q29kZSA9PT0gS0VZUy5VUCkge1xuICAgIGRpc3BhdGNoKFwibW92ZUNlbGxBdXRvY29tcGxldGVcIiwge2NlbGwsIGRpcmVjdGlvbjotMX0pLmNvbW1pdCgpO1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIH0gZWxzZSBpZihldmVudC5rZXlDb2RlID09PSBLRVlTLkRPV04pIHtcbiAgICBkaXNwYXRjaChcIm1vdmVDZWxsQXV0b2NvbXBsZXRlXCIsIHtjZWxsLCBkaXJlY3Rpb246MX0pLmNvbW1pdCgpO1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIH1cbiAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG59XG5cbmZ1bmN0aW9uIHVwZGF0ZVBhZ2UobWV0YSwgY29udGVudCkge1xuICAgIGRpc3BhdGNoKFwidXBkYXRlIHBhZ2VcIiwge3BhZ2U6IG1ldGEucGFnZSwgY29udGVudH0pLmNvbW1pdCgpO1xufVxuXG5mdW5jdGlvbiBuYXZpZ2F0ZShldmVudCwgZWxlbSkge1xuICBsZXQge3BhbmVJZH0gPSBlbGVtLmRhdGE7XG4gIGxldCBpbmZvOmFueSA9IHtwYW5lSWQsIHZhbHVlOiBlbGVtLmxpbmssIHBlZWs6IGVsZW0ucGVla307XG4gIGlmKGV2ZW50LmNsaWVudFgpIHtcbiAgICBpbmZvLnggPSBcImNhbGMoNTAlIC0gMzUwcHgpXCI7IFxuICAgIGluZm8ueSA9IGV2ZW50LmNsaWVudFk7XG4gIH1cbiAgZGlzcGF0Y2goXCJ1aSBzZXQgc2VhcmNoXCIsIGluZm8pLmNvbW1pdCgpO1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xufVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gUGFnZSBwYXJzaW5nXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5mdW5jdGlvbiBnZXRDZWxscyhjb250ZW50OiBzdHJpbmcsIHBhbmVJZCkge1xuICBsZXQgY2VsbHMgPSBbXTtcbiAgbGV0IGl4ID0gMDtcbiAgbGV0IGlkcyA9IHt9O1xuICBmb3IobGV0IHBhcnQgb2YgY29udGVudC5zcGxpdCgvKHtbXl0qP30pL2dtKSkge1xuICAgIGlmKHBhcnRbMF0gPT09IFwie1wiKSB7XG4gICAgICBsZXQgaWQgPSBwYXJ0O1xuICAgICAgaWYoIWlkc1twYXJ0XSkge1xuICAgICAgICBpZHNbcGFydF0gPSAyO1xuICAgICAgfSBlbHNlIGlmKGlkc1twYXJ0XSA+PSAyKSB7XG4gICAgICAgIGlkICs9IGlkc1twYXJ0XTtcbiAgICAgICAgaWRzW3BhcnRdKys7XG4gICAgICB9XG4gICAgICBsZXQgcGxhY2Vob2xkZXIgPSBmYWxzZTtcbiAgICAgIGlmKHBhcnQubWF0Y2goL1xce1xcJFxcJC4qXFwkXFwkXFx9LykpIHtcbiAgICAgICAgcGxhY2Vob2xkZXIgPSB0cnVlO1xuICAgICAgfVxuICAgICAgY2VsbHMucHVzaCh7c3RhcnQ6IGl4LCBsZW5ndGg6IHBhcnQubGVuZ3RoLCB2YWx1ZTogcGFydCwgcXVlcnk6IHBhcnQuc3Vic3RyaW5nKDEsIHBhcnQubGVuZ3RoIC0gMSksIGlkLCBwbGFjZWhvbGRlcn0pO1xuICAgIH1cbiAgICBpeCArPSBwYXJ0Lmxlbmd0aDtcbiAgfVxuICBmb3IobGV0IGFjdGl2ZSBpbiBhY3RpdmVDZWxscykge1xuICAgIGxldCBjZWxsID0gYWN0aXZlQ2VsbHNbYWN0aXZlXS5jZWxsO1xuICAgIGlmKGNlbGwucGxhY2Vob2xkZXIgJiYgY2VsbC5wYW5lSWQgPT09IHBhbmVJZCkge1xuICAgICAgY2VsbHMucHVzaChjZWxsKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGNlbGxzO1xufVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gQXR0cmlidXRlc1xuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZnVuY3Rpb24gc29ydE9uQXR0cmlidXRlKGEsIGIpIHtcbiAgbGV0IGFBdHRyID0gYS5lYXYuYXR0cmlidXRlO1xuICBsZXQgYkF0dHIgPSBiLmVhdi5hdHRyaWJ1dGU7XG4gIGlmKGFBdHRyIDwgYkF0dHIpIHJldHVybiAtMTtcbiAgaWYoYUF0dHIgPiBiQXR0cikgcmV0dXJuIDE7XG4gIHJldHVybiAwO1xufVxuXG5mdW5jdGlvbiBhdHRyaWJ1dGVzVUkoZW50aXR5SWQsIHBhbmVJZCkge1xuICB2YXIgZWF2cyA9IGV2ZS5maW5kKFwiZW50aXR5IGVhdnNcIiwge2VudGl0eTogZW50aXR5SWR9KTtcbiAgdmFyIGl0ZW1zID0gW107XG4gIGZvcihsZXQgZWF2IG9mIGVhdnMpIHtcbiAgICBsZXQge2VudGl0eSwgYXR0cmlidXRlLCB2YWx1ZX0gPSBlYXY7XG4gICAgbGV0IGZvdW5kID0gZXZlLmZpbmRPbmUoXCJnZW5lcmF0ZWQgZWF2XCIsIHtlbnRpdHksIGF0dHJpYnV0ZSwgdmFsdWV9KTtcbiAgICBsZXQgaXRlbTphbnkgPSB7ZWF2LCBpc01hbnVhbDogIWZvdW5kfTtcbiAgICBpZihmb3VuZCkge1xuICAgICAgaXRlbS5zb3VyY2VWaWV3ID0gZm91bmQuc291cmNlO1xuICAgIH1cbiAgICBpdGVtcy5wdXNoKGl0ZW0pO1xuICB9XG4gIGl0ZW1zLnNvcnQoc29ydE9uQXR0cmlidXRlKTtcbiAgbGV0IHN0YXRlID0gdWlTdGF0ZS53aWRnZXQuYXR0cmlidXRlc1tlbnRpdHlJZF0gfHwge307XG4gIGxldCBpeCA9IDA7XG4gIGxldCBsZW4gPSBpdGVtcy5sZW5ndGg7XG4gIGxldCB0YWJsZUNoaWxkcmVuID0gW107XG4gIHdoaWxlKGl4IDwgbGVuKSB7XG4gICAgbGV0IGl0ZW0gPSBpdGVtc1tpeF07XG4gICAgbGV0IGdyb3VwID0ge2NoaWxkcmVuOiBbXX07XG4gICAgbGV0IHN1Ykl0ZW0gPSBpdGVtO1xuICAgIHdoaWxlKGl4IDwgbGVuICYmIHN1Ykl0ZW0uZWF2LmF0dHJpYnV0ZSA9PT0gaXRlbS5lYXYuYXR0cmlidXRlKSB7XG4gICAgICBsZXQgY2hpbGQ6RWxlbWVudCA9IHtjOiBcInZhbHVlXCIsIGVhdjogc3ViSXRlbS5lYXYsIGNoaWxkcmVuOiBbXX07XG4gICAgICBsZXQgdmFsdWVVSTpFbGVtZW50ID0gc3ViSXRlbTtcbiAgICAgIGxldCByZWxhdGVkU291cmNlVmlldyA9IGZhbHNlO1xuICAgICAgdmFsdWVVSS52YWx1ZSA9IHN1Ykl0ZW0uZWF2LnZhbHVlO1xuICAgICAgdmFsdWVVSVtcInN1Ym1pdFwiXSA9IHN1Ym1pdEF0dHJpYnV0ZTtcbiAgICAgIHZhbHVlVUlbXCJlYXZcIl0gPSBzdWJJdGVtLmVhdjtcbiAgICAgIGlmKCFzdWJJdGVtLmlzTWFudWFsKSB7XG4gICAgICAgIGNoaWxkLmMgKz0gXCIgZ2VuZXJhdGVkXCI7XG4gICAgICAgIHJlbGF0ZWRTb3VyY2VWaWV3ID0gc3RhdGUuc291cmNlVmlldyA9PT0gc3ViSXRlbS5zb3VyY2VWaWV3O1xuICAgICAgICB2YWx1ZVVJLnRleHQgPSB2YWx1ZVVJLnZhbHVlO1xuICAgICAgICBpZihzdGF0ZS5hY3RpdmUgJiYgc3RhdGUuYWN0aXZlLl9faWQgPT09IHN1Ykl0ZW0uZWF2Ll9faWQpIHtcbiAgICAgICAgICBsZXQgcXVlcnkgPSBldmUuZmluZE9uZShcInF1ZXJ5IHRvIGlkXCIsIHtpZDogc3ViSXRlbS5zb3VyY2VWaWV3fSkucXVlcnk7XG4gICAgICAgICAgY2hpbGQuc3R5bGUgPSBcImJhY2tncm91bmQ6IHJlZDtcIjtcbiAgICAgICAgICB2YWx1ZVVJLnQgPSBcImlucHV0XCI7XG4gICAgICAgICAgdmFsdWVVSS52YWx1ZSA9IFwiPSBcIiArIHF1ZXJ5O1xuICAgICAgICAgIHZhbHVlVUlbXCJxdWVyeVwiXSA9IHZhbHVlVUkudmFsdWU7XG4gICAgICAgICAgdmFsdWVVSVtcInNvdXJjZVZpZXdcIl0gPSBzdWJJdGVtLnNvdXJjZVZpZXc7XG4gICAgICAgICAgdmFsdWVVSS5wb3N0UmVuZGVyID0gYXV0b0ZvY3VzO1xuICAgICAgICAgIHZhbHVlVUkudGV4dCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICBjaGlsZC5jaGlsZHJlbi5wdXNoKHZhbHVlVUkpO1xuICAgICAgICB9IGVsc2UgaWYocmVsYXRlZFNvdXJjZVZpZXcpIHtcbiAgICAgICAgICBjaGlsZC5zdHlsZSA9IFwiYmFja2dyb3VuZDogcmVkO1wiO1xuICAgICAgICAgIHZhbHVlVUkudGV4dCA9IFwiZWRpdGluZyBzZWFyY2guLi5cIjtcbiAgICAgICAgfVxuICAgICAgICBjaGlsZFtcInNvdXJjZVZpZXdcIl0gPSBzdWJJdGVtLnNvdXJjZVZpZXc7XG4gICAgICAgIGNoaWxkLmNsaWNrID0gc2V0QWN0aXZlQXR0cmlidXRlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsdWVVSS50ID0gXCJpbnB1dFwiO1xuICAgICAgfVxuICAgICAgbGV0IGRpc3BsYXkgPSBldmUuZmluZE9uZShcImRpc3BsYXkgbmFtZVwiLCB7aWQ6IHZhbHVlVUkudmFsdWV9KTtcbiAgICAgIGlmKGRpc3BsYXkgJiYgIXJlbGF0ZWRTb3VyY2VWaWV3KSB7XG4gICAgICAgIGlmKCFzdGF0ZS5hY3RpdmUgfHwgc3RhdGUuYWN0aXZlLl9faWQgIT09IHN1Ykl0ZW0uZWF2Ll9faWQpIHtcbiAgICAgICAgICBjaGlsZC5jaGlsZHJlbi5wdXNoKHtjOiBcImxpbmtcIiwgdGV4dDogZGlzcGxheS5uYW1lLCBkYXRhOiB7cGFuZUlkfSwgbGluazogZGlzcGxheS5pZCwgY2xpY2s6IG5hdmlnYXRlLCBwZWVrOiB0cnVlfSk7XG4gICAgICAgICAgY2hpbGQuY2xpY2sgPSBzZXRBY3RpdmVBdHRyaWJ1dGU7XG4gICAgICAgICAgdmFsdWVVSS50ID0gXCJkaXZcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB2YWx1ZVVJLnZhbHVlID0gYD0gJHtkaXNwbGF5Lm5hbWV9YDtcbiAgICAgICAgICB2YWx1ZVVJLnBvc3RSZW5kZXIgPSBhdXRvRm9jdXM7XG4gICAgICAgICAgY2hpbGQuY2hpbGRyZW4ucHVzaCh2YWx1ZVVJKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY2hpbGQuY2hpbGRyZW4ucHVzaCh2YWx1ZVVJKTtcbiAgICAgIH1cbiAgICAgIGlmKHZhbHVlVUkudCA9PT0gXCJpbnB1dFwiKSB7XG4gICAgICAgIHZhbHVlVUkua2V5ZG93biA9IGhhbmRsZUF0dHJpYnV0ZXNLZXk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjaGlsZC5jaGlsZHJlbi5wdXNoKHtjOiBcInNwYWNlciBuby1tb3VzZVwifSk7XG4gICAgICB9XG4gICAgICBjaGlsZC5jaGlsZHJlbi5wdXNoKHtjOiBcImlvbi1hbmRyb2lkLWNsb3NlIHJlbW92ZVwiLCBlYXY6IHN1Ykl0ZW0uZWF2LCBzb3VyY2VWaWV3OiBzdWJJdGVtLnNvdXJjZVZpZXcsIHF1ZXJ5OiB2YWx1ZVVJW1wicXVlcnlcIl0sIGNsaWNrOiByZW1vdmVTdWJJdGVtfSk7XG4gICAgICBncm91cC5jaGlsZHJlbi5wdXNoKGNoaWxkKTtcbiAgICAgIGl4Kys7XG4gICAgICBzdWJJdGVtID0gaXRlbXNbaXhdO1xuICAgIH1cbiAgICB0YWJsZUNoaWxkcmVuLnB1c2goe2lkOiBgJHtlbnRpdHlJZH18JHtwYW5lSWR9fCR7aXRlbS5lYXYuYXR0cmlidXRlfWAsIGM6IFwiYXR0cmlidXRlXCIsIGNoaWxkcmVuOiBbXG4gICAgICB7YzogXCJhdHRyaWJ1dGUtbmFtZVwiLCB0ZXh0OiBpdGVtLmVhdi5hdHRyaWJ1dGV9LFxuICAgICAgZ3JvdXAsXG4gICAgXX0pO1xuICB9XG4gIHRhYmxlQ2hpbGRyZW4ucHVzaCh7aWQ6IGAke2VudGl0eUlkfXwke3BhbmVJZH18YWRkZXJgLCBjOiBcImF0dHJpYnV0ZSBhZGRlclwiLCBjaGlsZHJlbjogW1xuICAgIHt0OiBcImlucHV0XCIsIGM6IFwiYXR0cmlidXRlLW5hbWUgdmFsdWVcIiwgcGxhY2Vob2xkZXI6IFwicHJvcGVydHlcIiwga2V5ZG93bjogaGFuZGxlQXR0cmlidXRlc0tleSwgaW5wdXQ6IHNldEFkZGVyLCBzdWJtaXQ6IHN1Ym1pdEFkZGVyLCBmaWVsZDogXCJhZGRlckF0dHJpYnV0ZVwiLCBlbnRpdHlJZCwgdmFsdWU6IHN0YXRlLmFkZGVyQXR0cmlidXRlfSxcbiAgICB7dDogXCJpbnB1dFwiLCBjOiBcInZhbHVlXCIsIHBsYWNlaG9sZGVyOiBcInZhbHVlXCIsIGtleWRvd246IGhhbmRsZUF0dHJpYnV0ZXNLZXksIGlucHV0OiBzZXRBZGRlciwgc3VibWl0OiBzdWJtaXRBZGRlciwgZmllbGQ6IFwiYWRkZXJWYWx1ZVwiLCBlbnRpdHlJZCwgdmFsdWU6IHN0YXRlLmFkZGVyVmFsdWV9LFxuICBdfSk7XG4gIHJldHVybiB7YzogXCJhdHRyaWJ1dGVzXCIsIGNoaWxkcmVuOiB0YWJsZUNoaWxkcmVufTtcbn1cblxuZnVuY3Rpb24gYXR0cmlidXRlc1VJQXV0b2NvbXBsZXRlT3B0aW9ucyhpc0VudGl0eSwgcGFyc2VkLCB0ZXh0LCBwYXJhbXMsIGVudGl0eUlkKSB7XG4gIGxldCBvcHRpb25zOntzY29yZTogbnVtYmVyLCBhY3Rpb246IGFueSwgdGV4dDogc3RyaW5nLCBbYXR0cjpzdHJpbmddOiBhbnl9W10gPSBbXTtcbiAgLy90aGVyZSBhcmUgdHdvIHBvc3NpYmxlIHRoaW5ncyBlaXRoZXIgd2UncmUgY3JlYXRpbmcgYSBwYWdlXG4gIC8vIG9yIHdlIG5lZWQgdG8gcGljayB3aGF0IGZpZWxkIG9mIHRoZSByZXN1bHQgd2Ugd2FudFxuICByZXR1cm4gb3B0aW9ucztcbn1cblxuYXBwSGFuZGxlKFwic2V0QWN0aXZlQXR0cmlidXRlXCIsIChjaGFuZ2VzOiBEaWZmLCB7ZWF2LCBzb3VyY2VWaWV3fSkgPT4ge1xuICBpZighdWlTdGF0ZS53aWRnZXQuYXR0cmlidXRlc1tlYXYuZW50aXR5XSkge1xuICAgIHVpU3RhdGUud2lkZ2V0LmF0dHJpYnV0ZXNbZWF2LmVudGl0eV0gPSB7fTtcbiAgfVxuICBsZXQgY3VyID0gdWlTdGF0ZS53aWRnZXQuYXR0cmlidXRlc1tlYXYuZW50aXR5XTtcbiAgY3VyLmFjdGl2ZSA9IGVhdjtcbiAgY3VyLnNvdXJjZVZpZXcgPSBzb3VyY2VWaWV3O1xufSk7XG5cbmFwcEhhbmRsZShcImNsZWFyQWN0aXZlQXR0cmlidXRlXCIsIChjaGFuZ2VzOiBEaWZmLCB7ZW50aXR5fSkgPT4ge1xuICBsZXQgY3VyID0gdWlTdGF0ZS53aWRnZXQuYXR0cmlidXRlc1tlbnRpdHldO1xuICBpZihjdXIpIHtcbiAgICBjdXIuYWN0aXZlID0gZmFsc2U7XG4gICAgY3VyLnNvdXJjZVZpZXcgPSBmYWxzZTtcbiAgfVxufSlcblxuZnVuY3Rpb24gcmVtb3ZlU3ViSXRlbShldmVudCwgZWxlbSkge1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICBzdWJtaXRBdHRyaWJ1dGUoZXZlbnQsIGVsZW0pO1xufVxuXG5mdW5jdGlvbiBzZXRBY3RpdmVBdHRyaWJ1dGUoZXZlbnQsIGVsZW0pIHtcbiAgaWYoIWV2ZW50LmRlZmF1bHRQcmV2ZW50ZWQpIHtcbiAgICBkaXNwYXRjaChcInNldEFjdGl2ZUF0dHJpYnV0ZVwiLCB7ZWF2OiBlbGVtLmVhdiwgc291cmNlVmlldzogZWxlbS5zb3VyY2VWaWV3fSkuY29tbWl0KCk7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBoYW5kbGVBdHRyaWJ1dGVzS2V5KGV2ZW50LCBlbGVtKSB7XG4gIGlmKGV2ZW50LmtleUNvZGUgPT09IEtFWVMuRU5URVIgJiYgZWxlbS5zdWJtaXQpIHtcbiAgICBlbGVtLnN1Ym1pdChldmVudCwgZWxlbSk7XG4gIH0gZWxzZSBpZihldmVudC5rZXlDb2RlID09PSBLRVlTLkVTQykge1xuICAgIGRpc3BhdGNoKFwic2V0QWN0aXZlQXR0cmlidXRlXCIsIHtlYXY6IHtlbnRpdHk6IGVsZW0uZWF2LmVudGl0eX0sIHNvdXJjZVZpZXc6IGZhbHNlfSkuY29tbWl0KCk7XG4gIH1cbn1cblxuYXBwSGFuZGxlKFwic2V0QXR0cmlidXRlQWRkZXJcIiwgKGNoYW5nZXM6RGlmZiwge2VudGl0eUlkLCBmaWVsZCwgdmFsdWV9KSA9PiB7XG4gIGxldCBjdXIgPSB1aVN0YXRlLndpZGdldC5hdHRyaWJ1dGVzW2VudGl0eUlkXTtcbiAgaWYoIXVpU3RhdGUud2lkZ2V0LmF0dHJpYnV0ZXNbZW50aXR5SWRdKSB7XG4gICAgY3VyID0gdWlTdGF0ZS53aWRnZXQuYXR0cmlidXRlc1tlbnRpdHlJZF0gPSB7fTtcbiAgfVxuICBjdXJbZmllbGRdID0gdmFsdWU7XG59KTtcblxuZnVuY3Rpb24gc2V0QWRkZXIoZXZlbnQsIGVsZW0pIHtcbiAgbGV0IHZhbHVlID0gZXZlbnQuY3VycmVudFRhcmdldC52YWx1ZTtcbiAgZGlzcGF0Y2goXCJzZXRBdHRyaWJ1dGVBZGRlclwiLCB7ZW50aXR5SWQ6IGVsZW0uZW50aXR5SWQsIGZpZWxkOiBlbGVtLmZpZWxkLCB2YWx1ZX0pLmNvbW1pdCgpO1xufVxuXG5mdW5jdGlvbiBzdWJtaXRBZGRlcihldmVudCwgZWxlbSkge1xuICBsZXQge2VudGl0eUlkfSA9IGVsZW07XG4gIGxldCBzdGF0ZSA9IHVpU3RhdGUud2lkZ2V0LmF0dHJpYnV0ZXNbZW50aXR5SWRdO1xuICBpZighc3RhdGUpIHJldHVybjtcbiAgbGV0IHthZGRlckF0dHJpYnV0ZSwgYWRkZXJWYWx1ZX0gPSBzdGF0ZTtcbiAgbGV0IHN1Y2Nlc3MgPSBmYWxzZTtcbiAgaWYoYWRkZXJBdHRyaWJ1dGUgJiYgYWRkZXJWYWx1ZSkge1xuICAgIGxldCBjaGFpbiA9IGRpc3BhdGNoKFwic2V0QXR0cmlidXRlQWRkZXJcIiwge2VudGl0eUlkLCBmaWVsZDogXCJhZGRlckF0dHJpYnV0ZVwiLCB2YWx1ZTogXCJcIn0pXG4gICAgICAgICAgICAgICAgLmRpc3BhdGNoKFwic2V0QXR0cmlidXRlQWRkZXJcIiwge2VudGl0eUlkLCBmaWVsZDogXCJhZGRlclZhbHVlXCIsIHZhbHVlOiBcIlwifSk7XG4gICAgc3VjY2VzcyA9IGhhbmRsZUF0dHJpYnV0ZURlZmluaXRpb24oZW50aXR5SWQsIGFkZGVyQXR0cmlidXRlLCBhZGRlclZhbHVlLCBjaGFpbik7XG4gIH1cbiAgLy9tYWtlIHN1cmUgdGhlIGZvY3VzIGVuZHMgdXAgYmFjayBpbiB0aGUgcHJvcGVydHkgaW5wdXRcbiAgZXZlbnQuY3VycmVudFRhcmdldC5wYXJlbnROb2RlLmZpcnN0Q2hpbGQuZm9jdXMoKTtcbiAgcmV0dXJuIHN1Y2Nlc3M7XG59XG5cbmFwcEhhbmRsZShcInJlbW92ZSBhdHRyaWJ1dGUgZ2VuZXJhdGluZyBxdWVyeVwiLCAoY2hhbmdlczpEaWZmLCB7ZWF2LCB2aWV3fSkgPT4ge1xuICBsZXQgcXVlcnlJZCA9IGAke2Vhdi5lbnRpdHl9fCR7ZWF2LmF0dHJpYnV0ZX18JHt2aWV3fWA7XG4gIGV2ZS5yZW1vdmVWaWV3KHF1ZXJ5SWQpXG4gIGNoYW5nZXMubWVyZ2UoUXVlcnkucmVtb3ZlKHF1ZXJ5SWQsIGV2ZSkpO1xuICAvL2ZpbmQgYWxsIHRoZSB1bmlvbnMgdGhpcyB3YXMgdXNlZCB3aXRoXG4gIGZvcihsZXQgc291cmNlIG9mIGV2ZS5maW5kKFwiYWN0aW9uIHNvdXJjZVwiLCB7XCJzb3VyY2Ugdmlld1wiOiBxdWVyeUlkfSkpIHtcbiAgICBsZXQgYWN0aW9uID0gc291cmNlLmFjdGlvbjtcbiAgICBjaGFuZ2VzLnJlbW92ZShcImFjdGlvblwiLCB7YWN0aW9ufSk7XG4gICAgY2hhbmdlcy5yZW1vdmUoXCJhY3Rpb24gbWFwcGluZ1wiLCB7YWN0aW9ufSk7XG4gICAgY2hhbmdlcy5yZW1vdmUoXCJhY3Rpb24gbWFwcGluZyBjb25zdGFudFwiLCB7YWN0aW9ufSk7XG4gIH1cbiAgY2hhbmdlcy5yZW1vdmUoXCJhY3Rpb24gc291cmNlXCIsIHtzb3VyY2U6IHF1ZXJ5SWR9KTtcbn0pO1xuXG5mdW5jdGlvbiBzdWJtaXRBdHRyaWJ1dGUoZXZlbnQsIGVsZW0pIHtcbiAgbGV0IHtlYXYsIHNvdXJjZVZpZXcsIHF1ZXJ5fSA9IGVsZW07XG4gIGxldCBjaGFpbiA9IGRpc3BhdGNoKFwiY2xlYXJBY3RpdmVBdHRyaWJ1dGVcIiwge2VudGl0eTogZWF2LmVudGl0eX0pO1xuICBsZXQgdmFsdWUgPSAgZXZlbnQuY3VycmVudFRhcmdldC52YWx1ZTtcbiAgaWYocXVlcnkgIT09IHVuZGVmaW5lZCAmJiB2YWx1ZSA9PT0gcXVlcnkpIHtcbiAgICByZXR1cm4gY2hhaW4uY29tbWl0KCk7XG4gIH1cbiAgaWYoZWxlbS5zb3VyY2VWaWV3ICE9PSB1bmRlZmluZWQpIHtcbiAgICAvL3JlbW92ZSB0aGUgcHJldmlvdXMgc291cmNlXG4gICAgY2hhaW4uZGlzcGF0Y2goXCJyZW1vdmUgYXR0cmlidXRlIGdlbmVyYXRpbmcgcXVlcnlcIiwge2Vhdiwgdmlldzogc291cmNlVmlld30pO1xuICB9IGVsc2Uge1xuICAgIC8vcmVtb3ZlIHRoZSBwcmV2aW91cyBlYXZcbiAgICBsZXQgZmFjdCA9IGNvcHkoZWF2KTtcbiAgICBmYWN0Ll9faWQgPSB1bmRlZmluZWQ7XG4gICAgY2hhaW4uZGlzcGF0Y2goXCJyZW1vdmUgZW50aXR5IGF0dHJpYnV0ZVwiLCBmYWN0KTtcbiAgfVxuICBpZih2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHZhbHVlICE9PSBcIlwiKSB7XG4gICAgcmV0dXJuIGhhbmRsZUF0dHJpYnV0ZURlZmluaXRpb24oZWF2LmVudGl0eSwgZWF2LmF0dHJpYnV0ZSwgdmFsdWUsIGNoYWluKTtcbiAgfSBlbHNlIHtcbiAgICBjaGFpbi5jb21taXQoKTtcbiAgfVxufVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gV2lraSBXaWRnZXRzXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZXhwb3J0IGZ1bmN0aW9uIHNlYXJjaElucHV0KHBhbmVJZDpzdHJpbmcsIHZhbHVlOnN0cmluZyk6RWxlbWVudCB7XG4gIGxldCBkaXNwbGF5ID0gZXZlLmZpbmRPbmUoXCJkaXNwbGF5IG5hbWVcIiwge2lkOiB2YWx1ZX0pO1xuICBsZXQgbmFtZSA9IHZhbHVlO1xuICBpZihkaXNwbGF5KSB7XG4gICAgbmFtZSA9IGRpc3BsYXkubmFtZTtcbiAgfVxuICBsZXQgc3RhdGUgPSB1aVN0YXRlLndpZGdldC5zZWFyY2hbcGFuZUlkXSB8fCB7Zm9jdXNlZDogZmFsc2UsIHBsYW46IGZhbHNlfTtcbiAgcmV0dXJuIHtcbiAgICBjOiBcImZsZXgtZ3JvdyB3aWtpLXNlYXJjaC13cmFwcGVyXCIsXG4gICAgY2hpbGRyZW46IFtcbiAgICAgIGNvZGVNaXJyb3JFbGVtZW50KHtcbiAgICAgICAgYzogYGZsZXgtZ3JvdyB3aWtpLXNlYXJjaC1pbnB1dCAke3N0YXRlLmZvY3VzZWQgPyBcInNlbGVjdGVkXCI6IFwiXCJ9YCxcbiAgICAgICAgcGFuZUlkLFxuICAgICAgICB2YWx1ZTogbmFtZSxcbiAgICAgICAgZm9jdXM6IGZvY3VzU2VhcmNoLFxuICAgICAgICBibHVyOiBzZXRTZWFyY2gsXG4gICAgICAgIC8vIGNoYW5nZTogdXBkYXRlU2VhcmNoLFxuICAgICAgICBzaG9ydGN1dHM6IHtcIkVudGVyXCI6IHNldFNlYXJjaH1cbiAgICAgIH0pLFxuICAgICAge2M6IFwiY29udHJvbHNcIiwgY2hpbGRyZW46IFtcbiAgICAgICAge2M6IGBpb24taW9zLWFycm93LSR7c3RhdGUucGxhbiA/ICd1cCcgOiAnZG93bid9IHBsYW5gLCBjbGljazogdG9nZ2xlU2VhcmNoUGxhbiwgcGFuZUlkfSxcbiAgICAgICAgLy8gd2hpbGUgdGVjaG5pY2FsbHkgYSBidXR0b24sIHdlIGRvbid0IG5lZWQgdG8gZG8gYW55dGhpbmcgYXMgY2xpY2tpbmcgaXQgd2lsbCBibHVyIHRoZSBlZGl0b3JcbiAgICAgICAgLy8gd2hpY2ggd2lsbCBleGVjdXRlIHRoZSBzZWFyY2hcbiAgICAgICAge2M6IFwiaW9uLWFuZHJvaWQtc2VhcmNoIHZpc2libGVcIiwgcGFuZUlkfVxuICAgICAgXX0sXG4gICAgXVxuICB9O1xufTtcblxuZnVuY3Rpb24gZm9jdXNTZWFyY2goZXZlbnQsIGVsZW0pIHtcbiAgZGlzcGF0Y2goXCJ1aSBmb2N1cyBzZWFyY2hcIiwgZWxlbSkuY29tbWl0KCk7XG59XG5mdW5jdGlvbiBzZXRTZWFyY2goZXZlbnQsIGVsZW0pIHtcbiAgbGV0IHZhbHVlID0gZXZlbnQudmFsdWU7XG4gIGxldCBwYW5lID0gZXZlLmZpbmRPbmUoXCJ1aSBwYW5lXCIsIHtwYW5lOiBlbGVtLnBhbmVJZH0pO1xuICBpZighcGFuZSB8fCBwYW5lLmNvbnRhaW5zICE9PSBldmVudC52YWx1ZSkge1xuICAgIGRpc3BhdGNoKFwiaW5zZXJ0IHF1ZXJ5XCIsIHtxdWVyeTogdmFsdWV9KVxuICAgICAgLmRpc3BhdGNoKFwidWkgc2V0IHNlYXJjaFwiLCB7cGFuZUlkOiBlbGVtLnBhbmVJZCwgdmFsdWU6IGV2ZW50LnZhbHVlfSlcbiAgICAgIC5jb21taXQoKTtcbiAgfVxufVxuZnVuY3Rpb24gdXBkYXRlU2VhcmNoKGV2ZW50LCBlbGVtKSB7XG4gIGRpc3BhdGNoKFwidWkgdXBkYXRlIHNlYXJjaFwiLCBlbGVtKS5jb21taXQoKTtcbn1cbmZ1bmN0aW9uIHRvZ2dsZVNlYXJjaFBsYW4oZXZlbnQsIGVsZW0pIHtcbiAgZGlzcGF0Y2goXCJ1aSB0b2dnbGUgc2VhcmNoIHBsYW5cIiwgZWxlbSkuY29tbWl0KCk7XG59XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBVSVRLXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuaW50ZXJmYWNlIENNTm9kZSBleHRlbmRzIEhUTUxFbGVtZW50IHsgY206IGFueSB9XG5pbnRlcmZhY2UgQ01FbGVtZW50IGV4dGVuZHMgRWxlbWVudCB7XG4gIGF1dG9mb2N1cz86IGJvb2xlYW5cbiAgbGluZU51bWJlcnM/OiBib29sZWFuLFxuICBsaW5lV3JhcHBpbmc/OiBib29sZWFuLFxuICBtb2RlPzogc3RyaW5nLFxuICBzaG9ydGN1dHM/OiB7W3Nob3J0Y3V0OnN0cmluZ106IEhhbmRsZXI8YW55Pn1cbn07XG5pbnRlcmZhY2UgQ01FdmVudCBleHRlbmRzIEV2ZW50IHtcbiAgZWRpdG9yOiBDb2RlTWlycm9yLkVkaXRvclxuICB2YWx1ZTogc3RyaW5nXG59XG5leHBvcnQgZnVuY3Rpb24gY29kZU1pcnJvckVsZW1lbnQoZWxlbTpDTUVsZW1lbnQpOkNNRWxlbWVudCB7XG4gIGVsZW0ucG9zdFJlbmRlciA9IGNvZGVNaXJyb3JQb3N0UmVuZGVyKGVsZW0ucG9zdFJlbmRlcik7XG4gIHJldHVybiBlbGVtO1xufVxuXG5sZXQgX2NvZGVNaXJyb3JQb3N0UmVuZGVyTWVtbyA9IHt9O1xuZnVuY3Rpb24gaGFuZGxlQ01FdmVudChoYW5kbGVyOkhhbmRsZXI8RXZlbnQ+LCBlbGVtOkNNRWxlbWVudCk6KGNtOkNvZGVNaXJyb3IuRWRpdG9yKSA9PiB2b2lkIHtcbiAgcmV0dXJuIChjbTpDb2RlTWlycm9yLkVkaXRvcikgPT4ge1xuICAgIGxldCBldnQgPSA8Q01FdmVudD48YW55PihuZXcgQ3VzdG9tRXZlbnQoXCJDTUV2ZW50XCIpKTtcbiAgICBldnQuZWRpdG9yID0gY207XG4gICAgZXZ0LnZhbHVlID0gY20uZ2V0RG9jKCkuZ2V0VmFsdWUoKTtcbiAgICBoYW5kbGVyKGV2dCwgZWxlbSk7XG4gIH1cbn1cbmZ1bmN0aW9uIGNvZGVNaXJyb3JQb3N0UmVuZGVyKHBvc3RSZW5kZXI/OlJlbmRlckhhbmRsZXIpOlJlbmRlckhhbmRsZXIge1xuICBsZXQga2V5ID0gcG9zdFJlbmRlciA/IHBvc3RSZW5kZXIudG9TdHJpbmcoKSA6IFwiXCI7XG4gIGlmKF9jb2RlTWlycm9yUG9zdFJlbmRlck1lbW9ba2V5XSkgcmV0dXJuIF9jb2RlTWlycm9yUG9zdFJlbmRlck1lbW9ba2V5XTtcbiAgcmV0dXJuIF9jb2RlTWlycm9yUG9zdFJlbmRlck1lbW9ba2V5XSA9IChub2RlOkNNTm9kZSwgZWxlbTpDTUVsZW1lbnQpID0+IHtcbiAgICBsZXQgY20gPSBub2RlLmNtO1xuICAgIGlmKCFjbSkge1xuICAgICAgbGV0IGV4dHJhS2V5cyA9IHt9O1xuICAgICAgaWYoZWxlbS5zaG9ydGN1dHMpIHtcbiAgICAgICAgZm9yKGxldCBzaG9ydGN1dCBpbiBlbGVtLnNob3J0Y3V0cylcbiAgICAgICAgICBleHRyYUtleXNbc2hvcnRjdXRdID0gaGFuZGxlQ01FdmVudChlbGVtLnNob3J0Y3V0c1tzaG9ydGN1dF0sIGVsZW0pO1xuICAgICAgfVxuICAgICAgY20gPSBub2RlLmNtID0gQ29kZU1pcnJvcihub2RlLCB7XG4gICAgICAgIGxpbmVXcmFwcGluZzogZWxlbS5saW5lV3JhcHBpbmcgIT09IGZhbHNlID8gdHJ1ZSA6IGZhbHNlLFxuICAgICAgICBsaW5lTnVtYmVyczogZWxlbS5saW5lTnVtYmVycyxcbiAgICAgICAgbW9kZTogZWxlbS5tb2RlIHx8IFwidGV4dFwiLFxuICAgICAgICBleHRyYUtleXNcbiAgICAgIH0pO1xuICAgICAgaWYoZWxlbS5jaGFuZ2UpIGNtLm9uKFwiY2hhbmdlXCIsIGhhbmRsZUNNRXZlbnQoZWxlbS5jaGFuZ2UsIGVsZW0pKTtcbiAgICAgIGlmKGVsZW0uYmx1cikgY20ub24oXCJibHVyXCIsIGhhbmRsZUNNRXZlbnQoZWxlbS5ibHVyLCBlbGVtKSk7XG4gICAgICBpZihlbGVtLmZvY3VzKSBjbS5vbihcImZvY3VzXCIsIGhhbmRsZUNNRXZlbnQoZWxlbS5mb2N1cywgZWxlbSkpO1xuICAgICAgaWYoZWxlbS5hdXRvZm9jdXMpIGNtLmZvY3VzKCk7XG4gICAgfVxuXG4gICAgaWYoY20uZ2V0RG9jKCkuZ2V0VmFsdWUoKSAhPT0gZWxlbS52YWx1ZSkgY20uc2V0VmFsdWUoZWxlbS52YWx1ZSB8fCBcIlwiKTtcbiAgICBpZihwb3N0UmVuZGVyKSBwb3N0UmVuZGVyKG5vZGUsIGVsZW0pO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdldEVudGl0aWVzRnJvbVJlc3VsdHMocmVzdWx0czp7W2ZpZWxkOnN0cmluZ106IGFueX1bXSwge2ZpZWxkcyA9IFtcImVudGl0eVwiXX0gPSB7fSk6c3RyaW5nW10ge1xuICBsZXQgZW50aXRpZXMgPSBbXTtcbiAgaWYoIXJlc3VsdHMubGVuZ3RoKSByZXR1cm4gZW50aXRpZXM7XG5cbiAgZm9yKGxldCBmaWVsZCBvZiBmaWVsZHMpIHtcbiAgICBpZihyZXN1bHRzWzBdW2ZpZWxkXSA9PT0gdW5kZWZpbmVkKSBmaWVsZCA9IGJ1aWx0aW5JZChmaWVsZCk7XG4gICAgZm9yKGxldCBmYWN0IG9mIHJlc3VsdHMpIGVudGl0aWVzLnB1c2goZmFjdFtmaWVsZF0pO1xuICB9XG4gIHJldHVybiBlbnRpdGllcztcbn1cbmZ1bmN0aW9uIGdldFVSTHNGcm9tUmVzdWx0cyhyZXN1bHRzOntbZmllbGQ6c3RyaW5nXTogYW55fVtdLCB7ZmllbGRzID0gW1widXJsXCJdfSA9IHt9KTpzdHJpbmdbXSB7XG4gIGxldCB1cmxzID0gW107XG4gIGlmKCFyZXN1bHRzLmxlbmd0aCkgcmV0dXJuIHVybHM7XG5cbiAgZm9yKGxldCBmaWVsZCBvZiBmaWVsZHMpIHtcbiAgICBpZihyZXN1bHRzWzBdW2ZpZWxkXSA9PT0gdW5kZWZpbmVkKSBmaWVsZCA9IGJ1aWx0aW5JZChmaWVsZCk7XG4gICAgZm9yKGxldCBmYWN0IG9mIHJlc3VsdHMpIHtcbiAgICAgIGlmKHVybFJlZ2V4LmV4ZWMoZmFjdFtmaWVsZF0pKSB1cmxzLnB1c2goZmFjdFtmaWVsZF0pO1xuICAgIH1cbiAgfVxuICByZXR1cm4gdXJscztcbn1cblxuZnVuY3Rpb24gcHJlcGFyZUVudGl0eShyZXN1bHRzOnt9W10sIHBhcmFtczp7ZmllbGQ/OnN0cmluZ30pIHtcbiAgbGV0IGVsZW0gPSB7fTtcbiAgbGV0IGVudGl0aWVzID0gZ2V0RW50aXRpZXNGcm9tUmVzdWx0cyhyZXN1bHRzLCB7ZmllbGRzOiBwYXJhbXMuZmllbGQgPyBbcGFyYW1zLmZpZWxkXSA6IHVuZGVmaW5lZH0pO1xuICBsZXQgZWxlbXMgPSBbXTtcbiAgZm9yKGxldCBlbnRpdHkgb2YgZW50aXRpZXMpIHtcbiAgICBsZXQgZWxlbSA9IGNvcHkocGFyYW1zKTtcbiAgICBlbGVtLmVudGl0eSA9IGVudGl0eTtcbiAgICBlbGVtcy5wdXNoKGVsZW0pO1xuICB9XG4gIGlmKGVsZW1zLmxlbmd0aCA9PT0gMSkgcmV0dXJuIGVsZW1zWzBdO1xuICBlbHNlIHJldHVybiBlbGVtcztcbn1cbmZ1bmN0aW9uIHByZXBhcmVVUkwocmVzdWx0czp7fVtdLCBwYXJhbXM6e2ZpZWxkPzpzdHJpbmd9KSB7XG4gIGxldCBlbGVtID0ge307XG4gIGxldCB1cmxzID0gZ2V0VVJMc0Zyb21SZXN1bHRzKHJlc3VsdHMsIHtmaWVsZHM6IHBhcmFtcy5maWVsZCA/IFtwYXJhbXMuZmllbGRdIDogdW5kZWZpbmVkfSk7XG4gIGxldCBlbGVtcyA9IFtdO1xuICBmb3IobGV0IHVybCBvZiB1cmxzKSB7XG4gICAgbGV0IGVsZW0gPSBjb3B5KHBhcmFtcyk7XG4gICAgZWxlbS51cmwgPSB1cmw7XG4gICAgZWxlbXMucHVzaChlbGVtKTtcbiAgfVxuICBpZihlbGVtcy5sZW5ndGggPT09IDEpIHJldHVybiBlbGVtc1swXTtcbiAgZWxzZSByZXR1cm4gZWxlbXM7XG59XG5cbmxldCBfcHJlcGFyZTp7W3JlcDpzdHJpbmddOiAocmVzdWx0czp7fVtdLCBwYXJhbXM6e3BhbmVJZD86c3RyaW5nLCBbcDpzdHJpbmddOiBhbnl9KSA9PiBhbnl9ID0ge1xuICBuYW1lOiBwcmVwYXJlRW50aXR5LFxuICBsaW5rOiBwcmVwYXJlRW50aXR5LFxuICBhdHRyaWJ1dGVzOiBwcmVwYXJlRW50aXR5LFxuICByZWxhdGVkOiBwcmVwYXJlRW50aXR5LFxuICBpbmRleDogcHJlcGFyZUVudGl0eSxcbiAgdmlldzogcHJlcGFyZUVudGl0eSxcbiAgcmVzdWx0czogcHJlcGFyZUVudGl0eSxcblxuICB2YWx1ZShyZXN1bHRzLCBwYXJhbXM6e2ZpZWxkOnN0cmluZywgZGF0YT86e319KSB7XG4gICAgaWYoIXBhcmFtcy5maWVsZCkgdGhyb3cgbmV3IEVycm9yKFwiVmFsdWUgcmVwcmVzZW50YXRpb24gcmVxdWlyZXMgYSAnZmllbGQnIHBhcmFtIGluZGljYXRpbmcgd2hpY2ggZmllbGQgdG8gcmVwcmVzZW50XCIpO1xuICAgIGxldCBmaWVsZCA9IHBhcmFtcy5maWVsZDtcbiAgICBpZighcmVzdWx0cy5sZW5ndGgpIHJldHVybiBbXTtcblxuICAgIC8vIElmIGZpZWxkIGlzbid0IGluIHJlc3VsdHMsIHRyeSB0byByZXNvbHZlIGl0IGFzIGEgZmllbGQgbmFtZSwgb3RoZXJ3aXNlIGVycm9yIG91dFxuICAgIGlmKHJlc3VsdHNbMF1bZmllbGRdID09PSB1bmRlZmluZWQpIHtcbiAgICAgIGxldCBwb3RlbnRpYWxJZHMgPSBldmUuZmluZChcImRpc3BsYXkgbmFtZVwiLCB7bmFtZTogZmllbGR9KTtcbiAgICAgIGxldCBuZXVlRmllbGQ7XG4gICAgICBmb3IobGV0IGRpc3BsYXkgb2YgcG90ZW50aWFsSWRzKSB7XG4gICAgICAgIGlmKHJlc3VsdHNbMF1bZGlzcGxheS5pZF0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIGlmKG5ldWVGaWVsZCkge1xuICAgICAgICAgICAgbmV1ZUZpZWxkID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICAgIG5ldWVGaWVsZCA9IGRpc3BsYXkuaWQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmKCFuZXVlRmllbGQpIHRocm93IG5ldyBFcnJvcihgVW5hYmxlIHRvIHVuaXF1ZWx5IHJlc29sdmUgZmllbGQgbmFtZSAke2ZpZWxkfSBpbiByZXN1bHQgZmllbGRzICR7T2JqZWN0LmtleXMocmVzdWx0c1swXSl9YCk7XG4gICAgICBlbHNlIGZpZWxkID0gbmV1ZUZpZWxkO1xuICAgIH1cblxuICAgIGxldCBlbGVtcyA9IFtdO1xuICAgIGZvcihsZXQgcm93IG9mIHJlc3VsdHMpIGVsZW1zLnB1c2goe3RleHQ6IHJvd1tmaWVsZF0sIGRhdGE6IHBhcmFtcy5kYXRhfSk7XG4gICAgcmV0dXJuIGVsZW1zO1xuICB9LFxuICBDU1YocmVzdWx0cywgcGFyYW1zOntmaWVsZDpzdHJpbmcsIGRhdGE/Ont9fSkge1xuICAgIGlmKCFwYXJhbXMuZmllbGQpIHRocm93IG5ldyBFcnJvcihcIlZhbHVlIHJlcHJlc2VudGF0aW9uIHJlcXVpcmVzIGEgJ2ZpZWxkJyBwYXJhbSBpbmRpY2F0aW5nIHdoaWNoIGZpZWxkIHRvIHJlcHJlc2VudFwiKTtcbiAgICBsZXQgZmllbGQgPSBwYXJhbXMuZmllbGQ7XG4gICAgaWYoIXJlc3VsdHMubGVuZ3RoKSByZXR1cm4gW107XG5cbiAgICAvLyBJZiBmaWVsZCBpc24ndCBpbiByZXN1bHRzLCB0cnkgdG8gcmVzb2x2ZSBpdCBhcyBhIGZpZWxkIG5hbWUsIG90aGVyd2lzZSBlcnJvciBvdXRcbiAgICBpZihyZXN1bHRzWzBdW2ZpZWxkXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBsZXQgcG90ZW50aWFsSWRzID0gZXZlLmZpbmQoXCJkaXNwbGF5IG5hbWVcIiwge25hbWU6IGZpZWxkfSk7XG4gICAgICBsZXQgbmV1ZUZpZWxkO1xuICAgICAgZm9yKGxldCBkaXNwbGF5IG9mIHBvdGVudGlhbElkcykge1xuICAgICAgICBpZihyZXN1bHRzWzBdW2Rpc3BsYXkuaWRdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICBpZihuZXVlRmllbGQpIHtcbiAgICAgICAgICAgIG5ldWVGaWVsZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBuZXVlRmllbGQgPSBkaXNwbGF5LmlkO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZighbmV1ZUZpZWxkKSB0aHJvdyBuZXcgRXJyb3IoYFVuYWJsZSB0byB1bmlxdWVseSByZXNvbHZlIGZpZWxkIG5hbWUgJHtmaWVsZH0gaW4gcmVzdWx0IGZpZWxkcyAke09iamVjdC5rZXlzKHJlc3VsdHNbMF0pfWApO1xuICAgICAgZWxzZSBmaWVsZCA9IG5ldWVGaWVsZDtcbiAgICB9XG5cbiAgICBsZXQgdmFsdWVzID0gW107XG4gICAgZm9yKGxldCByb3cgb2YgcmVzdWx0cykge1xuICAgICAgdmFsdWVzLnB1c2gocm93W2ZpZWxkXSk7XG4gICAgfVxuICAgIHJldHVybiB7dmFsdWVzLCBkYXRhOiBwYXJhbXMuZGF0YX07XG4gIH0sXG4gIGVycm9yKHJlc3VsdHMsIHBhcmFtcykge1xuICAgIHJldHVybiB7dGV4dDogcGFyYW1zW1wibWVzc2FnZVwiXX07XG4gIH0sXG4gIHRhYmxlKHJlc3VsdHMsIHBhcmFtczp7ZGF0YT86IHt9fSkge1xuICAgIHJldHVybiB7cm93czogcmVzdWx0cywgZGF0YTogcGFyYW1zLmRhdGF9O1xuICB9LFxuICBkaXJlY3RvcnkocmVzdWx0cywgcGFyYW1zOntkYXRhPzp7fSwgZmllbGQ/OnN0cmluZ30pIHtcbiAgICBsZXQgZW50aXRpZXMgPSBnZXRFbnRpdGllc0Zyb21SZXN1bHRzKHJlc3VsdHMsIHtmaWVsZHM6IHBhcmFtcy5maWVsZCA/IFtwYXJhbXMuZmllbGRdIDogdW5kZWZpbmVkfSk7XG4gICAgaWYoZW50aXRpZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICBsZXQgY29sbGVjdGlvbiA9IGVudGl0aWVzWzBdO1xuICAgICAgZW50aXRpZXMubGVuZ3RoID0gMDtcbiAgICAgIGZvciAobGV0IGZhY3Qgb2YgZXZlLmZpbmQoXCJpcyBhIGF0dHJpYnV0ZXNcIiwge2NvbGxlY3Rpb259KSkgZW50aXRpZXMucHVzaChmYWN0LmVudGl0eSk7XG4gICAgfVxuICAgIHJldHVybiB7ZW50aXRpZXMsIGRhdGE6IHBhcmFtcy5kYXRhfTtcbiAgfSxcbiAgZXh0ZXJuYWxMaW5rOiBwcmVwYXJlVVJMLFxuICBleHRlcm5hbEltYWdlOiBwcmVwYXJlVVJMLFxuICBleHRlcm5hbFZpZGVvOiBwcmVwYXJlVVJMLFxuICBcbiAgZW1iZWRkZWRDZWxsKHJlc3VsdHMsIHBhcmFtcykge1xuICAgIGxldCByZXAgPSBwYXJhbXNbXCJjaGlsZFJlcFwiXTtcbiAgICBsZXQgY2hpbGRJbmZvO1xuICAgIGlmKF9wcmVwYXJlW3JlcF0pIHtcbiAgICAgIHBhcmFtc1tcImRhdGFcIl0gPSBwYXJhbXNbXCJkYXRhXCJdIHx8IHBhcmFtcztcbiAgICAgIGNoaWxkSW5mbyA9IF9wcmVwYXJlW3JlcF0ocmVzdWx0cywgcGFyYW1zKTtcbiAgICAgIGNoaWxkSW5mby5kYXRhID0gY2hpbGRJbmZvLmRhdGEgfHwgcGFyYW1zO1xuICAgIH0gZWxzZSB7XG4gICAgICBjaGlsZEluZm8gPSB7ZGF0YTogcGFyYW1zfTtcbiAgICB9XG4gICAgcmV0dXJuIHtjaGlsZEluZm8sIHJlcCwgY2xpY2s6IGFjdGl2YXRlQ2VsbCwgY2VsbDogcGFyYW1zW1wiY2VsbFwiXX07XG4gIH0sXG59O1xuXG5mdW5jdGlvbiByZXByZXNlbnQoc2VhcmNoOiBzdHJpbmcsIHJlcDpzdHJpbmcsIHJlc3VsdHMsIHBhcmFtczp7fSk6RWxlbWVudCB7XG4gIC8vIGNvbnNvbGUubG9nKFwicmVwcGluZzpcIiwgcmVzdWx0cywgXCIgYXNcIiwgcmVwLCBcIiB3aXRoIHBhcmFtcyBcIiwgcGFyYW1zKTtcbiAgaWYocmVwIGluIF9wcmVwYXJlKSB7XG4gICAgbGV0IGVtYmVkUGFyYW1TZXRzID0gX3ByZXBhcmVbcmVwXShyZXN1bHRzLnJlc3VsdHMsIDxhbnk+cGFyYW1zKTtcbiAgICBsZXQgaXNBcnJheSA9IGVtYmVkUGFyYW1TZXRzICYmIGVtYmVkUGFyYW1TZXRzLmNvbnN0cnVjdG9yID09PSBBcnJheTtcbiAgICB0cnkge1xuICAgICAgaWYoIWVtYmVkUGFyYW1TZXRzIHx8IGlzQXJyYXkgJiYgZW1iZWRQYXJhbVNldHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB1aXRrLmVycm9yKHt0ZXh0OiBgJHtzZWFyY2h9IGFzICR7cmVwfWB9KVxuICAgICAgfSBlbHNlIGlmKGVtYmVkUGFyYW1TZXRzLmNvbnN0cnVjdG9yID09PSBBcnJheSkge1xuICAgICAgICBsZXQgd3JhcHBlciA9IHtjOiBcImZsZXgtY29sdW1uXCIsIGNoaWxkcmVuOiBbXX07XG4gICAgICAgIGZvcihsZXQgZW1iZWRQYXJhbXMgb2YgZW1iZWRQYXJhbVNldHMpIHtcbiAgICAgICAgICBlbWJlZFBhcmFtc1tcImRhdGFcIl0gPSBlbWJlZFBhcmFtc1tcImRhdGFcIl0gfHwgcGFyYW1zO1xuICAgICAgICAgIHdyYXBwZXIuY2hpbGRyZW4ucHVzaCh1aXRrW3JlcF0oZW1iZWRQYXJhbXMpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gd3JhcHBlcjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxldCBlbWJlZFBhcmFtcyA9IGVtYmVkUGFyYW1TZXRzO1xuICAgICAgICBlbWJlZFBhcmFtc1tcImRhdGFcIl0gPSBlbWJlZFBhcmFtc1tcImRhdGFcIl0gfHwgcGFyYW1zO1xuICAgICAgICByZXR1cm4gdWl0a1tyZXBdKGVtYmVkUGFyYW1zKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoKGVycikge1xuICAgICAgY29uc29sZS5lcnJvcihcIlJFUFJFU0VOVEFUSU9OIEVSUk9SXCIpO1xuICAgICAgY29uc29sZS5lcnJvcih7c2VhcmNoLCByZXAsIHJlc3VsdHMsIHBhcmFtc30pO1xuICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgcmV0dXJuIHVpdGsuZXJyb3Ioe3RleHQ6IGBGYWlsZWQgdG8gZW1iZWQgYXMgJHtwYXJhbXNbXCJjaGlsZFJlcFwiXSB8fCByZXB9YH0pXG4gICAgfVxuICB9XG59XG5cbmxldCBoaXN0b3J5U3RhdGUgPSB3aW5kb3cuaGlzdG9yeS5zdGF0ZTtcbmxldCBoaXN0b3J5VVJMID0gZ2V0TG9jYXRpb24oKTtcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicG9wc3RhdGVcIiwgZnVuY3Rpb24oZXZ0KSB7XG4gIGxldCBwb3BvdXQgPSBldmUuZmluZE9uZShcInVpIHBhbmVcIiwge2tpbmQ6IFBBTkUuUE9QT1VUfSk7XG4gIGlmKHBvcG91dCAmJiBwb3BvdXRIaXN0b3J5Lmxlbmd0aCkge1xuICAgIHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZShoaXN0b3J5U3RhdGUsIG51bGwsIGhpc3RvcnlVUkwpO1xuICAgIGxldCBzZWFyY2ggPSBwb3BvdXRIaXN0b3J5LnBvcCgpO1xuICAgIGRpc3BhdGNoKFwidWkgc2V0IHNlYXJjaFwiLCB7cGFuZUlkOiBwb3BvdXQucGFuZSwgdmFsdWU6IHNlYXJjaCwgcGVlazogdHJ1ZSwgcG9wU3RhdGU6IHRydWV9KS5jb21taXQoKTtcbiAgICByZXR1cm47XG4gIH0gZWxzZSBpZihldnQuc3RhdGUgJiYgZXZ0LnN0YXRlLnJvb3QpIHtcbiAgICB3aW5kb3cuaGlzdG9yeS5iYWNrKCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaGlzdG9yeVN0YXRlID0gZXZ0LnN0YXRlO1xuICBoaXN0b3J5VVJMID0gZ2V0TG9jYXRpb24oKTtcblxuICBsZXQge3BhbmVJZCA9IHVuZGVmaW5lZCwgY29udGFpbnMgPSB1bmRlZmluZWR9ID0gZXZ0LnN0YXRlIHx8IHt9O1xuICBpZihwYW5lSWQgPT09IHVuZGVmaW5lZCB8fCBjb250YWlucyA9PT0gdW5kZWZpbmVkKSByZXR1cm47XG4gIGRpc3BhdGNoKFwidWkgc2V0IHNlYXJjaFwiLCB7cGFuZUlkLCB2YWx1ZTogY29udGFpbnMsIHBvcFN0YXRlOiB0cnVlfSkuY29tbWl0KCk7XG59KTtcblxuLy8gUHJldmVudCBiYWNrc3BhY2UgZnJvbSBnb2luZyBiYWNrXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGV2ZW50KSA9PiB7XG4gIHZhciBjdXJyZW50ID0gPEhUTUxFbGVtZW50PmV2ZW50LnRhcmdldDtcbiAgaWYoZXZlbnQua2V5Q29kZSA9PT0gS0VZUy5CQUNLU1BBQ0UgJiYgY3VycmVudC5ub2RlTmFtZSAhPT0gXCJJTlBVVFwiICYmIGN1cnJlbnQubm9kZU5hbWUgIT09IFwiVEVYVEFSRUFcIiAmJiBjdXJyZW50LmNvbnRlbnRFZGl0YWJsZSAhPT0gXCJ0cnVlXCIpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICB9XG59KVxuXG4vLyBATk9URTogVW5jb21tZW50IHRoaXMgdG8gZW5hYmxlIHRoZSBuZXcgVUksIG9yIHR5cGUgYHdpbmRvd1tcIk5FVUVfVUlcIl0gPSB0cnVlOyBhcHAucmVuZGVyKClgIGludG8gdGhlIGNvbnNvbGUgdG8gZW5hYmxlIGl0IHRyYW5zaWVudGx5Llxud2luZG93W1wiTkVVRV9VSVwiXSA9IHRydWU7XG4iLCJpbXBvcnQge3VucGFkLCByZXBlYXQsIERFQlVHLCB1dWlkfSBmcm9tIFwiLi91dGlsc1wiO1xuaW1wb3J0IHtFbGVtZW50LCBIYW5kbGVyfSBmcm9tIFwiLi9taWNyb1JlYWN0XCI7XG5pbXBvcnQge0luZGV4ZXIsIFF1ZXJ5fSBmcm9tIFwiLi9ydW50aW1lXCI7XG5cbmZ1bmN0aW9uIHJlc29sdmUodGFibGUsIGZhY3QpIHtcbiAgbGV0IG5ldWUgPSB7fTtcbiAgZm9yKGxldCBmaWVsZCBpbiBmYWN0KVxuICAgIG5ldWVbYCR7dGFibGV9OiAke2ZpZWxkfWBdID0gZmFjdFtmaWVsZF07XG4gIHJldHVybiBuZXVlO1xufVxuZnVuY3Rpb24gaHVtYW5pemUodGFibGUsIGZhY3QpIHtcbiAgbGV0IG5ldWUgPSB7fTtcbiAgZm9yKGxldCBmaWVsZCBpbiBmYWN0KVxuICAgIG5ldWVbZmllbGQuc2xpY2UodGFibGUubGVuZ3RoICsgMildID0gZmFjdFtmaWVsZF07XG4gIHJldHVybiBuZXVlO1xufVxuXG5mdW5jdGlvbiByZXNvbHZlZEFkZChjaGFuZ2VzZXQsIHRhYmxlLCBmYWN0KSB7XG4gIHJldHVybiBjaGFuZ2VzZXQuYWRkKHRhYmxlLCByZXNvbHZlKHRhYmxlLCBmYWN0KSk7XG59XG5mdW5jdGlvbiByZXNvbHZlZFJlbW92ZShjaGFuZ2VzZXQsIHRhYmxlLCBmYWN0KSB7XG4gIHJldHVybiBjaGFuZ2VzZXQucmVtb3ZlKHRhYmxlLCByZXNvbHZlKHRhYmxlLCBmYWN0KSk7XG59XG5mdW5jdGlvbiBodW1hbml6ZWRGaW5kKGl4ZXI6SW5kZXhlciwgdGFibGUsIHF1ZXJ5KSB7XG4gIGxldCByZXN1bHRzID0gW107XG4gIGZvcihsZXQgZmFjdCBvZiBpeGVyLmZpbmQodGFibGUsIHJlc29sdmUodGFibGUsIHF1ZXJ5KSkpIHJlc3VsdHMucHVzaChodW1hbml6ZSh0YWJsZSwgZmFjdCkpO1xuICBsZXQgZGlhZyA9IHt9O1xuICBmb3IobGV0IHRhYmxlIGluIGl4ZXIudGFibGVzKSBkaWFnW3RhYmxlXSA9IGl4ZXIudGFibGVzW3RhYmxlXS50YWJsZS5sZW5ndGg7XG4gIHJldHVybiByZXN1bHRzO1xufVxuXG5leHBvcnQgY2xhc3MgVUkge1xuICBwcm90ZWN0ZWQgX2JpbmRpbmc6UXVlcnk7XG4gIHByb3RlY3RlZCBfZW1iZWRkZWQ6e307XG4gIHByb3RlY3RlZCBfY2hpbGRyZW46VUlbXSA9IFtdO1xuICBwcm90ZWN0ZWQgX2F0dHJpYnV0ZXM6e30gPSB7fTtcbiAgcHJvdGVjdGVkIF9ldmVudHM6e30gPSB7fTtcblxuICBwcm90ZWN0ZWQgX3BhcmVudDpVSTtcblxuICBzdGF0aWMgcmVtb3ZlKHRlbXBsYXRlOnN0cmluZywgaXhlcjpJbmRleGVyKSB7XG4gICAgbGV0IGNoYW5nZXNldCA9IGl4ZXIuZGlmZigpO1xuICAgIHJlc29sdmVkUmVtb3ZlKGNoYW5nZXNldCwgXCJ1aSB0ZW1wbGF0ZVwiLCB7dGVtcGxhdGV9KTtcbiAgICByZXNvbHZlZFJlbW92ZShjaGFuZ2VzZXQsIFwidWkgdGVtcGxhdGUgYmluZGluZ1wiLCB7dGVtcGxhdGV9KTtcbiAgICBsZXQgYmluZGluZ3MgPSBodW1hbml6ZWRGaW5kKGl4ZXIsIFwidWkgdGVtcGxhdGUgYmluZGluZ1wiLCB7dGVtcGxhdGV9KTtcbiAgICBmb3IobGV0IGJpbmRpbmcgb2YgYmluZGluZ3MpIGNoYW5nZXNldC5tZXJnZShRdWVyeS5yZW1vdmUoYmluZGluZy5iaW5kaW5nLCBpeGVyKSk7XG4gICAgcmVzb2x2ZWRSZW1vdmUoY2hhbmdlc2V0LCBcInVpIGVtYmVkXCIsIHt0ZW1wbGF0ZX0pO1xuICAgIGxldCBlbWJlZHMgPSBodW1hbml6ZWRGaW5kKGl4ZXIsIFwidWkgZW1iZWRcIiwge3RlbXBsYXRlfSk7XG4gICAgZm9yKGxldCBlbWJlZCBvZiBlbWJlZHMpIHtcbiAgICAgIHJlc29sdmVkUmVtb3ZlKGNoYW5nZXNldCwgXCJ1aSBlbWJlZCBzY29wZVwiLCB7dGVtcGxhdGUsIGVtYmVkOiBlbWJlZC5lbWJlZH0pO1xuICAgICAgcmVzb2x2ZWRSZW1vdmUoY2hhbmdlc2V0LCBcInVpIGVtYmVkIHNjb3BlIGJpbmRpbmdcIiwge3RlbXBsYXRlLCBlbWJlZDogZW1iZWQuZW1iZWR9KTtcbiAgICB9XG4gICAgcmVzb2x2ZWRSZW1vdmUoY2hhbmdlc2V0LCBcInVpIGF0dHJpYnV0ZVwiLCB7dGVtcGxhdGV9KTtcbiAgICByZXNvbHZlZFJlbW92ZShjaGFuZ2VzZXQsIFwidWkgYXR0cmlidXRlIGJpbmRpbmdcIiwge3RlbXBsYXRlfSk7XG4gICAgcmVzb2x2ZWRSZW1vdmUoY2hhbmdlc2V0LCBcInVpIGV2ZW50XCIsIHt0ZW1wbGF0ZX0pO1xuICAgIGxldCBldmVudHMgPSBodW1hbml6ZWRGaW5kKGl4ZXIsIFwidWkgZXZlbnRcIiwge3RlbXBsYXRlfSk7XG4gICAgZm9yKGxldCBldmVudCBvZiBldmVudHMpIHtcbiAgICAgIHJlc29sdmVkUmVtb3ZlKGNoYW5nZXNldCwgXCJ1aSBldmVudCBzdGF0ZVwiLCB7dGVtcGxhdGUsIGV2ZW50OiBldmVudC5ldmVudH0pO1xuICAgICAgcmVzb2x2ZWRSZW1vdmUoY2hhbmdlc2V0LCBcInVpIGV2ZW50IHN0YXRlIGJpbmRpbmdcIiwge3RlbXBsYXRlLCBldmVudDogZXZlbnQuZXZlbnR9KTtcbiAgICB9XG5cbiAgICBmb3IobGV0IGNoaWxkIG9mIGh1bWFuaXplZEZpbmQoaXhlciwgXCJ1aSB0ZW1wbGF0ZVwiLCB7cGFyZW50OiB0ZW1wbGF0ZX0pKSBjaGFuZ2VzZXQubWVyZ2UoVUkucmVtb3ZlKGNoaWxkLnRlbXBsYXRlLCBpeGVyKSk7XG4gICAgcmV0dXJuIGNoYW5nZXNldDtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBpZCkge1xuXG4gIH1cbiAgY29weSgpIHtcbiAgICBsZXQgbmV1ZSA9IG5ldyBVSSh0aGlzLmlkKTtcbiAgICBuZXVlLl9iaW5kaW5nID0gdGhpcy5fYmluZGluZztcbiAgICBuZXVlLl9lbWJlZGRlZCA9IHRoaXMuX2VtYmVkZGVkO1xuICAgIG5ldWUuX2NoaWxkcmVuID0gdGhpcy5fY2hpbGRyZW47XG4gICAgbmV1ZS5fYXR0cmlidXRlcyA9IHRoaXMuX2F0dHJpYnV0ZXM7XG4gICAgbmV1ZS5fZXZlbnRzID0gdGhpcy5fZXZlbnRzO1xuICAgIG5ldWUuX3BhcmVudCA9IHRoaXMuX3BhcmVudDtcbiAgICByZXR1cm4gbmV1ZTtcbiAgfVxuICBjaGFuZ2VzZXQoaXhlcjpJbmRleGVyKSB7XG4gICAgbGV0IGNoYW5nZXNldCA9IGl4ZXIuZGlmZigpO1xuXG4gICAgbGV0IHBhcmVudCA9IHRoaXMuX2F0dHJpYnV0ZXNbXCJwYXJlbnRcIl0gfHwgKHRoaXMuX3BhcmVudCAmJiB0aGlzLl9wYXJlbnQuaWQpIHx8IFwiXCI7XG4gICAgbGV0IGl4ID0gdGhpcy5fYXR0cmlidXRlc1tcIml4XCJdO1xuICAgIGlmKGl4ID09PSB1bmRlZmluZWQpIGl4ID0gKHRoaXMuX3BhcmVudCAmJiB0aGlzLl9wYXJlbnQuX2NoaWxkcmVuLmluZGV4T2YodGhpcykpO1xuICAgIGlmKGl4ID09PSAtMSB8fCBpeCA9PT0gdW5kZWZpbmVkKSBpeCA9IFwiXCI7XG4gICAgaWYodGhpcy5fZW1iZWRkZWQpIHBhcmVudCA9IFwiXCI7XG5cbiAgICByZXNvbHZlZEFkZChjaGFuZ2VzZXQsIFwidWkgdGVtcGxhdGVcIiwge3RlbXBsYXRlOiB0aGlzLmlkLCBwYXJlbnQsIGl4fSk7XG4gICAgaWYodGhpcy5fYmluZGluZykge1xuICAgICAgaWYoIXRoaXMuX2JpbmRpbmcubmFtZSB8fCB0aGlzLl9iaW5kaW5nLm5hbWUgPT09IFwidW5rbm93blwiKSB0aGlzLl9iaW5kaW5nLm5hbWUgPSBgYm91bmQgdmlldyAke3RoaXMuaWR9YDtcbiAgICAgIGNoYW5nZXNldC5tZXJnZSh0aGlzLl9iaW5kaW5nLmNoYW5nZXNldChpeGVyKSk7XG4gICAgICByZXNvbHZlZEFkZChjaGFuZ2VzZXQsIFwidWkgdGVtcGxhdGUgYmluZGluZ1wiLCB7dGVtcGxhdGU6IHRoaXMuaWQsIGJpbmRpbmc6IHRoaXMuX2JpbmRpbmcubmFtZX0pO1xuICAgIH1cbiAgICBpZih0aGlzLl9lbWJlZGRlZCkge1xuICAgICAgbGV0IGVtYmVkID0gdXVpZCgpO1xuICAgICAgcmVzb2x2ZWRBZGQoY2hhbmdlc2V0LCBcInVpIGVtYmVkXCIsIHtlbWJlZCwgdGVtcGxhdGU6IHRoaXMuaWQsIHBhcmVudDogKHRoaXMuX3BhcmVudCB8fCA8YW55Pnt9KS5pZCwgaXh9KTtcbiAgICAgIGZvcihsZXQga2V5IGluIHRoaXMuX2VtYmVkZGVkKSB7XG4gICAgICAgIGxldCB2YWx1ZSA9IHRoaXMuX2F0dHJpYnV0ZXNba2V5XTtcbiAgICAgICAgaWYodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkgcmVzb2x2ZWRBZGQoY2hhbmdlc2V0LCBcInVpIGVtYmVkIHNjb3BlIGJpbmRpbmdcIiwge2VtYmVkLCBrZXksIHNvdXJjZTogdmFsdWVbMF0sIGFsaWFzOiB2YWx1ZVsxXX0pO1xuICAgICAgICBlbHNlIHJlc29sdmVkQWRkKGNoYW5nZXNldCwgXCJ1aSBlbWJlZCBzY29wZVwiLCB7ZW1iZWQsIGtleSwgdmFsdWV9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IobGV0IHByb3BlcnR5IGluIHRoaXMuX2F0dHJpYnV0ZXMpIHtcbiAgICAgIGxldCB2YWx1ZSA9IHRoaXMuX2F0dHJpYnV0ZXNbcHJvcGVydHldO1xuICAgICAgaWYodmFsdWUgaW5zdGFuY2VvZiBBcnJheSkgcmVzb2x2ZWRBZGQoY2hhbmdlc2V0LCBcInVpIGF0dHJpYnV0ZSBiaW5kaW5nXCIsIHt0ZW1wbGF0ZTogdGhpcy5pZCwgcHJvcGVydHksIHNvdXJjZTogdmFsdWVbMF0sIGFsaWFzOiB2YWx1ZVsxXX0pO1xuICAgICAgZWxzZSByZXNvbHZlZEFkZChjaGFuZ2VzZXQsIFwidWkgYXR0cmlidXRlXCIsIHt0ZW1wbGF0ZTogdGhpcy5pZCwgcHJvcGVydHksIHZhbHVlfSk7XG4gICAgfVxuXG4gICAgZm9yKGxldCBldmVudCBpbiB0aGlzLl9ldmVudHMpIHtcbiAgICAgIHJlc29sdmVkQWRkKGNoYW5nZXNldCwgXCJ1aSBldmVudFwiLCB7dGVtcGxhdGU6IHRoaXMuaWQsIGV2ZW50fSk7XG4gICAgICBsZXQgc3RhdGUgPSB0aGlzLl9ldmVudHNbZXZlbnRdO1xuICAgICAgZm9yKGxldCBrZXkgaW4gc3RhdGUpIHtcbiAgICAgICAgbGV0IHZhbHVlID0gc3RhdGVba2V5XTtcbiAgICAgICAgaWYodmFsdWUgaW5zdGFuY2VvZiBBcnJheSlcbiAgICAgICAgICByZXNvbHZlZEFkZChjaGFuZ2VzZXQsIFwidWkgZXZlbnQgc3RhdGUgYmluZGluZ1wiLCB7dGVtcGxhdGU6IHRoaXMuaWQsIGV2ZW50LCBrZXksIHNvdXJjZTogdmFsdWVbMF0sIGFsaWFzOiB2YWx1ZVsxXX0pO1xuICAgICAgICBlbHNlIHJlc29sdmVkQWRkKGNoYW5nZXNldCwgXCJ1aSBldmVudCBzdGF0ZVwiLCB7dGVtcGxhdGU6IHRoaXMuaWQsIGV2ZW50LCBrZXksIHZhbHVlfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZm9yKGxldCBjaGlsZCBvZiB0aGlzLl9jaGlsZHJlbikgY2hhbmdlc2V0Lm1lcmdlKGNoaWxkLmNoYW5nZXNldChpeGVyKSk7XG5cbiAgICByZXR1cm4gY2hhbmdlc2V0O1xuICB9XG4gIGxvYWQodGVtcGxhdGU6c3RyaW5nLCBpeGVyOkluZGV4ZXIsIHBhcmVudD86VUkpIHtcbiAgICBsZXQgZmFjdCA9IGh1bWFuaXplZEZpbmQoaXhlciwgXCJ1aSB0ZW1wbGF0ZVwiLCB7dGVtcGxhdGV9KVswXTtcbiAgICBpZighZmFjdCkgcmV0dXJuIHRoaXM7XG4gICAgaWYocGFyZW50IHx8IGZhY3QucGFyZW50KSB0aGlzLl9wYXJlbnQgPSBwYXJlbnQgfHwgbmV3IFVJKHRoaXMuX3BhcmVudCk7XG4gICAgbGV0IGJpbmRpbmcgPSBodW1hbml6ZWRGaW5kKGl4ZXIsIFwidWkgdGVtcGxhdGUgYmluZGluZ1wiLCB7dGVtcGxhdGV9KVswXTtcbiAgICBpZihiaW5kaW5nKSB0aGlzLmJpbmQoKG5ldyBRdWVyeShpeGVyLCBiaW5kaW5nLmJpbmRpbmcpKSk7XG4gICAgbGV0IGVtYmVkID0gaHVtYW5pemVkRmluZChpeGVyLCBcInVpIGVtYmVkXCIsIHt0ZW1wbGF0ZSwgcGFyZW50OiB0aGlzLl9wYXJlbnQgPyB0aGlzLl9wYXJlbnQuaWQgOiBcIlwifSlbMF07XG4gICAgaWYoZW1iZWQpIHtcbiAgICAgIGxldCBzY29wZSA9IHt9O1xuICAgICAgZm9yKGxldCBhdHRyIG9mIGh1bWFuaXplZEZpbmQoaXhlciwgXCJ1aSBlbWJlZCBzY29wZVwiLCB7ZW1iZWQ6IGVtYmVkLmVtYmVkfSkpIHNjb3BlW2F0dHIua2V5XSA9IGF0dHIudmFsdWU7XG4gICAgICBmb3IobGV0IGF0dHIgb2YgaHVtYW5pemVkRmluZChpeGVyLCBcInVpIGVtYmVkIHNjb3BlIGJpbmRpbmdcIiwge2VtYmVkOiBlbWJlZC5lbWJlZH0pKSBzY29wZVthdHRyLmtleV0gPSBbYXR0ci5zb3VyY2UsIGF0dHIuYWxpYXNdO1xuICAgICAgdGhpcy5lbWJlZChzY29wZSk7XG4gICAgfVxuXG4gICAgZm9yKGxldCBhdHRyIG9mIGh1bWFuaXplZEZpbmQoaXhlciwgXCJ1aSBhdHRyaWJ1dGVcIiwge3RlbXBsYXRlfSkpIHRoaXMuYXR0cmlidXRlKGF0dHIucHJvcGVydHksIGF0dHIudmFsdWUpO1xuICAgIGZvcihsZXQgYXR0ciBvZiBodW1hbml6ZWRGaW5kKGl4ZXIsIFwidWkgYXR0cmlidXRlIGJpbmRpbmdcIiwge3RlbXBsYXRlfSkpIHRoaXMuYXR0cmlidXRlKGF0dHIucHJvcGVydHksIFthdHRyLnNvdXJjZSwgYXR0ci5hbGlhc10pO1xuXG4gICAgZm9yKGxldCBldmVudCBvZiBodW1hbml6ZWRGaW5kKGl4ZXIsIFwidWkgZXZlbnRcIiwge3RlbXBsYXRlfSkpIHtcbiAgICAgIGxldCBzdGF0ZSA9IHt9O1xuICAgICAgZm9yKGxldCBhdHRyIG9mIGh1bWFuaXplZEZpbmQoaXhlciwgXCJ1aSBldmVudCBzdGF0ZVwiLCB7dGVtcGxhdGUsIGV2ZW50OiBldmVudC5ldmVudH0pKSBzdGF0ZVtldmVudC5rZXldID0gZXZlbnQudmFsdWU7XG4gICAgICBmb3IobGV0IGF0dHIgb2YgaHVtYW5pemVkRmluZChpeGVyLCBcInVpIGV2ZW50IHN0YXRlIGJpbmRpbmdcIiwge3RlbXBsYXRlLCBldmVudDogZXZlbnQuZXZlbnR9KSkgc3RhdGVbZXZlbnQua2V5XSA9IFtldmVudC5zb3VyY2UsIGV2ZW50LmFsaWFzXVxuICAgICAgdGhpcy5ldmVudChldmVudC5ldmVudCwgc3RhdGUpO1xuICAgIH1cblxuICAgIGZvcihsZXQgY2hpbGQgb2YgaHVtYW5pemVkRmluZChpeGVyLCBcInVpIHRlbXBsYXRlXCIsIHtwYXJlbnQ6IHRlbXBsYXRlfSkpXG4gICAgICB0aGlzLmNoaWxkKChuZXcgVUkoY2hpbGQudGVtcGxhdGUpKS5sb2FkKGNoaWxkLnRlbXBsYXRlLCBpeGVyLCB0aGlzKSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGNoaWxkcmVuKG5ldWU/OlVJW10sIGFwcGVuZCA9IGZhbHNlKSB7XG4gICAgaWYoIW5ldWUpIHJldHVybiB0aGlzLl9jaGlsZHJlbjtcbiAgICBpZighYXBwZW5kKSB0aGlzLl9jaGlsZHJlbi5sZW5ndGggPSAwO1xuICAgIGZvcihsZXQgY2hpbGQgb2YgbmV1ZSkge1xuICAgICAgbGV0IGNvcGllZCA9IGNoaWxkLmNvcHkoKTtcbiAgICAgIGNvcGllZC5fcGFyZW50ID0gdGhpcztcbiAgICAgIHRoaXMuX2NoaWxkcmVuLnB1c2goY29waWVkKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX2NoaWxkcmVuO1xuICB9XG4gIGNoaWxkKGNoaWxkOlVJLCBpeD86IG51bWJlciwgZW1iZWQ/Ont9KSB7XG4gICAgY2hpbGQgPSBjaGlsZC5jb3B5KCk7XG4gICAgY2hpbGQuX3BhcmVudCA9IHRoaXM7XG4gICAgaWYoZW1iZWQpIGNoaWxkLmVtYmVkKGVtYmVkKTtcbiAgICBpZighaXgpIHRoaXMuX2NoaWxkcmVuLnB1c2goY2hpbGQpO1xuICAgIGVsc2UgdGhpcy5fY2hpbGRyZW4uc3BsaWNlKGl4LCAwLCBjaGlsZCk7XG4gICAgcmV0dXJuIGNoaWxkO1xuICB9XG4gIHJlbW92ZUNoaWxkKGl4OiBudW1iZXIpIHtcbiAgICByZXR1cm4gdGhpcy5fY2hpbGRyZW4uc3BsaWNlKGl4LCAxKTtcbiAgfVxuXG4gIGF0dHJpYnV0ZXMocHJvcGVydGllcz86IHt9LCBtZXJnZSA9IGZhbHNlKSB7XG4gICAgaWYoIXByb3BlcnRpZXMpIHJldHVybiB0aGlzLl9hdHRyaWJ1dGVzO1xuICAgIGlmKCFtZXJnZSkge1xuICAgICAgZm9yKGxldCBwcm9wIGluIHRoaXMuX2F0dHJpYnV0ZXMpIGRlbGV0ZSB0aGlzLl9hdHRyaWJ1dGVzW3Byb3BdO1xuICAgIH1cbiAgICBmb3IobGV0IHByb3AgaW4gcHJvcGVydGllcykgdGhpcy5fYXR0cmlidXRlc1twcm9wXSA9IHByb3BlcnRpZXNbcHJvcF07XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgYXR0cmlidXRlKHByb3BlcnR5OiBzdHJpbmcsIHZhbHVlPzogYW55KSB7XG4gICAgaWYodmFsdWUgPT09IHVuZGVmaW5lZCkgcmV0dXJuIHRoaXMuX2F0dHJpYnV0ZXNbcHJvcGVydHldO1xuICAgIHRoaXMuX2F0dHJpYnV0ZXNbcHJvcGVydHldID0gdmFsdWU7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgcmVtb3ZlQXR0cmlidXRlKHByb3BlcnR5OiBzdHJpbmcpIHtcbiAgICBkZWxldGUgdGhpcy5fYXR0cmlidXRlc1twcm9wZXJ0eV07XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBldmVudHMoZXZlbnRzPzoge30sIG1lcmdlID0gZmFsc2UpIHtcbiAgICBpZighZXZlbnRzKSByZXR1cm4gdGhpcy5fZXZlbnRzO1xuICAgIGlmKCFtZXJnZSkge1xuICAgICAgZm9yKGxldCBldmVudCBpbiB0aGlzLl9ldmVudHMpIGRlbGV0ZSB0aGlzLl9ldmVudHNbZXZlbnRdO1xuICAgIH1cbiAgICBmb3IobGV0IGV2ZW50IGluIGV2ZW50cykgdGhpcy5fZXZlbnRzW2V2ZW50XSA9IGV2ZW50c1tldmVudF07XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbiAgZXZlbnQoZXZlbnQ6IHN0cmluZywgc3RhdGU/OiBhbnkpIHtcbiAgICBpZihzdGF0ZSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gdGhpcy5fZXZlbnRzW2V2ZW50XTtcbiAgICB0aGlzLl9hdHRyaWJ1dGVzW2V2ZW50XSA9IHN0YXRlO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG4gIHJlbW92ZUV2ZW50KGV2ZW50OiBzdHJpbmcpIHtcbiAgICBkZWxldGUgdGhpcy5fZXZlbnRzW2V2ZW50XTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGVtYmVkKHNjb3BlOnt9fGJvb2xlYW4gPSB7fSkge1xuICAgIGlmKCFzY29wZSkge1xuICAgICAgdGhpcy5fZW1iZWRkZWQgPSB1bmRlZmluZWQ7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgaWYoc2NvcGUgPT09IHRydWUpIHNjb3BlID0ge307XG4gICAgdGhpcy5fZW1iZWRkZWQgPSBzY29wZTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGJpbmQoYmluZGluZzpRdWVyeSkge1xuICAgIHRoaXMuX2JpbmRpbmcgPSBiaW5kaW5nO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG59XG5cbmludGVyZmFjZSBVaVdhcm5pbmcge1xuICBcInVpIHdhcm5pbmc6IHRlbXBsYXRlXCI6IHN0cmluZ1xuICBcInVpIHdhcm5pbmc6IHdhcm5pbmdcIjogc3RyaW5nXG59XG5cbi8vIEBUT0RPOiBGaW5pc2ggcmVmZXJlbmNlIGltcGwuXG4vLyBAVE9ETzogVGhlbiBidWlsZCBiaXQtZ2VuZXJhdGluZyB2ZXJzaW9uXG5leHBvcnQgY2xhc3MgVUlSZW5kZXJlciB7XG4gIHB1YmxpYyBjb21waWxlZCA9IDA7XG4gIHByb3RlY3RlZCBfdGFnQ29tcGlsZXJzOntbdGFnOiBzdHJpbmddOiAoZWxlbTpFbGVtZW50KSA9PiB2b2lkfSA9IHt9O1xuICBwcm90ZWN0ZWQgX2hhbmRsZXJzOkhhbmRsZXI8RXZlbnQ+W10gPSBbXTtcblxuICBjb25zdHJ1Y3RvcihwdWJsaWMgaXhlcjpJbmRleGVyKSB7fVxuXG4gIGNvbXBpbGUocm9vdHM6KHN0cmluZ3xFbGVtZW50KVtdKTpFbGVtZW50W10ge1xuICAgIGlmKERFQlVHLlJFTkRFUkVSKSBjb25zb2xlLmdyb3VwKFwidWkgY29tcGlsZVwiKTtcbiAgICBsZXQgY29tcGlsZWRFbGVtczpFbGVtZW50W10gPSBbXTtcbiAgICBmb3IobGV0IHJvb3Qgb2Ygcm9vdHMpIHtcbiAgICAgIC8vIEBUT0RPOiByZXBhcmVudCBkeW5hbWljIHJvb3RzIGlmIG5lZWRlZC5cbiAgICAgIGlmKHR5cGVvZiByb290ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIGxldCBlbGVtcyA9IHRoaXMuX2NvbXBpbGVXcmFwcGVyKHJvb3QsIGNvbXBpbGVkRWxlbXMubGVuZ3RoKTtcbiAgICAgICAgY29tcGlsZWRFbGVtcy5wdXNoLmFwcGx5KGNvbXBpbGVkRWxlbXMsIGVsZW1zKTtcbiAgICAgICAgbGV0IGJhc2UgPSB0aGlzLml4ZXIuZmluZE9uZShcInVpIHRlbXBsYXRlXCIsIHtcInVpIHRlbXBsYXRlOiB0ZW1wbGF0ZVwiOiByb290fSk7XG4gICAgICAgIGlmKCFiYXNlKSBjb250aW51ZTtcbiAgICAgICAgbGV0IHBhcmVudCA9IGJhc2VbXCJ1aSB0ZW1wbGF0ZTogcGFyZW50XCJdO1xuICAgICAgICBpZihwYXJlbnQpIHtcbiAgICAgICAgICBmb3IobGV0IGVsZW0gb2YgZWxlbXMpIGVsZW0ucGFyZW50ID0gcGFyZW50O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIHtcbiAgICAgICAgaWYoIXJvb3QuaXgpIHJvb3QuaXggPSBjb21waWxlZEVsZW1zLmxlbmd0aDtcbiAgICAgICAgY29tcGlsZWRFbGVtcy5wdXNoKHJvb3QpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZihERUJVRy5SRU5ERVJFUikgY29uc29sZS5ncm91cEVuZCgpO1xuICAgIHJldHVybiBjb21waWxlZEVsZW1zO1xuICB9XG5cbiAgcHJvdGVjdGVkIF9jb21waWxlV3JhcHBlcih0ZW1wbGF0ZTpzdHJpbmcsIGJhc2VJeDogbnVtYmVyLCBjb25zdHJhaW50czp7fSA9IHt9LCBiaW5kaW5nU3RhY2s6YW55W10gPSBbXSwgZGVwdGg6bnVtYmVyID0gMCk6RWxlbWVudFtdIHtcbiAgICBsZXQgZWxlbXMgPSBbXTtcbiAgICBsZXQgYmluZGluZyA9IHRoaXMuaXhlci5maW5kT25lKFwidWkgdGVtcGxhdGUgYmluZGluZ1wiLCB7XCJ1aSB0ZW1wbGF0ZSBiaW5kaW5nOiB0ZW1wbGF0ZVwiOiB0ZW1wbGF0ZX0pO1xuICAgIGlmKCFiaW5kaW5nKSB7XG4gICAgICBsZXQgZWxlbSA9IHRoaXMuX2NvbXBpbGVFbGVtZW50KHRlbXBsYXRlLCBiaW5kaW5nU3RhY2ssIGRlcHRoKTtcbiAgICAgIGlmKGVsZW0pIGVsZW1zWzBdID0gZWxlbTtcbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IGJvdW5kUXVlcnkgPSBiaW5kaW5nW1widWkgdGVtcGxhdGUgYmluZGluZzogYmluZGluZ1wiXTtcbiAgICAgIGxldCBmYWN0cyA9IHRoaXMuZ2V0Qm91bmRGYWN0cyhib3VuZFF1ZXJ5LCBjb25zdHJhaW50cyk7XG4gICAgICBsZXQgaXggPSAwO1xuICAgICAgZm9yKGxldCBmYWN0IG9mIGZhY3RzKSB7XG4gICAgICAgIGJpbmRpbmdTdGFjay5wdXNoKGZhY3QpO1xuICAgICAgICBsZXQgZWxlbSA9IHRoaXMuX2NvbXBpbGVFbGVtZW50KHRlbXBsYXRlLCBiaW5kaW5nU3RhY2ssIGRlcHRoKTtcbiAgICAgICAgYmluZGluZ1N0YWNrLnBvcCgpO1xuICAgICAgICBpZihlbGVtKSBlbGVtcy5wdXNoKGVsZW0pO1xuICAgICAgfVxuICAgIH1cbiAgICBlbGVtcy5zb3J0KChhLCBiKSA9PiBhLml4IC0gYi5peCk7XG4gICAgbGV0IHByZXZJeCA9IHVuZGVmaW5lZDtcbiAgICBmb3IobGV0IGVsZW0gb2YgZWxlbXMpIHtcbiAgICAgIGVsZW0uaXggPSBlbGVtLml4ID8gZWxlbS5peCArIGJhc2VJeCA6IGJhc2VJeDtcbiAgICAgIGlmKGVsZW0uaXggPT09IHByZXZJeCkgZWxlbS5peCsrO1xuICAgICAgcHJldkl4ID0gZWxlbS5peDtcbiAgICB9XG4gICAgcmV0dXJuIGVsZW1zO1xuICB9XG5cbiAgcHJvdGVjdGVkIF9jb21waWxlRWxlbWVudCh0ZW1wbGF0ZTpzdHJpbmcsIGJpbmRpbmdTdGFjazphbnlbXSwgZGVwdGg6bnVtYmVyKTpFbGVtZW50IHtcbiAgICBpZihERUJVRy5SRU5ERVJFUikgY29uc29sZS5sb2cocmVwZWF0KFwiICBcIiwgZGVwdGgpICsgXCIqIGNvbXBpbGVcIiwgdGVtcGxhdGUpO1xuICAgIGxldCBlbGVtZW50VG9DaGlsZHJlbiA9IHRoaXMuaXhlci5pbmRleChcInVpIHRlbXBsYXRlXCIsIFtcInVpIHRlbXBsYXRlOiBwYXJlbnRcIl0pO1xuICAgIGxldCBlbGVtZW50VG9FbWJlZHMgPSB0aGlzLml4ZXIuaW5kZXgoXCJ1aSBlbWJlZFwiLCBbXCJ1aSBlbWJlZDogcGFyZW50XCJdKTtcbiAgICBsZXQgZW1iZWRUb1Njb3BlID0gdGhpcy5peGVyLmluZGV4KFwidWkgZW1iZWQgc2NvcGVcIiwgW1widWkgZW1iZWQgc2NvcGU6IGVtYmVkXCJdKTtcbiAgICBsZXQgZW1iZWRUb1Njb3BlQmluZGluZyA9IHRoaXMuaXhlci5pbmRleChcInVpIGVtYmVkIHNjb3BlIGJpbmRpbmdcIiwgW1widWkgZW1iZWQgc2NvcGUgYmluZGluZzogZW1iZWRcIl0pO1xuICAgIGxldCBlbGVtZW50VG9BdHRycyA9IHRoaXMuaXhlci5pbmRleChcInVpIGF0dHJpYnV0ZVwiLCBbXCJ1aSBhdHRyaWJ1dGU6IHRlbXBsYXRlXCJdKTtcbiAgICBsZXQgZWxlbWVudFRvQXR0ckJpbmRpbmdzID0gdGhpcy5peGVyLmluZGV4KFwidWkgYXR0cmlidXRlIGJpbmRpbmdcIiwgW1widWkgYXR0cmlidXRlIGJpbmRpbmc6IHRlbXBsYXRlXCJdKTtcbiAgICBsZXQgZWxlbWVudFRvRXZlbnRzID0gdGhpcy5peGVyLmluZGV4KFwidWkgZXZlbnRcIiwgW1widWkgZXZlbnQ6IHRlbXBsYXRlXCJdKTtcbiAgICB0aGlzLmNvbXBpbGVkKys7XG4gICAgbGV0IGJhc2UgPSB0aGlzLml4ZXIuZmluZE9uZShcInVpIHRlbXBsYXRlXCIsIHtcInVpIHRlbXBsYXRlOiB0ZW1wbGF0ZVwiOiB0ZW1wbGF0ZX0pO1xuICAgIGlmKCFiYXNlKSB7XG4gICAgICBjb25zb2xlLndhcm4oYHVpIHRlbXBsYXRlICR7dGVtcGxhdGV9IGRvZXMgbm90IGV4aXN0LiBJZ25vcmluZy5gKTtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgbGV0IGF0dHJzID0gZWxlbWVudFRvQXR0cnNbdGVtcGxhdGVdO1xuICAgIGxldCBib3VuZEF0dHJzID0gZWxlbWVudFRvQXR0ckJpbmRpbmdzW3RlbXBsYXRlXTtcbiAgICBsZXQgZXZlbnRzID0gZWxlbWVudFRvRXZlbnRzW3RlbXBsYXRlXTtcblxuICAgIC8vIEhhbmRsZSBtZXRhIHByb3BlcnRpZXNcbiAgICBsZXQgZWxlbTpFbGVtZW50ID0ge190ZW1wbGF0ZTogdGVtcGxhdGUsIGl4OiBiYXNlW1widWkgdGVtcGxhdGU6IGl4XCJdfTtcblxuICAgIC8vIEhhbmRsZSBzdGF0aWMgcHJvcGVydGllc1xuICAgIGlmKGF0dHJzKSB7XG4gICAgICBmb3IobGV0IHtcInVpIGF0dHJpYnV0ZTogcHJvcGVydHlcIjogcHJvcCwgXCJ1aSBhdHRyaWJ1dGU6IHZhbHVlXCI6IHZhbH0gb2YgYXR0cnMpIGVsZW1bcHJvcF0gPSB2YWw7XG4gICAgfVxuXG4gICAgLy8gSGFuZGxlIGJvdW5kIHByb3BlcnRpZXNcbiAgICBpZihib3VuZEF0dHJzKSB7XG4gICAgICAvLyBARklYTUU6IFdoYXQgZG8gd2l0aCBzb3VyY2U/XG4gICAgICBmb3IobGV0IHtcInVpIGF0dHJpYnV0ZSBiaW5kaW5nOiBwcm9wZXJ0eVwiOiBwcm9wLCBcInVpIGF0dHJpYnV0ZSBiaW5kaW5nOiBzb3VyY2VcIjogc291cmNlLCBcInVpIGF0dHJpYnV0ZSBiaW5kaW5nOiBhbGlhc1wiOiBhbGlhc30gb2YgYm91bmRBdHRycylcbiAgICAgICAgZWxlbVtwcm9wXSA9IHRoaXMuZ2V0Qm91bmRWYWx1ZShzb3VyY2UsIGFsaWFzLCBiaW5kaW5nU3RhY2spO1xuICAgIH1cblxuICAgIC8vIEF0dGFjaCBldmVudCBoYW5kbGVyc1xuICAgIGlmKGV2ZW50cykge1xuICAgICAgZm9yKGxldCB7XCJ1aSBldmVudDogZXZlbnRcIjogZXZlbnR9IG9mIGV2ZW50cykgZWxlbVtldmVudF0gPSB0aGlzLmdlbmVyYXRlRXZlbnRIYW5kbGVyKGVsZW0sIGV2ZW50LCBiaW5kaW5nU3RhY2spO1xuICAgIH1cblxuICAgIC8vIENvbXBpbGUgY2hpbGRyZW5cbiAgICBsZXQgY2hpbGRyZW4gPSBlbGVtZW50VG9DaGlsZHJlblt0ZW1wbGF0ZV0gfHwgW107XG4gICAgbGV0IGVtYmVkcyA9IGVsZW1lbnRUb0VtYmVkc1t0ZW1wbGF0ZV0gfHwgW107XG4gICAgaWYoY2hpbGRyZW4ubGVuZ3RoIHx8IGVtYmVkcy5sZW5ndGgpIHtcbiAgICAgIGVsZW0uY2hpbGRyZW4gPSBbXTtcbiAgICAgIGxldCBjaGlsZEl4ID0gMCwgZW1iZWRJeCA9IDA7XG4gICAgICB3aGlsZShjaGlsZEl4IDwgY2hpbGRyZW4ubGVuZ3RoIHx8IGVtYmVkSXggPCBlbWJlZHMubGVuZ3RoKSB7XG4gICAgICAgIGxldCBjaGlsZCA9IGNoaWxkcmVuW2NoaWxkSXhdO1xuICAgICAgICBsZXQgZW1iZWQgPSBlbWJlZHNbZW1iZWRJeF07XG4gICAgICAgIGxldCBhZGQsIGNvbnN0cmFpbnRzID0ge30sIGNoaWxkQmluZGluZ1N0YWNrID0gYmluZGluZ1N0YWNrO1xuICAgICAgICBpZighZW1iZWQgfHwgY2hpbGQgJiYgY2hpbGQuaXggPD0gZW1iZWQuaXgpIHtcbiAgICAgICAgICBhZGQgPSBjaGlsZHJlbltjaGlsZEl4KytdW1widWkgdGVtcGxhdGU6IHRlbXBsYXRlXCJdO1xuICAgICAgICAgIC8vIFJlc29sdmUgYm91bmQgYWxpYXNlcyBpbnRvIGNvbnN0cmFpbnRzXG4gICAgICAgICAgY29uc3RyYWludHMgPSB0aGlzLmdldEJvdW5kU2NvcGUoYmluZGluZ1N0YWNrKTtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGFkZCA9IGVtYmVkc1tlbWJlZEl4KytdW1widWkgZW1iZWQ6IHRlbXBsYXRlXCJdO1xuICAgICAgICAgIGZvcihsZXQgc2NvcGUgb2YgZW1iZWRUb1Njb3BlW2VtYmVkW1widWkgZW1iZWQ6IGVtYmVkXCJdXSB8fCBbXSlcbiAgICAgICAgICAgIGNvbnN0cmFpbnRzW3Njb3BlW1widWkgZW1iZWQgc2NvcGU6IGtleVwiXV0gPSBzY29wZVtcInVpIGVtYmVkIHNjb3BlOiB2YWx1ZVwiXTtcblxuICAgICAgICAgIGZvcihsZXQgc2NvcGUgb2YgZW1iZWRUb1Njb3BlQmluZGluZ1tlbWJlZFtcInVpIGVtYmVkOiBlbWJlZFwiXV0gfHwgW10pIHtcbiAgICAgICAgICAgIC8vIEBGSVhNRTogV2hhdCBkbyBhYm91dCBzb3VyY2U/XG4gICAgICAgICAgICBsZXQge1widWkgZW1iZWQgc2NvcGUgYmluZGluZzoga2V5XCI6IGtleSwgXCJ1aSBlbWJlZCBzY29wZSBiaW5kaW5nOiBzb3VyY2VcIjogc291cmNlLCBcInVpIGVtYmVkIHNjb3BlIGJpbmRpbmc6IGFsaWFzXCI6IGFsaWFzfSA9IHNjb3BlO1xuICAgICAgICAgICAgY29uc3RyYWludHNba2V5XSA9IHRoaXMuZ2V0Qm91bmRWYWx1ZShzb3VyY2UsIGFsaWFzLCBiaW5kaW5nU3RhY2spO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjaGlsZEJpbmRpbmdTdGFjayA9IFtjb25zdHJhaW50c107XG4gICAgICAgIH1cbiAgICAgICAgZWxlbS5jaGlsZHJlbi5wdXNoLmFwcGx5KGVsZW0uY2hpbGRyZW4sIHRoaXMuX2NvbXBpbGVXcmFwcGVyKGFkZCwgZWxlbS5jaGlsZHJlbi5sZW5ndGgsIGNvbnN0cmFpbnRzLCBjaGlsZEJpbmRpbmdTdGFjaywgZGVwdGggKyAxKSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYodGhpcy5fdGFnQ29tcGlsZXJzW2VsZW0udF0pIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIHRoaXMuX3RhZ0NvbXBpbGVyc1tlbGVtLnRdKGVsZW0pO1xuICAgICAgfSBjYXRjaChlcnIpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBGYWlsZWQgdG8gY29tcGlsZSB0ZW1wbGF0ZTogJyR7dGVtcGxhdGV9JyBkdWUgdG8gJyR7ZXJyfScgZm9yIGVsZW1lbnQgJyR7SlNPTi5zdHJpbmdpZnkoZWxlbSl9J2ApO1xuICAgICAgICBlbGVtLnQgPSBcInVpLWVycm9yXCI7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGVsZW07XG4gIH1cblxuICBwcm90ZWN0ZWQgZ2V0Qm91bmRGYWN0cyhxdWVyeSwgY29uc3RyYWludHMpOnN0cmluZ1tdIHtcbiAgICByZXR1cm4gdGhpcy5peGVyLmZpbmQocXVlcnksIGNvbnN0cmFpbnRzKTtcbiAgfVxuICBwcm90ZWN0ZWQgZ2V0Qm91bmRTY29wZShiaW5kaW5nU3RhY2s6YW55W10pOnt9IHtcbiAgICBsZXQgc2NvcGUgPSB7fTtcbiAgICBmb3IobGV0IGZhY3Qgb2YgYmluZGluZ1N0YWNrKSB7XG4gICAgICBmb3IobGV0IGFsaWFzIGluIGZhY3QpIHNjb3BlW2FsaWFzXSA9IGZhY3RbYWxpYXNdO1xuICAgIH1cbiAgICByZXR1cm4gc2NvcGU7XG4gIH1cblxuICAvL0BGSVhNRTogV2hhdCBkbyBhYm91dCBzb3VyY2U/XG4gIHByb3RlY3RlZCBnZXRCb3VuZFZhbHVlKHNvdXJjZTpzdHJpbmcsIGFsaWFzOnN0cmluZywgYmluZGluZ1N0YWNrOmFueVtdKTphbnkgeyAvLyBARklYTUU6IEZpbmRzIGRvbid0IGNyZWF0ZSBhIHNvdXJjZSBmaWVsZCBvbiB0aGUgcmVzdWx0LlxuICAgIGZvcihsZXQgaXggPSBiaW5kaW5nU3RhY2subGVuZ3RoIC0gMTsgaXggPj0gMDsgaXgtLSkge1xuICAgICAgbGV0IGZhY3QgPSBiaW5kaW5nU3RhY2tbaXhdO1xuICAgICAgaWYoc291cmNlIGluIGZhY3QgJiYgZmFjdFthbGlhc10pIHJldHVybiBmYWN0W2FsaWFzXTtcbiAgICB9XG4gIH1cbiAgcHJvdGVjdGVkIGdlbmVyYXRlRXZlbnRIYW5kbGVyKGVsZW06RWxlbWVudCwgZXZlbnQ6c3RyaW5nLCBiaW5kaW5nU3RhY2s6YW55W10pOkhhbmRsZXI8RXZlbnQ+IHtcbiAgICBsZXQgdGVtcGxhdGUgPSBlbGVtW1wiX3RlbXBsYXRlXCJdO1xuICAgIGxldCBtZW1vS2V5ID0gYCR7dGVtcGxhdGV9Ojoke2V2ZW50fWA7XG4gICAgbGV0IGF0dHJLZXkgPSBgJHtldmVudH06OnN0YXRlYDtcbiAgICBlbGVtW2F0dHJLZXldID0gdGhpcy5nZXRFdmVudFN0YXRlKHRlbXBsYXRlLCBldmVudCwgYmluZGluZ1N0YWNrKTtcbiAgICBpZih0aGlzLl9oYW5kbGVyc1ttZW1vS2V5XSkgcmV0dXJuIHRoaXMuX2hhbmRsZXJzW21lbW9LZXldO1xuXG4gICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgIGlmKGV2ZW50ID09PSBcImNoYW5nZVwiIHx8IGV2ZW50ID09PSBcImlucHV0XCIpIHtcbiAgICAgIHRoaXMuX2hhbmRsZXJzW21lbW9LZXldID0gKGV2dDpFdmVudCwgZWxlbTpFbGVtZW50KSA9PiB7XG4gICAgICAgIGxldCBwcm9wczphbnkgPSB7fTtcbiAgICAgICAgaWYoZWxlbS50ID09PSBcInNlbGVjdFwiIHx8IGVsZW0udCA9PT0gXCJpbnB1dFwiIHx8IGVsZW0udCA9PT0gXCJ0ZXh0YXJlYVwiKSBwcm9wcy52YWx1ZSA9ICg8SFRNTFNlbGVjdEVsZW1lbnR8SFRNTElucHV0RWxlbWVudD5ldnQudGFyZ2V0KS52YWx1ZTtcbiAgICAgICAgaWYoZWxlbS50eXBlID09PSBcImNoZWNrYm94XCIpIHByb3BzLnZhbHVlID0gKDxIVE1MSW5wdXRFbGVtZW50PmV2dC50YXJnZXQpLmNoZWNrZWQ7XG4gICAgICAgIHNlbGYuaGFuZGxlRXZlbnQodGVtcGxhdGUsIGV2ZW50LCBldnQsIGVsZW0sIHByb3BzKTtcbiAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX2hhbmRsZXJzW21lbW9LZXldID0gKGV2dDpFdmVudCwgZWxlbTpFbGVtZW50KSA9PiB7XG4gICAgICAgIHNlbGYuaGFuZGxlRXZlbnQodGVtcGxhdGUsIGV2ZW50LCBldnQsIGVsZW0sIHt9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5faGFuZGxlcnNbbWVtb0tleV07XG4gIH1cbiAgcHJvdGVjdGVkIGhhbmRsZUV2ZW50KHRlbXBsYXRlOnN0cmluZywgZXZlbnROYW1lOnN0cmluZywgZXZlbnQ6RXZlbnQsIGVsZW06RWxlbWVudCwgZXZlbnRQcm9wczp7fSkge1xuICAgIGxldCBhdHRyS2V5ID0gYCR7ZXZlbnROYW1lfTo6c3RhdGVgO1xuICAgIGxldCBzdGF0ZSA9IGVsZW1bYXR0cktleV07XG4gICAgbGV0IGNvbnRlbnQgPSB1bnBhZCg2KSBgXG4gICAgICAjICR7ZXZlbnROYW1lfSAoe2lzIGE6IGV2ZW50fSlcbiAgICAgICMjIE1ldGFcbiAgICAgIGV2ZW50IHRhcmdldDoge2V2ZW50IHRhcmdldDogJHtlbGVtLmlkfX1cbiAgICAgIGV2ZW50IHRlbXBsYXRlOiB7ZXZlbnQgdGVtcGxhdGU6ICR7dGVtcGxhdGV9fVxuICAgICAgZXZlbnQgdHlwZToge2V2ZW50IHR5cGU6ICR7ZXZlbnROYW1lfX1cblxuICAgICAgIyMgU3RhdGVcbiAgICBgO1xuICAgIGlmKHN0YXRlW1wiKmV2ZW50KlwiXSkge1xuICAgICAgZm9yKGxldCBwcm9wIGluIHN0YXRlW1wiKmV2ZW50KlwiXSlcbiAgICAgICAgY29udGVudCArPSBgJHtwcm9wfTogeyR7cHJvcH06ICR7ZXZlbnRQcm9wc1tzdGF0ZVtcIipldmVudCpcIl1bcHJvcF1dfX1cXG5gO1xuICAgIH1cbiAgICBmb3IobGV0IHByb3AgaW4gc3RhdGUpIHtcbiAgICAgIGlmKHByb3AgPT09IFwiKmV2ZW50KlwiKSBjb250aW51ZTtcbiAgICAgIGNvbnRlbnQgKz0gYCR7cHJvcH06IHske3Byb3B9OiAke3N0YXRlW3Byb3BdfX1cXG5gXG4gICAgfVxuXG4gICAgbGV0IGNoYW5nZXNldCA9IHRoaXMuaXhlci5kaWZmKCk7XG4gICAgbGV0IHJhdyA9IHV1aWQoKTtcbiAgICBsZXQgZW50aXR5ID0gYCR7ZXZlbnROYW1lfSBldmVudCAke3Jhdy5zbGljZSgtMTIpfWA7XG4gICAgY2hhbmdlc2V0LmFkZChcImJ1aWx0aW4gZW50aXR5XCIsIHtlbnRpdHksIGNvbnRlbnR9KTtcbiAgICB0aGlzLml4ZXIuYXBwbHlEaWZmKGNoYW5nZXNldCk7XG4gICAgY29uc29sZS5sb2coZW50aXR5KTtcbiAgfVxuXG4gIHByb3RlY3RlZCBnZXRFdmVudFN0YXRlKHRlbXBsYXRlOnN0cmluZywgZXZlbnQ6c3RyaW5nLCBiaW5kaW5nU3RhY2s6YW55W10pOnt9IHtcbiAgICBsZXQgc3RhdGUgPSB7fTtcbiAgICBsZXQgc3RhdGljQXR0cnMgPSB0aGlzLml4ZXIuZmluZChcInVpIGV2ZW50IHN0YXRlXCIsIHtcInVpIGV2ZW50IHN0YXRlOiB0ZW1wbGF0ZVwiOiB0ZW1wbGF0ZSwgXCJ1aSBldmVudCBzdGF0ZTogZXZlbnRcIjogZXZlbnR9KTtcbiAgICBmb3IobGV0IHtcInVpIGV2ZW50IHN0YXRlOiBrZXlcIjoga2V5LCBcInVpIGV2ZW50IHN0YXRlOiB2YWx1ZVwiOiB2YWx9IG9mIHN0YXRpY0F0dHJzKSBzdGF0ZVtrZXldID0gdmFsO1xuXG4gICAgbGV0IGJvdW5kQXR0cnMgPSB0aGlzLml4ZXIuZmluZChcInVpIGV2ZW50IHN0YXRlIGJpbmRpbmdcIiwge1widWkgZXZlbnQgc3RhdGUgYmluZGluZzogdGVtcGxhdGVcIjogdGVtcGxhdGUsIFwidWkgZXZlbnQgc3RhdGUgYmluZGluZzogZXZlbnRcIjogZXZlbnR9KTtcbiAgICBmb3IobGV0IHtcInVpIGV2ZW50IHN0YXRlIGJpbmRpbmc6IGtleVwiOiBrZXksIFwidWkgZXZlbnQgc3RhdGUgYmluZGluZzogc291cmNlXCI6IHNvdXJjZSwgXCJ1aSBldmVudCBzdGF0ZSBiaW5kaW5nOiBhbGlhc1wiOiBhbGlhc30gb2YgYm91bmRBdHRycykge1xuICAgICAgaWYoc291cmNlID09PSBcIipldmVudCpcIikge1xuICAgICAgICBzdGF0ZVtcIipldmVudCpcIl0gPSBzdGF0ZVtcIipldmVudCpcIl0gfHwge307XG4gICAgICAgIHN0YXRlW1wiKmV2ZW50KlwiXVtrZXldID0gYWxpYXM7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdGF0ZVtrZXldID0gdGhpcy5nZXRCb3VuZFZhbHVlKHNvdXJjZSwgYWxpYXMsIGJpbmRpbmdTdGFjayk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHN0YXRlO1xuICB9XG59XG5cbmRlY2xhcmUgdmFyIGV4cG9ydHM7XG5pZih0aGlzLndpbmRvdykgd2luZG93W1widWlSZW5kZXJlclwiXSA9IGV4cG9ydHM7IiwiZGVjbGFyZSB2YXIgcGx1cmFsaXplOyAvLyBAVE9ETzogaW1wb3J0IG1lLlxuaW1wb3J0IHtidWlsdGluSWQsIGNvcHksIGNvZXJjZUlucHV0LCBzb3J0QnlMb29rdXAsIHNvcnRCeUZpZWxkLCBLRVlTfSBmcm9tIFwiLi91dGlsc1wiO1xuaW1wb3J0IHtFbGVtZW50LCBIYW5kbGVyfSBmcm9tIFwiLi9taWNyb1JlYWN0XCI7XG5pbXBvcnQge2Rpc3BhdGNoLCBldmV9IGZyb20gXCIuL2FwcFwiO1xuaW1wb3J0IHtQQU5FLCB1aVN0YXRlIGFzIF9zdGF0ZX0gZnJvbSBcIi4vdWlcIjtcbmltcG9ydCB7bWFzb25yeSBhcyBtYXNvbnJ5UmF3LCBNYXNvbnJ5TGF5b3V0fSBmcm9tIFwiLi9tYXNvbnJ5XCI7XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBVdGlsaXRpZXNcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5leHBvcnQgZnVuY3Rpb24gcmVzb2x2ZU5hbWUobWF5YmVJZDpzdHJpbmcpOnN0cmluZyB7XG4gIGxldCBkaXNwbGF5ID0gZXZlLmZpbmRPbmUoXCJkaXNwbGF5IG5hbWVcIiwge2lkOiBtYXliZUlkfSk7XG4gIHJldHVybiBkaXNwbGF5ID8gZGlzcGxheS5uYW1lIDogbWF5YmVJZDtcbn1cbmV4cG9ydCBmdW5jdGlvbiByZXNvbHZlSWQobWF5YmVOYW1lOnN0cmluZyk6c3RyaW5nIHtcbiAgbGV0IGRpc3BsYXkgPSBldmUuZmluZE9uZShcImRpc3BsYXkgbmFtZVwiLCB7bmFtZTogbWF5YmVOYW1lfSk7XG4gIHJldHVybiBkaXNwbGF5ID8gZGlzcGxheS5pZCA6IG1heWJlTmFtZTtcbn1cbmV4cG9ydCBmdW5jdGlvbiByZXNvbHZlVmFsdWUobWF5YmVWYWx1ZTpzdHJpbmcpOnN0cmluZyB7XG4gIGlmKHR5cGVvZiBtYXliZVZhbHVlICE9PSBcInN0cmluZ1wiKSByZXR1cm4gbWF5YmVWYWx1ZTtcbiAgbGV0IHZhbCA9IG1heWJlVmFsdWUudHJpbSgpO1xuICBpZih2YWwuaW5kZXhPZihcIj1cIikgPT09IDApIHtcbiAgICAvLyBAVE9ETzogUnVuIHRocm91Z2ggdGhlIGZ1bGwgTkxQLlxuICAgIGxldCBzZWFyY2ggPSB2YWwuc3Vic3RyaW5nKDEpLnRyaW0oKTtcbiAgICByZXR1cm4gcmVzb2x2ZUlkKHNlYXJjaCk7XG4gIH1cbiAgcmV0dXJuIHZhbDtcbn1cbmV4cG9ydCBmdW5jdGlvbiBpc0VudGl0eShtYXliZUlkOnN0cmluZyk6Ym9vbGVhbiB7XG4gIHJldHVybiAhIWV2ZS5maW5kT25lKFwiZW50aXR5XCIsIHtlbnRpdHk6IG1heWJlSWR9KTtcbn1cblxubGV0IHdvcmRTcGxpdHRlciA9IC9cXHMrL2dpO1xuY29uc3Qgc3RhdFdlaWdodHMgPSB7bGlua3M6IDEwMCwgcGFnZXM6IDIwMCwgd29yZHM6IDF9O1xuZnVuY3Rpb24gY2xhc3NpZnlFbnRpdGllcyhyYXdFbnRpdGllczpzdHJpbmdbXSkge1xuICBsZXQgZW50aXRpZXMgPSByYXdFbnRpdGllcy5zbGljZSgpO1xuICBsZXQgY29sbGVjdGlvbnM6c3RyaW5nW10gPSBbXTtcbiAgbGV0IHN5c3RlbXM6c3RyaW5nW10gPSBbXTtcblxuICAvLyBNZWFzdXJlIHJlbGF0ZWRuZXNzICsgbGVuZ3RoIG9mIGVudGl0aWVzXG4gIC8vIEBUT0RPOiBtdGltZXMgb2YgZW50aXRpZXNcbiAgbGV0IHJlbGF0ZWRDb3VudHM6e1tlbnRpdHk6c3RyaW5nXTogbnVtYmVyfSA9IHt9O1xuICBsZXQgd29yZENvdW50czp7W2VudGl0eTpzdHJpbmddOiBudW1iZXJ9ID0ge307XG4gIGxldCBjaGlsZENvdW50czp7W2NvbGxlY3Rpb246c3RyaW5nXTogbnVtYmVyfSA9IHt9O1xuICBsZXQgc2NvcmVzOntbZW50aXR5OnN0cmluZ106IG51bWJlcn0gPXt9O1xuICBmb3IobGV0IGVudGl0eSBvZiBlbnRpdGllcykge1xuICAgIGxldCB7Y29udGVudCA9IFwiXCJ9ID0gZXZlLmZpbmRPbmUoXCJlbnRpdHlcIiwge2VudGl0eX0pIHx8IHt9O1xuICAgIHJlbGF0ZWRDb3VudHNbZW50aXR5XSA9IGV2ZS5maW5kKFwiZGlyZWN0aW9ubGVzcyBsaW5rc1wiLCB7ZW50aXR5fSkubGVuZ3RoO1xuICAgIHdvcmRDb3VudHNbZW50aXR5XSA9IGNvbnRlbnQudHJpbSgpLnJlcGxhY2Uod29yZFNwbGl0dGVyLCBcIiBcIikuc3BsaXQoXCIgXCIpLmxlbmd0aDtcbiAgICBsZXQge2NvdW50OmNoaWxkQ291bnQgPSAwfSA9IGV2ZS5maW5kT25lKFwiY29sbGVjdGlvblwiLCB7Y29sbGVjdGlvbjogZW50aXR5fSkgfHwge307XG4gICAgY2hpbGRDb3VudHNbZW50aXR5XSA9IGNoaWxkQ291bnQ7XG4gICAgc2NvcmVzW2VudGl0eV0gPVxuICAgICAgcmVsYXRlZENvdW50c1tlbnRpdHldICogc3RhdFdlaWdodHMubGlua3MgK1xuICAgICAgd29yZENvdW50c1tlbnRpdHldICogc3RhdFdlaWdodHMud29yZHMgK1xuICAgICAgY2hpbGRDb3VudHNbZW50aXR5XSAqIHN0YXRXZWlnaHRzLnBhZ2VzO1xuICB9XG4gIFxuICAvLyBTZXBhcmF0ZSBzeXN0ZW0gZW50aXRpZXNcbiAgbGV0IGl4ID0gMDtcbiAgd2hpbGUoaXggPCBlbnRpdGllcy5sZW5ndGgpIHtcbiAgICBpZihldmUuZmluZE9uZShcImlzIGEgYXR0cmlidXRlc1wiLCB7Y29sbGVjdGlvbjogYnVpbHRpbklkKFwic3lzdGVtXCIpLCBlbnRpdHk6IGVudGl0aWVzW2l4XX0pKSB7XG4gICAgICBzeXN0ZW1zLnB1c2goZW50aXRpZXMuc3BsaWNlKGl4LCAxKVswXSk7XG4gICAgfSBlbHNlIGl4Kys7XG4gIH1cbiAgXG4gIC8vIFNlcGFyYXRlIHVzZXIgY29sbGVjdGlvbnMgZnJvbSBvdGhlciBlbnRpdGllc1xuICBpeCA9IDA7XG4gIHdoaWxlKGl4IDwgZW50aXRpZXMubGVuZ3RoKSB7XG4gICAgaWYoY2hpbGRDb3VudHNbZW50aXRpZXNbaXhdXSkge1xuICAgICAgY29sbGVjdGlvbnMucHVzaChlbnRpdGllcy5zcGxpY2UoaXgsIDEpWzBdKTtcbiAgICB9IGVsc2UgaXgrKztcbiAgfVxuXG4gIHJldHVybiB7c3lzdGVtcywgY29sbGVjdGlvbnMsIGVudGl0aWVzLCBzY29yZXMsIHJlbGF0ZWRDb3VudHMsIHdvcmRDb3VudHMsIGNoaWxkQ291bnRzfTtcbn1cblxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gSGFuZGxlcnNcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5mdW5jdGlvbiBwcmV2ZW50RGVmYXVsdChldmVudCkge1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xufVxuZnVuY3Rpb24gcHJldmVudERlZmF1bHRVbmxlc3NGb2N1c2VkKGV2ZW50KSB7XG4gIGlmKGV2ZW50LnRhcmdldCAhPT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbn1cblxuZnVuY3Rpb24gY2xvc2VQb3B1cCgpIHtcbiAgbGV0IHBvcG91dCA9IGV2ZS5maW5kT25lKFwidWkgcGFuZVwiLCB7a2luZDogUEFORS5QT1BPVVR9KTtcbiAgaWYocG9wb3V0KSBkaXNwYXRjaChcInJlbW92ZSBwb3B1cFwiLCB7cGFuZUlkOiBwb3BvdXQucGFuZX0pLmNvbW1pdCgpO1xufVxuXG5mdW5jdGlvbiBuYXZpZ2F0ZShldmVudCwgZWxlbSkge1xuICBsZXQge3BhbmVJZH0gPSBlbGVtLmRhdGE7XG4gIGxldCBpbmZvOmFueSA9IHtwYW5lSWQsIHZhbHVlOiBlbGVtLmxpbmssIHBlZWs6IGVsZW0ucGVla307XG4gIGlmKGV2ZW50LmNsaWVudFgpIHtcbiAgICBpbmZvLnggPSBcImNhbGMoNTAlIC0gMzUwcHgpXCI7IFxuICAgIGluZm8ueSA9IGV2ZW50LmNsaWVudFk7XG4gIH1cbiAgZGlzcGF0Y2goXCJ1aSBzZXQgc2VhcmNoXCIsIGluZm8pLmNvbW1pdCgpO1xuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xufVxuXG5mdW5jdGlvbiBuYXZpZ2F0ZU9yRWRpdChldmVudCwgZWxlbSkge1xuICBsZXQgcG9wb3V0ID0gZXZlLmZpbmRPbmUoXCJ1aSBwYW5lXCIsIHtraW5kOiBQQU5FLlBPUE9VVH0pO1xuICBsZXQgcGVla2luZyA9IHBvcG91dCAmJiBwb3BvdXQuY29udGFpbnMgPT09IGVsZW0ubGluaztcbiAgaWYoZXZlbnQudGFyZ2V0ID09PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50KSB7fVxuICBlbHNlIGlmKCFwZWVraW5nKSBuYXZpZ2F0ZShldmVudCwgZWxlbSk7XG4gIGVsc2Uge1xuICAgIGNsb3NlUG9wdXAoKTtcbiAgICBldmVudC50YXJnZXQuZm9jdXMoKTtcbiAgfVxufVxuXG5pbnRlcmZhY2UgVGFibGVSb3dFbGVtIGV4dGVuZHMgRWxlbWVudCB7IHRhYmxlOiBzdHJpbmcsIHJvdzogYW55LCByb3dzPzogYW55W10gfVxuaW50ZXJmYWNlIFRhYmxlQ2VsbEVsZW0gZXh0ZW5kcyBFbGVtZW50IHsgcm93OiBUYWJsZVJvd0VsZW0sIGZpZWxkOiBzdHJpbmcsIHJvd3M/OiBhbnlbXX1cbmludGVyZmFjZSBUYWJsZUZpZWxkRWxlbSBleHRlbmRzIEVsZW1lbnQgeyB0YWJsZTogc3RyaW5nLCBmaWVsZDogc3RyaW5nLCBkaXJlY3Rpb24/OiBudW1iZXIgfVxuXG5mdW5jdGlvbiB1cGRhdGVFbnRpdHlWYWx1ZShldmVudDpDdXN0b21FdmVudCwgZWxlbTpUYWJsZUNlbGxFbGVtKSB7XG4gIGxldCB2YWx1ZSA9IGNvZXJjZUlucHV0KGV2ZW50LmRldGFpbCk7XG4gIGxldCB7cm93OnJvd0VsZW0sIGZpZWxkfSA9IGVsZW07XG4gIGxldCB7dGFibGU6dGFibGVFbGVtLCByb3d9ID0gcm93RWxlbTtcbiAgbGV0IGVudGl0eSA9IHRhYmxlRWxlbVtcImVudGl0eVwiXTtcbiAgbGV0IHJvd3MgPSBlbGVtLnJvd3MgfHwgW3Jvd107XG4gIGxldCBjaGFpbiA9IGRpc3BhdGNoKCk7XG4gIGZvcihsZXQgcm93IG9mIHJvd3MpIHtcbiAgICBpZihmaWVsZCA9PT0gXCJ2YWx1ZVwiICYmIHJvdy52YWx1ZSAhPT0gdmFsdWUgJiYgcm93LmF0dHJpYnV0ZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBjaGFpbi5kaXNwYXRjaChcInVwZGF0ZSBlbnRpdHkgYXR0cmlidXRlXCIsIHtlbnRpdHksIGF0dHJpYnV0ZTogcm93LmF0dHJpYnV0ZSwgcHJldjogcm93LnZhbHVlLCB2YWx1ZX0pO1xuICAgIH0gZWxzZSBpZihmaWVsZCA9PT0gXCJhdHRyaWJ1dGVcIiAmJiByb3cuYXR0cmlidXRlICE9PSB2YWx1ZSAmJiByb3cudmFsdWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgY2hhaW4uZGlzcGF0Y2goXCJyZW5hbWUgZW50aXR5IGF0dHJpYnV0ZVwiLCB7ZW50aXR5LCBwcmV2OiByb3cuYXR0cmlidXRlLCBhdHRyaWJ1dGU6IHZhbHVlLCB2YWx1ZTogcm93LnZhbHVlfSk7XG4gICAgfVxuICB9XG4gIGNoYWluLmNvbW1pdCgpO1xufVxuZnVuY3Rpb24gdXBkYXRlRW50aXR5QXR0cmlidXRlcyhldmVudDpDdXN0b21FdmVudCwgZWxlbTp7cm93OiBUYWJsZVJvd0VsZW19KSB7XG4gIGxldCB7dGFibGU6dGFibGVFbGVtLCByb3d9ID0gZWxlbS5yb3c7XG4gIGxldCBlbnRpdHkgPSB0YWJsZUVsZW1bXCJlbnRpdHlcIl07XG4gIGlmKGV2ZW50LmRldGFpbCA9PT0gXCJhZGRcIikge1xuICAgIGxldCBzdGF0ZSA9IGVsZW1bXCJzdGF0ZVwiXVtcImFkZGVyXCJdO1xuICAgIHZhciB2YWxpZCA9IGVsZW1bXCJmaWVsZHNcIl0uZXZlcnkoKGZpZWxkKSA9PiB7XG4gICAgICByZXR1cm4gc3RhdGVbZmllbGRdICE9PSB1bmRlZmluZWQ7XG4gICAgfSk7XG4gICAgaWYodmFsaWQpIHtcbiAgICAgIGRpc3BhdGNoKFwiYWRkIHNvdXJjZWQgZWF2XCIsIHtlbnRpdHksIGF0dHJpYnV0ZTogc3RhdGUuYXR0cmlidXRlLCB2YWx1ZTogcmVzb2x2ZVZhbHVlKHN0YXRlLnZhbHVlKX0pLmNvbW1pdCgpO1xuICAgICAgZWxlbVtcInN0YXRlXCJdW1wiYWRkZXJcIl0gPSB7fTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgZGlzcGF0Y2goXCJyZW1vdmUgZW50aXR5IGF0dHJpYnV0ZVwiLCB7ZW50aXR5LCBhdHRyaWJ1dGU6IHJvdy5hdHRyaWJ1dGUsIHZhbHVlOiByb3cudmFsdWV9KS5jb21taXQoKTtcbiAgfVxufVxuZnVuY3Rpb24gc29ydFRhYmxlKGV2ZW50LCBlbGVtOlRhYmxlRmllbGRFbGVtKSB7XG4gIGxldCB7a2V5LCBmaWVsZCA9IHVuZGVmaW5lZCwgZGlyZWN0aW9uID0gdW5kZWZpbmVkfSA9IGVsZW07XG4gIGNvbnNvbGUubG9nKGtleSwgZmllbGQsIGRpcmVjdGlvbik7XG4gIGlmKGZpZWxkID09PSB1bmRlZmluZWQgJiYgZGlyZWN0aW9uID09PSB1bmRlZmluZWQpIHtcbiAgICBmaWVsZCA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgICBjb25zb2xlLmxvZyhcIkVUVlwiLCBmaWVsZCk7XG4gIH1cbiAgZGlzcGF0Y2goXCJzb3J0IHRhYmxlXCIsIHtrZXksIGZpZWxkLCBkaXJlY3Rpb259KS5jb21taXQoKTtcbn1cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIEVtYmVkZGVkIGNlbGwgcmVwcmVzZW50YXRpb24gd3JhcHBlclxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbnZhciB1aXRrID0gdGhpcztcbmV4cG9ydCBmdW5jdGlvbiBlbWJlZGRlZENlbGwoZWxlbSk6RWxlbWVudCB7XG4gIGxldCBjaGlsZHJlbiA9IFtdO1xuICBsZXQge2NoaWxkSW5mbywgcmVwfSA9IGVsZW07XG4gIGlmKGNoaWxkSW5mby5jb25zdHJ1Y3RvciA9PT0gQXJyYXkpIHtcbiAgICBmb3IobGV0IGNoaWxkIG9mIGNoaWxkSW5mbykge1xuICAgICAgY2hpbGRbXCJkYXRhXCJdID0gY2hpbGRbXCJkYXRhXCJdIHx8IGNoaWxkSW5mby5wYXJhbXM7XG4gICAgICBjaGlsZHJlbi5wdXNoKHVpdGtbcmVwXShjaGlsZCkpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBjaGlsZHJlbi5wdXNoKHVpdGtbcmVwXShjaGlsZEluZm8pKTtcbiAgfVxuICBjaGlsZHJlbi5wdXNoKHtjOiBcImVkaXQtYnV0dG9uLWNvbnRhaW5lclwiLCBjaGlsZHJlbjogW1xuICAgIHtjOiBcImVkaXQtYnV0dG9uIGlvbi1lZGl0XCIsIGNsaWNrOiBlbGVtLmNsaWNrLCBjZWxsOiBlbGVtLmNlbGx9XG4gIF19KTtcbiAgcmV0dXJuIHtjOiBcIm5vbi1lZGl0aW5nLWVtYmVkZGVkLWNlbGxcIiwgY2hpbGRyZW4sIGNlbGw6IGVsZW0uY2VsbH07XG59XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBSZXByZXNlbnRhdGlvbnMgZm9yIEVycm9yc1xuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZXhwb3J0IGZ1bmN0aW9uIGVycm9yKGVsZW0pOkVsZW1lbnQge1xuICBlbGVtLmMgPSBgZXJyb3ItcmVwICR7ZWxlbS5jIHx8IFwiXCJ9YDtcbiAgY29uc29sZS5sb2coZWxlbSk7XG4gIHJldHVybiBlbGVtO1xufVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8gUmVwcmVzZW50YXRpb25zIGZvciBFbnRpdGllc1xuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmludGVyZmFjZSBFbnRpdHlFbGVtIGV4dGVuZHMgRWxlbWVudCB7IGVudGl0eTogc3RyaW5nLCBkYXRhPzogYW55IH1cblxuZXhwb3J0IGZ1bmN0aW9uIG5hbWUoZWxlbTpFbnRpdHlFbGVtKTpFbGVtZW50IHtcbiAgbGV0IHtlbnRpdHl9ID0gZWxlbTtcbiAgbGV0IHtuYW1lID0gZW50aXR5fSA9IGV2ZS5maW5kT25lKFwiZGlzcGxheSBuYW1lXCIsIHtpZDogZW50aXR5fSkgfHwge307XG4gIGVsZW0udGV4dCA9IG5hbWU7XG4gIGVsZW0uYyA9IGBlbnRpdHkgJHtlbGVtLmMgfHwgXCJcIn1gO1xuICByZXR1cm4gZWxlbTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxpbmsoZWxlbTpFbnRpdHlFbGVtKTpFbGVtZW50IHtcbiAgbGV0IHtlbnRpdHl9ID0gZWxlbTtcbiAgbGV0IG5hbWUgPSByZXNvbHZlTmFtZShlbnRpdHkpO1xuICBlbGVtLmMgPSBgJHtlbGVtLmMgfHwgXCJcIn0gZW50aXR5IGxpbmsgaW5saW5lYDtcbiAgZWxlbS50ZXh0ID0gZWxlbS50ZXh0IHx8IG5hbWU7XG4gIGVsZW1bXCJsaW5rXCJdID0gZWxlbVtcImxpbmtcIl0gfHwgZW50aXR5O1xuICBlbGVtLmNsaWNrID0gZWxlbS5jbGljayB8fCBuYXZpZ2F0ZTtcbiAgZWxlbVtcInBlZWtcIl0gPSBlbGVtW1wicGVla1wiXSAhPT0gdW5kZWZpbmVkID8gZWxlbVtcInBlZWtcIl0gOiB0cnVlO1xuICByZXR1cm4gZWxlbTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGF0dHJpYnV0ZXMoZWxlbTpFbnRpdHlFbGVtKTpFbGVtZW50IHtcbiAgbGV0IHtlbnRpdHl9ID0gZWxlbTtcbiAgbGV0IGF0dHJpYnV0ZXMgPSBbXTtcbiAgZm9yKGxldCBlYXYgb2YgZXZlLmZpbmQoXCJlbnRpdHkgZWF2c1wiLCB7ZW50aXR5fSkpIGF0dHJpYnV0ZXMucHVzaCh7YXR0cmlidXRlOiBlYXYuYXR0cmlidXRlLCB2YWx1ZTogZWF2LnZhbHVlfSk7XG4gIGF0dHJpYnV0ZXMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgaWYoYS5hdHRyaWJ1dGUgPT09IGIuYXR0cmlidXRlKSByZXR1cm4gMDtcbiAgICAgIGVsc2UgaWYoYS5hdHRyaWJ1dGUgPCBiLmF0dHJpYnV0ZSkgcmV0dXJuIC0xO1xuICAgICAgcmV0dXJuIDE7XG4gIH0pXG4gIGVsZW1bXCJncm91cHNcIl0gPSBbXCJhdHRyaWJ1dGVcIl07XG4gIGVsZW1bXCJyb3dzXCJdID0gYXR0cmlidXRlcztcbiAgZWxlbVtcImVkaXRDZWxsXCJdID0gdXBkYXRlRW50aXR5VmFsdWU7XG4gIGVsZW1bXCJlZGl0Um93XCJdID0gdXBkYXRlRW50aXR5QXR0cmlidXRlcztcbiAgZWxlbVtcIm5vSGVhZGVyXCJdID0gdHJ1ZTtcbiAgcmV0dXJuIHRhYmxlKDxhbnk+ZWxlbSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZWxhdGVkKGVsZW06RW50aXR5RWxlbSk6RWxlbWVudCB7XG4gIGxldCB7ZW50aXR5LCBkYXRhID0gdW5kZWZpbmVkfSA9IGVsZW07XG4gIGxldCBuYW1lID0gcmVzb2x2ZU5hbWUoZW50aXR5KTtcbiAgbGV0IHJlbGF0aW9ucyA9IFtdO1xuICBmb3IobGV0IGxpbmsgb2YgZXZlLmZpbmQoXCJkaXJlY3Rpb25sZXNzIGxpbmtzXCIsIHtlbnRpdHl9KSkgcmVsYXRpb25zLnB1c2gobGluay5saW5rKTtcbiAgZWxlbS5jID0gZWxlbS5jICE9PSB1bmRlZmluZWQgPyBlbGVtLmMgOiBcImZsZXgtcm93IGZsZXgtd3JhcCBjc3ZcIjtcbiAgaWYocmVsYXRpb25zLmxlbmd0aCkge1xuICAgIGVsZW0uY2hpbGRyZW4gPSBbe3Q6IFwiaDJcIiwgdGV4dDogYCR7bmFtZX0gaXMgcmVsYXRlZCB0byAke3JlbGF0aW9ucy5sZW5ndGh9ICR7cGx1cmFsaXplKFwiZW50aXRpZXNcIiwgcmVsYXRpb25zLmxlbmd0aCl9OmB9XTtcbiAgICBmb3IobGV0IHJlbCBvZiByZWxhdGlvbnMpIGVsZW0uY2hpbGRyZW4ucHVzaChsaW5rKHtlbnRpdHk6IHJlbCwgZGF0YX0pKTtcblxuICB9IGVsc2UgZWxlbS50ZXh0ID0gYCR7bmFtZX0gaXMgbm90IHJlbGF0ZWQgdG8gYW55IG90aGVyIGVudGl0aWVzLmA7XG4gIHJldHVybiBlbGVtO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaW5kZXgoZWxlbTpFbnRpdHlFbGVtKTpFbGVtZW50IHtcbiAgbGV0IHtlbnRpdHl9ID0gZWxlbTtcbiAgbGV0IG5hbWUgPSByZXNvbHZlTmFtZShlbnRpdHkpO1xuICBsZXQgZmFjdHMgPSBldmUuZmluZChcImlzIGEgYXR0cmlidXRlc1wiLCB7Y29sbGVjdGlvbjogZW50aXR5fSk7XG4gIGxldCBsaXN0ID0ge3Q6IFwidWxcIiwgY2hpbGRyZW46IFtdfTtcbiAgZm9yKGxldCBmYWN0IG9mIGZhY3RzKSBsaXN0LmNoaWxkcmVuLnB1c2gobGluayh7dDogXCJsaVwiLCBlbnRpdHk6IGZhY3QuZW50aXR5LCBkYXRhOiBlbGVtLmRhdGF9KSk7XG4gIFxuICBlbGVtLmNoaWxkcmVuID0gW1xuICAgIHt0OiBcImgyXCIsIHRleHQ6IGBUaGVyZSAke3BsdXJhbGl6ZShcImFyZVwiLCBmYWN0cy5sZW5ndGgpfSAke2ZhY3RzLmxlbmd0aH0gJHtwbHVyYWxpemUobmFtZSwgZmFjdHMubGVuZ3RoKX06YH0sXG4gICAgbGlzdFxuICBdO1xuICByZXR1cm4gZWxlbTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHZpZXcoZWxlbTpFbnRpdHlFbGVtKTpFbGVtZW50IHtcbiAgbGV0IHtlbnRpdHl9ID0gZWxlbTtcbiAgbGV0IG5hbWUgPSByZXNvbHZlTmFtZShlbnRpdHkpO1xuICAvLyBAVE9ETzogQ2hlY2sgaWYgZ2l2ZW4gZW50aXR5IGlzIGEgdmlldywgb3IgcmVuZGVyIGFuIGVycm9yXG4gIFxuICBsZXQgcm93cyA9IGV2ZS5maW5kKGVudGl0eSk7XG4gIGVsZW1bXCJyb3dzXCJdID0gcm93cztcbiAgcmV0dXJuIHRhYmxlKDxhbnk+ZWxlbSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXN1bHRzKGVsZW06RW50aXR5RWxlbSk6RWxlbWVudCB7XG4gIGxldCB7ZW50aXR5LCBkYXRhID0gdW5kZWZpbmVkfSA9IGVsZW07XG4gIGVsZW0uY2hpbGRyZW4gPSBbbmFtZSh7ZW50aXR5LCBkYXRhfSldO1xuICBmb3IobGV0IGVhdiBvZiBldmUuZmluZChcImVudGl0eSBlYXZzXCIsIHtlbnRpdHksIGF0dHJpYnV0ZTogXCJhcnRpZmFjdFwifSkpIHtcbiAgICBlbGVtLmNoaWxkcmVuLnB1c2goXG4gICAgICBuYW1lKHt0OiBcImgzXCIsIGVudGl0eTogZWF2LnZhbHVlLCBkYXRhfSksXG4gICAgICB2aWV3KHtlbnRpdHk6IGVhdi52YWx1ZSwgZGF0YX0pXG4gICAgKTtcbiAgfVxuICByZXR1cm4gZWxlbTtcbn1cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIFJlcHJlc2VudGF0aW9ucyBmb3IgdmFsdWVzXG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuaW50ZXJmYWNlIFZhbHVlRWxlbSBleHRlbmRzIEVsZW1lbnQgeyBlZGl0YWJsZT86IGJvb2xlYW4sIGF1dG9saW5rPzogYm9vbGVhbiB9XG5leHBvcnQgZnVuY3Rpb24gdmFsdWUoZWxlbTpWYWx1ZUVsZW0pOkVsZW1lbnQge1xuICBsZXQge3RleHQ6dmFsID0gXCJcIiwgYXV0b2xpbmsgPSB0cnVlLCBlZGl0YWJsZSA9IGZhbHNlfSA9IGVsZW07XG4gIGVsZW1bXCJvcmlnaW5hbFwiXSA9IHZhbDtcbiAgbGV0IGNsZWFudXA7XG4gIGlmKGlzRW50aXR5KHZhbCkpIHtcbiAgICBlbGVtW1wiZW50aXR5XCJdID0gdmFsO1xuICAgIGVsZW0udGV4dCA9IHJlc29sdmVOYW1lKHZhbCk7XG4gICAgaWYoYXV0b2xpbmspIGVsZW0gPSBsaW5rKDxhbnk+ZWxlbSk7XG4gICAgaWYoZWRpdGFibGUgJiYgYXV0b2xpbmspIHtcbiAgICAgIGVsZW0ubW91c2Vkb3duID0gcHJldmVudERlZmF1bHRVbmxlc3NGb2N1c2VkO1xuICAgICAgZWxlbS5jbGljayA9IG5hdmlnYXRlT3JFZGl0O1xuICAgICAgY2xlYW51cCA9IGNsb3NlUG9wdXA7XG4gICAgfVxuICB9XG4gIGlmKGVkaXRhYmxlKSB7XG4gICAgaWYoZWxlbS50ICE9PSBcImlucHV0XCIpIHtcbiAgICAgIGVsZW0uY29udGVudEVkaXRhYmxlID0gdHJ1ZTtcbiAgICB9XG4gICAgLy8gZWxlbS50ID0gXCJpbnB1dFwiO1xuICAgIGVsZW0ucGxhY2Vob2xkZXIgPSBcIjxlbXB0eT5cIjtcbiAgICBlbGVtLnZhbHVlID0gZWxlbS50ZXh0IHx8IFwiXCI7XG4gICAgbGV0IF9ibHVyID0gZWxlbS5ibHVyO1xuICAgIGVsZW0uYmx1ciA9IChldmVudDpGb2N1c0V2ZW50LCBlbGVtOkVsZW1lbnQpID0+IHtcbiAgICAgIGxldCBub2RlID0gPEhUTUxJbnB1dEVsZW1lbnQ+ZXZlbnQudGFyZ2V0O1xuICAgICAgaWYoX2JsdXIpIF9ibHVyKGV2ZW50LCBlbGVtKTtcbiAgICAgIGlmKG5vZGUudmFsdWUgPT09IGA9ICR7ZWxlbS52YWx1ZX1gKSBub2RlLnZhbHVlID0gZWxlbS52YWx1ZTtcbiAgICAgIGlmKGVsZW0udmFsdWUgIT09IHZhbCkgbm9kZS5jbGFzc0xpc3QuYWRkKFwibGlua1wiKTtcbiAgICAgIGlmKGNsZWFudXApIGNsZWFudXAoZXZlbnQsIGVsZW0pO1xuICAgIH07XG5cbiAgICBsZXQgX2ZvY3VzID0gZWxlbS5mb2N1cztcbiAgICBlbGVtLmZvY3VzID0gKGV2ZW50OkZvY3VzRXZlbnQsIGVsZW06RWxlbWVudCkgPT4ge1xuICAgICAgbGV0IG5vZGUgPSA8SFRNTElucHV0RWxlbWVudD5ldmVudC50YXJnZXQ7XG4gICAgICBpZihlbGVtLnZhbHVlICE9PSB2YWwpIHtcbiAgICAgICAgbm9kZS52YWx1ZSA9IGA9ICR7ZWxlbS52YWx1ZX1gO1xuICAgICAgICBub2RlLmNsYXNzTGlzdC5yZW1vdmUoXCJsaW5rXCIpO1xuICAgICAgfVxuICAgICAgaWYoX2ZvY3VzKSBfZm9jdXMoZXZlbnQsIGVsZW0pO1xuICAgIH07XG4gIH1cbiAgcmV0dXJuIGVsZW07XG59XG5cbmludGVyZmFjZSBDU1ZFbGVtIGV4dGVuZHMgRWxlbWVudCB7IHZhbHVlczogYW55W10sIGF1dG9saW5rPzogYm9vbGVhbiB9XG5leHBvcnQgZnVuY3Rpb24gQ1NWKGVsZW06Q1NWRWxlbSk6RWxlbWVudCB7XG4gIGxldCB7dmFsdWVzLCBhdXRvbGluayA9IHVuZGVmaW5lZCwgZGF0YX0gPSBlbGVtO1xuICByZXR1cm4ge2M6IFwiZmxleC1yb3cgY3N2XCIsIGNoaWxkcmVuOiB2YWx1ZXMubWFwKCh2YWwpID0+IHZhbHVlKHt0OiBcInNwYW5cIiwgYXV0b2xpbmssIHRleHQ6IHZhbCwgZGF0YX0pKX07XG59XG5cbmludGVyZmFjZSBUYWJsZUVsZW0gZXh0ZW5kcyBFbGVtZW50IHsgcm93czoge31bXSwgc29ydGFibGU/OiBib29sZWFuLCBlZGl0Q2VsbD86IEhhbmRsZXI8RXZlbnQ+LCBlZGl0Um93PzogSGFuZGxlcjxFdmVudD4sIGVkaXRGaWVsZD86IEhhbmRsZXI8RXZlbnQ+LCBpZ25vcmVGaWVsZHM/OiBzdHJpbmdbXSwgaWdub3JlVGVtcD86IGJvb2xlYW4sIGRhdGE/OiBhbnksIGdyb3Vwcz86IHN0cmluZ1tdfVxuZXhwb3J0IGZ1bmN0aW9uIHRhYmxlKGVsZW06VGFibGVFbGVtKTpFbGVtZW50IHtcbiAgbGV0IHtyb3dzLCBpZ25vcmVGaWVsZHMgPSBbXCJfX2lkXCJdLCBzb3J0YWJsZSA9IGZhbHNlLCBpZ25vcmVUZW1wID0gdHJ1ZSwgZGF0YSA9IHVuZGVmaW5lZCwgbm9IZWFkZXIgPSBmYWxzZSwgZ3JvdXBzID0gW119ID0gZWxlbTtcbiAgaWYoIXJvd3MubGVuZ3RoKSB7XG4gICAgZWxlbS50ZXh0ID0gXCI8RW1wdHkgVGFibGU+XCI7XG4gICAgcmV0dXJuIGVsZW07XG4gIH1cbiAgaWYoc29ydGFibGUgJiYgIWVsZW0ua2V5KSB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgdHJhY2sgc29ydGluZyBzdGF0ZSBmb3IgYSB0YWJsZSB3aXRob3V0IGEga2V5XCIpO1xuXG4gIGxldCBsb2NhbFN0YXRlOmFueSA9IF9zdGF0ZS53aWRnZXQudGFibGVbZWxlbS5rZXldIHx8IHt9O1xuICBfc3RhdGUud2lkZ2V0LnRhYmxlW2VsZW0ua2V5XSA9IGxvY2FsU3RhdGU7XG5cbiAgbGV0IHtlZGl0Q2VsbCA9IHVuZGVmaW5lZCwgZWRpdFJvdyA9IHVuZGVmaW5lZCwgZWRpdEZpZWxkID0gdW5kZWZpbmVkfSA9IGVsZW07XG4gIGlmKGVkaXRDZWxsKSB7XG4gICAgbGV0IF9lZGl0Q2VsbCA9IGVkaXRDZWxsO1xuICAgIGVkaXRDZWxsID0gZnVuY3Rpb24oZXZlbnQ6RXZlbnQsIGVsZW0pIHtcbiAgICAgIGxldCBub2RlID0gPEhUTUxJbnB1dEVsZW1lbnQ+ZXZlbnQudGFyZ2V0O1xuICAgICAgbGV0IHZhbDtcbiAgICAgIGlmKG5vZGUubm9kZU5hbWUgPT09IFwiSU5QVVRcIikge1xuICAgICAgICB2YWwgPSByZXNvbHZlVmFsdWUobm9kZS52YWx1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YWwgPSByZXNvbHZlVmFsdWUobm9kZS50ZXh0Q29udGVudCk7XG4gICAgICB9XG4gICAgICBpZih2YWwgPT09IGVsZW1bXCJvcmlnaW5hbFwiXSkgcmV0dXJuO1xuICAgICAgbGV0IG5ldWVFdmVudCA9IG5ldyBDdXN0b21FdmVudChcImVkaXRjZWxsXCIsIHtkZXRhaWw6IHZhbH0pO1xuICAgICAgX2VkaXRDZWxsKG5ldWVFdmVudCwgZWxlbSk7XG4gICAgfVxuICB9XG4gIGlmKGVkaXRSb3cpIHtcbiAgICB2YXIgYWRkUm93ID0gKGV2dCwgZWxlbSkgPT4ge1xuICAgICAgbGV0IGV2ZW50ID0gbmV3IEN1c3RvbUV2ZW50KFwiZWRpdHJvd1wiLCB7ZGV0YWlsOiBcImFkZFwifSk7XG4gICAgICBlZGl0Um93KGV2ZW50LCBlbGVtKTtcbiAgICB9XG4gICAgdmFyIHRyYWNrSW5wdXQgPSAoZXZ0LCBlbGVtKSA9PiB7XG4gICAgICBsZXQgbm9kZSA9IDxIVE1MSW5wdXRFbGVtZW50PmV2dC50YXJnZXQ7XG4gICAgICBsb2NhbFN0YXRlW1wiYWRkZXJcIl1bZWxlbVtcImZpZWxkXCJdXSA9IG5vZGUudmFsdWU7XG4gICAgICBkaXNwYXRjaCgpLmNvbW1pdCgpO1xuICAgIH1cbiAgICB2YXIgcmVtb3ZlUm93ID0gKGV2dCwgZWxlbSkgPT4gZWRpdFJvdyhuZXcgQ3VzdG9tRXZlbnQoXCJlZGl0cm93XCIsIHtkZXRhaWw6IFwicmVtb3ZlXCJ9KSwgZWxlbSk7XG4gIH1cbiAgaWYoZWRpdEZpZWxkKSB7XG4gICAgLy8gQEZJWE1FOiBXcmFwIHRoZXNlIHdpdGggdGhlIGxvZ2ljIGZvciB0aGUgZWRpdGluZyBtb2RhbCwgb25seSBhZGQvcmVtb3ZlIG9uIGFjdHVhbCBjb21wbGV0ZWQgZmllbGRcbiAgICB2YXIgYWRkRmllbGQgPSAoZXZ0LCBlbGVtKSA9PiBlZGl0Um93KG5ldyBDdXN0b21FdmVudChcImVkaXRmaWVsZFwiLCB7ZGV0YWlsOiBcImFkZFwifSksIGVsZW0pO1xuICAgIHZhciByZW1vdmVGaWVsZCA9IChldnQsIGVsZW0pID0+IGVkaXRSb3cobmV3IEN1c3RvbUV2ZW50KFwiZWRpdGZpZWxkXCIsIHtkZXRhaWw6IFwicmVtb3ZlXCJ9KSwgZWxlbSk7XG4gIH1cblxuICAvLyBDb2xsYXRlIG5vbi1pZ25vcmVkIGZpZWxkc1xuICBsZXQgZmllbGRzID0gT2JqZWN0LmtleXMocm93c1swXSk7XG4gIGxldCBmaWVsZEl4ID0gMDtcbiAgd2hpbGUoZmllbGRJeCA8IGZpZWxkcy5sZW5ndGgpIHtcbiAgICBpZihpZ25vcmVGaWVsZHMgJiYgaWdub3JlRmllbGRzLmluZGV4T2YoZmllbGRzW2ZpZWxkSXhdKSAhPT0gLTEpIGZpZWxkcy5zcGxpY2UoZmllbGRJeCwgMSk7XG4gICAgZWxzZSBpZihpZ25vcmVUZW1wICYmIGZpZWxkc1tmaWVsZEl4XS5pbmRleE9mKFwiJCR0ZW1wXCIpID09PSAwKSBmaWVsZHMuc3BsaWNlKGZpZWxkSXgsIDEpO1xuICAgIGVsc2UgZmllbGRJeCsrO1xuICB9XG5cbiAgbGV0IGhlYWRlciA9IHt0OiBcImhlYWRlclwiLCBjaGlsZHJlbjogW119O1xuICBsZXQge2ZpZWxkOnNvcnRGaWVsZCA9IHVuZGVmaW5lZCwgZGlyZWN0aW9uOnNvcnREaXJlY3Rpb259ID0gbG9jYWxTdGF0ZTtcbiAgc29ydERpcmVjdGlvbiA9IHNvcnREaXJlY3Rpb24gfHwgMTtcbiAgZm9yKGxldCBmaWVsZCBvZiBmaWVsZHMpIHtcbiAgICBsZXQgaXNBY3RpdmUgPSBmaWVsZCA9PT0gc29ydEZpZWxkO1xuICAgIGxldCBkaXJlY3Rpb24gPSAoZmllbGQgPT09IHNvcnRGaWVsZCkgPyBzb3J0RGlyZWN0aW9uIDogMDtcbiAgICBoZWFkZXIuY2hpbGRyZW4ucHVzaCh7YzogXCJjb2x1bW4gZmllbGQgZmxleC1yb3dcIiwgY2hpbGRyZW46IFtcbiAgICAgIHZhbHVlKHt0ZXh0OiBmaWVsZCwgZGF0YSwgYXV0b2xpbms6IGZhbHNlfSksXG4gICAgICB7YzogXCJmbGV4LWdyb3dcIn0sXG4gICAgICB7YzogXCJjb250cm9sc1wiLCBjaGlsZHJlbjogW1xuICAgICAgICBzb3J0YWJsZSA/IHtcbiAgICAgICAgICBjOiBgc29ydC10b2dnbGUgJHtpc0FjdGl2ZSAmJiBkaXJlY3Rpb24gPCAwID8gXCJpb24tYXJyb3ctdXAtYlwiIDogXCJpb24tYXJyb3ctZG93bi1iXCJ9ICR7aXNBY3RpdmUgPyBcImFjdGl2ZVwiIDogXCJcIn1gLFxuICAgICAgICAgIGtleTogZWxlbS5rZXksXG4gICAgICAgICAgZmllbGQsXG4gICAgICAgICAgZGlyZWN0aW9uOiAtZGlyZWN0aW9uLFxuICAgICAgICAgIGNsaWNrOiBzb3J0VGFibGVcbiAgICAgICAgfSA6IHVuZGVmaW5lZFxuICAgICAgXX1cbiAgICBdfSk7XG4gIH1cblxuICBpZihzb3J0YWJsZSAmJiBzb3J0RmllbGQpIHtcbiAgICBsZXQgYmFjayA9IC0xICogc29ydERpcmVjdGlvbjtcbiAgICBsZXQgZndkID0gc29ydERpcmVjdGlvbjtcbiAgICByb3dzLnNvcnQoZnVuY3Rpb24gc29ydGVyKHJvd0EsIHJvd0IpIHtcbiAgICAgIGxldCBhID0gcmVzb2x2ZU5hbWUocmVzb2x2ZVZhbHVlKHJvd0Fbc29ydEZpZWxkXSkpLCBiID0gcmVzb2x2ZU5hbWUocmVzb2x2ZVZhbHVlKHJvd0Jbc29ydEZpZWxkXSkpO1xuICAgICAgcmV0dXJuIChhID09PSBiKSA/IDAgOlxuICAgICAgICAoYSA9PT0gdW5kZWZpbmVkKSA/IGZ3ZCA6XG4gICAgICAgIChiID09PSB1bmRlZmluZWQpID8gYmFjayA6XG4gICAgICAgIChhID4gYikgPyBmd2QgOiBiYWNrO1xuICAgIH0pO1xuICB9XG5cbiAgLy9AVE9ETzogYWxsb3cgdGhpcyB0byBoYW5kbGUgbXVsdGlwbGUgZ3JvdXBzXG4gIGlmKGdyb3Vwcy5sZW5ndGggPiAxKSB0aHJvdyBuZXcgRXJyb3IoXCJUYWJsZXMgb25seSBzdXBwb3J0IGdyb3VwaW5nIG9uIG9uZSBmaWVsZFwiKTtcbiAgaWYoZ3JvdXBzLmxlbmd0aCkge1xuICAgIGxldCBbdG9Hcm91cF0gPSBncm91cHM7XG4gICAgcm93cy5zb3J0KChhLCBiKSA9PiB7XG4gICAgICBsZXQgYWcgPSBhW3RvR3JvdXBdO1xuICAgICAgbGV0IGJnID0gYlt0b0dyb3VwXTtcbiAgICAgIGlmKGFnID09PSBiZykgcmV0dXJuIDA7XG4gICAgICBpZihhZyA8IGJnKSByZXR1cm4gLTE7XG4gICAgICByZXR1cm4gMTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vQEZJWE1FOiB0aGUgZ3JvdXBpbmcgc3RyYXRlZ3kgaGVyZSBpcyBhIGRpc2FzdGVyXG4gIGxldCBib2R5ID0ge2M6IFwiYm9keVwiLCBjaGlsZHJlbjogW119O1xuICBsZXQgaXggPSAwO1xuICBsZXQgcm93c0xlbiA9IHJvd3MubGVuZ3RoO1xuICB3aGlsZShpeCA8IHJvd3NMZW4pIHtcbiAgICBsZXQgcm93ID0gcm93c1tpeF07XG4gICAgbGV0IHJvd0VsZW0gPSB7YzogXCJyb3cgZ3JvdXBcIiwgdGFibGU6IGVsZW0sIHJvdywgY2hpbGRyZW46IFtdfTtcbiAgICBmb3IobGV0IGdyb3VwZWQgb2YgZ3JvdXBzKSB7XG4gICAgICBsZXQgY29sbGVjdGVkID0gW107XG4gICAgICByb3dFbGVtLmNoaWxkcmVuLnB1c2godmFsdWUoe2M6IFwiY29sdW1uIGZpZWxkXCIsIHRleHQ6IHJvd1tncm91cGVkXSwgZWRpdGFibGU6IGVkaXRDZWxsID8gdHJ1ZSA6IGZhbHNlLCBibHVyOiBlZGl0Q2VsbCwgcm93OiByb3dFbGVtLCBncm91cGVkOiB0cnVlLCByb3dzOiBjb2xsZWN0ZWQsIGZpZWxkOiBncm91cGVkLCBkYXRhLCBrZXlkb3duOiBoYW5kbGVDZWxsS2V5c30pKTtcbiAgICAgIGxldCBzdWJncm91cCA9IHtjOiBcImNvbHVtbiBzdWItZ3JvdXBcIiwgdGFibGU6IGVsZW0sIHJvdywgY2hpbGRyZW46IFtdfTtcbiAgICAgIHJvd0VsZW0uY2hpbGRyZW4ucHVzaChzdWJncm91cCk7XG4gICAgICBsZXQgc3Vicm93ID0gcm93c1tpeF07XG4gICAgICB3aGlsZShpeCA8IHJvd3NMZW4gJiYgc3Vicm93W2dyb3VwZWRdID09PSByb3dbZ3JvdXBlZF0pIHtcbiAgICAgICAgbGV0IHN1YnJvd0VsZW0gPSB7YzogXCJzdWItcm93XCIsIHRhYmxlOiBlbGVtLCByb3c6IHN1YnJvdywgY2hpbGRyZW46IFtdfTtcbiAgICAgICAgc3ViZ3JvdXAuY2hpbGRyZW4ucHVzaChzdWJyb3dFbGVtKTtcbiAgICAgICAgY29sbGVjdGVkLnB1c2goc3Vicm93KTtcbiAgICAgICAgZm9yKGxldCBmaWVsZCBvZiBmaWVsZHMpIHtcbiAgICAgICAgICBpZihmaWVsZCA9PT0gZ3JvdXBlZCkgY29udGludWU7XG4gICAgICAgICAgc3Vicm93RWxlbS5jaGlsZHJlbi5wdXNoKHZhbHVlKHtjOiBcImZpZWxkXCIsIHRleHQ6IHN1YnJvd1tmaWVsZF0sIGVkaXRhYmxlOiBlZGl0Q2VsbCA/IHRydWUgOiBmYWxzZSwgYmx1cjogZWRpdENlbGwsIHJvdzogc3Vicm93RWxlbSwgZmllbGQsIGRhdGEsIGtleWRvd246IGhhbmRsZUNlbGxLZXlzfSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmKGVkaXRSb3cpIHN1YnJvd0VsZW0uY2hpbGRyZW4ucHVzaCh7YzogXCJjb250cm9sc1wiLCBjaGlsZHJlbjogW3tjOiBcInJlbW92ZS1yb3cgaW9uLWFuZHJvaWQtY2xvc2VcIiwgcm93OiBzdWJyb3dFbGVtLCBjbGljazogcmVtb3ZlUm93fV19KTtcbiAgICAgICAgaXgrKztcbiAgICAgICAgc3Vicm93ID0gcm93c1tpeF07XG4gICAgICB9XG4gICAgfVxuICAgIGlmKGdyb3Vwcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgZm9yKGxldCBmaWVsZCBvZiBmaWVsZHMpIHtcbiAgICAgICAgICByb3dFbGVtLmNoaWxkcmVuLnB1c2godmFsdWUoe2M6IFwiY29sdW1uIGZpZWxkXCIsIHRleHQ6IHJvd1tmaWVsZF0sIGVkaXRhYmxlOiBlZGl0Q2VsbCA/IHRydWUgOiBmYWxzZSwgYmx1cjogZWRpdENlbGwsIHJvdzogcm93RWxlbSwgZmllbGQsIGRhdGEsIGtleWRvd246IGhhbmRsZUNlbGxLZXlzfSkpO1xuICAgICAgICB9XG4gICAgICAgIGlmKGVkaXRSb3cpIHJvd0VsZW0uY2hpbGRyZW4ucHVzaCh7YzogXCJjb250cm9sc1wiLCBjaGlsZHJlbjogW3tjOiBcInJlbW92ZS1yb3cgaW9uLWFuZHJvaWQtY2xvc2VcIiwgcm93OiByb3dFbGVtLCBjbGljazogcmVtb3ZlUm93fV19KTtcbiAgICAgICAgaXgrKztcbiAgICB9XG4gICAgYm9keS5jaGlsZHJlbi5wdXNoKHJvd0VsZW0pO1xuICB9XG4gIGlmKGVkaXRSb3cpIHtcbiAgICBpZighbG9jYWxTdGF0ZVtcImFkZGVyXCJdKSB7XG4gICAgICBsb2NhbFN0YXRlW1wiYWRkZXJcIl0gPSB7fTtcbiAgICB9XG4gICAgbGV0IHJvd0VsZW0gPSB7YzogXCJyb3cgZ3JvdXAgYWRkLXJvd1wiLCB0YWJsZTogZWxlbSwgcm93OiBbXSwgY2hpbGRyZW46IFtdfTtcbiAgICBmb3IobGV0IGZpZWxkIG9mIGZpZWxkcykgcm93RWxlbS5jaGlsZHJlbi5wdXNoKHZhbHVlKHt0OiBcImlucHV0XCIsIGM6IFwiY29sdW1uIGZpZWxkXCIsIGVkaXRhYmxlOiB0cnVlLCBpbnB1dDogdHJhY2tJbnB1dCwgYmx1cjogYWRkUm93LCByb3c6IHJvd0VsZW0sIGtleWRvd246IGhhbmRsZUNlbGxLZXlzLCBhdHRyaWJ1dGU6IGZpZWxkLCBmaWVsZCwgZmllbGRzLCBkYXRhLCB0YWJsZTogZWxlbSwgc3RhdGU6IGxvY2FsU3RhdGUsIHRleHQ6IGxvY2FsU3RhdGVbXCJhZGRlclwiXVtmaWVsZF0gfHwgXCJcIn0pKTtcbiAgICBib2R5LmNoaWxkcmVuLnB1c2gocm93RWxlbSk7XG4gIH1cblxuICBlbGVtLmMgPSBgdGFibGUgJHtlbGVtLmMgfHwgXCJcIn1gO1xuICBlbGVtLmNoaWxkcmVuID0gW2hlYWRlciwgYm9keV07XG4gIGlmKG5vSGVhZGVyKSB7XG4gICAgICBlbGVtLmNoaWxkcmVuLnNoaWZ0KCk7XG4gIH1cbiAgcmV0dXJuIGVsZW07XG59XG5cbmZ1bmN0aW9uIGhhbmRsZUNlbGxLZXlzKGV2ZW50LCBlbGVtKSB7XG4gIGlmKGV2ZW50LmtleUNvZGUgPT09IEtFWVMuRU5URVIpIHtcbiAgICBlbGVtLmJsdXIoZXZlbnQsIGVsZW0pO1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gIH1cbn1cblxuaW50ZXJmYWNlIFRhYmxlRmlsdGVyRWxlbSBleHRlbmRzIEVsZW1lbnQgeyBrZXk6IHN0cmluZywgc29ydEZpZWxkcz86IHN0cmluZ1tdLCBzZWFyY2g/OiAoc2VhcmNoOnN0cmluZykgPT4gc3RyaW5nW118RWxlbWVudFtdIH1cbmV4cG9ydCBmdW5jdGlvbiB0YWJsZUZpbHRlcihlbGVtOlRhYmxlRmlsdGVyRWxlbSkge1xuICBsZXQge2tleSwgc2VhcmNoID0gdW5kZWZpbmVkLCBzb3J0RmllbGRzID0gdW5kZWZpbmVkfSA9IGVsZW07XG4gIGVsZW0uY2hpbGRyZW4gPSBbXTtcbiAgaWYoc29ydEZpZWxkcykge1xuICAgIGxldCBzdGF0ZSA9IF9zdGF0ZS53aWRnZXQudGFibGVba2V5XSB8fCB7ZmllbGQ6IHVuZGVmaW5lZCwgZGlyZWN0aW9uOiB1bmRlZmluZWR9O1xuICAgIGxldCBzb3J0T3B0cyA9IFtdO1xuICAgIGZvcihsZXQgZmllbGQgb2Ygc29ydEZpZWxkcykge1xuICAgICAgc29ydE9wdHMucHVzaCh7dDogXCJvcHRpb25cIiwgdGV4dDogcmVzb2x2ZU5hbWUoZmllbGQpLCB2YWx1ZTogZmllbGQsIHNlbGVjdGVkOiBmaWVsZCA9PT0gc3RhdGUuZmllbGR9KTtcbiAgICB9XG4gICAgZWxlbS5jaGlsZHJlbi5wdXNoKHtjOiBcImZsZXgtZ3Jvd1wifSk7XG4gICAgZWxlbS5jaGlsZHJlbi5wdXNoKHtjOiBcInNvcnRcIiwgY2hpbGRyZW46IFtcbiAgICAgIHt0ZXh0OiBcIlNvcnQgYnlcIn0sXG4gICAgICB7dDogXCJzZWxlY3RcIiwgYzogXCJzZWxlY3Qtc29ydC1maWVsZCBzZWxlY3RcIiwgdmFsdWU6IHN0YXRlLmZpZWxkLCBjaGlsZHJlbjogc29ydE9wdHMsIGtleSwgY2hhbmdlOiBzb3J0VGFibGV9LFxuICAgICAge2M6IGB0b2dnbGUtc29ydC1kaXIgJHtzdGF0ZS5kaXJlY3Rpb24gPT09IC0xID8gXCJpb24tYXJyb3ctdXAtYlwiIDogXCJpb24tYXJyb3ctZG93bi1iXCJ9YCwga2V5LCBkaXJlY3Rpb246IC1zdGF0ZS5kaXJlY3Rpb24gfHwgMSwgY2xpY2s6IHNvcnRUYWJsZX0sXG4gICAgXX0pO1xuICB9XG4gIGVsZW0uYyA9IGB0YWJsZS1maWx0ZXIgJHtlbGVtLmMgfHwgXCJcIn1gO1xuICByZXR1cm4gZWxlbTtcbn1cblxuaW50ZXJmYWNlIFVSTEVsZW0gZXh0ZW5kcyBFbGVtZW50IHsgdXJsOiBzdHJpbmcgfVxuZXhwb3J0IGZ1bmN0aW9uIGV4dGVybmFsTGluayhlbGVtOlVSTEVsZW0pIHtcbiAgZWxlbS50ID0gXCJhXCI7XG4gIGVsZW0uYyA9IGBsaW5rICR7ZWxlbS5jIHx8IFwiXCJ9YDtcbiAgZWxlbS5ocmVmID0gZWxlbS51cmw7XG4gIGVsZW0udGV4dCA9IGVsZW0udGV4dCB8fCBlbGVtLnVybDtcbiAgcmV0dXJuIGVsZW07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBleHRlcm5hbEltYWdlKGVsZW06VVJMRWxlbSkge1xuICBlbGVtLnQgPSBcImltZ1wiO1xuICBlbGVtLmMgPSBgaW1nICR7ZWxlbS5jIHx8IFwiXCJ9YDtcbiAgZWxlbS5zcmMgPSBlbGVtLnVybDtcbiAgcmV0dXJuIGVsZW07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBleHRlcm5hbFZpZGVvKGVsZW06VVJMRWxlbSkge1xuICBsZXQgZXh0ID0gZWxlbS51cmwuc2xpY2UoZWxlbS51cmwubGFzdEluZGV4T2YoXCIuXCIpKS50cmltKCkudG9Mb3dlckNhc2UoKTtcbiAgbGV0IGRvbWFpbiA9IGVsZW0udXJsLnNsaWNlKGVsZW0udXJsLmluZGV4T2YoXCIvL1wiKSArIDIpLnNwbGl0KFwiL1wiKVswXTtcbiAgbGV0IGlzRmlsZSA9IFtcIm1wNFwiLCBcIm9ndlwiLCBcIndlYm1cIiwgXCJtb3ZcIiwgXCJhdmlcIiwgXCJmbHZcIl0uaW5kZXhPZihleHQpICE9PSAtMTtcbiAgaWYoaXNGaWxlKSB7XG4gICAgZWxlbS50ID0gXCJ2aWRlb1wiO1xuICB9IGVsc2Uge1xuICAgIGVsZW0udCA9IFwiaWZyYW1lXCI7XG4gIH1cbiAgZWxlbS5jID0gYHZpZGVvICR7ZWxlbS5jIHx8IFwiXCJ9YDtcbiAgZWxlbS5zcmMgPSBlbGVtLnVybDtcbiAgZWxlbS5hbGxvd2Z1bGxzY3JlZW4gPSB0cnVlO1xuICByZXR1cm4gZWxlbTtcbn1cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIENvbnRhaW5lcnNcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5pbnRlcmZhY2UgQ29sbGFwc2libGVFbGVtIGV4dGVuZHMgRWxlbWVudCB7IGtleTpzdHJpbmcsIGhlYWRlcj86RWxlbWVudCwgb3Blbj86Ym9vbGVhbiB9XG5leHBvcnQgZnVuY3Rpb24gY29sbGFwc2libGUoZWxlbTpDb2xsYXBzaWJsZUVsZW0pOkVsZW1lbnQge1xuICBpZihlbGVtLmtleSA9PT0gdW5kZWZpbmVkKSB0aHJvdyBuZXcgRXJyb3IoXCJNdXN0IHNwZWNpZnkgYSBrZXkgdG8gbWFpbnRhaW4gY29sbGFwc2libGUgc3RhdGVcIik7XG4gIGxldCBzdGF0ZSA9IF9zdGF0ZS53aWRnZXQuY29sbGFwc2libGVbZWxlbS5rZXldIHx8IHtvcGVuOiBlbGVtLm9wZW4gIT09IHVuZGVmaW5lZCA/IGVsZW0ub3BlbiA6IHRydWV9O1xuICBsZXQgY29udGVudCA9IHtjaGlsZHJlbjogZWxlbS5jaGlsZHJlbn07XG4gIGxldCBoZWFkZXIgPSB7dDogXCJoZWFkZXJcIiwgY2hpbGRyZW46IFt7YzogXCJjb2xsYXBzZS10b2dnbGUgXCIgKyAoc3RhdGUub3BlbiA/IFwiaW9uLWNoZXZyb24tdXBcIiA6IFwiaW9uLWNoZXZyb24tZG93blwiKSwgY29sbGFwc2libGU6IGVsZW0ua2V5LCBvcGVuOiBzdGF0ZS5vcGVuLCBjbGljazogdG9nZ2xlQ29sbGFwc2V9LCBlbGVtLmhlYWRlcl19O1xuXG4gIGVsZW0uYyA9IGBjb2xsYXBzaWJsZSAke2VsZW0uYyB8fCBcIlwifWA7XG4gIGVsZW0uY2hpbGRyZW4gPSBbaGVhZGVyLCBzdGF0ZS5vcGVuID8gY29udGVudCA6IHVuZGVmaW5lZF07XG4gIHJldHVybiBlbGVtO1xufVxuXG5mdW5jdGlvbiB0b2dnbGVDb2xsYXBzZShldnQsIGVsZW0pIHtcbiAgZGlzcGF0Y2goXCJ0b2dnbGUgY29sbGFwc2VcIiwge2NvbGxhcHNpYmxlOiBlbGVtLmNvbGxhcHNpYmxlLCBvcGVuOiAhZWxlbS5vcGVufSk7XG59XG5cbmxldCBkaXJlY3RvcnlUaWxlTGF5b3V0czpNYXNvbnJ5TGF5b3V0W10gPSBbXG4gIHtzaXplOiA0LCBjOiBcImJpZ1wiLCBmb3JtYXQoZWxlbSkge1xuICAgIGVsZW0uY2hpbGRyZW4udW5zaGlmdFxuICAgIGVsZW0uY2hpbGRyZW4ucHVzaChcbiAgICAgIHt0ZXh0OiBgKCR7ZWxlbVtcInN0YXRzXCJdW2VsZW1bXCJzdGF0c1wiXS5iZXN0XX0gJHtlbGVtW1wic3RhdHNcIl0uYmVzdH0pYH1cbiAgICApO1xuICAgIHJldHVybiBlbGVtO1xuICB9fSxcbiAge3NpemU6IDIsIGM6IFwiZGV0YWlsZWRcIiwgZm9ybWF0KGVsZW0pIHtcbiAgICBlbGVtLmNoaWxkcmVuLnB1c2goXG4gICAgICB7dGV4dDogYCgke2VsZW1bXCJzdGF0c1wiXVtlbGVtW1wic3RhdHNcIl0uYmVzdF19ICR7ZWxlbVtcInN0YXRzXCJdLmJlc3R9KWB9XG4gICAgKTtcbiAgICByZXR1cm4gZWxlbTtcbiAgfX0sXG4gIHtzaXplOiAxLCBjOiBcIm5vcm1hbFwiLCBncm91cGVkOiAyfVxuXTtcbmxldCBkaXJlY3RvcnlUaWxlU3R5bGVzID0gW1widGlsZS1zdHlsZS0xXCIsIFwidGlsZS1zdHlsZS0yXCIsIFwidGlsZS1zdHlsZS0zXCIsIFwidGlsZS1zdHlsZS00XCIsIFwidGlsZS1zdHlsZS01XCIsIFwidGlsZS1zdHlsZS02XCIsIFwidGlsZS1zdHlsZS03XCJdO1xuXG4vLyBAVE9ETzogQ2xlYW4gdXAgZGlyZWN0b3J5IGVsZW1cbmludGVyZmFjZSBEaXJlY3RvcnlFbGVtIGV4dGVuZHMgRWxlbWVudCB7IGVudGl0aWVzOnN0cmluZ1tdLCBkYXRhPzphbnkgfVxuZXhwb3J0IGZ1bmN0aW9uIGRpcmVjdG9yeShlbGVtOkRpcmVjdG9yeUVsZW0pOkVsZW1lbnQge1xuICBjb25zdCBNQVhfRU5USVRJRVNfQkVGT1JFX09WRVJGTE9XID0gMTQ7XG4gIGxldCB7ZW50aXRpZXM6cmF3RW50aXRpZXMsIGRhdGEgPSB1bmRlZmluZWR9ID0gZWxlbTtcbiAgbGV0IHtzeXN0ZW1zLCBjb2xsZWN0aW9ucywgZW50aXRpZXMsIHNjb3JlcywgcmVsYXRlZENvdW50cywgd29yZENvdW50cywgY2hpbGRDb3VudHN9ID0gY2xhc3NpZnlFbnRpdGllcyhyYXdFbnRpdGllcyk7XG4gIGxldCBzb3J0QnlTY29yZXMgPSBzb3J0QnlMb29rdXAoc2NvcmVzKTtcbiAgZW50aXRpZXMuc29ydChzb3J0QnlTY29yZXMpO1xuICBjb2xsZWN0aW9ucy5zb3J0KHNvcnRCeVNjb3Jlcyk7XG4gIHN5c3RlbXMuc29ydChzb3J0QnlTY29yZXMpO1xuXG4gIC8vIExpbmsgdG8gZW50aXR5XG4gIC8vIFBlZWsgd2l0aCBtb3N0IHNpZ25pZmljYW50IHN0YXRpc3RpYyAoZS5nLiAxMyByZWxhdGVkOyBvciAxNCBjaGlsZHJlbnBhZ2VzOyBvciA1MDAwIHdvcmRzKVxuICAvLyBTbGlkZXIgcGFuZSB3aWxsIGFsbCBzdGF0aXN0aWNzXG4gIC8vIENsaWNrIG9wZW5zIHBvcHVwIHByZXZpZXdcbiAgZnVuY3Rpb24gZm9ybWF0VGlsZShlbnRpdHkpIHtcbiAgICBsZXQgc3RhdHMgPSB7YmVzdDpcIlwiLCBsaW5rczogcmVsYXRlZENvdW50c1tlbnRpdHldLCBwYWdlczogY2hpbGRDb3VudHNbZW50aXR5XSwgd29yZHM6IHdvcmRDb3VudHNbZW50aXR5XX07XG4gICAgbGV0IG1heENvbnRyaWJ1dGlvbiA9IDA7XG4gICAgZm9yKGxldCBzdGF0IGluIHN0YXRzKSB7XG4gICAgICBpZighc3RhdFdlaWdodHNbc3RhdF0pIGNvbnRpbnVlO1xuICAgICAgbGV0IGNvbnRyaWJ1dGlvbiA9IHN0YXRzW3N0YXRdICogc3RhdFdlaWdodHNbc3RhdF07XG4gICAgICBpZihjb250cmlidXRpb24gPiBtYXhDb250cmlidXRpb24pIHtcbiAgICAgICAgbWF4Q29udHJpYnV0aW9uID0gY29udHJpYnV0aW9uO1xuICAgICAgICBzdGF0cy5iZXN0ID0gc3RhdDtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHtzaXplOiBzY29yZXNbZW50aXR5XSwgc3RhdHMsIGNoaWxkcmVuOiBbXG4gICAgICBsaW5rKHtlbnRpdHksIGRhdGF9KVxuICAgIF19O1xuICB9XG5cbiAgZnVuY3Rpb24gZm9ybWF0T3ZlcmZsb3coa2V5OnN0cmluZywgZW50aXRpZXMsIHNraXBDaGlsZHJlbjpib29sZWFuID0gZmFsc2UpIHtcbiAgICBsZXQgcm93cyA9IFtdO1xuICAgIGZvcihsZXQgZW50aXR5IG9mIGVudGl0aWVzKSB7XG4gICAgICByb3dzLnB1c2goe1xuICAgICAgICBuYW1lOiBlbnRpdHksXG4gICAgICAgIHNjb3JlOiBzY29yZXNbZW50aXR5XSxcbiAgICAgICAgd29yZHM6IHdvcmRDb3VudHNbZW50aXR5XSxcbiAgICAgICAgbGlua3M6IHJlbGF0ZWRDb3VudHNbZW50aXR5XSxcbiAgICAgICAgcGFnZXM6IGNoaWxkQ291bnRzW2VudGl0eV1cbiAgICAgIH0pO1xuICAgICAgaWYoc2tpcENoaWxkcmVuKSBkZWxldGUgcm93c1tyb3dzLmxlbmd0aCAtIDFdLnBhZ2VzO1xuICAgIH1cbiAgICByZXR1cm4gdGFibGUoe2M6IFwib3ZlcmZsb3ctbGlzdFwiLCBrZXksIHJvd3MsIHNvcnRhYmxlOiB0cnVlLCBkYXRhfSk7XG4gIH1cbiAgXG4gIC8vIEBUT0RPOiBQdXQgZm9ybWF0T3ZlcmZsb3cgaW50byBhIGNvbGxhcHNlZCBjb250YWluZXIuXG4gIHJldHVybiB7YzogXCJkaXJlY3RvcnkgZmxleC1jb2x1bW5cIiwgY2hpbGRyZW46IFtcbiAgICB7dDogXCJoMlwiLCB0ZXh0OiBcIkNvbGxlY3Rpb25zXCJ9LFxuICAgIG1hc29ucnkoe2M6IFwiZGlyZWN0b3J5LWxpc3RpbmdcIiwgbGF5b3V0czogZGlyZWN0b3J5VGlsZUxheW91dHMsIHN0eWxlczogZGlyZWN0b3J5VGlsZVN0eWxlcywgY2hpbGRyZW46IGNvbGxlY3Rpb25zLm1hcChmb3JtYXRUaWxlKX0pLFxuXG4gICAge3Q6IFwiaDJcIiwgdGV4dDogXCJFbnRpdGllc1wifSxcbiAgICBtYXNvbnJ5KHtjOiBcImRpcmVjdG9yeS1saXN0aW5nXCIsIGxheW91dHM6IGRpcmVjdG9yeVRpbGVMYXlvdXRzLCBzdHlsZXM6IGRpcmVjdG9yeVRpbGVTdHlsZXMsIGNoaWxkcmVuOiBlbnRpdGllcy5zbGljZSgwLCBNQVhfRU5USVRJRVNfQkVGT1JFX09WRVJGTE9XKS5tYXAoZm9ybWF0VGlsZSl9KSxcbiAgICBjb2xsYXBzaWJsZSh7XG4gICAgICBrZXk6IGAke2VsZW0ua2V5fXxkaXJlY3RvcnkgZW50aXRpZXMgY29sbGFwc2libGVgLFxuICAgICAgaGVhZGVyOiB7dGV4dDogXCJTaG93IGFsbCBlbnRpdGllcy4uLlwifSxcbiAgICAgIGNoaWxkcmVuOiBbXG4gICAgICAgIC8vdGFibGVGaWx0ZXIoe2tleTogYCR7ZWxlbS5rZXl9fGRpcmVjdG9yeSBlbnRpdGllcyBvdmVyZmxvd2AsIHNvcnRGaWVsZHM6IFtcIm5hbWVcIiwgXCJzY29yZVwiLCBcIndvcmRzXCIsIFwibGlua3NcIl19KSxcbiAgICAgICAgZm9ybWF0T3ZlcmZsb3coYCR7ZWxlbS5rZXl9fGRpcmVjdG9yeSBlbnRpdGllcyBvdmVyZmxvd2AsIGVudGl0aWVzLCB0cnVlKVxuICAgICAgXSxcbiAgICAgIG9wZW46IGZhbHNlXG4gICAgfSksXG4gICAgXG4gICAge3Q6IFwiaDJcIiwgdGV4dDogXCJJbnRlcm5hbHNcIn0sXG4gICAgY29sbGFwc2libGUoe1xuICAgICAga2V5OiBgJHtlbGVtLmtleX18ZGlyZWN0b3J5IHN5c3RlbXMgY29sbGFwc2libGVgLFxuICAgICAgaGVhZGVyOiB7dGV4dDogXCJTaG93IGFsbCBpbnRlcm5hbCBlbnRpdGllcy4uLlwifSxcbiAgICAgIGNoaWxkcmVuOiBbZm9ybWF0T3ZlcmZsb3coYCR7ZWxlbS5rZXl9fGRpcmVjdG9yeSBzeXN0ZW1zIG92ZXJmbG93YCwgc3lzdGVtcyldLFxuICAgICAgb3BlbjogZmFsc2VcbiAgICB9KSxcbiAgXX07XG59XG5cbmV4cG9ydCB2YXIgbWFzb25yeSA9IG1hc29ucnlSYXc7XG5cbiIsImltcG9ydCB7djQgYXMgX3V1aWR9IGZyb20gXCIuLi92ZW5kb3IvdXVpZFwiO1xuZXhwb3J0IHZhciB1dWlkID0gX3V1aWQ7XG5cbmV4cG9ydCB2YXIgRU5WID0gXCJicm93c2VyXCI7XG50cnkge1xuICB3aW5kb3dcbiAgd2luZG93W1widXRpbHNcIl0gPSBleHBvcnRzO1xufSBjYXRjaChlcnIpIHtcbiAgRU5WID0gXCJub2RlXCI7XG59XG5cbmV4cG9ydCB2YXIgREVCVUc6YW55ID0ge1xuXG59O1xuXG5pZihFTlYgPT09IFwiYnJvd3NlclwiKSB3aW5kb3dbXCJERUJVR1wiXSA9IERFQlVHO1xuXG5leHBvcnQgZnVuY3Rpb24gYnVpbHRpbklkKG5hbWU6c3RyaW5nKTpzdHJpbmcge1xuICByZXR1cm4gYEFVVE9HRU5FUkFURUQgJHtuYW1lfSBUSElTIFNIT1VMRE4nVCBTSE9XIFVQIEFOWVdIRVJFYDtcbn1cblxudHlwZSBUZW1wbGF0ZVN0cmluZ1RhZyA9IChzdHJpbmdzOnN0cmluZ1tdLCAuLi52YWx1ZXM6YW55W10pID0+IHN0cmluZ1xuaW50ZXJmYWNlIHVucGFkIHtcbiAgKGluZGVudDpudW1iZXIpOiBUZW1wbGF0ZVN0cmluZ1RhZ1xuICBtZW1vOiB7W2luZGVudDpudW1iZXJdOiBUZW1wbGF0ZVN0cmluZ1RhZ31cbn1cbmV4cG9ydCB2YXIgdW5wYWQ6dW5wYWQgPSA8YW55PmZ1bmN0aW9uKGluZGVudCkge1xuICBpZih1bnBhZC5tZW1vW2luZGVudF0pIHJldHVybiB1bnBhZC5tZW1vW2luZGVudF07XG4gIHJldHVybiB1bnBhZC5tZW1vW2luZGVudF0gPSBmdW5jdGlvbihzdHJpbmdzLCAuLi52YWx1ZXMpIHtcbiAgICBpZighc3RyaW5ncy5sZW5ndGgpIHJldHVybjtcbiAgICBsZXQgcmVzID0gXCJcIjtcbiAgICBsZXQgaXggPSAwO1xuICAgIGZvcihsZXQgc3RyIG9mIHN0cmluZ3MpIHJlcyArPSBzdHIgKyAodmFsdWVzLmxlbmd0aCA+IGl4ID8gdmFsdWVzW2l4KytdIDogXCJcIik7XG5cbiAgICBpZihyZXNbMF0gPT09IFwiXFxuXCIpIHJlcyA9IHJlcy5zbGljZSgxKTtcbiAgICBsZXQgY2hhckl4ID0gMDtcbiAgICB3aGlsZSh0cnVlKSB7XG4gICAgICByZXMgPSByZXMuc2xpY2UoMCwgY2hhckl4KSArIHJlcy5zbGljZShjaGFySXggKyBpbmRlbnQpO1xuICAgICAgY2hhckl4ID0gcmVzLmluZGV4T2YoXCJcXG5cIiwgY2hhckl4KSArIDE7XG4gICAgICBpZighY2hhckl4KSBicmVhaztcbiAgICB9XG4gIHJldHVybiByZXM7XG4gIH1cbn07XG51bnBhZC5tZW1vID0ge307XG5cbmV4cG9ydCBmdW5jdGlvbiByZXBlYXQoc3RyOnN0cmluZywgbGVuZ3RoOm51bWJlcikge1xuICBsZXQgbGVuID0gbGVuZ3RoIC8gc3RyLmxlbmd0aDtcbiAgbGV0IHJlcyA9IFwiXCI7XG4gIGZvcihsZXQgaXggPSAwOyBpeCA8IGxlbjsgaXgrKykgIHJlcyArPSBzdHI7XG4gIHJldHVybiAocmVzLmxlbmd0aCA+IGxlbmd0aCkgPyByZXMuc2xpY2UoMCwgbGVuZ3RoKSA6IHJlcztcbn1cbmV4cG9ydCBmdW5jdGlvbiB1bmRlcmxpbmUoc3RhcnRJeCwgbGVuZ3RoKSB7XG4gIHJldHVybiByZXBlYXQoXCIgXCIsIHN0YXJ0SXgpICsgXCJeXCIgKyByZXBlYXQoXCJ+XCIsIGxlbmd0aCAtIDEpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2FwaXRhbGl6ZSh3b3JkOnN0cmluZyk6c3RyaW5nIHtcbiAgcmV0dXJuIHdvcmRbMF0udG9VcHBlckNhc2UoKSArIHdvcmQuc2xpY2UoMSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRpdGxlY2FzZShuYW1lOnN0cmluZyk6c3RyaW5nIHtcbiAgcmV0dXJuIG5hbWUuc3BsaXQoXCIgXCIpLm1hcChjYXBpdGFsaXplKS5qb2luKFwiIFwiKTtcbn1cblxubGV0IF9zbHVnaWZ5UmVwbGFjZW1lbnRzID0ge1xuICBcIi1cIjogXCJkYXNoXCIsXG4gIFwiX1wiOiBcInVuZGVyXCIsXG4gIFwiJFwiOiBcImRvbGxhclwiLFxuICBcIiZcIjogXCJhbmRcIixcbiAgXCIrXCI6IFwicGx1c1wiLFxuICBcIixcIjogXCJjb21tYVwiLFxuICBcIi9cIjogXCJzbGFzaFwiLFxuICBcIjpcIjogXCJjb2xvblwiLFxuICBcIjtcIjogXCJzZW1pY29sb25cIixcbiAgXCI9XCI6IFwiZXF1YWxzXCIsXG4gIFwiP1wiOiBcInF1ZXN0aW9uXCIsXG4gIFwiQFwiOiBcImF0XCIsXG4gIFwiPFwiOiBcImx0XCIsXG4gIFwiPlwiOiBcImd0XCIsXG4gIFwiI1wiOiBcImhhc2hcIixcbiAgXCIlXCI6IFwicGVyY2VudFwiLFxuICBcIntcIjogXCJvcGVuY3VybHlcIixcbiAgXCJ9XCI6IFwiY2xvc2VjdXJseVwiLFxuICBcInxcIjogXCJwaXBlXCIsXG4gIFwiXFxcXFwiOiBcIndoYWNrXCIsXG4gIFwiXlwiOiBcImNhcmV0XCIsXG4gIFwiflwiOiBcInRpbGRlXCIsXG4gIFwiW1wiOiBcIm9wZW5icmFja2V0XCIsXG4gIFwiXVwiOiBcImNsb3NlYnJhY2tldFwiLFxuICBcImBcIjogXCJncmF2ZVwiXG59O1xubGV0IF9kZXNsdWdpZnlSZXBsYWNlbWVudHMgPSB7fTtcbmZvcihsZXQgY2hhciBpbiBfc2x1Z2lmeVJlcGxhY2VtZW50cykge1xuICBfZGVzbHVnaWZ5UmVwbGFjZW1lbnRzW19zbHVnaWZ5UmVwbGFjZW1lbnRzW2NoYXJdXSA9IGNoYXI7XG59XG5cbi8vIFNsdWdpZnkgZW5jb2RlcyBhIHVyaSBjb21wb25lbnQgaW4gYSBmYWlybHkgaHVtYW4gcmVhZGFibGUgZmFzaGlvblxuZXhwb3J0IGZ1bmN0aW9uIHNsdWdpZnkodGV4dDpzdHJpbmcpOnN0cmluZyB7XG4gIGxldCB1cmwgPSBcIlwiO1xuICBmb3IobGV0IGNoYXIgb2YgdGV4dCkge1xuICAgIGxldCByZXBsYWNlbWVudCA9IF9zbHVnaWZ5UmVwbGFjZW1lbnRzW2NoYXJdO1xuICAgIGlmKGNoYXIgPT09IFwiIFwiKSB7XG4gICAgICB1cmwgKz0gXCJfXCI7XG4gICAgICBcbiAgICB9IGVsc2UgaWYocmVwbGFjZW1lbnQpIHtcbiAgICAgIHVybCArPSBgLScke3JlcGxhY2VtZW50fS1gO1xuICAgICAgXG4gICAgfSBlbHNlIHtcbiAgICAgIHVybCArPSBjaGFyO1xuICAgIH1cbiAgfVxuICByZXR1cm4gZW5jb2RlVVJJQ29tcG9uZW50KHVybCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZXNsdWdpZnkodXJsOnN0cmluZyk6c3RyaW5nIHtcbiAgbGV0IHRleHQgPSBbXTtcbiAgZm9yKGxldCB3b3JkIG9mIHVybC5zcGxpdChcIl9cIikpIHtcbiAgICBpZih3b3JkLmluZGV4T2YoXCItXCIpID09PSAtMSkge1xuICAgICAgdGV4dC5wdXNoKHdvcmQpO1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgbGV0IHJlcGxhY2VkID0gXCJcIjtcbiAgICBsZXQgdG9rZW5zID0gd29yZC5zcGxpdChcIi1cIik7XG4gICAgcmVwbGFjZWQgKz0gdG9rZW5zLnNoaWZ0KCk7XG4gICAgbGV0IHRhaWwgPSB0b2tlbnMucG9wKCk7XG4gICAgZm9yKGxldCB0b2tlbiBvZiB0b2tlbnMpIHtcbiAgICAgIGxldCByZXBsYWNlbWVudCA9IF9kZXNsdWdpZnlSZXBsYWNlbWVudHNbdG9rZW4uc2xpY2UoMSldO1xuICAgICAgaWYocmVwbGFjZW1lbnQgJiYgdG9rZW4uaW5kZXhPZihcIidcIikgPT09IDApIHtcbiAgICAgICAgcmVwbGFjZWQgKz0gcmVwbGFjZW1lbnQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXBsYWNlZCArPSB0b2tlbjtcbiAgICAgIH1cbiAgICB9XG4gICAgcmVwbGFjZWQgKz0gdGFpbDtcbiAgICB0ZXh0LnB1c2gocmVwbGFjZWQpO1xuICB9XG5cbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudCh0ZXh0LmpvaW4oXCIgXCIpKTtcbn1cblxuZXhwb3J0IHZhciBzdHJpbmcgPSB7XG4gIHVucGFkLFxuICByZXBlYXQsXG4gIHVuZGVybGluZSxcbiAgY2FwaXRhbGl6ZSxcbiAgdGl0bGVjYXNlLFxuICBzbHVnaWZ5LFxuICBkZXNsdWdpZnlcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiB0YWlsKGFycikge1xuICByZXR1cm4gYXJyW2Fyci5sZW5ndGggLSAxXTtcbn1cblxuZXhwb3J0IHZhciBhcnJheSA9IHtcbiAgdGFpbFxufTtcblxuZXhwb3J0IGZ1bmN0aW9uIGNvZXJjZUlucHV0KGlucHV0KSB7XG4gIC8vIGh0dHA6Ly9qc3BlcmYuY29tL3JlZ2V4LXZzLXBsdXMtY29lcmNpb25cbiAgaWYgKCFpc05hTigraW5wdXQpKSByZXR1cm4gK2lucHV0O1xuICBlbHNlIGlmIChpbnB1dCA9PT0gXCJ0cnVlXCIpIHJldHVybiB0cnVlO1xuICBlbHNlIGlmIChpbnB1dCA9PT0gXCJmYWxzZVwiKSByZXR1cm4gZmFsc2U7XG4gIHJldHVybiBpbnB1dDtcbn1cblxuLy8gU2hhbGxvdyBjb3B5IHRoZSBnaXZlbiBvYmplY3QuXG5leHBvcnQgZnVuY3Rpb24gY29weShvYmopIHtcbiAgaWYoIW9iaiB8fCB0eXBlb2Ygb2JqICE9PSBcIm9iamVjdFwiKSByZXR1cm4gb2JqO1xuICBpZihvYmogaW5zdGFuY2VvZiBBcnJheSkgcmV0dXJuIG9iai5zbGljZSgpO1xuICBsZXQgcmVzID0ge307XG4gIGZvcihsZXQga2V5IGluIG9iaikgcmVzW2tleV0gPSBvYmpba2V5XTtcbiAgcmV0dXJuIHJlcztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1lcmdlT2JqZWN0KHJvb3QsIG9iaikge1xuICBmb3IobGV0IGtleSBpbiBvYmopIHtcbiAgICByb290W2tleV0gPSBvYmpba2V5XTtcbiAgfVxuICByZXR1cm4gcm9vdDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGF1dG9Gb2N1cyhub2RlLCBlbGVtKSB7XG4gIGlmKCFub2RlLmZvY3VzZWQpIHtcbiAgICBub2RlLmZvY3VzZWQgPSB0cnVlO1xuICAgIG5vZGUuZm9jdXMoKTtcbiAgfVxufVxuXG5leHBvcnQgdmFyIEtFWVMgPSB7XG4gIEVTQzogMjcsXG4gIEVOVEVSOiAxMyxcbiAgVVA6IDM4LFxuICBET1dOOiA0MCxcbiAgQkFDS1NQQUNFOiA4LFxuICBcIl1cIjogMjIxLFxufVxuXG4vLyBGUk9NOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzExMjUyOTIvaG93LXRvLW1vdmUtY3Vyc29yLXRvLWVuZC1vZi1jb250ZW50ZWRpdGFibGUtZW50aXR5LzM4NjY0NDIjMzg2NjQ0MlxuZXhwb3J0IGZ1bmN0aW9uIHNldEVuZE9mQ29udGVudEVkaXRhYmxlKGNvbnRlbnRFZGl0YWJsZUVsZW1lbnQpIHtcbiAgdmFyIHJhbmdlLHNlbGVjdGlvbjtcbiAgaWYoZG9jdW1lbnQuY3JlYXRlUmFuZ2UpLy9GaXJlZm94LCBDaHJvbWUsIE9wZXJhLCBTYWZhcmksIElFIDkrXG4gIHtcbiAgICByYW5nZSA9IGRvY3VtZW50LmNyZWF0ZVJhbmdlKCk7Ly9DcmVhdGUgYSByYW5nZSAoYSByYW5nZSBpcyBhIGxpa2UgdGhlIHNlbGVjdGlvbiBidXQgaW52aXNpYmxlKVxuICAgIHJhbmdlLnNlbGVjdE5vZGVDb250ZW50cyhjb250ZW50RWRpdGFibGVFbGVtZW50KTsvL1NlbGVjdCB0aGUgZW50aXJlIGNvbnRlbnRzIG9mIHRoZSBlbGVtZW50IHdpdGggdGhlIHJhbmdlXG4gICAgcmFuZ2UuY29sbGFwc2UoZmFsc2UpOy8vY29sbGFwc2UgdGhlIHJhbmdlIHRvIHRoZSBlbmQgcG9pbnQuIGZhbHNlIG1lYW5zIGNvbGxhcHNlIHRvIGVuZCByYXRoZXIgdGhhbiB0aGUgc3RhcnRcbiAgICBzZWxlY3Rpb24gPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCk7Ly9nZXQgdGhlIHNlbGVjdGlvbiBvYmplY3QgKGFsbG93cyB5b3UgdG8gY2hhbmdlIHNlbGVjdGlvbilcbiAgICBzZWxlY3Rpb24ucmVtb3ZlQWxsUmFuZ2VzKCk7Ly9yZW1vdmUgYW55IHNlbGVjdGlvbnMgYWxyZWFkeSBtYWRlXG4gICAgc2VsZWN0aW9uLmFkZFJhbmdlKHJhbmdlKTsvL21ha2UgdGhlIHJhbmdlIHlvdSBoYXZlIGp1c3QgY3JlYXRlZCB0aGUgdmlzaWJsZSBzZWxlY3Rpb25cbiAgfVxufVxuXG4vLyBMQ0cgY291cnRlc3kgb2YgPGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL1Byb3RvbmsvNTM4OTM4ND5cbmV4cG9ydCBmdW5jdGlvbiBzcmFuZCh6KSB7XG4gIGxldCBtID0gTWF0aC5wb3coMiwgMjQpLCBhID0gMTY1OTgwMTMsIGMgPSAxMjgyMDE2MztcbiAgcmV0dXJuICgpID0+IHogPSAoYSAqIHogKyBjKSAlIG0gLyBtO1xufVxuLy8gU2h1ZmZsZSBjb3VydGVzeSBvZiA8aHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvNjI3NDM4MT5cbmV4cG9ydCBmdW5jdGlvbiBzaHVmZmxlKG86YW55W10sIHJhbmQgPSBNYXRoLnJhbmRvbSkge1xuICBmb3IodmFyIGosIHgsIGkgPSBvLmxlbmd0aDsgaTsgaiA9IE1hdGguZmxvb3IocmFuZCgpICogaSksIHggPSBvWy0taV0sIG9baV0gPSBvW2pdLCBvW2pdID0geCk7XG4gIHJldHVybiBvO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc29ydEJ5RmllbGQoZmllbGQpOihhLCBiKSA9PiBudW1iZXIge1xuICByZXR1cm4gKGEsIGIpID0+XG4gICAgKGFbZmllbGRdID09PSBiW2ZpZWxkXSkgPyAwIDpcbiAgICAoYVtmaWVsZF0gPiBiW2ZpZWxkXSkgPyAtMSA6XG4gICAgKGFbZmllbGRdIDwgYltmaWVsZF0pID8gMSA6XG4gICAgKGFbZmllbGRdID09PSB1bmRlZmluZWQpID8gMSA6IC0xO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHNvcnRCeUxvb2t1cChsb29rdXA6e30pOihhLCBiKSA9PiBudW1iZXIge1xuICByZXR1cm4gKGEsIGIpID0+XG4gICAgKGxvb2t1cFthXSA9PT0gbG9va3VwW2JdKSA/IDAgOlxuICAgIChsb29rdXBbYV0gPiBsb29rdXBbYl0pID8gLTEgOlxuICAgIChsb29rdXBbYV0gPCBsb29rdXBbYl0pID8gMSA6XG4gICAgKGxvb2t1cFthXSA9PT0gdW5kZWZpbmVkKSA/IDEgOiAtMTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxvY2F0aW9uKCkge1xuICByZXR1cm4gd2luZG93LmxvY2F0aW9uLmhhc2guc2xpY2UoMSk7XG59XG4iLCJcInVzZSBzdHJpY3RcIlxuXG5pbXBvcnQgKiBhcyBhcHAgZnJvbSBcIi4vYXBwXCI7XG5pbXBvcnQgKiBhcyBib290c3RyYXAgZnJvbSBcIi4vYm9vdHN0cmFwXCI7XG5pbXBvcnQgKiBhcyB1aSBmcm9tIFwiLi91aVwiO1xuaW1wb3J0IHtkZXNsdWdpZnksIGxvY2F0aW9uIGFzIGdldExvY2F0aW9ufSBmcm9tIFwiLi91dGlsc1wiO1xuXG5cbmFwcC5yZW5kZXJSb290c1tcIndpa2lcIl0gPSB1aS5yb290O1xuXG4vLyBASEFDSzogd2UgaGF2ZSB0byB1c2UgYm9vdHN0cmFwIGluIHNvbWUgd2F5IHRvIGdldCBpdCB0byBhY3R1YWxseSBiZSBpbmNsdWRlZCBhbmRcbi8vIGV4ZWN1dGVkXG52YXIgaXhlciA9IGJvb3RzdHJhcC5peGVyO1xuXG5mdW5jdGlvbiBpbml0U2VhcmNoZXMoZXZlKSB7XG4gIGZvcihsZXQgcGFuZSBvZiBldmUuZmluZChcInVpIHBhbmVcIikpIHtcbiAgICBpZihldmUuZmluZE9uZShcImVudGl0eVwiLCB7ZW50aXR5OiBwYW5lLmNvbnRhaW5zfSkpIGNvbnRpbnVlO1xuICB9XG59XG5cbmFwcC5pbml0KFwid2lraVwiLCBmdW5jdGlvbigpIHtcbiAgZG9jdW1lbnQuYm9keS5jbGFzc0xpc3QuYWRkKGxvY2FsU3RvcmFnZVtcInRoZW1lXCJdIHx8IFwibGlnaHRcIik7XG4gIGFwcC5hY3RpdmVTZWFyY2hlcyA9IHt9O1xuICBpbml0U2VhcmNoZXMoYXBwLmV2ZSk7XG5cbiAgd2luZG93Lmhpc3RvcnkucmVwbGFjZVN0YXRlKHtyb290OiB0cnVlfSwgbnVsbCwgd2luZG93LmxvY2F0aW9uLmhhc2gpO1xuICBsZXQgbWFpblBhbmUgPSBhcHAuZXZlLmZpbmRPbmUoXCJ1aSBwYW5lXCIsIHtwYW5lOiBcInAxXCJ9KTtcbiAgbGV0IHBhdGggPSBnZXRMb2NhdGlvbigpO1xuICBsZXQgW18sIGtpbmQsIHJhdyA9IFwiXCJdID0gcGF0aC5zcGxpdChcIi9cIik7XG4gIGxldCBjb250ZW50ID0gZGVzbHVnaWZ5KHJhdyk7XG4gIGxldCBjdXIgPSBhcHAuZGlzcGF0Y2goXCJ1aSBzZXQgc2VhcmNoXCIsIHtwYW5lSWQ6IG1haW5QYW5lLnBhbmUsIHZhbHVlOiBjb250ZW50fSk7XG4gIGlmKGNvbnRlbnQgJiYgIWFwcC5ldmUuZmluZE9uZShcInF1ZXJ5IHRvIGlkXCIsIHtxdWVyeTogY29udGVudH0pKSB7XG4gICAgY3VyLmRpc3BhdGNoKFwiaW5zZXJ0IHF1ZXJ5XCIsIHtxdWVyeTogY29udGVudH0pO1xuICB9XG4gIGN1ci5jb21taXQoKTtcbn0pO1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImhhc2hjaGFuZ2VcIiwgZnVuY3Rpb24oKSB7XG4gIGxldCBtYWluUGFuZSA9IGFwcC5ldmUuZmluZE9uZShcInVpIHBhbmVcIiwge3BhbmU6IFwicDFcIn0pO1xuICBsZXQgcGF0aCA9IGdldExvY2F0aW9uKCk7XG4gIGxldCBbXywga2luZCwgcmF3ID0gXCJcIl0gPSBwYXRoLnNwbGl0KFwiL1wiKTtcbiAgbGV0IGNvbnRlbnQgPSBkZXNsdWdpZnkocmF3KTtcbiAgbGV0IGRpc3BsYXlzID0gYXBwLmV2ZS5maW5kKFwiZGlzcGxheSBuYW1lXCIsIHtuYW1lOiBjb250ZW50fSk7XG4gIGlmKGRpc3BsYXlzLmxlbmd0aCA9PT0gMSkgY29udGVudCA9IGRpc3BsYXlzWzBdLmlkO1xuXG4gIGlmKG1haW5QYW5lLmNvbnRhaW5zID09PSBjb250ZW50KSByZXR1cm47XG4gIFxuICBsZXQgY3VyID0gYXBwLmRpc3BhdGNoKFwidWkgc2V0IHNlYXJjaFwiLCB7cGFuZUlkOiBtYWluUGFuZS5wYW5lLCB2YWx1ZTogY29udGVudH0pO1xuICBpZihjb250ZW50ICYmICFhcHAuZXZlLmZpbmRPbmUoXCJxdWVyeSB0byBpZFwiLCB7cXVlcnk6IGNvbnRlbnR9KSkge1xuICAgIGN1ci5kaXNwYXRjaChcImluc2VydCBxdWVyeVwiLCB7cXVlcnk6IGNvbnRlbnR9KTtcbiAgfVxuICBjdXIuY29tbWl0KCk7XG59KTtcbiIsImltcG9ydCAqIGFzIGFwcCBmcm9tIFwiLi4vc3JjL2FwcFwiO1xuaW1wb3J0ICogYXMgcnVudGltZSBmcm9tIFwiLi4vc3JjL3J1bnRpbWVcIjtcbmltcG9ydCBcIi4uL3NyYy93aWtpXCI7XG5cbnZhciBldmUgPSBydW50aW1lLmFkZFByb3ZlbmFuY2VUYWJsZShuZXcgcnVudGltZS5JbmRleGVyKCkpO1xud2luZG93W1wiZXZlXCJdID0gZXZlO1xuXG5hcHAuaW5pdChcInJ1bnRpbWUgdGVzdFwiLCAoKSA9PiB7XG5cdGFwcC5yZW5kZXJSb290cyA9IHt9O1xuXHR2YXIgdGVzdERhdGEgPSBldmUuZGlmZigpO1xuXHR0ZXN0RGF0YS5hZGQoXCJmb29cIiwge2E6IDEsIGI6IDJ9KTtcblx0dGVzdERhdGEuYWRkKFwiZm9vXCIsIHthOiAyLCBiOiAzfSk7XG5cdHRlc3REYXRhLmFkZChcImZvb1wiLCB7YTogMiwgYjogNH0pO1xuXHR0ZXN0RGF0YS5hZGQoXCJiYXJcIiwge2E6IDIsIGM6IDV9KTtcblx0dGVzdERhdGEuYWRkKFwiYmFyXCIsIHthOiAyLCBjOiA2fSk7XG5cdHRlc3REYXRhLnJlbW92ZShcInN5c3RlbSB1aVwiLCB7dGVtcGxhdGU6IFwid2lraSByb290XCJ9KTtcblx0ZXZlLmFwcGx5RGlmZih0ZXN0RGF0YSk7XG5cblxuXHR2YXIgcXVlcnkxID0gZXZlLnF1ZXJ5KFwibm8gZ3JvdXAgdGVzdFwiKVxuXHRcdFx0XHRcdC5zZWxlY3QoXCJmb29cIiwge30sIFwiZm9vXCIpXG5cdFx0XHRcdFx0LnNlbGVjdChcImJhclwiLCB7YTogW1wiZm9vXCIsIFwiYVwiXX0sIFwiYmFyXCIpXG5cdFx0XHRcdFx0LnByb2plY3Qoe2M6IFtcImJhclwiLCBcImNcIl19KTtcblx0dmFyIHJlcyA9IHF1ZXJ5MS5leGVjKCk7XG4gICAgY29uc29sZS5sb2cocmVzKTtcblxuXHR2YXIgcXVlcnkyID0gZXZlLnF1ZXJ5KFwiZ3JvdXAgdGVzdFwiKVxuXHRcdFx0XHRcdC5zZWxlY3QoXCJmb29cIiwge30sIFwiZm9vXCIpXG5cdFx0XHRcdFx0LnNlbGVjdChcImJhclwiLCB7YTogW1wiZm9vXCIsIFwiYVwiXX0sIFwiYmFyXCIpXG5cdFx0XHRcdFx0Lmdyb3VwKFtbXCJmb29cIiwgXCJiXCJdXSlcblx0XHRcdFx0XHQuYWdncmVnYXRlKFwiY291bnRcIiwge30sIFwiY291bnRcIilcblx0XHRcdFx0XHQucHJvamVjdCh7YjogW1wiZm9vXCIsIFwiYlwiXSwgY291bnQ6IFtcImNvdW50XCIsIFwiY291bnRcIl19KTtcblx0dmFyIHJlczIgPSBxdWVyeTIuZGVidWcoKTtcbiAgICBjb25zb2xlLmxvZyhyZXMyKTtcblxuXHR2YXIgcHJvdmVuYW5jZSA9IGV2ZS5kaWZmKCk7XG5cdHByb3ZlbmFuY2UuYWRkTWFueShcInByb3ZlbmFuY2VcIiwgcmVzLnByb3ZlbmFuY2UpO1xuXHRwcm92ZW5hbmNlLmFkZE1hbnkoXCJwcm92ZW5hbmNlXCIsIHJlczIucHJvdmVuYW5jZSk7XG5cdHByb3ZlbmFuY2UuYWRkTWFueShcIm5vIGdyb3VwIHRlc3RcIiwgcmVzLnJlc3VsdHMpO1xuXHRwcm92ZW5hbmNlLmFkZE1hbnkoXCJncm91cCB0ZXN0XCIsIHJlczIucmVzdWx0cyk7XG5cdGV2ZS5hcHBseURpZmYocHJvdmVuYW5jZSk7XG5cblx0ZnVuY3Rpb24gZm9vKGNoYW5nZXMsIG1laCkge1xuXHRcdGxldCBvdGhlcnMgPSBbXTtcblx0XHRpZihjaGFuZ2VzW1wiYmFyXCJdICYmIGNoYW5nZXNbXCJiYXJcIl0uYWRkcykge1xuXHRcdFx0Zm9yKGxldCBjaGFuZ2UwIG9mIGNoYW5nZXNbXCJiYXJcIl0uYWRkcykge1xuXHRcdFx0XHRsZXQgcm93czEgPSBldmUuZmluZChcImZvb1wiLCB7YTogY2hhbmdlMFtcImFcIl19KTtcblx0XHRcdFx0Zm9yKGxldCByb3cxIG9mIHJvd3MxKSB7XG5cdFx0XHRcdFx0b3RoZXJzLnB1c2gocm93MSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cdFx0aWYoY2hhbmdlc1tcImZvb1wiXSAmJiBjaGFuZ2VzW1wiZm9vXCJdLmFkZHMpIHtcblx0XHRcdGZvcihsZXQgY2hhbmdlIG9mIGNoYW5nZXNbXCJmb29cIl0uYWRkcykge1xuXHRcdFx0XHRvdGhlcnMucHVzaChjaGFuZ2UpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXR1cm4gb3RoZXJzXG5cdH1cblxuICAgIHZhciBmdW5jID0gcXVlcnkxLmluY3JlbWVudGFsUm93RmluZGVyO1xuXHRjb25zb2xlLmxvZyhmdW5jKTtcblxuXHRjb25zb2xlLmxvZyhmdW5jKHt9KSk7XG5cdGNvbnNvbGUubG9nKGZ1bmMoe1wiZm9vXCI6IHthZGRzOiBbe2E6IDIsIGI6N31dfX0pKTtcblx0Y29uc29sZS5sb2coZnVuYyh7XCJiYXJcIjoge2FkZHM6IFt7YTogMiwgYzo3fV19fSkpO1xuXHRjb25zb2xlLmxvZyhmdW5jKHtcImZvb1wiOiB7YWRkczogW3thOiAyLCBiOjd9XX0sIFwiYmFyXCI6IHthZGRzOiBbe2E6IDIsIGM6N31dfX0pKTtcblxuICAgIGV2ZS5hc1ZpZXcocXVlcnkxKTtcbiAgICBldmUuYXNWaWV3KHF1ZXJ5Mik7XG5cbiAgICB2YXIgY2hhbmdlSW5mbyA9IHtcImZvb1wiOiB7YWRkczogW3thOiAyLCBiOjd9XX0sIFwiYmFyXCI6IHthZGRzOiBbe2E6IDIsIGM6N31dfX07XG4gICAgdmFyIGNoYW5nZXMgPSBldmUuZGlmZigpO1xuICAgIGNoYW5nZXMucmVtb3ZlKFwiZm9vXCIsIHthOiAyLCBiOiAzfSk7XG4gICAgLy8gY2hhbmdlcy5yZW1vdmUoXCJiYXJcIiwge2E6IDIsIGM6IDV9KTtcbiAgICAvLyBjaGFuZ2VzLnJlbW92ZShcImJhclwiLCB7YTogMiwgYzogNn0pO1xuICAgIGV2ZS5hcHBseURpZmZJbmNyZW1lbnRhbChjaGFuZ2VzKTtcblxuICAgIC8vIGNoYW5nZUluZm9bXCJiYXJcIl0gPSB1bmRlZmluZWQ7XG4gICAgLy8gdmFyIGluY3JlbWVudGFsID0gcXVlcnkxLmV4ZWNJbmNyZW1lbnRhbChjaGFuZ2VJbmZvLCBldmUudGFibGUocXVlcnkxLm5hbWUpKTtcbiAgICAvLyBjb25zb2xlLmxvZyhpbmNyZW1lbnRhbCk7XG5cdCAgLy8gdmFyIGluY3JlbWVudGFsMiA9IHF1ZXJ5Mi5leGVjSW5jcmVtZW50YWwoY2hhbmdlSW5mbywgZXZlLnRhYmxlKHF1ZXJ5Mi5uYW1lKSk7XG4gICAgLy8gY29uc29sZS5sb2coaW5jcmVtZW50YWwyKTtcblxuXHR2YXIgcGFyZW50QW5jZXN0b3IgPSBldmUucXVlcnkoXCJwYXJlbnQgYW5jZXN0b3JcIilcblx0XHRcdFx0XHRcdCAuc2VsZWN0KFwicGFyZW50XCIsIHt9LCBcInBhcmVudFwiKVxuXHRcdFx0XHRcdFx0IC5zZWxlY3QoXCJhbmNlc3RvclwiLCB7YW5jZXN0b3I6IFtcInBhcmVudFwiLCBcImNoaWxkXCJdfSwgXCJhbmNlc3RvclwiKVxuXHRcdFx0XHRcdFx0IC5wcm9qZWN0KHthbmNlc3RvcjogW1wicGFyZW50XCIsIFwicGFyZW50XCJdLCBjaGlsZDogW1wiYW5jZXN0b3JcIiwgXCJjaGlsZFwiXX0pO1xuICAgIGV2ZS5hc1ZpZXcocGFyZW50QW5jZXN0b3IpO1xuXG5cdHZhciBhbmNlc3RvclVuaW9uID0gZXZlLnVuaW9uKFwiYW5jZXN0b3JcIilcblx0XHRcdFx0XHRcdCAgIC51bmlvbihcInBhcmVudFwiLCB7YW5jZXN0b3I6IFtcInBhcmVudFwiXSwgY2hpbGQ6IFtcImNoaWxkXCJdfSlcblx0XHRcdFx0XHRcdCAgIC51bmlvbihcInBhcmVudCBhbmNlc3RvclwiLCB7YW5jZXN0b3I6IFtcImFuY2VzdG9yXCJdLCBjaGlsZDogW1wiY2hpbGRcIl19KTtcbiAgICBldmUuYXNWaWV3KGFuY2VzdG9yVW5pb24pO1xuXHR2YXIgcGFyZW50cyA9IGV2ZS5kaWZmKCk7XG5cdHBhcmVudHMuYWRkTWFueShcInBhcmVudFwiLCBbe3BhcmVudDogXCJhXCIsIGNoaWxkOiBcImJcIn0sIHtwYXJlbnQ6IFwiYlwiLCBjaGlsZDogXCJjXCJ9XSk7XG5cdGV2ZS5hcHBseURpZmZJbmNyZW1lbnRhbChwYXJlbnRzKTtcblxufSk7XG4iLCIiLCIvLyAgICAgdXVpZC5qc1xuLy9cbi8vICAgICBDb3B5cmlnaHQgKGMpIDIwMTAtMjAxMiBSb2JlcnQgS2llZmZlclxuLy8gICAgIE1JVCBMaWNlbnNlIC0gaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlLnBocFxuXG4oZnVuY3Rpb24oKSB7XG4gIHZhciBfZ2xvYmFsID0gdGhpcztcblxuICAvLyBVbmlxdWUgSUQgY3JlYXRpb24gcmVxdWlyZXMgYSBoaWdoIHF1YWxpdHkgcmFuZG9tICMgZ2VuZXJhdG9yLiAgV2UgZmVhdHVyZVxuICAvLyBkZXRlY3QgdG8gZGV0ZXJtaW5lIHRoZSBiZXN0IFJORyBzb3VyY2UsIG5vcm1hbGl6aW5nIHRvIGEgZnVuY3Rpb24gdGhhdFxuICAvLyByZXR1cm5zIDEyOC1iaXRzIG9mIHJhbmRvbW5lc3MsIHNpbmNlIHRoYXQncyB3aGF0J3MgdXN1YWxseSByZXF1aXJlZFxuICB2YXIgX3JuZztcblxuICAvLyBOb2RlLmpzIGNyeXB0by1iYXNlZCBSTkcgLSBodHRwOi8vbm9kZWpzLm9yZy9kb2NzL3YwLjYuMi9hcGkvY3J5cHRvLmh0bWxcbiAgLy9cbiAgLy8gTW9kZXJhdGVseSBmYXN0LCBoaWdoIHF1YWxpdHlcbiAgaWYgKHR5cGVvZihfZ2xvYmFsLnJlcXVpcmUpID09ICdmdW5jdGlvbicpIHtcbiAgICB0cnkge1xuICAgICAgdmFyIF9yYiA9IF9nbG9iYWwucmVxdWlyZSgnY3J5cHRvJykucmFuZG9tQnl0ZXM7XG4gICAgICBfcm5nID0gX3JiICYmIGZ1bmN0aW9uKCkge3JldHVybiBfcmIoMTYpO307XG4gICAgfSBjYXRjaChlKSB7fVxuICB9XG5cbiAgaWYgKCFfcm5nICYmIF9nbG9iYWwuY3J5cHRvICYmIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMpIHtcbiAgICAvLyBXSEFUV0cgY3J5cHRvLWJhc2VkIFJORyAtIGh0dHA6Ly93aWtpLndoYXR3Zy5vcmcvd2lraS9DcnlwdG9cbiAgICAvL1xuICAgIC8vIE1vZGVyYXRlbHkgZmFzdCwgaGlnaCBxdWFsaXR5XG4gICAgdmFyIF9ybmRzOCA9IG5ldyBVaW50OEFycmF5KDE2KTtcbiAgICBfcm5nID0gZnVuY3Rpb24gd2hhdHdnUk5HKCkge1xuICAgICAgY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhfcm5kczgpO1xuICAgICAgcmV0dXJuIF9ybmRzODtcbiAgICB9O1xuICB9XG5cbiAgaWYgKCFfcm5nKSB7XG4gICAgLy8gTWF0aC5yYW5kb20oKS1iYXNlZCAoUk5HKVxuICAgIC8vXG4gICAgLy8gSWYgYWxsIGVsc2UgZmFpbHMsIHVzZSBNYXRoLnJhbmRvbSgpLiAgSXQncyBmYXN0LCBidXQgaXMgb2YgdW5zcGVjaWZpZWRcbiAgICAvLyBxdWFsaXR5LlxuICAgIHZhciAgX3JuZHMgPSBuZXcgQXJyYXkoMTYpO1xuICAgIF9ybmcgPSBmdW5jdGlvbigpIHtcbiAgICAgIGZvciAodmFyIGkgPSAwLCByOyBpIDwgMTY7IGkrKykge1xuICAgICAgICBpZiAoKGkgJiAweDAzKSA9PT0gMCkgciA9IE1hdGgucmFuZG9tKCkgKiAweDEwMDAwMDAwMDtcbiAgICAgICAgX3JuZHNbaV0gPSByID4+PiAoKGkgJiAweDAzKSA8PCAzKSAmIDB4ZmY7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBfcm5kcztcbiAgICB9O1xuICB9XG5cbiAgLy8gQnVmZmVyIGNsYXNzIHRvIHVzZVxuICB2YXIgQnVmZmVyQ2xhc3MgPSB0eXBlb2YoX2dsb2JhbC5CdWZmZXIpID09ICdmdW5jdGlvbicgPyBfZ2xvYmFsLkJ1ZmZlciA6IEFycmF5O1xuXG4gIC8vIE1hcHMgZm9yIG51bWJlciA8LT4gaGV4IHN0cmluZyBjb252ZXJzaW9uXG4gIHZhciBfYnl0ZVRvSGV4ID0gW107XG4gIHZhciBfaGV4VG9CeXRlID0ge307XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgMjU2OyBpKyspIHtcbiAgICBfYnl0ZVRvSGV4W2ldID0gKGkgKyAweDEwMCkudG9TdHJpbmcoMTYpLnN1YnN0cigxKTtcbiAgICBfaGV4VG9CeXRlW19ieXRlVG9IZXhbaV1dID0gaTtcbiAgfVxuXG4gIC8vICoqYHBhcnNlKClgIC0gUGFyc2UgYSBVVUlEIGludG8gaXQncyBjb21wb25lbnQgYnl0ZXMqKlxuICBmdW5jdGlvbiBwYXJzZShzLCBidWYsIG9mZnNldCkge1xuICAgIHZhciBpID0gKGJ1ZiAmJiBvZmZzZXQpIHx8IDAsIGlpID0gMDtcblxuICAgIGJ1ZiA9IGJ1ZiB8fCBbXTtcbiAgICBzLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvWzAtOWEtZl17Mn0vZywgZnVuY3Rpb24ob2N0KSB7XG4gICAgICBpZiAoaWkgPCAxNikgeyAvLyBEb24ndCBvdmVyZmxvdyFcbiAgICAgICAgYnVmW2kgKyBpaSsrXSA9IF9oZXhUb0J5dGVbb2N0XTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFplcm8gb3V0IHJlbWFpbmluZyBieXRlcyBpZiBzdHJpbmcgd2FzIHNob3J0XG4gICAgd2hpbGUgKGlpIDwgMTYpIHtcbiAgICAgIGJ1ZltpICsgaWkrK10gPSAwO1xuICAgIH1cblxuICAgIHJldHVybiBidWY7XG4gIH1cblxuICAvLyAqKmB1bnBhcnNlKClgIC0gQ29udmVydCBVVUlEIGJ5dGUgYXJyYXkgKGFsYSBwYXJzZSgpKSBpbnRvIGEgc3RyaW5nKipcbiAgZnVuY3Rpb24gdW5wYXJzZShidWYsIG9mZnNldCkge1xuICAgIHZhciBpID0gb2Zmc2V0IHx8IDAsIGJ0aCA9IF9ieXRlVG9IZXg7XG4gICAgcmV0dXJuICBidGhbYnVmW2krK11dICsgYnRoW2J1ZltpKytdXSArXG4gICAgICAgICAgICBidGhbYnVmW2krK11dICsgYnRoW2J1ZltpKytdXSArICctJyArXG4gICAgICAgICAgICBidGhbYnVmW2krK11dICsgYnRoW2J1ZltpKytdXSArICctJyArXG4gICAgICAgICAgICBidGhbYnVmW2krK11dICsgYnRoW2J1ZltpKytdXSArICctJyArXG4gICAgICAgICAgICBidGhbYnVmW2krK11dICsgYnRoW2J1ZltpKytdXSArICctJyArXG4gICAgICAgICAgICBidGhbYnVmW2krK11dICsgYnRoW2J1ZltpKytdXSArXG4gICAgICAgICAgICBidGhbYnVmW2krK11dICsgYnRoW2J1ZltpKytdXSArXG4gICAgICAgICAgICBidGhbYnVmW2krK11dICsgYnRoW2J1ZltpKytdXTtcbiAgfVxuXG4gIC8vICoqYHYxKClgIC0gR2VuZXJhdGUgdGltZS1iYXNlZCBVVUlEKipcbiAgLy9cbiAgLy8gSW5zcGlyZWQgYnkgaHR0cHM6Ly9naXRodWIuY29tL0xpb3NLL1VVSUQuanNcbiAgLy8gYW5kIGh0dHA6Ly9kb2NzLnB5dGhvbi5vcmcvbGlicmFyeS91dWlkLmh0bWxcblxuICAvLyByYW5kb20gIydzIHdlIG5lZWQgdG8gaW5pdCBub2RlIGFuZCBjbG9ja3NlcVxuICB2YXIgX3NlZWRCeXRlcyA9IF9ybmcoKTtcblxuICAvLyBQZXIgNC41LCBjcmVhdGUgYW5kIDQ4LWJpdCBub2RlIGlkLCAoNDcgcmFuZG9tIGJpdHMgKyBtdWx0aWNhc3QgYml0ID0gMSlcbiAgdmFyIF9ub2RlSWQgPSBbXG4gICAgX3NlZWRCeXRlc1swXSB8IDB4MDEsXG4gICAgX3NlZWRCeXRlc1sxXSwgX3NlZWRCeXRlc1syXSwgX3NlZWRCeXRlc1szXSwgX3NlZWRCeXRlc1s0XSwgX3NlZWRCeXRlc1s1XVxuICBdO1xuXG4gIC8vIFBlciA0LjIuMiwgcmFuZG9taXplICgxNCBiaXQpIGNsb2Nrc2VxXG4gIHZhciBfY2xvY2tzZXEgPSAoX3NlZWRCeXRlc1s2XSA8PCA4IHwgX3NlZWRCeXRlc1s3XSkgJiAweDNmZmY7XG5cbiAgLy8gUHJldmlvdXMgdXVpZCBjcmVhdGlvbiB0aW1lXG4gIHZhciBfbGFzdE1TZWNzID0gMCwgX2xhc3ROU2VjcyA9IDA7XG5cbiAgLy8gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9icm9vZmEvbm9kZS11dWlkIGZvciBBUEkgZGV0YWlsc1xuICBmdW5jdGlvbiB2MShvcHRpb25zLCBidWYsIG9mZnNldCkge1xuICAgIHZhciBpID0gYnVmICYmIG9mZnNldCB8fCAwO1xuICAgIHZhciBiID0gYnVmIHx8IFtdO1xuXG4gICAgb3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cbiAgICB2YXIgY2xvY2tzZXEgPSBvcHRpb25zLmNsb2Nrc2VxICE9IG51bGwgPyBvcHRpb25zLmNsb2Nrc2VxIDogX2Nsb2Nrc2VxO1xuXG4gICAgLy8gVVVJRCB0aW1lc3RhbXBzIGFyZSAxMDAgbmFuby1zZWNvbmQgdW5pdHMgc2luY2UgdGhlIEdyZWdvcmlhbiBlcG9jaCxcbiAgICAvLyAoMTU4Mi0xMC0xNSAwMDowMCkuICBKU051bWJlcnMgYXJlbid0IHByZWNpc2UgZW5vdWdoIGZvciB0aGlzLCBzb1xuICAgIC8vIHRpbWUgaXMgaGFuZGxlZCBpbnRlcm5hbGx5IGFzICdtc2VjcycgKGludGVnZXIgbWlsbGlzZWNvbmRzKSBhbmQgJ25zZWNzJ1xuICAgIC8vICgxMDAtbmFub3NlY29uZHMgb2Zmc2V0IGZyb20gbXNlY3MpIHNpbmNlIHVuaXggZXBvY2gsIDE5NzAtMDEtMDEgMDA6MDAuXG4gICAgdmFyIG1zZWNzID0gb3B0aW9ucy5tc2VjcyAhPSBudWxsID8gb3B0aW9ucy5tc2VjcyA6IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuXG4gICAgLy8gUGVyIDQuMi4xLjIsIHVzZSBjb3VudCBvZiB1dWlkJ3MgZ2VuZXJhdGVkIGR1cmluZyB0aGUgY3VycmVudCBjbG9ja1xuICAgIC8vIGN5Y2xlIHRvIHNpbXVsYXRlIGhpZ2hlciByZXNvbHV0aW9uIGNsb2NrXG4gICAgdmFyIG5zZWNzID0gb3B0aW9ucy5uc2VjcyAhPSBudWxsID8gb3B0aW9ucy5uc2VjcyA6IF9sYXN0TlNlY3MgKyAxO1xuXG4gICAgLy8gVGltZSBzaW5jZSBsYXN0IHV1aWQgY3JlYXRpb24gKGluIG1zZWNzKVxuICAgIHZhciBkdCA9IChtc2VjcyAtIF9sYXN0TVNlY3MpICsgKG5zZWNzIC0gX2xhc3ROU2VjcykvMTAwMDA7XG5cbiAgICAvLyBQZXIgNC4yLjEuMiwgQnVtcCBjbG9ja3NlcSBvbiBjbG9jayByZWdyZXNzaW9uXG4gICAgaWYgKGR0IDwgMCAmJiBvcHRpb25zLmNsb2Nrc2VxID09IG51bGwpIHtcbiAgICAgIGNsb2Nrc2VxID0gY2xvY2tzZXEgKyAxICYgMHgzZmZmO1xuICAgIH1cblxuICAgIC8vIFJlc2V0IG5zZWNzIGlmIGNsb2NrIHJlZ3Jlc3NlcyAobmV3IGNsb2Nrc2VxKSBvciB3ZSd2ZSBtb3ZlZCBvbnRvIGEgbmV3XG4gICAgLy8gdGltZSBpbnRlcnZhbFxuICAgIGlmICgoZHQgPCAwIHx8IG1zZWNzID4gX2xhc3RNU2VjcykgJiYgb3B0aW9ucy5uc2VjcyA9PSBudWxsKSB7XG4gICAgICBuc2VjcyA9IDA7XG4gICAgfVxuXG4gICAgLy8gUGVyIDQuMi4xLjIgVGhyb3cgZXJyb3IgaWYgdG9vIG1hbnkgdXVpZHMgYXJlIHJlcXVlc3RlZFxuICAgIGlmIChuc2VjcyA+PSAxMDAwMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCd1dWlkLnYxKCk6IENhblxcJ3QgY3JlYXRlIG1vcmUgdGhhbiAxME0gdXVpZHMvc2VjJyk7XG4gICAgfVxuXG4gICAgX2xhc3RNU2VjcyA9IG1zZWNzO1xuICAgIF9sYXN0TlNlY3MgPSBuc2VjcztcbiAgICBfY2xvY2tzZXEgPSBjbG9ja3NlcTtcblxuICAgIC8vIFBlciA0LjEuNCAtIENvbnZlcnQgZnJvbSB1bml4IGVwb2NoIHRvIEdyZWdvcmlhbiBlcG9jaFxuICAgIG1zZWNzICs9IDEyMjE5MjkyODAwMDAwO1xuXG4gICAgLy8gYHRpbWVfbG93YFxuICAgIHZhciB0bCA9ICgobXNlY3MgJiAweGZmZmZmZmYpICogMTAwMDAgKyBuc2VjcykgJSAweDEwMDAwMDAwMDtcbiAgICBiW2krK10gPSB0bCA+Pj4gMjQgJiAweGZmO1xuICAgIGJbaSsrXSA9IHRsID4+PiAxNiAmIDB4ZmY7XG4gICAgYltpKytdID0gdGwgPj4+IDggJiAweGZmO1xuICAgIGJbaSsrXSA9IHRsICYgMHhmZjtcblxuICAgIC8vIGB0aW1lX21pZGBcbiAgICB2YXIgdG1oID0gKG1zZWNzIC8gMHgxMDAwMDAwMDAgKiAxMDAwMCkgJiAweGZmZmZmZmY7XG4gICAgYltpKytdID0gdG1oID4+PiA4ICYgMHhmZjtcbiAgICBiW2krK10gPSB0bWggJiAweGZmO1xuXG4gICAgLy8gYHRpbWVfaGlnaF9hbmRfdmVyc2lvbmBcbiAgICBiW2krK10gPSB0bWggPj4+IDI0ICYgMHhmIHwgMHgxMDsgLy8gaW5jbHVkZSB2ZXJzaW9uXG4gICAgYltpKytdID0gdG1oID4+PiAxNiAmIDB4ZmY7XG5cbiAgICAvLyBgY2xvY2tfc2VxX2hpX2FuZF9yZXNlcnZlZGAgKFBlciA0LjIuMiAtIGluY2x1ZGUgdmFyaWFudClcbiAgICBiW2krK10gPSBjbG9ja3NlcSA+Pj4gOCB8IDB4ODA7XG5cbiAgICAvLyBgY2xvY2tfc2VxX2xvd2BcbiAgICBiW2krK10gPSBjbG9ja3NlcSAmIDB4ZmY7XG5cbiAgICAvLyBgbm9kZWBcbiAgICB2YXIgbm9kZSA9IG9wdGlvbnMubm9kZSB8fCBfbm9kZUlkO1xuICAgIGZvciAodmFyIG4gPSAwOyBuIDwgNjsgbisrKSB7XG4gICAgICBiW2kgKyBuXSA9IG5vZGVbbl07XG4gICAgfVxuXG4gICAgcmV0dXJuIGJ1ZiA/IGJ1ZiA6IHVucGFyc2UoYik7XG4gIH1cblxuICAvLyAqKmB2NCgpYCAtIEdlbmVyYXRlIHJhbmRvbSBVVUlEKipcblxuICAvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2Jyb29mYS9ub2RlLXV1aWQgZm9yIEFQSSBkZXRhaWxzXG4gIGZ1bmN0aW9uIHY0KG9wdGlvbnMsIGJ1Ziwgb2Zmc2V0KSB7XG4gICAgLy8gRGVwcmVjYXRlZCAtICdmb3JtYXQnIGFyZ3VtZW50LCBhcyBzdXBwb3J0ZWQgaW4gdjEuMlxuICAgIHZhciBpID0gYnVmICYmIG9mZnNldCB8fCAwO1xuXG4gICAgaWYgKHR5cGVvZihvcHRpb25zKSA9PSAnc3RyaW5nJykge1xuICAgICAgYnVmID0gb3B0aW9ucyA9PSAnYmluYXJ5JyA/IG5ldyBCdWZmZXJDbGFzcygxNikgOiBudWxsO1xuICAgICAgb3B0aW9ucyA9IG51bGw7XG4gICAgfVxuICAgIG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG4gICAgdmFyIHJuZHMgPSBvcHRpb25zLnJhbmRvbSB8fCAob3B0aW9ucy5ybmcgfHwgX3JuZykoKTtcblxuICAgIC8vIFBlciA0LjQsIHNldCBiaXRzIGZvciB2ZXJzaW9uIGFuZCBgY2xvY2tfc2VxX2hpX2FuZF9yZXNlcnZlZGBcbiAgICBybmRzWzZdID0gKHJuZHNbNl0gJiAweDBmKSB8IDB4NDA7XG4gICAgcm5kc1s4XSA9IChybmRzWzhdICYgMHgzZikgfCAweDgwO1xuXG4gICAgLy8gQ29weSBieXRlcyB0byBidWZmZXIsIGlmIHByb3ZpZGVkXG4gICAgaWYgKGJ1Zikge1xuICAgICAgZm9yICh2YXIgaWkgPSAwOyBpaSA8IDE2OyBpaSsrKSB7XG4gICAgICAgIGJ1ZltpICsgaWldID0gcm5kc1tpaV07XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGJ1ZiB8fCB1bnBhcnNlKHJuZHMpO1xuICB9XG5cbiAgLy8gRXhwb3J0IHB1YmxpYyBBUElcbiAgdmFyIHV1aWQgPSB2NDtcbiAgdXVpZC52MSA9IHYxO1xuICB1dWlkLnY0ID0gdjQ7XG4gIHV1aWQucGFyc2UgPSBwYXJzZTtcbiAgdXVpZC51bnBhcnNlID0gdW5wYXJzZTtcbiAgdXVpZC5CdWZmZXJDbGFzcyA9IEJ1ZmZlckNsYXNzO1xuXG4gIGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcbiAgICAvLyBQdWJsaXNoIGFzIEFNRCBtb2R1bGVcbiAgICBkZWZpbmUoZnVuY3Rpb24oKSB7cmV0dXJuIHV1aWQ7fSk7XG4gIH0gZWxzZSBpZiAodHlwZW9mKG1vZHVsZSkgIT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHtcbiAgICAvLyBQdWJsaXNoIGFzIG5vZGUuanMgbW9kdWxlXG4gICAgbW9kdWxlLmV4cG9ydHMgPSB1dWlkO1xuICB9IGVsc2Uge1xuICAgIC8vIFB1Ymxpc2ggYXMgZ2xvYmFsIChpbiBicm93c2VycylcbiAgICB2YXIgX3ByZXZpb3VzUm9vdCA9IF9nbG9iYWwudXVpZDtcblxuICAgIC8vICoqYG5vQ29uZmxpY3QoKWAgLSAoYnJvd3NlciBvbmx5KSB0byByZXNldCBnbG9iYWwgJ3V1aWQnIHZhcioqXG4gICAgdXVpZC5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7XG4gICAgICBfZ2xvYmFsLnV1aWQgPSBfcHJldmlvdXNSb290O1xuICAgICAgcmV0dXJuIHV1aWQ7XG4gICAgfTtcblxuICAgIF9nbG9iYWwudXVpZCA9IHV1aWQ7XG4gIH1cbn0pLmNhbGwodGhpcyk7XG4iXX0=
